{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554",
    "id": 2527184806,
    "node_id": "PR_kwDOABII586Wocem",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32554",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32554.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32554.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b5b57cdf396d8945612fcb2d51e530475db0d87d",
    "number": 32554,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "bench: replace embedded raw block with configurable block generator",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "### Problem\r\n\r\nThe [hardcoded benchmark block 413567](https://mempool.space/block/413567) has several issues:\r\n- embeds 1.1MB of binary data in the repository (we can't remove it from history, but we can, from `HEAD`)\r\n- mined in 2016, predates SegWit v0, Taproot, and modern script types\r\n- benchmarks cannot test different transaction patterns or script mixes\r\n- updating to a newer block (e.g., [#32457](https://github.com/bitcoin/bitcoin/pull/32457)) would still add binary bloat and would remain inflexible\r\n\r\n### Fix\r\n\r\nAdded configurable `bench/block_generator.{h,cpp}` that builds fully valid blocks at runtime providing blocks or raw serialized stream.\r\n\r\nNote that `HexStrBench` was simplified to work with random data - it doesn't need to be block-related.\r\n\r\n### Reproducer\r\n\r\nYou can run all affected tests and benchmarks with a sanity check:\r\n```bash\r\nrm -rf build && \\\r\ncmake -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_BENCH=ON && \\\r\ncmake --build build -j$(nproc) && \\\r\nbuild/bin/test_bitcoin -t block_generator_deterministic_seeded_output,block_generator_data_roundtrip,block_generator_seed_perturbation && \\\r\nbuild/bin/bench_bitcoin -sanity-check -filter='DeserializeBlockTest|DeserializeAndCheckBlockTest|LoadExternalBlockFile|WriteBlockBench|ReadBlockBench|ReadRawBlockBench|BlockToJsonVerbosity1|BlockToJsonVerbosity2|BlockToJsonVerbosity3|BlockToJsonVerboseWrite|HexStrBench'\r\n```\r\n---\r\n\r\nThis supersedes #32457 by eliminating the need for any hardcoded block data while enabling flexible benchmark scenarios.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2025-05-18T21:39:14Z",
    "updated_at": "2026-02-16T10:32:38Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "d10040851e5791036aff965caf774b02b5fa2c34",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/bench-block-generator",
      "ref": "l0rinc/bench-block-generator",
      "sha": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 290985,
        "default_branch": "master",
        "open_issues_count": 45,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-15T21:57:47Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-02-13T22:28:06Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b2805eec35ce9fdb69892e864556be4ae057ce6a",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38907,
        "stargazers_count": 88140,
        "watchers_count": 88140,
        "size": 303672,
        "default_branch": "master",
        "open_issues_count": 733,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-13T14:32:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-16T10:36:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 294,
    "deletions": 52,
    "changed_files": 9,
    "commits": 1,
    "review_comments": 21,
    "comments": 5
  },
  "events": [
    {
      "event": "commented",
      "id": 2889225308,
      "node_id": "IC_kwDOABII586sNhRc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2889225308",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-18T21:39:17Z",
      "updated_at": "2026-02-13T17:22:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32554.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2890272937), [yuvicc](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3016802388), [Raimo33](https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3419716580), [hodlinator](https://github.com/bitcoin/bitcoin/pull/32554#pullrequestreview-3605702499) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34448](https://github.com/bitcoin/bitcoin/pull/34448) (ci, iwyu: Fix warnings in `src/util` and treat them as errors by hebasto)\n* [#34208](https://github.com/bitcoin/bitcoin/pull/34208) (bench: add fluent API for untimed `setup` steps in nanobench by l0rinc)\n* [#32729](https://github.com/bitcoin/bitcoin/pull/32729) (test,refactor: extract script template helpers & widen sigop count coverage by l0rinc)\n* [#31682](https://github.com/bitcoin/bitcoin/pull/31682) ([IBD] specialize CheckBlock's input & coinbase checks by l0rinc)\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2889225308",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "commented",
      "id": 2890272937,
      "node_id": "IC_kwDOABII586sRhCp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2890272937",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-19T09:18:41Z",
      "updated_at": "2025-05-19T09:18:41Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-2890272937",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "ready_for_review",
      "id": 17754225674,
      "node_id": "RFRE_lADOABII5863HC1azwAAAAQiO_wK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754225674",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T13:44:06Z"
    },
    {
      "event": "renamed",
      "id": 17754597963,
      "node_id": "RTE_lADOABII5863HC1azwAAAAQiQapL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754597963",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T14:03:43Z",
      "rename": {
        "from": "RFC: bench: replace embedded raw block with configurable block generator",
        "to": "bench: replace embedded raw block with configurable block generator"
      }
    },
    {
      "event": "labeled",
      "id": 17754599134,
      "node_id": "LE_lADOABII5863HC1azwAAAAQiQa7e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17754599134",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-21T14:03:47Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 3016802388,
      "node_id": "IC_kwDOABII586z0MBU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3016802388",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-29T15:44:33Z",
      "updated_at": "2025-06-29T15:44:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nThis one is pretty useful as I can test with up-to date test_data.",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3016802388",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "commented",
      "id": 3419716580,
      "node_id": "IC_kwDOABII587L1Lvk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3419716580",
      "actor": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-19T14:37:15Z",
      "updated_at": "2025-10-19T14:37:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK for more realistic benchmarks",
      "user": {
        "login": "Raimo33",
        "id": 104778891,
        "node_id": "U_kgDOBj7Miw",
        "avatar_url": "https://avatars.githubusercontent.com/u/104778891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Raimo33",
        "html_url": "https://github.com/Raimo33",
        "followers_url": "https://api.github.com/users/Raimo33/followers",
        "following_url": "https://api.github.com/users/Raimo33/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Raimo33/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Raimo33/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Raimo33/subscriptions",
        "organizations_url": "https://api.github.com/users/Raimo33/orgs",
        "repos_url": "https://api.github.com/users/Raimo33/repos",
        "events_url": "https://api.github.com/users/Raimo33/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Raimo33/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3419716580",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21687193807,
      "node_id": "HRFPE_lADOABII5863HC1azwAAAAUMqFDP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21687193807",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "created_at": "2025-12-20T23:18:52Z"
    },
    {
      "event": "commented",
      "id": 3678199901,
      "node_id": "IC_kwDOABII587bPOBd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3678199901",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-20T23:19:52Z",
      "updated_at": "2025-12-20T23:19:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased and applied the new block everywhere, removing the binary of block 413567 embedded in the benchmarks.\r\nLet me know what you think.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#issuecomment-3678199901",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32554"
    },
    {
      "event": "labeled",
      "id": 22604892688,
      "node_id": "LE_lADOABII5863HC1azwAAAAVDW0oQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22604892688",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-07T04:12:34Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI1YjU3Y2RmMzk2ZDg5NDU2MTJmY2IyZDUxZTUzMDQ3NWRiMGQ4N2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "tree": {
        "sha": "7e0df75fa8300cda93a4dc168dbba3890dc5aed4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7e0df75fa8300cda93a4dc168dbba3890dc5aed4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7e0df75fa8300cda93a4dc168dbba3890dc5aed4\nparent b2805eec35ce9fdb69892e864556be4ae057ce6a\nauthor Lőrinc <pap.lorinc@gmail.com> 1747590547 +0200\ncommitter Lőrinc <pap.lorinc@gmail.com> 1770491706 +0100\n\nbench: replace hardcoded block with configurable generator\n\nRemove the bundled `block413567.raw` fixture and replace with runtime block generation via `bench/block_generator.{h,cpp}`.\n\nExpose `GetBlock()`/`GetBlockData()` with `ScriptRecipe` presets (`kLegacy`, `kWitness`) and deterministic seeding for reproducible benchmarks.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmHjzwACgkQZp//D/pH\nenY2dRAAhne3tov8Jn6EExiK6lEtM8aAXQmuaP3vlWgcozEuFtLo5EzzRzUC1emu\nE2FTu1NIQc9Sr1BRR79k/EUnQCq2Ogs5sQKNBaf+7zHA840Bb14+8zUi7QFSKq18\nAiTXFIsiVR4/dyLwarI0wv1U8xwMJVzxtoKMBqU0ghiQ6pm4So5ASK7oU959OGL4\n9GsgXnuFcpeeOkfrvBrDqKKgT4Jfb7tnEVN3/6hVN8UulTA81pMBm5+hjTwOSiZ5\nUi9LM3vwt1CVG4RpZ5uJKtBMeAF4p9iUF9YwbmXvVTfxPVdQSJa/Lqt2OLOx/B/q\nVHKhWXXcu1mfycmkeIwT5tLziebV4BThNAhGR0hdcdOhZoY32Ae/6v+ZtsRiCerD\nd64EdgF2GJep1StugY36zyqrZpB44aa5ahS7aMiePZLeQENw6m3wGG6ZLbfwarkM\nd6OI+qu06flrwCGHHOWwfKUp6clDrnG5YJJQ4EjwrU8sweBt2XNtVa7vfjtMW/as\nV75RaL9iwCr/epgi7InoFojMRFCirSW860YpMlVK1/YhPw+7KuREzoM5KjR7XLHC\ncov87ziNLW78YradAJumnwJocqSnzfsR+FTeNSRIioeeQsVdZUh2NP7IwwxEvMgV\ncJOinFwmm7La/f6vByU8L+8afEu6MRAnT4HCm9CPwTgg0KRCiPI=\n=sRGr\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b2805eec35ce9fdb69892e864556be4ae057ce6a",
          "sha": "b2805eec35ce9fdb69892e864556be4ae057ce6a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b2805eec35ce9fdb69892e864556be4ae057ce6a"
        }
      ],
      "message": "bench: replace hardcoded block with configurable generator\n\nRemove the bundled `block413567.raw` fixture and replace with runtime block generation via `bench/block_generator.{h,cpp}`.\n\nExpose `GetBlock()`/`GetBlockData()` with `ScriptRecipe` presets (`kLegacy`, `kWitness`) and deterministic seeding for reproducible benchmarks.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-07T19:15:06Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-18T17:49:07Z"
      },
      "sha": "b5b57cdf396d8945612fcb2d51e530475db0d87d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22613637316,
      "node_id": "HRFPE_lADOABII5863HC1azwAAAAVD4LjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22613637316",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "created_at": "2026-02-07T19:16:08Z"
    },
    {
      "event": "unlabeled",
      "id": 22613877407,
      "node_id": "UNLE_lADOABII5863HC1azwAAAAVD5GKf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22613877407",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-07T19:41:50Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3605702499,
      "node_id": "PRR_kwDOABII587W6qdj",
      "url": null,
      "actor": null,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-11T12:34:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK b5b57cdf396d8945612fcb2d51e530475db0d87d\n\n**Strong problem A-C-K - It's quite bad that we are only benchmarking against a pre-segwit block.**\n\nThe general direction is promising, I'd mainly prefer slightly more realistic transactions.\n\nAlso, since removing the old block data doesn't shrink the size of the repo, maybe we could keep it around together with some of the older benchmarks?\n\nSuggestions branch: https://github.com/bitcoin/bitcoin/compare/master...hodlinator:bitcoin:pr/32554_suggestions\n(Corresponds pretty much to the inline comments).",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#pullrequestreview-3605702499",
      "submitted_at": "2026-02-11T12:34:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641210291",
      "pull_request_review_id": 3605702499,
      "id": 2641210291,
      "node_id": "PRRC_kwDOABII586dbauz",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BENCH_BLOCK_GENERATOR_H\n+#define BITCOIN_BENCH_BLOCK_GENERATOR_H\n+\n+#include <kernel/chainparams.h>\n+#include <primitives/block.h>\n+#include <uint256.h>\n+\n+#include <streams.h>\n+\n+namespace benchmark {\n+struct ScriptRecipe\n+{\n+    //! per-output type probabilities ─ must sum ≤ 1.0\n+    double anchor_prob{0};\n+    double multisig_prob{0};\n+    double null_data_prob{0};\n+    double pubkey_prob{0};\n+    double pubkeyhash_prob{0};\n+    double scripthash_prob{0};\n+    double witness_v1_taproot_prob{0};\n+    double witness_v0_keyhash_prob{0};\n+    double witness_v0_scripthash_prob{0};\n+    double witness_unknown_prob{0};\n+    double nonstandard_prob{0};\n+\n+    //! tuning\n+    size_t tx_count{0};\n+    double geometric_base_prob{0.5};\n+};\n+\n+/* purely legacy outputs, useful for pre-SegWit baselines */\n+inline constexpr ScriptRecipe kLegacy{\n+    .anchor_prob = 0.00,\n+    .multisig_prob = 0.05,\n+    .null_data_prob = 0.005,\n+    .pubkey_prob = 0.10,\n+    .pubkeyhash_prob = 0.20,\n+    .scripthash_prob = 0.10,\n+    .witness_v1_taproot_prob = 0.00,\n+    .witness_v0_keyhash_prob = 0.00,\n+    .witness_v0_scripthash_prob = 0.00,\n+    .witness_unknown_prob = 0.00,\n+    .nonstandard_prob = 0.005,\n+\n+    .tx_count = 1500,\n+};\n+\n+/* witness-heavy mix (roughly Taproot-era main chain) */\n+inline constexpr ScriptRecipe kWitness{\n+    .anchor_prob = 0.001,\n+    .multisig_prob = 0.005,\n+    .null_data_prob = 0.002,\n+    .pubkey_prob = 0.001,\n+    .pubkeyhash_prob = 0.02,\n+    .scripthash_prob = 0.01,\n+    .witness_v1_taproot_prob = 0.20,\n+    .witness_v0_keyhash_prob = 0.25,\n+    .witness_v0_scripthash_prob = 0.05,\n+    .witness_unknown_prob = 0.02,\n+    .nonstandard_prob = 0.02,\n+\n+    .tx_count = 2000,\n+};\n+\n+DataStream GetBlockData(\n+    const CChainParams& chain_params = *CChainParams::RegTest(CChainParams::RegTestOptions{}),\n+    const ScriptRecipe& = kWitness,\n+    const uint256& seed = {}\n+);\n+CBlock GetBlock(",
      "path": "src/bench/block_generator.h",
      "position": 74,
      "original_position": 74,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Naming should probably indicate work/computation:\r\n```suggestion\r\nDataStream GenerateBlockData(\r\n    const CChainParams& chain_params = *CChainParams::RegTest(CChainParams::RegTestOptions{}),\r\n    const ScriptRecipe& = kWitness,\r\n    const uint256& seed = {}\r\n);\r\nCBlock GenerateBlock(\r\n```",
      "created_at": "2025-12-22T20:55:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641210291",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641210291"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 69,
      "original_start_line": 69,
      "start_side": "RIGHT",
      "line": 74,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641223542",
      "pull_request_review_id": 3605702499,
      "id": 2641223542,
      "node_id": "PRRC_kwDOABII586dbd92",
      "diff_hunk": "@@ -35,17 +35,18 @@\n  */\n static void LoadExternalBlockFile(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};",
      "path": "src/bench/load_external.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "My guess is that we are changing networks in order to get a `powLimit` which allows for trivially finding a valid nonce. Could the commit message spell this out?\r\n\r\nCould also replace this assert...\r\nhttps://github.com/bitcoin/bitcoin/blob/0fbbefd017a817bc32b5eb4dbb7647c668c8a61f/src/bench/block_generator.cpp#L76-L78\r\n\r\n...with a more direct assert further down, closer to where it's important:\r\n```C++\r\n    block.hashPrevBlock = params.GenesisBlock().GetHash();\r\n    assert(params.GetConsensus().powLimit == uint256{\"7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"}); // lowest difficulty\r\n    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact();\r\n```",
      "created_at": "2025-12-22T21:01:28Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641223542",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641223542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 38,
      "original_start_line": 38,
      "start_side": "LEFT",
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641285591",
      "pull_request_review_id": 3605702499,
      "id": 2641285591,
      "node_id": "PRRC_kwDOABII586dbtHX",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty",
      "path": "src/bench/block_generator.cpp",
      "position": 142,
      "original_position": 142,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Maybe have genesis block as previous block to be slightly more regular, instead of being a second genesis block (due to null `hashPrevBlock`)?\r\n```suggestion\r\n    block.nTime = params.GenesisBlock().nTime + 10 * 60;\r\n    block.hashPrevBlock = params.GenesisBlock().GetHash();\r\n    block.nBits = params.GenesisBlock().nBits;\r\n```\r\nBeing the genesis block also presents a mystery as non-coinbase transactions shouldn't be possible in genesis as outputs cannot be spent for 100 blocks. (I guess making us the second block doesn't help too much in that respect as the first 100 blocks should only have a coinbase transaction).",
      "created_at": "2025-12-22T21:21:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641285591",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641285591"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 140,
      "original_start_line": 140,
      "start_side": "RIGHT",
      "line": 142,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641304162",
      "pull_request_review_id": 3605702499,
      "id": 2641304162,
      "node_id": "PRRC_kwDOABII586dbxpi",
      "diff_hunk": "@@ -3,16 +3,19 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <bench/bench.h>\n-#include <bench/data/block413567.raw.h>\n+#include <pubkey.h>\n+#include <random.h>\n #include <span.h>\n #include <util/strencodings.h>\n \n+#include <cstdint>\n #include <vector>\n \n static void HexStrBench(benchmark::Bench& bench)\n {\n-    auto const& data = benchmark::data::block413567;\n-    bench.batch(data.size()).unit(\"byte\").run([&] {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    auto data{rng.randbytes<uint8_t>(CPubKey::COMPRESSED_SIZE)};",
      "path": "src/bench/strencodings.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Why not go for something in the same order of magnitude in size as on master, and use more modern std::bytes?\r\n```suggestion\r\n    auto data{rng.randbytes(MAX_BLOCK_WEIGHT)};\r\n```",
      "created_at": "2025-12-22T21:30:11Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641304162",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641304162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 17,
      "original_line": 17,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641314769",
      "pull_request_review_id": 3605702499,
      "id": 2641314769,
      "node_id": "PRRC_kwDOABII586db0PR",
      "diff_hunk": "@@ -19,32 +19,26 @@\n #include <memory>\n #include <vector>\n \n-static CBlock CreateTestBlock()\n-{\n-    DataStream stream{benchmark::data::block413567};\n-    CBlock block;\n-    stream >> TX_WITH_WITNESS(block);\n-    return block;\n-}\n-\n static void WriteBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const CBlock block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     bench.run([&] {\n-        const auto pos{blockman.WriteBlock(block, 413'567)};\n+        const auto pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};\n         assert(!pos.IsNull());\n     });\n }\n \n static void ReadBlockBench(benchmark::Bench& bench)\n {\n-    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::MAIN)};\n+    const auto testing_setup{MakeNoLogFileContext<const TestingSetup>(ChainType::REGTEST)};\n     auto& blockman{testing_setup->m_node.chainman->m_blockman};\n-    const auto& test_block{CreateTestBlock()};\n+    const auto& params{testing_setup->m_node.chainman->GetParams()};\n+    const auto test_block{benchmark::GetBlock(params)};\n     const auto& expected_hash{test_block.GetHash()};\n-    const auto& pos{blockman.WriteBlock(test_block, 413'567)};\n+    const auto& pos{blockman.WriteBlock(test_block, /*nHeight=*/1)};",
      "path": "src/bench/readwriteblock.cpp",
      "position": 53,
      "original_position": 46,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think height should technically be 0 if we don't have a prev block - then again, we have a bunch of random non-coinbase transactions, which should disqualify us from being a genesis block.\r\n\r\n1 would be correct if our prev is genesis though, see my other comment.",
      "created_at": "2025-12-22T21:35:02Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641314769",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641314769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 35,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641333273",
      "pull_request_review_id": 3605702499,
      "id": 2641333273,
      "node_id": "PRRC_kwDOABII586db4wZ",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};",
      "path": "src/bench/block_generator.cpp",
      "position": 48,
      "original_position": 48,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n            const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n```",
      "created_at": "2025-12-22T21:44:33Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641333273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641333273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 48,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641343010",
      "pull_request_review_id": 3605702499,
      "id": 2641343010,
      "node_id": "PRRC_kwDOABII586db7Ii",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {",
      "path": "src/bench/block_generator.cpp",
      "position": 55,
      "original_position": 55,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Not sure what's going on here regarding the sometimes need of explicit type, but might as well stay consistent:\r\n```suggestion\r\n        std::pair{rec.null_data_prob, [&] {\r\n```",
      "created_at": "2025-12-22T21:49:51Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641343010",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641343010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 55,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641347270",
      "pull_request_review_id": 3605702499,
      "id": 2641347270,
      "node_id": "PRRC_kwDOABII586db8LG",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)",
      "path": "src/bench/block_generator.cpp",
      "position": 43,
      "original_position": 43,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Developer notes encourage:\n```suggestion\nauto CreateScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n```",
      "created_at": "2025-12-22T21:51:59Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641347270",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641347270"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641351946",
      "pull_request_review_id": 3605702499,
      "id": 2641351946,
      "node_id": "PRRC_kwDOABII586db9UK",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)",
      "path": "src/bench/block_generator.cpp",
      "position": 43,
      "original_position": 43,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Would prefer only mentioning namespace once at the top:\r\n\r\n```C++\r\nnamespace benchmark {\r\nnamespace {\r\n...\r\n```\r\n\r\n```suggestion\r\nauto createScriptFactory(FastRandomContext& rng, const ScriptRecipe& rec)\r\n```",
      "created_at": "2025-12-22T21:54:06Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641351946",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641351946"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 43,
      "original_line": 43,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641357046",
      "pull_request_review_id": 3605702499,
      "id": 2641357046,
      "node_id": "PRRC_kwDOABII586db-j2",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};",
      "path": "src/bench/block_generator.cpp",
      "position": 38,
      "original_position": 38,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Could be uncompressed in some cases: https://learnmeabitcoin.com/technical/script/p2pk/",
      "created_at": "2025-12-22T21:56:43Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641357046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641357046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 38,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641396988",
      "pull_request_review_id": 3605702499,
      "id": 2641396988,
      "node_id": "PRRC_kwDOABII586dcIT8",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};",
      "path": "src/bench/block_generator.cpp",
      "position": 79,
      "original_position": 79,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Defaulting to initializing with a zero seed makes it not only deterministic, but even equal between process executions on different machines. If this design is intentional the rationale should be documented.",
      "created_at": "2025-12-22T22:13:13Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641396988",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641396988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 79,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641410600",
      "pull_request_review_id": 3605702499,
      "id": 2641410600,
      "node_id": "PRRC_kwDOABII586dcLoo",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));",
      "path": "src/bench/block_generator.cpp",
      "position": 93,
      "original_position": 93,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "https://learnmeabitcoin.com/technical/mining/coinbase-transaction/#requirements\r\n\r\n> [BIP 141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki): If the block contains [segwit transactions](https://learnmeabitcoin.com/technical/transaction/#example-segwit), the [witness](https://learnmeabitcoin.com/technical/transaction/witness/) field must contain a 32-byte [witness reserved value](https://learnmeabitcoin.com/technical/transaction/witness/#witness-reserved-value).\r\n\r\n> [BIP 141](https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki): If the block contains segwit transactions, one of the outputs must contain the [wTXID commitment](https://learnmeabitcoin.com/technical/transaction/wtxid/#commitment).",
      "created_at": "2025-12-22T22:18:38Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641410600",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641410600"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641414192",
      "pull_request_review_id": 3605702499,
      "id": 2641414192,
      "node_id": "PRRC_kwDOABII586dcMgw",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};",
      "path": "src/bench/block_generator.cpp",
      "position": 96,
      "original_position": 96,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    auto script_factory{createScriptFactory(rng, rec)};\r\n```",
      "created_at": "2025-12-22T22:20:59Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2641414192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641414192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 96,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2644156219",
      "pull_request_review_id": 3605702499,
      "id": 2644156219,
      "node_id": "PRRC_kwDOABII586dmp87",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};",
      "path": "src/bench/block_generator.cpp",
      "position": 82,
      "original_position": 82,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "0fbbefd017a817bc32b5eb4dbb7647c668c8a61f",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "When experimenting with changing the scripts I hit block size limits with just 2000 transactions due to large scripts.\r\n\r\nIt seems more precise to have `rec.tx_occupancy_limit` between `0.0-1.0` and just fill up the block with transactions until the serialized size exceeds that fraction of the maximum size. Then pop off the last added transaction to make sure we keep under the limit.\r\n\r\nWe could also insert an OP_RETURN output to a random tx to make it reach exactly the limit.\r\n\r\n<details><summary>Diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 2782b8d129..da7741f328 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -79,10 +79,10 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n     FastRandomContext rng{seed};\r\n \r\n     assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\r\n-    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\r\n+    const auto tx_occupancy_limit{rec.tx_occupancy_limit != 0.0 ? rec.tx_occupancy_limit : MakeUnitDouble(rng.rand64())};\r\n \r\n     CBlock block{};\r\n-    block.vtx.reserve(1 + tx_count);\r\n+    block.vtx.reserve(1 + (4000 * tx_occupancy_limit));\r\n \r\n     // coinbase\r\n     {\r\n@@ -95,7 +95,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n \r\n     auto scriptFactory{createScriptFactory(rng, rec)};\r\n     auto rand_script{[&] {\r\n-        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\r\n+        double probability{MakeUnitDouble(rng.rand64())};\r\n         for (const auto& [p, factory] : scriptFactory) {\r\n             if (probability < p) return factory();\r\n             probability -= p;\r\n@@ -104,7 +104,12 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         return CScript(raw.begin(), raw.end());\r\n     }};\r\n \r\n-    for (size_t i{0}; i < tx_count; ++i) {\r\n+    // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\n+    uint64_t block_size_no_witness{::GetSerializeSize(TX_NO_WITNESS(block)) + 2};\r\n+    uint64_t block_size_with_witness{::GetSerializeSize(TX_WITH_WITNESS(block)) + 2};\r\n+    const uint64_t block_size_limit(tx_occupancy_limit * MAX_BLOCK_WEIGHT);\r\n+    while (block_size_no_witness * WITNESS_SCALE_FACTOR < block_size_limit\r\n+           && block_size_no_witness * WITNESS_SCALE_FACTOR + (block_size_with_witness - block_size_no_witness) < block_size_limit) {\r\n         CMutableTransaction tx;\r\n         tx.version = 1 + rng.randrange<int>(3);\r\n         tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\r\n@@ -133,8 +138,12 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n             tx_out.scriptPubKey = rand_script();\r\n         }\r\n \r\n+        block_size_no_witness += ::GetSerializeSize(TX_NO_WITNESS(tx));\r\n+        block_size_with_witness += ::GetSerializeSize(TX_WITH_WITNESS(tx));\r\n         block.vtx.push_back(MakeTransactionRef(std::move(tx)));\r\n     }\r\n+    // Remove the transaction that had us exceed the limit.\r\n+    block.vtx.pop_back();\r\n \r\n     block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\r\n     block.nTime = params.GenesisBlock().nTime;\r\ndiff --git a/src/bench/block_generator.h b/src/bench/block_generator.h\r\nindex 4560005d53..4ce71f9c24 100644\r\n--- a/src/bench/block_generator.h\r\n+++ b/src/bench/block_generator.h\r\n@@ -28,7 +28,7 @@ struct ScriptRecipe\r\n     double nonstandard_prob{0};\r\n \r\n     //! tuning\r\n-    size_t tx_count{0};\r\n+    double tx_occupancy_limit{0}; // 0 means random, 1.0 is a full block.\r\n     double geometric_base_prob{0.5};\r\n };\r\n \r\n@@ -46,7 +46,7 @@ inline constexpr ScriptRecipe kLegacy{\r\n     .witness_unknown_prob = 0.00,\r\n     .nonstandard_prob = 0.005,\r\n \r\n-    .tx_count = 1500,\r\n+    .tx_occupancy_limit = 0.8,\r\n };\r\n \r\n /* witness-heavy mix (roughly Taproot-era main chain) */\r\n@@ -63,7 +63,7 @@ inline constexpr ScriptRecipe kWitness{\r\n     .witness_unknown_prob = 0.02,\r\n     .nonstandard_prob = 0.02,\r\n \r\n-    .tx_count = 2000,\r\n+    .tx_occupancy_limit = 1.0,\r\n };\r\n \r\n DataStream GetBlockData(\r\ndiff --git a/src/random.cpp b/src/random.cpp\r\nindex aeaf6baa8e..1908d45644 100644\r\n--- a/src/random.cpp\r\n+++ b/src/random.cpp\r\n@@ -701,16 +701,22 @@ void RandomInit()\r\n     ReportHardwareRand();\r\n }\r\n \r\n+double MakeUnitDouble(uint64_t uniform) noexcept\r\n+{\r\n+    // Convert uniform into a uniformly-distributed double in range [0, 1), use the expression\r\n+    // ((uniform >> 11) * 0x1.0p-53), as described in https://prng.di.unimi.it/ under\r\n+    // \"Generating uniform doubles in the unit interval\". Call this value x.\r\n+    return (uniform >> 11) * -0x1.0p-53;\r\n+}\r\n+\r\n double MakeExponentiallyDistributed(uint64_t uniform) noexcept\r\n {\r\n     // To convert uniform into an exponentially-distributed double, we use two steps:\r\n-    // - Convert uniform into a uniformly-distributed double in range [0, 1), use the expression\r\n-    //   ((uniform >> 11) * 0x1.0p-53), as described in https://prng.di.unimi.it/ under\r\n-    //   \"Generating uniform doubles in the unit interval\". Call this value x.\r\n+    // - MakeUnitDouble()\r\n     // - Given an x in uniformly distributed in [0, 1), we find an exponentially distributed value\r\n     //   by applying the quantile function to it. For the exponential distribution with mean 1 this\r\n     //   is F(x) = -log(1 - x).\r\n     //\r\n     // Combining the two, and using log1p(x) = log(1 + x), we obtain the following:\r\n-    return -std::log1p((uniform >> 11) * -0x1.0p-53);\r\n+    return -std::log1p(MakeUnitDouble(uniform));\r\n }\r\ndiff --git a/src/random.h b/src/random.h\r\nindex f0c0dcee81..ac2c5e924e 100644\r\n--- a/src/random.h\r\n+++ b/src/random.h\r\n@@ -158,6 +158,9 @@ concept StdChronoDuration = requires {\r\n         std::type_identity<T>());\r\n };\r\n \r\n+/** Given a uniformly random uint64_t, return a uniformly-distributed double in range [0, 1). */\r\n+double MakeUnitDouble(uint64_t uniform) noexcept;\r\n+\r\n /** Given a uniformly random uint64_t, return an exponentially distributed double with mean 1. */\r\n double MakeExponentiallyDistributed(uint64_t uniform) noexcept;\r\n \r\n```\r\n\r\n</details>",
      "created_at": "2025-12-23T20:01:41Z",
      "updated_at": "2026-02-11T16:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2644156219",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2644156219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 82,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784493271",
      "pull_request_review_id": 3605702499,
      "id": 2784493271,
      "node_id": "PRRC_kwDOABII586l9_7X",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty\n+    block.nNonce = rng.rand32();\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    while (!CheckProofOfWork(block.GetHash(), block.nBits, params.GetConsensus())) {\n+        ++block.nNonce;\n+    }\n+\n+    // Make sure we've generated a valid block",
      "path": "src/bench/block_generator.cpp",
      "position": 149,
      "original_position": 149,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Could add caveat:\n```suggestion\n    // Make sure we've generated a valid block (barring checks requiring context of other blocks)\n```",
      "created_at": "2026-02-09T20:55:32Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2784493271",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784493271"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784737375",
      "pull_request_review_id": 3605702499,
      "id": 2784737375,
      "node_id": "PRRC_kwDOABII586l-7hf",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules",
      "path": "src/bench/block_generator.cpp",
      "position": 56,
      "original_position": 56,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Might want to make OP_RETURNs very large sometimes, probably using non-linear randomness?",
      "created_at": "2026-02-09T22:02:41Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2784737375",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2784737375"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 56,
      "original_line": 56,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2786977791",
      "pull_request_review_id": 3605702499,
      "id": 2786977791,
      "node_id": "PRRC_kwDOABII586mHef_",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();\n+\n+            const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\n+            tx_in.scriptWitness.stack.reserve(witness_count);\n+            for (size_t w{0}; w < witness_count; ++w) {\n+                tx_in.scriptWitness.stack.emplace_back(rng.randbytes<uint8_t>(1 + rng.randrange(100)));\n+            }\n+\n+            tx_in.nSequence = (rng.randrange<uint8_t>(100) < 99) ? CTxIn::SEQUENCE_FINAL : rng.rand32();\n+        }\n+\n+        const size_t out_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vout.resize(out_count);\n+        for (size_t out{0}; out < out_count; ++out) {\n+            auto& tx_out{tx.vout[out]};\n+            tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\n+            tx_out.scriptPubKey = rand_script();\n+        }\n+\n+        block.vtx.push_back(MakeTransactionRef(std::move(tx)));\n+    }\n+\n+    block.nVersion = 1 + rng.randrange<int>(VERSIONBITS_LAST_OLD_BLOCK_VERSION);\n+    block.nTime = params.GenesisBlock().nTime;\n+    block.hashPrevBlock.SetNull();\n+    block.nBits = UintToArith256(params.GetConsensus().powLimit).GetCompact(); // lowest difficulty\n+    block.nNonce = rng.rand32();\n+    block.hashMerkleRoot = BlockMerkleRoot(block);\n+    while (!CheckProofOfWork(block.GetHash(), block.nBits, params.GetConsensus())) {\n+        ++block.nNonce;\n+    }\n+\n+    // Make sure we've generated a valid block\n+    {\n+        BlockValidationState validationState;\n+        const bool checked{CheckBlock(block, validationState, params.GetConsensus())};\n+        assert(checked);",
      "path": "src/bench/block_generator.cpp",
      "position": 153,
      "original_position": 153,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Naming:\n```suggestion\n        const bool valid{CheckBlock(block, validationState, params.GetConsensus())};\n        assert(valid);\n```",
      "created_at": "2026-02-10T10:00:17Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2786977791",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2786977791"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 152,
      "original_start_line": 152,
      "start_side": "RIGHT",
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787204189",
      "pull_request_review_id": 3605702499,
      "id": 2787204189,
      "node_id": "PRRC_kwDOABII586mIVxd",
      "diff_hunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_BENCH_BLOCK_GENERATOR_H\n+#define BITCOIN_BENCH_BLOCK_GENERATOR_H\n+\n+#include <kernel/chainparams.h>\n+#include <primitives/block.h>\n+#include <uint256.h>\n+\n+#include <streams.h>\n+\n+namespace benchmark {\n+struct ScriptRecipe\n+{\n+    //! per-output type probabilities ─ must sum ≤ 1.0\n+    double anchor_prob{0};\n+    double multisig_prob{0};\n+    double null_data_prob{0};\n+    double pubkey_prob{0};\n+    double pubkeyhash_prob{0};\n+    double scripthash_prob{0};\n+    double witness_v1_taproot_prob{0};\n+    double witness_v0_keyhash_prob{0};\n+    double witness_v0_scripthash_prob{0};\n+    double witness_unknown_prob{0};\n+    double nonstandard_prob{0};\n+\n+    //! tuning\n+    size_t tx_count{0};",
      "path": "src/bench/block_generator.h",
      "position": 31,
      "original_position": 31,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Could document field (unless the approach is switched to `min_tx_occupancy`, see other comment):\r\n```suggestion\r\n    size_t tx_count{0}; //!< Does not include coinbase tx. Leave at 0 to pick a random, valid number.\r\n```",
      "created_at": "2026-02-10T10:44:46Z",
      "updated_at": "2026-02-11T12:34:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2787204189",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787204189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 31,
      "original_line": 31,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792800008",
      "pull_request_review_id": 3605702499,
      "id": 2792800008,
      "node_id": "PRRC_kwDOABII586mdr8I",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());",
      "path": "src/bench/block_generator.cpp",
      "position": 104,
      "original_position": 104,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think it would be better to require that `ScriptRecipe` probabilities add up to ~1.0 and not generate random scripts as a fallback.\r\n\r\nIf we want to still generate random scripts it should be it's own `ScriptRecipe::random_prob` field IMO.\r\n\r\n<details><summary>Diff which applies on top off the tx_occupancy_limit-suggestion from other comment</summary>\r\n\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 1bedfb5f9d..1891400d20 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -68,7 +68,9 @@ auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe&\r\n \r\n     double sum{};\r\n     for (const auto& p : table | std::views::keys) sum += p;\r\n+    // Verify that probabilities add up to ~1.0.\r\n     assert(sum <= 1);\r\n+    assert(sum + 0.01 > 1.0);\r\n \r\n     return table;\r\n }\r\n@@ -100,8 +102,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n             if (probability < p) return factory();\r\n             probability -= p;\r\n         }\r\n-        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\r\n-        return CScript(raw.begin(), raw.end());\r\n+        return scriptFactory.back().second();\r\n     }};\r\n \r\n     // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\ndiff --git a/src/bench/block_generator.h b/src/bench/block_generator.h\r\nindex 4ce71f9c24..9ce7ea5ad8 100644\r\n--- a/src/bench/block_generator.h\r\n+++ b/src/bench/block_generator.h\r\n@@ -35,16 +35,16 @@ struct ScriptRecipe\r\n /* purely legacy outputs, useful for pre-SegWit baselines */\r\n inline constexpr ScriptRecipe kLegacy{\r\n     .anchor_prob = 0.00,\r\n-    .multisig_prob = 0.05,\r\n-    .null_data_prob = 0.005,\r\n-    .pubkey_prob = 0.10,\r\n-    .pubkeyhash_prob = 0.20,\r\n-    .scripthash_prob = 0.10,\r\n-    .witness_v1_taproot_prob = 0.00,\r\n-    .witness_v0_keyhash_prob = 0.00,\r\n-    .witness_v0_scripthash_prob = 0.00,\r\n-    .witness_unknown_prob = 0.00,\r\n-    .nonstandard_prob = 0.005,\r\n+    .multisig_prob = 0.10,\r\n+    .null_data_prob = 0.01,\r\n+    .pubkey_prob = 0.20,\r\n+    .pubkeyhash_prob = 0.43,\r\n+    .scripthash_prob = 0.23,\r\n+    .witness_v1_taproot_prob = 0,\r\n+    .witness_v0_keyhash_prob = 0,\r\n+    .witness_v0_scripthash_prob = 0,\r\n+    .witness_unknown_prob = 0,\r\n+    .nonstandard_prob = 0.025,\r\n \r\n     .tx_occupancy_limit = 0.8,\r\n };\r\n@@ -53,13 +53,13 @@ inline constexpr ScriptRecipe kLegacy{\r\n inline constexpr ScriptRecipe kWitness{\r\n     .anchor_prob = 0.001,\r\n     .multisig_prob = 0.005,\r\n-    .null_data_prob = 0.002,\r\n+    .null_data_prob = 0.01,\r\n     .pubkey_prob = 0.001,\r\n     .pubkeyhash_prob = 0.02,\r\n     .scripthash_prob = 0.01,\r\n-    .witness_v1_taproot_prob = 0.20,\r\n-    .witness_v0_keyhash_prob = 0.25,\r\n-    .witness_v0_scripthash_prob = 0.05,\r\n+    .witness_v1_taproot_prob = 0.35,\r\n+    .witness_v0_keyhash_prob = 0.40,\r\n+    .witness_v0_scripthash_prob = 0.16,\r\n     .witness_unknown_prob = 0.02,\r\n     .nonstandard_prob = 0.02,\r\n \r\n```\r\n\r\n</details>",
      "created_at": "2026-02-11T11:37:42Z",
      "updated_at": "2026-02-11T16:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2792800008",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792800008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": 103,
      "original_start_line": 103,
      "start_side": "RIGHT",
      "line": 104,
      "original_line": 104,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792847114",
      "pull_request_review_id": 3605702499,
      "id": 2792847114,
      "node_id": "PRRC_kwDOABII586md3cK",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();",
      "path": "src/bench/block_generator.cpp",
      "position": 117,
      "original_position": 117,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How about generating semi-realistic script sigs / unlock scripts?\r\n\r\n<details><summary>WIP diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/block_generator.cpp b/src/bench/block_generator.cpp\r\nindex 1891400d20..4ee174f8f5 100644\r\n--- a/src/bench/block_generator.cpp\r\n+++ b/src/bench/block_generator.cpp\r\n@@ -40,39 +40,164 @@ CPubKey RandPub(FastRandomContext& rng)\r\n     return CPubKey(pubkey.begin(), pubkey.end());\r\n }\r\n \r\n-auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\r\n+struct FactoryEntry {\r\n+    const double prob;\r\n+    const std::function<CScript()> lock_script;\r\n+    const std::function<CScript()> unlock_script;\r\n+    const std::function<CScript()> witness_script; // TODO write + use field\r\n+};\r\n+\r\n+auto createScriptFactory(FastRandomContext& rng, const CExtKey& xprv, const benchmark::ScriptRecipe& rec)\r\n {\r\n-    std::array<std::pair<double, std::function<CScript()>>, 11> table{\r\n-        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\r\n-        std::pair{rec.multisig_prob, [&] {\r\n-            const size_t keys_count{1 + rng.randrange<size_t>(15)};\r\n-            const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n-            std::vector<CPubKey> keys;\r\n-            keys.reserve(keys_count);\r\n-            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\r\n-            return GetScriptForMultisig(required, keys);\r\n-        }},\r\n-        {rec.null_data_prob, [&] {\r\n-            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\r\n-            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\r\n-        }},\r\n-        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\r\n-        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\r\n-        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\r\n-        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\r\n-        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\r\n-        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\r\n-        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\r\n-        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\r\n+    FactoryEntry table[] = {\r\n+        {\r\n+            .prob = rec.anchor_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(PayToAnchor{}); },\r\n+            .unlock_script = {}, // TODO: confirm correctness\r\n+            .witness_script = {}, // TODO: confirm correctness\r\n+        },\r\n+        {\r\n+            .prob = rec.multisig_prob,\r\n+            .lock_script = [&] {\r\n+                const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n+                const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n+                std::vector<CPubKey> keys;\r\n+                keys.reserve(keys_count);\r\n+                for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\r\n+                return GetScriptForMultisig(required, keys);\r\n+            },\r\n+            .unlock_script = [&] {\r\n+                const size_t keys_count{1 + rng.randrange<size_t>(MAX_PUBKEYS_PER_MULTISIG)};\r\n+                const size_t required{1 + rng.randrange<size_t>(keys_count)};\r\n+                std::vector<CKey> priv_keys;\r\n+                priv_keys.reserve(keys_count);\r\n+                std::vector<CPubKey> pub_keys;\r\n+                pub_keys.reserve(keys_count);\r\n+\r\n+                for (size_t i{}; i < keys_count; ++i) {\r\n+                    CExtKey child_xprv;\r\n+                    Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                    const CKey priv{child_xprv.key};\r\n+                    priv_keys.push_back(priv);\r\n+                    pub_keys.push_back(priv.GetPubKey());\r\n+                }\r\n+\r\n+                const CScript prevout_lock_script{GetScriptForMultisig(required, pub_keys)};\r\n+\r\n+                CScript s{OP_0}; // Extra required dummy value for CHECKMULTISIG.\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                for (size_t i{}; i < required; ++i) {\r\n+                    std::vector<uint8_t> sig;\r\n+                    Assert(priv_keys[i].Sign(sighash, sig));\r\n+                    sig.push_back(sighash_type);\r\n+                    s << sig;\r\n+                }\r\n+\r\n+                return s;\r\n+            },\r\n+            .witness_script = {}, // TODO: confirm correctness\r\n+        },\r\n+        {\r\n+            .prob = rec.null_data_prob,\r\n+            .lock_script = [&] {\r\n+                const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\r\n+                return CScript{} << OP_RETURN << rng.randbytes(len);\r\n+            },\r\n+            .unlock_script = {},  // Unspendable\r\n+            .witness_script = {}, // Unspendable\r\n+        },\r\n+        {\r\n+            .prob = rec.pubkey_prob,\r\n+            .lock_script = [&] { return GetScriptForRawPubKey(RandPub(rng)); },\r\n+            .unlock_script = [&] {\r\n+                CExtKey child_xprv;\r\n+                Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                const CKey priv{child_xprv.key};\r\n+                const CPubKey pub{priv.GetPubKey()};\r\n+                const CScript prevout_lock_script{GetScriptForRawPubKey(pub)};\r\n+\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                std::vector<uint8_t> sig;\r\n+                Assert(priv.Sign(sighash, sig));\r\n+                sig.push_back(sighash_type);\r\n+\r\n+                return CScript{} << sig;\r\n+            },\r\n+            .witness_script = {},\r\n+        },\r\n+        {\r\n+            .prob = rec.pubkeyhash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(PKHash(RandPub(rng))); },\r\n+            .unlock_script = [&] {\r\n+                CExtKey child_xprv;\r\n+                Assert(xprv.Derive(child_xprv, rng.rand<unsigned int>()));\r\n+                const CKey priv{child_xprv.key};\r\n+                const CPubKey pub{priv.GetPubKey()};\r\n+                const CScript prevout_lock_script{GetScriptForRawPubKey(pub)};\r\n+\r\n+                const uint8_t sighash_type{SIGHASH_ALL};\r\n+                CMutableTransaction tx;\r\n+                tx.vin.emplace_back(COutPoint{}, CScript{}, rng.rand32());\r\n+                const uint256 sighash{SignatureHash(prevout_lock_script, tx, 0, sighash_type, CAmount{0}, SigVersion::BASE)};\r\n+                std::vector<uint8_t> sig;\r\n+                Assert(priv.Sign(sighash, sig));\r\n+                sig.push_back(sighash_type);\r\n+\r\n+                return CScript{} << sig << pub;\r\n+            },\r\n+            .witness_script = {},\r\n+        },\r\n+        {\r\n+            .prob = rec.scripthash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v1_taproot_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v0_keyhash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_v0_scripthash_prob,\r\n+            .lock_script = [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.witness_unknown_prob,\r\n+            .lock_script = [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n+        {\r\n+            .prob = rec.nonstandard_prob,\r\n+            .lock_script = [&] { return CScript() << OP_TRUE; },\r\n+            .unlock_script = {}, // TODO\r\n+            .witness_script = {}, // TODO\r\n+        },\r\n     };\r\n \r\n     double sum{};\r\n-    for (const auto& p : table | std::views::keys) sum += p;\r\n+    for (const auto& e : table) sum += e.prob;\r\n     // Verify that probabilities add up to ~1.0.\r\n     assert(sum <= 1);\r\n     assert(sum + 0.01 > 1.0);\r\n \r\n-    return table;\r\n+    return std::to_array(table);\r\n }\r\n \r\n CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\r\n@@ -80,6 +205,10 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n     assert(params.IsTestChain());\r\n     FastRandomContext rng{seed};\r\n \r\n+    CExtKey xprv;\r\n+    constexpr auto xprv_seed{std::to_array({std::byte{'2'}, std::byte{'1'}})};\r\n+    xprv.SetSeed(xprv_seed);\r\n+\r\n     assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\r\n     const auto tx_occupancy_limit{rec.tx_occupancy_limit != 0.0 ? rec.tx_occupancy_limit : MakeUnitDouble(rng.rand64())};\r\n \r\n@@ -95,14 +224,33 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         block.vtx.push_back(MakeTransactionRef(std::move(cb)));\r\n     }\r\n \r\n-    auto scriptFactory{createScriptFactory(rng, rec)};\r\n-    auto rand_script{[&] {\r\n+    auto scriptFactory{createScriptFactory(rng, xprv, rec)};\r\n+    auto rand_lock_script{[&] {\r\n         double probability{MakeUnitDouble(rng.rand64())};\r\n-        for (const auto& [p, factory] : scriptFactory) {\r\n-            if (probability < p) return factory();\r\n-            probability -= p;\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (probability < entry.prob) return entry.lock_script();\r\n+            probability -= entry.prob;\r\n+        }\r\n+        return scriptFactory.back().lock_script();\r\n+    }};\r\n+    const double unlock_script_prob{[&] {\r\n+        double sum{0.0};\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (entry.unlock_script) sum += entry.prob;\r\n+        }\r\n+        return sum;\r\n+    }()};\r\n+    auto rand_unlock_script{[&] {\r\n+        const FactoryEntry* last_unlock_entry{nullptr};\r\n+        double probability{MakeUnitDouble(rng.rand64()) * unlock_script_prob};\r\n+        for (const auto& entry : scriptFactory) {\r\n+            if (!entry.unlock_script) continue;\r\n+            last_unlock_entry = &entry;\r\n+            if (probability < entry.prob) return entry.unlock_script();\r\n+            probability -= entry.prob;\r\n         }\r\n-        return scriptFactory.back().second();\r\n+        assert(last_unlock_entry);\r\n+        return last_unlock_entry->unlock_script();\r\n     }};\r\n \r\n     // Add 2 bytes to account for compact size representation of vtx vector increasing from 1 to 3 bytes.\r\n@@ -120,7 +268,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         for (size_t in{0}; in < in_count; ++in) {\r\n             auto& tx_in{tx.vin[in]};\r\n             tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\r\n-            tx_in.scriptSig = rand_script();\r\n+            tx_in.scriptSig = rand_unlock_script();\r\n \r\n             const size_t witness_count{GeomCount(rng, rec.geometric_base_prob)};\r\n             tx_in.scriptWitness.stack.reserve(witness_count);\r\n@@ -136,7 +284,7 @@ CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec\r\n         for (size_t out{0}; out < out_count; ++out) {\r\n             auto& tx_out{tx.vout[out]};\r\n             tx_out.nValue = rng.randrange(GeomCount(rng, rec.geometric_base_prob) * COIN);\r\n-            tx_out.scriptPubKey = rand_script();\r\n+            tx_out.scriptPubKey = rand_lock_script();\r\n         }\r\n \r\n         block_size_no_witness += ::GetSerializeSize(TX_NO_WITNESS(tx));\r\ndiff --git a/src/bench/checkblock.cpp b/src/bench/checkblock.cpp\r\nindex 2bc03818ac..23354ba39c 100644\r\n--- a/src/bench/checkblock.cpp\r\n+++ b/src/bench/checkblock.cpp\r\n@@ -7,6 +7,7 @@\r\n #include <chainparams.h>\r\n #include <common/args.h>\r\n #include <consensus/validation.h>\r\n+#include <key.h>\r\n #include <primitives/block.h>\r\n #include <primitives/transaction.h>\r\n #include <streams.h>\r\n@@ -16,7 +17,6 @@\r\n #include <cassert>\r\n #include <cstddef>\r\n #include <memory>\r\n-#include <vector>\r\n \r\n // These are the two major time-sinks which happen after we have fully received\r\n // a block off the wire, but before we can relay the block on to peers using\r\n@@ -24,6 +24,7 @@\r\n \r\n static void DeserializeBlockTest(benchmark::Bench& bench)\r\n {\r\n+    ECC_Context ec_context;\r\n     auto stream{benchmark::GetBlockData()};\r\n     std::byte a{0};\r\n     stream.write({&a, 1}); // Prevent compaction\r\n@@ -37,6 +38,7 @@ static void DeserializeBlockTest(benchmark::Bench& bench)\r\n \r\n static void DeserializeAndCheckBlockTest(benchmark::Bench& bench)\r\n {\r\n+    ECC_Context ec_context;\r\n     const auto& chain_params{CChainParams::RegTest(CChainParams::RegTestOptions{})};\r\n     auto stream{benchmark::GetBlockData(*chain_params)};\r\n     std::byte a{0};\r\n```\r\n\r\n</details>",
      "created_at": "2026-02-11T11:49:09Z",
      "updated_at": "2026-02-11T16:38:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2792847114",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2792847114"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 117,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793347220",
      "pull_request_review_id": 3784878585,
      "id": 2793347220,
      "node_id": "PRRC_kwDOABII586mfxiU",
      "diff_hunk": "@@ -0,0 +1,177 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <addresstype.h>\n+#include <bench/block_generator.h>\n+#include <consensus/merkle.h>\n+#include <pow.h>\n+#include <primitives/block.h>\n+#include <random.h>\n+#include <script/script.h>\n+#include <script/solver.h>\n+#include <streams.h>\n+#include <test/util/transaction_utils.h>\n+#include <validation.h>\n+#include <versionbits.h>\n+\n+#include <algorithm>\n+#include <functional>\n+#include <limits>\n+#include <ranges>\n+#include <vector>\n+\n+using namespace util::hex_literals;\n+\n+namespace {\n+size_t GeomCount(FastRandomContext& rng, double thresh_prob)\n+{\n+    size_t n{1};\n+    while (rng.randrange<uint8_t>(100) < thresh_prob * 100) {\n+        ++n;\n+    }\n+    return n;\n+}\n+\n+CPubKey RandPub(FastRandomContext& rng)\n+{\n+    auto pubkey{rng.randbytes<CPubKey::COMPRESSED_SIZE, unsigned char>()};\n+    pubkey[0] = rng.randbool() ? 0x02 : 0x03;\n+    return CPubKey(pubkey.begin(), pubkey.end());\n+}\n+\n+auto createScriptFactory(FastRandomContext& rng, const benchmark::ScriptRecipe& rec)\n+{\n+    std::array<std::pair<double, std::function<CScript()>>, 11> table{\n+        std::pair{rec.anchor_prob, [&] { return GetScriptForDestination(PayToAnchor{}); }},\n+        std::pair{rec.multisig_prob, [&] {\n+            const size_t keys_count{1 + rng.randrange<size_t>(15)};\n+            const size_t required{1 + rng.randrange<size_t>(keys_count)};\n+            std::vector<CPubKey> keys;\n+            keys.reserve(keys_count);\n+            for (size_t i{}; i < keys_count; ++i) keys.emplace_back(RandPub(rng));\n+            return GetScriptForMultisig(required, keys);\n+        }},\n+        {rec.null_data_prob, [&] {\n+            const auto len{1 + rng.randrange<size_t>(90)}; // sometimes exceed policy rules\n+            return CScript() << OP_RETURN << rng.randbytes<unsigned char>(len);\n+        }},\n+        std::pair{rec.pubkey_prob, [&] { return GetScriptForRawPubKey(RandPub(rng)); }},\n+        std::pair{rec.pubkeyhash_prob, [&] { return GetScriptForDestination(PKHash(RandPub(rng))); }},\n+        std::pair{rec.scripthash_prob, [&] { return GetScriptForDestination(ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_v1_taproot_prob, [&] { return GetScriptForDestination(WitnessV1Taproot(XOnlyPubKey(RandPub(rng)))); }},\n+        std::pair{rec.witness_v0_keyhash_prob, [&] { return GetScriptForDestination(WitnessV0KeyHash(RandPub(rng))); }},\n+        std::pair{rec.witness_v0_scripthash_prob, [&] { return GetScriptForDestination(WitnessV0ScriptHash(CScript() << OP_TRUE)); }},\n+        std::pair{rec.witness_unknown_prob, [&] { return CScript() << OP_2 << rng.randbytes<uint8_t>(32); }},\n+        std::pair{rec.nonstandard_prob, [&] { return CScript() << OP_TRUE; }},\n+    };\n+\n+    double sum{};\n+    for (const auto& p : table | std::views::keys) sum += p;\n+    assert(sum <= 1);\n+\n+    return table;\n+}\n+\n+CBlock BuildBlock(const CChainParams& params, const benchmark::ScriptRecipe& rec, const uint256& seed)\n+{\n+    assert(params.IsTestChain());\n+    FastRandomContext rng{seed};\n+\n+    assert(rec.geometric_base_prob >= 0 && rec.geometric_base_prob <= 1);\n+    const auto tx_count{rec.tx_count ? rec.tx_count : 1000 + rng.randrange(2000)};\n+\n+    CBlock block{};\n+    block.vtx.reserve(1 + tx_count);\n+\n+    // coinbase\n+    {\n+        CMutableTransaction cb;\n+        cb.vin = {CTxIn(COutPoint())};\n+        cb.vin[0].scriptSig = CScript() << CScriptNum(rng.randrange(1'000'000)) << OP_0;\n+        cb.vout = {CTxOut(rng.randrange(50 * COIN), CScript() << OP_TRUE)};\n+        block.vtx.push_back(MakeTransactionRef(std::move(cb)));\n+    }\n+\n+    auto scriptFactory{createScriptFactory(rng, rec)};\n+    auto rand_script{[&] {\n+        double probability{rng.rand64() * (1.0 / std::numeric_limits<uint64_t>::max())};\n+        for (const auto& [p, factory] : scriptFactory) {\n+            if (probability < p) return factory();\n+            probability -= p;\n+        }\n+        const auto raw{rng.randbytes<uint8_t>(1 + rng.randrange(100))};\n+        return CScript(raw.begin(), raw.end());\n+    }};\n+\n+    for (size_t i{0}; i < tx_count; ++i) {\n+        CMutableTransaction tx;\n+        tx.version = 1 + rng.randrange<int>(3);\n+        tx.nLockTime = (rng.randrange<uint8_t>(100) < 90) ? 0 : rng.rand32();\n+\n+        const size_t in_count{GeomCount(rng, rec.geometric_base_prob)};\n+        tx.vin.resize(in_count);\n+        for (size_t in{0}; in < in_count; ++in) {\n+            auto& tx_in{tx.vin[in]};\n+            tx_in.prevout = {Txid::FromUint256(rng.rand256()), uint32_t(GeomCount(rng, rec.geometric_base_prob))};\n+            tx_in.scriptSig = rand_script();",
      "path": "src/bench/block_generator.cpp",
      "position": 117,
      "original_position": 117,
      "commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "original_commit_id": "b5b57cdf396d8945612fcb2d51e530475db0d87d",
      "in_reply_to_id": 2792847114,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm happy to continue working in this direction of more realistic scripts, but wanted to see what you thought before \"helping\" with something you might disagree with.",
      "created_at": "2026-02-11T13:38:32Z",
      "updated_at": "2026-02-11T13:38:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32554#discussion_r2793347220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2793347220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32554"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 117,
      "original_line": 117,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390",
    "id": 969286381,
    "node_id": "PR_kwDOABII5845xiLt",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/25390",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/25390.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/25390.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
    "number": 25390,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Introduce a generic container that provides a thread-safe access to any object by using a mutex which is acquired every time the object accessed.\r\n\r\nFor example:\r\n\r\n```cpp\r\nSynced<std::unordered_map<int, int>> m{{3, 9}, {4, 16}};\r\n\r\n{\r\n    SYNCED_LOCK(m, m_locked);\r\n\r\n    // m_locked represents the internal object, i.e. std::unordered_map,\r\n    // while m_locked is in scope the internal mutex is locked.\r\n\r\n    auto it = m_locked->find(3);\r\n    if (it != m_locked->end()) {\r\n        std::cout << it->second << std::endl;\r\n    }\r\n\r\n    for (auto& [k, v] : *m_locked) {\r\n        std::cout << k << \", \" << v << std::endl;\r\n    }\r\n}\r\n\r\nWITH_SYNCED_LOCK(m, p, p->emplace(5, 25));\r\n```\r\n\r\nRemove the global mutexes `g_maplocalhost_mutex`, `g_deadline_timers_mutex`, `cs_dir_locks`, `g_loading_wallet_mutex`, `g_wallet_release_mutex` and use `Synced<T>` instead.\r\n\r\n## Benefits\r\n\r\n_copied from a [comment below](https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1169788319):_\r\n\r\nThe `Synced<T>` abstraction is similar to what is suggested in [this comment](https://github.com/bitcoin/bitcoin/pull/24931#discussion_r890636987) but it does so in a generic way to avoid code repetition. Its benefit is:\r\n\r\n1. It avoids code repetition at the implementation sites. See [PR#26151](https://github.com/bitcoin/bitcoin/pull/26151) for a live example. Namely this:\r\n\r\n<details>\r\n<summary>Lots of repetitions (92 lines)</summary>\r\n\r\n```cpp\r\nclass Foo\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Foo::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<int> m_data;\r\n};\r\n\r\nclass Bar\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Bar::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<std::string> m_data;\r\n};\r\n\r\nclass Baz\r\n{\r\npublic:\r\n    void Insert(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.insert(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Baz::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::set<std::string> m_data;\r\n};\r\n```\r\n</details>\r\n\r\nbecomes this:\r\n\r\n<details>\r\n<summary>Short (3 lines)</summary>\r\n\r\n```cpp\r\nSynced<std::vector<int>> Foo;\r\nSynced<std::vector<std::string>> Bar;\r\nSynced<std::set<std::string>> Baz;\r\n```\r\n</details>\r\n\r\n2. The mutex is properly encapsulated. With a global mutex and a global variable annotated with `GUARDED_BY()` it is indeed not possible to add new code that accesses the variable without protection (if using Clang and `-Wthread-safety-analysis` and `-Werror`), but it is possible to abuse the mutex and start using it to protect some more, possibly unrelated stuff (we already have this in the current code).\r\n",
    "labels": [
      {
        "id": 98279177,
        "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
        "name": "RPC/REST/ZMQ",
        "color": "0052cc",
        "default": false
      },
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2022-06-16T12:46:53Z",
    "updated_at": "2023-07-22T14:06:27Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "6259c8bbc272408cb6e73275b5009c04480c5c1c",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "vasild:ThreadSafePtr",
      "ref": "ThreadSafePtr",
      "sha": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 120608826,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjA2MDg4MjY=",
        "name": "bitcoin",
        "full_name": "vasild/bitcoin",
        "owner": {
          "login": "vasild",
          "id": 266751,
          "node_id": "MDQ6VXNlcjI2Njc1MQ==",
          "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/vasild",
          "html_url": "https://github.com/vasild",
          "followers_url": "https://api.github.com/users/vasild/followers",
          "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
          "organizations_url": "https://api.github.com/users/vasild/orgs",
          "repos_url": "https://api.github.com/users/vasild/repos",
          "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/vasild/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/vasild/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/vasild/bitcoin",
        "archive_url": "https://api.github.com/repos/vasild/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/vasild/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/vasild/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/vasild/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/vasild/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/vasild/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/vasild/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/vasild/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/vasild/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/vasild/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/vasild/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/vasild/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/vasild/bitcoin/events",
        "forks_url": "https://api.github.com/repos/vasild/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/vasild/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/vasild/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/vasild/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/vasild/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/vasild/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/vasild/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/vasild/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/vasild/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/vasild/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/vasild/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/vasild/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/vasild/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/vasild/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/vasild/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/vasild/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:vasild/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/vasild/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/vasild/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/vasild/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/vasild/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/vasild/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/vasild/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/vasild/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/vasild/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/vasild/bitcoin/hooks",
        "svn_url": "https://github.com/vasild/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 213770,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-07-20T13:21:06Z",
        "created_at": "2018-02-07T11:52:47Z",
        "updated_at": "2023-01-31T16:56:52Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "78a983f597af224e017f522443112cec81422fe6",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35427,
        "stargazers_count": 70470,
        "watchers_count": 70470,
        "size": 235920,
        "default_branch": "master",
        "open_issues_count": 654,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-07-22T14:21:53Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-07-22T14:45:06Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 131,
    "deletions": 71,
    "changed_files": 8,
    "commits": 10,
    "review_comments": 46,
    "comments": 25
  },
  "events": [
    {
      "event": "review_requested",
      "id": 6820901534,
      "node_id": "RRE_lADOABII585L6FX5zwAAAAGWjrKe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6820901534",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T13:08:11Z",
      "requested_reviewer": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 6820901551,
      "node_id": "RRE_lADOABII585L6FX5zwAAAAGWjrKv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6820901551",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T13:08:11Z",
      "requested_reviewer": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "labeled",
      "id": 6820993731,
      "node_id": "LE_lADOABII585L6FX5zwAAAAGWkBrD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6820993731",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T13:20:15Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "labeled",
      "id": 6820993732,
      "node_id": "LE_lADOABII585L6FX5zwAAAAGWkBrE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6820993732",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T13:20:15Z",
      "label": {
        "name": "RPC/REST/ZMQ",
        "color": "0052cc"
      }
    },
    {
      "event": "reviewed",
      "id": 1009041664,
      "node_id": "PRR_kwDOABII5848JMEA",
      "url": null,
      "actor": null,
      "commit_id": "e577177a339d5a833ba82c9656fa0291ad05b001",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1009041664",
      "submitted_at": "2022-06-16T13:28:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "commented",
      "id": 1157765950,
      "node_id": "IC_kwDOABII585FAhs-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1157765950",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T15:04:02Z",
      "updated_at": "2023-07-22T14:06:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1557425242) |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1009041664), [ajtowns](https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1145740612) |\n| Stale ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1390434676) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28078](https://github.com/bitcoin/bitcoin/pull/28078) (net, refactor: remove unneeded exports, use helpers over low-level code, use optional by jonatack)\n* [#28075](https://github.com/bitcoin/bitcoin/pull/28075) (util: Remove DirIsWritable, GetUniquePath by MarcoFalke)\n* [#25722](https://github.com/bitcoin/bitcoin/pull/25722) (refactor: Use util::Result class for wallet loading by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1157765950",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "commented",
      "id": 1157945376,
      "node_id": "IC_kwDOABII585FBNgg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1157945376",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-16T17:28:36Z",
      "updated_at": "2022-06-16T17:28:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "This seems like a potentially useful alternative to clang thread safety annotations. The `ThreadSafePtr<T>` class forces code to lock a mutex when accessing data, just like TSA annotations do, except unlike TSA annotations, it doesn't rely on a nonstandard compiler extension, or suffer from quirks that come from doing a limited static analysis.\r\n\r\n`ThreadSafePtr<T>` is obviously not a complete substitute for thread safety annotations since it only handles the simple case where a single non-recursive Mutex is used to protect access to a single variable. But the variable can have any C++ type (primitive, container, or struct), so it's probably flexible enough for a lot of cases.\r\n\r\nI don't think the `ThreadSafePtr<T>` is the best name because `xxx_ptr<T>` implies the type is some kind of lightweight reference to the `T`, not a container which holds the `T`. I would call it something like `Synced<T>` or `LockedData<T>`. (An analogy here would be `std::optional<T>`, which is not called `std::optional_ptr<T>`, even though it has `*` and `->` members, because it's purpose is to be a container, not a pointer. The class is named after what it's used for not what kind of members it has.)",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1157945376",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "reviewed",
      "id": 1009459470,
      "node_id": "PRR_kwDOABII5848KyEO",
      "url": null,
      "actor": null,
      "commit_id": "e577177a339d5a833ba82c9656fa0291ad05b001",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1009459470",
      "submitted_at": "2022-06-16T18:02:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "commented",
      "id": 1158434634,
      "node_id": "IC_kwDOABII585FDE9K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1158434634",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-17T02:55:13Z",
      "updated_at": "2022-06-17T02:55:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "This seems like a non-starter to me? It's not even able to detect obvious double locks at compile-time:\r\n\r\n```c++\r\n    ThreadSafePtr<std::map<int, int>> m;\r\n    m->emplace(5, 25);\r\n    {\r\n        auto m_locked = *m;\r\n        m_locked->emplace(6, 36);\r\n        m->emplace(7, 49);  // double lock\r\n\r\n        auto m_locked2 = *m; // double lock\r\n        m_locked->emplace(9, 81);\r\n        m_locked2->emplace(10, 100);\r\n    }\r\n```\r\n\r\nEven if it weren't worse at catching bugs, it doesn't seem like an improvement over writing:\r\n\r\n```c++\r\n    Mutex mut;\r\n    std::map<int, int> m GUARDED_BY(mut);\r\n\r\n    WITH_LOCK(mut, m.emplace(5, 25));\r\n    {\r\n        LOCK(mut);\r\n        m.emplace(6, 36);\r\n        m.emplace(7, 49);  // no double lock\r\n\r\n        LOCK(mut); // double lock - detected at compile time\r\n        m.emplace(9, 81);\r\n        m.emplace(10, 100);\r\n    }\r\n```",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158434634",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "commented",
      "id": 1158475359,
      "node_id": "IC_kwDOABII585FDO5f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1158475359",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-17T04:21:50Z",
      "updated_at": "2022-06-17T04:21:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It's not even able to detect obvious double locks at compile-time: \r\n\r\nI assume it can be annotated just like any other lock. Agree implementation should fix this, though.\r\n\r\n> Even if it weren't worse at catching bugs, it doesn't seem like an improvement over writing\r\n\r\nWell one improvement is that it enforces locking on all compilers, unlike the clang annotations. The code itself doesn't seem much better or worse in this case for this very simple data structure, but it's probably is worth experimenting with for chains and chainstates and mempools, etc to be able to avoid logic bugs, distinguish different uses of cs_main for different purposes, and not just have LOCK(cs_main) everywhere what no indication about what exactly is being locked or why.\r\n\r\nLooking at your examples, though I would even more want to replace the `*m` syntax with `m.Lock()` as suggested previously to make usage more obvious.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158475359",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6840954196,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGXwK1U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6840954196",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-20T16:46:35Z"
    },
    {
      "event": "commented",
      "id": 1160665973,
      "node_id": "IC_kwDOABII585FLlt1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1160665973",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-20T16:54:39Z",
      "updated_at": "2022-06-20T16:54:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "`e577177a33...a870b2b891`: address suggestions and remove optional commit that was a kind of scope creep for this PR - `net: simplify logic around reachable networks and -onlynet`, it will make it in a followup.\r\n\r\n@ryanofsky very insightful review, thanks for the suggestions!\r\n\r\n> This seems like a potentially useful alternative to clang thread safety annotations. The `ThreadSafePtr<T>` class forces code to lock a mutex when accessing data, just like TSA annotations do, except...\r\n\r\nHmm, right, I did not think of this from that perspective. In addition - TSA do not actually \"force\" anything, they emit a mere warning if compiled with `clang`. They do nothing for gcc. And if `-Werror` is not used to turn the warning into an error, then they can be missed/ignored.\r\n\r\nI see this as a complementary to TSA.\r\n\r\n> I don't think the `ThreadSafePtr<T>` is the best name because `xxx_ptr<T>` implies the type is some kind of lightweight reference to the `T`, not a container which holds the `T`. I would call it something like `Synced<T>` ...\r\n\r\nRenamed to `Synced<T>`, thanks!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1160665973",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "mentioned",
      "id": 6840991617,
      "node_id": "MEE_lADOABII585L6FX5zwAAAAGXwT-B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6840991617",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-20T16:54:40Z"
    },
    {
      "event": "subscribed",
      "id": 6840991619,
      "node_id": "SE_lADOABII585L6FX5zwAAAAGXwT-D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6840991619",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-20T16:54:40Z"
    },
    {
      "event": "commented",
      "id": 1164151295,
      "node_id": "IC_kwDOABII585FY4n_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164151295",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T09:06:42Z",
      "updated_at": "2022-06-23T11:17:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I assume it can be annotated just like any other lock. Agree implementation should fix this, though.\r\n\r\nI think you'd have to mark the `Synced` object as being lock itself (`LOCKABLE`), and mark the `Proxy` class as being a RAII guard (`SCOPED_LOCKABLE`), with the constructor/destructor annotated appropriately (`EXCLUSIVE_LOCK_FUNCTION(ref_to_scoped_obj)` and `UNLOCK_FUNCTION()`), and with the functions that create the Proxy (`Lock` and `operator->`) annotated with negative constraints (`EXCLUSIVE_LOCKS_REQUIRED(!this)`)? I've got pretty low confidence that that will actually work as hoped/expected though...\r\n\r\n> Well one improvement is that it enforces locking on all compilers, unlike the clang annotations.\r\n\r\nWe already enforce locking is correct via compiling with clang in CI; it's certainly an improvement to get those warnings earlier for anyone who's not using clang or doesn't have the options enabled, but [EDIT: oops, didn't finish the thought:] not at the cost of losing some checks entirely.\r\n",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1164151295",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "commented",
      "id": 1164194609,
      "node_id": "IC_kwDOABII585FZDMx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1164194609",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-23T09:49:07Z",
      "updated_at": "2022-06-23T09:49:07Z",
      "author_association": "MEMBER",
      "body": "I don't see any obvious benefit here, looking at the comparison with current code in https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158434634 ",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1164194609",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6900955645,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGbVDn9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6900955645",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T10:01:18Z"
    },
    {
      "event": "commented",
      "id": 1169788319,
      "node_id": "IC_kwDOABII585FuY2f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169788319",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T10:04:33Z",
      "updated_at": "2022-07-13T06:29:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "`a870b2b891...7b05e787cf`: use `LOCK(synced)` at call sites and remove more `GlobalMutex`es.\r\n\r\nThe benefit is not at the call sites - they can use different flavors of syntax sugar but all of them more or less boil down to the same thing. I changed it to use `{ LOCK(foo); foo->Method1(); foo->Method2(); ... }` so that it is not possible to misuse like @ajtowns suggested [above](https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158434634).\r\n\r\nThe `Synced<T>` abstraction is similar to what is suggested in [this comment](https://github.com/bitcoin/bitcoin/pull/24931#discussion_r890636987) but it does so in a generic way to avoid code repetition. Its benefit is twofold:\r\n\r\n1. It avoids code repetition at the implementation sites. Namely this:\r\n\r\n<details>\r\n<summary>Lots of repetitions (92 lines)</summary>\r\n\r\n```cpp\r\nclass Foo\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Foo::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<int> m_data;\r\n};\r\n\r\nclass Bar\r\n{\r\npublic:\r\n    void PushBack(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.push_back(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Bar::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::vector<std::string> m_data;\r\n};\r\n\r\nclass Baz\r\n{\r\npublic:\r\n    void Insert(x)\r\n    {\r\n        LOCK(m_mutex);\r\n        m_data.insert(x);\r\n    }\r\n\r\n    size_t Size()\r\n    {\r\n        LOCK(m_mutex);\r\n        return m_data.size();\r\n    }\r\n\r\n    // maybe also other methods if needed...\r\n\r\n    auto Lock()\r\n    {\r\n        return DebugLock<Mutex>{m_mutex, \"Baz::m_mutex\", __FILE__, __LINE__};\r\n    }\r\n\r\nprivate:\r\n    Mutex m_mutex;\r\n    std::set<std::string> m_data;\r\n};\r\n```\r\n</details>\r\n\r\nbecomes this:\r\n\r\n<details>\r\n<summary>Short (3 lines)</summary>\r\n\r\n```cpp\r\nSynced<std::vector<int>> Foo;\r\nSynced<std::vector<std::string>> Bar;\r\nSynced<std::set<std::string>> Baz;\r\n```\r\n</details>\r\n\r\n2. The mutex is properly encapsulated. With a global mutex and a global variable annotated with `GUARDED_BY()` it is indeed not possible to add new code that accesses the variable without protection (if using Clang and `-Wthread-safety-analysis` and `-Werror`), but it is possible to abuse the mutex and start using it to protect some more, possibly unrelated stuff (we already have this in the current code).\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1169788319",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "mentioned",
      "id": 6900979995,
      "node_id": "MEE_lADOABII585L6FX5zwAAAAGbVJkb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6900979995",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T10:04:33Z"
    },
    {
      "event": "subscribed",
      "id": 6900980000,
      "node_id": "SE_lADOABII585L6FX5zwAAAAGbVJkg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6900980000",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T10:04:33Z"
    },
    {
      "event": "commented",
      "id": 1169797417,
      "node_id": "IC_kwDOABII585FubEp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169797417",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T10:13:30Z",
      "updated_at": "2022-06-29T10:13:30Z",
      "author_association": "MEMBER",
      "body": "Ah, looks like this is `std::atomic` for structs/classes then",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1169797417",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "commented",
      "id": 1169846509,
      "node_id": "IC_kwDOABII585FunDt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1169846509",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-29T11:06:41Z",
      "updated_at": "2022-06-29T11:07:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Ah, looks like this is `std::atomic` for structs/classes then\r\n\r\nRight, kind of. `std::atomic` can be used for any trivially copyable structs/classes too and if necessary it will use a mutex internally. The difference is that reading from an `atomic` would read it in a safe way from the memory and would return a copy of the stored object. So if we call a method of the stored object the mutex will be released before the method is called and the method will be called on the copy. `atomic` also does not provide a way to lock for longer time, spanning calls to multiple methods.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1169846509",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "renamed",
      "id": 6933944067,
      "node_id": "RTE_lADOABII585L6FX5zwAAAAGdS5cD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6933944067",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T12:16:26Z",
      "rename": {
        "from": "sync: introduce a thread-safe smart pointer and use it to remove g_maplocalhost_mutex",
        "to": "sync: introduce a thread-safe smart container and use it to remove g_maplocalhost_mutex"
      }
    },
    {
      "event": "renamed",
      "id": 6933949045,
      "node_id": "RTE_lADOABII585L6FX5zwAAAAGdS6p1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6933949045",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-05T12:17:03Z",
      "rename": {
        "from": "sync: introduce a thread-safe smart container and use it to remove g_maplocalhost_mutex",
        "to": "sync: introduce a thread-safe smart container and use it to remove a bunch of \"GlobalMutex\"es"
      }
    },
    {
      "event": "reviewed",
      "id": 1036036999,
      "node_id": "PRR_kwDOABII5849wKuH",
      "url": null,
      "actor": null,
      "commit_id": "7b05e787cfc43494f0cea6364928f184c98e3fae",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I think right now I am at \"concept -0.5\" on this PR at 7b05e787cfc43494f0cea6364928f184c98e3fae. If other people think this change is a good idea, it seems fine, but I think the complexity it adds to sync.h isn't really justified by the minor code simplifications it enables elsewhere. Maybe if changes to `sync.h` were simplified or if a compelling use-case were explained, this would look like a better tradeoff.\r\n\r\n---\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158434634\r\n\r\n> This seems like a non-starter to me? It's not even able to detect obvious double locks at compile-time:\r\n\r\nThis is fixed now by allowing double locking. Following test passes `test_bitcoin -t sync_tests/synced_double_lock`\r\n\r\n```diff\r\ndiff --git a/src/test/sync_tests.cpp b/src/test/sync_tests.cpp\r\nindex 55c2c5108de..3c225847529 100644\r\n--- a/src/test/sync_tests.cpp\r\n+++ b/src/test/sync_tests.cpp\r\n@@ -140,4 +140,18 @@ BOOST_AUTO_TEST_CASE(inconsistent_lock_order_detected)\r\n #endif // DEBUG_LOCKORDER\r\n }\r\n \r\n+BOOST_AUTO_TEST_CASE(synced_double_lock)\r\n+{\r\n+    Synced<std::map<int, int>> m;\r\n+    m->emplace(5, 25);\r\n+    {\r\n+        auto m_locked = m.Lock();\r\n+        m_locked->emplace(6, 36);\r\n+        m->emplace(7, 49);  // double lock\r\n+        auto m_locked2 = m.Lock(); // double lock\r\n+        m_locked->emplace(9, 81);\r\n+        m_locked2->emplace(10, 100);\r\n+    }\r\n+}\r\n+\r\n BOOST_AUTO_TEST_SUITE_END()\r\n\r\n```",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1036036999",
      "submitted_at": "2022-07-12T16:06:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6984094388,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGgSNK0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6984094388",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-13T08:55:46Z"
    },
    {
      "event": "commented",
      "id": 1182955925,
      "node_id": "IC_kwDOABII585GgnmV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1182955925",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-13T08:57:39Z",
      "updated_at": "2022-07-13T08:57:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "`7b05e787cf...acb21a5a24`: simplify the implementation of `Synced`, as suggested [above](https://github.com/bitcoin/bitcoin/pull/25390#discussion_r919129254).",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1182955925",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "labeled",
      "id": 6987494072,
      "node_id": "LE_lADOABII585L6FX5zwAAAAGgfLK4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6987494072",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-13T16:27:40Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 6991741695,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGgvYL_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6991741695",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T07:18:02Z"
    },
    {
      "event": "commented",
      "id": 1184085863,
      "node_id": "IC_kwDOABII585Gk7dn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1184085863",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T07:18:30Z",
      "updated_at": "2022-07-14T07:18:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "`acb21a5a24...4b870a1538`: rebase due to conflicts",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1184085863",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "unlabeled",
      "id": 6992525473,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAGgyXih",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6992525473",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T09:12:47Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7037018200,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGjcGBY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7037018200",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T10:20:26Z"
    },
    {
      "event": "commented",
      "id": 1191312357,
      "node_id": "IC_kwDOABII585HAfvl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191312357",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T10:22:40Z",
      "updated_at": "2022-07-21T10:22:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "`4b870a1538...135ca49e24`: Further simplify the `Synced` class:\r\n\r\n* Inherit `Synced` from `RecursiveMutex`. This allows the removal of the member `Synced::m_mutex` and the type `Synced::UniqueLock`\r\n* Inherit `Synced::Proxy` from `::UniqueLock<RecursiveMutex>`. This allows the removal of the member `Synced::Proxy::m_lock`.\r\n\r\nAfter the above changes there are two methods with similar names:\r\n* `Synced::lock()`, inherited from `RecursiveMutex`, it just locks the object\r\n* `Synced::Lock()`, it locks the object and returns a scoped lockable.\r\n\r\nTo avoid confusion, rename the latter to `operator*()`. This way constructs like `foo.Lock()[x]` become `(*foo)[x]` which looks better to me.\r\n\r\nNow the `Synced` class is 47 lines (excluding comments).\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1191312357",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7037434218,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAGjdrlq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7037434218",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T11:24:27Z"
    },
    {
      "event": "commented",
      "id": 1191366795,
      "node_id": "IC_kwDOABII585HAtCL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191366795",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T11:25:21Z",
      "updated_at": "2022-07-21T11:25:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "`135ca49e24...11ac578f91`: use `MutexType` instead of `M` in templates because `MutexType` is already used elsewhere in `sync.h`",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1191366795",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "reviewed",
      "id": 1117913698,
      "node_id": "PRR_kwDOABII585CogJi",
      "url": null,
      "actor": null,
      "commit_id": "11ac578f9132ed76191d03d5100fc88b6ada6a8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I'm still Approach NACK on this. :(",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1117913698",
      "submitted_at": "2022-09-28T17:07:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "referenced",
      "id": 7558068169,
      "node_id": "REFE_lADOABII585L6FX5zwAAAAHCfvfJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7558068169",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2e77dff7449af6b46b284c75ce6e1d53a134bc8e",
      "commit_url": "https://api.github.com/repos/bitcoin-core/gui/commits/2e77dff7449af6b46b284c75ce6e1d53a134bc8e",
      "created_at": "2022-10-11T01:19:09Z"
    },
    {
      "event": "labeled",
      "id": 7558439948,
      "node_id": "LE_lADOABII585L6FX5zwAAAAHChKQM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7558439948",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-11T03:08:58Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7570192028,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAHDN_ac",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7570192028",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T09:49:37Z"
    },
    {
      "event": "commented",
      "id": 1275894327,
      "node_id": "IC_kwDOABII585MDJo3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1275894327",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T09:50:22Z",
      "updated_at": "2022-10-12T09:50:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "`11ac578f91...70dac32e76`: rebase due to conflicts + update as per the discussion in https://github.com/bitcoin/bitcoin/pull/25390#discussion_r978269158\r\n",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1275894327",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "renamed",
      "id": 7570297133,
      "node_id": "RTE_lADOABII585L6FX5zwAAAAHDOZEt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7570297133",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T10:02:28Z",
      "rename": {
        "from": "sync: introduce a thread-safe smart container and use it to remove a bunch of \"GlobalMutex\"es",
        "to": "sync: introduce a thread-safe generic container and use it to remove a bunch of \"GlobalMutex\"es"
      }
    },
    {
      "event": "unlabeled",
      "id": 7570612879,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAHDPmKP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7570612879",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-10-12T10:43:16Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1145740612,
      "node_id": "PRR_kwDOABII585ESp1E",
      "url": null,
      "actor": null,
      "commit_id": "70dac32e76dc87d87d0d23f2da0ff5532d5bf040",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK\r\n\r\nDon't think the bool-array to unordered_set makes much sense, otherwise looks good.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1145740612",
      "submitted_at": "2022-10-19T08:05:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "referenced",
      "id": 7648533848,
      "node_id": "REFE_lADOABII585L6FX5zwAAAAHH411Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7648533848",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5984166da695ad241a3affb56e8e8a5f71fb1108",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/5984166da695ad241a3affb56e8e8a5f71fb1108",
      "created_at": "2022-10-23T15:26:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7723201388,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAHMVrNs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7723201388",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-02T13:08:09Z"
    },
    {
      "event": "commented",
      "id": 1300379783,
      "node_id": "IC_kwDOABII585NgjiH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1300379783",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-02T13:08:29Z",
      "updated_at": "2022-11-02T13:08:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "`70dac32e76...c3e4c34219`: rebase and address suggestions",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1300379783",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7762587818,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAHOr7Cq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7762587818",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-08T13:07:52Z"
    },
    {
      "event": "commented",
      "id": 1307191594,
      "node_id": "IC_kwDOABII585N6ikq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1307191594",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-08T13:08:42Z",
      "updated_at": "2022-11-08T13:08:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "`c3e4c34219...0f457d2bdd`: rebase and go back to a single macro `SYNCED_LOCK()` with 2 arguments.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1307191594",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7764694659,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAHOz9aD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7764694659",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-08T16:33:53Z"
    },
    {
      "event": "commented",
      "id": 1307499020,
      "node_id": "IC_kwDOABII585N7toM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1307499020",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-08T16:34:10Z",
      "updated_at": "2022-11-08T16:34:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "`0f457d2bdd...6c0bcd0928`: update comment",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1307499020",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7792646438,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAHQelkm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7792646438",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-11T14:40:55Z"
    },
    {
      "event": "commented",
      "id": 1311779599,
      "node_id": "IC_kwDOABII585OMCsP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1311779599",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-11T14:45:52Z",
      "updated_at": "2022-11-11T14:45:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "`6c0bcd0928...f8f7e62f81`: don't change the type of the variable that holds the list of reachable networks (an array of `bool`s), see https://github.com/bitcoin/bitcoin/pull/25390#discussion_r998202653",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1311779599",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "labeled",
      "id": 8391634226,
      "node_id": "LE_lADOABII585L6FX5zwAAAAH0Li0y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8391634226",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T19:15:33Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8411365291,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAH1Wz-r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8411365291",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-01T15:02:45Z"
    },
    {
      "event": "commented",
      "id": 1412208407,
      "node_id": "IC_kwDOABII585ULJcX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1412208407",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-01T15:04:14Z",
      "updated_at": "2023-02-01T15:04:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "`f8f7e62f81...3db109e794`: rebase due to conflicts\r\n\r\n@ajtowns, I think I addressed all your suggestions?",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1412208407",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "mentioned",
      "id": 8411383294,
      "node_id": "MEE_lADOABII585L6FX5zwAAAAH1W4X-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8411383294",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-01T15:04:15Z"
    },
    {
      "event": "subscribed",
      "id": 8411383316,
      "node_id": "SE_lADOABII585L6FX5zwAAAAH1W4YU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8411383316",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-01T15:04:15Z"
    },
    {
      "event": "unlabeled",
      "id": 8412022687,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAH1ZUef",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8412022687",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-01T16:02:58Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 8550190113,
      "node_id": "LE_lADOABII585L6FX5zwAAAAH9oYwh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8550190113",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-17T19:16:30Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8602239815,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAIAu8NH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8602239815",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-24T14:09:08Z"
    },
    {
      "event": "commented",
      "id": 1443734529,
      "node_id": "IC_kwDOABII585WDaQB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1443734529",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-24T14:09:44Z",
      "updated_at": "2023-02-24T14:09:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "`3db109e794...e42ce20c65`: rebase due to conflicts",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1443734529",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "unlabeled",
      "id": 8602857508,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAIAxTAk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8602857508",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-24T15:07:34Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 8913432756,
      "node_id": "LE_lADOABII585L6FX5zwAAAAITSDC0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8913432756",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-03T14:05:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8954837008,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAIVv_gQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8954837008",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-07T16:20:54Z"
    },
    {
      "event": "commented",
      "id": 1500433830,
      "node_id": "IC_kwDOABII585Zbs2m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500433830",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-07T16:21:08Z",
      "updated_at": "2023-04-07T16:21:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "`e42ce20c65...ebfe47e594`: rebase due to conflicts",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1500433830",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "unlabeled",
      "id": 8954909041,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAIVwRFx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8954909041",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-07T16:36:43Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1513345887,
      "node_id": "IC_kwDOABII585aM9Nf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1513345887",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-18T15:17:58Z",
      "updated_at": "2023-04-18T15:17:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "Light Approach ACK after reading the code and the excellent review discussions. It looks like this has been progressively honed and improved quite a bit. Will test and review.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1513345887",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "reviewed",
      "id": 1390434676,
      "node_id": "PRR_kwDOABII585S4Fl0",
      "url": null,
      "actor": null,
      "commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Light initial ACK ebfe47e5942fa5e0ce21b44511258b6dfa4cf621 modulo poking around with the thread safety coverage/guarantees to break them. Compiled and ran unit tests at each commit with ARM64 clang 16 (except the scripted-diff ones).\r\n\r\nFeel free to ignore the comments below unless you need to repush.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#pullrequestreview-1390434676",
      "submitted_at": "2023-04-18T16:09:38Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
    },
    {
      "event": "commented",
      "id": 1557425242,
      "node_id": "IC_kwDOABII585c1Gxa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1557425242",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T15:26:38Z",
      "updated_at": "2023-05-22T15:26:38Z",
      "author_association": "MEMBER",
      "body": "Concept ~0. While the first commit introduces new code in `sync.h` that needs maintaining and unit test coverage, the following commits do not demonstrate convincing reasons for it.\r\n\r\n> but it is possible to abuse the mutex and start using it to protect some more, possibly unrelated stuff (we already have this in the current code).\r\n\r\nConcept ACK on improving this.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1557425242",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "unsubscribed",
      "id": 9304393598,
      "node_id": "UE_lADOABII585L6FX5zwAAAAIqlcd-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9304393598",
      "actor": {
        "login": "joostjager",
        "id": 4638168,
        "node_id": "MDQ6VXNlcjQ2MzgxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4638168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joostjager",
        "html_url": "https://github.com/joostjager",
        "followers_url": "https://api.github.com/users/joostjager/followers",
        "following_url": "https://api.github.com/users/joostjager/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/joostjager/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/joostjager/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/joostjager/subscriptions",
        "organizations_url": "https://api.github.com/users/joostjager/orgs",
        "repos_url": "https://api.github.com/users/joostjager/repos",
        "events_url": "https://api.github.com/users/joostjager/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/joostjager/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T15:51:38Z"
    },
    {
      "event": "labeled",
      "id": 9382045097,
      "node_id": "LE_lADOABII585L6FX5zwAAAAIvNqWp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9382045097",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-30T19:14:48Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9391459478,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAIvxkyW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9391459478",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T14:37:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 9814890398,
      "node_id": "LE_lADOABII585L6FX5zwAAAAJJA1ee",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9814890398",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-13T19:32:04Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZiNTMyMDc1YjIyYjE3MWNmNjcxZTQwNGVhMTdjNzQyZjA4ZDI5N2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fb532075b22b171cf671e404ea17c742f08d297f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fb532075b22b171cf671e404ea17c742f08d297f",
      "tree": {
        "sha": "6757c4c5b4a1b672a29372f36701080b357950f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6757c4c5b4a1b672a29372f36701080b357950f5"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6757c4c5b4a1b672a29372f36701080b357950f5\nparent 78a983f597af224e017f522443112cec81422fe6\nauthor Vasil Dimov <vd@FreeBSD.org> 1655310458 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778292 +0200\n\nsync: introduce a thread safe generic container\n\nIt can contain anything, encapsulates a mutex to synchronize access to\nit and enfoces access through it.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+HQACgkQVN8G9ktV\ny7+slB//XYAiAqJk47TRI8FvvW+NGfOMxtrFqbUREDFAs7mVJ8/EZsv9T7bO93uW\n70PvUmI1u7UchfcRal1j5XKQi7DCV9LHuAU2Z3EetkWUl+W3L2aKwTJR2gXoijF5\nf3y2Jr+gZAq7s7hvLoMY+aMcg4d4G0eFXN5ER9sDVitW/sPiR+pq1TLShEwpiUoN\nToCAcGNvF+J5EnISU7+06FMO6Zl5Tv89OYpNQliuVs1r3f5wxhsTFPJOGfadmye4\nFBusEZi/sABK4yjjIzaQF/U6a+3fyl58SnvmDAF73ivOTMzJ6EM33RlSEaXV8hGs\nRTXgGjAcUyTndWFmokJhrBitji2cPthcqgSEr/vtpGbLjfyiQNgbM/0V0KVdy2Hz\nf4i2croJYWzZXVdWT0SM59LwReQtbckDmbTc930OE2KXA02nEVV726SHWk8wJLAT\nwEJkNJslOXRDRpaLJrP+8fZBlc5/dCGRbXsqhz6ShdIwvMjhjz09jJWBUwV+pM2x\nh/1KgcWLJXt5VQwoh7qQMTFPuBHazR+ECYmo3vyFK/FGk8hJ5d0DRo3j0HLBxpgn\n5uEPJlIcLTLgy+zVC7687yG8ns0bOAngeErylfAAQYhydIwLf9a9/sas+PB6oM19\nDUuDfhE/Scs/J56f3bPlDsQiZeHGQpoWFUnSavXHSbLTln5ovKjI3akaxF2TOFRk\nILMfdlVkGyaDR/e7o95tm80MBpuiRcRPyJ/TBQRICYJDLZTDpECHR5eJBE0TiK46\nhLFU3QNfy1XEWS8Q5eXO4a31xDKS21jchtEkDEtW60AkYHdrI2HgKTCAExwvCBiG\nKR8F0GTx3G4eK6mMkMbOSb9SbP0nD4cWb6sKNN9ZM79ZKCklSdOEXqeuxtYXzd39\nfX2KpttcNk3ORqUVw6j5NmFKVbMFVOEgOAnOjR+IAYkTq127nQ9mRwWARPk14qGO\nOqy7QftFBE89xdCr//NzwebovwfaYnhrWlr9CRa6/cG96IVzvbLTYSUgDQy/w2C0\nSyTlfYM2hWpJ0QCiXxkfwfy88gN1GGhNFpvUIWegtZ/er2yxDOOg2RshAIgkNBce\nKslF5gS+Swk+IJZsfqukMEj2pQ2+0fj52jwiMB0f3KOBN+dhF2B039/m8Y0nplwV\nW45sGyWPEvIDC7K2nSxEJdeL1/kxh73S8XguUNDqZa2nzzJoy9uNv29jCZbAxtT5\nVuoqv+vcLmPr2VvZ7JkkA2WqlKe9oMPhZmPYc064irR9gtAZDZQvPG7GegCvNJl4\nE/s7/YVOO8OuSF/kg5ebEjn0KwWcgPomPMAkkrzB34zqX7IaMBxVPLqJxTiIDPWx\n5bobP+agUYi7AO3+7NZtVcAdF6tvvQ==\n=Oe3s\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/78a983f597af224e017f522443112cec81422fe6",
          "sha": "78a983f597af224e017f522443112cec81422fe6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/78a983f597af224e017f522443112cec81422fe6"
        }
      ],
      "message": "sync: introduce a thread safe generic container\n\nIt can contain anything, encapsulates a mutex to synchronize access to\nit and enfoces access through it.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:51:32Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-15T16:27:38Z"
      },
      "sha": "fb532075b22b171cf671e404ea17c742f08d297f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU0NWQ0ZmZmMGZiOThkNDlmZGQ1YjcxOTQxYjNhNjJkMTEzZjRjMDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/545d4fff0fb98d49fdd5b71941b3a62d113f4c04",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/545d4fff0fb98d49fdd5b71941b3a62d113f4c04",
      "tree": {
        "sha": "2054650be66a1681e2d32968c2966835246557e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2054650be66a1681e2d32968c2966835246557e1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2054650be66a1681e2d32968c2966835246557e1\nparent fb532075b22b171cf671e404ea17c742f08d297f\nauthor Vasil Dimov <vd@FreeBSD.org> 1655311045 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778296 +0200\n\nnet: detach vfLimited from g_maplocalhost_mutex\n\n`g_maplocalhost_mutex` also protects `mapLocalHost`, however it is not\nrelated to `vfLimited` and both need not be protected by the same mutex.\n\nThus, use `Synced<T>` for `vfLimited` and rename it to\n`g_unreachable_networks`.\n\nThis reduces the scope of the global mutex `g_maplocalhost_mutex`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+HgACgkQVN8G9ktV\ny79LfiAAlDpFfAE/eX1KyMp8VsCtrGToHCl1sLV+JzsNuM+Awll37pC6d9qEZgj3\nK5PglF8OrW4Sj0ZMOo1KiSM6rpm6VA/AGHnJkbBTLNOVO8LXh8kReq89gQpaxOZO\nvCz0fZ/YPkK9tplnZEbmE7wtLiSbO5FzKcA8PENcONE3hUIeytTgWT9XwKdStOE/\n8ub9TxVG3o6iCNGMOX2eJcWPJ9k0384B5cEdmyvCJeVcVayrZtgo6KaWnCQm1j0N\ngQ6W9uqPuKDk3Zcb5DdJQLMmFUJdyOUFcuB/H73NIIfQbtNSbsZC8bCe/U8usFFq\nnxpGerFrFRLlVxCaq4Z1xdy8NcoOjwpUH8MDfReEtFzXBU1CrtKtdXDrOC2qBMmr\nzRrKrAsZnvy/J/7q7N96TKIo4pA6mSIqVUrhVejKMhRL4+a/EY/Kfnkccy50MN2/\nhXKDu+nLasHayNmEqGb5Qq+GH1Bjgs4nU7miuk5EjOsc4Tyf9x7+FVhMN2GtoZlc\n9sR+c9aMCPUIJYBxLbuhYK/23T8s8OWfPzaolvHCePr1CUekX2N4ao800m6/PRwf\n3SG3z2XNwL0LoidA6l7+rwhKu5IK75bMsjSJogHzIM5+Sgyjl1IiYgbouVVRgkFA\nSzG5p8HMlm6jtJQGx6/U5Y9TO4b9Hjy1VbB801R7PR5Lvm6Z2gYQm1Cd6u+loI63\nNqbAzGg2L72IiHO3sRF0S06OmagdGTCBRaeQbp7NcoVD3+arjzipM8xL2M/tvZBw\n1s0AOzt/V65j8PLjVLNJBIRfSaow4NM/tfPMAKuFomzsMWtZS0oQTLC9MhiKsGmT\nZYurOowuMEiC0qjo5jwvkzyGTTzEIjxExnb0dn/FKkXXR0sn4TAFQPGXAjD/0TBQ\nrQdQsuV+T2VaUeiaHvDysgWIQWzUGZDbxsZdVU7sYIyfSvfPIZvMO1uUL+o2RFki\nppfhk8jA4e76NBcOft+9eN9VXrnL+i7WmHEK8dEIZf7Cqi52gfsUIW/XbCpn/h1e\na4WOsoTABLR4zp2/p85hI2tcTD+5wtr/t3a0xcS51vN9oiBwwrTjfJZzotWpSCQC\ni9RE2mo4YpJQlHTdi5QooMuXKDWZDI43YOCj/+7LKDgrdOeyc0xtXOw3HdkroREu\nI87BV9MkrivOQ1lk13EpVmtSdzx60w1mzx7XWhl9IcwsFQlxEzfKrBNG1rTv2LLB\nj9StFks4hHjPC188DFpJ+erQf9ZXmljBFN7m9x4W1vK0bSX6o/nHL1WLOzJS8xxB\nXA/5qzxUbxpMb5W4sOCOUF//Iu2x4a0oN6txCs82g7jPKqN6nenTL9hCCQ4CM+U4\nH45NTSN2wbE5lHOZmeaqdtVzXxUkHA==\n=dBKC\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fb532075b22b171cf671e404ea17c742f08d297f",
          "sha": "fb532075b22b171cf671e404ea17c742f08d297f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fb532075b22b171cf671e404ea17c742f08d297f"
        }
      ],
      "message": "net: detach vfLimited from g_maplocalhost_mutex\n\n`g_maplocalhost_mutex` also protects `mapLocalHost`, however it is not\nrelated to `vfLimited` and both need not be protected by the same mutex.\n\nThus, use `Synced<T>` for `vfLimited` and rename it to\n`g_unreachable_networks`.\n\nThis reduces the scope of the global mutex `g_maplocalhost_mutex`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:51:36Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-15T16:37:25Z"
      },
      "sha": "545d4fff0fb98d49fdd5b71941b3a62d113f4c04"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVkOGFkNzViNjRhMTRlZTIxM2VhMGQwYmExZjg1MDEwMzQzMDQ5NDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ed8ad75b64a14ee213ea0d0ba1f8501034304941",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ed8ad75b64a14ee213ea0d0ba1f8501034304941",
      "tree": {
        "sha": "7026cf7acd92155eb1b751b0cbc05bf2a42b5129",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7026cf7acd92155eb1b751b0cbc05bf2a42b5129"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7026cf7acd92155eb1b751b0cbc05bf2a42b5129\nparent 545d4fff0fb98d49fdd5b71941b3a62d113f4c04\nauthor Vasil Dimov <vd@FreeBSD.org> 1656494852 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778296 +0200\n\nscripted-diff: rename mapLocalHost to g_my_net_addr\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/mapLocalHost/g_my_net_addr/g' $(git grep -l mapLocalHost)\n-END VERIFY SCRIPT-\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+HkACgkQVN8G9ktV\ny783wh//ZRvcWpGR22ymC9Kf+4QFnx2oQ6yd0jFK7aHXx8qIft3unrzHubBNli22\ng12ptikyTpHeZM6iPXpzMde6NosuDVyvR++Cg38Ys9lSeiK/JrOpNRzXLnsFjY3C\nkfK5aujhcDgde5yksTN5nxWv3YbcivOZt59+E+jl1gZ2g6V7S/lhodUkGYgm/k7Q\nGTCXS+jecsRXD738S8STIZMqkVMIcqOE/nwwD/dW6KbXh6RbJ0bU5huVfCBhCgvP\nbiV+nnuEcS549n9yzwC7iCSk+h/FK1n5E4mPyk3ot94fNSidViuti3E11XQ6qlln\nkGF+cFUex7LlWN2gA49s/1o/7+mGwJqSCJl5QEudJ2tqhrafQldNrFrDn8VxMOZP\n4go24oUTTA5hpKIpQM24ZtH+a2rrw26GkA65uPW7ptYdmNOX03HfNWHqmV6wJlz1\nn2RbK/22VGysx0dHgZn8M239jJOJ2oV5A90Idrew25nZiaC60xDgocHN6OYAGoW7\nWMk8dPRl55y6nBMEGCWuGu8zyzqCQklaNYDNwuDBHK2/j+Fvbmlal2lt8x48j58a\n/MKH7qFKOCijjpJh4McUhNV9iizA8ZmY1pmtHiqFEHFQbYDMlq2AmmPdbVrBVzcM\nr3RoIhW88DGeEQ2hrxNzCf3bXC/vY9LCAtrTHkQ9Vy9ftxXiIfdnpRiunxOa9dmC\nQ1xcaYGmQCsfZkkEvimSlW+0Vn1RUetNzitieTW8gdi2gDXMtC4CW/Wfs4y72ztx\nSk+FLu0xIsQ5+Iq+jX13BvaBkDLsSaSgzr2nrzXE3q2hKLBNvF6Z07Xj4ydtAQmT\n5TFK+Rm3+bdUCZu+1OBwdCmIJp5NQrOaaPkjesLBOQ5s07+2b88zaTfK3Kr2tNcC\n7B3CaUFO/1pu0UExtiIjqv7cP5ls8+7BbD+N3BhvJh8bcWAmH/hwnJl46lBt2SIm\ndcqpp2DsoG2JM1ffAALdWltA9GF1kPd6XWvbOS71yaT0bB7B3OFMY6WEMhoEzkXA\n5IDfmFDIyXmTNPoI+B8XJw1gCOt6iayJHNE9eNhLc57bHAxfuQi3j52OwZp7fin+\nFcLBquF6hyJ2LyjwR2pg6x3vRrpKQal/O9aLjXHOWyBK4+THuUIjOdv6+HW8OJMn\nhFjsmpuUBEYTRlkVzshWeae5fZWEUcnrbergWeFHUIRo79c5behPEA/tNHPrc/7X\nigzJI6pJIUj/ZL//tdZPIqLZar37FPW1jNKIHYuEBL2oUoa7djtoPz5zJhAA08+D\nydctW672DjAwdZRFgbcZ9R4lSCMqpu713P8vK/HC2HCGsKm9EgL0RMsEJGZFdRsP\nWrbRrE6NLkxrxzuFWRQNb2rXX1J2sA==\n=ZX1p\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/545d4fff0fb98d49fdd5b71941b3a62d113f4c04",
          "sha": "545d4fff0fb98d49fdd5b71941b3a62d113f4c04",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/545d4fff0fb98d49fdd5b71941b3a62d113f4c04"
        }
      ],
      "message": "scripted-diff: rename mapLocalHost to g_my_net_addr\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/mapLocalHost/g_my_net_addr/g' $(git grep -l mapLocalHost)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:51:36Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-29T09:27:32Z"
      },
      "sha": "ed8ad75b64a14ee213ea0d0ba1f8501034304941"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVkZjBhYTU2YjllODViOTZmY2I2YTNhOGY3MzkyY2NhMjdhMTQ1OWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a",
      "tree": {
        "sha": "f92bda49ee2c50633f89f66bcbe6e73927745757",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f92bda49ee2c50633f89f66bcbe6e73927745757"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f92bda49ee2c50633f89f66bcbe6e73927745757\nparent ed8ad75b64a14ee213ea0d0ba1f8501034304941\nauthor Vasil Dimov <vd@FreeBSD.org> 1655367186 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778526 +0200\n\nnet: use Synced<T> for g_my_net_addr and remove g_maplocalhost_mutex\n\nConvert `g_my_net_addr` to use `Synced<T>` and ditch the global mutex\n`g_maplocalhost_mutex`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WAACgkQVN8G9ktV\ny7+6XSAAoSa9ttOpSWQkQ47n052Zr3KFou5oaLIPRYhKNwNXlGU69S3LNoWRn9eA\n99CV/+QjsXVmQTB4NywmpuKaJat81K+YZdw2By3s2Fj0LqhT3E8kCI45a0r59KkI\nJXGwtGe5NYxUYrXc1w9onBAllk0/hmxj6nJ4d/e1qcpDCqJ6tq1rqUamEd8Hicf7\nv6EDMpiufT/Von8udfNzdgxZxyj+KRDDePOpzYuC+H0GLnpUSkeEatkrtHVyuhce\nSClrdSn6jJ8VrExoWnm1nwA2tKCz1lxaXprybMncBxcOsRBxmfttzHJuqxEEeXNk\np/8OhEMR6nHwCwzaE8kG9CvcckMJTb4xaiIuP/VV/U6IwSnXlxFlWaFATbOfr0qt\nALmvYP6S4LZNQdpR2eJDRSFLXLOZjzi7B4nBzkML1DLdrXW68oS5JVJeUg+yNh/W\n7XJr0ewzHm6p0+CeoiaVxaiqbnUXQIdM6ZZ6AGmM52QNNrrtnA4xmdBqSUod3FXz\nFpTAna5WXrP3NrUnEMD++A1lBAUPShziARmhVJTJ4wjdkEwi4o5+W/XaDj76FvNa\n0C90OiG8mug2v3+2gOHO2fPbOHlL/mstUq+YL7QVwNg8g1r72hojrRbggxbnJjH3\nyPJlCR8N5Fc9+F2YjN0hpEuod2o0MyocKjXZ5ba4OFZp3PaE1n11wHfKJZOcJOjz\nCHcmdyiWvG4u9cgIUjkqOwrGdOHw1I2BNIj8UypEfGN8H8RRwcwg3Z4tn+SkkmRf\nQIidI3qRVrC3DnxE0gn5hP221ytHb8gF61vmJUusKReHLkbwHjQEdWyeudTDZ/7U\noI5LAPG9f+uj43W1/nAFNbspkoVERjzCdwzxLWKbtIwF1aGM72m/eWiPDwGsjyGh\ndBA2/IfAuSdprTi0OBrGVW3C4kAazCtk3W6o564C1h864QTYkYMw+pvBwnTXcSXk\nrgqBZY94Jv2ompFEhSo2hlpe/As6hQyavE/SEON1fKBeiXqpujf24QmNmGoXM5SN\nTpHoYCanaLGmOTC5ddxwKJ4vXaaL4bxNP4IZf6EDBXu7cGCkQoiuGPWkTHy2vlHT\nv58AurSBUY30Ak6DrFlURe1CpyJn5o7aAYQnSmCKW+P80wLwGYQOyaMHHYCntP+2\nuampCCVLzuLzDwR5ozGfxm6w2s8Dim0UToMAnxmtikbGM+zbtqtIy11ll2XIo+8E\nfNzgQFCVMbEhT2na7hAnNIeOXCgYQK1529SQEVwlnhix6vUh8/8qA7znSp01GqNy\numE/VJPXoPIw9T3vSrHeTPsgxVQLMqkjJY46qQpv9ZF0/9okHqbg4iQELHaXAibU\n2EJMCsk604XXsyKvDA+N8AYm325qyg==\n=d2lh\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ed8ad75b64a14ee213ea0d0ba1f8501034304941",
          "sha": "ed8ad75b64a14ee213ea0d0ba1f8501034304941",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ed8ad75b64a14ee213ea0d0ba1f8501034304941"
        }
      ],
      "message": "net: use Synced<T> for g_my_net_addr and remove g_maplocalhost_mutex\n\nConvert `g_my_net_addr` to use `Synced<T>` and ditch the global mutex\n`g_maplocalhost_mutex`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:26Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-16T08:13:06Z"
      },
      "sha": "5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdjOTM0NDMxOWQyMDFmYjczNjgxMThlNDM1MmNmY2Y2ZGJkYTQwYzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c9344319d201fb7368118e4352cfcf6dbda40c6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7c9344319d201fb7368118e4352cfcf6dbda40c6",
      "tree": {
        "sha": "4628f3a2f55c87e874313fff325ab20b80ad597f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4628f3a2f55c87e874313fff325ab20b80ad597f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4628f3a2f55c87e874313fff325ab20b80ad597f\nparent 5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a\nauthor Vasil Dimov <vd@FreeBSD.org> 1656334725 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778528 +0200\n\nscripted-diff: rename deadlineTimers to g_deadline_timers\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/deadlineTimers/g_deadline_timers/g' $(git grep -l deadlineTimers)\n-END VERIFY SCRIPT-\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WAACgkQVN8G9ktV\ny7/GkCAAhORd1oybHTZjQ0gp+5yZ2J3wQLrQ26yxcJY6Ig9Y5VX+U/r3VNDkgqE5\nJSx1YD9dHTy8e+ON+yZngt+esp/SSbtCkf4My715daGZn6CsEOB3Q+Iv+Mzh9hQn\np/2p1CBunEjDe2IWNyy7mXxGOenyOyH0X0xze8tHIMtr5j2avKTDBewRU4SUEkXG\nL/Hf6yKLtF26Fqc4uM+T7Avhrtb1BhIl9UkU7a2uWQO2flb6AZgO/axvOokzhM8a\n6mmQFGUWViAxx7IOvaXz1kiGn8bvWWbF0693dqvET7uJzDkghb3NQHKkOgAr2sWh\nLzhBCzXvr2gJhsYo4v6xuwWa5lWKZDdPdCRYQtgaHLJjEnbUaTlsy7CYT2TcCFX9\nAl39kR4dGDwqhC29cLLV7QTGo+L7UkCec37Gx1jeJVZnSFn4f1/ygEX7NdveIuhQ\nlbcJikfnfYvzRV3fAxRSDQb+hac4p8DDR6bEQT55EuhAXAyoObrRuMrn3s3vO05X\nbuGrnH3+IAGWQGLepTQoYvc57ZAsKS/4++qnzUv7Z/kkLlXrfTdONLkAKernX52c\nUFYDf5fsmP5VgRYaNn3x1YYnWK1s6Vs1VrbgkdnIAu4eYgC0LVlJjNyX6YG6JtNs\nsce8mqb4Rm0CqNwt2o3/iEKqhBm6yyvkCPH/l6HhZJfHslmPyLCxKpxYXAKq5cAn\n1v7OkRi8ggceHX0qrK99SGHlkvNQuIaLOADhfWy78Xbzbf37ZzJFuz0iSSq1jYWu\nxLBVIavBoth1qupY/mkbLCkvhSecnmJ3ozIcvzPqd3za0WeVnmxHMxfZ9jIUEk//\nh91wIlmp68IRjejuq9kwkr4w4wMh/kFSjcQEXo0AM2YnzVK84SLxyMA3hpFOyquw\neIhcexQHe2vQmlxZ1CHjwpea6NzMeddMjTtVA1ENq9jM4BW6j0WN3HmhBXCAD2+I\nALsQbmjSQVSTnePJf60sxPeYx7J1gFSBX0L0dNttPwk8U65tkHZPlo6mQXBfUO4z\nVVBn+LfzlRdsxmxie40D21Vhf4eENEnTl7XfduGV1VFJoiv8cZtD+8lW+ptRdPdE\npHcpQ0JvnvV6m2Ko1XN9jW9HBCBE+eA28LGpZXd8KBeSFzBdwi7fuLg/cVipYIyu\n+35KqH4vE3BRvKGQW+ldQ8yUu5aeY0MVj5IBVyKB/XnpLDAE091Zs+jqgLV9y3sb\nRjDtUWKXh7LkzemDNrZW3erc4XlHup4HiDDnkBhkp9gPJWAndazWvTDINyVn+GZO\nu+4lQOXRAvLhC1y7UdK+21YQgzv67eHrTBrEGrxDuLJf3Iufjd3rh2lhI7rGT3yN\nFTjgAaUcCmLEYuvZOXSp3xvOeluASw==\n=q0vg\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a",
          "sha": "5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5df0aa56b9e85b96fcb6a3a8f7392cca27a1459a"
        }
      ],
      "message": "scripted-diff: rename deadlineTimers to g_deadline_timers\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/deadlineTimers/g_deadline_timers/g' $(git grep -l deadlineTimers)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:28Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T12:58:45Z"
      },
      "sha": "7c9344319d201fb7368118e4352cfcf6dbda40c6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY0ZGVmYmRmZTEzMTQzNDlmMGRkMWVhNTlmZTJkMWJiMzFmYTY3YTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4",
      "tree": {
        "sha": "0de71daf7e5207c8622ec916fbc3767e5cdb5133",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0de71daf7e5207c8622ec916fbc3767e5cdb5133"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0de71daf7e5207c8622ec916fbc3767e5cdb5133\nparent 7c9344319d201fb7368118e4352cfcf6dbda40c6\nauthor Vasil Dimov <vd@FreeBSD.org> 1656334971 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778528 +0200\n\nrpc: use Synced<T> for g_deadline_timers and remove g_deadline_timers_mutex\n\nConvert `g_deadline_timers` to use `Synced<T>` and ditch the global mutex\n`g_deadline_timers_mutex`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WEACgkQVN8G9ktV\ny79u4SAAomBsqnQRHsPi/18UKj1KYZCICNRyNqP5kMdtl5o75dVt+m/HalFtuc9d\nfDJdYu1BJSY0b0ehP309Ym3OhiI3gyTnC2FJFkgSRIp4O4GbSCBllsD+hMkx4D7f\nbHCpJhskMBBG3/DASBtE5aN6nPs97UHNW6yRohFQd9cQS9vWghBhUbVYKRL0vGgb\nQtph7+7mdCMsg8MThxrgbuKIes7LUHrPQ5VkIbRSjazUVjMfaLcz+tOBUXwA8djF\nVJ6ZkHUKF6CQE/GNivY+012QIH6PkXqnurrUFr4Iu96TFM8hShbAdkXAzo4rGXJl\n6mY5yvryIwfnH0Nmbu3fyqynyb/rPPx06XA1SNp0JCQ+lE+lRqt3ucsnirf9KqWb\nDZ5b9lMIG5RjwXfF+WLF8eSxhernFQO3OQIEovUw9x84u0FD16A9AmxCjgIlpBgi\nqde5ynaXDlbnBJUwI811aG6Vzvvtp3BtsE8mhZcGMsHIVQ3jmrZYd0lBeLeSgbr9\ns1NYxyxw5InJlwUavReIhemcKnX9kUZmCtwiJ8y80yKeOILMH0LTIHnyLGSkw8VY\nnuOrDxiRFWXS034I3zVUGZsJMTCIcfTdGxKjwR9JWNpgm28sl8PUGeAivp1VXPMg\nVHH0Do5NsafR5K0OuybVm7z1jm0hLmHR73yr/C2LM3oP+j32yEqTymcFPa6DgW61\n+6v0nlR0qZlW6Qmg8/tUaKVeeyTT9WJfgNmYYfoos2L+5FslcImT5jsGnD/He/Vj\nPC/9YiYgkVdH1dl6vTo5Cew759QiVAR7JaQ0lnube8rh7tvD9LehrS3il7lkdHFY\nVFi780xdJ6K6DpjUSUviNfAIKTisNpDe2GEuEpqaAy6p8hSYPTcnEH9nP+64zj8+\nbYVrna8rZj2WaVJDvwiPrS6n+BuMRkWC8elDfCcMQPeRQwwuQdYnJ4wmxSFr7mD/\nopR/mMzGtLKVoD2yH0tzpwfXfFevNTyvgg3IrfVklmHmyDr9DizlXcALRj1nfYD5\nuZofGaug47EChXmKPBeM3yWnZ1Xvbq92zu8b9R1uYum1mmoh/+PUnrKd6pMOdfYK\nCPpoFotKz9wDmg6vupHymkflx86Rea7dzyxlbaQW+O6QMgaOsCfz4WtpA7Fwrgxr\nUlZpTLLB/i4E/dfn1O/eiz/8i/+GfcFtORESJBilPyjOIOOeBsD1YSXtGbBmRpGO\nXQlc4gvr2lah31S0koNxi3vRFXU35iww4heCEM4vRd2knLKLlkRZ27GbUXkCNwvX\nAL6mW10W7LyOb1Xij1flEpKKN8kEwUYTdycRn6eGXbhWBzQlLc2BHiZ6voKCCnUd\nKEzY1ity9k2wOYSg7JmuV4prGDjw5Q==\n=Ld82\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7c9344319d201fb7368118e4352cfcf6dbda40c6",
          "sha": "7c9344319d201fb7368118e4352cfcf6dbda40c6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7c9344319d201fb7368118e4352cfcf6dbda40c6"
        }
      ],
      "message": "rpc: use Synced<T> for g_deadline_timers and remove g_deadline_timers_mutex\n\nConvert `g_deadline_timers` to use `Synced<T>` and ditch the global mutex\n`g_deadline_timers_mutex`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:28Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T13:02:51Z"
      },
      "sha": "64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc5OGNjN2QxMDEwMGJjMzU5YTE2YWI2MWVmYTYyZTczMjE2NTZmOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/798cc7d10100bc359a16ab61efa62e7321656f95",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/798cc7d10100bc359a16ab61efa62e7321656f95",
      "tree": {
        "sha": "6ba9de43e52e8701ba4acafba392620931833706",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6ba9de43e52e8701ba4acafba392620931833706"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6ba9de43e52e8701ba4acafba392620931833706\nparent 64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4\nauthor Vasil Dimov <vd@FreeBSD.org> 1656335931 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778529 +0200\n\nscripted-diff: rename dir_locks to g_dir_locks\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/\\<dir_locks\\>/g_dir_locks/g' $(git grep -l dir_locks)\n-END VERIFY SCRIPT-\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WEACgkQVN8G9ktV\ny7+iQSAAoo8/qC2UYADO4/a1sjvf4cR45YNCjKlOqFb1z0Hm6Zaru6W8AgdTt4rR\nFVgbD8rRptGCZSB1qX/ryuhcQAGvCObMCm6NeAWkgr6jM/dVCwxXqqNi4XQF+Bly\nlu2d9aC1uVjNJPKmGl3Qv4NgadMaULhWhgp5Y6eysi14iuQpDzQD4BCSuYwYjwiF\n2575NsZcbX2Bfze10F0Nh4ZNReUqno7q+blqAF8BGopMzyfC+NOaNi0tf7BGx4ii\nG1wkmlzLNFFas6JG4HnMS5wr5HG13d44jjgvCFxG/h6FZHLDHM2aWiaOGLVgiCqB\nQIi6+uR+7ZUIPRZ4DNQ6+LlG4LNj0rPgOnVDP5OzsZApDxtiQ9SKTADHmJ1h4otM\nZDP7vQjP8pUiomNFhSHb3mx+Bixztc4o2JztE5GHP8JfNa8EE5OLsbnIKhNs3xk8\nYlfMzNon1FJjywufnrh9+IQsEctIcu0Yvq6S7Ot9xfcOHcv/RTdXpHsi9TbeYqk6\n/01RNuGQvxqwDj4tgO2fb3zrO5Y08Tj9TMnhkcXLXdJuRjdD6VbaJEXe4lAcxQOe\newOeBIQSOe/ctAg20fAcbQtRwYWCosGEN7XPuL2ZATj9VN6W/8hZQ9ni8AlkdYcd\nB6D8sPzMSfZjpzNjWZc8QoS4nllVQK4IFtcVvaEUBCnRMNeDRI1CMhVDAqJqyAtu\nhe9luQCtBuY/5WLQ7g1cv8GxKTfCAdlyl7F7os8FdfZL2De1t0RxUgM3LcmEgswi\nALYLHlg44mknXac1ak/tuH8akFywogJfTQc++ADaW4pj+4zYDaXX2u3jCLDzv+wK\nxMStmfCA2Xdy+Jb2SlidT1VqV8JbU/D1K6HF76y5dpzZAgXb5VUKnvZdA1caXlFq\nEa5tOj00ddrBgiSTP+WDzCSyLobhcEftpwQE0vqHpQK/JVDA0tPCoWdw8jPzxACF\nCZhq6wonHrgDklt+jY00b6bEhEACq6bKUmpJwZClxNuVN+i8quuJ1F9K6lxRwBE/\nFSwf0LjKmjM1zeM46hd53rr/ZOiFYdcxTNuaTeJqymcEvb9Vr5gQ3QMrRMsUc7b6\nSmg2Ibk3RD53a92ifpwMTvqk1V9ylrRFwqfglTuxMZoeGDHwTzX/nJmQsdVntoph\ngFM+BMY4xjHpU8WaVge0h5iJsxwxc8dybmYIw8mTnrDMW9bukFLhIBuPTJp17cYr\nKEBoafUz6QJ0WKgkp+kM/AzRXdQy7TNpg8hl9C1IyRTf1f8T3uimDImL0u1kF2x3\np6JKAlXL8OTAj5oyzKUyAhJVen4rbwFeOwd7bhP1JtOJCpqTVJf8JpY2mKz/SkEi\nBFqHFY3p/HQhALdV++2SCeM58/V8gw==\n=inqb\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4",
          "sha": "64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/64defbdfe1314349f0dd1ea59fe2d1bb31fa67a4"
        }
      ],
      "message": "scripted-diff: rename dir_locks to g_dir_locks\n\n-BEGIN VERIFY SCRIPT-\nsed -i -e 's/\\<dir_locks\\>/g_dir_locks/g' $(git grep -l dir_locks)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:29Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T13:18:51Z"
      },
      "sha": "798cc7d10100bc359a16ab61efa62e7321656f95"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU5Y2M5MmRlYWM0ZTFjODUxYWEyMDYyMDI4OTZmYjc2ZjRkMTMzMDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e9cc92deac4e1c851aa206202896fb76f4d13308",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e9cc92deac4e1c851aa206202896fb76f4d13308",
      "tree": {
        "sha": "caffa7436052d6f916081462100daf593ddd6d93",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/caffa7436052d6f916081462100daf593ddd6d93"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree caffa7436052d6f916081462100daf593ddd6d93\nparent 798cc7d10100bc359a16ab61efa62e7321656f95\nauthor Vasil Dimov <vd@FreeBSD.org> 1656336083 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778530 +0200\n\nrpc: use Synced<T> for g_dir_locks and remove cs_dir_locks\n\nConvert `g_dir_locks` to use `Synced<T>` and ditch the global mutex\n`cs_dir_locks`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WIACgkQVN8G9ktV\ny79q5yAAkIlFiaDIFkkKKuw/gy9FfWX1BHi9B28nphHW7BaUWEYSyKBFZvMaYAkB\nr/L/PYPrtChfhIjEEYMKZQ+/L/CRFetMD2PwkEclDwLb3yFDp/pw++c2RnATMcVx\nIC08CdOs7nNBPPFtU46ACRUAiGTXArg4+4LsBuF1Vzj7ohRwrH1XThKbBL5bM3LQ\nqSTAfUXCQg2m0fXDhtnVFEeddQL9MVF4mgGWuZxXFt9OUHFg+53pmAMIjQ2VP6ll\nPebdmWgs2LvCg4/q3LDzgwLA1NeorUzwuHXA6POWrnvh7Vd3yEf5D07IHSa4PCsx\nhl+SyHlRAFbwiIyDIi/nzAkzPkJ8TaSLiNLFe0qBlJFywLyVhtdmQGf4g1mjFKnd\nzolO9sxUQFbvy94NjXGos9hRMdZosK0VL/Rd+5qjkZ7j8yxVsPISFYD7Y9Y1wa1E\nG64mDb3XPq/C56V/vmYWS7OTQiNn0v0/UaKiuDYuuhnwzfuwxQDDnMlDZmspsxqm\nnmAxZAiKd5i4veZ1W6dJv/wptHUxGA/GatWuzhxca8HnQpRHQ2YUcVulVkecHhQc\nwR98PcgZGGr+xy2QSUxHsVX3rSb0X6SXm78QWdnP9gDsUcBY1Vn+ZozDH5gy7mav\njwaPuMlej+rpSkaI71LIS6aDBcNkVJHVqINrLyhSDAbHAwB9LSf7IrpnzgFfqxYV\neTyjdPmHTyRof9IcMbytSliC10UiTG5o+djBk/UM8MhbrHcem2xqA/Of/lOGD8S9\n7Moee+Oeyr+mfoWquEsIfBi4ly6jGgVmgQ04nl2hLVgjRY04Bi7Y/pGKMVubBsm4\ns+HpvRXAgHxtgOie2Y3m05LOxqMLFpMoTR3NSt+beJ9cwhsBHDXPT38+bvE7DK3T\nb/SzooRMbVcNfUPlc7Og+j2t0jWqXWKY4ABDkA9j1pqNF3K3mxKsTEISC7Cw1NdZ\nQWGyBafrgo8W+4wjVi4JFFGY3wPBNdMxBza/EnUhyoaRpdxXWyx9hSsedZjV/YNb\ngiFhL6/LzE0vsyhahJI+BrL175DPMuF0lHK9ceOaGtEA4C3Po6b3E3XARfCt3XJz\ny9HmB01eUC7dzc0cnp1VG+UQjlpg35EGyjtX2EQnVpx0Fg7/QB80E611oWyqJWeG\nE4QQevntnYF/m4rtsBcPacY7cvgqdysbO1LebXHF6gRmX+MI8RcBZpfO/0bQxMhr\nZ53KuMZPVAjsd4nNcjdWlP31NdT9ZBELDQDYVqD+1fWlc+B2I54QoN1SJMYgyM+m\nstPdwiwluISMDLm8NIKP83jKjBQg+1MXMLUhPjEPY2VsfDDeyShH7L40CKxXo7Ot\n1vAlWxDeIO9v6QsMZiOmGwsuqBBrlQ==\n=7VqQ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/798cc7d10100bc359a16ab61efa62e7321656f95",
          "sha": "798cc7d10100bc359a16ab61efa62e7321656f95",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/798cc7d10100bc359a16ab61efa62e7321656f95"
        }
      ],
      "message": "rpc: use Synced<T> for g_dir_locks and remove cs_dir_locks\n\nConvert `g_dir_locks` to use `Synced<T>` and ditch the global mutex\n`cs_dir_locks`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:30Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T13:21:23Z"
      },
      "sha": "e9cc92deac4e1c851aa206202896fb76f4d13308"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQzZTc3MjIzZWJhZjc3M2Y3Njk2NjJlNmM2YTFiMDdkMDVkZmU0Yzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d3e77223ebaf773f769662e6c6a1b07d05dfe4c8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d3e77223ebaf773f769662e6c6a1b07d05dfe4c8",
      "tree": {
        "sha": "de967a36942036222b11d1f70de68a73f91cf8d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/de967a36942036222b11d1f70de68a73f91cf8d1"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree de967a36942036222b11d1f70de68a73f91cf8d1\nparent e9cc92deac4e1c851aa206202896fb76f4d13308\nauthor Vasil Dimov <vd@FreeBSD.org> 1656336877 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778530 +0200\n\nwallet: use Synced<T> for g_loading_wallet_set and remove g_loading_wallet_mutex\n\nConvert `g_loading_wallet_set` to use `Synced<T>` and ditch the global mutex\n`g_loading_wallet_mutex`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WMACgkQVN8G9ktV\ny79S3R/7BtnqrLiIiXZ7sM2Sztzq15hDg1TSaeL0AqGG6UhCNey6iSiHrAE/Jcrb\nKn0zYLAqqE9dUW1ykijHtmIwgyzJCkAsDwe923HzUG0JqqE5++sI3X9rG7oDo3XO\ny8Gmsv3l3JDk9IC4K9wTbQxbB3kiJZJVPskIR0BJZoG+9zQtou0KwG5/W8q3lTQH\ndxGjisdADHNZsex9DWrHJvjGUaW1rjWHgb6E4Hu8MmH4IOeopI0HuWyQsfrkorVc\nySLrsZ9oAwPa7AMks1uLWuX5AoFTZYHmVgXC6PuMUWnFiKEgfsNu3eCSrBmzL4gr\n1+OKyBmjFTTopeKmGIku5YmbeJRVSnKM4EoAgXR0d3Ws25ga9ZlCbZhySB4ZCPH8\na8GhwhPKfe6jz2L5oJ2yk6eUl8E8HmL2pEQcOR1BZBJVwdJlofcy9J/vk2TQFJ3M\nyzbIRap+7Eng4ioz2bE9Ea2l36cxBOt8CrJFu98owfBQsbUKlpBGrf+oF/XidOl0\nnJKGe57gfcVlXOR7rHBGN2IflaLVScPqp4T/2KxZ6/cYtn+zoRdmmAtoCw6FTeHf\nuBfrRrTokJSecUQlKR2/mtH0TpE+bslA6nhGuizGNX6ZcCziomY95WoBhVB09/pf\nIt5aI8Bw7wSjscLsWCswfISWWJ3geHqgZoJioqX3G+PwUbF7fgQ3+evLKOxZeMu8\nF8s0s/4aTZwYG/ZZmQtbX4JOSxZ2vFajwVWcfRTW1InB5RNlk9H1JJ2TZ6tRf6Uk\nB+fpmwu05IhpEdv1brbfbl34uAn+WaY41iouLbTUQY7tbYLAliK7OzXtgLmrK6nj\ndypG2bMm08D4AMoIkD8dnyB5YRdrsRvVG46l2e8XZELr6YBuX6vkd4kWjss+yLti\nFKjetjJBfQMUfpatIxm6ktLyVBvPPf995RSM3Vd7JJuwaSv+u9SdJS/kS/G0H9Wl\npopel1rXm3qABxh/8zPB1viVf6H5EuwpW95yAZfwISUnRAf/KZxf8pd7MKilMNCN\nBv3GWAOmBa9s219dryp0GJ7KI7EqaPnyXMqtxkIBgzaXUaczK7dofapES+tVeqon\nKwXcYfJrTqhM4DLjvhhdf91CBKzeZs7le0NFPalikDigFsi9gx5thGYkwvPNeB8j\nuHtGMW7fRmdpSEwzEmaLMlhAjEPB2tmdO+weAa7FMMmfoLUWta67CFBSCs3UkUgb\nH5rs6ehKWvyiYDbDWOlWhmqp2O3wwsPnzXpLYrfZYn6k3TH5XXBmvMUjN22kYYti\nB0GoyBOaNb1+Je9hqILiIaRrzIoPmEEdnC90bEZhU7ZQoW7inLMdV95M8hEuIbhw\n9HvwmtiY4yTxwxtqfo6m6FMOcUODEw==\n=Jpi8\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e9cc92deac4e1c851aa206202896fb76f4d13308",
          "sha": "e9cc92deac4e1c851aa206202896fb76f4d13308",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e9cc92deac4e1c851aa206202896fb76f4d13308"
        }
      ],
      "message": "wallet: use Synced<T> for g_loading_wallet_set and remove g_loading_wallet_mutex\n\nConvert `g_loading_wallet_set` to use `Synced<T>` and ditch the global mutex\n`g_loading_wallet_mutex`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:30Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T13:34:37Z"
      },
      "sha": "d3e77223ebaf773f769662e6c6a1b07d05dfe4c8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM4YzBkNjI4ZTBiMzZlMmQxZTc4NTYwMWMyZjQwYzRlNDJkYjJlY2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "tree": {
        "sha": "8204f6a8c7bb6199244150ff0e0174b89a1d7d50",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8204f6a8c7bb6199244150ff0e0174b89a1d7d50"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8204f6a8c7bb6199244150ff0e0174b89a1d7d50\nparent d3e77223ebaf773f769662e6c6a1b07d05dfe4c8\nauthor Vasil Dimov <vd@FreeBSD.org> 1656337162 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1689778531 +0200\n\nwallet: use Synced<T> for g_unloading_wallet_set and remove g_wallet_release_mutex\n\nConvert `g_unloading_wallet_set` to use `Synced<T>` and ditch the global mutex\n`g_wallet_release_mutex`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmS3+WMACgkQVN8G9ktV\ny7+xOh/+PpbH83prokLp0st4HcOwLntQE2SAb5bpFL8ttpqu6sm3v49n4y/fMxtq\nhys+lH4gcy0IyBl4h93Z5TwJwiUUy8Ss9mEwZpPdyauB4FPv3H5PBKPqRdw8oIb1\nZTSo4rEbbFAtIxSYM1Ysrae17U+cH/z2eJjD+bLf2wDUGD5GO/JLfeh+x3RZSKyL\nOJF35i4o4LDrY+q81b1wkh94GWLGemYIVP6umFweRPzdlwHaJytLYXdBK89KQ31l\nVzDg9yohJovaezZyG9UlPQbicMnO29zLdhIJ9AaTyAezMqy7RH8Ln5M6b/TY4/PJ\nuzhUTNgMQypXBtXMvsPQL1FAP9lOV+or3i5K/dJfolu5HxlF3I6P7qHK3Z3mgOpM\n2CRav2WkggPC5wdyQKXmSrCoeUZsEFoZ83wHL1NwpCTUeVTR4rR1Z6M5n7OXkzs5\nsD6h2qFvEmDlgmRUd0uHDjrhsWuOBDcH12TtBhWVjGvypBWci1uakDb/phbdBTM+\nVJ+NsUwx3wNSYGurqXqOV3Rf9JqB/2NCCcaQ3IYANrnB9KTP57m1/o19F/W/XKe/\ne3Z4QHSl1MWZU3JdPkz6Tq/kywdK2v9XMxwoOA7zUWU+Svj11725/3dNWfYzHL5r\nvDy4zY6cCCyXtRV0v0MMer8gYJY4mQ0Lt4KgLsGJLAacSt1EeRVjHer5ClhltGxG\nPpzeQt50bsCKaB4hE7M99x/2sFmMm0RRimztHrVfREL3/Fee/25oDpkNoXwTvpVP\nHu5+XGJJsH+T5n0iBce66R4e5Uo8ZX6md5q/GAPA9d9dyUxasJxDRgOvAYpi5+E4\nuMkqZPNnn50vx5zRrMs8mBkejs9z73RBK+moHg6rkDvaOtQO/hT3A1emZGlEBbzR\nzAwvX/y9DCnZL6kIqajf1uujVn0jmK6NXBEM7aALf8YGA44blJXo6KexuyDdEa4R\nJuo9f0rDUn118cHWREItI5l402w8LCgTGw4PFGSjiiKu+nTXCt3i0SsCNJM6moM+\nDp+eQGokaWsnbws4TjBoruwrEZV6vuBcPC24z1IWQGSdVkIBzZVSILTJ3WtPT2MQ\nsMHSGZjy3I8xEcbm1dhgBhzrGslwggQfY7W7bHkpXB81zJ9FoKwmctzsRlsfdzh9\nqER+K6C5R3ETCmbARiZrTXsxsA3D2zm5jsyCQML9CRYWU+NmINlgEccZITRsGfiU\nfT6Bup7qLYCezyuVU8vITOqfJd67Z0ifq8mHhdKOnqK1rk3d/qxkDSG42FQ3nFbI\nECSjuzmDLex826kfZO8E9Rox1Oz2Nw7pMCY64aVmcQ0UXoNAcyvpjV1qiWzob8Pm\nIYI6r9T/s1/zqPkOFZ8iSwELb7tGpQ==\n=WMHt\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d3e77223ebaf773f769662e6c6a1b07d05dfe4c8",
          "sha": "d3e77223ebaf773f769662e6c6a1b07d05dfe4c8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d3e77223ebaf773f769662e6c6a1b07d05dfe4c8"
        }
      ],
      "message": "wallet: use Synced<T> for g_unloading_wallet_set and remove g_wallet_release_mutex\n\nConvert `g_unloading_wallet_set` to use `Synced<T>` and ditch the global mutex\n`g_wallet_release_mutex`.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2023-07-19T14:55:31Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2022-06-27T13:39:22Z"
      },
      "sha": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9863768569,
      "node_id": "HRFPE_lADOABII585L6FX5zwAAAAJL7Sn5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9863768569",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T15:01:19Z"
    },
    {
      "event": "commented",
      "id": 1642275801,
      "node_id": "IC_kwDOABII585h4yPZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1642275801",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T15:11:26Z",
      "updated_at": "2023-07-19T15:11:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "`ebfe47e594...38c0d628e0`: rebase due to conflicts\r\n\r\n@hebasto, if the purpose of the low level code is to make the higher level code more robust and less bug-prone, then I think `Synced` achieves this. The pattern:\r\n\r\n```cpp\r\nMutex m;\r\nType my_variable GUARDED_BY(m);\r\n```\r\n\r\nis very common. The `Synced` structure encapsulates both, enforces the idiom and makes it impossible to \"to abuse the mutex and start using it to protect some more, possibly unrelated stuff\".\r\n\r\nIt also helps remove `GlobalMutex` usages. `GlobalMutex` could be [confusing](https://github.com/bitcoin/bitcoin/pull/27912#discussion_r1259704670).",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1642275801",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25390"
    },
    {
      "event": "mentioned",
      "id": 9863891612,
      "node_id": "MEE_lADOABII585L6FX5zwAAAAJL7wqc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9863891612",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T15:11:27Z"
    },
    {
      "event": "subscribed",
      "id": 9863891630,
      "node_id": "SE_lADOABII585L6FX5zwAAAAJL7wqu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9863891630",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T15:11:27Z"
    },
    {
      "event": "unlabeled",
      "id": 9864471473,
      "node_id": "UNLE_lADOABII585L6FX5zwAAAAJL9-Ox",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9864471473",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-19T16:04:55Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/899366531",
      "pull_request_review_id": 1009459470,
      "id": 899366531,
      "node_id": "PRRC_kwDOABII5841mz6D",
      "diff_hunk": "@@ -400,4 +400,98 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart pointer that protects the owned object with a mutex.\n+ * Every time the pointer is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * {\n+ *     auto v_locked = *v;  // acquires the mutex\n+ *     for (auto& i : v_locked) {\n+ *         i *= 10;\n+ *     }\n+ *     // the mutex is released when `v_locked` is destroyed\n+ * }\n+ * // will result in `v` being `{50, 60, 70, 80}`\n+ * @endcode\n+ */\n+template <typename T>\n+class ThreadSafePtr\n+{\n+public:\n+    /**\n+     * Construct the smart pointer and its internal object of type T,\n+     * passing `args...` to its constructor.\n+     */\n+    template <typename... Args>\n+    ThreadSafePtr(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object. For exaple:\n+     * @code{.cpp}\n+     * Proxy p{mutex, obj}; // acquires the mutex\n+     *\n+     * p->foo(); // `foo()` is a method of `obj`, the mutex is still locked\n+     * p->bar(); // `bar()` is a method of `obj`, the mutex is still locked\n+     *\n+     * // if `obj` provides `operator[]` (e.g. `std::map`), then the following is also ok:\n+     * p[5] = 10; // the mutex is still locked\n+     *\n+     * // if `obj` provides `begin()`/`end()` methods, then the following is also ok:\n+     * for (auto& x : p) { ... } // the mutex is still locked\n+     *\n+     * // the mutex is released when `p` is destroyed\n+     * @endcode\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Mutex& mutex, T& obj)\n+            : m_lock{mutex, \"ThreadSafePtrMutex\", __FILE__, __LINE__},\n+              m_raw_ptr_to_obj{&obj}\n+        {\n+        }\n+\n+        T* operator->() { return m_raw_ptr_to_obj; }\n+        const T* operator->() const { return m_raw_ptr_to_obj; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return (*m_raw_ptr_to_obj)[key];\n+        }\n+\n+        auto begin() { return m_raw_ptr_to_obj->begin(); }\n+        auto end() { return m_raw_ptr_to_obj->end(); }\n+\n+    private:\n+        const UniqueLock<Mutex> m_lock;\n+        T* const m_raw_ptr_to_obj;\n+    };\n+\n+    Proxy operator->() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator->() const { return Proxy{m_mutex, m_obj}; }\n+\n+    Proxy operator*() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator*() const { return Proxy{m_mutex, m_obj}; }",
      "path": "src/sync.h",
      "position": null,
      "original_position": 91,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "3d77fdb3127649d560c8f39d8ab83d32c9d0dff6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"sync: introduce a thread safe smart pointer\" (3d77fdb3127649d560c8f39d8ab83d32c9d0dff6)\r\n\r\nI think it would be an improvement to just give these methods a normal name like `Lock` instead of making them operators. Calling code would change from:\r\n\r\n```c++\r\nauto v_locked = *v;\r\nfor (auto& i : v_locked) ...\r\n```\r\n\r\nto \r\n\r\n```c++\r\nauto v_locked = v.Lock();\r\nfor (auto& i : v_locked) ...\r\n```\r\n\r\nwhich would be clearer and simpler. Proxy class is the actual class acting like a pointer so it needs `*` and `->` methods. But outer `ThreadSafePtr` class is not really a pointer at all, but a container, so there is not a concrete reason it needs to have `*` and `->` members unless that's an aesthetic preference.",
      "created_at": "2022-06-16T17:42:39Z",
      "updated_at": "2022-06-16T18:02:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r899366531",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/899366531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": 486,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/899380437",
      "pull_request_review_id": 1009459470,
      "id": 899380437,
      "node_id": "PRRC_kwDOABII5841m3TV",
      "diff_hunk": "@@ -400,4 +400,98 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart pointer that protects the owned object with a mutex.\n+ * Every time the pointer is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * {\n+ *     auto v_locked = *v;  // acquires the mutex\n+ *     for (auto& i : v_locked) {\n+ *         i *= 10;\n+ *     }\n+ *     // the mutex is released when `v_locked` is destroyed\n+ * }\n+ * // will result in `v` being `{50, 60, 70, 80}`\n+ * @endcode\n+ */\n+template <typename T>\n+class ThreadSafePtr\n+{\n+public:\n+    /**\n+     * Construct the smart pointer and its internal object of type T,\n+     * passing `args...` to its constructor.\n+     */\n+    template <typename... Args>\n+    ThreadSafePtr(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object. For exaple:\n+     * @code{.cpp}\n+     * Proxy p{mutex, obj}; // acquires the mutex\n+     *\n+     * p->foo(); // `foo()` is a method of `obj`, the mutex is still locked\n+     * p->bar(); // `bar()` is a method of `obj`, the mutex is still locked\n+     *\n+     * // if `obj` provides `operator[]` (e.g. `std::map`), then the following is also ok:\n+     * p[5] = 10; // the mutex is still locked\n+     *\n+     * // if `obj` provides `begin()`/`end()` methods, then the following is also ok:\n+     * for (auto& x : p) { ... } // the mutex is still locked\n+     *\n+     * // the mutex is released when `p` is destroyed\n+     * @endcode\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Mutex& mutex, T& obj)\n+            : m_lock{mutex, \"ThreadSafePtrMutex\", __FILE__, __LINE__},\n+              m_raw_ptr_to_obj{&obj}\n+        {\n+        }\n+\n+        T* operator->() { return m_raw_ptr_to_obj; }\n+        const T* operator->() const { return m_raw_ptr_to_obj; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return (*m_raw_ptr_to_obj)[key];\n+        }\n+\n+        auto begin() { return m_raw_ptr_to_obj->begin(); }\n+        auto end() { return m_raw_ptr_to_obj->end(); }\n+\n+    private:\n+        const UniqueLock<Mutex> m_lock;\n+        T* const m_raw_ptr_to_obj;\n+    };\n+\n+    Proxy operator->() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator->() const { return Proxy{m_mutex, m_obj}; }",
      "path": "src/sync.h",
      "position": null,
      "original_position": 88,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "3d77fdb3127649d560c8f39d8ab83d32c9d0dff6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"sync: introduce a thread safe smart pointer\" (3d77fdb3127649d560c8f39d8ab83d32c9d0dff6)\r\n\r\nI'm pretty sure the const version of these -> and * methods are unusable and will always lead to compile errors if you ever tried to call them. If you want to allow accessing contents of const `ThreadSafePtr` objects, probably you need to introduce Proxy/ConstProxy classes similar to c++ iterator/const_interator classes. Otherwise you could drop these const methods.",
      "created_at": "2022-06-16T17:59:12Z",
      "updated_at": "2022-06-16T18:02:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r899380437",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/899380437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 487,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901851921",
      "pull_request_review_id": 1012544031,
      "id": 901851921,
      "node_id": "PRRC_kwDOABII5841wSsR",
      "diff_hunk": "@@ -400,4 +400,98 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart pointer that protects the owned object with a mutex.\n+ * Every time the pointer is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * {\n+ *     auto v_locked = *v;  // acquires the mutex\n+ *     for (auto& i : v_locked) {\n+ *         i *= 10;\n+ *     }\n+ *     // the mutex is released when `v_locked` is destroyed\n+ * }\n+ * // will result in `v` being `{50, 60, 70, 80}`\n+ * @endcode\n+ */\n+template <typename T>\n+class ThreadSafePtr\n+{\n+public:\n+    /**\n+     * Construct the smart pointer and its internal object of type T,\n+     * passing `args...` to its constructor.\n+     */\n+    template <typename... Args>\n+    ThreadSafePtr(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object. For exaple:\n+     * @code{.cpp}\n+     * Proxy p{mutex, obj}; // acquires the mutex\n+     *\n+     * p->foo(); // `foo()` is a method of `obj`, the mutex is still locked\n+     * p->bar(); // `bar()` is a method of `obj`, the mutex is still locked\n+     *\n+     * // if `obj` provides `operator[]` (e.g. `std::map`), then the following is also ok:\n+     * p[5] = 10; // the mutex is still locked\n+     *\n+     * // if `obj` provides `begin()`/`end()` methods, then the following is also ok:\n+     * for (auto& x : p) { ... } // the mutex is still locked\n+     *\n+     * // the mutex is released when `p` is destroyed\n+     * @endcode\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Mutex& mutex, T& obj)\n+            : m_lock{mutex, \"ThreadSafePtrMutex\", __FILE__, __LINE__},\n+              m_raw_ptr_to_obj{&obj}\n+        {\n+        }\n+\n+        T* operator->() { return m_raw_ptr_to_obj; }\n+        const T* operator->() const { return m_raw_ptr_to_obj; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return (*m_raw_ptr_to_obj)[key];\n+        }\n+\n+        auto begin() { return m_raw_ptr_to_obj->begin(); }\n+        auto end() { return m_raw_ptr_to_obj->end(); }\n+\n+    private:\n+        const UniqueLock<Mutex> m_lock;\n+        T* const m_raw_ptr_to_obj;\n+    };\n+\n+    Proxy operator->() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator->() const { return Proxy{m_mutex, m_obj}; }",
      "path": "src/sync.h",
      "position": null,
      "original_position": 88,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "3d77fdb3127649d560c8f39d8ab83d32c9d0dff6",
      "in_reply_to_id": 899380437,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I removed them because they are not needed (currently). In a previous incarnation of this I had it working with `const ThreadSafePtr`, but removed the complications that were required for that.\r\n\r\nCan always extend it (restore these) if `const` objects are necessary.",
      "created_at": "2022-06-20T16:43:10Z",
      "updated_at": "2022-06-20T16:43:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r901851921",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901851921"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 487,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901853708",
      "pull_request_review_id": 1012546455,
      "id": 901853708,
      "node_id": "PRRC_kwDOABII5841wTIM",
      "diff_hunk": "@@ -400,4 +400,98 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart pointer that protects the owned object with a mutex.\n+ * Every time the pointer is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * ThreadSafePtr<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * {\n+ *     auto v_locked = *v;  // acquires the mutex\n+ *     for (auto& i : v_locked) {\n+ *         i *= 10;\n+ *     }\n+ *     // the mutex is released when `v_locked` is destroyed\n+ * }\n+ * // will result in `v` being `{50, 60, 70, 80}`\n+ * @endcode\n+ */\n+template <typename T>\n+class ThreadSafePtr\n+{\n+public:\n+    /**\n+     * Construct the smart pointer and its internal object of type T,\n+     * passing `args...` to its constructor.\n+     */\n+    template <typename... Args>\n+    ThreadSafePtr(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object. For exaple:\n+     * @code{.cpp}\n+     * Proxy p{mutex, obj}; // acquires the mutex\n+     *\n+     * p->foo(); // `foo()` is a method of `obj`, the mutex is still locked\n+     * p->bar(); // `bar()` is a method of `obj`, the mutex is still locked\n+     *\n+     * // if `obj` provides `operator[]` (e.g. `std::map`), then the following is also ok:\n+     * p[5] = 10; // the mutex is still locked\n+     *\n+     * // if `obj` provides `begin()`/`end()` methods, then the following is also ok:\n+     * for (auto& x : p) { ... } // the mutex is still locked\n+     *\n+     * // the mutex is released when `p` is destroyed\n+     * @endcode\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Mutex& mutex, T& obj)\n+            : m_lock{mutex, \"ThreadSafePtrMutex\", __FILE__, __LINE__},\n+              m_raw_ptr_to_obj{&obj}\n+        {\n+        }\n+\n+        T* operator->() { return m_raw_ptr_to_obj; }\n+        const T* operator->() const { return m_raw_ptr_to_obj; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return (*m_raw_ptr_to_obj)[key];\n+        }\n+\n+        auto begin() { return m_raw_ptr_to_obj->begin(); }\n+        auto end() { return m_raw_ptr_to_obj->end(); }\n+\n+    private:\n+        const UniqueLock<Mutex> m_lock;\n+        T* const m_raw_ptr_to_obj;\n+    };\n+\n+    Proxy operator->() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator->() const { return Proxy{m_mutex, m_obj}; }\n+\n+    Proxy operator*() { return Proxy{m_mutex, m_obj}; }\n+    const Proxy operator*() const { return Proxy{m_mutex, m_obj}; }",
      "path": "src/sync.h",
      "position": null,
      "original_position": 91,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "3d77fdb3127649d560c8f39d8ab83d32c9d0dff6",
      "in_reply_to_id": 899366531,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Renamed `operator*()` to `Lock()`. The `operator->()` is needed in order to cause a chained `->` calls.\r\n\r\nNotice that the call:\r\n\r\n```cpp\r\n(*g_my_net_addr)[my_net_addr_entry] = lsi;\r\n```\r\n\r\nnow becomes:\r\n\r\n```cpp\r\ng_my_net_addr.Lock()[my_net_addr_entry] = lsi;\r\n```",
      "created_at": "2022-06-20T16:46:10Z",
      "updated_at": "2022-06-20T16:46:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r901853708",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/901853708"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": 486,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 490,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919129254",
      "pull_request_review_id": 1036036999,
      "id": 919129254,
      "node_id": "PRRC_kwDOABII5842yMym",
      "diff_hunk": "@@ -400,4 +405,178 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects the owned object with a mutex.\n+ * Every time the container is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * for (auto& i : v.Lock()) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not change between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_owner{}, m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object.\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            // Avoid double-lock if the current thread is already the owner.\n+            // This read of parent.m_owner is unprotected but that is ok because\n+            // the result of the comparison to the current thread cannot be\n+            // changed by other, concurrently executing, threads.\n+            : m_lock{parent.m_owner == std::this_thread::get_id() ? nullptr : &parent.m_mutex,\n+                     mutex_name,\n+                     file_name,\n+                     line},",
      "path": "src/sync.h",
      "position": null,
      "original_position": 79,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "618809ab6b1f1c67ea3e299626f1ccb89f55d9f1",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"sync: introduce a thread safe smart container\" (618809ab6b1f1c67ea3e299626f1ccb89f55d9f1)\r\n\r\nIt seems like you could avoid this `m_owner` stuff by just replacing `Mutex` with `RecursiveMutex` below. Otherwise this code just seems like it is implementing `RecursiveMutex` on top of `Mutex`, which only makes it more complex and probably less efficient than using `RecursiveMutex` directly.\r\n\r\nMaybe it would be better to disallow double locking and use clang thread annotations to prevent obvious cases of double locking at compile time. But maybe this is not possible. And allowing double locking doesn't seem like an inherently bad thing here apart from the slight performance overhead. Code fragility problems associated with recursive mutex usage don't seem like they would be an problem here since the mutex is private and the class has a limited interface.",
      "created_at": "2022-07-12T15:44:27Z",
      "updated_at": "2022-07-12T16:06:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r919129254",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919129254"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": 457,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919824769",
      "pull_request_review_id": 1037006128,
      "id": 919824769,
      "node_id": "PRRC_kwDOABII584202mB",
      "diff_hunk": "@@ -400,4 +405,178 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects the owned object with a mutex.\n+ * Every time the container is dereferenced a mutex is acquired and held locked\n+ * for the duration of the method being executed. For example, the following is\n+ * safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * for (auto& i : v.Lock()) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not change between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_owner{}, m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds a mutex locked for the duration of its\n+     * lifetime and provides access to another object.\n+     */\n+    class Proxy\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            // Avoid double-lock if the current thread is already the owner.\n+            // This read of parent.m_owner is unprotected but that is ok because\n+            // the result of the comparison to the current thread cannot be\n+            // changed by other, concurrently executing, threads.\n+            : m_lock{parent.m_owner == std::this_thread::get_id() ? nullptr : &parent.m_mutex,\n+                     mutex_name,\n+                     file_name,\n+                     line},",
      "path": "src/sync.h",
      "position": null,
      "original_position": 79,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "618809ab6b1f1c67ea3e299626f1ccb89f55d9f1",
      "in_reply_to_id": 919129254,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I agree. Simplified this by removing `m_owner` and using `RecursiveMutex`.\r\n\r\nThis reduced the `Synced` implementation from 110 to 58 lines (excluding comments).\r\n\r\nIt is possible to further reduce it by removing `Synced::UniqueLock` but then call sites would have to use `auto lock = foo.Lock();` instead of the sweet `LOCK(foo);`. I think either way is fine.\r\n\r\n> Maybe it would be better to disallow double locking and use clang thread annotations to prevent obvious cases of double locking at compile time. But maybe this is not possible.\r\n\r\nI will look at this again, but last time I tried I couldn't do that - stumbled on some limitations and bizarre behavior that looked like a bug in the thread safety annotations. Notice that even now some cases are prevented at compile time, like:\r\n\r\n```cpp\r\nLOCK(foo);\r\n...\r\nLOCK(foo);\r\n```",
      "created_at": "2022-07-13T08:54:51Z",
      "updated_at": "2022-07-13T08:54:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r919824769",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/919824769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": 457,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978269158",
      "pull_request_review_id": 1117913698,
      "id": 978269158,
      "node_id": "PRRC_kwDOABII5846TzPm",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "After a lot of poking at this, I believe what's necessary to make clang's thread safety logic actually notice that this function grabs a lock is to annotate the move constructor of `Proxy`, ie `Proxy(Proxy&&) EXCLUSIVE_LOCK_FUNCTION(mutex) = default`. https://reviews.llvm.org/D41933?id=129496\r\n\r\nUnfortunately, I don't think that's sufficient to avoid clang getting confused about aliasing; at least the ways I've tried haven't worked.",
      "created_at": "2022-09-23T05:07:40Z",
      "updated_at": "2022-09-28T17:07:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r978269158",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/978269158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982661098",
      "pull_request_review_id": 1117913698,
      "id": 982661098,
      "node_id": "PRRC_kwDOABII5846kjfq",
      "diff_hunk": "@@ -400,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex",
      "path": "src/sync.h",
      "position": null,
      "original_position": 56,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "11ac578f9132ed76191d03d5100fc88b6ada6a8a",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think we should be doing more recursive mutex stuff (they're harder to reason about, and less efficient any time that matters). I haven't been able to figure out a way of doing this sensibly otherwise, however -- clang just gets too confused about aliasing.",
      "created_at": "2022-09-28T17:03:13Z",
      "updated_at": "2022-09-28T17:07:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r982661098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/982661098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983367668",
      "pull_request_review_id": 1125046640,
      "id": 983367668,
      "node_id": "PRRC_kwDOABII5846nP_0",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, me too. Clang keeps emitting bogus warnings about loops like `for (auto& a : *obj)` for everything I tried, so I gave up. It has its limitations after all.",
      "created_at": "2022-09-29T10:30:58Z",
      "updated_at": "2022-09-29T10:30:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r983367668",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983367668"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983384482",
      "pull_request_review_id": 1125068091,
      "id": 983384482,
      "node_id": "PRRC_kwDOABII5846nUGi",
      "diff_hunk": "@@ -400,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex",
      "path": "src/sync.h",
      "position": null,
      "original_position": 56,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "11ac578f9132ed76191d03d5100fc88b6ada6a8a",
      "in_reply_to_id": 982661098,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It used `Mutex` before and mimicked a `RecursiveMutex`, but I totally agree with @ryanofsky's [comment](https://github.com/bitcoin/bitcoin/pull/25390#discussion_r919129254) and changed it to `RecursiveMutex`.\r\n\r\nEven before that there was another approach which did not need a recursive mutex, and double locking was not allowed, but [you did not like that](https://github.com/bitcoin/bitcoin/pull/25390#issuecomment-1158434634).",
      "created_at": "2022-09-29T10:48:14Z",
      "updated_at": "2022-09-29T10:48:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r983384482",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983384482"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983877979",
      "pull_request_review_id": 1125785021,
      "id": 983877979,
      "node_id": "PRRC_kwDOABII5846pMlb",
      "diff_hunk": "@@ -400,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex",
      "path": "src/sync.h",
      "position": null,
      "original_position": 56,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "11ac578f9132ed76191d03d5100fc88b6ada6a8a",
      "in_reply_to_id": 982661098,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In my opinion: we shouldn't allow double locking (for almost all locks), and should give compile time errors when double locking is attempted. I'd love to see a variant of this that achieved both those things.",
      "created_at": "2022-09-29T18:06:47Z",
      "updated_at": "2022-09-29T18:06:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r983877979",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983877979"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983913168",
      "pull_request_review_id": 1125836760,
      "id": 983913168,
      "node_id": "PRRC_kwDOABII5846pVLQ",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh!! How about this:\r\n\r\n```c++\r\ntemplate<typename T>\r\nstruct Guarded\r\n{\r\nprivate:\r\n    mutable Mutex m;\r\n    T obj GUARDED_BY(m);\r\npublic:\r\n    class SCOPED_LOCKABLE Proxy\r\n    {\r\n    private:\r\n        Guarded& g;\r\n    public:\r\n        Proxy(Guarded& g) EXCLUSIVE_LOCK_FUNCTION(g.m) : g{g}\r\n        {\r\n            g.m.lock();\r\n        }\r\n        ~Proxy() UNLOCK_FUNCTION() { g.m.unlock(); }\r\n\r\n        T& operator*() { return g.obj; }\r\n        T* operator->() { return &g.obj; }\r\n    };\r\n};\r\n\r\n#define PROXY(name, guarded) decltype(guarded)::Proxy name{guarded};\r\n\r\nGuarded<uint32_t> global_i;\r\nGuarded<std::vector<uint32_t>> global_nums;\r\nvoid foo()\r\n{\r\n    PROXY(p, global_i);\r\n    *p = 5;\r\n    *p += 6;\r\n    // PROXY(p2, global_i); // error: acquiring mutex 'global_i.m' that is already held [-Werror,-Wthread-safety-analysis]\r\n    // *p2 = 9;\r\n}\r\n\r\nint64_t lock_already_held(Guarded<std::vector<uint32_t>>::Proxy &p)\r\n{\r\n    int64_t j = 0;\r\n    for (auto i : *p) { j += i; }\r\n    return j;\r\n}\r\n\r\nint64_t bar()\r\n{\r\n    PROXY(p, global_nums);\r\n    int64_t j = 0;\r\n    for (auto i : *p) { j += i; }\r\n    return j + lock_already_held(p);\r\n}\r\n```\r\n\r\nThat:\r\n\r\n * gives compile time errors if you try accessing without a lock\r\n * doesn't require recursive locks\r\n * gives clang compile time errors if you try double locking\r\n\r\nwhich hits everything I wanted, and doesn't even seem too klunky. Perhaps needs some additional work to handle `const`.",
      "created_at": "2022-09-29T18:48:14Z",
      "updated_at": "2022-09-29T18:48:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r983913168",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/983913168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984000714",
      "pull_request_review_id": 1125965581,
      "id": 984000714,
      "node_id": "PRRC_kwDOABII5846pqjK",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re; https://github.com/bitcoin/bitcoin/pull/25390#discussion_r983913168\r\n\r\nThis suggestion seems very good. I'm still not sure how broadly useful this locking container would be, but I agree having recursive mutex semantics (however they are implemented) would make using it less safe, so better to avoid that if possible.\r\n\r\nAbout the `Guarded`/`PROXY` suggestion specifically:\r\n\r\n- I wonder if `PROXY` macro is necessary. Could `Guarded` class just have a `auto Lock() { return Proxy{*this}; }` method instead? It seems like that could work just as well in a `for` loop or `auto nums = global_nums->Lock()` statement.\r\n- Maybe rename `s/PROXY/GUARDED_LOCK/` so macro name and class name match. This would also be more consistent with other locking macro names `WAIT_LOCK` and `TRY_LOCK` \r\n- Maybe switch `PROXY(name, guarded)` argument order for consistency with `WAIT_LOCK` and `TRY_LOCK` where the new variable name argument is last, and the existing mutex argument is first.\r\n",
      "created_at": "2022-09-29T20:35:14Z",
      "updated_at": "2022-09-29T20:35:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r984000714",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984000714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984106710",
      "pull_request_review_id": 1126113893,
      "id": 984106710,
      "node_id": "PRRC_kwDOABII5846qEbW",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think the macro is necessary -- otherwise `return Proxy{*this}` means you have to annotate the `Proxy(Proxy&&)` move constructor, but the only thing you can annotate that with is locking its internal reference to `g.m` but that then creates an alias of the mutex which prevents clang from detecting when double locking is happening since clang can't tell that two different invocations are locking aliases of the same lock.\r\n\r\nChanging the name and the argument order makes lots of sense, I just posted it as soon as I found something that worked. `Guarded<T>` probably isn't a great name either. (I think it makes sense for `Proxy` to match whatever the macro is named)",
      "created_at": "2022-09-30T00:01:59Z",
      "updated_at": "2022-09-30T00:01:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r984106710",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/984106710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985802251",
      "pull_request_review_id": 1128402641,
      "id": 985802251,
      "node_id": "PRRC_kwDOABII5846wiYL",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What about this:\r\n\r\n```cpp\r\ntemplate <typename T>\r\nclass Synced\r\n{\r\npublic:\r\n    template <typename... Args>\r\n    Synced(Args... args) : m_obj{args...}\r\n    {\r\n    }\r\n\r\n    class SCOPED_LOCKABLE Proxy : ::UniqueLock<Mutex>\r\n    {\r\n    public:\r\n        Proxy(Synced& parent) EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\r\n            : ::UniqueLock<Mutex>{parent.m_mutex, \"...\", \"...\", 123}, m_parent{parent}\r\n        {\r\n        }\r\n\r\n        ~Proxy() UNLOCK_FUNCTION() {}\r\n\r\n        T& operator*()\r\n        {\r\n            return m_parent.m_obj;\r\n        }\r\n\r\n        T* operator->()\r\n        {\r\n            return &m_parent.m_obj;\r\n        }\r\n\r\n    private:\r\n        Synced& m_parent;\r\n    };\r\n\r\nprivate:\r\n    mutable Mutex m_mutex;\r\n    T m_obj GUARDED_BY(m_mutex);\r\n};\r\n\r\n#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced}\r\n```\r\n\r\nWith example usage:\r\n\r\n```cpp\r\nSynced<std::vector<int>> synced{1, 2, 3, 4};\r\n\r\n{\r\n    SYNCED_LOCK(synced, p);\r\n\r\n    p->push_back(5);\r\n}\r\n\r\n{\r\n    SYNCED_LOCK(synced, p);\r\n\r\n    std::cout << (*p)[0] << std::endl;\r\n\r\n    for (auto& i : *p) {\r\n        std::cout << i << std::endl;\r\n    }\r\n}\r\n```\r\n\r\nWe lose the sweet syntax:\r\n\r\n```cpp\r\nSynced<std::vector<int>> synced{1, 2, 3, 4};\r\n\r\nsynced->push_back(5);\r\n```\r\n\r\ncompared to the other variants, but this would still offer simplifications in higher level code and if you are ok with it, then I am fine.\r\n",
      "created_at": "2022-10-03T13:46:53Z",
      "updated_at": "2022-10-03T13:51:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r985802251",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/985802251"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986153213",
      "pull_request_review_id": 1128915124,
      "id": 986153213,
      "node_id": "PRRC_kwDOABII5846x4D9",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm not sure what the differences are between you're quoting above vs what I suggested? They currently look pretty much the same to me? (I was going to check that `begin`/`end`/`op[]` didn't create double locking issues, but you've gotten rid of them already)\r\n\r\nI think it'd be worth adding `LIFETIMEBOUND` annotations (from attributes.h) as well. Perhaps you should delete the move constructor for `Synced`?\r\n\r\nI agree `synced->push_back(5)` is pretty, but it seems likely to be bug prone to me: consider `it = synced_map->find(key)` -- the lock will be released as soon as the iterator is returned, allowing `it` to be immediately invalidated. So I kind of think we should just count ourselves lucky that we can't make it work and callers have to be explicit about the lock scope...",
      "created_at": "2022-10-03T19:37:33Z",
      "updated_at": "2022-10-03T19:37:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r986153213",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986153213"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986156191",
      "pull_request_review_id": 1128919465,
      "id": 986156191,
      "node_id": "PRRC_kwDOABII5846x4yf",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It might be nice to have a `ConstProxy` variant too, so that if you have a `const` reference to an object containing a `Synced<foo>` you can still access have synced access to the object as `const foo`. On the other hand, maybe better to worry about that when an actual use comes up.",
      "created_at": "2022-10-03T19:41:27Z",
      "updated_at": "2022-10-03T19:41:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r986156191",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986156191"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986218855",
      "pull_request_review_id": 1129009189,
      "id": 986218855,
      "node_id": "PRRC_kwDOABII5846yIFn",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`Proxy : ::UniqueLock<Mutex>` -- isn't it better to say `private` explicitly? (Guess who just assumed it defaulted to `public` until the compiler told him otherwise...)",
      "created_at": "2022-10-03T20:52:05Z",
      "updated_at": "2022-10-03T20:52:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r986218855",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986218855"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986548377",
      "pull_request_review_id": 1129459998,
      "id": 986548377,
      "node_id": "PRRC_kwDOABII5846zYiZ",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I'm not sure what the differences are between you're quoting above vs what I suggested?\r\n\r\nYes, they are pretty much the same. The question was maybe more directed to @ryanofsky - if he is ok with that. I want to avoid pushing another iteration of this PR and it to be shot by somebody shortly after :) If you both agree on the above, then lets do that!\r\n\r\nTo-polish: LIFETIMEBOUND, delete the Synced move constructor, consider const, explicit inheritance type.",
      "created_at": "2022-10-04T07:59:19Z",
      "updated_at": "2022-10-04T07:59:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r986548377",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/986548377"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987678673",
      "pull_request_review_id": 1131084530,
      "id": 987678673,
      "node_id": "PRRC_kwDOABII58463sfR",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If you made `m_obj` and `m_mutex` be protected instead of private, that would allow you to write:\r\n\r\n```c++\r\nclass MyFoo : public Synced<foo>\r\n{\r\npublic:\r\n    int pretty() EXCLUSIVE_LOCKS_REQUIRED(!m_mutex) { LOCK(m_mutex); return m_obj.pretty(); }\r\n};\r\n```\r\n\r\nand then do `i = myfoo.pretty();` -- gets you the same end result as the `synced->pretty()` stuff, but only for things you explicitly add a wrapper for, which at least also gives you a chance to make sure it's actually safe to be used in isolation?",
      "created_at": "2022-10-05T08:43:45Z",
      "updated_at": "2022-10-05T08:44:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r987678673",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987678673"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987701975",
      "pull_request_review_id": 1131117742,
      "id": 987701975,
      "node_id": "PRRC_kwDOABII58463yLX",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ok, I wouldn't add features that are not used anywhere, but `s/private/protected` is not actually more code. Makes sense if somebody wants to inherit it and do more involved things.\r\n\r\nTo-polish: LIFETIMEBOUND, delete the Synced move constructor, consider const, explicit inheritance type, protected `m_mutex` and `m_obj`.\r\n\r\n@ryanofsky, what do you think?",
      "created_at": "2022-10-05T09:09:05Z",
      "updated_at": "2022-10-05T09:09:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r987701975",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/987701975"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/988059337",
      "pull_request_review_id": 1131632960,
      "id": 988059337,
      "node_id": "PRRC_kwDOABII58465JbJ",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> To-polish: LIFETIMEBOUND, delete the Synced move constructor, consider const, explicit inheritance type, protected `m_mutex` and `m_obj`.\r\n> \r\n> @ryanofsky, what do you think?\r\n\r\nAll of these tweaks sound good to me.\r\n\r\nGenerally speaking about the PR as a whole, I'm skeptical the `Synced` class will be broadly useful, but I think it's a simple enough utility that can be used in a few places without many drawbacks, and that it's worth experimenting with. I was more interested in the class previously when I thought it was a locking pointer enforcing use of an external mutex (that could be used to migrate code away from using `cs_main`), than a locking container that just used an internal mutex. But it seems like a good thing to use in places where it fits.",
      "created_at": "2022-10-05T15:26:01Z",
      "updated_at": "2022-10-05T15:27:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r988059337",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/988059337"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993246868",
      "pull_request_review_id": 1138790112,
      "id": 993246868,
      "node_id": "PRRC_kwDOABII5847M76U",
      "diff_hunk": "@@ -400,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex",
      "path": "src/sync.h",
      "position": null,
      "original_position": 56,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "11ac578f9132ed76191d03d5100fc88b6ada6a8a",
      "in_reply_to_id": 982661098,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done - in the latest incarnation no double locking is allowed.",
      "created_at": "2022-10-12T09:51:05Z",
      "updated_at": "2022-10-12T09:51:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r993246868",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993246868"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 432,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993256070",
      "pull_request_review_id": 1138803669,
      "id": 993256070,
      "node_id": "PRRC_kwDOABII5847M-KG",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Updated, I only left the `const` stuff away, since it is not needed now and can be added later if needed.\r\n\r\nFor the usefulness of the `Synced` class, see the OP, I updated it with some of the benefits.",
      "created_at": "2022-10-12T10:00:23Z",
      "updated_at": "2022-10-12T10:22:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r993256070",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/993256070"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997762368",
      "pull_request_review_id": 1145151729,
      "id": 997762368,
      "node_id": "PRRC_kwDOABII5847eKVA",
      "diff_hunk": "@@ -398,4 +398,104 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A smart container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access.\n+ * For example, the following is safe:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v;\n+ *\n+ * std::thread t1{[&v]() { v->push_back(5); }};\n+ * std::thread t2{[&v]() { v->push_back(6); }};\n+ * @endcode\n+ *\n+ * It is possible so acquire the mutex for longer time than just for a single call:\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{5, 6, 7, 8};\n+ *\n+ * // v is locked for the entire duration of the loop\n+ * for (auto& i : *v) {\n+ *     i *= 10;\n+ * }\n+ *\n+ * {\n+ *     LOCK(v);\n+ *     size_t size = v->size();\n+ *     // The container will not be changed by another thread between the two size() calls.\n+ *     assert(size == v->size());\n+ * }\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced : public RecursiveMutex\n+{\n+public:\n+    /**\n+     * Construct the smart container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class Proxy : ::UniqueLock<RecursiveMutex>\n+    {\n+    public:\n+        Proxy(Synced& parent, const char* mutex_name, const char* file_name, int line)\n+            : ::UniqueLock<RecursiveMutex>{parent, mutex_name, file_name, line},\n+              m_obj_ref{parent.m_obj}\n+        {\n+        }\n+\n+        T* operator->() { return &m_obj_ref; }\n+\n+        template <typename Key>\n+        auto& operator[](Key key)\n+        {\n+            return m_obj_ref[key];\n+        }\n+\n+        auto begin() { return m_obj_ref.begin(); }\n+\n+        auto end() { return m_obj_ref.end(); }\n+\n+    private:\n+        T& m_obj_ref;\n+    };\n+\n+    /**\n+     * Access `m_obj`, holding `this` locked for the duration of the access.\n+     * This causes a chain of `operator->()` calls:\n+     * 1. `Synced::operator->()` is called, which returns `Proxy` (the\n+     * constructor of `Proxy` locks `this`), then\n+     * 2. `Proxy::operator->()` is called, which returns a raw pointer to\n+     * `m_obj` which is dereferenced in order to call the relevant method.\n+     */\n+    Proxy operator->()\n+    {\n+        return Proxy{*this, \"Synced::operator->()\", __FILE__, __LINE__};",
      "path": "src/sync.h",
      "position": null,
      "original_position": 95,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "bca6b06341b089c89fbd5647fdc868258b8c9d5a",
      "in_reply_to_id": 978269158,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, when used with shared locks, it seems like clang's thread safety analysis doesn't actually prevent you from calling non-const member functions of a `GUARDED_BY` object when only holding the lock in shared mode (it does prevent you from doing `a = b`, just not `a.set(b)`). So if you take a shared lock over a vector, then resize it and invalidate everyone elses iterators, clang thinks it's all fine.\r\n\r\nWhich I think means that if we wanted to do shared locking more broadly, then this method might be the safest way we have of it: ie have `SYNCED_SHARED(foo,  fooproxy)` take a shared lock and have `*fooproxy` give a `const Foo&` so you can't accidently modify `foo` while you're potentially sharing it with other threads.\r\n\r\nEDIT: for possible future reference, just doing this looks like it works sensibly:\r\n\r\n```c++\r\nclass Synced\r\n{\r\n...\r\n    class SCOPED_LOCKABLE ConstProxy : public ::UniqueLock<Mutex>\r\n    {\r\n    public:\r\n        ConstProxy(const Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\r\n            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\r\n            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\r\n        {\r\n        }\r\n\r\n        ~ConstProxy() UNLOCK_FUNCTION() {}\r\n\r\n        const T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\r\n\r\n        const T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\r\n\r\n    private:\r\n        const Synced& m_parent;\r\n    };\r\n...\r\n};\r\n\r\n#define SYNCED_SHARED(synced, name) decltype(synced)::ConstProxy name{synced, #synced, __FILE__, __LINE__}\r\n```\r\n\r\nTweaking that to use a `std::shared_lock` instead of `unique_lock` and marking it as `SHARED_LOCK_FUNCTION` instead of exclusive would let us use shared locks pretty easily and safely, I think.\r\n",
      "created_at": "2022-10-18T06:21:09Z",
      "updated_at": "2022-10-18T12:35:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r997762368",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/997762368"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 483,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998159732",
      "pull_request_review_id": 1145740612,
      "id": 998159732,
      "node_id": "PRRC_kwDOABII5847frV0",
      "diff_hunk": "@@ -325,14 +330,17 @@ void SetReachable(enum Network net, bool reachable)\n {\n     if (net == NET_UNROUTABLE || net == NET_INTERNAL)\n         return;\n-    LOCK(g_maplocalhost_mutex);\n-    vfLimited[net] = !reachable;\n+    SYNCED_LOCK(g_reachable_networks, p);\n+    if (reachable) {\n+        p->insert(net);\n+    } else {\n+        p->erase(net);\n+    }\n }\n \n bool IsReachable(enum Network net)\n {\n-    LOCK(g_maplocalhost_mutex);\n-    return !vfLimited[net];\n+    return WITH_SYNCED_LOCK(g_reachable_networks, p, return p->count(net) > 0);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Seems clearer to write that as two lines (`SYNCED_LOCK(); return ..`) to me.",
      "created_at": "2022-10-18T12:44:56Z",
      "updated_at": "2022-10-19T08:05:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r998159732",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998159732"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 343,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998164319",
      "pull_request_review_id": 1145740612,
      "id": 998164319,
      "node_id": "PRRC_kwDOABII5847fsdf",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { SYNCED_LOCK(v, p); p->push_back(7); }};\n+ * std::thread t2{[&v]() { SYNCED_LOCK(v, p); p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, p);\n+ * const size_t size = p->size();\n+ * for (auto& i : *p) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == p->size());\n+ *\n+ * std::cout << (*p)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "c6f1d58b0489c733b6029cca9a70606145155b32",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I wonder if hardcoding the proxy name would be better; something like:\r\n\r\n```c++\r\n#define SYNCED_LOCK(synced) decltype(synced)::Proxy synced##_proxy{synced, #synced, __FILE__, __LINE__}\r\n``` \r\n\r\nthen you write `SYNCED_LOCK(foo); foo_proxy->bar()` and don't have to choose a name, and don't have to worry about remembering what `p` was a proxy for.",
      "created_at": "2022-10-18T12:48:54Z",
      "updated_at": "2022-10-19T08:05:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r998164319",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998164319"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998202653",
      "pull_request_review_id": 1145740612,
      "id": 998202653,
      "node_id": "PRRC_kwDOABII5847f10d",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changing this from a bool array to an unordered set seems surprising, and inverting the logic means introducing an extra place that has to be modified when adding new nets. Wouldn't `Synced<std::bitset<NET_MAX>> g_limited_networks` make more sense?",
      "created_at": "2022-10-18T13:14:38Z",
      "updated_at": "2022-10-19T08:05:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r998202653",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998202653"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998213646",
      "pull_request_review_id": 1145740612,
      "id": 998213646,
      "node_id": "PRRC_kwDOABII5847f4gO",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};\n+",
      "path": "src/net.cpp",
      "position": 22,
      "original_position": 24,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "An alternative approach to splitting these two entries between separate mutexes would be to create an additional struct:\r\n\r\n```c++\r\nstruct NetworkReachability\r\n{\r\n    std::map<CNetAddr, LocalServiceInfo> local_addrs;\r\n    std::set<Network> reachable_nets;\r\n};\r\nSynced<NetworkReachability> g_network_reachability;\r\n```\r\n\r\nand then `SYNCED_LOCK(g_network_reachability, p);` lets you access `p->local_addrs` or `p->reachable_nets`. Hard to see it making much practical difference here either way though.",
      "created_at": "2022-10-18T13:21:56Z",
      "updated_at": "2022-10-19T08:05:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r998213646",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/998213646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011738259",
      "pull_request_review_id": 1165214971,
      "id": 1011738259,
      "node_id": "PRRC_kwDOABII5848TeaT",
      "diff_hunk": "@@ -325,14 +330,17 @@ void SetReachable(enum Network net, bool reachable)\n {\n     if (net == NET_UNROUTABLE || net == NET_INTERNAL)\n         return;\n-    LOCK(g_maplocalhost_mutex);\n-    vfLimited[net] = !reachable;\n+    SYNCED_LOCK(g_reachable_networks, p);\n+    if (reachable) {\n+        p->insert(net);\n+    } else {\n+        p->erase(net);\n+    }\n }\n \n bool IsReachable(enum Network net)\n {\n-    LOCK(g_maplocalhost_mutex);\n-    return !vfLimited[net];\n+    return WITH_SYNCED_LOCK(g_reachable_networks, p, return p->count(net) > 0);",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998159732,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2022-11-02T13:08:53Z",
      "updated_at": "2022-11-02T13:08:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1011738259",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011738259"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 343,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011742090",
      "pull_request_review_id": 1165219536,
      "id": 1011742090,
      "node_id": "PRRC_kwDOABII5848TfWK",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { SYNCED_LOCK(v, p); p->push_back(7); }};\n+ * std::thread t2{[&v]() { SYNCED_LOCK(v, p); p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, p);\n+ * const size_t size = p->size();\n+ * for (auto& i : *p) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == p->size());\n+ *\n+ * std::cout << (*p)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "c6f1d58b0489c733b6029cca9a70606145155b32",
      "in_reply_to_id": 998164319,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sometimes the hardcoded name could become too long/verbose for a too short scope: e.g. `g_reachable_networks_proxy` or `g_reachable_networks_locked` when it is just used on the line below and nowhere else.\r\n\r\nI added now the possibility to call `SYNCED_LOCK()` with 1 or 2 arguments and opted for a `_locked` suffix instead of `_proxy` for the 1-arg case. So the callers have complete flexibility on how to call it.",
      "created_at": "2022-11-02T13:11:43Z",
      "updated_at": "2022-11-02T13:11:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1011742090",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011742090"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011743933",
      "pull_request_review_id": 1165221632,
      "id": 1011743933,
      "node_id": "PRRC_kwDOABII5848Tfy9",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998202653,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "My reasoning is that the most natural way to express this is to have a list of networks that are reachable (or unreachable if the logic is to be inverted) and `std::set` is the best way to do that. Having an array of `bool`s is a bit hackish as it requires that all enums are sequential and start at `0` and requires the existence of `NET_MAX` which smells bad. My plan is to remove `NET_MAX`. Ideally, enum lables should be used without depending on their specific integer values.\r\n\r\nAnyway, if this is controveral I will ditch that change and leave it as `vfLimited[NET_MAX]` since it is not the main topic of this PR. Should I?",
      "created_at": "2022-11-02T13:13:04Z",
      "updated_at": "2022-11-02T13:13:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1011743933",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011743933"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011745178",
      "pull_request_review_id": 1165223092,
      "id": 1011745178,
      "node_id": "PRRC_kwDOABII5848TgGa",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};\n+",
      "path": "src/net.cpp",
      "position": 22,
      "original_position": 24,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998213646,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> ... separate mutexes ...\r\n\r\nWhat you propose will use just one mutex? Anyway, the list of reachable networks is unrelated to the list of local addresses. I do not think they should be grouped into one `struct` or protected by the same mutex.\r\n",
      "created_at": "2022-11-02T13:13:59Z",
      "updated_at": "2022-11-02T13:13:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1011745178",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011745178"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011820462",
      "pull_request_review_id": 1165317969,
      "id": 1011820462,
      "node_id": "PRRC_kwDOABII5848Tyeu",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { SYNCED_LOCK(v, p); p->push_back(7); }};\n+ * std::thread t2{[&v]() { SYNCED_LOCK(v, p); p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, p);\n+ * const size_t size = p->size();\n+ * for (auto& i : *p) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == p->size());\n+ *\n+ * std::cout << (*p)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "c6f1d58b0489c733b6029cca9a70606145155b32",
      "in_reply_to_id": 998164319,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That does not compile on windows: https://cirrus-ci.com/task/4559637407072256?logs=build#L814 :-/\r\n\r\nIf you are ok with this, I will fall back to the 2-arg macro. Then the caller can pick the name depending on their preferences - `p`, `foo_proxy`, `foo_locked` or whatever.",
      "created_at": "2022-11-02T14:06:32Z",
      "updated_at": "2022-11-02T14:06:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1011820462",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1011820462"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012389456",
      "pull_request_review_id": 1166137516,
      "id": 1012389456,
      "node_id": "PRRC_kwDOABII5848V9ZQ",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};\n+",
      "path": "src/net.cpp",
      "position": 22,
      "original_position": 24,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998213646,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, it was an \"alternative .. to .. separate mutexes\". Mostly intended to show using this pattern doesn't require moving everything to a dedicated mutex if that's not desired. In this case, like I said \"hard to see it making much practical difference\" though.",
      "created_at": "2022-11-02T23:50:53Z",
      "updated_at": "2022-11-02T23:50:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1012389456",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012389456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012393276",
      "pull_request_review_id": 1166142677,
      "id": 1012393276,
      "node_id": "PRRC_kwDOABII5848V-U8",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { SYNCED_LOCK(v, p); p->push_back(7); }};\n+ * std::thread t2{[&v]() { SYNCED_LOCK(v, p); p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, p);\n+ * const size_t size = p->size();\n+ * for (auto& i : *p) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == p->size());\n+ *\n+ * std::cout << (*p)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "c6f1d58b0489c733b6029cca9a70606145155b32",
      "in_reply_to_id": 998164319,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If you want naming it to be optional, probably better to have different macros, same as `LOCK(m)` and `WAIT_LOCK(m,g)`. I'm not really sure what I prefer here.",
      "created_at": "2022-11-03T00:00:19Z",
      "updated_at": "2022-11-03T00:00:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1012393276",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1012393276"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016616242",
      "pull_request_review_id": 1172097338,
      "id": 1016616242,
      "node_id": "PRRC_kwDOABII5848mFUy",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};\n+",
      "path": "src/net.cpp",
      "position": 22,
      "original_position": 24,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998213646,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ok, I am leaving it as it is and marking this as resolved. I think it is natural to guard unrelated things with separate mutexes.",
      "created_at": "2022-11-08T13:12:33Z",
      "updated_at": "2022-11-08T13:12:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1016616242",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016616242"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 119,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016618877",
      "pull_request_review_id": 1172101345,
      "id": 1016618877,
      "node_id": "PRRC_kwDOABII5848mF99",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { SYNCED_LOCK(v, p); p->push_back(7); }};\n+ * std::thread t2{[&v]() { SYNCED_LOCK(v, p); p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, p);\n+ * const size_t size = p->size();\n+ * for (auto& i : *p) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == p->size());\n+ *\n+ * std::cout << (*p)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "c6f1d58b0489c733b6029cca9a70606145155b32",
      "in_reply_to_id": 998164319,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I went back to what it was before - `SYNCED_LOCK(object, name)`. The 1-arg macro was used in just one place and it did not compile on windows, not worth it. By selecting the name the caller can choose whether to use a short one for small scopes of a few lines, or a longer and more descriptive one for bigger scopes.",
      "created_at": "2022-11-08T13:15:05Z",
      "updated_at": "2022-11-08T13:15:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1016618877",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1016618877"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1017546338",
      "pull_request_review_id": 1173494530,
      "id": 1017546338,
      "node_id": "PRRC_kwDOABII5848poZi",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998202653,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "enums are sequential and automatically start at 0; and `NET_MAX` is added for precisely that purpose. That's the way these things are designed to be used, it's not hackish or a bad smell...",
      "created_at": "2022-11-09T07:48:35Z",
      "updated_at": "2022-11-09T07:48:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1017546338",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1017546338"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020279585",
      "pull_request_review_id": 1177431099,
      "id": 1020279585,
      "node_id": "PRRC_kwDOABII58480Dsh",
      "diff_hunk": "@@ -115,7 +117,10 @@ bool fDiscover = true;\n bool fListen = true;\n GlobalMutex g_maplocalhost_mutex;\n std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+static Synced<std::unordered_set<Network>> g_reachable_networks{\n+    NET_UNROUTABLE, NET_IPV4, NET_IPV6, NET_ONION, NET_I2P, NET_CJDNS, NET_INTERNAL};",
      "path": "src/net.cpp",
      "position": null,
      "original_position": 23,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "121bee1947f86ebab858cf016ae28ae6c11663ab",
      "in_reply_to_id": 998202653,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I disagree, but that discussion is for another PR. I reverted it back to what it is in `master` - an array of `bool`s.",
      "created_at": "2022-11-11T14:43:04Z",
      "updated_at": "2022-11-11T14:43:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1020279585",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1020279585"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170236041",
      "pull_request_review_id": 1390434676,
      "id": 1170236041,
      "node_id": "PRRC_kwDOABII585FwGKJ",
      "diff_hunk": "@@ -115,9 +116,14 @@ static const uint64_t RANDOMIZER_ID_ADDRCACHE = 0x1cf2e4ddd306dda9ULL; // SHA256\n //\n bool fDiscover = true;\n bool fListen = true;\n-GlobalMutex g_maplocalhost_mutex;\n-std::map<CNetAddr, LocalServiceInfo> mapLocalHost GUARDED_BY(g_maplocalhost_mutex);\n-static bool vfLimited[NET_MAX] GUARDED_BY(g_maplocalhost_mutex) = {};\n+\n+/**\n+ * The local network addresses of this node.\n+ */\n+Synced<std::map<CNetAddr, LocalServiceInfo>> g_my_net_addr;",
      "path": "src/net.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "a49907318fff6d Naming nit, would this be better plural i.e. `g_my_net_addrs`, `g_local_addrs` or `g_my_local_addrs`?",
      "created_at": "2023-04-18T15:46:01Z",
      "updated_at": "2023-04-18T16:09:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170236041",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170236041"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 116,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170240470",
      "pull_request_review_id": 1390434676,
      "id": 1170240470,
      "node_id": "PRRC_kwDOABII585FwHPW",
      "diff_hunk": "@@ -318,23 +323,20 @@ bool AddLocal(const CNetAddr &addr, int nScore)\n \n void RemoveLocal(const CService& addr)\n {\n-    LOCK(g_maplocalhost_mutex);\n     LogPrintf(\"RemoveLocal(%s)\\n\", addr.ToStringAddrPort());\n-    mapLocalHost.erase(addr);\n+    WITH_SYNCED_LOCK(g_my_net_addr, p, p->erase(addr));",
      "path": "src/net.cpp",
      "position": 69,
      "original_position": 69,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Style nit, unsure, would it be a good idea to use named args in the `WITH_SYNCED_LOCK` and `SYNCED_LOCK` calls? More verbose but more clear, though it's not too non-intuitive.\r\n\r\n```suggestion\r\n    WITH_SYNCED_LOCK(g_my_net_addr, /*name=*/p, /*code=*/p->erase(addr));\r\n```",
      "created_at": "2023-04-18T15:48:44Z",
      "updated_at": "2023-04-18T16:22:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170240470",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170240470"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 326,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170242796",
      "pull_request_review_id": 1390434676,
      "id": 1170242796,
      "node_id": "PRRC_kwDOABII585FwHzs",
      "diff_hunk": "@@ -660,13 +660,12 @@ static RPCHelpMan getnetworkinfo()\n     }\n     UniValue localAddresses(UniValue::VARR);\n     {\n-        LOCK(g_maplocalhost_mutex);\n-        for (const std::pair<const CNetAddr, LocalServiceInfo> &item : mapLocalHost)\n-        {\n+        SYNCED_LOCK(g_my_net_addr, p);\n+        for (const auto& [addr, service_info] : *p) {",
      "path": "src/rpc/net.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nice cleanup.",
      "created_at": "2023-04-18T15:50:07Z",
      "updated_at": "2023-04-18T16:09:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170242796",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170242796"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 665,
      "original_line": 665,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170250884",
      "pull_request_review_id": 1390434676,
      "id": 1170250884,
      "node_id": "PRRC_kwDOABII585FwJyE",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { WITH_SYNCED_LOCK(v, p, p->push_back(7); }};\n+ * std::thread t2{[&v]() { WITH_SYNCED_LOCK(v, p, p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, v_locked);\n+ * const size_t size = v_locked->size();\n+ * for (auto& i : *v_locked) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == v_locked->size());\n+ *\n+ * std::cout << (*v_locked)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "373df61bc56 Style nit, unsure, would something like `local_instance` or `local_name` read better than `name` if callers use named args? Feel free to ignore.",
      "created_at": "2023-04-18T15:54:57Z",
      "updated_at": "2023-04-18T16:09:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170250884",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170250884"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170892009",
      "pull_request_review_id": 1391381278,
      "id": 1170892009,
      "node_id": "PRRC_kwDOABII585FymTp",
      "diff_hunk": "@@ -318,23 +323,20 @@ bool AddLocal(const CNetAddr &addr, int nScore)\n \n void RemoveLocal(const CService& addr)\n {\n-    LOCK(g_maplocalhost_mutex);\n     LogPrintf(\"RemoveLocal(%s)\\n\", addr.ToStringAddrPort());\n-    mapLocalHost.erase(addr);\n+    WITH_SYNCED_LOCK(g_my_net_addr, p, p->erase(addr));",
      "path": "src/net.cpp",
      "position": 69,
      "original_position": 69,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": 1170240470,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that's a bit too verbose.",
      "created_at": "2023-04-19T07:02:21Z",
      "updated_at": "2023-04-19T07:02:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170892009",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170892009"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 326,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170894501",
      "pull_request_review_id": 1391385235,
      "id": 1170894501,
      "node_id": "PRRC_kwDOABII585Fym6l",
      "diff_hunk": "@@ -397,4 +398,77 @@ class CSemaphoreGrant\n     }\n };\n \n+/**\n+ * A generic container that protects an owned object with a mutex.\n+ * This is like a mutex with an extension - owning an object of arbitrary type\n+ * and providing a dereference operation which gives access to the owned object\n+ * and transparently locks the mutex for the duration of the access. For example:\n+ *\n+ * @code{.cpp}\n+ * Synced<std::vector<int>> v{4, 5, 6};\n+ *\n+ * std::thread t1{[&v]() { WITH_SYNCED_LOCK(v, p, p->push_back(7); }};\n+ * std::thread t2{[&v]() { WITH_SYNCED_LOCK(v, p, p->push_back(8); }};\n+ *\n+ * SYNCED_LOCK(v, v_locked);\n+ * const size_t size = v_locked->size();\n+ * for (auto& i : *v_locked) {\n+ *     i *= 10;\n+ * }\n+ * // The container will not be changed by another thread between the two size() calls.\n+ * assert(size == v_locked->size());\n+ *\n+ * std::cout << (*v_locked)[0] << std::endl;\n+ *\n+ * @endcode\n+ */\n+template <typename T>\n+class Synced\n+{\n+public:\n+    /**\n+     * Construct the container and its internal object of type T,\n+     * passing `args...` to T's constructor.\n+     */\n+    template <typename... Args>\n+    Synced(Args... args) : m_obj{args...}\n+    {\n+    }\n+\n+    /**\n+     * An auxiliary class that holds the parent locked for the duration of its\n+     * lifetime and provides access to the internal object.\n+     */\n+    class SCOPED_LOCKABLE Proxy : public ::UniqueLock<Mutex>\n+    {\n+    public:\n+        Proxy(Synced& parent LIFETIMEBOUND, const char* name, const char* file, int line)\n+            EXCLUSIVE_LOCK_FUNCTION(parent.m_mutex)\n+            : ::UniqueLock<Mutex>{parent.m_mutex, name, file, line}, m_parent{parent}\n+        {\n+        }\n+\n+        ~Proxy() UNLOCK_FUNCTION() {}\n+\n+        T& operator*() LIFETIMEBOUND { return m_parent.m_obj; }\n+\n+        T* operator->() LIFETIMEBOUND { return &m_parent.m_obj; }\n+\n+    private:\n+        Synced& m_parent;\n+    };\n+\n+protected:\n+    mutable Mutex m_mutex;\n+    T m_obj GUARDED_BY(m_mutex);\n+};\n+\n+#define SYNCED_LOCK(synced, name) decltype(synced)::Proxy name{synced, #synced, __FILE__, __LINE__}",
      "path": "src/sync.h",
      "position": 77,
      "original_position": 77,
      "commit_id": "38c0d628e0b36e2d1e785601c2f40c4e42db2ecb",
      "original_commit_id": "ebfe47e5942fa5e0ce21b44511258b6dfa4cf621",
      "in_reply_to_id": 1170250884,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Named args at call sites look too verbose to me and here a short `name` is ok because the scope if very limited - only used on one line.",
      "created_at": "2023-04-19T07:05:09Z",
      "updated_at": "2023-04-19T07:05:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25390#discussion_r1170894501",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170894501"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25390"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 466,
      "original_line": 466,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660",
    "id": 1559381652,
    "node_id": "PR_kwDOABII585c8kaU",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/28660",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/28660.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/28660.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28660",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28660/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/cbd5bf07d251900b944056bebc7635a9ce9fee6b",
    "number": 28660,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "test: enable reindex readonly test on *BSD",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "see https://github.com/bitcoin/bitcoin/pull/27850#discussion_r1349505585\r\n\r\nOpenBSD and FreeBSD don't have `chattr` but they do have `chflags`, use that method to make the block file immutable for the reindex_readonly test.\r\n\r\nWritten and tested on a VPS running FreeBSD:\r\n```\r\nFreeBSD freebsd-13-1 13.2-RELEASE-p4 FreeBSD 13.2-RELEASE-p4 GENERIC amd64\r\n```",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2023-10-16T20:57:56Z",
    "updated_at": "2023-10-17T19:01:11Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "f1f6699da069e56210550add0fe1a1493ee1bdcd",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "pinheadmz:readonly-bsd",
      "ref": "readonly-bsd",
      "sha": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 61248407,
        "node_id": "MDEwOlJlcG9zaXRvcnk2MTI0ODQwNw==",
        "name": "bitcoin",
        "full_name": "pinheadmz/bitcoin",
        "owner": {
          "login": "pinheadmz",
          "id": 2084648,
          "node_id": "MDQ6VXNlcjIwODQ2NDg=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/pinheadmz",
          "html_url": "https://github.com/pinheadmz",
          "followers_url": "https://api.github.com/users/pinheadmz/followers",
          "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
          "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
          "repos_url": "https://api.github.com/users/pinheadmz/repos",
          "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/pinheadmz/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/pinheadmz/bitcoin",
        "archive_url": "https://api.github.com/repos/pinheadmz/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/pinheadmz/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/pinheadmz/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/pinheadmz/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/pinheadmz/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/pinheadmz/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/pinheadmz/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/pinheadmz/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/pinheadmz/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/pinheadmz/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/pinheadmz/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/pinheadmz/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/pinheadmz/bitcoin/events",
        "forks_url": "https://api.github.com/repos/pinheadmz/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/pinheadmz/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/pinheadmz/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/pinheadmz/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/pinheadmz/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/pinheadmz/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/pinheadmz/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/pinheadmz/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/pinheadmz/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/pinheadmz/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/pinheadmz/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/pinheadmz/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/pinheadmz/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/pinheadmz/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/pinheadmz/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/pinheadmz/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:pinheadmz/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/pinheadmz/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/pinheadmz/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/pinheadmz/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/pinheadmz/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/pinheadmz/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/pinheadmz/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/pinheadmz/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/pinheadmz/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/pinheadmz/bitcoin/hooks",
        "svn_url": "https://github.com/pinheadmz/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 222578,
        "default_branch": "master2",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-10-17T19:48:41Z",
        "created_at": "2016-06-15T23:48:20Z",
        "updated_at": "2023-08-28T13:34:08Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ff6be778f94b65c6bf9748bdb1adce006d04d5dd",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35837,
        "stargazers_count": 71824,
        "watchers_count": 71824,
        "size": 241576,
        "default_branch": "master",
        "open_issues_count": 632,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-10-17T19:50:08Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-10-17T19:04:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 31,
    "deletions": 12,
    "changed_files": 1,
    "commits": 1,
    "review_comments": 19,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 1765264152,
      "node_id": "IC_kwDOABII585pN8sY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1765264152",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-16T20:57:59Z",
      "updated_at": "2023-10-17T15:12:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/28660).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1680966944), [theStack](https://github.com/bitcoin/bitcoin/pull/28660#issuecomment-1765440946), [maflcko](https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1682638026) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28116](https://github.com/bitcoin/bitcoin/pull/28116) (test: update tool_wallet coverage for unexpected writes to wallet by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#issuecomment-1765264152",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28660"
    },
    {
      "event": "labeled",
      "id": 10670606069,
      "node_id": "LE_lADOABII585z_t6mzwAAAAJ8BIb1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10670606069",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-16T20:58:02Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "reviewed",
      "id": 1680966944,
      "node_id": "PRR_kwDOABII585kMYUg",
      "url": null,
      "actor": null,
      "commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK. I'm extracting this to a test utility in https://github.com/bitcoin/bitcoin/pull/28116, if by any chance you prefer to build on that and I'll pull in the commit there.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1680966944",
      "submitted_at": "2023-10-16T21:12:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
    },
    {
      "event": "reviewed",
      "id": 1680974940,
      "node_id": "PRR_kwDOABII585kMaRc",
      "url": null,
      "actor": null,
      "commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1680974940",
      "submitted_at": "2023-10-16T21:16:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-16T23:40:51Z",
      "updated_at": "2023-10-16T23:40:51Z",
      "source": {
        "issue": {
          "id": 1814622705,
          "node_id": "PR_kwDOABII585WCTmu",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28116",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28116/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28116/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28116/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28116",
          "number": 28116,
          "state": "open",
          "state_reason": null,
          "title": "test: update tool_wallet coverage for unexpected writes to wallet",
          "body": "1. Create file permission utilities in the functional test framework based on #27850 and #15687.\r\n\r\n2. PR #15687 added test coverage in `test/functional/tool_wallet.py` to reproduce unexpected writes to the wallet file, as described in issue https://github.com/bitcoin/bitcoin/issues/15608:\r\n\r\n    - wallet tool info unexpectedly writes to the wallet file if the wallet file permissions are read/write\r\n    - wallet tool info raises if the wallet file permissions are read-only\r\n\r\n    Update these tests/docs for the following changes:\r\n\r\n    - addition of descriptor wallets\r\n    - CI migration away from Appveyor\r\n    - allow running tests that need to change file permissions on Linux using chattr\r\n\r\n    Instead of describing the error messages for legacy BDB wallets and descriptor SQLite wallets in a comment, check that the error message is thrown at runtime and document that it shouldn't throw.\r\n\r\n3. Update `feature_reindex_readonly.py` to use the file permission utilities.\r\n4. Improve `wallet_multiwallet.py` coverage, while updating to use the file permission utilities, which enables the test to work on Linux and provides logging and error handling.  Also add a log entry for the test.",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28116",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28116",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28116.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28116.patch"
          },
          "created_at": "2023-07-20T18:56:34Z",
          "updated_at": "2023-10-16T23:40:50Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1765440946,
      "node_id": "IC_kwDOABII585pOn2y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1765440946",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-16T23:49:38Z",
      "updated_at": "2023-10-16T23:49:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, will test on OpenBSD [7.4](https://www.openbsd.org/74.html) in a bit.",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#issuecomment-1765440946",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28660"
    },
    {
      "event": "reviewed",
      "id": 1681976469,
      "node_id": "PRR_kwDOABII585kQOyV",
      "url": null,
      "actor": null,
      "commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "lgtm ACK",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1681976469",
      "submitted_at": "2023-10-17T10:53:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
    },
    {
      "event": "reviewed",
      "id": 1682597129,
      "node_id": "PRR_kwDOABII585kSmUJ",
      "url": null,
      "actor": null,
      "commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1682597129",
      "submitted_at": "2023-10-17T14:54:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10679827191,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8kTr3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10679827191",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T14:56:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10679960745,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8k0Sp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10679960745",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:05:33Z"
    },
    {
      "event": "reviewed",
      "id": 1682638026,
      "node_id": "PRR_kwDOABII585kSwTK",
      "url": null,
      "actor": null,
      "commit_id": "e7db19f42bb50953c6aaaf5997f8ee78eed9dab4",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "lgtm ACK\r\n\r\nPlease squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#pullrequestreview-1682638026",
      "submitted_at": "2023-10-17T15:12:09Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10680189358,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8lsGu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10680189358",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:22:39Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10680203958,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8lvq2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10680203958",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:23:38Z"
    },
    {
      "event": "commented",
      "id": 1766647573,
      "node_id": "IC_kwDOABII585pTOcV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1766647573",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:24:37Z",
      "updated_at": "2023-10-17T15:24:37Z",
      "author_association": "MEMBER",
      "body": "squashed and replaced all the `platform` queries with try/catch tests for the commands themselves.",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#issuecomment-1766647573",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28660"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10680241853,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8l469",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10680241853",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:26:14Z"
    },
    {
      "event": "labeled",
      "id": 10680244514,
      "node_id": "LE_lADOABII585z_t6mzwAAAAJ8l5ki",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10680244514",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T15:26:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNiZDViZjA3ZDI1MTkwMGI5NDQwNTZiZWJjNzYzNWE5Y2U5ZmVlNmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "tree": {
        "sha": "282019539fa252939aa23dfa395a7834603089b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/282019539fa252939aa23dfa395a7834603089b6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 282019539fa252939aa23dfa395a7834603089b6\nparent 90f7d8a7f904ded464b4c03da139ac876e58fbc5\nauthor Matthew Zipkin <pinheadmz@gmail.com> 1697556360 -0400\ncommitter Matthew Zipkin <pinheadmz@gmail.com> 1697561859 -0400\n\ntest: enable reindex readonly test on *BSD and macOS as root\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAmUuvQUACgkQ5+KYS2KJ\nyTpEbg/8DCrykvAacTnU9rFbKh+B/uPPyRPG7DRQpFkO4TPrGGd0M95VF8Fflqmh\nBolZz8pgh7/2+eLA1Vbz/SasrVujwF1SC+OSOoY4c0DT2VMVcp0fkBlsCCVZrXCY\neGlVWYbe9p6M9/vhJassWKQpWEr+vFOaZ0PBNmdR/376GdE1dxwcaISZtjz0ZLr1\nT1h4aeW+lfxkLPzNCF/YMgfO+xLN9LFzarHhVxOKIWVrqW7mnuOmmFdrtvaHr+6I\nPCOKvf8RNchQlcvBq0xnjvabXyJeQzqB119fCVZQdc4SAlssm5D1dU6HDUV9V+8y\nvPixojdYgDuCa7vEYiZQMZ+2ctu5Q64rjE+w/fa6Do1OFfEFHHLl4z7lGwAgGoA8\nbNnKbi78Jasu/8sSFL4Ieak4Fw3TgcTO0Xo2U0DbfiNCr31NI8HOOgY2koeLhjEA\nYSQTCQXw7ZRPKOCxfRfBnR1+cEjK3tN0E324+wUBHoh4PLG3iLS1/SB7LFbOvHzr\nzRMMFnD9PByL1otzYcnWS2XmMbNDxOs2cAkTSM61DypIoVgdW494Yfm6VQjXfwpX\nV93GHxc6VSoSAcfEF1cXA36GCFd9dwauB2iNuecOoFAEyJ/P84OXQlh5oNZebCqU\n5Wl96Nt3Ok5g4HeVdR4MJ9Y1d66R0v0lSHCKrTw26jr48UW0PYM=\n=4VWd\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/90f7d8a7f904ded464b4c03da139ac876e58fbc5",
          "sha": "90f7d8a7f904ded464b4c03da139ac876e58fbc5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/90f7d8a7f904ded464b4c03da139ac876e58fbc5"
        }
      ],
      "message": "test: enable reindex readonly test on *BSD and macOS as root",
      "committer": {
        "name": "Matthew Zipkin",
        "email": "pinheadmz@gmail.com",
        "date": "2023-10-17T16:57:39Z"
      },
      "author": {
        "name": "Matthew Zipkin",
        "email": "pinheadmz@gmail.com",
        "date": "2023-10-17T15:26:00Z"
      },
      "sha": "cbd5bf07d251900b944056bebc7635a9ce9fee6b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10681333699,
      "node_id": "HRFPE_lADOABII585z_t6mzwAAAAJ8qDfD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10681333699",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T16:57:55Z"
    },
    {
      "event": "unlabeled",
      "id": 10682608306,
      "node_id": "UNLE_lADOABII585z_t6mzwAAAAJ8u6qy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10682608306",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-17T19:01:11Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361268939",
      "pull_request_review_id": 1680966944,
      "id": 1361268939,
      "node_id": "PRRC_kwDOABII585RI1DL",
      "diff_hunk": "@@ -51,6 +52,20 @@ def reindex_readonly(self):\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n                     return\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 12,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I assume you checked what this returns locally: `import platform; print(platform.system())`, but how did you check for both platforms?",
      "created_at": "2023-10-16T21:09:59Z",
      "updated_at": "2023-10-17T00:44:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1361268939",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361268939"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361274045",
      "pull_request_review_id": 1680974940,
      "id": 1361274045,
      "node_id": "PRRC_kwDOABII585RI2S9",
      "diff_hunk": "@@ -59,6 +74,8 @@ def reindex_readonly(self):\n \n         if used_chattr:\n             subprocess.check_call(['chattr', '-i', filename])\n+        if used_chflags:\n+            subprocess.check_call(['chflags', 'nouchg', filename])",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 34,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Verified on https://man.openbsd.org/chflags.1 that `uchg` and `nouchg` appear to be the correct values for \"set the user immutable flag (owner or superuser only)\" and \"clear the immutable bit\", respectively.",
      "created_at": "2023-10-16T21:16:24Z",
      "updated_at": "2023-10-16T21:16:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1361274045",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361274045"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361438741",
      "pull_request_review_id": 1681239273,
      "id": 1361438741,
      "node_id": "PRRC_kwDOABII585RJegV",
      "diff_hunk": "@@ -51,6 +52,20 @@ def reindex_readonly(self):\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n                     return\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 12,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "in_reply_to_id": 1361268939,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I literally ran the command on both free and open bsd systems ;-) I already have an OpenBSD server for DNS and just spun up a FreeBSD on Google cloud for this task. ",
      "created_at": "2023-10-17T02:28:59Z",
      "updated_at": "2023-10-17T02:28:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1361438741",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361438741"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361898333",
      "pull_request_review_id": 1681976469,
      "id": 1361898333,
      "node_id": "PRRC_kwDOABII585RLOtd",
      "diff_hunk": "@@ -35,6 +35,7 @@ def reindex_readonly(self):\n         filename.chmod(stat.S_IREAD)\n \n         used_chattr = False\n+        used_chflags = False",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 4,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "3709e2863fd344b7387b1e2ced37adbca9ab9bf5",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nit: Could replace the two boolean with a single `undo_immutable`, which holds an optional lambda to run. (a no-op by default, and set to None if the test should terminate early, and the respective undo command if an util helper was used?)\r\n\r\nThis should reduce the number of symbols, and reduce the mix of `if-else` vs early-`return`. The diff below would look like:\r\n\r\n```diff\r\ndiff --git a/test/functional/feature_reindex_readonly.py b/test/functional/feature_reindex_readonly.py\r\nindex 26531f472b..77716b371e 100755\r\n--- a/test/functional/feature_reindex_readonly.py\r\n+++ b/test/functional/feature_reindex_readonly.py\r\n@@ -53,12 +53,11 @@ class BlockstoreReindexTest(BitcoinTestFramework):\r\n                     return\r\n \r\n         self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\r\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\r\n+        if undo_immutable:\r\n+          with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\r\n             self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\r\n                 expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\r\n-\r\n-        if used_chattr:\r\n-            subprocess.check_call(['chattr', '-i', filename])\r\n+          undo_immutable()\r\n \r\n         filename.chmod(0o777)\r\n \r\n",
      "created_at": "2023-10-17T10:37:16Z",
      "updated_at": "2023-10-17T10:53:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1361898333",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1361898333"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 38,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362271524",
      "pull_request_review_id": 1682597129,
      "id": 1362271524,
      "node_id": "PRRC_kwDOABII585RMp0k",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I think you can now remove the early return, because it should be fine and clearer to run the next line unconditionally.",
      "created_at": "2023-10-17T14:54:41Z",
      "updated_at": "2023-10-17T14:54:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362271524",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362271524"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362275167",
      "pull_request_review_id": 1682602980,
      "id": 1362275167,
      "node_id": "PRRC_kwDOABII585RMqtf",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "heh thanks. Having an issue on macos now...",
      "created_at": "2023-10-17T14:56:45Z",
      "updated_at": "2023-10-17T14:56:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362275167",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362275167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362279856",
      "pull_request_review_id": 1682610274,
      "id": 1362279856,
      "node_id": "PRRC_kwDOABII585RMr2w",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> heh thanks. Having an issue on macos now...\r\n\r\nThe last push (57972250feb3ad61b91c8fbcb01eac1b4b57095f) seems to run fine on arm64 macOS for me.",
      "created_at": "2023-10-17T14:59:37Z",
      "updated_at": "2023-10-17T14:59:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362279856",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362279856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362280718",
      "pull_request_review_id": 1682611620,
      "id": 1362280718,
      "node_id": "PRRC_kwDOABII585RMsEO",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "macOS should be unaffected by this and execute `lambda: None`, no?",
      "created_at": "2023-10-17T15:00:12Z",
      "updated_at": "2023-10-17T15:00:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362280718",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362280718"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362280854",
      "pull_request_review_id": 1682611838,
      "id": 1362280854,
      "node_id": "PRRC_kwDOABII585RMsGW",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jonatack as root?",
      "created_at": "2023-10-17T15:00:16Z",
      "updated_at": "2023-10-17T15:00:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362280854",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362280854"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362283184",
      "pull_request_review_id": 1682615424,
      "id": 1362283184,
      "node_id": "PRRC_kwDOABII585RMsqw",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "OK I see even before this new commit macOS test would NOT work as root. Hm I thought we already went over that. I guess the macOS ci is not running as root?",
      "created_at": "2023-10-17T15:01:47Z",
      "updated_at": "2023-10-17T15:02:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362283184",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362283184"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362283516",
      "pull_request_review_id": 1682615952,
      "id": 1362283516,
      "node_id": "PRRC_kwDOABII585RMsv8",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Are you saying that macOS under root can run this test on master, but not on this pull request?",
      "created_at": "2023-10-17T15:02:00Z",
      "updated_at": "2023-10-17T15:02:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362283516",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362283516"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362286035",
      "pull_request_review_id": 1682620139,
      "id": 1362286035,
      "node_id": "PRRC_kwDOABII585RMtXT",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah. Yes, `sudo test/functional/feature_reindex_readonly.py` stalls.",
      "created_at": "2023-10-17T15:03:46Z",
      "updated_at": "2023-10-17T15:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362286035",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362286035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362286491",
      "pull_request_review_id": 1682620750,
      "id": 1362286491,
      "node_id": "PRRC_kwDOABII585RMteb",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yes, macos as root on master doesnt work. However, this will:\r\n\r\n`if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\" or platform.system() == \"Darwin\":`\r\n\r\nwhats the best style for a triple - or in python?",
      "created_at": "2023-10-17T15:04:03Z",
      "updated_at": "2023-10-17T15:04:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362286491",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362286491"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362289186",
      "pull_request_review_id": 1682625164,
      "id": 1362289186,
      "node_id": "PRRC_kwDOABII585RMuIi",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`if platform.system() in [\"FreeBSD\", \"OpenBSD\", \"Darwin\"]:` there we go ;-)",
      "created_at": "2023-10-17T15:06:00Z",
      "updated_at": "2023-10-17T15:06:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362289186",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362289186"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362292097",
      "pull_request_review_id": 1682630063,
      "id": 1362292097,
      "node_id": "PRRC_kwDOABII585RMu2B",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is very confusing. The last commit should be a refactor. And the first commit shouldn't affect macOS. This is a bug on master already, right?",
      "created_at": "2023-10-17T15:08:11Z",
      "updated_at": "2023-10-17T15:08:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362292097",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362292097"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362292516",
      "pull_request_review_id": 1682630923,
      "id": 1362292516,
      "node_id": "PRRC_kwDOABII585RMu8k",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Latest push e7db19f42bb50953c6aaaf5997f8ee78eed9dab4 works for me as root.",
      "created_at": "2023-10-17T15:08:30Z",
      "updated_at": "2023-10-17T15:09:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362292516",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362292516"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362294614",
      "pull_request_review_id": 1682634277,
      "id": 1362294614,
      "node_id": "PRRC_kwDOABII585RMvdW",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@maflcko the first commit does not affect macos. the second commit is a refactor that also fixes a macos/root bug on master. Want me to separate the macos out to commit 3?",
      "created_at": "2023-10-17T15:10:00Z",
      "updated_at": "2023-10-17T15:10:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362294614",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362294614"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362295287",
      "pull_request_review_id": 1682635377,
      "id": 1362295287,
      "node_id": "PRRC_kwDOABII585RMvn3",
      "diff_hunk": "@@ -50,15 +50,30 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() == \"FreeBSD\" or platform.system() == \"OpenBSD\":\n+            try:\n+                subprocess.run(['chflags', 'uchg', filename], capture_output=True, check=True)\n+                undo_immutable = subprocess.check_call(['chflags', 'nouchg', filename])\n+                self.log.info(\"Made file immutable with chflags\")\n+            except subprocess.CalledProcessError as e:\n+                self.log.warning(str(e))\n+                if e.stdout:\n+                    self.log.warning(f\"stdout: {e.stdout}\")\n+                if e.stderr:\n+                    self.log.warning(f\"stderr: {e.stderr}\")\n+                if os.getuid() == 0:\n+                    self.log.warning(\"Return early on BSD under root, because chflags failed.\")\n+                    undo_immutable = False\n \n-        if used_chattr:\n-            subprocess.check_call(['chattr', '-i', filename])\n+        if undo_immutable:\n+            self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n+            with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n+                self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n+                    expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+            undo_immutable()\n+        else:\n+            return",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 49,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "d72f863ae922a9462a4ffb85caf53ed7de2438d6",
      "in_reply_to_id": 1362271524,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@maflcko yes, running this test as root blocks for me on master as well.",
      "created_at": "2023-10-17T15:10:29Z",
      "updated_at": "2023-10-17T15:10:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362295287",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362295287"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362297036",
      "pull_request_review_id": 1682638026,
      "id": 1362297036,
      "node_id": "PRRC_kwDOABII585RMwDM",
      "diff_hunk": "@@ -50,15 +50,28 @@ def reindex_readonly(self):\n                     self.log.warning(\"Return early on Linux under root, because chattr failed.\")\n                     self.log.warning(\"This should only happen due to missing capabilities in a container.\")\n                     self.log.warning(\"Make sure to --cap-add LINUX_IMMUTABLE if you want to run this test.\")\n-                    return\n-\n-        self.log.debug(\"Attempt to restart and reindex the node with the unwritable block file\")\n-        with self.nodes[0].assert_debug_log(expected_msgs=['FlushStateToDisk', 'failed to open file'], unexpected_msgs=[]):\n-            self.nodes[0].assert_start_raises_init_error(extra_args=['-reindex', '-fastprune'],\n-                expected_msg=\"Error: A fatal internal error occurred, see debug.log for details\")\n+                    undo_immutable = False\n+        if platform.system() in [\"FreeBSD\", \"OpenBSD\", \"Darwin\"]:",
      "path": "test/functional/feature_reindex_readonly.py",
      "position": null,
      "original_position": 25,
      "commit_id": "cbd5bf07d251900b944056bebc7635a9ce9fee6b",
      "original_commit_id": "e7db19f42bb50953c6aaaf5997f8ee78eed9dab4",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What about netbsd? I think you can just run `if chflags --version` or similar here?",
      "created_at": "2023-10-17T15:11:41Z",
      "updated_at": "2023-10-17T15:12:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/28660#discussion_r1362297036",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1362297036"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28660"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 54,
      "side": "RIGHT"
    }
  ]
}
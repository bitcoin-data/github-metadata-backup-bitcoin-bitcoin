{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856",
    "id": 2999849822,
    "node_id": "PR_kwDOABII586yzhNe",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33856",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33856.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33856.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33856",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33856/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
    "number": 33856,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "kernel, validation: Refactor ProcessNewBlock(Headers) to return BlockValidationState",
    "user": {
      "login": "yuvicc",
      "id": 92994932,
      "node_id": "U_kgDOBYr9dA",
      "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yuvicc",
      "html_url": "https://github.com/yuvicc",
      "followers_url": "https://api.github.com/users/yuvicc/followers",
      "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
      "organizations_url": "https://api.github.com/users/yuvicc/orgs",
      "repos_url": "https://api.github.com/users/yuvicc/repos",
      "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/yuvicc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "## Motivation\r\n\r\nThis PR refactors `ProcessNewBlock()` and `ProcessNewBlockHeaders()` to return `BlockValidationState` by value instead of using out-parameters or boolean returns. This follows the pattern established in #31981 (commit 74690f4) which refactored `TestBlockValidity()` in a similar manner.\r\n\r\n### Current Issues\r\n 1. **ProcessNewBlockHeaders()**: Uses an out-parameter `BlockValidationState& state`, making the API less intuitive.\r\n 2. **ProcessNewBlock()**: Returns a simple boolean with no information about *why* validation failed.\r\n 3. **bitcoinkernel API**: `btck_chainstate_manager_process_block()` returns int (0/-1) with no way for library users to determine validation failure reasons without registering callbacks.\r\n\r\nAs noted by @theCharlatan in #33822 [comment](https://github.com/bitcoin/bitcoin/pull/33822#discussion_r2508065115) and can be a fix for that too:\r\n> One thing that could be considered here is returning the BlockValidationState directly instead of having an in/out param. To safely do that I think we'd need to refactor ProcessNewBlockHeaders though, similarly to what was done in 74690f4.\r\n\r\nThe changes are split into 3 commits, see individual commit message for more info.",
    "labels": [],
    "created_at": "2025-11-11T17:23:59Z",
    "updated_at": "2025-11-16T06:59:52Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "4c2c56dc06529522bd0e878e38fbdffdc3070988",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "yuvicc:2025-11-refractor_bool_to_blockvalidationstate",
      "ref": "2025-11-refractor_bool_to_blockvalidationstate",
      "sha": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 758795054,
        "node_id": "R_kgDOLTpLLg",
        "name": "bitcoin",
        "full_name": "yuvicc/bitcoin",
        "owner": {
          "login": "yuvicc",
          "id": 92994932,
          "node_id": "U_kgDOBYr9dA",
          "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/yuvicc",
          "html_url": "https://github.com/yuvicc",
          "followers_url": "https://api.github.com/users/yuvicc/followers",
          "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
          "organizations_url": "https://api.github.com/users/yuvicc/orgs",
          "repos_url": "https://api.github.com/users/yuvicc/repos",
          "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/yuvicc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/yuvicc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/yuvicc/bitcoin",
        "archive_url": "https://api.github.com/repos/yuvicc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/yuvicc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/yuvicc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/yuvicc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/yuvicc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/yuvicc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/yuvicc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/yuvicc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/yuvicc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/yuvicc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/yuvicc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/yuvicc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/yuvicc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/yuvicc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/yuvicc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/yuvicc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/yuvicc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/yuvicc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/yuvicc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/yuvicc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/yuvicc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/yuvicc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/yuvicc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/yuvicc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/yuvicc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/yuvicc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/yuvicc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/yuvicc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/yuvicc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:yuvicc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/yuvicc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/yuvicc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/yuvicc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/yuvicc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/yuvicc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/yuvicc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/yuvicc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/yuvicc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/yuvicc/bitcoin/hooks",
        "svn_url": "https://github.com/yuvicc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 253429,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-11-16T05:58:26Z",
        "created_at": "2024-02-17T05:13:11Z",
        "updated_at": "2025-11-11T17:18:01Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "138726a6f8101e0fe7e9ae701ef17b37fcbdee73",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38207,
        "stargazers_count": 86817,
        "watchers_count": 86817,
        "size": 296021,
        "default_branch": "master",
        "open_issues_count": 739,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-11-15T16:20:03Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-11-16T06:22:23Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 136,
    "deletions": 88,
    "changed_files": 16,
    "commits": 3,
    "review_comments": 5,
    "comments": 2
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU3OGQ5YjJiY2Y2NWNiMzcyOWYyYzdkMzdlMjVhY2MzZTk1MDU3Nzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e78d9b2bcf65cb3729f2c7d37e25acc3e9505778",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e78d9b2bcf65cb3729f2c7d37e25acc3e9505778",
      "tree": {
        "sha": "d8f68213c5a0e2cb82bfa8d5730b3ba82d02a200",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d8f68213c5a0e2cb82bfa8d5730b3ba82d02a200"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d8f68213c5a0e2cb82bfa8d5730b3ba82d02a200\nparent 138726a6f8101e0fe7e9ae701ef17b37fcbdee73\nauthor yuvicc <yuvichh01@gmail.com> 1762863655 +0530\ncommitter yuvicc <yuvichh01@gmail.com> 1762881526 +0530\n\nkernel: Add Handle/View pattern for BlockValidationState\n\nAdd C API functions for managing BlockValidationState lifecycle:\n  - btck_block_validation_state_create()\n  - btck_block_validation_state_copy()\n  - btck_block_validation_state_destroy()\n\nIntroduce BlockValidationStateApi<> template to share common getter methods between BlockValidationState (Handle) and BlockValidationStateView (View) classes in the C++ wrapper.\n\nUpdate ValidationInterface::BlockChecked to use BlockValidationStateView since it doesn't need ownership.\n\nThis changes prepares the kernel API to return BlockValidationState by value in subsequent commits.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEq0Vt2JPkgYR9gctBGAMjJ2EMKBgFAmkTb/YACgkQGAMjJ2EM\nKBiaNQv+OtS3aqyHhqeXgvePU+WqKaI2l0skNGL9VeB2rhymSfAXEIU08G2BrJo8\nIjuFko9cMnbNUu6Ayq2GdXg5w21sBC7UkZH0aFAJpXWTqq0PaGCqlPvLvCNj88y4\n+2A+YyjuD1BlR7GssrfsKDXnFhnlYyWOuNQSHVVB1eTgwe+NWjDISS8NcZMiY9Y5\nEZu0PZ7pOwiEwvhp9VC5mtFrG0zeK7msDbPqPvZE4H2xKjKCbVKT7uWUZUP6sojM\n1K1FDZUTbrZHjqBQOLHpVecykVVqY0UrqT3oHsXaToAlpFf/e1WnAN2Eg67Njdpb\nZKCp1oN74n5BYI3jhAjQw5nsE0lf5LuqDBuAU00SKhxNuWwkAQl70PGGvFppZ1x9\nUofoAJr5mZZ447pDMdh2ROl6VZmE2iIqmFgCTgRYAHU3GLUT31bk1pXNdyRdPlmD\nv60FFK+HfIbStcTX3w9JXPiXQXf8tiikiBNqVYPVDkwSnFM8ZuLxj1Tec18EvgQE\njy+dpBC9\n=idne\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/138726a6f8101e0fe7e9ae701ef17b37fcbdee73",
          "sha": "138726a6f8101e0fe7e9ae701ef17b37fcbdee73",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/138726a6f8101e0fe7e9ae701ef17b37fcbdee73"
        }
      ],
      "message": "kernel: Add Handle/View pattern for BlockValidationState\n\nAdd C API functions for managing BlockValidationState lifecycle:\n  - btck_block_validation_state_create()\n  - btck_block_validation_state_copy()\n  - btck_block_validation_state_destroy()\n\nIntroduce BlockValidationStateApi<> template to share common getter methods between BlockValidationState (Handle) and BlockValidationStateView (View) classes in the C++ wrapper.\n\nUpdate ValidationInterface::BlockChecked to use BlockValidationStateView since it doesn't need ownership.\n\nThis changes prepares the kernel API to return BlockValidationState by value in subsequent commits.",
      "committer": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T17:18:46Z"
      },
      "author": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T12:20:55Z"
      },
      "sha": "e78d9b2bcf65cb3729f2c7d37e25acc3e9505778"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRjNjMwMWMwMWNmNTY4Zjg2ODgwNTk1NGNmYzA1MTdiZTVmZjVlYmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c6301c01cf568f868805954cfc0517be5ff5ebc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4c6301c01cf568f868805954cfc0517be5ff5ebc",
      "tree": {
        "sha": "84c586605e512ddb745730d02d77b0ace3673c03",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/84c586605e512ddb745730d02d77b0ace3673c03"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 84c586605e512ddb745730d02d77b0ace3673c03\nparent e78d9b2bcf65cb3729f2c7d37e25acc3e9505778\nauthor yuvicc <yuvichh01@gmail.com> 1762874578 +0530\ncommitter yuvicc <yuvichh01@gmail.com> 1762881526 +0530\n\nvalidation, kernel: Return BlockValidationState from ProcessNewBlock\n\nReturn `BlockValidationState` by value instead of passing a reference, following the pattern established in 74690f4ed82b1584abb07c0387db0d924c4c0cab for `TestBlockValidity`.\n\nThis provides verbose information to callers about why block processing succeeded or failed. Previously, callers needed to register validation interface callbacks to determine the specific validation failure reason.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEq0Vt2JPkgYR9gctBGAMjJ2EMKBgFAmkTb/YACgkQGAMjJ2EM\nKBjOxQv+OqZijBs3eFbpVIc0N4R5SJhHfyDl0csUE3s2jf+hrPNIAXNY0Sjtp2Yk\npTYL4Kl8jPzGezB43fmIkfKsuBNWZRaZdC8tqIJn/t4/OyZIwQeAXrUO3II9/7vH\nDHeGN5YAETaZvXf9pZx5yTlKzitkSHyf2X1Mm6BDE4FGqwnc7ZTSjxMDGc6C9cuf\nFY/zp38EirFiH7qjN0TXbtwIfbfCXecBBLckHn9XiyXA5wVPWzutQIJB/OL//ZSc\nZxUMH5SiyHWqsAn8cOAxbYJH8vlS6zv8lxR/WYclf46wFxsFCuhIL/UcPJ9U3kx8\nE9w406jg/iPRGAHu0WuBd/UVJ2U52Xu3DF0DhurRCNKyzlEKVSCrUcJAMmXptsxr\n//M0CTNRnEIxbnd2DfcL1JXvW4oZ4bQbppI3/rmBzmKz/0ZFRzC7jHGgZII/ORyK\nW/gEIf6DZr88u/oJNDWw7wFsjqTm6Ji2JA2c+bJVWoc3w9UHWBVxtRac4vXzaQGw\n2GfK53g4\n=W1rp\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e78d9b2bcf65cb3729f2c7d37e25acc3e9505778",
          "sha": "e78d9b2bcf65cb3729f2c7d37e25acc3e9505778",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e78d9b2bcf65cb3729f2c7d37e25acc3e9505778"
        }
      ],
      "message": "validation, kernel: Return BlockValidationState from ProcessNewBlock\n\nReturn `BlockValidationState` by value instead of passing a reference, following the pattern established in 74690f4ed82b1584abb07c0387db0d924c4c0cab for `TestBlockValidity`.\n\nThis provides verbose information to callers about why block processing succeeded or failed. Previously, callers needed to register validation interface callbacks to determine the specific validation failure reason.",
      "committer": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T17:18:46Z"
      },
      "author": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T15:22:58Z"
      },
      "sha": "4c6301c01cf568f868805954cfc0517be5ff5ebc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5ZDRlYTk0YTBiYjhlNmVmZjA1ZDFkNTE3NjFiNDY1YjAxY2M0NWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "tree": {
        "sha": "d6b886105a02d88e0ee9f32561adceac4ddbd0c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d6b886105a02d88e0ee9f32561adceac4ddbd0c7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d6b886105a02d88e0ee9f32561adceac4ddbd0c7\nparent 4c6301c01cf568f868805954cfc0517be5ff5ebc\nauthor yuvicc <yuvichh01@gmail.com> 1762874620 +0530\ncommitter yuvicc <yuvichh01@gmail.com> 1762881527 +0530\n\nvalidation: Return BlockValidationState from ProcessNewBlockHeaders\n\nReturn BlockValidationState by value instead of using an out-parameter, similar to the TestBlockValidity refactoring in 74690f4ed82b1584abb07c0387db0d924c4c0cab.\n\nThis provides a cleaner API and enables callers to inspect detailed validation state without relying on side effects through reference parameters.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEq0Vt2JPkgYR9gctBGAMjJ2EMKBgFAmkTb/cACgkQGAMjJ2EM\nKBj/EQv9EHQUApjp9kX9PrV666nftDsvX6kz4QBmNPIc220x7pM3XUCvuuDtr0rE\nx8LNTaf4lc2ELW0D+icoWwIn55/hoGNCf0qnfGvuBfYvDhiSiSVc4aSaFo9xOG4J\nvCahWlswE6Ye3I3BceKlTYCLJjCiIe9LzxOXe7NX4FBEf/8uQytgw6oEMWVyJmDA\nAVpPPa6QjcuuTKIuCt1c59D9AXLIjCUXLXTgwz8+Jrk+5cl/jeqd1pPl8D/0u8tu\n6cvp73/waung/1/c6liEvBuKU+3m2stv8GjMBnIvDgQ0jWLqbqm0MYjcba5kGxhs\nshfi1sCTSJRJ1x5yEtGTqprALvh39ffKIZvZO7JpRD3ilO9PxPV1HOk2cVNDlIGn\nAhlRo0ZqJDjthfWuG9l9IDbeNnnghXbXlyOjGZ3WH9OypFACo+SHlvtKtHLaYrx8\noTZgcR6JYktYvkuNhA0rUg4lR1IWZDUIDgQ40fTrivjy+PE3jWkB5JjkjA/qG1j1\nA7xnkZtp\n=Fz10\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c6301c01cf568f868805954cfc0517be5ff5ebc",
          "sha": "4c6301c01cf568f868805954cfc0517be5ff5ebc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4c6301c01cf568f868805954cfc0517be5ff5ebc"
        }
      ],
      "message": "validation: Return BlockValidationState from ProcessNewBlockHeaders\n\nReturn BlockValidationState by value instead of using an out-parameter, similar to the TestBlockValidity refactoring in 74690f4ed82b1584abb07c0387db0d924c4c0cab.\n\nThis provides a cleaner API and enables callers to inspect detailed validation state without relying on side effects through reference parameters.",
      "committer": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T17:18:47Z"
      },
      "author": {
        "name": "yuvicc",
        "email": "yuvichh01@gmail.com",
        "date": "2025-11-11T15:23:40Z"
      },
      "sha": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e"
    },
    {
      "event": "mentioned",
      "id": 20867988796,
      "node_id": "MEE_lADOABII587XXSf5zwAAAATb1D08",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20867988796",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-11T17:24:00Z"
    },
    {
      "event": "subscribed",
      "id": 20867988877,
      "node_id": "SE_lADOABII587XXSf5zwAAAATb1D2N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20867988877",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-11T17:24:00Z"
    },
    {
      "event": "commented",
      "id": 3517984773,
      "node_id": "IC_kwDOABII587RsDAF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3517984773",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-11T17:24:10Z",
      "updated_at": "2025-11-13T23:18:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33856.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/33856#pullrequestreview-3452156315), [w0xlt](https://github.com/bitcoin/bitcoin/pull/33856#issuecomment-3530135641) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33822](https://github.com/bitcoin/bitcoin/pull/33822) (kernel: Add block header support and validation by yuvicc)\n* [#33796](https://github.com/bitcoin/bitcoin/pull/33796) (kernel: Expose `CheckTransaction` consensus validation function by w0xlt)\n* [#33553](https://github.com/bitcoin/bitcoin/pull/33553) (validation: Improve warnings in case of chain corruption by mzumsande)\n* [#33421](https://github.com/bitcoin/bitcoin/pull/33421) (node: add  `BlockTemplateCache` by ismaelsadeeq)\n* [#32740](https://github.com/bitcoin/bitcoin/pull/32740) (refactor: Header sync optimisations & simplifications by danielabrozzoni)\n* [#30342](https://github.com/bitcoin/bitcoin/pull/30342) (kernel, logging: Pass Logger instances to kernel objects by ryanofsky)\n* [#29700](https://github.com/bitcoin/bitcoin/pull/29700) (kernel, refactor: return error status on all fatal errors by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#issuecomment-3517984773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33856"
    },
    {
      "event": "reviewed",
      "id": 3452156315,
      "node_id": "PRR_kwDOABII587Nw7mb",
      "url": null,
      "actor": null,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-12T08:32:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK moving out-reference-parameters to return value\n\nNot familiar with the kernel API but had a brief look at net_processing and validation.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#pullrequestreview-3452156315",
      "submitted_at": "2025-11-12T08:32:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
    },
    {
      "event": "commented",
      "id": 3530135641,
      "node_id": "IC_kwDOABII587SaZhZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3530135641",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-13T23:18:14Z",
      "updated_at": "2025-11-13T23:18:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#issuecomment-3530135641",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33856"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517330536",
      "pull_request_review_id": 3452156315,
      "id": 2517330536,
      "node_id": "PRRC_kwDOABII586WC2po",
      "diff_hunk": "@@ -4533,26 +4533,25 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n                 m_options.signals->BlockChecked(block, state);\n             }\n             LogError(\"%s: AcceptBlock FAILED (%s)\\n\", __func__, state.ToString());\n-            return false;\n+            return state;\n         }\n     }\n \n     NotifyHeaderTip();\n \n-    BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         LogError(\"%s: ActivateBestChain failed (%s)\\n\", __func__, state.ToString());\n-        return false;\n+        return state;\n     }\n \n     Chainstate* bg_chain{WITH_LOCK(cs_main, return BackgroundSyncInProgress() ? m_ibd_chainstate.get() : nullptr)};\n     BlockValidationState bg_state;\n     if (bg_chain && !bg_chain->ActivateBestChain(bg_state, block)) {",
      "path": "src/validation.cpp",
      "position": 63,
      "original_position": 33,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "original_commit_id": "4c6301c01cf568f868805954cfc0517be5ff5ebc",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Why not reuse `state` here?",
      "created_at": "2025-11-12T08:13:34Z",
      "updated_at": "2025-11-12T08:32:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#discussion_r2517330536",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517330536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4550,
      "original_line": 4549,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517333716",
      "pull_request_review_id": 3452156315,
      "id": 2517333716,
      "node_id": "PRRC_kwDOABII586WC3bU",
      "diff_hunk": "@@ -4533,26 +4533,25 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n                 m_options.signals->BlockChecked(block, state);\n             }\n             LogError(\"%s: AcceptBlock FAILED (%s)\\n\", __func__, state.ToString());\n-            return false;\n+            return state;",
      "path": "src/validation.cpp",
      "position": 48,
      "original_position": 18,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "original_commit_id": "4c6301c01cf568f868805954cfc0517be5ff5ebc",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Should remove the shadowing `state` on line 4515 IMO.",
      "created_at": "2025-11-12T08:14:39Z",
      "updated_at": "2025-11-12T08:32:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#discussion_r2517333716",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517333716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4537,
      "original_line": 4536,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517354777",
      "pull_request_review_id": 3452156315,
      "id": 2517354777,
      "node_id": "PRRC_kwDOABII586WC8kZ",
      "diff_hunk": "@@ -4349,9 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n }\n \n // Exposed wrapper for AcceptBlockHeader\n-bool ChainstateManager::ProcessNewBlockHeaders(std::span<const CBlockHeader> headers, bool min_pow_checked, BlockValidationState& state, const CBlockIndex** ppindex)\n+BlockValidationState ChainstateManager::ProcessNewBlockHeaders(std::span<const CBlockHeader> headers, bool min_pow_checked, const CBlockIndex** ppindex)\n {\n     AssertLockNotHeld(cs_main);\n+    BlockValidationState state;",
      "path": "src/validation.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "original_commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Worth adding an `Assume(!headers.empty())` before this, as `state` will be unset if we don't process any, whereas before we would return `true` regardless?",
      "created_at": "2025-11-12T08:22:44Z",
      "updated_at": "2025-11-12T08:32:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#discussion_r2517354777",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2517354777"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4355,
      "original_line": 4355,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2531493620",
      "pull_request_review_id": 3469717990,
      "id": 2531493620,
      "node_id": "PRRC_kwDOABII586W44b0",
      "diff_hunk": "@@ -4533,26 +4533,25 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n                 m_options.signals->BlockChecked(block, state);\n             }\n             LogError(\"%s: AcceptBlock FAILED (%s)\\n\", __func__, state.ToString());\n-            return false;\n+            return state;\n         }\n     }\n \n     NotifyHeaderTip();\n \n-    BlockValidationState state; // Only used to report errors, not invalidity - ignore it\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         LogError(\"%s: ActivateBestChain failed (%s)\\n\", __func__, state.ToString());\n-        return false;\n+        return state;\n     }\n \n     Chainstate* bg_chain{WITH_LOCK(cs_main, return BackgroundSyncInProgress() ? m_ibd_chainstate.get() : nullptr)};\n     BlockValidationState bg_state;\n     if (bg_chain && !bg_chain->ActivateBestChain(bg_state, block)) {",
      "path": "src/validation.cpp",
      "position": 63,
      "original_position": 33,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "original_commit_id": "4c6301c01cf568f868805954cfc0517be5ff5ebc",
      "in_reply_to_id": 2517330536,
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The problem is that `ActivateBestChain` would overwrite the `state` result, when the background chain's `ActivateBestChain` succeeds, it would overwrite state with its own `state`. Then at line 4554, we'd be returning the background chain's `state` instead of the active chainstate's `state`. So by separating out, we preserve the active chainstate result.",
      "created_at": "2025-11-16T06:44:38Z",
      "updated_at": "2025-11-16T06:44:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#discussion_r2531493620",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2531493620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4550,
      "original_line": 4549,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2531525257",
      "pull_request_review_id": 3469750645,
      "id": 2531525257,
      "node_id": "PRRC_kwDOABII586W5AKJ",
      "diff_hunk": "@@ -4349,9 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n }\n \n // Exposed wrapper for AcceptBlockHeader\n-bool ChainstateManager::ProcessNewBlockHeaders(std::span<const CBlockHeader> headers, bool min_pow_checked, BlockValidationState& state, const CBlockIndex** ppindex)\n+BlockValidationState ChainstateManager::ProcessNewBlockHeaders(std::span<const CBlockHeader> headers, bool min_pow_checked, const CBlockIndex** ppindex)\n {\n     AssertLockNotHeld(cs_main);\n+    BlockValidationState state;",
      "path": "src/validation.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "original_commit_id": "b9d4ea94a0bb8e6eff05d1d51761b465b01cc45e",
      "in_reply_to_id": 2517354777,
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Correct, we will definitely need that.",
      "created_at": "2025-11-16T06:59:51Z",
      "updated_at": "2025-11-16T06:59:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33856#discussion_r2531525257",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2531525257"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33856"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4355,
      "original_line": 4355,
      "side": "RIGHT"
    }
  ]
}
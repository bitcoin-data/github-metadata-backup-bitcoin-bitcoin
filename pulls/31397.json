{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397",
    "id": 2208562627,
    "node_id": "PR_kwDOABII586Do_3D",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31397",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31397.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31397.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31397",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31397/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/3e16a36959f70da59846621f099c1f1df4a210ed",
    "number": 31397,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "p2p: track and use all potential peers for orphan resolution",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Part of #27463.\r\n\r\n(Transaction) **orphan resolution** is a process that kicks off when we are missing UTXOs to validate an unconfirmed transaction. We currently request missing parents by txid; BIP 331 also defines a way to [explicitly request ancestors](https://github.com/bitcoin/bips/blob/master/bip-0331.mediawiki#handle-orphans-better).\r\n\r\nCurrently, when we find that a transaction is an orphan, we only try to resolve it with the peer who provided the `tx`. If this doesn't work out (e.g. they send a `notfound` or don't respond), we do not try again. We actually can't, because we've already forgotten who else could resolve this orphan (i.e. all the other peers who announced the transaction).\r\n\r\nWhat is wrong with this? It makes transaction download less reliable, particularly for 1p1c packages which must go through orphan resolution in order to be downloaded.\r\n\r\nCan we fix this with BIP 331 / is this \"duct tape\" before the real solution?\r\nBIP 331 (receiver-initiated ancestor package relay) is also based on the idea that there is an orphan that needs resolution, but it's just a new way of communicating information. It's not inherently more honest; you can request ancestor package information and get a `notfound`. So ancestor package relay still requires some kind of procedure for retrying when an orphan resolution attempt fails. See the #27742 implementation which builds on this orphan resolution tracker to keep track of what packages to download (it just isn't rebased on this exact branch). The difference when using BIP 331 is that we request `ancpkginfo` and then `pkgtxns` instead of the parent txids.\r\n\r\nApproach\r\nThis PR introduces `m_orphan_resolution_tracker` which is responsible for remembering which peers are candidates for orphan resolution and scheduling when to make orphan resolution requests (i.e. getdata for txid of missing parent(s)). The scheduling process should be:\r\n- Bandwidth-efficient: don't have too many requests out at once. As already implemented today, transaction requests for orphan parents and regular download both go through the `TxRequestTracker` so that we don't have duplicate requests out.\r\n- Not vulnerable to censorship: don't give up too easily, use all candidate peers. See e.g. https://bitcoincore.org/en/2024/07/03/disclose_already_asked_for/\r\n- Load-balance between peers: don't overload peers; use all peers available. This is also useful for when we introduce per-peer orphan protection, since each peer will have limited slots.\r\n\r\nNotice that the functionality and requirements are extremely similar to that of transaction download. Naturally, `TxRequestTracker` is the data structure used for `m_orphan_resolution_tracker`. Instead of tracking hashes of transactions we need to download, it tracks hashes of orphans we need to resolve. ",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2024-11-30T21:06:45Z",
    "updated_at": "2024-12-05T11:32:52Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "5af327caa19712eacfbccec61638c1d0262e07a7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "glozow:2024-11-multi-orphan",
      "ref": "2024-11-multi-orphan",
      "sha": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 244262754,
        "node_id": "MDEwOlJlcG9zaXRvcnkyNDQyNjI3NTQ=",
        "name": "bitcoin",
        "full_name": "glozow/bitcoin",
        "owner": {
          "login": "glozow",
          "id": 25183001,
          "node_id": "MDQ6VXNlcjI1MTgzMDAx",
          "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/glozow",
          "html_url": "https://github.com/glozow",
          "followers_url": "https://api.github.com/users/glozow/followers",
          "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
          "organizations_url": "https://api.github.com/users/glozow/orgs",
          "repos_url": "https://api.github.com/users/glozow/repos",
          "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/glozow/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/glozow/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/glozow/bitcoin",
        "archive_url": "https://api.github.com/repos/glozow/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/glozow/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/glozow/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/glozow/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/glozow/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/glozow/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/glozow/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/glozow/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/glozow/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/glozow/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/glozow/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/glozow/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/glozow/bitcoin/events",
        "forks_url": "https://api.github.com/repos/glozow/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/glozow/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/glozow/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/glozow/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/glozow/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/glozow/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/glozow/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/glozow/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/glozow/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/glozow/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/glozow/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/glozow/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/glozow/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/glozow/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/glozow/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/glozow/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:glozow/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/glozow/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/glozow/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/glozow/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/glozow/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/glozow/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/glozow/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/glozow/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/glozow/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/glozow/bitcoin/hooks",
        "svn_url": "https://github.com/glozow/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 12,
        "watchers_count": 12,
        "size": 264276,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-12-04T13:55:34Z",
        "created_at": "2020-03-02T02:31:56Z",
        "updated_at": "2024-12-04T13:33:34Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "dbc8ba12f3b3548dd6955293c5d650320ca39c5b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36480,
        "stargazers_count": 80043,
        "watchers_count": 80043,
        "size": 273413,
        "default_branch": "master",
        "open_issues_count": 659,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-12-04T20:35:08Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-12-05T11:43:47Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 652,
    "deletions": 181,
    "changed_files": 16,
    "commits": 12,
    "review_comments": 18,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM3MGU3NzA4ZmIyOTA1Y2Q5YjBjZWJkNWNhMDYwMTlkMDJiZDBkOTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/370e7708fb2905cd9b0cebd5ca06019d02bd0d94",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/370e7708fb2905cd9b0cebd5ca06019d02bd0d94",
      "tree": {
        "sha": "6c0e991767651732e25b3308538bb11ea815fa01",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6c0e991767651732e25b3308538bb11ea815fa01"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7590e93bc73b3bbac641f05d490fd5c984156b33",
          "sha": "7590e93bc73b3bbac641f05d490fd5c984156b33",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7590e93bc73b3bbac641f05d490fd5c984156b33"
        }
      ],
      "message": "[txrequest] GetCandidatePeers and ResetRequestTimeout",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T10:33:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-03-20T10:37:23Z"
      },
      "sha": "370e7708fb2905cd9b0cebd5ca06019d02bd0d94"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDkzODY1OWZiZDgzMDRjY2M5NDhlMDRkNzk3YTRhOWQ4Y2Y2NjlkM2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/938659fbd8304ccc948e04d797a4a9d8cf669d3e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/938659fbd8304ccc948e04d797a4a9d8cf669d3e",
      "tree": {
        "sha": "e8b604979bd15c407556754b01a73aa5d3a6901f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e8b604979bd15c407556754b01a73aa5d3a6901f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/370e7708fb2905cd9b0cebd5ca06019d02bd0d94",
          "sha": "370e7708fb2905cd9b0cebd5ca06019d02bd0d94",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/370e7708fb2905cd9b0cebd5ca06019d02bd0d94"
        }
      ],
      "message": "[refactor] change type of unique_parents to Txid",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T10:50:15Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-26T13:10:21Z"
      },
      "sha": "938659fbd8304ccc948e04d797a4a9d8cf669d3e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdiYWRjN2UwMDRlMjg4YWVmNjQ1NDA0YjFiMDk2OTliZThiODdkMWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7badc7e004e288aef645404b1b09699be8b87d1e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7badc7e004e288aef645404b1b09699be8b87d1e",
      "tree": {
        "sha": "a2ac1b425adc0ff114768e7ae13c22dec98d0212",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a2ac1b425adc0ff114768e7ae13c22dec98d0212"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/938659fbd8304ccc948e04d797a4a9d8cf669d3e",
          "sha": "938659fbd8304ccc948e04d797a4a9d8cf669d3e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/938659fbd8304ccc948e04d797a4a9d8cf669d3e"
        }
      ],
      "message": "[txorphanage] store parent txids in OrphanTx",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:27:11Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-27T10:27:16Z"
      },
      "sha": "7badc7e004e288aef645404b1b09699be8b87d1e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFjYWE3YzEzZmFjM2UzNWE1NWRhZjJjNjJjMjdhYjg1MTcyYjQ5NjQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/acaa7c13fac3e35a55daf2c62c27ab85172b4964",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/acaa7c13fac3e35a55daf2c62c27ab85172b4964",
      "tree": {
        "sha": "70992a1c448ec2a4c2d0f9cf935892e6d4693bde",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/70992a1c448ec2a4c2d0f9cf935892e6d4693bde"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7badc7e004e288aef645404b1b09699be8b87d1e",
          "sha": "7badc7e004e288aef645404b1b09699be8b87d1e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7badc7e004e288aef645404b1b09699be8b87d1e"
        }
      ],
      "message": "[txorphanage] support multiple announcers\n\nAdd ability to add and track multiple announcers per orphan transaction,\nerasing announcers but not the entire orphan.\n\nThe tx creation code in orphanage_tests needs to be updated so that each\ntx is unique, because the CountOrphans() check assumes that calling\nEraseForPeer necessarily means its orphans are deleted.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:31:09Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-18T15:02:58Z"
      },
      "sha": "acaa7c13fac3e35a55daf2c62c27ab85172b4964"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ4YmRiNjk2NTIyMTgwN2I1MjQ2OTY1NDEwZTdhNjZjYTY3YjgwZjc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8bdb6965221807b5246965410e7a66ca67b80f7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d8bdb6965221807b5246965410e7a66ca67b80f7",
      "tree": {
        "sha": "7c42203a66857f234de9b59c9877098f88e53566",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7c42203a66857f234de9b59c9877098f88e53566"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/acaa7c13fac3e35a55daf2c62c27ab85172b4964",
          "sha": "acaa7c13fac3e35a55daf2c62c27ab85172b4964",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/acaa7c13fac3e35a55daf2c62c27ab85172b4964"
        }
      ],
      "message": "[txorphanage] return wtxids from EraseForBlock",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:31:20Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-26T14:00:19Z"
      },
      "sha": "d8bdb6965221807b5246965410e7a66ca67b80f7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgzZDI3NmM3ZGQ3ODlhYjdjZjMzMmE0ZWJiYzdlZDIxNTM0MGRlOGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83d276c7dd789ab7cf332a4ebbc7ed215340de8c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/83d276c7dd789ab7cf332a4ebbc7ed215340de8c",
      "tree": {
        "sha": "30766c359db491425702a38a246802d942821ba1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/30766c359db491425702a38a246802d942821ba1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8bdb6965221807b5246965410e7a66ca67b80f7",
          "sha": "d8bdb6965221807b5246965410e7a66ca67b80f7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d8bdb6965221807b5246965410e7a66ca67b80f7"
        }
      ],
      "message": "[txorphanage] return erased wtxids from LimitOrphans",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:34:19Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-26T14:44:18Z"
      },
      "sha": "83d276c7dd789ab7cf332a4ebbc7ed215340de8c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZhOGU1NDMyNzg2NTc4YTMyZDliN2E5MTI5NmZkMmM5ZDhhOGQzY2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb",
      "tree": {
        "sha": "b943b8b5097e9743abccd844cfa45ce38c24e922",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b943b8b5097e9743abccd844cfa45ce38c24e922"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83d276c7dd789ab7cf332a4ebbc7ed215340de8c",
          "sha": "83d276c7dd789ab7cf332a4ebbc7ed215340de8c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/83d276c7dd789ab7cf332a4ebbc7ed215340de8c"
        }
      ],
      "message": "[unit test] multiple announcers",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:35:30Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-31T09:24:39Z"
      },
      "sha": "fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEwYjE5NTNkNGYyNDM2ZWM0N2QzY2IzYmM0ODMzNzJmYmRlMzQ5MDI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a0b1953d4f2436ec47d3cb3bc483372fbde34902",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a0b1953d4f2436ec47d3cb3bc483372fbde34902",
      "tree": {
        "sha": "ebe66c28f741e6b06586bff22099a059525d234d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ebe66c28f741e6b06586bff22099a059525d234d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb",
          "sha": "fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fa8e5432786578a32d9b7a91296fd2c9d8a8d3cb"
        }
      ],
      "message": "[fuzz] orphanage multiple announcer functions",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:37:29Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-31T09:52:01Z"
      },
      "sha": "a0b1953d4f2436ec47d3cb3bc483372fbde34902"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI2NGJlOWVkMmNlOWI2OGFlZjE3ODY4NGRhYzNiZTk5OGYxOGJiZGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b64be9ed2ce9b68aef178684dac3be998f18bbdd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b64be9ed2ce9b68aef178684dac3be998f18bbdd",
      "tree": {
        "sha": "1593d7647f66555483824a82ac46a07eff825e2c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1593d7647f66555483824a82ac46a07eff825e2c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a0b1953d4f2436ec47d3cb3bc483372fbde34902",
          "sha": "a0b1953d4f2436ec47d3cb3bc483372fbde34902",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a0b1953d4f2436ec47d3cb3bc483372fbde34902"
        }
      ],
      "message": "[txdownload] remove unique_parents that we already have\n\nThis means we no longer return parents we already have in the\nm_unique_parents result from MempoolRejectedTx.\n\nWe need to separate the loop that checks AlreadyHave parents from the\nloop that adds parents as announcments, because we may do the latter\nloop multiple times for different peers.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T15:44:27Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T11:43:08Z"
      },
      "sha": "b64be9ed2ce9b68aef178684dac3be998f18bbdd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMwNGQxYTg3NmNkYmNkMTU5YzUzZGRlNTVkNTdhNTU2NzVjNDFmMzg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c04d1a876cdbcd159c53dde55d57a55675c41f38",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c04d1a876cdbcd159c53dde55d57a55675c41f38",
      "tree": {
        "sha": "d52a75380d5f1a7e7a8cef54899643c2d2dd3be0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d52a75380d5f1a7e7a8cef54899643c2d2dd3be0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b64be9ed2ce9b68aef178684dac3be998f18bbdd",
          "sha": "b64be9ed2ce9b68aef178684dac3be998f18bbdd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b64be9ed2ce9b68aef178684dac3be998f18bbdd"
        }
      ],
      "message": "[p2p] try multiple peers for orphan resolution",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T16:06:16Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-26T14:02:02Z"
      },
      "sha": "c04d1a876cdbcd159c53dde55d57a55675c41f38"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc4MGUyOGNmOWFkZTZkZDBhN2U1NGMwMDlhMDY2OTJiOGJmMWUwZTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4",
      "tree": {
        "sha": "f0826cc7dc68974a2aba6fa1a4adc424c487b0a6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f0826cc7dc68974a2aba6fa1a4adc424c487b0a6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c04d1a876cdbcd159c53dde55d57a55675c41f38",
          "sha": "c04d1a876cdbcd159c53dde55d57a55675c41f38",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c04d1a876cdbcd159c53dde55d57a55675c41f38"
        }
      ],
      "message": "[functional test] orphan handling with multiple announcers",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T16:06:16Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-07-26T15:34:55Z"
      },
      "sha": "780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNlMTZhMzY5NTlmNzBkYTU5ODQ2NjIxZjA5OWMxZjFkZjRhMjEwZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3e16a36959f70da59846621f099c1f1df4a210ed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3e16a36959f70da59846621f099c1f1df4a210ed",
      "tree": {
        "sha": "f85e6926d89fbc6e8f41bd94693c374fff42205a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f85e6926d89fbc6e8f41bd94693c374fff42205a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4",
          "sha": "780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/780e28cf9ade6dd0a7e54c009a06692b8bf1e0e4"
        }
      ],
      "message": "[p2p] only attempt 1p1c when both txns provided by the same peer\n\nNow that we track all announcers of an orphan, it's not helpful to\nconsider an orphan provided by a peer that didn't send us this parent.\nIt can only hurt our chances of finding the right orphan when there are\nmultiple candidates.\n\nAdapt the 2 tests in p2p_opportunistic_1p1c.py that looked at 1p1c\npackages from different peers. Instead of checking that the right peer\nis punished, we now check that the package is not submitted. We can't\nuse the functional test to see that the package was not considered\nbecause the behavior is indistinguishable (except for the logs).",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-11-28T16:06:16Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2024-08-20T10:39:18Z"
      },
      "sha": "3e16a36959f70da59846621f099c1f1df4a210ed"
    },
    {
      "event": "labeled",
      "id": 15482319323,
      "node_id": "LE_lADOABII586haVlzzwAAAAOa0XHb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15482319323",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-30T21:06:45Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "commented",
      "id": 2509386087,
      "node_id": "IC_kwDOABII586VkjFn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2509386087",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-11-30T21:06:50Z",
      "updated_at": "2024-12-05T11:25:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31397.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/31397#pullrequestreview-2472515530) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#issuecomment-2509386087",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31397"
    },
    {
      "event": "reviewed",
      "id": 2478886117,
      "node_id": "PRR_kwDOABII586TwMzl",
      "url": null,
      "actor": null,
      "commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#pullrequestreview-2478886117",
      "submitted_at": "2024-12-04T14:34:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
    },
    {
      "event": "reviewed",
      "id": 2472515530,
      "node_id": "PRR_kwDOABII586TX5fK",
      "url": null,
      "actor": null,
      "commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nI implemented what I was talking about in the [review club yesterday](https://bitcoincore.reviews/31397) here: https://github.com/dergoegge/bitcoin/commits/2024-12-rslv-orphns/ (the only difference is the main commit 3928b400d805f75e0ba5b9947d5d441a828aa5be) and it looks like it passes your functional test additions! So perhaps it's worth exploring if we actually need another tracker...\r\n\r\n\r\n<details>\r\n\r\n<summary>IRC logs</summary>\r\n\r\n```\r\n17:34 \t<dergoegge> I was wondering why we need another txrequest tracker instance for this? couldnâ€™t we just keep track of announcers in the orphanage (same as in the PR) and then add requests for the parents to the existing tracker on future announcements?\r\n17:35 \t<glozow> dergoegge: that's an idea. How would you schedule the requests?\r\n17:35 \t<dergoegge> ideally at the same time\r\n17:35 \t<glozow> Is there a cost to having another txrequest tracker? It's not that different from adding another std::map\r\n17:35 \t<glozow> No, I mean, how would you load-balance between peers, bake in preferences, etc.\r\n17:36 \t<dergoegge> isn't that what the existing tracker does?\r\n17:36 \t<glozow> Oh, you mean adding a new type to the tracker? So we'd have txid type, wtxid type, and orphan?\r\n17:37 \t<glozow> also note that the parent requests are added to the txrequest tracker\r\n17:39 \t<dergoegge> I guess I'm wondering why we need the concept of tracking the resolution by orphan id, as opposed to just putting the requests for the parents in the existing tracker\r\n17:39 \t<glozow> we do put the requests for the parents in the existing tracker\r\n17:39 \t<glozow> Maybe we are crossing wires?\r\n17:39 \t<instagibbs> mmmm he's asking why the add to new tracker, then \"immediately\" add to old one, vs just add to old one, I think\r\n17:40 \t<dergoegge> yea\r\n17:40 \t<instagibbs> add to old one with \"proper delays\"\r\n17:40 \t<instagibbs> I didn't get far enough in my review to figure this out either ðŸ˜…\r\n17:40 \t<glozow> We might have multiple candidates for orphan resolution\r\n17:41 \t<glozow> Oh I see what you're saying\r\n17:42 \t<dergoegge> \"multiple candidates\" as in same parents different orphan?\r\n17:42 \t<glozow> Perhaps that could work, where you're treating it as if all of them just announced the missing parents? I don't know how you'd add `ancpkginfo` orphan resolution easily this way though.\r\n17:43 \t<glozow> different peers same orphan\r\n17:43 \t<instagibbs> You'd also have to somehow track that you're no longer asking for any parents of an orphan in order to EraseOrphanOfPeer?\r\n17:43 \t<marcofleon> yeah i was thinking it made sense with GetCandidatePeers. Having another tracker to separate out the orphan reso process\r\n17:46 \t<glozow> will think about this idea some more\r\n17:47 \t<dergoegge> me too ðŸ‘\r\n17:47 \t<glozow> I think it's possible it works? My main questions would be (1) what is the cost of having a second tracker? Because it's the perfect data structure for this. (2) how do we make it extensible to package relay still.\r\n17:48 \t<instagibbs> imo the cost is mostly an additional structure lying around that needs to stay in sync with other things\r\n17:48 \t<dergoegge> 1) if we don't need it then it's just extra complexity 2) fair!\r\n17:48 \t<marcofleon> The fact that there are candidates that be added or not added to that new tracker is why it made sense to me in the first place I guess is what i was saying\r\n17:48 \t<marcofleon> can be*\r\n17:49 \t<glozow> (1) shoving it into the existing tracker but needing to have extra logic could also be complexity!\r\n17:49 \t<dergoegge> well in my mind it wouldn't need extra logic but I might be wrong, need to think more\r\n17:49 \t<instagibbs> proof of code for this I think..\r\n17:49 \t<glozow> but yeah, I don't like that we need to ensure m_orphanage and m_orphan_resolution_tracker are in sync. that's super fair\r\n17:49 \t<dergoegge> frfr\r\n17:50 \t<glozow> yeah let's see what the code would look like\r\n17:50 \t<marcofleon> fr\r\n17:50 \t<glozow> fr r r\r\n```\r\n\r\n</details>\r\n",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#pullrequestreview-2472515530",
      "submitted_at": "2024-12-05T11:25:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1865732564",
      "pull_request_review_id": 2472515530,
      "id": 1865732564,
      "node_id": "PRRC_kwDOABII585vNNHU",
      "diff_hunk": "@@ -12,12 +12,20 @@\n \n #include <cassert>\n \n-bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n+bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer, const std::vector<Txid>& parent_txids)\n {\n     const Txid& hash = tx->GetHash();\n     const Wtxid& wtxid = tx->GetWitnessHash();\n-    if (m_orphans.count(wtxid))\n+    auto it = m_orphans.find(wtxid);\n+    if (it != m_orphans.end()) {\n+        Assume(!it->second.announcers.empty());\n+        const auto ret = it->second.announcers.insert(peer);\n+        if (ret.second) {\n+            LogDebug(BCLog::TXPACKAGES, \"added peer=%d as announcer of orphan tx %s\\n\", peer, wtxid.ToString());\n+        }",
      "path": "src/txorphanage.cpp",
      "position": 16,
      "original_position": 16,
      "commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "original_commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n    if (auto it{m_orphans.find(wtxid)}; it != m_orphans.end()) {\r\n        AddAnnouncer(wtxid, peer);\r\n```\r\n\r\nDuplicating the map lookup is better than duplicating the code imo.",
      "created_at": "2024-12-02T12:04:08Z",
      "updated_at": "2024-12-05T11:25:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#discussion_r1865732564",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1865732564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
        }
      },
      "start_line": 19,
      "original_start_line": 19,
      "start_side": "RIGHT",
      "line": 25,
      "original_line": 25,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1869654727",
      "pull_request_review_id": 2478886117,
      "id": 1869654727,
      "node_id": "PRRC_kwDOABII585vcKrH",
      "diff_hunk": "@@ -204,8 +227,83 @@ bool TxDownloadManagerImpl::AddTxAnnouncement(NodeId peer, const GenTxid& gtxid,\n     return false;\n }\n \n+std::optional<std::chrono::seconds> TxDownloadManagerImpl::OrphanResolutionCandidate(NodeId nodeid, const Wtxid& orphan_wtxid)\n+{\n+    if (m_peer_info.count(nodeid) == 0) return std::nullopt;\n+\n+    const auto& peer_entry = m_peer_info.at(nodeid);\n+    const auto& info = peer_entry.m_connection_info;\n+    // TODO: add delays and limits based on the amount of orphan resolution we are already doing\n+    // with this peer, how much they are using the orphanage, etc.\n+    if (!info.m_relay_permissions) {\n+        // This mirrors the delaying and dropping behavior in AddTxAnnouncement in order to preserve\n+        // existing behavior: drop if we are tracking too many invs for this peer already. Each\n+        // orphan resolution involves at least 1 transaction request which may or may not be\n+        // currently tracked in m_txrequest, so we include that in the count.\n+        if (m_txrequest.Count(nodeid) + m_orphan_resolution_tracker.Count(nodeid) >= MAX_PEER_TX_ANNOUNCEMENTS) return std::nullopt;",
      "path": "src/node/txdownloadman_impl.cpp",
      "position": 68,
      "original_position": 68,
      "commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "original_commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ah, need to add the size of `unique_parents` to this. Surprised fuzzer has not tripped on it...",
      "created_at": "2024-12-04T14:34:41Z",
      "updated_at": "2024-12-04T14:34:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#discussion_r1869654727",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1869654727"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 243,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1871051453",
      "pull_request_review_id": 2472515530,
      "id": 1871051453,
      "node_id": "PRRC_kwDOABII585vhfq9",
      "diff_hunk": "@@ -624,6 +625,74 @@ def test_max_orphan_amount(self):\n             peer_1.send_and_ping(msg_tx(parent_orphan))\n         assert_equal(len(node.getorphantxs()),0)\n \n+    @cleanup\n+    def test_orphan_handling_prefer_outbound(self):\n+        self.log.info(\"Test that the node prefers requesting from outbound peers\")\n+        node = self.nodes[0]\n+        orphan_wtxid, orphan_tx, parent_tx = self.create_parent_and_child()\n+        orphan_inv = CInv(t=MSG_WTX, h=int(orphan_wtxid, 16))\n+\n+        peer_inbound = node.add_p2p_connection(PeerTxRelayer())\n+        peer_outbound = node.add_outbound_p2p_connection(PeerTxRelayer(), p2p_idx=1)\n+\n+        # Inbound peer relays the transaction.\n+        peer_inbound.send_and_ping(msg_inv([orphan_inv]))\n+        self.nodes[0].bumpmocktime(TXREQUEST_TIME_SKIP)\n+        peer_inbound.wait_for_getdata([int(orphan_wtxid, 16)])\n+\n+        # Both peers send invs for the orphan, so the node can expect both to know its ancestors.\n+        peer_outbound.send_and_ping(msg_inv([orphan_inv]))\n+\n+        # The outbound peer should be preferred for getting orphan parents\n+        peer_inbound.send_and_ping(msg_tx(orphan_tx))\n+        self.nodes[0].bumpmocktime(TXID_RELAY_DELAY)\n+        peer_outbound.wait_for_parent_requests([int(parent_tx.rehash(), 16)])\n+\n+        # There should be no request to the inbound peer\n+        peer_inbound.assert_never_requested(int(parent_tx.rehash(), 16))\n+\n+        self.log.info(\"Test that, if the preferred peer doesn't respond, the node sends another request\")\n+        self.nodes[0].bumpmocktime(ORPHAN_ANCESTOR_GETDATA_INTERVAL)\n+        peer_inbound.sync_with_ping()\n+        peer_inbound.wait_for_parent_requests([int(parent_tx.rehash(), 16)])\n+\n+    @cleanup\n+    def test_announcers_before_and_after(self):\n+        self.log.info(\"Test that the node uses all peers who announced the tx prior to realizing it's an orphan\")\n+        node = self.nodes[0]\n+        orphan_wtxid, orphan_tx, parent_tx = self.create_parent_and_child()\n+        orphan_inv = CInv(t=MSG_WTX, h=int(orphan_wtxid, 16))\n+\n+        # Announces before tx is sent, disconnects while node is requesting parents\n+        peer_early_disconnected = node.add_outbound_p2p_connection(PeerTxRelayer(), p2p_idx=3)\n+        # Announces before tx is sent, doesn't respond to parent request\n+        peer_early_unresponsive = node.add_p2p_connection(PeerTxRelayer())\n+\n+        # Announces after tx is sent\n+        peer_late_announcer = node.add_p2p_connection(PeerTxRelayer())\n+\n+        # Both peers send invs for the orphan, so the node an expect both to know its ancestors.",
      "path": "test/functional/p2p_orphan_handling.py",
      "position": 58,
      "original_position": 58,
      "commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "original_commit_id": "3e16a36959f70da59846621f099c1f1df4a210ed",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n        # Both peers send invs for the orphan, so the node can expect both to know its ancestors.\r\n```",
      "created_at": "2024-12-05T10:06:40Z",
      "updated_at": "2024-12-05T11:25:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31397#discussion_r1871051453",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1871051453"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31397"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 674,
      "original_line": 674,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602",
    "id": 2908139789,
    "node_id": "PR_kwDOABII586tVrEN",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33602",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33602.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33602.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
    "number": 33602,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "[IBD] coins: reduce lookups in dbcache layer propagation",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This change is part of [[IBD] - Tracking PR for speeding up Initial Block Download](https://github.com/bitcoin/bitcoin/pull/32043)\r\n\r\n### Summary\r\n\r\nPreviously, when the parent coins cache had no entry and the child did, `BatchWrite` performed a find followed by `try_emplace`, which resulted in multiple `SipHash` computations and bucket traversals on the common insert path.\r\nOn a different path, these caches were recreated needlessly for every block connection.\r\n\r\n### Fix for double fetch \r\n\r\nThis change uses a single leading `try_emplace` and branches on the returned `inserted` flag. In the `FRESH && SPENT` case (not used in production, only exercised by tests), we erase the just-inserted placeholder (which is constant time with no rehash anyway). Semantics are unchanged for all valid parent/child state combinations.\r\n\r\nThis change is a minimal version of [bitcoin/bitcoin@`723c49b` (#32128)](https://github.com/bitcoin/bitcoin/pull/32128/commits/723c49b63bb10da843fbb6efc6928dca415cc47f) and draws simplification ideas [bitcoin/bitcoin@`ae76ec7` (#30673)](https://github.com/bitcoin/bitcoin/pull/30673/commits/ae76ec7bcff0a08a61f294882a71e46d177b009f) and https://github.com/bitcoin/bitcoin/pull/30326.\r\n\r\n### Fix for temporary cache recreation\r\n\r\nRelated to parent cache propagation, the second commit makes it possible to avoid destructuring-recreating-destructuring of these short-live parent caches created for each new block.\r\nA few temporary `CCoinsViewCache`'s are destructed right after the `Flush()`, therefore it is not necessary to call `ReallocateCache` to recreate them right before they're killed anyway.\r\n\r\nThis change was based on a subset of https://github.com/bitcoin/bitcoin/pull/28945, the original authors and relevant commenters were added as coauthors to this version.\r\n\r\n-----\r\n\r\nReindex-chainstate indicates ~1% speedup.\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```python\r\nCOMMITS=\"647cdb4f7e8041affed887e2325ee03a91078bb1 0b0c3293ffd75afb27dadc0b28426b40132a8c6b\"; \\                       \r\nSTOP=909090; DBCACHE=4500; \\                                                                                                                                                     \r\nCC=gcc; CXX=g++; \\                                                                      \r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\                                                                                        \r\n(echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\                                                                             \r\n  --sort command \\                                                                      \r\n  --runs 2 \\                                                                            \r\n  --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$STOP-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\                                             \r\n  --prepare \"killall bitcoind 2>/dev/null; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard && \\\r\n    cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -DENABLE_IPC=OFF && ninja -C build bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=1000 -printtoconsole=0; sleep 20\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\                                                                                                   \r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=$DBCACHE -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0\"\r\n\r\n647cdb4f7e Merge bitcoin/bitcoin#33311: net: Quiet down logging when router doesn't support natpmp/pcp\r\n0b0c3293ff validation: don't reallocate cache for short-lived CCoinsViewCache                                                                                                    \r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=909090 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 647cdb4f7e8041affed887e2325ee03a91078bb1)\r\n  Time (mean ± σ):     16233.508 s ±  9.501 s    [User: 19064.578 s, System: 951.672 s]                                                                                          \r\n  Range (min … max):   16226.790 s … 16240.226 s    2 runs                                                                                                                       \r\n                                                                                        \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=909090 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0b0c3293ffd75afb27dadc0b28426b40132a8c6b)\r\n  Time (mean ± σ):     16039.626 s ± 17.284 s    [User: 18870.130 s, System: 950.722 s]\r\n  Range (min … max):   16027.405 s … 16051.848 s    2 runs\r\n  \r\nRelative speed comparison\r\n        1.01 ±  0.00  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=909090 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 647cdb4f7e8041affed887e2325ee03a91078bb1)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=909090 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0b0c3293ffd75afb27dadc0b28426b40132a8c6b)\r\n```\r\n\r\n</details>\r\n",
    "labels": [],
    "created_at": "2025-10-12T18:32:08Z",
    "updated_at": "2025-12-10T23:11:40Z",
    "closed_at": "2025-12-10T23:02:48Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2025-12-10T23:02:48Z",
    "merged_by": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "merge_commit_sha": "c2975f26d69f6e50672fecbbabde3e30163eb091",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "l0rinc:l0rinc/BatchWrite-lookup-optimization",
      "ref": "l0rinc/BatchWrite-lookup-optimization",
      "sha": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 279886,
        "default_branch": "master",
        "open_issues_count": 17,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-10T23:11:40Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-12-04T13:17:38Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "25c45bb0d0bd6618ec9296a1a43605657124e5de",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38327,
        "stargazers_count": 87184,
        "watchers_count": 87184,
        "size": 300151,
        "default_branch": "master",
        "open_issues_count": 717,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-10T23:28:59Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-12-10T23:58:11Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 20,
    "deletions": 26,
    "changed_files": 5,
    "commits": 2,
    "review_comments": 23,
    "comments": 7
  },
  "events": [
    {
      "event": "commented",
      "id": 3395203704,
      "node_id": "IC_kwDOABII587KXrJ4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3395203704",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-12T18:32:13Z",
      "updated_at": "2025-12-10T22:49:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33602.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [andrewtoth](https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3409084819), [optout21](https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3480221357), [sedited](https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3554048589), [achow101](https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3639270227) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33866](https://github.com/bitcoin/bitcoin/pull/33866) (refactor: Let CCoinsViewCache::BatchWrite return void by sedited)\n* [#33512](https://github.com/bitcoin/bitcoin/pull/33512) (coins: use number of dirty cache entries in flush warnings/logs by l0rinc)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads >40% faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3395203704",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "reviewed",
      "id": 3334731243,
      "node_id": "PRR_kwDOABII587Gw_Xr",
      "url": null,
      "actor": null,
      "commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-14T09:36:15Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3334731243",
      "submitted_at": "2025-10-14T09:36:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "reviewed",
      "id": 3334738626,
      "node_id": "PRR_kwDOABII587GxBLC",
      "url": null,
      "actor": null,
      "commit_id": "b23c6a1fc8f9a44561add79427d2f3fff4c3718f",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-10-14T09:38:23Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3334738626",
      "submitted_at": "2025-10-14T09:38:23Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "commented",
      "id": 3400973272,
      "node_id": "IC_kwDOABII587KtrvY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3400973272",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-14T09:38:50Z",
      "updated_at": "2025-10-14T09:38:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 195fc2fe102197eae27c33b5e3969a6b15d1253a\r\n\r\nNice optimization",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3400973272",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "commented",
      "id": 3402002445,
      "node_id": "IC_kwDOABII587KxnAN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3402002445",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-14T13:51:40Z",
      "updated_at": "2025-10-14T13:51:40Z",
      "author_association": "MEMBER",
      "body": "Why is this Draft?",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3402002445",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "ready_for_review",
      "id": 20270677502,
      "node_id": "RFRE_lADOABII587REvO9zwAAAAS4Of3-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20270677502",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-14T13:51:56Z"
    },
    {
      "event": "labeled",
      "id": 20300336673,
      "node_id": "LE_lADOABII587REvO9zwAAAAS5_o4h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20300336673",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-15T16:21:42Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20307352967,
      "node_id": "HRFPE_lADOABII587REvO9zwAAAAS6aZ2H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20307352967",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/2d06ed75c5137a295646807cf1eee8f71d77da20",
      "created_at": "2025-10-16T00:09:12Z"
    },
    {
      "event": "commented",
      "id": 3408692812,
      "node_id": "IC_kwDOABII587LLIZM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3408692812",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-16T00:10:37Z",
      "updated_at": "2025-10-16T00:10:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/32313.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3408692812",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "unlabeled",
      "id": 20307811453,
      "node_id": "UNLE_lADOABII587REvO9zwAAAAS6cJx9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20307811453",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-16T01:08:44Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3407608702,
      "node_id": "PRR_kwDOABII587LG_t-",
      "url": null,
      "actor": null,
      "commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-01T17:27:45Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3407608702",
      "submitted_at": "2025-11-01T17:27:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM4ZjVlNDQ2ZGM5NTcxMmE2M2U0ZGQ4ODc4NmUyZjdjYjY5N2I5ODY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c8f5e446dc95712a63e4dd88786e2f7cb697b986",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c8f5e446dc95712a63e4dd88786e2f7cb697b986",
      "tree": {
        "sha": "5752e96f2e00c717c75974e7769fd9dfd9e95be7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5752e96f2e00c717c75974e7769fd9dfd9e95be7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/25c45bb0d0bd6618ec9296a1a43605657124e5de",
          "sha": "25c45bb0d0bd6618ec9296a1a43605657124e5de",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/25c45bb0d0bd6618ec9296a1a43605657124e5de"
        }
      ],
      "message": "coins: reduce lookups in dbcache layer propagation\n\nPreviously, when the parent coins cache had no entry and the child did, `BatchWrite` performed a find followed by `try_emplace`, which resulted in multiple `SipHash` computations and bucket traversals on the common insert path.\n\nThis change uses a single leading `try_emplace` and branches on the returned `inserted` flag.\nIn the `FRESH && SPENT` case (only exercised by tests), we erase the just-inserted placeholder (which is constant time with no rehash anyway).\nSemantics are unchanged for all valid parent/child state combinations.\n\nThis change is a minimal version of https://github.com/bitcoin/bitcoin/pull/32128/commits/723c49b63bb10da843fbb6efc6928dca415cc47f and draws simplification ideas https://github.com/bitcoin/bitcoin/pull/30673/commits/ae76ec7bcff0a08a61f294882a71e46d177b009f.\n\nAdded TODO versions for related pre-existing issues that should be fixed in follow-ups.\n\nCo-authored-by: Martin Ankerl <martin.ankerl@gmail.com>\nCo-authored-by: Andrew Toth <andrewstoth@gmail.com>\nCo-authored-by: optout <13562139+optout21@users.noreply.github.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-11-01T21:29:42Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-09-02T04:29:37Z"
      },
      "sha": "c8f5e446dc95712a63e4dd88786e2f7cb697b986"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20654743214,
      "node_id": "HRFPE_lADOABII587REvO9zwAAAATPHl6u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20654743214",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "33af913cf02fec9c01bcb7d205df35ad67996b35",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/33af913cf02fec9c01bcb7d205df35ad67996b35",
      "created_at": "2025-11-01T21:59:23Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20654919248,
      "node_id": "HRFPE_lADOABII587REvO9zwAAAATPIQ5Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20654919248",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "created_at": "2025-11-01T22:30:44Z"
    },
    {
      "event": "reviewed",
      "id": 3408930686,
      "node_id": "PRR_kwDOABII587LMCd-",
      "url": null,
      "actor": null,
      "commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-02T19:23:49Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3408930686",
      "submitted_at": "2025-11-02T19:23:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBhYzk2OWNkZGZkYmE1MmY3OTQ3ZTliMTQwZWYzNmUyYjE5YzJjNDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "tree": {
        "sha": "18a78fe25b148ceb142d777ab0aac23bb15d4e48",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/18a78fe25b148ceb142d777ab0aac23bb15d4e48"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c8f5e446dc95712a63e4dd88786e2f7cb697b986",
          "sha": "c8f5e446dc95712a63e4dd88786e2f7cb697b986",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c8f5e446dc95712a63e4dd88786e2f7cb697b986"
        }
      ],
      "message": "validation: don't reallocate cache for short-lived CCoinsViewCache\n\nA few temporary `CCoinsViewCache`'s are destructed right after the `Flush()`, therefore it is not necessary to call `ReallocateCache` to recreate them right before they're killed anyway.\n\n* `Flush()` - retains existing functionality;\n* `Flush(/*will_reuse_cache=*/false)` - skips destruction and reallocation of the parent cache since it will soon go out of scope anyway;\n\nFor the `will_reuse_cache` parameter we want to see exactly which ones will reallocate memory and which won't - since both can be valid usages.\n\nThis change was based on a subset of https://github.com/bitcoin/bitcoin/pull/28945.\n\nCo-authored-by: Martin Ankerl <martin.ankerl@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-11-02T20:40:16Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-09-05T00:02:35Z"
      },
      "sha": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20662461034,
      "node_id": "HRFPE_lADOABII587REvO9zwAAAATPlCJq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20662461034",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "created_at": "2025-11-02T20:41:05Z"
    },
    {
      "event": "reviewed",
      "id": 3409084819,
      "node_id": "PRR_kwDOABII587LMoGT",
      "url": null,
      "actor": null,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-02T22:47:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "utACK 0ac969cddfdba52f7947e9b140ef36e2b19c2c41\r\n\r\nI did not verify the speedup, but it is a nice optimization that will benefit every `Flush`.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3409084819",
      "submitted_at": "2025-11-02T22:47:31Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "review_requested",
      "id": 20663034681,
      "node_id": "RRE_lADOABII587REvO9zwAAAATPnOM5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20663034681",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-02T22:47:35Z",
      "requested_reviewer": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3480221357,
      "node_id": "IC_kwDOABII587Pb_at",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3480221357",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T12:13:03Z",
      "updated_at": "2025-11-03T12:13:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "utACK 0ac969cddfdba52f7947e9b140ef36e2b19c2c41\r\n\r\nA performance optimization, in a sensitive place but well localized.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3480221357",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "reviewed",
      "id": 3554048589,
      "node_id": "PRR_kwDOABII587T1npN",
      "url": null,
      "actor": null,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-08T21:36:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#pullrequestreview-3554048589",
      "submitted_at": "2025-12-08T21:36:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
    },
    {
      "event": "commented",
      "id": 3629137740,
      "node_id": "IC_kwDOABII587YUD9M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3629137740",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-08T21:47:23Z",
      "updated_at": "2025-12-08T21:47:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "thanks for the reviews!\r\nrfm?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3629137740",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "commented",
      "id": 3639270227,
      "node_id": "IC_kwDOABII587Y6ttT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3639270227",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-10T22:49:44Z",
      "updated_at": "2025-12-10T22:49:44Z",
      "author_association": "MEMBER",
      "body": "ACK 0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#issuecomment-3639270227",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33602"
    },
    {
      "event": "merged",
      "id": 21490695959,
      "node_id": "ME_lADOABII587REvO9zwAAAAUA8f8X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21490695959",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c2975f26d69f6e50672fecbbabde3e30163eb091",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c2975f26d69f6e50672fecbbabde3e30163eb091",
      "created_at": "2025-12-10T23:02:48Z"
    },
    {
      "event": "closed",
      "id": 21490695977,
      "node_id": "CE_lADOABII587REvO9zwAAAAUA8f8p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21490695977",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-10T23:02:48Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 21490818907,
      "node_id": "HRDE_lADOABII587REvO9zwAAAAUA899b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21490818907",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-10T23:11:40Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2428528999",
      "pull_request_review_id": 3334731243,
      "id": 2428528999,
      "node_id": "PRRC_kwDOABII586QwGln",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": null,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How about adding a default value `true` to the new `reallocate_cache` parameter, to suggest that that is the more common usage pattern? It also would reduce the diff a bit.",
      "created_at": "2025-10-14T09:36:15Z",
      "updated_at": "2025-10-14T09:36:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2428528999",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2428528999"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2428534723",
      "pull_request_review_id": 3334738626,
      "id": 2428534723,
      "node_id": "PRRC_kwDOABII586QwH_D",
      "diff_hunk": "@@ -182,18 +182,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries",
      "path": "src/coins.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "b23c6a1fc8f9a44561add79427d2f3fff4c3718f",
      "in_reply_to_id": null,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This `TODO` (and the one few lines below) seems to be independent of the change of this commit (it just exposes a pre-existing TODO condition), maybe isolate in a pre commit for clarity.",
      "created_at": "2025-10-14T09:38:23Z",
      "updated_at": "2025-10-14T09:38:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2428534723",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2428534723"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429279570",
      "pull_request_review_id": 3335814809,
      "id": 2429279570,
      "node_id": "PRRC_kwDOABII586Qy91S",
      "diff_hunk": "@@ -182,18 +182,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries",
      "path": "src/coins.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "b23c6a1fc8f9a44561add79427d2f3fff4c3718f",
      "in_reply_to_id": 2428534723,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, it just documents that what we're modifying here is actually incorrect and needs to be fixed in the future.",
      "created_at": "2025-10-14T13:49:52Z",
      "updated_at": "2025-10-14T13:49:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2429279570",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429279570"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429285815",
      "pull_request_review_id": 3335824491,
      "id": 2429285815,
      "node_id": "PRRC_kwDOABII586Qy_W3",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I thought about that, it's what the original PR did, but we want to see exactly which ones are reallocating and which aren't - I don't like implicit behavior, it's not obvious for this to be `true` or `false` by default, both are valid and expected usages so I prefer making it explicit",
      "created_at": "2025-10-14T13:51:33Z",
      "updated_at": "2025-10-14T13:51:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2429285815",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429285815"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429366620",
      "pull_request_review_id": 3335937023,
      "id": 2429366620,
      "node_id": "PRRC_kwDOABII586QzTFc",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Fair enough. It's called in more places with 'true' than with 'false', and the original version was corresponding to the 'true' case, that's the 'true' alternative looks more a default.\r\nWhat is important is that comments are added to all places where it is called with 'false'.",
      "created_at": "2025-10-14T14:14:17Z",
      "updated_at": "2025-10-14T14:14:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2429366620",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2429366620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2434247283",
      "pull_request_review_id": 3342688315,
      "id": 2434247283,
      "node_id": "PRRC_kwDOABII586RF6pz",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Rebased, added explanation to commit message",
      "created_at": "2025-10-16T00:09:22Z",
      "updated_at": "2025-10-16T00:09:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2434247283",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2434247283"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2434247408",
      "pull_request_review_id": 3342688491,
      "id": 2434247408,
      "node_id": "PRRC_kwDOABII586RF6rw",
      "diff_hunk": "@@ -182,18 +182,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries",
      "path": "src/coins.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "b23c6a1fc8f9a44561add79427d2f3fff4c3718f",
      "in_reply_to_id": 2428534723,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added explanation to commit message",
      "created_at": "2025-10-16T00:09:31Z",
      "updated_at": "2025-10-16T00:09:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2434247408",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2434247408"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483807860",
      "pull_request_review_id": 3407608702,
      "id": 2483807860,
      "node_id": "PRRC_kwDOABII586UC-Z0",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n-            // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n+        auto [itUs, inserted]{cacheCoins.try_emplace(it->first)};\n+        if (inserted) {\n+            if (it->second.IsFresh() && it->second.coin.IsSpent()) {",
      "path": "src/coins.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can we hoist this check out before the `try_emplace`, and just `continue` if this is the case?",
      "created_at": "2025-11-01T17:27:44Z",
      "updated_at": "2025-11-01T17:27:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483807860",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483807860"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483809503",
      "pull_request_review_id": 3407610310,
      "id": 2483809503,
      "node_id": "PRRC_kwDOABII586UC-zf",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I also think it would make sense to have a default `true`. However, if we want to be more explicit about intent to reuse the cache rather than implementation details of what we do if we don't, should we rename this parameter something more descriptive like `will_reuse`? That is the first thing that came to mind, maybe there are better names.\r\n`reallocate_cache` is an implementation detail and may not be obvious to callers. What we want to communicate to callers is whether they will use this cache again or if it will immediately fall out of scope.",
      "created_at": "2025-11-01T17:33:25Z",
      "updated_at": "2025-11-01T17:45:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483809503",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483809503"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483964717",
      "pull_request_review_id": 3407788241,
      "id": 2483964717,
      "node_id": "PRRC_kwDOABII586UDkst",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n-            // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n+        auto [itUs, inserted]{cacheCoins.try_emplace(it->first)};\n+        if (inserted) {\n+            if (it->second.IsFresh() && it->second.coin.IsSpent()) {",
      "path": "src/coins.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "in_reply_to_id": 2483807860,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "You mean something like:\r\n```C++\r\nif (it->second.IsFresh() && it->second.coin.IsSpent() && !cacheCoins.contains(it->first)) {\r\n    continue; // nothing to propagate\r\n}\r\n```\r\nWouldn't that defeat the purpose, doing the check twice? Or you mean that we don't have to check `cacheCoins` for presence and should update `coins_tests/ccoins_write` to not have the false values?\r\nThat's why I've added a TODO instead, I want this PR to be simpler and do the cleanup separately. What do you think?",
      "created_at": "2025-11-01T21:59:21Z",
      "updated_at": "2025-11-01T22:00:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483964717",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483964717"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483964762",
      "pull_request_review_id": 3407788309,
      "id": 2483964762,
      "node_id": "PRRC_kwDOABII586UDkta",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed it to `will_reuse_cache` - I didn't think a lot about the name, I still hope we can completely get rid of the reallocation, I don't think it makes a lot of sense this way. But at least let's turn it off for the cases where it's obviously wrong.\r\n\r\n> I also think it would make sense to have a default true.\r\n\r\nWe have multiple cases for both, it's not obvious why any should be default. I'd rather prefer explicit in this case.",
      "created_at": "2025-11-01T21:59:26Z",
      "updated_at": "2025-11-01T22:00:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483964762",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483964762"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483969075",
      "pull_request_review_id": 3407796557,
      "id": 2483969075,
      "node_id": "PRRC_kwDOABII586UDlwz",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n-            // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n+        auto [itUs, inserted]{cacheCoins.try_emplace(it->first)};\n+        if (inserted) {\n+            if (it->second.IsFresh() && it->second.coin.IsSpent()) {",
      "path": "src/coins.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "in_reply_to_id": 2483807860,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This check\r\n```\r\nif (it->second.IsFresh() && it->second.coin.IsSpent()) {\r\n```\r\nDoes not depend on `itUs` or `cacheCoins`, right?\r\n\r\nSo we can move it up to\r\n```\r\nif (!it->second.IsDirty() || ((it->second.IsFresh() && it->second.coin.IsSpent())) { // TODO a cursor can only contain dirty entries\r\n```\r\nRight?",
      "created_at": "2025-11-01T22:03:37Z",
      "updated_at": "2025-11-01T22:03:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483969075",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483969075"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483971855",
      "pull_request_review_id": 3407802557,
      "id": 2483971855,
      "node_id": "PRRC_kwDOABII586UDmcP",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I still hope we can completely get rid of the reallocation, I don't think it makes a lot of sense this way.\r\n\r\nWell, we would need to get rid of the custom allocator. I think that would be a big perf hit...\r\n\r\n> We have multiple cases for both, it's not obvious why any should be default.\r\n\r\nDefault IMO should be we can reuse, because it doesn't break if we accidentally pass the reuse option when we end up throwing it away anyways. The reverse is not true. The non-reuse case should be the only one where we have to be explicit.\r\n",
      "created_at": "2025-11-01T22:07:11Z",
      "updated_at": "2025-11-01T22:08:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483971855",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483971855"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483974664",
      "pull_request_review_id": 3407804710,
      "id": 2483974664,
      "node_id": "PRRC_kwDOABII586UDnII",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n-            // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n+        auto [itUs, inserted]{cacheCoins.try_emplace(it->first)};\n+        if (inserted) {\n+            if (it->second.IsFresh() && it->second.coin.IsSpent()) {",
      "path": "src/coins.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "in_reply_to_id": 2483807860,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Does not depend on itUs or cacheCoins, right?\r\n\r\nNot exactly, we're only executing that branch when `cacheCoins` was missing `it->first`.\r\nDoing your suggested:\r\n```C++\r\nif (!it->second.IsDirty() || (it->second.IsFresh() && it->second.coin.IsSpent())) { // TODO a cursor can only contain dirty entries\r\n    continue;\r\n}\r\n```\r\nresults in the following test failures\r\n```bash\r\ncmake -B build  -DCMAKE_BUILD_TYPE=Debug && cmake --build build && ./build/bin/test_bitcoin --run_test=coins_tests\r\n\r\ntest/coins_tests.cpp:799: error: in \"coins_tests/ccoins_write\": check GetCoinsMapEntry(test.cache.map()) == *expected_coin has failed [-1, 0 != -1, 1]\r\ntest/coins_tests.cpp:799: error: in \"coins_tests/ccoins_write\": check GetCoinsMapEntry(test.cache.map()) == *expected_coin has failed [-1, 2 != std::nullopt]\r\ntest/coins_tests.cpp:799: error: in \"coins_tests/ccoins_write\": check GetCoinsMapEntry(test.cache.map()) == *expected_coin has failed [-1, 3 != std::nullopt]\r\ntest/coins_tests.cpp:801: error: in \"coins_tests/ccoins_write\": exception std::logic_error expected but not raised\r\ntest/coins_tests.cpp:801: error: in \"coins_tests/ccoins_write\": exception std::logic_error expected but not raised\r\ntest/coins_tests.cpp:801: error: in \"coins_tests/ccoins_write\": exception std::logic_error expected but not raised\r\ntest/coins_tests.cpp:801: error: in \"coins_tests/ccoins_write\": exception std::logic_error expected but not raised\r\n```\r\n\r\nThat's why I asked:\r\n> Or you mean that we don't have to check `cacheCoins` for presence and should update `coins_tests/ccoins_write` to not have the false values?",
      "created_at": "2025-11-01T22:16:24Z",
      "updated_at": "2025-11-01T22:17:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483974664",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483974664"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483975804",
      "pull_request_review_id": 3407806038,
      "id": 2483975804,
      "node_id": "PRRC_kwDOABII586UDnZ8",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> we would need to get rid of the custom allocator\r\n\r\nI'm not so sure, I'd have different dbcache sizes during IBD and only reallocate after it finishes, since we don't actually need to narrow the cache size during IBD. After your input fetcher change we may never need to narrow it. We'll see, let's discuss that separately.\r\n\r\n> The non-reuse case should be the only one where we have to be explicit.\r\n\r\nI explicitly wanted to avoid that, but let me know if you insist, I don't mind that much.",
      "created_at": "2025-11-01T22:20:13Z",
      "updated_at": "2025-11-01T22:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483975804",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483975804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483977917",
      "pull_request_review_id": 3407807964,
      "id": 2483977917,
      "node_id": "PRRC_kwDOABII586UDn69",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I explicitly wanted to avoid that, but let me know if you insist, I don't mind that much.\r\n\r\nDon't you think it's safer to have the case that won't break either way be default, and then the performant case that can break if you pick the wrong option be explicit?",
      "created_at": "2025-11-01T22:26:30Z",
      "updated_at": "2025-11-01T22:26:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483977917",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483977917"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483978998",
      "pull_request_review_id": 3407808857,
      "id": 2483978998,
      "node_id": "PRRC_kwDOABII586UDoL2",
      "diff_hunk": "@@ -245,12 +245,14 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n+bool CCoinsViewCache::Flush(bool reallocate_cache) {",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "2d06ed75c5137a295646807cf1eee8f71d77da20",
      "original_commit_id": "195fc2fe102197eae27c33b5e3969a6b15d1253a",
      "in_reply_to_id": 2428528999,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Maybe, not sure, but I took your advice and pushed.",
      "created_at": "2025-11-01T22:30:41Z",
      "updated_at": "2025-11-01T22:30:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483978998",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483978998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483980214",
      "pull_request_review_id": 3407810062,
      "id": 2483980214,
      "node_id": "PRRC_kwDOABII586UDoe2",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries\n             continue;\n         }\n-        CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n-        if (itUs == cacheCoins.end()) {\n-            // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n+        auto [itUs, inserted]{cacheCoins.try_emplace(it->first)};\n+        if (inserted) {\n+            if (it->second.IsFresh() && it->second.coin.IsSpent()) {",
      "path": "src/coins.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "6657e5127cd9a17edcf3c2773188020340de414f",
      "in_reply_to_id": 2483807860,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Ahh right, we handle this case even though it can't be hit in production.\r\nI suppose it's valuable for regression testing, so we throw instead of silently allowing this.",
      "created_at": "2025-11-01T22:35:36Z",
      "updated_at": "2025-11-01T22:35:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2483980214",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483980214"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 193,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2484961831",
      "pull_request_review_id": 3408930686,
      "id": 2484961831,
      "node_id": "PRRC_kwDOABII586UHYIn",
      "diff_hunk": "@@ -402,14 +402,6 @@ FUZZ_TARGET(coinscache_sim)\n                 caches.back()->Sync();\n             },\n \n-            [&]() { // Flush + ReallocateCache.\n-                // Apply to simulation data.\n-                flush();\n-                // Apply to real caches.\n-                caches.back()->Flush();\n-                caches.back()->ReallocateCache();",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I believe this case should have been removed in https://github.com/bitcoin/bitcoin/pull/25325, which was merged just after this was introduced in https://github.com/bitcoin/bitcoin/pull/27011. So it likely got missed that `ReallocateCache` is always called.",
      "created_at": "2025-11-02T19:12:39Z",
      "updated_at": "2025-11-02T19:23:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2484961831",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2484961831"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 410,
      "original_line": 410,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2484965939",
      "pull_request_review_id": 3408930686,
      "id": 2484965939,
      "node_id": "PRRC_kwDOABII586UHZIz",
      "diff_hunk": "@@ -439,9 +439,10 @@ class CCoinsViewCache : public CCoinsViewBacked\n      * Push the modifications applied to this cache to its base and wipe local state.\n      * Failure to call this method or Sync() before destruction will cause the changes\n      * to be forgotten.\n+     * If specified, the cache will be cleared and reallocated for memory efficiency after flushing.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "original_commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n     * If will_reuse_cache is false, the cache will retain the same memory footprint after flushing and should be destroyed to deallocate.\r\n```",
      "created_at": "2025-11-02T19:23:16Z",
      "updated_at": "2025-11-02T19:23:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2484965939",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2484965939"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 442,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2485001950",
      "pull_request_review_id": 3408974874,
      "id": 2485001950,
      "node_id": "PRRC_kwDOABII586UHh7e",
      "diff_hunk": "@@ -439,9 +439,10 @@ class CCoinsViewCache : public CCoinsViewBacked\n      * Push the modifications applied to this cache to its base and wipe local state.\n      * Failure to call this method or Sync() before destruction will cause the changes\n      * to be forgotten.\n+     * If specified, the cache will be cleared and reallocated for memory efficiency after flushing.",
      "path": "src/coins.h",
      "position": 1,
      "original_position": 4,
      "commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "original_commit_id": "e4e4f05f18b1791a4625175c22a154cbcb94c371",
      "in_reply_to_id": 2484965939,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "[Done](https://github.com/bitcoin/bitcoin/compare/e4e4f05f18b1791a4625175c22a154cbcb94c371..0ac969cddfdba52f7947e9b140ef36e2b19c2c41)",
      "created_at": "2025-11-02T20:41:25Z",
      "updated_at": "2025-11-02T20:41:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2485001950",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2485001950"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 442,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600124064",
      "pull_request_review_id": 3554048589,
      "id": 2600124064,
      "node_id": "PRRC_kwDOABII586a-r6g",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries",
      "path": "src/coins.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "c8f5e446dc95712a63e4dd88786e2f7cb697b986",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Why not address these TODOs in this PR? Seems like all that needs to be done is pick the test changes from Andrew's commit?",
      "created_at": "2025-12-08T21:01:53Z",
      "updated_at": "2025-12-08T21:36:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2600124064",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600124064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600248073",
      "pull_request_review_id": 3554192017,
      "id": 2600248073,
      "node_id": "PRRC_kwDOABII586a_KMJ",
      "diff_hunk": "@@ -185,18 +185,16 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n-        if (!it->second.IsDirty()) {\n+        if (!it->second.IsDirty()) { // TODO a cursor can only contain dirty entries",
      "path": "src/coins.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "0ac969cddfdba52f7947e9b140ef36e2b19c2c41",
      "original_commit_id": "c8f5e446dc95712a63e4dd88786e2f7cb697b986",
      "in_reply_to_id": 2600124064,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We have tried fixing that a few times, a lot of tests need to be updated, see [`320482e` (#30673)](https://github.com/bitcoin/bitcoin/pull/30673/commits/320482e860cb6834984c0c52643021496e57a655#r2206103568) and it scared people and we didn't get reviews for that, so we're doing it in smaller chunks now.\r\n\r\nThe TODO makes sense here since it documents that the current approach isn't a pessimization, it favors the only case that can happen in reality. ",
      "created_at": "2025-12-08T21:45:15Z",
      "updated_at": "2025-12-08T21:45:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33602#discussion_r2600248073",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600248073"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33602"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    }
  ]
}
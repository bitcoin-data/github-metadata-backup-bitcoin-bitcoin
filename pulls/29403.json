{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403",
    "id": 1715711302,
    "node_id": "PR_kwDOABII585mQ61G",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/29403",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/29403.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/29403.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/2095ccdca0cf09073b51b3e9e0d5b9931825824d",
    "number": 29403,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: batch erase procedures and improve 'EraseRecords' performance",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Seeks to optimize and simplify `WalletBatch::EraseRecords`. Currently, this process opens a cursor to iterate over the entire database, searching for records that match the type prefixes, to then call the `WalletBatch::Erase` function for each of the matching records.\r\nThis PR rewrites this 40-line manual process into a single line; instead of performing all of those actions manually, we can simply utilize the `ErasePrefix()` functionality. The result is 06216b344dea6ad6c385fda0b37808ff9ae5273b.\r\n\r\nMoreover, it expands the test coverage for the `ErasePrefix` functionality and documents the db txn requirement for `BerkeleyBatch::ErasePrefix` .",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2024-02-07T13:42:56Z",
    "updated_at": "2024-02-10T10:53:58Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "58c6c9e92ff8487398a010bb8d920fe95943e4ae",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "furszy:2024_wallet_simplify_EraseRecords",
      "ref": "2024_wallet_simplify_EraseRecords",
      "sha": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 393368,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-09T21:08:31Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2023-08-30T13:12:58Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b2b2b1e9e415c3b5f74d517eaebfc2073cef5175",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36741,
        "stargazers_count": 73806,
        "watchers_count": 73806,
        "size": 249207,
        "default_branch": "master",
        "open_issues_count": 677,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-02-10T10:00:28Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-02-10T09:42:28Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 96,
    "deletions": 48,
    "changed_files": 6,
    "commits": 3,
    "review_comments": 26,
    "comments": 5
  },
  "events": [
    {
      "event": "commented",
      "id": 1932079274,
      "node_id": "IC_kwDOABII585zKTCq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932079274",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T13:42:59Z",
      "updated_at": "2024-02-10T10:53:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/29403).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1936428779), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1873039395) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28987](https://github.com/bitcoin/bitcoin/pull/28987) (wallet: simplify and batch zap wallet txes process by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932079274",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "labeled",
      "id": 11732630908,
      "node_id": "LE_lADOABII585-i32ezwAAAAK7Ub18",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11732630908",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T13:43:01Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 1867863458,
      "node_id": "PRR_kwDOABII585vVVWi",
      "url": null,
      "actor": null,
      "commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1867863458",
      "submitted_at": "2024-02-07T13:50:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:13:25Z",
      "updated_at": "2024-02-07T14:13:25Z",
      "source": {
        "issue": {
          "id": 1522557576,
          "node_id": "PR_kwDOABII585G0Yzm",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26836",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26836/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26836/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26836/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26836",
          "number": 26836,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: batch and simplify addressbook migration process",
          "body": "Commits decoupled from #28574, focused on the address book cloning process\r\n\r\nIncludes:\r\n\r\n1) DB batch operations and flow simplification for the address book migration process.\r\n2) Code improvements to `CWallet::DelAddressBook` and `Wallet::SetAddrBookWithDB` methods.\r\n\r\nThese changes will let us consolidate all individual write operations that take place during the wallet migration process into a single db txn in the future.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 14,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26836",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26836",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26836.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26836.patch"
          },
          "closed_at": "2024-02-08T14:35:56Z",
          "created_at": "2023-01-06T13:05:27Z",
          "updated_at": "2024-02-08T15:30:12Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11733059221,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK7WEaV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11733059221",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:15:33Z"
    },
    {
      "event": "commented",
      "id": 1932141334,
      "node_id": "IC_kwDOABII585zKiMW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932141334",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:16:21Z",
      "updated_at": "2024-02-07T14:16:21Z",
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks Marko.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932141334",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11733098359,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK7WN93",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11733098359",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:18:29Z"
    },
    {
      "event": "labeled",
      "id": 11733099584,
      "node_id": "LE_lADOABII585-i32ezwAAAAK7WORA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11733099584",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:18:35Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1932145648,
      "node_id": "IC_kwDOABII585zKjPw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932145648",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T14:18:36Z",
      "updated_at": "2024-02-07T14:18:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n\nðŸš§ At least one of the CI tasks failed. Make sure to run all tests locally, according to the\ndocumentation.\n\nPossibly this is due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/21321086502</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932145648",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "commented",
      "id": 1932273984,
      "node_id": "IC_kwDOABII585zLClA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1932273984",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T15:21:23Z",
      "updated_at": "2024-02-07T15:21:31Z",
      "author_association": "MEMBER",
      "body": "Green CI. Ready.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1932273984",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "unlabeled",
      "id": 11734630150,
      "node_id": "UNLE_lADOABII585-i32ezwAAAAK7cD8G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11734630150",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T16:10:09Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1868639990,
      "node_id": "PRR_kwDOABII585vYS72",
      "url": null,
      "actor": null,
      "commit_id": "69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 69c5bb5c3ad3da508541a3ef6c29a0bad21f2fc0",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1868639990",
      "submitted_at": "2024-02-07T19:46:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T20:38:23Z",
      "updated_at": "2024-02-07T20:38:23Z",
      "source": {
        "issue": {
          "id": 722711719,
          "node_id": "MDU6SXNzdWU3MjI3MTE3MTk=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20160/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/20160",
          "number": 20160,
          "state": "open",
          "state_reason": null,
          "title": "Proposed Timeline for Legacy Wallet and BDB removal",
          "body": "Here is a proposed timeline for the move from legacy wallets to descriptor wallets, and at the same time, bdb to sqlite, culminating with the removal of both legacy wallets and bdb. Even though the wallet type and the wallet storage format are orthogonal to each other, as noted in #19077, I would like to tie them together for the sake of simplicity when it comes to how we make new wallets and the migration of one type to another.\r\n\r\nThe 4 combinations of type and format are: legacy-bdb, legacy-sqlite, descriptor-bdb, and descriptor-sqlite. While all 4 types will be supported, we will primarily deal with legacy-bdb and descriptor-sqlite. Setting `descriptors=True` in `createwallet` (or checking the Descriptors option in the GUI) will always make a descriptor-sqlite. Setting that to `False` will always make a legacy-bdb.\r\n\r\n- [x] 0.21 (late 2020)\r\n  - [x] Initial release of descriptor type and sqlite format. (#16528, #19077)\r\n  - [x] Descriptor type is experimental with a warning as such (#16528)\r\n  - [x] Only legacy-bdb and descriptor-sqlite will be created (#19077)\r\n- [x] 22.0 (mid 2021)\r\n  - [x] Implement descriptor exports (#20226)\r\n  - [x] Legacy type remains default (no pr needed)\r\n  - [x] Introduce `dump` and `createfromdump` wallet tool commands with an additional `-format` option to specify the wallet type (#19137)\r\n    * Users may use `dump` and then `createfromdump` in order to make legacy-sqlite from legacy-bdb\r\n    * Users may use `dump` and then `createfromdump` in order to make descriptor-bdb from descriptor-sqlite\r\n  - [x] If a wallet specified in conf or command line doesn't exist, don't make a wallet and instead warn (#15454)\r\n- [x] 23.0 (early 2022)\r\n  - [x] Change descriptor type to non-experimental (#23002)\r\n  - [x] Change `createwallet` `descriptors` default to `True` (#23002)\r\n  - [x] Change wallet tool `create` `-descriptors` default to `True` (#23002)\r\n- [x] 24.0 (late 2022)\r\n  - [x] Introduce `migratewallet` command to migrate a legacy-bdb to descriptor-sqlite (#19602)\r\n  - [x] For newly created legacy-bdb wallets, warn that they are deprecated and will soon be unsupported (#24505)\r\n- [x] 26.0 (late 2023)\r\n  - [x] When loading legacy-bdb, descriptor-bdb, or legacy-sqlite wallets, warn that the legacy type and bdb format will soon be unsupported, as applicable. (#27869)\r\n  - [x] Deprecate creating new legacy-bdb wallets #28597 \r\n  - [x] `migratewallet` bug fixes\r\n    - [x] #28609\r\n    - [x] #28546\r\n- [ ] 27.0 (early 2024)\r\n  - [ ] Improve performance of migratewallet #28574\r\n    - [x] address book performance improvement #26836\r\n    - [ ] bulk deletion of txs performance improvement #28987\r\n    - [ ] bulk deletion of records performance improvement #29403\r\n  - [ ] Caching to improve performance of migrated non-HD descriptor wallets (also perf improvement in general) #26008\r\n  - [ ] Remove `migratewallet` experimental warning #28037 \r\n- [ ] 28.0 (late 2024)\r\n  - [ ] Reimplement legacy-bdb to descriptor-sqlite migration (maybe as a separate command or in the wallet tool) to be independent of `LegacyScriptPubKeyMan` and BDB (#26596)\r\n  - [ ] For `dump`, implement an independent BDB file loader (this should probably be shared with the previous) (#26606)\r\n  - [ ] Stop creating new legacy-bdb wallets (not yet started)\r\n  - [ ] GUI: Migrate wallets that are not loaded (not yet started)\r\n- [ ] 29.0 (early 2025)\r\n  - [ ] Stop loading legacy-bdb, descriptor-bdb, legacy-sqlite wallet entirely. Inform users how to migrate (not yet started)\r\n  - [ ] Remove `LegacyScriptPubKeyMan` except for the independent migration stuff (#28710)\r\n  - [ ] Remove BDB except for independent loading for migration stuff (#28710)\r\n\r\nAdditional improvements that have no target deadline:\r\n\r\n- [x] Backwards compatibility tests fixes for descriptor wallets #28027\r\n\r\nThe migration code will probably be around for a long time/forever.\r\n\r\nNote that we expect users who go through the effort to make a legacy-sqlite or descriptor-bdb wallet to suck it up and deal with the consequences of doing something that isn't really supported. Such users should be able to figure out for themselves how to migrate their wallets. (Maybe `migratewallet` can migrate legacy-sqlite to descriptor-sqlite. bdb to sqlite is way easier than legacy to descriptor).",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 36,
          "created_at": "2020-10-15T22:17:41Z",
          "updated_at": "2024-02-08T14:36:27Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11738637527,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK7rWTX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11738637527",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-07T22:37:47Z"
    },
    {
      "event": "reviewed",
      "id": 1868847059,
      "node_id": "PRR_kwDOABII585vZFfT",
      "url": null,
      "actor": null,
      "commit_id": "0fd7b0dafa980a5dbcee8658d18a83f4eff57085",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks achow!",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1868847059",
      "submitted_at": "2024-02-07T22:38:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11746338678,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK8Iud2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11746338678",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T14:11:30Z"
    },
    {
      "event": "reviewed",
      "id": 1870335464,
      "node_id": "PRR_kwDOABII585vew3o",
      "url": null,
      "actor": null,
      "commit_id": "784034f8a17d46de9eab7de6fdec673a3a3d79d8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks achow.\r\n[Small diff](https://github.com/bitcoin/bitcoin/compare/0fd7b0dafa980a5dbcee8658d18a83f4eff57085..784034f8a17d46de9eab7de6fdec673a3a3d79d8), only changed `assert` for `Assume`.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1870335464",
      "submitted_at": "2024-02-08T14:16:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11747889667,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK8OpID",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11747889667",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T15:56:46Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11748184644,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK8PxJE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11748184644",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T16:16:55Z"
    },
    {
      "event": "reviewed",
      "id": 1870828867,
      "node_id": "PRR_kwDOABII585vgpVD",
      "url": null,
      "actor": null,
      "commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Rebased after #26836 merge. Ready to go.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1870828867",
      "submitted_at": "2024-02-08T17:20:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "reviewed",
      "id": 1871128813,
      "node_id": "PRR_kwDOABII585vhyjt",
      "url": null,
      "actor": null,
      "commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1871128813",
      "submitted_at": "2024-02-08T19:47:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "reviewed",
      "id": 1871254500,
      "node_id": "PRR_kwDOABII585viRPk",
      "url": null,
      "actor": null,
      "commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Light code review ACK 757d6516db56e2732ea77624e66025446cb816a4, nice simplification of EraseRecords\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1871254500",
      "submitted_at": "2024-02-08T21:05:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "review_requested",
      "id": 11751261669,
      "node_id": "RRE_lADOABII585-i32ezwAAAAK8bgXl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11751261669",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-08T21:05:45Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T08:29:31Z",
      "updated_at": "2024-02-09T08:29:31Z",
      "source": {
        "issue": {
          "id": 1958204865,
          "node_id": "PR_kwDOABII585dlfBo",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28710/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
          "number": 28710,
          "state": "open",
          "state_reason": null,
          "title": "Remove the legacy wallet and BDB dependency",
          "body": "The final step of #20160.\r\n\r\nA bare minimum of legacy wallet code is kept in order to perform wallet migration. Migration of legacy wallets uses the independent BDB parser and a minimal `LegacyDataSPKM` that allows the legacy data to be loaded so that the migration can be completed.\r\n\r\nAll tests which tested legacy wallet behavior have been removed. The `--descriptors` and `--legacy-wallet` options are removed from the functional tests.\r\n\r\nBDB has been removed as a dependency and documentation have been updated to reflect that.\r\n\r\nDepends on #26596",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28710",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28710",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28710.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28710.patch"
          },
          "created_at": "2023-10-23T23:36:07Z",
          "updated_at": "2024-02-10T04:46:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11757251782,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK8yWzG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11757251782",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T12:11:50Z"
    },
    {
      "event": "reviewed",
      "id": 1871240281,
      "node_id": "PRR_kwDOABII585viNxZ",
      "url": null,
      "actor": null,
      "commit_id": "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks both!",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1871240281",
      "submitted_at": "2024-02-09T12:12:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "commented",
      "id": 1936428779,
      "node_id": "IC_kwDOABII585za47r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1936428779",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T18:41:50Z",
      "updated_at": "2024-02-09T18:41:50Z",
      "author_association": "MEMBER",
      "body": "ACK 8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#issuecomment-1936428779",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/29403"
    },
    {
      "event": "review_request_removed",
      "id": 11761338493,
      "node_id": "RRRE_lADOABII585-i32ezwAAAAK9B8h9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11761338493",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T18:41:54Z",
      "requested_reviewer": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 11761338578,
      "node_id": "RRE_lADOABII585-i32ezwAAAAK9B8jS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11761338578",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T18:41:54Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 1873039395,
      "node_id": "PRR_kwDOABII585vpFAj",
      "url": null,
      "actor": null,
      "commit_id": "8330145ba88b39ddaa9e0bbfc2d1c198da652249",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 8330145ba88b39ddaa9e0bbfc2d1c198da652249. Looks pretty good, but would suggest cleaning up some things",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1873039395",
      "submitted_at": "2024-02-09T19:44:44Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQyMzYyMWEyODMyNTgyZWVkOGRkZDA1M2QwY2ZhMGEwODNmNjYyZmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/423621a2832582eed8ddd053d0cfa0a083f662fe",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/423621a2832582eed8ddd053d0cfa0a083f662fe",
      "tree": {
        "sha": "fe462368cc27ecf124af45297ea1defce57edc8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fe462368cc27ecf124af45297ea1defce57edc8f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree fe462368cc27ecf124af45297ea1defce57edc8f\nparent 835948d44bca664901057c37ed5b1d0e7e658786\nauthor furszy <matiasfurszyfer@protonmail.com> 1707406466 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707510013 -0300\n\nwallet: db, introduce 'RunWithinTxn()' helper function\n\n'RunWithinTxn()' provides a way to execute db operations within a\ntransactional context. It avoids writing repetitive boilerplate code for\nstarting and committing the database transaction.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXGiP0ACgkQXdI8zGhq\npiMJ2w/9E5juSyABa0VcYRj5WL+NDSATqWIJendOH2g+jH/5BK4495Tia6OIyPM0\n/nwsaPKFgRHU9dnE8QTSP9HvAWXZMkuSa1yyzAeHcOa4X6TGhLdQImdko33qjmig\nlMjGJ69mWoV1J0CLLi+ptCwekciWjWHgYisJupbbBU1hoLNW49+C1AdfLFp0LZUo\nHmz8SOqXwE6lucjihSPQCwj/Ae5KOJGb7DQ/dMeNkahSkc7QL25ktzYaWAT9dK1W\nxHVktgcPYQfoRoUdtpYnOj3V0+5gjipzK8Wo8fuRrI1uJB4B7OxN5mHbvUFzXxJC\nGQDS2NEOAX1298XUSC9kroSydLYRdSYN2BXaRHkdLzDJoo/8V/hIuL7pVokwbCdq\nYO9oKNQ5EFmkddtIntMHM7xXnNi/zNYm1S47wy688wLnWB0a/vqP6cFQYMYuCLnX\nK3z800k8zUdxyahMuh2ZkvgucI8+U4zBZiQME5FbjDvLeYU05zr9UDwpqVeyCi6s\ny77r6DRvEstD2vl5WIGf4dWhFXL3XY4y3v3RHfP1RN34vLRTqImjhdf8M72Vszvk\nSHBBg/qmLSs8z/BhC79I+k7zlKnVDlaISwbm3tkdua5ciwcEiFsNmW5jr6OgjGbq\nKkSx77Tqg7o38apXJmmfi887gHYQSLp3EfNtBV5rTznWyLwGkmw=\n=qdrj\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/835948d44bca664901057c37ed5b1d0e7e658786",
          "sha": "835948d44bca664901057c37ed5b1d0e7e658786",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/835948d44bca664901057c37ed5b1d0e7e658786"
        }
      ],
      "message": "wallet: db, introduce 'RunWithinTxn()' helper function\n\n'RunWithinTxn()' provides a way to execute db operations within a\ntransactional context. It avoids writing repetitive boilerplate code for\nstarting and committing the database transaction.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T20:20:13Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-08T15:34:26Z"
      },
      "sha": "423621a2832582eed8ddd053d0cfa0a083f662fe"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA2MTc5MDJmYWQ5YWEwOWM5NmUwZWQyZjMzMWM1NzRlYmIzMmZiYmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0617902fad9aa09c96e0ed2f331c574ebb32fbbb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0617902fad9aa09c96e0ed2f331c574ebb32fbbb",
      "tree": {
        "sha": "24105963534d56cc7d63d96a597ee64f434f4ef7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/24105963534d56cc7d63d96a597ee64f434f4ef7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 24105963534d56cc7d63d96a597ee64f434f4ef7\nparent 423621a2832582eed8ddd053d0cfa0a083f662fe\nauthor furszy <matiasfurszyfer@protonmail.com> 1707247703 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707510013 -0300\n\nwallet: bdb batch 'ErasePrefix', do not create txn internally\n\nTransactions are intended to be started on upper layers rather than\ninternally by the bdb batch object. This enables us to consolidate\ndifferent write operations within a procedure in the same db txn,\nimproving consistency due to the atomic property of the transaction,\nas well as its performance due to the reduction of disk write\noperations.\n\nImportant Note:\nThis approach also ensures that the BerkeleyBatch::ErasePrefix\nfunction behaves exactly as the SQLiteBatch::ErasePrefix function,\nwhich does not create a db txn internally.\n\nFurthermore, since the `BerkeleyBatch::ErasePrefix' implementation\nerases records one by one (by traversing the db), this change\nensures that the function is always called within an active txn\ncontext. Without this measure, there's a potential risk to consistency;\ncertain records may be removed while others could persist due to an\ninternal failure during the procedure.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXGiP0ACgkQXdI8zGhq\npiOapw//WFaOZgCJXA943bLmAFbu6pQ6Vfj4NznL+lxRdTlFw4coFROaVwvpct65\nU9UkYVdfDf8l830DabgL+uPBkNbMkpFa1xTwIwAsdvgziEmp5yhY77fLsB7hviEV\nTgsTINH8+OENKHACEKPFDHyKhX4gDQM9ar2+YDH5R3y5cWGuvniWmqos4oIcxyvt\npQlRdYlEd6H1HB4kJ0XgwXj65LuBRp4FB034yufLMW8u8kzARU1wsHTP/SgtiVwl\nMmM6jLtQFgTLVjIuClJGdzB/vRlYs3JHjHvUFGL007b2Pgdac+igLyVhB7x+gp0x\n11A+TG/WAhDfq/ODMsEJBKdfyXG0dCk0uept6JIDzVKj1kpVJDQ91U7DZ8G3HBxr\nQr3ywzWwSInwmZ/jspWeFuGSMtE0hS6GBLrp8Eh7vZ+U5MpRnKBRj0Z9hXCBk6UG\nqKt5L0ZqJ25ZLuAtmst9nILssLe7gTWD+mL6mdxfP+sCAvb5DxSZ1bETtB93Jq+9\nKqJ2KusV/XDXxiUAzYd6927S5l/jvo2HU90TboZypoXrHy3oW3+TuStUJrI7raPO\nU3QqZ3MIe2Y8lsbRECrWIDwwhugQ9QDmLrGaiWdVqda+u1bHJXQOgAtg6V7YEsxH\nMqCPi5JHMMNccMRqQoaA+lLW6Cmmhy+YAmLVMVP2iV/fBG6HIY0=\n=5pM3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/423621a2832582eed8ddd053d0cfa0a083f662fe",
          "sha": "423621a2832582eed8ddd053d0cfa0a083f662fe",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/423621a2832582eed8ddd053d0cfa0a083f662fe"
        }
      ],
      "message": "wallet: bdb batch 'ErasePrefix', do not create txn internally\n\nTransactions are intended to be started on upper layers rather than\ninternally by the bdb batch object. This enables us to consolidate\ndifferent write operations within a procedure in the same db txn,\nimproving consistency due to the atomic property of the transaction,\nas well as its performance due to the reduction of disk write\noperations.\n\nImportant Note:\nThis approach also ensures that the BerkeleyBatch::ErasePrefix\nfunction behaves exactly as the SQLiteBatch::ErasePrefix function,\nwhich does not create a db txn internally.\n\nFurthermore, since the `BerkeleyBatch::ErasePrefix' implementation\nerases records one by one (by traversing the db), this change\nensures that the function is always called within an active txn\ncontext. Without this measure, there's a potential risk to consistency;\ncertain records may be removed while others could persist due to an\ninternal failure during the procedure.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T20:20:13Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T19:28:23Z"
      },
      "sha": "0617902fad9aa09c96e0ed2f331c574ebb32fbbb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDIwOTVjY2RjYTBjZjA5MDczYjUxYjNlOWUwZDViOTkzMTgyNTgyNGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "tree": {
        "sha": "2f598b765ee0c14fda0da34ca3a27a48703a4e32",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2f598b765ee0c14fda0da34ca3a27a48703a4e32"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2f598b765ee0c14fda0da34ca3a27a48703a4e32\nparent 0617902fad9aa09c96e0ed2f331c574ebb32fbbb\nauthor furszy <matiasfurszyfer@protonmail.com> 1707225948 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1707510013 -0300\n\nwallet: simplify EraseRecords by using 'ErasePrefix'\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmXGiP0ACgkQXdI8zGhq\npiNhWg//TokNxk9vo755mis09NVnhSwNG7ZMBsjEMSiEI1HPPwmrq4LUfXnhcA4b\naDh58+vVZyVht5n4OE4fbF4eC38OH17WCsV3svMf15zB8andzh1PI7h1CbPNo4KH\nJmiiXOBgRwJ9R2jXU0d6Enajo7JZyOjZ6eYZZbS6BNa7OOHRvgySU49pIxvOLk+M\nKKTOuu6p/+7gde5SRXuPU6hYf8han2AK0HrGvO8h/PlbIXjcVVAwKwUjRu/Dx9J6\nAXVJpN0v76oaClbQpzpSupsPj+MBT2Sf556cXeYeT2Re0spUhq4DMrPDUMojMSxh\nal3nJoqZj9wHQLRUDCEraHW6jlZ6d2bCTcEzJMaOjup+nhSowaQdqq9Zmuc/EZQp\ndK2jcdnxApjmex5EuxbM+8BLKFtfkW5de/0pPpnFEkLnegkJH9TPJpqA2zGJh0Py\noi/1fD3EGRuZALn4uq+By5Zr1btyaRHTynsSj8IGyRXURphMTrWL7QCYDp3dZTPM\nhWWdy4QUCFTqqEr4QexRPoR2FJtZnTy3FDLINUDzf0Wrn5A38I71AbkRPtZvhdUH\nprSCflZCT0VagWyUkSV5kTOgiw3n/DnCDaD2S3vFeFqfbmUcO1c/XW7STnPrd1f/\nOsKyVswuD0beMvVrOAwUorsc22AWAxj1ruE8VbbwdTU+zTqh6SE=\n=dyEF\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0617902fad9aa09c96e0ed2f331c574ebb32fbbb",
          "sha": "0617902fad9aa09c96e0ed2f331c574ebb32fbbb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0617902fad9aa09c96e0ed2f331c574ebb32fbbb"
        }
      ],
      "message": "wallet: simplify EraseRecords by using 'ErasePrefix'",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-09T20:20:13Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-02-06T13:25:48Z"
      },
      "sha": "2095ccdca0cf09073b51b3e9e0d5b9931825824d"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 11762125294,
      "node_id": "HRFPE_lADOABII585-i32ezwAAAAK9E8nu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11762125294",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-09T20:21:08Z"
    },
    {
      "event": "reviewed",
      "id": 1873150521,
      "node_id": "PRR_kwDOABII585vpgI5",
      "url": null,
      "actor": null,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks ryanofsky!. [Small diff](https://github.com/bitcoin/bitcoin/compare/8330145ba88b39ddaa9e0bbfc2d1c198da652249..2095ccdca0cf09073b51b3e9e0d5b9931825824d).\r\nPer request, now `RunWithinTxn` logs an error when the provided function requires to abort the db txn. As well as two comments have been improved for clarity.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#pullrequestreview-1873150521",
      "submitted_at": "2024-02-09T20:29:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-02-10T03:43:26Z",
      "updated_at": "2024-02-10T03:43:26Z",
      "source": {
        "issue": {
          "id": 2022052116,
          "node_id": "PR_kwDOABII585g9dwJ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28987/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28987",
          "number": 28987,
          "state": "open",
          "state_reason": null,
          "title": "wallet: simplify and batch zap wallet txes process",
          "body": "Work decoupled from #28574. Brother of #28894.\r\n\r\nIncludes two different, yet interconnected, performance and code improvements to the zap wallet transactions process.\r\n\r\n1) As the goal of the `ZapSelectTx` function is to erase tx records that match any of the inputted hashes. There is no need to traverse the whole database record by record. We could just check if the tx exist, and remove it directly by calling `EraseTx()`.\r\n\r\n2) Instead of performing single write operations per removed tx record, this PR batches them all within a single atomic db txn.\r\n\r\nMoreover, these changes will enable us to consolidate all individual write operations that take place during the wallet migration process into a single db txn in the future.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28987",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28987",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28987.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28987.patch"
          },
          "created_at": "2023-12-02T14:03:31Z",
          "updated_at": "2024-02-10T03:43:25Z"
        },
        "type": "issue"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563",
      "pull_request_review_id": 1867863458,
      "id": 1481506563,
      "node_id": "PRRC_kwDOABII585YTf8D",
      "diff_hunk": "@@ -2395,15 +2395,37 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n             return false;\n         }\n+\n+        WalletBatch batch(GetDatabase());\n+        if (!batch.TxnBegin()) {\n+            WalletLogPrintf(\"Error: cannot create db txn for address book entry removal\\n\");\n+            return false;\n+        }\n+\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {\n+            WalletLogPrintf(\"%s error erasing purpose/name\\n\", __func__);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit, feel free to ignore: Any reason to add `__func__` to this log, when none of the other logs have it here? If someone is interested in the exact source location, they can enable the corresponding log option. If this is needed for context, it could make more sense to clarify the log message itself, so that it is unique and clear without requiring the source code as context.\r\n",
      "created_at": "2024-02-07T13:50:54Z",
      "updated_at": "2024-02-07T13:50:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481506563",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481506563"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2413,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481525685",
      "pull_request_review_id": 1867895148,
      "id": 1481525685,
      "node_id": "PRRC_kwDOABII585YTkm1",
      "diff_hunk": "@@ -2395,15 +2395,37 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             WalletLogPrintf(\"%s called with IsMine address, NOT SUPPORTED. Please report this bug! %s\\n\", __func__, PACKAGE_BUGREPORT);\n             return false;\n         }\n+\n+        WalletBatch batch(GetDatabase());\n+        if (!batch.TxnBegin()) {\n+            WalletLogPrintf(\"Error: cannot create db txn for address book entry removal\\n\");\n+            return false;\n+        }\n+\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {\n+            WalletLogPrintf(\"%s error erasing purpose/name\\n\", __func__);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "da103ecf4a7a341e7376c6ef31af11aed05aed5c",
      "in_reply_to_id": 1481506563,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Any reason to add `__func__` to this log, when none of the other logs have it here?\r\n\r\nNot really. It is just a bad habit. I pulled 9a4e1f5 from #26836 because it is required for this changes. Will change it there.",
      "created_at": "2024-02-07T14:04:31Z",
      "updated_at": "2024-02-07T14:04:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481525685",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481525685"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2413,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481997602",
      "pull_request_review_id": 1868639990,
      "id": 1481997602,
      "node_id": "PRRC_kwDOABII585YVX0i",
      "diff_hunk": "@@ -2396,14 +2397,24 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "2d770f6ae88d9ee6f1775e011f241274059fe275",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 2d770f6ae88d9ee6f1775e011f241274059fe275 \"wallet: clean redundancies in DelAddressBook\"\r\n\r\nI'd prefer to have these occur separately so that a distinct error can be logged for each, that way we can discover which operation failed.",
      "created_at": "2024-02-07T19:43:17Z",
      "updated_at": "2024-02-07T19:46:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1481997602",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1481997602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2406,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482000338",
      "pull_request_review_id": 1868639990,
      "id": 1482000338,
      "node_id": "PRRC_kwDOABII585YVYfS",
      "diff_hunk": "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 0dba0b6de03c0c79bb09296b913729ec8eb75aca \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nInstead of `assert`ing, I would prefer if this did `if (!Assume(activeTxn)) return false` so we didn't cause nodes to crash if a transaction were missing for whatever reason. `Assume` should still catch this for developers.",
      "created_at": "2024-02-07T19:46:01Z",
      "updated_at": "2024-02-07T19:46:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482000338",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482000338"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482126505",
      "pull_request_review_id": 1868847059,
      "id": 1482126505,
      "node_id": "PRRC_kwDOABII585YV3Sp",
      "diff_hunk": "@@ -2396,14 +2397,24 @@ bool CWallet::DelAddressBook(const CTxDestination& address)\n             return false;\n         }\n         // Delete data rows associated with this address\n-        batch.EraseAddressData(address);\n+        if (!batch.EraseAddressData(address)) {\n+            WalletLogPrintf(\"Error: cannot erase address book entry data\\n\");\n+            return false;\n+        }\n+\n+        // Delete purpose and name\n+        if (!batch.ErasePurpose(dest) || !batch.EraseName(dest)) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "2d770f6ae88d9ee6f1775e011f241274059fe275",
      "in_reply_to_id": 1481997602,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I'd prefer to have these occur separately so that a distinct error can be logged for each, that way we can discover which operation failed.\r\n\r\nSure. Also decoupled it in #26836.",
      "created_at": "2024-02-07T21:35:29Z",
      "updated_at": "2024-02-07T22:38:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482126505",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482126505"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2406,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482179514",
      "pull_request_review_id": 1868847059,
      "id": 1482179514,
      "node_id": "PRRC_kwDOABII585YWEO6",
      "diff_hunk": "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "in_reply_to_id": 1482000338,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Instead of `assert`ing, I would prefer if this did `if (!Assume(activeTxn)) return false` so we didn't cause nodes to crash if a transaction were missing for whatever reason. `Assume` should still catch this for developers.\r\n\r\nThat would be risky in terms of consistency. `BerkeleyBatch::ErasePrefix` traverses the entire db, reading entries one by one, erasing the ones that match the key prefix. If we don't execute this function within a txn context, it's possible that certain records are removed while others remain due to an internal failure during the procedure.\r\n\r\nCurrently, the only function that uses `ErasePrefix()` is `WalletBatch::EraseAddressData`, which is exclusively called from `CWallet::DelAddressBook`, which is modified in the first two commits (thats one of the reasons behind taking those commits from #26836). This prevents any crashing risk.",
      "created_at": "2024-02-07T22:36:08Z",
      "updated_at": "2024-02-07T22:39:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482179514",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482179514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482191573",
      "pull_request_review_id": 1868946380,
      "id": 1482191573,
      "node_id": "PRRC_kwDOABII585YWHLV",
      "diff_hunk": "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "in_reply_to_id": 1482000338,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sure, that's why I suggest using `Assume`, and `return false` if there is no `activeTxn`. The callers of this should already be checking the return value to know whether the records were actually erased from the database.",
      "created_at": "2024-02-07T22:52:30Z",
      "updated_at": "2024-02-07T22:52:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1482191573",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1482191573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483038171",
      "pull_request_review_id": 1870328563,
      "id": 1483038171,
      "node_id": "PRRC_kwDOABII585YZV3b",
      "diff_hunk": "@@ -887,7 +887,7 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    assert(activeTxn); // because this is a read-write operation, the current db config requires a txn context.",
      "path": "src/wallet/bdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "0dba0b6de03c0c79bb09296b913729ec8eb75aca",
      "in_reply_to_id": 1482000338,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Sure, that's why I suggest using `Assume`, and `return false` if there is no `activeTxn`. The callers of this should already be checking the return value to know whether the records were actually erased from the database.\r\n\r\nah, I completely skipped the `return false` last night.. sorry. All good, pushed.",
      "created_at": "2024-02-08T14:13:45Z",
      "updated_at": "2024-02-08T14:13:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483038171",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483038171"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514110",
      "pull_request_review_id": 1871128813,
      "id": 1483514110,
      "node_id": "PRRC_kwDOABII585YbKD-",
      "diff_hunk": "@@ -228,6 +228,39 @@ BOOST_AUTO_TEST_CASE(db_availability_after_write_error)\n     }\n }\n \n+// Verify 'ErasePrefix' functionality using db keys similar to the ones used by the wallet.\n+// Keys are in the form of std::pair<TYPE, ENTRY_ID>\n+BOOST_AUTO_TEST_CASE(erase_prefix)\n+{\n+    const std::string key = \"key\";\n+    const std::string key2 = \"key2\";\n+    const std::string value = \"value\";\n+    const std::string value2 = \"value_2\";\n+    auto make_key = [](std::string type, std::string id) { return std::make_pair(type, id); };\n+\n+    for (const auto& database : TestDatabases(m_path_root)) {\n+        std::unique_ptr<DatabaseBatch> batch = database->MakeBatch();\n+\n+        // Write two entries with the same key type prefix, a third one with a different prefix\n+        // and a fourth one with the type-id values inverted\n+        BOOST_CHECK(batch->Write(make_key(key, value), value));\n+        BOOST_CHECK(batch->Write(make_key(key, value2), value2));\n+        BOOST_CHECK(batch->Write(make_key(key2, value), value));\n+        BOOST_CHECK(batch->Write(make_key(value, key), value));\n+\n+        // Erase the ones with the same prefix and verify result\n+        BOOST_CHECK(batch->TxnBegin());\n+        BOOST_CHECK(batch->ErasePrefix(DataStream() << key));\n+        BOOST_CHECK(batch->TxnCommit());",
      "path": "src/wallet/test/db_tests.cpp",
      "position": 27,
      "original_position": 27,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nnit: Could use `RunWithinTxn()`.",
      "created_at": "2024-02-08T19:45:10Z",
      "updated_at": "2024-02-08T19:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514110",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 252,
      "original_start_line": 252,
      "start_side": "RIGHT",
      "line": 254,
      "original_line": 254,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514234",
      "pull_request_review_id": 1871128813,
      "id": 1483514234,
      "node_id": "PRRC_kwDOABII585YbKF6",
      "diff_hunk": "@@ -447,7 +447,9 @@ BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n             BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n             WalletBatch batch{wallet->GetDatabase()};\n             BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.TxnBegin()); // bdb requirement (more info at BerkeleyBatch::ErasePrefix)\n             BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+            BOOST_CHECK(batch.TxnCommit());",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nnit: Could use `RunWithinTxn()`.",
      "created_at": "2024-02-08T19:45:19Z",
      "updated_at": "2024-02-08T19:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514234",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514234"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": 450,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514809",
      "pull_request_review_id": 1871128813,
      "id": 1483514809,
      "node_id": "PRRC_kwDOABII585YbKO5",
      "diff_hunk": "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "path": "src/wallet/bdb.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 523525707742fc620039cd67e8f1437f7f613a01 \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n\r\nI think it would be relevant to mention that BDB returns errors on `del()` if it is not in a transaction.",
      "created_at": "2024-02-08T19:45:53Z",
      "updated_at": "2024-02-08T19:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483514809"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 890,
      "original_start_line": 890,
      "start_side": "RIGHT",
      "line": 892,
      "original_line": 892,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483515740",
      "pull_request_review_id": 1871128813,
      "id": 1483515740,
      "node_id": "PRRC_kwDOABII585YbKdc",
      "diff_hunk": "@@ -1337,6 +1336,12 @@ bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, con\n     return true;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 757d6516db56e2732ea77624e66025446cb816a4 \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n\r\nThis overload feels unnecessary given that there are only 2 places this function is really used.",
      "created_at": "2024-02-08T19:46:53Z",
      "updated_at": "2024-02-08T19:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483515740",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483515740"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1339,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483516605",
      "pull_request_review_id": 1871128813,
      "id": 1483516605,
      "node_id": "PRRC_kwDOABII585YbKq9",
      "diff_hunk": "@@ -1314,9 +1314,8 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n-bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)\n+static bool RunWithinTxn(WalletBatch& batch, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In 757d6516db56e2732ea77624e66025446cb816a4 \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n\r\nThis could be done in the commit introducing `RunWithinTxn()` rather than changing it in a later commit.",
      "created_at": "2024-02-08T19:47:43Z",
      "updated_at": "2024-02-08T19:47:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483516605",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483516605"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483579553",
      "pull_request_review_id": 1871240281,
      "id": 1483579553,
      "node_id": "PRRC_kwDOABII585YbaCh",
      "diff_hunk": "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "path": "src/wallet/bdb.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": 1483514809,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I think it would be relevant to mention that BDB returns errors on del() if it is not in a transaction.\r\n\r\nSure, we could mention that the read-write operation is currently disallowed by our current bdb configurations.\r\n\r\nStill, JFYI, I fixed it locally by subdividing the read-write operations. However, since we currently ensure that all callers start a transaction, and this division adds an extra loop over the matching entries (see https://github.com/furszy/bitcoin-core/commit/4e7b5c02837b6b3bc3d1ee81a52e801996f763b7), I didn't see it as worth pushing it.\r\n\r\n",
      "created_at": "2024-02-08T20:55:08Z",
      "updated_at": "2024-02-09T12:12:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483579553",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483579553"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 890,
      "original_start_line": 890,
      "start_side": "RIGHT",
      "line": 892,
      "original_line": 892,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483587941",
      "pull_request_review_id": 1871240281,
      "id": 1483587941,
      "node_id": "PRRC_kwDOABII585YbcFl",
      "diff_hunk": "@@ -228,6 +228,39 @@ BOOST_AUTO_TEST_CASE(db_availability_after_write_error)\n     }\n }\n \n+// Verify 'ErasePrefix' functionality using db keys similar to the ones used by the wallet.\n+// Keys are in the form of std::pair<TYPE, ENTRY_ID>\n+BOOST_AUTO_TEST_CASE(erase_prefix)\n+{\n+    const std::string key = \"key\";\n+    const std::string key2 = \"key2\";\n+    const std::string value = \"value\";\n+    const std::string value2 = \"value_2\";\n+    auto make_key = [](std::string type, std::string id) { return std::make_pair(type, id); };\n+\n+    for (const auto& database : TestDatabases(m_path_root)) {\n+        std::unique_ptr<DatabaseBatch> batch = database->MakeBatch();\n+\n+        // Write two entries with the same key type prefix, a third one with a different prefix\n+        // and a fourth one with the type-id values inverted\n+        BOOST_CHECK(batch->Write(make_key(key, value), value));\n+        BOOST_CHECK(batch->Write(make_key(key, value2), value2));\n+        BOOST_CHECK(batch->Write(make_key(key2, value), value));\n+        BOOST_CHECK(batch->Write(make_key(value, key), value));\n+\n+        // Erase the ones with the same prefix and verify result\n+        BOOST_CHECK(batch->TxnBegin());\n+        BOOST_CHECK(batch->ErasePrefix(DataStream() << key));\n+        BOOST_CHECK(batch->TxnCommit());",
      "path": "src/wallet/test/db_tests.cpp",
      "position": 27,
      "original_position": 27,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": 1483514110,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> In [5235257](https://github.com/bitcoin/bitcoin/commit/523525707742fc620039cd67e8f1437f7f613a01) \"wallet: bdb batch 'ErasePrefix', do not create txn internally\"\r\n> \r\n> nit: Could use `RunWithinTxn()`.\r\n\r\nI did not used it because it needs `walletdb.h` dependency (`RunWithinTxn` provides access to `WalletBatch`). And this tests (`db_tests.cpp`) run on a lower level, using `DatabaseBatch`.",
      "created_at": "2024-02-08T21:04:18Z",
      "updated_at": "2024-02-09T12:12:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483587941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483587941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 252,
      "original_start_line": 252,
      "start_side": "RIGHT",
      "line": 254,
      "original_line": 254,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483588570",
      "pull_request_review_id": 1871254500,
      "id": 1483588570,
      "node_id": "PRRC_kwDOABII585YbcPa",
      "diff_hunk": "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "a8a24cb20974cb8eaec8cb438f6b22489719d605",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (a8a24cb20974cb8eaec8cb438f6b22489719d605)\r\n\r\nMaybe use string_view instead of string, since in most cases this is just passed a string literal, so no need to create a full string object",
      "created_at": "2024-02-08T21:04:58Z",
      "updated_at": "2024-02-08T21:05:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483588570",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483588570"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483617478",
      "pull_request_review_id": 1871240281,
      "id": 1483617478,
      "node_id": "PRRC_kwDOABII585YbjTG",
      "diff_hunk": "@@ -1337,6 +1336,12 @@ bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, con\n     return true;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "in_reply_to_id": 1483515740,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> In [757d651](https://github.com/bitcoin/bitcoin/commit/757d6516db56e2732ea77624e66025446cb816a4) \"wallet: simplify EraseRecords by using 'ErasePrefix'\"\r\n> \r\n> This overload feels unnecessary given that there are only 2 places this function is really used.\r\n\r\nThe idea is to use this function as a top-level wrapper for wallet functions and scope the other function for internal `walletdb.cpp` usage mostly/only. This approach avoids creating `WalletBatch` objects across the sources and makes use of the error-handling code in the `WalletBatch` destructor.\r\nFunctions such as `DescriptorScriptPubKeyMan::TopUp`, the two `CWallet::SetupDescriptorScriptPubKeyMans`, and the final state of the batched migration process can utilize this overload in a follow-up.",
      "created_at": "2024-02-08T21:35:49Z",
      "updated_at": "2024-02-09T12:12:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483617478",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483617478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1339,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483619574",
      "pull_request_review_id": 1871240281,
      "id": 1483619574,
      "node_id": "PRRC_kwDOABII585Ybjz2",
      "diff_hunk": "@@ -1314,9 +1314,8 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n-bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)\n+static bool RunWithinTxn(WalletBatch& batch, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "757d6516db56e2732ea77624e66025446cb816a4",
      "in_reply_to_id": 1483516605,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> This could be done in the commit introducing `RunWithinTxn()` rather than changing it in a later commit.\r\n\r\nThis is merely an organizational discussion, but.. I'm not a big fan of introducing a function overload in a commit that does not utilizes it. Yet, if you have a strong opinion about it, I could move this to the first commit. np.",
      "created_at": "2024-02-08T21:37:16Z",
      "updated_at": "2024-02-09T12:12:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483619574",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1483619574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242585",
      "pull_request_review_id": 1872247633,
      "id": 1484242585,
      "node_id": "PRRC_kwDOABII585Yd76Z",
      "diff_hunk": "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, const std::string& process_desc, const std::function<bool(WalletBatch&)>& func)",
      "path": "src/wallet/walletdb.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "a8a24cb20974cb8eaec8cb438f6b22489719d605",
      "in_reply_to_id": 1483588570,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sure!, done.",
      "created_at": "2024-02-09T12:13:19Z",
      "updated_at": "2024-02-09T12:13:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242585",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242585"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242772",
      "pull_request_review_id": 1872247969,
      "id": 1484242772,
      "node_id": "PRRC_kwDOABII585Yd79U",
      "diff_hunk": "@@ -447,7 +447,9 @@ BOOST_FIXTURE_TEST_CASE(LoadReceiveRequests, TestingSetup)\n             BOOST_CHECK_EQUAL_COLLECTIONS(requests.begin(), requests.end(), std::begin(erequests), std::end(erequests));\n             WalletBatch batch{wallet->GetDatabase()};\n             BOOST_CHECK(batch.WriteAddressPreviouslySpent(PKHash(), false));\n+            BOOST_CHECK(batch.TxnBegin()); // bdb requirement (more info at BerkeleyBatch::ErasePrefix)\n             BOOST_CHECK(batch.EraseAddressData(ScriptHash()));\n+            BOOST_CHECK(batch.TxnCommit());",
      "path": "src/wallet/test/wallet_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": 1483514234,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "sure",
      "created_at": "2024-02-09T12:13:33Z",
      "updated_at": "2024-02-09T12:13:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484242772",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484242772"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": 450,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484707431",
      "pull_request_review_id": 1873039395,
      "id": 1484707431,
      "node_id": "PRRC_kwDOABII585YftZn",
      "diff_hunk": "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, std::string_view process_desc, const std::function<bool(WalletBatch&)>& func)\n+{\n+    WalletBatch batch(database);\n+    if (!batch.TxnBegin()) {\n+        LogPrint(BCLog::WALLETDB, \"Error: cannot create db txn for %s\\n\", process_desc);\n+        return false;\n+    }\n+\n+    // Run procedure, errors are logged internally\n+    if (!func(batch)) {\n+        batch.TxnAbort();",
      "path": "src/wallet/walletdb.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (b6dcfca8f77f32cb1f41230fb71bab6666252041)\r\n\r\nI think it's bad for debugging that this function inconsistently logs errors when an operation fails. For example it seems like there is no error if the new eraserecords function fails? It would be better to add `LogPrint(BCLog::WALLETDB, \"Error: %s failed\\n\", process_desc);` here.\r\n\r\nI understand that in the future there may be cases where we may want to abort without logging errors but I think a better way to handle those cases would be to accept `kernel::Interrupted` return values here and use the `kernel::IsInterrupted()` helper. (We can move these from `kernel` to `util` without breaking compatibility.)\r\n\r\nThe comment above on line 1325 \"errors are logged internally\" is also not accurate and impossible to enforce with an anonymous callback, so would suggest dropping that and logging unconditionally here. (Without logging, the most the comment could say would be \"errors need to be logged by func callback\" or \"errors should be logged by func callback\")",
      "created_at": "2024-02-09T19:10:32Z",
      "updated_at": "2024-02-09T19:45:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484707431",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484707431"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1327,
      "original_line": 1327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484711516",
      "pull_request_review_id": 1873039395,
      "id": 1484711516,
      "node_id": "PRRC_kwDOABII585YfuZc",
      "diff_hunk": "@@ -296,6 +296,20 @@ class WalletBatch\n     WalletDatabase& m_database;\n };\n \n+/**\n+ * Executes the provided function 'func' within a database transaction context.\n+ *\n+ * This function ensures that all db modifications performed within 'func()' are\n+ * atomically committed to the db at the end of the process. And, in case of a\n+ * failure during execution, all performed changes are rolled back.\n+ *\n+ * @param database The db connection instance to perform the transaction on.\n+ * @param process_desc A description of the process being executed, used for logging purposes in the event of a failure.\n+ * @param func The function to be executed within the db txn context. Returns a boolean indicating success or failure.",
      "path": "src/wallet/walletdb.h",
      "position": null,
      "original_position": 13,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: db, introduce 'RunWithinTxn()' helper function\" (b6dcfca8f77f32cb1f41230fb71bab6666252041)\r\n\r\nWould be useful to add this is determines whether to commit or roll back the txn",
      "created_at": "2024-02-09T19:15:33Z",
      "updated_at": "2024-02-09T19:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484711516",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484711516"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 308,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484725360",
      "pull_request_review_id": 1873039395,
      "id": 1484725360,
      "node_id": "PRRC_kwDOABII585Yfxxw",
      "diff_hunk": "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "path": "src/wallet/bdb.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": 1483514809,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809\r\n\r\nIn commit \"wallet: bdb batch 'ErasePrefix', do not create txn internally\" (96eb527fad0effe082b087c0898843feccc2e213)\r\n\r\nThe new comment \"Additionally, read-write operations performed outside a db txn context are disallowed by current BDB configurations\" seems vague to me and I don't think would be comprehensible without reading this review thread. Would suggest just using achow's comment or combining both comments with something like \"The Dbc::del() cursor delete call below would fail without an active transaction.\".\r\n",
      "created_at": "2024-02-09T19:31:25Z",
      "updated_at": "2024-02-09T19:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484725360",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484725360"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 890,
      "original_start_line": 890,
      "start_side": "RIGHT",
      "line": 892,
      "original_line": 892,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484764886",
      "pull_request_review_id": 1873134759,
      "id": 1484764886,
      "node_id": "PRRC_kwDOABII585Yf7bW",
      "diff_hunk": "@@ -887,7 +887,11 @@ bool BerkeleyBatch::HasKey(DataStream&& key)\n \n bool BerkeleyBatch::ErasePrefix(Span<const std::byte> prefix)\n {\n-    if (!TxnBegin()) return false;\n+    // Because this function erases records one by one, ensure that it is executed within a txn context.\n+    // Otherwise, consistency is at risk; it's possible that certain records are removed while others\n+    // remain due to an internal failure during the procedure.",
      "path": "src/wallet/bdb.cpp",
      "position": 7,
      "original_position": 7,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "523525707742fc620039cd67e8f1437f7f613a01",
      "in_reply_to_id": 1483514809,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> re: [#29403 (comment)](https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1483514809)\r\n> \r\n> In commit \"wallet: bdb batch 'ErasePrefix', do not create txn internally\" ([96eb527](https://github.com/bitcoin/bitcoin/commit/96eb527fad0effe082b087c0898843feccc2e213))\r\n> \r\n> The new comment \"Additionally, read-write operations performed outside a db txn context are disallowed by current BDB configurations\" seems vague to me and I don't think would be comprehensible without reading this review thread. Would suggest just using achow's comment or combining both comments with something like \"The Dbc::del() cursor delete call below would fail without an active transaction.\".\r\n\r\nI wrote it in this way to (try to) inform readers about current bdb config limitations in case anyone changes this code and doesn't understand why it fails. But, I agree that it is not immediately clear. Will change it for you line.\r\nHopefully no one else will change this again.",
      "created_at": "2024-02-09T20:16:22Z",
      "updated_at": "2024-02-09T20:21:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484764886",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484764886"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": 890,
      "original_start_line": 890,
      "start_side": "RIGHT",
      "line": 892,
      "original_line": 892,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771368",
      "pull_request_review_id": 1873145061,
      "id": 1484771368,
      "node_id": "PRRC_kwDOABII585Yf9Ao",
      "diff_hunk": "@@ -1314,6 +1314,29 @@ DBErrors WalletBatch::ZapSelectTx(std::vector<uint256>& vTxHashIn, std::vector<u\n     return DBErrors::LOAD_OK;\n }\n \n+bool RunWithinTxn(WalletDatabase& database, std::string_view process_desc, const std::function<bool(WalletBatch&)>& func)\n+{\n+    WalletBatch batch(database);\n+    if (!batch.TxnBegin()) {\n+        LogPrint(BCLog::WALLETDB, \"Error: cannot create db txn for %s\\n\", process_desc);\n+        return false;\n+    }\n+\n+    // Run procedure, errors are logged internally\n+    if (!func(batch)) {\n+        batch.TxnAbort();",
      "path": "src/wallet/walletdb.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "in_reply_to_id": 1484707431,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, using `util::Interrupted` to skip the failure logging in the future sounds great. Error logging added.",
      "created_at": "2024-02-09T20:24:27Z",
      "updated_at": "2024-02-09T20:24:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771368",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771368"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1327,
      "original_line": 1327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771531",
      "pull_request_review_id": 1873145293,
      "id": 1484771531,
      "node_id": "PRRC_kwDOABII585Yf9DL",
      "diff_hunk": "@@ -296,6 +296,20 @@ class WalletBatch\n     WalletDatabase& m_database;\n };\n \n+/**\n+ * Executes the provided function 'func' within a database transaction context.\n+ *\n+ * This function ensures that all db modifications performed within 'func()' are\n+ * atomically committed to the db at the end of the process. And, in case of a\n+ * failure during execution, all performed changes are rolled back.\n+ *\n+ * @param database The db connection instance to perform the transaction on.\n+ * @param process_desc A description of the process being executed, used for logging purposes in the event of a failure.\n+ * @param func The function to be executed within the db txn context. Returns a boolean indicating success or failure.",
      "path": "src/wallet/walletdb.h",
      "position": null,
      "original_position": 13,
      "commit_id": "2095ccdca0cf09073b51b3e9e0d5b9931825824d",
      "original_commit_id": "b6dcfca8f77f32cb1f41230fb71bab6666252041",
      "in_reply_to_id": 1484711516,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-02-09T20:24:37Z",
      "updated_at": "2024-02-09T20:24:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/29403#discussion_r1484771531",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1484771531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/29403"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 308,
      "side": "RIGHT"
    }
  ]
}
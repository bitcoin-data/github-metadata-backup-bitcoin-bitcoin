{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487",
    "id": 341540191,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MzQxNTQwMTkx",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17487",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/17487.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/17487.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/1d7935b45ac61791399989effc18aece8b368fbb",
    "number": 17487,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "coins: allow write to disk without cache drop",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is part of the [assumeutxo project](https://github.com/bitcoin/bitcoin/projects/11):\r\n\r\nParent PR: #15606 \r\nIssue: #15605 \r\nSpecification: https://github.com/jamesob/assumeutxo-docs/tree/master/proposal\r\n\r\n---\r\n\r\nIn certain circumstances, we may want to flush chainstate data to disk without\r\nemptying `cacheCoins`, which affects performance. UTXO snapshot\r\nactivation is one such case, as we populate `cacheCoins` with the snapshot\r\ncontents and want to persist immediately afterwards but also enter IBD.\r\n\r\nSee also #15265, which makes the case that under normal operation a\r\nflush-without-erase doesn't necessarily add much benefit. I open this PR\r\neven in light of the previous discussion because (i) flush-without-erase\r\nalmost certainly provides benefit in the case of snapshot activation (especially\r\non spinning disk hardware) and (ii) this diff is fairly small and gives us convenient \r\noptions for more granular cache management without changing existing policy. \r\n\r\nSee also #15218. ",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2019-11-15T16:17:46Z",
    "updated_at": "2024-01-30T12:26:59Z",
    "closed_at": "2023-01-30T16:01:39Z",
    "mergeable_state": "unknown",
    "merged_at": "2023-01-30T16:01:39Z",
    "merge_commit_sha": "82903a7a8dc327f94eff0bbbb97d8a0eb04e9044",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "jamesob:2019-11-au-coins-erase",
      "ref": "2019-11-au-coins-erase",
      "sha": "1d7935b45ac61791399989effc18aece8b368fbb",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 42077031,
        "node_id": "MDEwOlJlcG9zaXRvcnk0MjA3NzAzMQ==",
        "name": "bitcoin",
        "full_name": "jamesob/bitcoin",
        "owner": {
          "login": "jamesob",
          "id": 73197,
          "node_id": "MDQ6VXNlcjczMTk3",
          "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jamesob",
          "html_url": "https://github.com/jamesob",
          "followers_url": "https://api.github.com/users/jamesob/followers",
          "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
          "organizations_url": "https://api.github.com/users/jamesob/orgs",
          "repos_url": "https://api.github.com/users/jamesob/repos",
          "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jamesob/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jamesob/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jamesob/bitcoin",
        "archive_url": "https://api.github.com/repos/jamesob/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jamesob/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jamesob/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jamesob/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jamesob/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jamesob/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jamesob/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jamesob/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jamesob/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jamesob/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jamesob/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jamesob/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jamesob/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jamesob/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jamesob/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jamesob/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jamesob/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jamesob/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jamesob/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jamesob/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jamesob/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jamesob/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jamesob/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jamesob/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jamesob/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jamesob/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jamesob/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jamesob/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jamesob/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jamesob/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jamesob/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jamesob/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jamesob/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jamesob/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jamesob/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jamesob/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jamesob/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jamesob/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jamesob/bitcoin/hooks",
        "svn_url": "https://github.com/jamesob/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 271374,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-01-12T18:32:56Z",
        "created_at": "2015-09-07T22:18:03Z",
        "updated_at": "2023-05-05T06:31:51Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "c0b6c40bb084752f686ff77e6883ee6fd16eba26",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36635,
        "stargazers_count": 73628,
        "watchers_count": 73628,
        "size": 247952,
        "default_branch": "master",
        "open_issues_count": 684,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-01-30T12:10:22Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-01-30T11:53:53Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 288,
    "deletions": 28,
    "changed_files": 5,
    "commits": 4,
    "review_comments": 90,
    "comments": 51
  },
  "events": [
    {
      "event": "added_to_project",
      "id": 2803207059,
      "node_id": "MDE5OkFkZGVkVG9Qcm9qZWN0RXZlbnQyODAzMjA3MDU5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2803207059",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T16:18:36Z",
      "project_card": {
        "id": 29282280,
        "url": "https://api.github.com/projects/columns/cards/29282280",
        "project_id": 2564674,
        "project_url": "https://api.github.com/projects/2564674",
        "column_name": "In progress"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2803233384,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjgwMzIzMzM4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2803233384",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T16:26:34Z"
    },
    {
      "event": "labeled",
      "id": 2803561972,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDI4MDM1NjE5NzI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2803561972",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T18:22:39Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "labeled",
      "id": 2803561975,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDI4MDM1NjE5NzU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2803561975",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T18:22:39Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "reviewed",
      "id": 317801224,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzE3ODAxMjI0",
      "url": null,
      "actor": null,
      "commit_id": "bd44f51d790edc07b7e1224e0f8bfce4252c74d5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Does this speed up IBD with low dbcache? If so, a benchmark would be nice",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-317801224",
      "submitted_at": "2019-11-15T18:46:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 554483423,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDQ4MzQyMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554483423",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T18:51:43Z",
      "updated_at": "2019-11-15T18:51:43Z",
      "author_association": "MEMBER",
      "body": "> Does this speed up IBD with low dbcache? If so, a benchmark would be nice\r\n\r\nNo, this PR doesn't change any existing behavior - it simply introduces the option to avoid erasing the cache (which is later used by assumeutxo's snapshot activation code). This changeset shouldn't cause any sort of performance difference.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-554483423",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 317853720,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzE3ODUzNzIw",
      "url": null,
      "actor": null,
      "commit_id": "bd44f51d790edc07b7e1224e0f8bfce4252c74d5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code Review ACK bd44f51\r\n\r\nCan you slightly note in commit message than this change is not used right now ?\r\n\r\n`CCoinsViewCache::Flush` is called in FlushStateToDisk, DisconnectTip, ConnectTip, ReplayBlocks but as new default argument is true there shouldn't be behavior change.",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-317853720",
      "submitted_at": "2019-11-15T20:55:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 554529034,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDUyOTAzNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554529034",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:08:40Z",
      "updated_at": "2023-01-27T13:15:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1402748746), [achow101](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1404096255), [Sjors](https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1272674305) |\n| Concept ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555608657) |\n| Stale ACK | [ariard](https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-317853720), [dongcarl](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-554534416), [jnewbery](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-637156481), [jonatack](https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-422785077), [andrewtoth](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-638494243), [fjahr](https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-847197360) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25862](https://github.com/bitcoin/bitcoin/pull/25862) (refactor, kernel: Remove gArgs accesses from dbwrapper and txdb by ryanofsky)\n* [#25325](https://github.com/bitcoin/bitcoin/pull/25325) (Add pool based memory resource by martinus)\n* [#9384](https://github.com/bitcoin/bitcoin/pull/9384) (CCoinsViewCache code cleanup & deduplication by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-554529034",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 554534416,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDUzNDQxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554534416",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:25:33Z",
      "updated_at": "2019-11-15T21:25:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code Review ACK bd44f51d790edc07b7e1224e0f8bfce4252c74d5\r\nChecked that it doesn't change any behavior, if the compiler is smart enough about detecting unused codepaths/function signatures, it will probably even emit an unchanged binary.",
      "user": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-554534416",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "unlabeled",
      "id": 2804040211,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MjgwNDA0MDIxMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804040211",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:29:44Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2804057890,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjgwNDA1Nzg5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804057890",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:37:37Z"
    },
    {
      "event": "commented",
      "id": 554538716,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDUzODcxNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/554538716",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:38:41Z",
      "updated_at": "2019-11-15T21:38:41Z",
      "author_association": "MEMBER",
      "body": "Thanks for the looks, everyone. I've incorporated feedback from @MarcoFalke and @ariard. [(diff)](https://github.com/bitcoin/bitcoin/compare/bd44f51d790edc07b7e1224e0f8bfce4252c74d5..a22b1fb1d4a239a47790a0522bb3f5e493cb9e57)",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-554538716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2804060262,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgwNDA2MDI2Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804060262",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:38:41Z"
    },
    {
      "event": "subscribed",
      "id": 2804060263,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MDQwNjAyNjM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804060263",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:38:41Z"
    },
    {
      "event": "mentioned",
      "id": 2804060269,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgwNDA2MDI2OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804060269",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:38:41Z"
    },
    {
      "event": "subscribed",
      "id": 2804060271,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MDQwNjAyNzE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2804060271",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:38:41Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-15T21:42:53Z",
      "updated_at": "2019-11-15T21:42:53Z",
      "source": {
        "issue": {
          "id": 401128377,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ2MTI4MDU5",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15218/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/15218",
          "number": 15218,
          "state": "open",
          "state_reason": null,
          "title": "validation: Flush state after initial sync",
          "body": "This fixes a common issue where initial sync is done with a high `dbcache` and then not cleanly shut down.\r\n\r\nResolves #11600.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 30,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15218",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/15218",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/15218.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/15218.patch"
          },
          "created_at": "2019-01-20T19:04:17Z",
          "updated_at": "2024-01-22T22:10:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-18T21:17:29Z",
      "updated_at": "2019-11-18T21:17:29Z",
      "source": {
        "issue": {
          "id": 421531882,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MjYxNTYxNTQ3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/15606",
          "number": 15606,
          "state": "closed",
          "state_reason": null,
          "title": "assumeutxo",
          "body": "**See the proposal for assumeutxo [here](https://github.com/jamesob/assumeutxo-docs/tree/2019-04-proposal/proposal).**\r\n\r\nTesting instructions can be found below the \"Progress\" section.\r\n\r\n---\r\n\r\n### Progress\r\n\r\nAll items here have corresponding commits here, but are unchecked if they haven't been merged yet.\r\n\r\n- [x] **Chainstate interface**\r\n  - https://github.com/bitcoin/bitcoin/pull/15976\r\n- [x] **Localize chainstate data**\r\n  - https://github.com/bitcoin/bitcoin/pull/16443\r\n- [x] **Share block data**\r\n  - https://github.com/bitcoin/bitcoin/pull/16194\r\n- [x] **Deglobalize chainstate**\r\n  - https://github.com/bitcoin/bitcoin/pull/15948\r\n- [x] **UpdateTip/CheckBlockIndex** modifications\r\n  - https://github.com/bitcoin/bitcoin/pull/21526\r\n- [x] **ChainstateManager**\r\n  - https://github.com/bitcoin/bitcoin/pull/17737\r\n- [x] **Mempool**\r\n  - https://github.com/bitcoin/bitcoin/pull/22415\r\n- [x] **LoadBlockIndex**\r\n  - https://github.com/bitcoin/bitcoin/pull/23174\r\n- [x] **Init/teardown**\r\n  - https://github.com/bitcoin/bitcoin/pull/24232\r\n  - https://github.com/bitcoin/bitcoin/pull/25667\r\n  - https://github.com/bitcoin/bitcoin/pull/25740\r\n- [x] **Wallet**: includes avoiding rescans when assumed-valid block data is in use\r\n  - https://github.com/bitcoin/bitcoin/pull/23997\r\n  - https://github.com/bitcoin/bitcoin/pull/26282\r\n- [ ] **P2P**: minor changes are made to `init.cpp` and `net_processing.cpp` to make simultaneous IBD across multiple chainstates work.\r\n  - #24008 \r\n- [ ] **Pruning**: implement correct pruning behavior when using a background chainstate\r\n- [ ] **Blockfile separation**: to prevent \"fragmentation\" in blockfile storage, have background chainstates use separate blockfiles from active snapshot chainstates to avoid interleaving heights and impairing pruning.\r\n- [ ] **Indexing**: all existing `CValidationInterface` events are given with an additional parameter, ChainstateRole, and all indexers ignore events from ChainstateRole::ASSUMEDVALID so that indexation only happens sequentially.\r\n- [ ] Raise error when both `-reindex` and assumeutxo are in use.\r\n- [ ] **RPC**: introduce RPC commands `dumptxoutset`, `loadtxoutset`, and (the probably temporary) `monitorsnapshot`.\r\n  - https://github.com/bitcoin/bitcoin/pull/16899\r\n- [ ] **Release docs & first assumeutxo commitment**: add notes and a particular assumeutxo hash value for first AU-enabled release.\r\n  - This will complete the project and allow use of UTXO snapshots for faster node bootstrap.\r\n- [ ] *(optional)* **Coinscache optimization**: allow flushing chainstate data without emptying the coins cache; results in better performance after UTXO snapshot load.\r\n  - https://github.com/bitcoin/bitcoin/pull/17487\r\n  - https://github.com/bitcoin/bitcoin/pull/27008\r\n\r\n---\r\n\r\n### Testing\r\n\r\n#### For fun (~5min)\r\n\r\nIf you want to do a quick test, you can run `./contrib/devtools/test_utxo_snapshots.sh` and follow the instructions. This is mostly obviated by the functional tests, though.\r\n\r\n#### For real (longer)\r\n\r\nIf you'd like to experience a real usage of assumeutxo, you can do that too.\r\nI've cut a new snapshot at height 788'000 (http://img.jameso.be/utxo-788000.dat - but you can do it yourself with `./contrib/devtools/utxo_snapshot.sh` if you want). Download that, and then create a datadir for testing:\r\n```sh\r\n$ cd ~/src/bitcoin  # or whatever\r\n\r\n# get the snapshot\r\n$ curl http://img.jameso.be/utxo-788000.dat > utxo-788000.dat\r\n\r\n# you'll want to do this if you like copy/pasting \r\n$ export AU_DATADIR=/home/${USER}/au-test # or wherever\r\n\r\n$ mkdir ${AU_DATADIR}\r\n$ vim ${AU_DATADIR}/bitcoin.conf\r\n\r\ndbcache=8000  # or, you know, something high\r\nblockfilterindex=1\r\ncoinstatsindex=1\r\nprune=3000\r\nlogthreadnames=1\r\n```\r\nObtain this branch, build it, and then start bitcoind:\r\n```sh\r\n$ git remote add jamesob https://github.com/jamesob/bitcoin\r\n$ git fetch jamesob utxo-dumpload-compressed\r\n$ git checkout jamesob/utxo-dumpload-compressed\r\n\r\n$ ./configure $conf_args && make  # (whatever you like to do here)\r\n\r\n# start 'er up and watch the logs\r\n$ ./src/bitcoind -datadir=${AU_DATADIR}\r\n```\r\nThen, in some other window, load the snapshot\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} loadtxoutset $(pwd)/utxo-788000.dat\r\n```\r\n\r\nYou'll see some log messages about headers retrieval and waiting to see the snapshot in the headers chain. Once you get the full headers chain, you'll spend a decent amount of time (~10min) loading the snapshot, checking it, and flushing it to disk. After all that happens, you should be syncing to tip in pretty short order, and you'll see the occasional `[background validation]` log message go by.\r\n\r\nIn yet another window, you can check out chainstate status with\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} getchainstates\r\n```\r\nas well as usual favorites like `getblockchaininfo`.\r\n\r\n---\r\n\r\n### Original change description\r\n\r\nFor those unfamiliar with assumeutxo, here's a brief summary from [the issue](https://github.com/bitcoin/bitcoin/issues/15605) (where any conceptual discussion not specific to this implementation should happen):\r\n\r\n> assumeutxo would be a way to initialize a node using a headers chain and a serialized version of the UTXO state which was generated from another node at some block height. A client making use of this UTXO \"snapshot\" would specify a hash and expect the content of the resulting UTXO set to yield this hash after deserialization. \r\n> \r\n> This would allow users to bootstrap a usable pruned node & wallet far more quickly (and with less disk usage) than waiting for a full initial block download to complete, since we only have to sync blocks between the base of the snapshot and the current network tip. Needless to say this is at expense of accepting a different trust model, though how different this really ends up being from `assumevalid` in effect is worth debate.\r\n\r\nIn short, this is an interesting change because it would allow nodes to get up and running within minutes given a ~3GB file (at time of writing) under an almost identical trust model to assumevalid.\r\n\r\nIn this implementation, I add a few RPC commands: `dumptxoutset` creates a UTXO snapshot and writes it to disk, and `loadtxoutset` intakes a snapshot from disk, constructs and activates chainstate based on it, and continues a from-scratch initial block download in the background for the sole purpose of validating the snapshot. Once the snapshot is validated, we throw away the chainstate used for background validation.\r\n\r\nThe assumeutxo procedure as implemented is as follows:\r\n\r\n1. A UTXO snapshot is loaded with the `loadtxoutset <path>` RPC command.\r\n1. A new chainstate (`CChainState`) is initialized using `ChainstateManager::ActivateSnapshot()`:\r\n   1. The serialized UTXO data is read in and various sanity checks are performed, e.g. compare expected coin count, recompute the hash and compare it with assumeutxo hash in source code.\r\n   1. We \"fast forward\" `new_chainstate->m_chain` to have a tip at the base of the snapshot (with or without block data). Lacking block data, we fake the `nTx` counts of the constituent `CBlockIndex` entries.\r\n   1. `LoadChainTip()` is called on the new snapshot and it is installed as our active chainstate.\r\n1. The new assumed-valid chainstate is now our active, and so that enters IBD until it is synced to the network's tip. Presumably the snapshot would be taken relatively close to the current tip but far enough away to avoid meaningful reorgs, say 10,000 blocks deep.\r\n1. Once the active chainstate is out of IBD, our old validation chain continues IBD \"in the background\" while the active chainstate services requests from most of the system.\r\n1. Once the background validation chainstate reaches a height equal the base of the snapshot, we take the hash of its UTXO set and ensure it equals the expected hash based on the snapshot. If the hashes are equivalent, we delete the validation chainstate and move on without event; if they aren't, we log loudly and fall back to the validation chainstate (we should probably just shut down).\r\n\r\nThe implicit assumption is that the background validation chain will always be a subset of the assumed-valid snapshot chain while the latter is active. We don't properly handle reorgs that go deeper than the base of the snapshot.\r\n\r\n### Changes (already merged/outdated)\r\n\r\n![chainstate-beforeafter (1)](https://user-images.githubusercontent.com/73197/54435797-a16b0780-4707-11e9-89c3-c90b5686804d.png)\r\n \r\nThe crux of this change is in removing any assumptions in the codebase that there is a single chainstate, i.e. any references to global variables `chainActive`, `pcoinsTip`, et al. need to be replaced with functions that return the relevant chainstate data at that moment in time. This change also takes `CChainState` to its logical conclusion by making it more self-contained - any references to globals like `chainActive` are removed with class-local references (`m_chain`).\r\n\r\nA few minor notes on the implementation:\r\n\r\n- When we attempt to load a wallet with a BestBlock locator lower than the base of a snapshot and the snapshot has not yet been validated, we refuse to load the wallet.\r\n\r\n- For additional notes, see [the new assumeutxo docs](https://github.com/jamesob/bitcoin/blob/utxo-dumpload-compressed/doc/assumeutxo.md).",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 66,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15606",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/15606",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/15606.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/15606.patch"
          },
          "closed_at": "2023-05-08T15:09:24Z",
          "created_at": "2019-03-15T13:58:22Z",
          "updated_at": "2023-05-08T15:09:24Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-19T16:31:07Z",
      "updated_at": "2019-11-19T16:31:07Z",
      "source": {
        "issue": {
          "id": 403314982,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ3Nzk5NTEz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15265",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15265/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15265/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15265/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/15265",
          "number": 15265,
          "state": "closed",
          "state_reason": null,
          "title": "Flush without erasing cache during periodic and pruning flushes",
          "body": "Allow syncing the UTXO state to disk without clearing the in-memory cache.  This provides better support for using a large `-dbcache`, which otherwise would get cleared every 24 hours.",
          "user": {
            "login": "sdaftuar",
            "id": 7463573,
            "node_id": "MDQ6VXNlcjc0NjM1NzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sdaftuar",
            "html_url": "https://github.com/sdaftuar",
            "followers_url": "https://api.github.com/users/sdaftuar/followers",
            "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
            "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
            "repos_url": "https://api.github.com/users/sdaftuar/repos",
            "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15265",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/15265",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/15265.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/15265.patch"
          },
          "closed_at": "2019-01-29T18:42:05Z",
          "created_at": "2019-01-25T20:09:11Z",
          "updated_at": "2021-12-16T14:12:53Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 555591310,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTU5MTMxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555591310",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-19T16:31:20Z",
      "updated_at": "2019-11-19T16:31:20Z",
      "author_association": "MEMBER",
      "body": "Why is it that you don't need this bit in your followup PR? https://github.com/bitcoin/bitcoin/pull/15265/files#diff-cd7b305fd4b4280f22ae88960e60398eR210-R222",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555591310",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 555603581,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTYwMzU4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555603581",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-19T16:57:43Z",
      "updated_at": "2019-11-19T16:57:43Z",
      "author_association": "MEMBER",
      "body": "Given that this does not improve performance (see https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-458657451), is this needed at all? If so, sharing a benchmark with steps to reproduce would be helpful.\r\n\r\nAnyway, I'd like to see the tests in `src/test/coins_tests.cpp` updated to cover the newly added paths.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555603581",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 555608657,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTYwODY1Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555608657",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-19T17:08:45Z",
      "updated_at": "2019-11-19T17:08:45Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, but:\r\n\r\n- I think the PR description should be clearer that this change by itself doesn't change behavior.\r\n- I don't understand how this speeds up UTXO snapshot activation if conclusion from #15265 is that the cache is only really functioning as a write cache and not a read cache.\r\n- I agree with Marco about testing. This definitely needs unit tests or some coverage to unsure this isn't adding broken functionality, or code that could easily be broken in the future with no one noticing.\r\n- I agree with Antoine about the Flush method signature. Using a default boolean argument seems error prone. Explicit parameter would be ok, but better would just be to have separate methods like `Flush()` and `Sync()` or `Flush()` and `Write()`",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555608657",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 555613237,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTYxMzIzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555613237",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-19T17:18:37Z",
      "updated_at": "2019-11-19T17:18:37Z",
      "author_association": "MEMBER",
      "body": "Alright, given the controversy here now is probably as good a time as any to back up and figure out exactly what `cacheCoins`' impact is on performance, for both this PR and posterity, so I'm going to benchmark\r\n1. a reindex to 550,000 with and without an in-memory UTXO cache, and then\r\n1. UTXO snapshot sync-to-tip with and without this changeset.\r\n\r\nI'll get back with some results in the next few days, and hopefully will write up an elucidation on where exactly CCoinsViewCache does or doesn't provide benefit.\r\n\r\n(Though I wonder how cross-platform differences beyond SSD-or-not play into this, e.g. the cache may or may not show importance based on leveldb's use of mmap & `max_open_files`, which is particularly relevant on Win32.)",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555613237",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 555967785,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTk2Nzc4NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/555967785",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-20T11:42:31Z",
      "updated_at": "2019-11-20T11:42:39Z",
      "author_association": "MEMBER",
      "body": "> the cache may or may not show importance based on leveldb's use of mmap & max_open_files, which is particularly relevant on Win32\r\n\r\nFWIW, #17398 adds leveldb mmap support on Windows, might want to try with and without that PR  when doing benchmarking on Windows.",
      "user": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-555967785",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 557226923,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzIyNjkyMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557226923",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:04:15Z",
      "updated_at": "2019-11-21T19:04:15Z",
      "author_association": "MEMBER",
      "body": "After benching, I stand by this change as being significantly useful. I compare HEAD of the assumeutxo parent PR ([`utxo-dumpload-compressed`](https://github.com/jamesob/bitcoin/tree/utxo-dumpload-compressed)) to a branch of it which drops use of the `erase=false` parameter, erasing the coins after snapshot load ([`bench/au.no-erase`](https://github.com/jamesob/bitcoin/tree/bench/au.no-erase), [changes](https://github.com/jamesob/bitcoin/commit/85a73a074389c80c09e2acc877f45e06ab3f5976)). The benchmark compares the time taken to sync to block 604,667 after loading a snapshot taken at height 600,000.\r\n\r\nThe result is a significant degradation in performance on spinning disk hosts (4.5 hours vs. 1.5 hours) - see the `bench-hdd-3` results. There is a modest but probably negligible degradation on SSD hosts.\r\n\r\n```\r\nhost         tag                      time       time% maxmem  cpu%  dbcache\r\nbench-ssd-4  bench/au.no-erase        47:42.80   1.00  6689.85MB 125%  5000MB\r\nbench-ssd-4  bench/au.no-erase        44:15.66   0.93  6560.45MB 136%  5000MB\r\nbench-ssd-4  utxo-dumpload-compressed 40:13.30   0.84  6662.75MB 149%  5000MB\r\nbench-ssd-4  utxo-dumpload-compressed 41:36.01   0.87  6652.87MB 143%  5000MB\r\n\r\nbench-ssd-5  bench/au.no-erase        41:33.65   0.95  6754.54MB 144%  5000MB\r\nbench-ssd-5  bench/au.no-erase        41:32.42   0.95  6561.39MB 145%  5000MB\r\nbench-ssd-5  utxo-dumpload-compressed 43:51.50   1.00  6758.98MB 135%  5000MB\r\nbench-ssd-5  utxo-dumpload-compressed 36:39.94   0.84  6649.31MB 162%  5000MB\r\n\r\nbench-hdd-3  utxo-dumpload-compressed 1:47:08    0.38  6654.23MB 57%   5000MB\r\nbench-hdd-3  utxo-dumpload-compressed 1:30:48    0.32  6612.49MB 66%   5000MB\r\nbench-hdd-3  bench/au.no-erase        4:24:53    0.93  6578.77MB 23%   5000MB\r\nbench-hdd-3  bench/au.no-erase        4:45:29    1.00  6583.10MB 21%   5000MB\r\n```\r\n\r\nThis benchmark is reproducible by running [this script](https://github.com/chaincodelabs/bitcoinperf/blob/master/bin/run_remote.py#L147-L183):\r\n```sh\r\n./bin/run_remote.py au --hosts [hostnames ...]\r\n```\r\n\r\nI'll add tests to make sure this change works as-advertised, but I think it's pretty clearly a useful option for us to have. ",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557226923",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 557239614,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzIzOTYxNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557239614",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:37:10Z",
      "updated_at": "2019-11-21T19:37:10Z",
      "author_association": "MEMBER",
      "body": "@sdaftuar just pointed out to me that this code is very wrong - because I don't wipe the flags of flushed coins, this code ends up with an incorrect on-disk UTXO set (since a coin with the `FRESH` flag will only be removed from the in-memory cache and the delete will not propagate to leveldb). Going to fix this bug and reevaluate and pledge to never doubt Suhas' benchmarks again.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557239614",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2820912304,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgyMDkxMjMwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2820912304",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:37:10Z"
    },
    {
      "event": "subscribed",
      "id": 2820912317,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MjA5MTIzMTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2820912317",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:37:10Z"
    },
    {
      "event": "commented",
      "id": 557240133,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzI0MDEzMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557240133",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:38:38Z",
      "updated_at": "2019-11-21T19:38:38Z",
      "author_association": "MEMBER",
      "body": "(FWIW @Sjors wins Employee of the Month for spotting this bug in a previous comment.)",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557240133",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2820916666,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgyMDkxNjY2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2820916666",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:38:39Z"
    },
    {
      "event": "subscribed",
      "id": 2820916676,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MjA5MTY2NzY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2820916676",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-21T19:38:39Z"
    },
    {
      "event": "commented",
      "id": 557505590,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzUwNTU5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557505590",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T11:59:21Z",
      "updated_at": "2019-11-22T12:03:47Z",
      "author_association": "MEMBER",
      "body": "Took me a while to understand what you're doing here. To rephrase in my own words: when you load the snapshot from disk you end up with a coin cache at e.g. 600,000. Depending on the users dbcache setting, part of this is already in RAM, which is potentially nice when continuing IBD.\r\n\r\nhttps://github.com/jamesob/bitcoin/commit/85a73a074389c80c09e2acc877f45e06ab3f5976#diff-24efdb00bfbe56b140fb006b562cc70bL5514-L5530\r\n\r\nIf -dbcache is less than the size of the snapshot, the only the most recent (?) coins of the snapshot will in RAM, the rest would already have been flushed. This is probably similar to what happens during a normal IBD when dbcache overflows. (we could use some heuristics to sort coins by life expectancy)\r\n\r\nFor some reason (why?) you need to flush at the end of loading the snapshot, which normally means no coins are in RAM. This PR changes that last flush to keep stuff around.\r\n\r\nIIUC the main benefit of this cache is to reduce the number of unnecessary writes, i.e. when a coin is created and then destroyed we save 2 disk writes. But when we flush, even without deleting the coins from RAM, we expect 1 write if the coin is spent before the tip, otherwise no write.\r\n\r\nLooking forward to the new benchmark. I suggest doing this with a ~1 month old snapshot (realistic for users who download immediately after a 1 month release candidates) and a 4 month old snapshot (the average age if we ship every 6 months).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557505590",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 557595582,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzU5NTU4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557595582",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z",
      "updated_at": "2019-11-22T16:16:53Z",
      "author_association": "MEMBER",
      "body": "I'm surprised to report that even after fixing the (consensus!) bug that @Sjors and @sdaftuar pointed out, this change still shows considerable improvement for the assumeutxo snapshot-load use. We're still seeing 3x reduction in time with this change applied for spinning disks while doing a from-600k snapshot IBD.\r\n\r\n```\r\nhost         tag                      time       time% maxmem  cpu%  dbcache\r\nbench-ssd-4  utxo-dumpload-compressed 31:48.95   0.70  6787.93MB 179%  5000MB\r\nbench-ssd-4  utxo-dumpload-compressed 36:06.14   0.80  6689.20MB 157%  5000MB\r\nbench-ssd-4  bench/au.no-erase.1      43:21.22   0.96  6689.82MB 137%  5000MB\r\nbench-ssd-4  bench/au.no-erase.1      45:14.75   1.00  6739.20MB 131%  5000MB\r\n\r\nbench-ssd-5  utxo-dumpload-compressed 33:08.03   0.77  6787.14MB 172%  5000MB\r\nbench-ssd-5  utxo-dumpload-compressed 31:13.55   0.73  6731.26MB 182%  5000MB\r\nbench-ssd-5  bench/au.no-erase.1      42:49.74   1.00  6754.30MB 139%  5000MB\r\nbench-ssd-5  bench/au.no-erase.1      41:22.71   0.97  6557.05MB 144%  5000MB\r\n\r\nbench-hdd-3  bench/au.no-erase.1      4:34:00    0.98  6530.24MB 22%   5000MB\r\nbench-hdd-3  bench/au.no-erase.1      4:39:21    1.00  6562.12MB 21%   5000MB\r\nbench-hdd-3  utxo-dumpload-compressed 1:30:11    0.32  6736.32MB 63%   5000MB\r\nbench-hdd-3  utxo-dumpload-compressed 1:33:19    0.33  6702.03MB 61%   5000MB\r\n```\r\n[(host specs here)](https://gist.github.com/jamesob/012154e6c1c0ac893dc602fadfdd5f1d)\r\n\r\nApplying @sdaftuar's fix ([here](https://github.com/jamesob/bitcoin/commit/6dbb76e5a254095effc776c07bf954bd7a874406) in `bench/au.no-erase.1`, and [here](https://github.com/jamesob/bitcoin/commit/352af3801da0c0a870e01df8e1926df36f40e572#diff-cd7b305fd4b4280f22ae88960e60398eR217-R229) in `utxo-dumpload-compressed`) I think actually improves runtime for the single `Flush(erase=false)` call that we make after finishing the snapshot load because now we're actually removing spent coins from `cacheCoins`, thus freeing up more cache space going into the IBD.\r\n\r\n---\r\n\r\n> For some reason (why?) you need to flush at the end of loading the snapshot, which normally means no coins are in RAM. This PR changes that last flush to keep stuff around.\r\n\r\nThanks for the nice summary, @Sjors. I'm not sure that we necessarily need to flush after loading the snapshot, but I figured it was prudent to ensure that we'd resume the snapshot-based sync even after an unclean shutdown - maybe it's better to just omit the `Flush()` call altogether after loading the snapshot?\r\n\r\nTangentially, @sdaftuar mentioned the other day a potential technique for partial flushes that may accomplish the kind of optimization that this branch and #15265 are aiming for. The idea would be to allocate some of the `cacheCoins` memory to a secondary data structure that would serve as an index into `cacheCoins`, allowing fast lookup by spentness and height of the in-memory coins. That way, on `FlushStateToDisk()` we could do a partial flush, only making disk writes for those coins which are either unspent and of a certain age *or* spent and on-disk. This would make use of the fact that most coins are very short-lived (see [figure 2](https://eprint.iacr.org/2019/611.pdf) in @adiabat's excellent utreexo paper).\r\n\r\nI think this is a promising idea and I'll be experimenting with it soon - though of course that's outside the scope of this PR. ",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557595582",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2823789566,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgyMzc4OTU2Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789566",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z"
    },
    {
      "event": "mentioned",
      "id": 2823789572,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgyMzc4OTU3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789572",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z"
    },
    {
      "event": "mentioned",
      "id": 2823789575,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MjgyMzc4OTU3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789575",
      "actor": {
        "login": "adiabat",
        "id": 22841402,
        "node_id": "MDQ6VXNlcjIyODQxNDAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/22841402?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adiabat",
        "html_url": "https://github.com/adiabat",
        "followers_url": "https://api.github.com/users/adiabat/followers",
        "following_url": "https://api.github.com/users/adiabat/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adiabat/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adiabat/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adiabat/subscriptions",
        "organizations_url": "https://api.github.com/users/adiabat/orgs",
        "repos_url": "https://api.github.com/users/adiabat/repos",
        "events_url": "https://api.github.com/users/adiabat/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adiabat/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z"
    },
    {
      "event": "subscribed",
      "id": 2823789586,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MjM3ODk1ODY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789586",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z"
    },
    {
      "event": "subscribed",
      "id": 2823789593,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MjM3ODk1OTM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789593",
      "actor": {
        "login": "adiabat",
        "id": 22841402,
        "node_id": "MDQ6VXNlcjIyODQxNDAy",
        "avatar_url": "https://avatars.githubusercontent.com/u/22841402?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adiabat",
        "html_url": "https://github.com/adiabat",
        "followers_url": "https://api.github.com/users/adiabat/followers",
        "following_url": "https://api.github.com/users/adiabat/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adiabat/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adiabat/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adiabat/subscriptions",
        "organizations_url": "https://api.github.com/users/adiabat/orgs",
        "repos_url": "https://api.github.com/users/adiabat/repos",
        "events_url": "https://api.github.com/users/adiabat/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adiabat/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:53Z"
    },
    {
      "event": "subscribed",
      "id": 2823789598,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4MjM3ODk1OTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2823789598",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T16:16:54Z"
    },
    {
      "event": "commented",
      "id": 557680581,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzY4MDU4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/557680581",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-11-22T20:22:55Z",
      "updated_at": "2019-11-22T20:24:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "What about using `Flush(erase=false)` for all periodic flushes after IBD? That way when running with a high enough `dbcache` a flush would never empty `cacheCoins`, which would surely improve performance. That's also the only real issue with #15218 .",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557680581",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2851170984,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50Mjg1MTE3MDk4NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2851170984",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T18:34:53Z"
    },
    {
      "event": "commented",
      "id": 561348373,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU2MTM0ODM3Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561348373",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T20:42:54Z",
      "updated_at": "2019-12-03T20:42:54Z",
      "author_association": "MEMBER",
      "body": "I've pushed some test coverage for the new `erase` parameter (and more generally some explicit tests for coins cache behavior). Notably, the new test cases use `CCoinsViewDB` at the base of the cache structure, which isn't currently tested explicitly anywhere else in the unittest suite - though of course an instance lives at the heart of every `CChainState`.\r\n\r\nThroughout the course of writing (and debugging) the tests, I found yet another bug that had to do with `std::move`ing the coins in `CCoinsView::BatchWrite` even when `erase=false`, which was causing the `coin.out.scriptPubKey` to appear null in the child-most cache. This is just another testament to how tricky the coins cache code is to get right (as I was warned months ago by @sdaftuar). But that said, I feel pretty confident that this change is now correct.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-561348373",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2851578499,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mjg1MTU3ODQ5OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2851578499",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T20:42:54Z"
    },
    {
      "event": "subscribed",
      "id": 2851578501,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4NTE1Nzg1MDE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2851578501",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T20:42:54Z"
    },
    {
      "event": "mentioned",
      "id": 2851633805,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mjg1MTYzMzgwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2851633805",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T21:00:29Z"
    },
    {
      "event": "subscribed",
      "id": 2851633807,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4NTE2MzM4MDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2851633807",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-03T21:00:29Z"
    },
    {
      "event": "reviewed",
      "id": 326444938,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzI2NDQ0OTM4",
      "url": null,
      "actor": null,
      "commit_id": "1e68aad46ed122c85ed60e1529c6cf512bbefa86",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-326444938",
      "submitted_at": "2019-12-03T21:00:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 561741590,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU2MTc0MTU5MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/561741590",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-04T17:12:01Z",
      "updated_at": "2019-12-04T17:12:01Z",
      "author_association": "MEMBER",
      "body": "Latest round of benchmarks for the current tip of this branch continues to show good performance improvements for UTXO snapshot load, even on SSD. (same setup as https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557595582)\r\n\r\n```\r\nhost         tag                      time       time% maxmem  cpu%  dbcache\r\nbench-ssd-4  bench/au.no-erase.1      43:27.79   0.98  6572.45MB 137%  5000MB\r\nbench-ssd-4  bench/au.no-erase.1      44:10.18   1.00  6690.36MB 135%  5000MB\r\nbench-ssd-4  utxo-dumpload.54         32:59.07   0.75  6733.55MB 173%  5000MB\r\nbench-ssd-4  utxo-dumpload.54         33:19.00   0.75  6725.27MB 171%  5000MB\r\n\r\nbench-ssd-5  utxo-dumpload.54         31:32.39   0.60  6769.57MB 182%  5000MB\r\nbench-ssd-5  utxo-dumpload.54         31:11.39   0.60  6699.07MB 183%  5000MB\r\nbench-ssd-5  bench/au.no-erase.1      41:41.13   0.80  6772.39MB 142%  5000MB\r\nbench-ssd-5  bench/au.no-erase.1      52:16.76   1.00  6567.82MB 114%  5000MB\r\n\r\nbench-hdd-3  bench/au.no-erase.1      4:37:10    1.00  6569.48MB 21%   5000MB\r\nbench-hdd-3  bench/au.no-erase.1      4:36:03    1.00  6523.61MB 21%   5000MB\r\nbench-hdd-3  utxo-dumpload.54         1:30:22    0.33  6705.20MB 63%   5000MB\r\nbench-hdd-3  utxo-dumpload.54         1:36:20    0.35  6735.74MB 59%   5000MB\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-561741590",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 2858555475,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50Mjg1ODU1NTQ3NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858555475",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:50:31Z"
    },
    {
      "event": "renamed",
      "id": 2858562212,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjg1ODU2MjIxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858562212",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:52:23Z",
      "rename": {
        "from": "coins: add `erase` parameter to control cacheCoins drop on flush",
        "to": "coins: allow Flush() without cache drop"
      }
    },
    {
      "event": "commented",
      "id": 562216092,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU2MjIxNjA5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/562216092",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:53:34Z",
      "updated_at": "2019-12-05T16:53:34Z",
      "author_association": "MEMBER",
      "body": "I've split `Flush(bool erase)` into `Sync()` and `Flush()` as requested by @ryanofsky @MarcoFalke. ([changes](https://github.com/bitcoin/bitcoin/compare/1e68aad46ed122c85ed60e1529c6cf512bbefa86..eebaca7620bbd0af0ec385c6c7d47b2b4b524d55))",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-562216092",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 2858566303,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mjg1ODU2NjMwMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858566303",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:53:34Z"
    },
    {
      "event": "subscribed",
      "id": 2858566304,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4NTg1NjYzMDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858566304",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:53:34Z"
    },
    {
      "event": "mentioned",
      "id": 2858566312,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50Mjg1ODU2NjMxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858566312",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:53:34Z"
    },
    {
      "event": "subscribed",
      "id": 2858566315,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDI4NTg1NjYzMTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2858566315",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2019-12-05T16:53:34Z"
    },
    {
      "event": "commented",
      "id": 578950782,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU3ODk1MDc4Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/578950782",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-27T21:02:00Z",
      "updated_at": "2020-01-27T21:02:00Z",
      "author_association": "CONTRIBUTOR",
      "body": "Review club notes: https://bitcoincore.reviews/17487.html",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-578950782",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 579723127,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTcyMzEyNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579723127",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-29T11:57:30Z",
      "updated_at": "2020-01-29T11:57:48Z",
      "author_association": "MEMBER",
      "body": "> Review club notes:\r\n\r\nPreparation notes; it's scheduled for ~Wednesday the 29th~ tonight, which explains why I couldn't find the minutes :-)\r\n\r\n",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-579723127",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 350067640,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMDY3NjQw",
      "url": null,
      "actor": null,
      "commit_id": "640861a52a7d2ad6f9f1242946ad43ba20e8a9d7",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I left a few comments mid-review to help with tonights review club. So far eebaca7620bbd0af0ec385c6c7d47b2b4b524d55 looks good, but I need to stare at it a bit more. The new (clarification of) tests are great.\r\n\r\n~You may want to rebase, because without that on macOS I get errors during `make`:~ _(this was an issue with my machine)_\r\n\r\n```\r\nUndefined symbols for architecture x86_64:\r\n  \"_CRYPTO_num_locks\", referenced from:\r\n      (anonymous namespace)::RNGState::RNGState() in libbitcoin_util.a(libbitcoin_util_a-random.o)\r\n  \"_RAND_cleanup\", referenced from:\r\n```",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-350067640",
      "submitted_at": "2020-01-29T14:30:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 579838548,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTgzODU0OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579838548",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-29T16:23:17Z",
      "updated_at": "2020-01-29T16:23:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "> You may want to rebase, because without that on macOS I get errors during `make`:\r\n\r\nWith gcc (Debian 8.3.0-6) and `--enable-debug --enable-bench` eebaca7620bbd0af0ec385c6c7d47b2b4b524d55 builds and all tests are passing for me. Starting code review.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-579838548",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 579879560,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTg3OTU2MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579879560",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-29T17:53:09Z",
      "updated_at": "2020-05-18T08:22:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK. Code review ACK of commit b2abb396c64e96585a0c38a269372b35cced08bd. The changes are straightforward and do not appear to change behavior.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-579879560",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 579887330,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTg4NzMzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/579887330",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-29T18:09:56Z",
      "updated_at": "2020-01-29T18:09:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "PR title \"coins: allow Flush() without cache drop\" seems out of date. Would suggest something like \"coins: Add new unused CCoinsViewCache::Sync() method\"",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-579887330",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "renamed",
      "id": 2990872086,
      "node_id": "MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjk5MDg3MjA4Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/2990872086",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-01-29T19:53:44Z",
      "rename": {
        "from": "coins: allow Flush() without cache drop",
        "to": "coins: allow write to disk without cache drop"
      }
    },
    {
      "event": "commented",
      "id": 581137919,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4MTEzNzkxOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/581137919",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-02T13:55:30Z",
      "updated_at": "2020-02-02T13:55:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-581137919",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 356335551,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MzM1NTUx",
      "url": null,
      "actor": null,
      "commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tested ACK eebaca7620bbd0af0ec385c6c7d47b2b4b524d55\r\n\r\nI've added a few nits, but I think this is ready for merge now, and those nits could be cleaned up later.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-356335551",
      "submitted_at": "2020-02-10T23:26:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-11T18:56:29Z",
      "updated_at": "2020-02-11T18:56:29Z",
      "source": {
        "issue": {
          "id": 562909163,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MzczNDIwNjc4",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18113",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18113/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18113/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18113/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/18113",
          "number": 18113,
          "state": "closed",
          "state_reason": null,
          "title": "[WIP] Consensus: Don't allow a coin to be spent and FRESH.",
          "body": "This change prevents coins from existing in a coins cache which are both FRESH and spent. FRESH coins should be removed from a cache when they are spent, and this PR also stops us from fetching spent coins from a parent cache and marking them FRESH.",
          "user": {
            "login": "jnewbery",
            "id": 1063656,
            "node_id": "MDQ6VXNlcjEwNjM2NTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jnewbery",
            "html_url": "https://github.com/jnewbery",
            "followers_url": "https://api.github.com/users/jnewbery/followers",
            "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
            "organizations_url": "https://api.github.com/users/jnewbery/orgs",
            "repos_url": "https://api.github.com/users/jnewbery/repos",
            "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jnewbery/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 1648013533,
              "node_id": "MDU6TGFiZWwxNjQ4MDEzNTMz",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Review%20club",
              "name": "Review club",
              "description": "",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 14,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18113",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/18113",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/18113.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/18113.patch"
          },
          "closed_at": "2020-04-22T22:30:16Z",
          "created_at": "2020-02-11T00:25:12Z",
          "updated_at": "2022-02-15T10:45:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-11T20:57:53Z",
      "updated_at": "2020-02-11T20:57:53Z",
      "source": {
        "issue": {
          "id": 532952603,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MzQ5MTA3ODUx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17669",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17669/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17669/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17669/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/17669",
          "number": 17669,
          "state": "closed",
          "state_reason": null,
          "title": "tests: have coins simulation test also use CCoinsViewDB",
          "body": "Before this change, the coins simulation test uses a base view of type\r\nCCoinsViewTest, which has no relevance outside of the unittest suite. Might as\r\nwell reuse this testcase with a more realistic configuration that has\r\nCCoinsViewDB (i.e. in-memory leveldb) at the bottom of the view structure.\r\n\r\nThis adds explicit use of CCoinsViewDB in the unittest suite.\r\n\r\n#### Before change\r\n```\r\n./src/test/test_bitcoin --run_test=coins_tests --catch_system_errors=no  21.99s user 0.04s system 99% cpu 22.057 total\r\n```\r\n\r\n#### After change\r\n```\r\n./src/test/test_bitcoin --run_test=coins_tests --catch_system_errors=no  78.80s user 0.04s system 100% cpu 1:18.82 total\r\n```",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 62963516,
              "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
              "name": "Tests",
              "color": "d4c5f9",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17669",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/17669",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/17669.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/17669.patch"
          },
          "closed_at": "2020-04-16T16:59:26Z",
          "created_at": "2019-12-04T21:44:25Z",
          "updated_at": "2022-02-15T10:29:28Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-12T00:17:04Z",
      "updated_at": "2020-02-12T00:17:04Z",
      "source": {
        "issue": {
          "id": 196552856,
          "node_id": "MDExOlB1bGxSZXF1ZXN0OTg2NjM4MDU=",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9384",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9384/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9384/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/9384/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/9384",
          "number": 9384,
          "state": "closed",
          "state_reason": null,
          "title": "CCoinsViewCache code cleanup & deduplication",
          "body": "CCoinsViewCache code cleanup & deduplication\r\n\r\nThe change moves code responsible for updating the cache out of various\r\nCCoinsViewCache methods and into a Modifier class. This way the cache update\r\ncode is just written once in a general way instead of being duplicated and\r\nsplit up to handle various special cases.\r\n\r\nThis is a refactoring, with changes to cache behavior only in 2 corner cases\r\n(with corresponding tests in coins_test.cpp) which don't affect the meaning of\r\ndata stored in the cache:\r\n\r\n* In BatchWrite, overwriting a non-dirty pruned cache entry with a fresh pruned\r\n  cache entry now deletes the cache entry instead of leaving behind a dirty\r\n  pruned entry that will trigger an unnecessary database write later.\r\n\r\n* In BatchWrite, overwriting a dirty pruned fresh cache entry with a nonpruned\r\n  entry updates the entry without dropping the fresh flag. There's no reason to\r\n  drop the fresh flag in this case because the flag accurately describes the\r\n  state of the base view and could prevent unnecessary database writes in the\r\n  future if the utxo is spent later.",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/9384",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/9384",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/9384.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/9384.patch"
          },
          "closed_at": "2023-04-25T15:59:46Z",
          "created_at": "2016-12-20T00:07:34Z",
          "updated_at": "2023-04-25T15:59:46Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 359265516,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjY1NTE2",
      "url": null,
      "actor": null,
      "commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK eebaca7620bbd0af0ec385c6c7d47b2b4b524d55\r\n\r\nReviewed code and tested locally.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-359265516",
      "submitted_at": "2020-02-14T23:54:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 587075723,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU4NzA3NTcyMw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/587075723",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-02-17T16:37:01Z",
      "updated_at": "2020-02-17T16:37:01Z",
      "author_association": "MEMBER",
      "body": "Thanks for the reviews, all. I'll address some of the nits if there's a need to rebase, otherwise I'm going for ACK-preservation at this point.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-587075723",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 598830130,
      "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODgzMDEzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598830130",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z",
      "updated_at": "2020-03-13T17:20:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "This has two ACKs on the latest branch (@jnewbery and @fjahr), but previous concept ACKs from @ryanofsky @jonatack @dongcarl @ariard , and other review comments from @Sjors @andrewtoth @MarcoFalke . What can we do to get this over the line?",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-598830130",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 3127578938,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODkzOA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578938",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578942,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NDI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578942",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578945,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk0NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578945",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578946,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NDY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578946",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578949,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk0OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578949",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578951,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578951",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578953,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk1Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578953",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578954,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NTQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578954",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578956,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk1Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578956",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578957,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NTc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578957",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578958,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk1OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578958",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578960,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578960",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578963,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk2Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578963",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578965,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NjU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578965",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578970,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk3MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578970",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "subscribed",
      "id": 3127578973,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5NzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578973",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:52Z"
    },
    {
      "event": "mentioned",
      "id": 3127578981,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzEyNzU3ODk4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578981",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:53Z"
    },
    {
      "event": "subscribed",
      "id": 3127578986,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDMxMjc1Nzg5ODY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3127578986",
      "actor": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-03-13T17:20:53Z"
    },
    {
      "event": "reviewed",
      "id": 386091788,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDkxNzg4",
      "url": null,
      "actor": null,
      "commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-386091788",
      "submitted_at": "2020-04-02T03:52:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-14T21:10:15Z",
      "updated_at": "2020-04-14T21:10:15Z",
      "source": {
        "issue": {
          "id": 599787828,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDAzMzU2NTY0",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18637",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18637/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18637/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18637/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/18637",
          "number": 18637,
          "state": "closed",
          "state_reason": null,
          "title": "coins: allow cache resize after init",
          "body": "This is part of the [assumeutxo project](https://github.com/bitcoin/bitcoin/projects/11):\r\n\r\nParent PR: #15606 \r\nIssue: #15605 \r\nSpecification: https://github.com/jamesob/assumeutxo-docs/tree/master/proposal\r\n\r\n---\r\n\r\nIn the assumeutxo implementation draft (#15056), once a UTXO snapshot is loaded, a new chainstate object is created after initialization. This means that we have to reclaim some of the cache that we've allocated to the original chainstate (per `dbcache=`) to repurpose for the snapshot chainstate.\r\n\r\nFurthermore, it makes sense to have different cache allocations depending on which chainstate is more active. While the snapshot chainstate is working to get to the network tip (and the background validation chainstate is idle), it makes sense that the snapshot chainstate should have the majority of cache allocation. And contrariwise once the snapshot has reached network tip, most of the cache should be given to the background validation chainstate.\r\n\r\nThis set of changes (detailed in the commit messages) allows us to dynamically resize the various coins caches. None of the functionality introduced here is used at the moment, but will be in the next AU PR (which introduces `ActivateSnapshot`).\r\n\r\n`ChainstateManager::MaybeRebalanceCaches()` defines the (somewhat normative) cache allocations between the snapshot and background validation chainstates. I'd be interested in feedback if anyone has thoughts on the proportions I've set there.",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18637",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/18637",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/18637.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/18637.patch"
          },
          "closed_at": "2020-07-29T05:55:09Z",
          "created_at": "2020-04-14T18:54:22Z",
          "updated_at": "2022-02-15T10:46:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 3241215318,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDMyNDEyMTUzMTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3241215318",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-04-16T18:24:09Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3309156698,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzMwOTE1NjY5OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3309156698",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-06T15:54:56Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-06T17:19:41Z",
      "updated_at": "2020-05-06T17:19:41Z",
      "source": {
        "issue": {
          "id": 605114332,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDA3NTgwMTIz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18746",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18746/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18746/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18746/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/18746",
          "number": 18746,
          "state": "closed",
          "state_reason": null,
          "title": "consensus: Don't add spent coins to the cache",
          "body": "When fetching a coin from a parent cache, don't add it to the child\r\ncache if it's already spent, since there's no benefit to adding it.\r\n\r\nThis adds some invariant properties to the coins cache:\r\n- a spent coin cannot be FRESH\r\n- a spent coin must be DIRTY",
          "user": {
            "login": "jnewbery",
            "id": 1063656,
            "node_id": "MDQ6VXNlcjEwNjM2NTY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jnewbery",
            "html_url": "https://github.com/jnewbery",
            "followers_url": "https://api.github.com/users/jnewbery/followers",
            "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
            "organizations_url": "https://api.github.com/users/jnewbery/orgs",
            "repos_url": "https://api.github.com/users/jnewbery/repos",
            "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jnewbery/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 192202000,
              "node_id": "MDU6TGFiZWwxOTIyMDIwMDA=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Consensus",
              "name": "Consensus",
              "color": "009800",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 11,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18746",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/18746",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/18746.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/18746.patch"
          },
          "closed_at": "2021-05-17T14:56:20Z",
          "created_at": "2020-04-22T22:28:25Z",
          "updated_at": "2022-08-18T18:31:08Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 3309637488,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MzMwOTYzNzQ4OA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3309637488",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-06T17:58:40Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-10T17:06:24Z",
      "updated_at": "2020-05-10T17:06:24Z",
      "source": {
        "issue": {
          "id": 615433995,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDE1NzUwNDUy",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18936",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18936/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18936/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18936/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/18936",
          "number": 18936,
          "state": "closed",
          "state_reason": null,
          "title": "validation: Persist coins cache to disk and load on startup",
          "body": "This PR adds a way to persist the coins cache on shutdown to a file named `coinscache.dat`, similar to what is done for the mempool. On startup this file is used to warm the cache so it doesn't get cold between restarts.\r\n\r\nThis introduces a new config arg, `-persistcoinscache`, that is defaulted to true unless `-dbcache` is set to a higher value than default.\r\n\r\nWith a higher cache value the amount of disk space used for the file could be very large and the warm up could take an excessively long time, so it defaults to off to prevent any footguns. With a max dbcache after a reindex or IBD it will dump the entire utxo set and load it into memory on startup. Testing this today I had a file size of 2.4GB and it took ~22 minutes to warm the cache with an SSD.\r\n\r\nAfter #17487 we can add a change to not wipe the cache on periodic flushes. We could then run the node continuously with the entire utxo set in memory. This could be useful for users who want to connect blocks quickly.\r\n\r\nI'm not sure how I should write tests for this.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18936",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/18936",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/18936.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/18936.patch"
          },
          "closed_at": "2020-05-11T02:14:34Z",
          "created_at": "2020-05-10T17:06:24Z",
          "updated_at": "2022-02-15T10:30:40Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-11T02:46:53Z",
      "updated_at": "2020-05-11T02:46:53Z",
      "source": {
        "issue": {
          "id": 615548919,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDE1ODM1NDY1",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18941",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18941/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18941/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18941/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/18941",
          "number": 18941,
          "state": "closed",
          "state_reason": null,
          "title": "validation: Persist coins cache to disk and load on startup",
          "body": "This PR adds a way to persist the coins cache on shutdown to a file named `coinscache.dat`, similar to what is done for the mempool. On startup this file is used to warm the cache so it doesn't get cold between restarts. This can be useful for users who want to connect blocks quickly with a high `-dbcache` value.\r\n\r\nThis introduces a new config arg, `-persistcoinscache`, that is defaulted to false. With a higher cache value the amount of disk space used for the file could be very large, so it defaults to off to prevent any footguns. With lower cache values this configuration could cause the cache to flush sooner than necessary and would probably not provide any benefit.\r\n\r\nWith a max dbcache after a reindex or IBD it will dump the entire utxo set and load it into memory on startup. Testing this today I had a file size of 2.4GB and it took ~22 minutes to fully reinsert the utxo set into the cache with an SSD.\r\n\r\nAfter #17487 we can [add a change to not wipe the cache on periodic flushes](https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-629929852). Users could then run the node continuously with the entire utxo set in memory. [Benchmarking](https://github.com/bitcoin/bitcoin/pull/18941#issuecomment-633684774) shows running in this configuration could save several hundred milliseconds when connecting blocks, vs an empty cache that is cleared periodically or during restarts.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18941",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/18941",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/18941.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/18941.patch"
          },
          "closed_at": "2020-06-18T01:29:06Z",
          "created_at": "2020-05-11T02:46:53Z",
          "updated_at": "2023-08-17T20:41:05Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 629929852,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYyOTkyOTg1Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/629929852",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-18T03:46:39Z",
      "updated_at": "2020-05-18T03:47:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "tested ACK 8bb1163805121b2863fef1c16c9b104803e8dfdd\r\nI've been running [this patch](https://github.com/andrewtoth/bitcoin/commit/e851e772197f10362818c7e38a7776ba03a71d48) on top of this branch for the last week to test non-erasing periodic flushes. I haven't had any issues.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-629929852",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 413366423,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzY2NDIz",
      "url": null,
      "actor": null,
      "commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 8bb1163805121b2\r\n\r\nReviewed, built/tested/ran bitcoind locally. No change in current behavior. Thanks for the work on the tests.",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-413366423",
      "submitted_at": "2020-05-18T08:15:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 414611820,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjExODIw",
      "url": null,
      "actor": null,
      "commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "A couple more comments inline.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-414611820",
      "submitted_at": "2020-05-19T16:29:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 414643354,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjQzMzU0",
      "url": null,
      "actor": null,
      "commit_id": "d5f4f7bcdb5e18702fcdcbaff922ce9c8f9f5654",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK 8bb1163805121b2863fef1c16c9b104803e8dfdd\r\n\r\nNote that #18746 also touches `BatchWrite`, and I have a light preference for merging that first. But it shouldn't be rocket science to rebase either this PR or that one.\r\n\r\nOn a related note, I find the existing terminology of base, mapCoins, parent and grandparent extremely confusing.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-414643354",
      "submitted_at": "2020-05-19T18:53:34Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 631583791,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTU4Mzc5MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/631583791",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-20T16:27:53Z",
      "updated_at": "2020-05-20T16:27:53Z",
      "author_association": "MEMBER",
      "body": "Thanks for the feedback, all. I'll push some responses later today.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-631583791",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3384129635,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzM4NDEyOTYzNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3384129635",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-28T18:38:04Z"
    },
    {
      "event": "reviewed",
      "id": 420349660,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzQ5NjYw",
      "url": null,
      "actor": null,
      "commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> Thanks for the feedback, all. I'll push some responses later today.\r\n\r\n8 days later... revisions pushed. Thanks for feedback.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-420349660",
      "submitted_at": "2020-05-28T18:38:33Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 421455405,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDU1NDA1",
      "url": null,
      "actor": null,
      "commit_id": "1ce5cd389f286627412bc5edc6cb34006b65ec0b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-421455405",
      "submitted_at": "2020-05-31T01:56:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3390728430,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzM5MDcyODQzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3390728430",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-05-31T15:51:28Z"
    },
    {
      "event": "reviewed",
      "id": 421532480,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTMyNDgw",
      "url": null,
      "actor": null,
      "commit_id": "fdc1d80ce4348687ca87d544e8efe40e5344f5d3",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-421532480",
      "submitted_at": "2020-05-31T22:12:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3392998272,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzM5Mjk5ODI3Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3392998272",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-01T12:54:42Z"
    },
    {
      "event": "commented",
      "id": 636870055,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjg3MDA1NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/636870055",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-01T13:46:16Z",
      "updated_at": "2020-06-01T13:46:16Z",
      "author_association": "MEMBER",
      "body": "re-utACK 8d5994ef2235c6706440bc18968006cd04c22fb4",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-636870055",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 637156481,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYzNzE1NjQ4MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/637156481",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-01T22:21:58Z",
      "updated_at": "2020-06-01T22:21:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "utACK 8d5994ef2235c6706440bc18968006cd04c22fb4",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-637156481",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 422785077,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzg1MDc3",
      "url": null,
      "actor": null,
      "commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK 8d5994e modulo question at https://github.com/bitcoin/bitcoin/pull/17487#discussion_r433961320, reviewed changes since my previous review per `git diff 8bb1163 8d5994e` and verified that this builds cleanly on Debian gcc and clang locally with the works.\r\n\r\n\r\n<details><summary>Changes since last review at 8bb1163</summary><p>\r\n\r\n```diff\r\n$ (pr/17487)$ git diff 8bb1163 8d5994e\r\ndiff --git a/src/coins.cpp b/src/coins.cpp\r\nindex 060a23a09f..0a76509705 100644\r\n--- a/src/coins.cpp\r\n+++ b/src/coins.cpp\r\n@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\r\n                 // Create the coin in the parent cache, move the data up\r\n                 // and mark it as dirty.\r\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\r\n-                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;\r\n+                if (erase) {\r\n+                    // The `move` call here is purely an optimization; we rely on the\r\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\r\n+                    // the entry from the child map.\r\n+                    entry.coin = std::move(it->second.coin);\r\n+                } else {\r\n+                    entry.coin = it->second.coin;\r\n+                }\r\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\r\n                 entry.flags = CCoinsCacheEntry::DIRTY;\r\n                 // We can mark it FRESH in the parent if it was FRESH in the child\r\n@@ -199,7 +206,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\r\n             } else {\r\n                 // A normal modification.\r\n                 cachedCoinsUsage -= itUs->second.coin.DynamicMemoryUsage();\r\n-                itUs->second.coin = erase ? std::move(it->second.coin) : it->second.coin;\r\n+                if (erase) {\r\n+                    // The `move` call here is purely an optimization; we rely on the\r\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\r\n+                    // the entry from the child map.\r\n+                    itUs->second.coin = std::move(it->second.coin);\r\n+                } else {\r\n+                    itUs->second.coin = it->second.coin;\r\n+                }\r\n                 cachedCoinsUsage += itUs->second.coin.DynamicMemoryUsage();\r\n                 itUs->second.flags |= CCoinsCacheEntry::DIRTY;\r\n                 // NOTE: It isn't safe to mark the coin as FRESH in the parent\r\n@@ -223,14 +237,14 @@ bool CCoinsViewCache::Flush() {\r\n bool CCoinsViewCache::Sync()\r\n {\r\n     bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\r\n-    // Instead of clearing the cache, just clear the FRESH/DIRTY\r\n-    // flags, and erase any spent coins\r\n+    // Instead of clearing `cacheCoins` as we would in Flush(), just clear the\r\n+    // FRESH/DIRTY flags of any coin that isn't spent.\r\n     for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\r\n-        it->second.flags = 0;\r\n         if (it->second.coin.IsSpent()) {\r\n             cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n             it = cacheCoins.erase(it);\r\n         } else {\r\n+            it->second.flags = 0;\r\n             ++it;\r\n         }\r\n     }\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex b912b01fb4..e91c299de2 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -306,7 +306,7 @@ public:\r\n \r\n     /**\r\n      * Push the modifications applied to this cache to its base while retaining\r\n-     * the contents of this cache.\r\n+     * the contents of this cache (except for FRESH spent coins, which we erase).\r\n      * Failure to call this method or Flush() before destruction will cause the changes\r\n      * to be forgotten.\r\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\r\ndiff --git a/src/test/coins_tests.cpp b/src/test/coins_tests.cpp\r\nindex 9375cd69b0..0bf65014ff 100644\r\n--- a/src/test/coins_tests.cpp\r\n+++ b/src/test/coins_tests.cpp\r\n@@ -183,7 +183,7 @@ void SimulationTest(CCoinsView* base, bool fake_best_block)\r\n                     added_an_unspendable_entry = true;\r\n                 } else {\r\n                     // Random sizes so we can test memory usage accounting\r\n-                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 1);\r\n+                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 0);\r\n                     (coin.IsSpent() ? added_an_entry : updated_an_entry) = true;\r\n                     coin = newcoin;\r\n                 }\r\n@@ -906,7 +906,7 @@ Coin MakeCoin()\r\n }\r\n \r\n \r\n-//! For CCoinsViewCache instances backed by either another cache instance and\r\n+//! For CCoinsViewCache instances backed by either another cache instance or\r\n //! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\r\n //!\r\n //! 1. Adding a random coin to the child-most cache,\r\n@@ -933,7 +933,9 @@ void TestFlushBehavior(\r\n         // Flush in reverse order to ensure that flushes happen from children up.\r\n         for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\r\n             auto cache = *i;\r\n-            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\r\n+            // hashBlock must be filled before flushing to disk; value is\r\n+            // unimportant here. This is normally done during connect/disconnect block.\r\n+            cache->SetBestBlock(InsecureRand256());\r\n             erase ? cache->Flush() : cache->Sync();\r\n         }\r\n     };\r\n@@ -1007,7 +1009,7 @@ void TestFlushBehavior(\r\n     //\r\n     BOOST_CHECK(view->SpendCoin(outp));\r\n \r\n-    // The coin should be in the cache, but pruned and marked dirty.\r\n+    // The coin should be in the cache, but spent and marked dirty.\r\n     GetCoinsMapEntry(view->map(), value, flags, outp);\r\n     BOOST_CHECK_EQUAL(value, SPENT);\r\n     BOOST_CHECK_EQUAL(flags, DIRTY);\r\n@@ -1047,7 +1049,7 @@ void TestFlushBehavior(\r\n \r\n     flush_all(/*erase*/ true); // Erase all cache content.\r\n \r\n-    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()\r\n+    // --- Bonus check 2: ensure that a FRESH, spent coin is deleted by Sync()\r\n     //\r\n     txid = InsecureRand256();\r\n     outp = COutPoint(txid, 0);\r\ndiff --git a/src/txdb.cpp b/src/txdb.cpp\r\nindex c6dfe39595..2588dc914f 100644\r\n--- a/src/txdb.cpp\r\n+++ b/src/txdb.cpp\r\n@@ -115,10 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, boo\r\n             changed++;\r\n         }\r\n         count++;\r\n-        CCoinsMap::iterator itOld = it++;\r\n-        if (erase) {\r\n-            mapCoins.erase(itOld);\r\n-        }\r\n+        it = erase ? mapCoins.erase(it) : ++it;\r\n         if (batch.SizeEstimate() > batch_size) {\r\n             LogPrint(BCLog::COINDB, \"Writing partial batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n             db.WriteBatch(batch);\r\n```\r\n</p></details>\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-422785077",
      "submitted_at": "2020-06-02T15:18:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 422790091,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzkwMDkx",
      "url": null,
      "actor": null,
      "commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-422790091",
      "submitted_at": "2020-06-02T15:23:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 423768662,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzY4NjYy",
      "url": null,
      "actor": null,
      "commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-423768662",
      "submitted_at": "2020-06-03T17:18:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 638494243,
      "node_id": "MDEyOklzc3VlQ29tbWVudDYzODQ5NDI0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/638494243",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-06-03T22:28:40Z",
      "updated_at": "2020-06-03T22:28:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK 8d5994ef2235c6706440bc18968006cd04c22fb4",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-638494243",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "labeled",
      "id": 3597431547,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDM1OTc0MzE1NDc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3597431547",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-07-29T06:12:10Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3612071852,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzYxMjA3MTg1Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612071852",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:43:35Z"
    },
    {
      "event": "commented",
      "id": 667551597,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzU1MTU5Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667551597",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:54Z",
      "updated_at": "2020-08-01T15:53:54Z",
      "author_association": "MEMBER",
      "body": "[`au.coins-erase.7`](https://github.com/jamesob/bitcoin/tree/au.coins-erase.7) -> [`au.coins-erase.8`](https://github.com/jamesob/bitcoin/tree/au.coins-erase.8)\r\n\r\n<details><summary>Show range-diff</summary>\r\n\r\n```sh\r\n% git range-diff master au.coins-erase.7 au.coins-erase.8\r\n\r\n1:  8b9b51da04 ! 1:  58616e0b8b coins: add Sync() method to allow flush without cacheCoins drop\r\n    @@ -187,7 +187,7 @@\r\n\r\n     -bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\r\n     +bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase) {\r\n    -     CDBBatch batch(db);\r\n    +     CDBBatch batch(*m_db);\r\n          size_t count = 0;\r\n          size_t changed = 0;\r\n     @@\r\n    @@ -199,7 +199,7 @@\r\n     +        it = erase ? mapCoins.erase(it) : ++it;\r\n              if (batch.SizeEstimate() > batch_size) {\r\n                  LogPrint(BCLog::COINDB, \"Writing partial batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n    -             db.WriteBatch(batch);\r\n    +             m_db->WriteBatch(batch);\r\n\r\n      diff --git a/src/txdb.h b/src/txdb.h\r\n      --- a/src/txdb.h\r\n2:  09ef24a814 = 2:  48d3e92b06 test: refactor: clarify the coins simulation\r\n3:  c50373bfb7 = 3:  7239b0cee5 test: add use of Sync() to coins tests\r\n4:  8d5994ef22 = 4:  0292b01cc4 test: add test for coins view flush behavior using Sync()\r\n```\r\n\r\n</details>\r\n\r\nThis PR has gotten substantial review, testing, and ACK from a number of people (@andrewtoth, @jnewbery, @jonatack, @Sjors) but personally I would appreciate evaluation for at least a Concept ACK from someone who has a lot of experience in the coins department (e.g. @sipa, @sdaftuar, @ryanofsky) before this moves forward.\r\n\r\nTo reiterate, this has shown to be noticeably helpful when loading UTXO snapshots with assumeutxo and can potentially help shave some time off ConnectBlock (https://github.com/bitcoin/bitcoin/pull/18941#issuecomment-633684774 cc @andrewtoth). But I don't want to push a string here.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-667551597",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 3612085524,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTUyNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085524",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085527,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1Mjc=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085527",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085529,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTUyOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085529",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085533,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1MzM=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085533",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085537,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTUzNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085537",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085539,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1Mzk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085539",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085542,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTU0Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085542",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085544,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1NDQ=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085544",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085546,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTU0Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085546",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085548,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1NDg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085548",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085551,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTU1MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085551",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085555,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1NTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085555",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "mentioned",
      "id": 3612085559,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjA4NTU1OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085559",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "subscribed",
      "id": 3612085560,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTIwODU1NjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612085560",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T15:53:55Z"
    },
    {
      "event": "reviewed",
      "id": 459595094,
      "node_id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTk1MDk0",
      "url": null,
      "actor": null,
      "commit_id": "58616e0b8b37cae4d011062038fb6565064fe3d1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-459595094",
      "submitted_at": "2020-08-01T18:22:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 3612426944,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MzYxMjQyNjk0NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612426944",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T20:16:55Z"
    },
    {
      "event": "commented",
      "id": 667582030,
      "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzU4MjAzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/667582030",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T20:18:04Z",
      "updated_at": "2020-08-01T20:18:04Z",
      "author_association": "MEMBER",
      "body": "[`au.coins-erase.8`](https://github.com/jamesob/bitcoin/tree/au.coins-erase.8) -> [`au.coins-erase.9`](https://github.com/jamesob/bitcoin/tree/au.coins-erase.9)\r\n\r\n<details><summary><code>$ git range-diff master au.coins-erase.8 au.coins-erase.9</code></summary>\r\n\r\n```diff\r\n1:  58616e0b8b ! 1:  47d71fdb70 coins: add Sync() method to allow flush without cacheCoins drop\r\n    @@ -154,7 +154,7 @@\r\n\r\n     +    /**\r\n     +     * Push the modifications applied to this cache to its base while retaining\r\n    -+     * the contents of this cache (except for FRESH spent coins, which we erase).\r\n    ++     * the contents of this cache (except for spent coins, which we erase).\r\n     +     * Failure to call this method or Flush() before destruction will cause the changes\r\n     +     * to be forgotten.\r\n     +     * If false is returned, the state of this cache (and its backing view) will be undefined.\r\n    @@ -196,7 +196,7 @@\r\n              count++;\r\n     -        CCoinsMap::iterator itOld = it++;\r\n     -        mapCoins.erase(itOld);\r\n    -+        it = erase ? mapCoins.erase(it) : ++it;\r\n    ++        it = erase ? mapCoins.erase(it) : std::next(it);\r\n              if (batch.SizeEstimate() > batch_size) {\r\n                  LogPrint(BCLog::COINDB, \"Writing partial batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\r\n                  m_db->WriteBatch(batch);\r\n2:  48d3e92b06 = 2:  342ef935c4 test: refactor: clarify the coins simulation\r\n3:  7239b0cee5 = 3:  77897654a5 test: add use of Sync() to coins tests\r\n4:  0292b01cc4 = 4:  f4b56059b4 test: add test for coins view flush behavior using Sync()\r\n```\r\n\r\n</details>\r\n\r\nAddressed feedback from @sipa (thanks).",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-667582030",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 3612428454,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50MzYxMjQyODQ1NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612428454",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T20:18:04Z"
    },
    {
      "event": "subscribed",
      "id": 3612428456,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDM2MTI0Mjg0NTY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3612428456",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-01T20:18:04Z"
    },
    {
      "event": "unlabeled",
      "id": 3616130947,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50MzYxNjEzMDk0Nw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/3616130947",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-08-03T14:18:33Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2020-10-13T15:08:13Z",
      "updated_at": "2020-10-13T15:08:13Z",
      "source": {
        "issue": {
          "id": 685710084,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NDczMzkxNTc5",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19806",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19806/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19806/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/19806/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/19806",
          "number": 19806,
          "state": "closed",
          "state_reason": null,
          "title": "validation: UTXO snapshot activation",
          "body": "This is part of the [assumeutxo project](https://github.com/bitcoin/bitcoin/projects/11):\r\n\r\nParent PR: #15606 \r\nIssue: #15605 \r\nSpecification: https://github.com/jamesob/assumeutxo-docs/tree/master/proposal\r\n\r\n---\r\n\r\nThis change proposes logic for activating UTXO snapshots, which is unused at the moment aside from an included unittest. There are a few moveonyish/refactoring commits to allow for halfway decent unittests.\r\n\r\nBasic structure is included for specifying and checking the assumeutxo hash values used to validate activated snapshots. Initially I had specified a few height/hash pairs for mainnet in this change, but because of the security-critical nature of those parameters, I figured it was better to leave their inclusion to a future PR that includes only that change - my intent being that reviewers will be more likely to verify those parameters firsthand in a dedicated PR.\r\n\r\nAside from that and the snapshot activation logic, there are a few related changes:\r\n\r\n- ~~allow caching the `nChainTx` value in the CCoinsViewDB; this is set during snapshot activation. Because we don't necessarily have access to the full chain at the time of snapshot load, this value is communicated through the snapshot metadata and must be cached within the chainstate to survive restarts.~~\r\n- break out `CreateUTXOSnapshot()` from dumptxoutset. This is essentially a move-only change to allow the reuse of snapshot creation logic from within unittests.\r\n- ...and a few other misc. changes that are solely related to unittests.\r\n\r\nThe move-onlyish commit is most easily reviewed with `--color-moved=zebra`.",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 35,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/19806",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/19806",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/19806.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/19806.patch"
          },
          "closed_at": "2021-02-16T18:23:27Z",
          "created_at": "2020-08-25T18:49:41Z",
          "updated_at": "2022-08-18T18:23:16Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 832916004,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgzMjkxNjAwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/832916004",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-05T18:33:03Z",
      "updated_at": "2021-05-05T18:33:03Z",
      "author_association": "MEMBER",
      "body": "I was able to rebase f4b5605 on master and run the test. Difference with my previous utACK seems trivial, but I haven't re-reviewed it.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-832916004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-17T08:26:20Z",
      "updated_at": "2021-06-17T08:26:20Z",
      "source": {
        "issue": {
          "id": 923255524,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NjcyMDM5NTM0",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22263",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22263/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22263/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22263/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/22263",
          "number": 22263,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: wrap CCoinsViewCursor in unique_ptr",
          "body": "I tripped over this one for a few hours at the beginning of the week, so I've sort of got a personal vendetta against `CCoinsView::Cursor()` returning a raw pointer.\r\n\r\nSpecifically in the case of CCoinsViewDB, if a raw cursor is allocated and not freed, a cryptic leveldb assertion failure occurs on CCoinsViewDB destruction (`Assertion 'dummy_versions_.next_ == &dummy_versions_' failed.`).\r\n\r\nThis is a pretty simple change.\r\n\r\nRelated to: https://github.com/bitcoin/bitcoin/issues/21766\r\nSee also: https://github.com/google/leveldb/issues/142#issuecomment-414418135",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22263",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/22263",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/22263.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/22263.patch"
          },
          "closed_at": "2021-06-23T16:34:47Z",
          "created_at": "2021-06-17T00:35:09Z",
          "updated_at": "2022-08-16T17:24:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 4930238190,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ5MzAyMzgxOTA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4930238190",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-06-23T17:23:38Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 5169407443,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NTE2OTQwNzQ0Mw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5169407443",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-08-17T14:37:50Z"
    },
    {
      "event": "unlabeled",
      "id": 5169829004,
      "node_id": "MDE0OlVubGFiZWxlZEV2ZW50NTE2OTgyOTAwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5169829004",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-08-17T15:46:26Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 829525974,
      "node_id": "PRR_kwDOABII584xcY_W",
      "url": null,
      "actor": null,
      "commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-829525974",
      "submitted_at": "2021-12-11T11:53:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-12-11T11:55:33Z",
      "updated_at": "2021-12-11T11:55:33Z",
      "source": {
        "issue": {
          "id": 1077238926,
          "node_id": "PR_kwDOABII584vst-g",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23738",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23738/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23738/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23738/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/23738",
          "number": 23738,
          "state": "closed",
          "state_reason": null,
          "title": "validation, log: improve logging of ChainstateManager snapshot persistance",
          "body": "Use the `LOG_TIME_MILLIS_WITH_CATEGORY_MSG_ONCE` macro to improve the logging of ChainstateManager snapshot persistance, log task start and completion separately and no longer manually track the duration, as suggested by Marco Falke in https://github.com/bitcoin/bitcoin/pull/22872#discussion_r715571280.\r\n\r\nExtract the flushing into one function, which clarifies the logic, extends the improved logging to both flushing call sites, and allows logging the prefix `FlushSnapshotToDisk`, which is similar to `FlushStateToDisk`.\r\n\r\nbefore\r\n```\r\n[snapshot] flushing coins cache (0 MB)... done (0.00ms)\r\n\r\n[snapshot] flushing snapshot chainstate to disk\r\n```\r\nafter\r\n```\r\nFlushSnapshotToDisk: flushing coins cache (0 MB) started\r\n...\r\nFlushSnapshotToDisk: completed (0.00ms)\r\n\r\nFlushSnapshotToDisk: saving snapshot chainstate (0 MB) started\r\n...\r\nFlushSnapshotToDisk: completed (0.00ms)\r\n```\r\nThe logging can be observed in the output of\r\n```\r\n./src/test/test_bitcoin -t validation_chainstate_tests -- DEBUG_LOG_OUT\r\n```\r\n",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23738",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/23738",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/23738.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/23738.patch"
          },
          "closed_at": "2021-12-13T14:08:46Z",
          "created_at": "2021-12-10T21:21:19Z",
          "updated_at": "2022-12-13T10:02:41Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 847197360,
      "node_id": "PRR_kwDOABII584yfzSw",
      "url": null,
      "actor": null,
      "commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK 0c2fc5154e88b46725b8a1c2149aa94c552d1e03\r\n\r\nReviewed code, ran tests locally including some basic mutations.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-847197360",
      "submitted_at": "2022-01-09T12:23:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-04T00:44:55Z",
      "updated_at": "2022-06-04T00:44:55Z",
      "source": {
        "issue": {
          "id": 1260364605,
          "node_id": "PR_kwDOABII5845F7Be",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25274",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25274/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25274/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25274/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25274",
          "number": 25274,
          "state": "closed",
          "state_reason": null,
          "title": "[WIP] add free list to unordered map",
          "body": "This is offered as a \"dumb\" alternative to @martinus's very clever #22702, seeking some approach ACK before I spend more time polishing it. \r\n\r\nInstead of using a custom allocator, we just take advantage of the statically assertable fact that a node_handle is smaller than the COutpoint key type (or really, key type or value type, but key type happens to be big enough) to build a free list of extracted nodes that we then don't have to reallocate to reinsert. This would enable us to initialize a cacheMap with any number of nodes we like by inserting with N sequential COutpoints, and then removing them, or by calling reserve (unclear if any functional difference?).\r\n\r\nIn particular, this does not require mucking with any map internals, it's just using the external guts in a 'well defined but weird' way. Perhaps something like this is less scary @laanwj?\r\n\r\nOffered in WIP status for approach ACKs, missing (at least):\r\n\r\n1. Count total allocation size / count elements in free list\r\n2. Deallocate/clear the free list correctly (nodes in free list remain reinsertable after clear)\r\n3. make the create_new_cache_coin function have all the emplace-like behaviors we might want\r\n4. Any thorough review of correctness5. \r\n5. Generically wrapping it for any map where sizeof(K) >= sizeof(node_type).\r\n\r\nIn contrast to #22702, this approach would likely not save any space in allocations, since it can't allocate pages at a time.\r\n",
          "user": {
            "login": "JeremyRubin",
            "id": 886523,
            "node_id": "MDQ6VXNlcjg4NjUyMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/886523?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/JeremyRubin",
            "html_url": "https://github.com/JeremyRubin",
            "followers_url": "https://api.github.com/users/JeremyRubin/followers",
            "following_url": "https://api.github.com/users/JeremyRubin/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/JeremyRubin/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/JeremyRubin/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/JeremyRubin/subscriptions",
            "organizations_url": "https://api.github.com/users/JeremyRubin/orgs",
            "repos_url": "https://api.github.com/users/JeremyRubin/repos",
            "events_url": "https://api.github.com/users/JeremyRubin/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/JeremyRubin/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25274",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25274",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25274.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25274.patch"
          },
          "closed_at": "2022-06-10T20:40:24Z",
          "created_at": "2022-06-03T20:50:42Z",
          "updated_at": "2023-06-10T10:05:49Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-06-10T17:46:23Z",
      "updated_at": "2022-06-10T17:46:23Z",
      "source": {
        "issue": {
          "id": 1267157159,
          "node_id": "PR_kwDOABII5845cksp",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25325",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25325/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25325/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25325/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25325",
          "number": 25325,
          "state": "closed",
          "state_reason": null,
          "title": "Add pool based memory resource",
          "body": "A memory resource similar to `std::pmr::unsynchronized_pool_resource`, but optimized for node-based containers. The goal is to be able to cache more coins with the same memory usage, and allocate/deallocate faster.\r\n\r\nThis is a reimplementation of #22702. The goal was to implement it in a way that is simpler to review & test\r\n\r\n* There is now a generic `PoolResource` for allocating/deallocating memory. This has practically the same API as `std::pmr::memory_resource`. (Unfortunately I cannot use std::pmr because libc++ simply doesn't implement that API).\r\n* Thanks to sipa there is now a fuzzer for PoolResource! On a fast machine I ran it for ~770 million executions without finding any issue.\r\n\r\n* The estimation of the correct node size is now gone, PoolResource now has multiple pools and just needs to be created large enough to have space for the unordered_map nodes.\r\n\r\nI ran benchmarks with #22702, mergebase, and this PR. Frequency locked Intel i7-8700, clang++ 13.0.1 to reindex up to block 690000.\r\n\r\n```sh\r\nbitcoind -dbcache=5000 -assumevalid=00000000000000000002a23d6df20eecec15b21d32c75833cce28f113de888b7 -reindex-chainstate -printtoconsole=0 -stopatheight=690000\r\n```\r\n\r\nThe performance is practically identical with #22702, just 0.4% slower. It's ~21% faster than master:\r\n\r\n![Progress in Million Transactions over Time(2)](https://user-images.githubusercontent.com/14386/173288685-91952ade-f304-4825-8bfb-0725a71ca17b.png)\r\n\r\n![Size of Cache in MiB over Time](https://user-images.githubusercontent.com/14386/173291421-e6b410be-ac77-479b-ad24-5fafcebf81eb.png)\r\nNote that on cache drops mergebase's memory doesnt go so far down because it does not free the `CCoinsMap` bucket array.\r\n\r\n![Size of Cache in Million tx over Time(1)](https://user-images.githubusercontent.com/14386/173288703-a80c9c9e-93c8-4a16-9df8-610c89c61cc4.png)\r\n",
          "user": {
            "login": "martinus",
            "id": 14386,
            "node_id": "MDQ6VXNlcjE0Mzg2",
            "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/martinus",
            "html_url": "https://github.com/martinus",
            "followers_url": "https://api.github.com/users/martinus/followers",
            "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
            "organizations_url": "https://api.github.com/users/martinus/orgs",
            "repos_url": "https://api.github.com/users/martinus/repos",
            "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/martinus/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 37,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25325",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25325",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25325.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25325.patch"
          },
          "closed_at": "2023-04-20T20:20:32Z",
          "created_at": "2022-06-10T07:16:06Z",
          "updated_at": "2023-12-04T12:15:11Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-17T17:38:23Z",
      "updated_at": "2022-08-17T17:38:23Z",
      "source": {
        "issue": {
          "id": 1341891304,
          "node_id": "PR_kwDOABII5849VJRd",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25862/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25862",
          "number": 25862,
          "state": "closed",
          "state_reason": null,
          "title": "refactor, kernel: Remove gArgs accesses from dbwrapper and txdb",
          "body": "Code in the libbitcoin_kernel library should not be calling `ArgsManager` methods or trying to read options from the command line. Instead it should just get options values from simple structs and function arguments that are passed in externally. This PR removes `gArgs` accesses from `dbwrapper` and `txdb` modules by defining appropriate options structs, and is a followup to PR's #25290 #25487 #25527 which remove other `ArgsManager` calls from kernel modules.\r\n\r\nThis PR does not change behavior in any way. It is a simpler alternative to #25623 because the only thing it does is remove `gArgs` references from kernel code. It avoids other unnecessary changes like adding options to the kernel API (they can be added separately later).",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25862",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25862",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25862.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25862.patch"
          },
          "closed_at": "2023-02-17T21:55:24Z",
          "created_at": "2022-08-17T14:51:35Z",
          "updated_at": "2023-02-17T21:55:24Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1386213840,
      "node_id": "IC_kwDOABII585Sn_HQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1386213840",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:38Z",
      "updated_at": "2023-01-17T23:17:38Z",
      "author_association": "MEMBER",
      "body": "This PR has several stale ACKs. It seems like the most recent revision could be in a good enough state to go in (no conflicts with master, almost all comments have been addressed). Would any of the previous reviewers (@sjors @ryanofsky @jonatack @andrewtoth) like to give this a re-review?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1386213840",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 8250692792,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHrx5S4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692792",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "subscribed",
      "id": 8250692808,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHrx5TI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692808",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "mentioned",
      "id": 8250692829,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHrx5Td",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692829",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "subscribed",
      "id": 8250692839,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHrx5Tn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692839",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "mentioned",
      "id": 8250692854,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHrx5T2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692854",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "subscribed",
      "id": 8250692866,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHrx5UC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692866",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "mentioned",
      "id": 8250692888,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHrx5UY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692888",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "subscribed",
      "id": 8250692904,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHrx5Uo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8250692904",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:17:39Z"
    },
    {
      "event": "commented",
      "id": 1386240386,
      "node_id": "IC_kwDOABII585SoFmC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1386240386",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-17T23:35:01Z",
      "updated_at": "2023-01-17T23:35:01Z",
      "author_association": "MEMBER",
      "body": "ACK 0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1386240386",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1386321896,
      "node_id": "IC_kwDOABII585SoZfo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1386321896",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-18T01:13:36Z",
      "updated_at": "2023-01-18T01:13:36Z",
      "author_association": "MEMBER",
      "body": "Concept ACK, and rough code review ACK the first commit. I'd still like to review the tests.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1386321896",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 1253213780,
      "node_id": "PRR_kwDOABII585KsoZU",
      "url": null,
      "actor": null,
      "commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1253213780",
      "submitted_at": "2023-01-18T10:32:24Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 1396161277,
      "node_id": "IC_kwDOABII585TN7r9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1396161277",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-18T22:11:40Z",
      "updated_at": "2023-01-18T22:11:40Z",
      "author_association": "MEMBER",
      "body": "Thanks for resurrecting this one from the graveyard; I'll fix it up tomorrow.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1396161277",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 8315241063,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHvoIJn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241063",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:08Z"
    },
    {
      "event": "subscribed",
      "id": 8315241081,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHvoIJ5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241081",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:08Z"
    },
    {
      "event": "mentioned",
      "id": 8315241094,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHvoIKG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241094",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "subscribed",
      "id": 8315241108,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHvoIKU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241108",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "mentioned",
      "id": 8315241128,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHvoIKo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241128",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "subscribed",
      "id": 8315241131,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHvoIKr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241131",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "mentioned",
      "id": 8315241144,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHvoIK4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241144",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "subscribed",
      "id": 8315241154,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHvoILC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8315241154",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-19T19:05:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8321709753,
      "node_id": "HRFPE_lADOABII584fNOyFzwAAAAHwAza5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8321709753",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T13:59:26Z"
    },
    {
      "event": "reviewed",
      "id": 1263815368,
      "node_id": "PRR_kwDOABII585LVErI",
      "url": null,
      "actor": null,
      "commit_id": "a5b8b9a3059f4684320de400e535192c72297afe",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1263815368",
      "submitted_at": "2023-01-20T15:30:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc5Y2VkYzM2YWZlMmU3MmU0MjgzOWQ4NjE3MzRkNzNkNTQ1ZDIxYjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/79cedc36afe2e72e42839d861734d73d545d21b8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/79cedc36afe2e72e42839d861734d73d545d21b8",
      "tree": {
        "sha": "b828b92dababbe42ced74b7ec7ff6484a995ccd7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b828b92dababbe42ced74b7ec7ff6484a995ccd7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c0b6c40bb084752f686ff77e6883ee6fd16eba26",
          "sha": "c0b6c40bb084752f686ff77e6883ee6fd16eba26",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c0b6c40bb084752f686ff77e6883ee6fd16eba26"
        }
      ],
      "message": "coins: add Sync() method to allow flush without cacheCoins drop\n\nIn certain circumstances, we may want to flush to disk without\nemptying `cacheCoins`, which affects performance. UTXO snapshot\nactivation is one such case.\n\nThis method is currently unused and this commit does not\nchange any behavior.\n\nIncorporates feedback from John Newbery.\n\nCo-authored-by: Suhas Daftuar <sdaftuar@gmail.com>",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-01-20T15:36:48Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-12-03T18:25:35Z"
      },
      "sha": "79cedc36afe2e72e42839d861734d73d545d21b8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZkOGFmZmNhOTZjN2EzNGY1ZjEwNGM1YTMxMjJlNzQyMGZmYzA4M2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6d8affca96c7a34f5f104c5a3122e7420ffc083c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6d8affca96c7a34f5f104c5a3122e7420ffc083c",
      "tree": {
        "sha": "f66f4c06828af06aed9fa2f48d1b3829571bb7c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f66f4c06828af06aed9fa2f48d1b3829571bb7c3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/79cedc36afe2e72e42839d861734d73d545d21b8",
          "sha": "79cedc36afe2e72e42839d861734d73d545d21b8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/79cedc36afe2e72e42839d861734d73d545d21b8"
        }
      ],
      "message": "test: refactor: clarify the coins simulation\n\nAdds comments, slight refactor clarifications to make the code\neasier to follow.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-01-20T15:36:52Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-12-03T18:31:24Z"
      },
      "sha": "6d8affca96c7a34f5f104c5a3122e7420ffc083c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJjM2NiZDZjMDA3YTU4OGU2Njc3NTEwMjQwMjc0NjIyNjg2MjZmZGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c3cbd6c007a588e667751024027462268626fdb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2c3cbd6c007a588e667751024027462268626fdb",
      "tree": {
        "sha": "60342892572702ff08f1e2dad48c3556ebfdcf88",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/60342892572702ff08f1e2dad48c3556ebfdcf88"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6d8affca96c7a34f5f104c5a3122e7420ffc083c",
          "sha": "6d8affca96c7a34f5f104c5a3122e7420ffc083c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6d8affca96c7a34f5f104c5a3122e7420ffc083c"
        }
      ],
      "message": "test: add use of Sync() to coins tests",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-01-20T15:36:52Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-12-03T18:32:43Z"
      },
      "sha": "2c3cbd6c007a588e667751024027462268626fdb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFkNzkzNWI0NWFjNjE3OTEzOTk5ODllZmZjMThhZWNlOGIzNjhmYmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d7935b45ac61791399989effc18aece8b368fbb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1d7935b45ac61791399989effc18aece8b368fbb",
      "tree": {
        "sha": "73b1a4574cf96c5fc2c1a000e5106594c2555b6a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/73b1a4574cf96c5fc2c1a000e5106594c2555b6a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c3cbd6c007a588e667751024027462268626fdb",
          "sha": "2c3cbd6c007a588e667751024027462268626fdb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c3cbd6c007a588e667751024027462268626fdb"
        }
      ],
      "message": "test: add test for coins view flush behavior using Sync()\n\nThanks to Marco Falke for help with move semantics.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-01-20T15:39:50Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-12-03T18:33:10Z"
      },
      "sha": "1d7935b45ac61791399989effc18aece8b368fbb"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8322644387,
      "node_id": "HRFPE_lADOABII584fNOyFzwAAAAHwEXmj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8322644387",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T15:40:14Z"
    },
    {
      "event": "commented",
      "id": 1398576700,
      "node_id": "IC_kwDOABII585TXJY8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398576700",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T15:41:59Z",
      "updated_at": "2023-01-20T15:41:59Z",
      "author_association": "MEMBER",
      "body": "All feedback so far has been addressed as far as I'm aware. I had to push a fully rebased version because I was having issues compiling (the base branch is from 2019!).",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1398576700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 1263978537,
      "node_id": "PRR_kwDOABII585LVsgp",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Reviewed the first commit https://github.com/bitcoin/bitcoin/commit/79cedc36afe2e72e42839d861734d73d545d21b8. Suggestions:\r\n\r\n- drop the `Sync()` function from the first commit and add it instead in the 3rd commit where it is actually used\r\n- rename the first commit to something like \"add bool `erase` param to BatchWrite() to flush without emptying...\"\r\n- avoid adding a default value for `erase` in the BatchWrite() declarations in favor of passing it explicitly in two calls in the tests\r\n \r\n<details><summary>suggested (tested) diff for the first commit</summary><p>\r\n\r\n```diff\r\njon|(79cedc36af...):~/bitcoin/bitcoin$ gd \r\ndiff --git a/src/coins.cpp b/src/coins.cpp\r\nindex ecbd625cd7..fec0856513 100644\r\n--- a/src/coins.cpp\r\n+++ b/src/coins.cpp\r\n@@ -248,30 +248,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\r\n     return true;\r\n }\r\n \r\n-bool CCoinsViewCache::Flush() {\r\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ true);\r\n+bool CCoinsViewCache::Flush()\r\n+{\r\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/true);\r\n     cacheCoins.clear();\r\n     cachedCoinsUsage = 0;\r\n     return fOk;\r\n }\r\n \r\n-bool CCoinsViewCache::Sync()\r\n-{\r\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ false);\r\n-    // Instead of clearing `cacheCoins` as we would in Flush(), just clear the\r\n-    // FRESH/DIRTY flags of any coin that isn't spent.\r\n-    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\r\n-        if (it->second.coin.IsSpent()) {\r\n-            cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n-            it = cacheCoins.erase(it);\r\n-        } else {\r\n-            it->second.flags = 0;\r\n-            ++it;\r\n-        }\r\n-    }\r\n-    return fOk;\r\n-}\r\n-\r\n void CCoinsViewCache::Uncache(const COutPoint& hash)\r\n {\r\n     CCoinsMap::iterator it = cacheCoins.find(hash);\r\ndiff --git a/src/coins.h b/src/coins.h\r\nindex 4edc146a14..c6f0e048c8 100644\r\n--- a/src/coins.h\r\n+++ b/src/coins.h\r\n@@ -176,7 +176,7 @@ public:\r\n \r\n     //! Do a bulk modification (multiple Coin changes + BestBlock change).\r\n     //! The passed mapCoins can be modified.\r\n-    virtual bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase = true);\r\n+    virtual bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase);\r\n \r\n     //! Get a cursor to iterate over the whole state\r\n     virtual std::unique_ptr<CCoinsViewCursor> Cursor() const;\r\n@@ -202,7 +202,7 @@ public:\r\n     uint256 GetBestBlock() const override;\r\n     std::vector<uint256> GetHeadBlocks() const override;\r\n     void SetBackend(CCoinsView &viewIn);\r\n-    bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase = true) override;\r\n+    bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase) override;\r\n     std::unique_ptr<CCoinsViewCursor> Cursor() const override;\r\n     size_t EstimateSize() const override;\r\n };\r\n@@ -235,7 +235,7 @@ public:\r\n     bool HaveCoin(const COutPoint &outpoint) const override;\r\n     uint256 GetBestBlock() const override;\r\n     void SetBestBlock(const uint256 &hashBlock);\r\n-    bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase = true) override;\r\n+    bool BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock, bool erase) override;\r\n     std::unique_ptr<CCoinsViewCursor> Cursor() const override {\r\n         throw std::logic_error(\"CCoinsViewCache cursor iteration not supported.\");\r\n     }\r\ndiff --git a/src/test/coins_tests.cpp b/src/test/coins_tests.cpp\r\nindex d55dea4f83..1d84d4c3bc 100644\r\n--- a/src/test/coins_tests.cpp\r\n+++ b/src/test/coins_tests.cpp\r\n@@ -53,7 +53,7 @@ public:\r\n \r\n     uint256 GetBestBlock() const override { return hashBestBlock_; }\r\n \r\n-    bool BatchWrite(CCoinsMap& mapCoins, const uint256& hashBlock, bool erase = true) override\r\n+    bool BatchWrite(CCoinsMap& mapCoins, const uint256& hashBlock, bool erase) override\r\n     {\r\n         for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); ) {\r\n             if (it->second.flags & CCoinsCacheEntry::DIRTY) {\r\n@@ -610,7 +610,7 @@ void WriteCoinsViewEntry(CCoinsView& view, CAmount value, char flags)\r\n {\r\n     CCoinsMap map;\r\n     InsertCoinsMapEntry(map, value, flags);\r\n-    BOOST_CHECK(view.BatchWrite(map, {}));\r\n+    BOOST_CHECK(view.BatchWrite(map, /*hashBlock=*/{}, /*erase=*/true));\r\n }\r\n \r\n class SingleEntryCacheTest\r\ndiff --git a/src/test/fuzz/coins_view.cpp b/src/test/fuzz/coins_view.cpp\r\nindex 46026d8df3..149082425e 100644\r\n--- a/src/test/fuzz/coins_view.cpp\r\n+++ b/src/test/fuzz/coins_view.cpp\r\n@@ -129,7 +129,7 @@ FUZZ_TARGET_INIT(coins_view, initialize_coins_view)\r\n                 }\r\n                 bool expected_code_path = false;\r\n                 try {\r\n-                    coins_view_cache.BatchWrite(coins_map, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\r\n+                    coins_view_cache.BatchWrite(coins_map, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock(), /*erase=*/true);\r\n                     expected_code_path = true;\r\n```\r\n</p></details>\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1263978537",
      "submitted_at": "2023-01-20T16:37:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 1263992791,
      "node_id": "PRR_kwDOABII585LVv_X",
      "url": null,
      "actor": null,
      "commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1263992791",
      "submitted_at": "2023-01-20T16:46:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 1264048435,
      "node_id": "PRR_kwDOABII585LV9kz",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1264048435",
      "submitted_at": "2023-01-20T17:20:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 1264076713,
      "node_id": "PRR_kwDOABII585LWEep",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1264076713",
      "submitted_at": "2023-01-20T17:37:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 1398742646,
      "node_id": "IC_kwDOABII585TXx52",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1398742646",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T17:53:28Z",
      "updated_at": "2023-01-20T17:53:28Z",
      "author_association": "MEMBER",
      "body": "@jonatack thanks for the look, but given my level of interest and time, I'm not going to be doing a lot of shuffling on this PR. Unless there are problems, I'm going to leave it as-is and may incorporate your smaller suggestions if I have to retouch.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1398742646",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 8323866063,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHwJB3P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8323866063",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T17:53:28Z"
    },
    {
      "event": "subscribed",
      "id": 8323866085,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHwJB3l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8323866085",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-20T17:53:29Z"
    },
    {
      "event": "commented",
      "id": 1399296361,
      "node_id": "IC_kwDOABII585TZ5Fp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1399296361",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-21T17:39:35Z",
      "updated_at": "2023-01-21T17:39:35Z",
      "author_association": "MEMBER",
      "body": "Rebase looks innocent at first glance, but this has been so long ago that I should re-review the change.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1399296361",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1402748746,
      "node_id": "IC_kwDOABII585TnD9K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1402748746",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-24T22:01:17Z",
      "updated_at": "2023-01-24T22:02:05Z",
      "author_association": "MEMBER",
      "body": "ACK 1d7935b45ac61791399989effc18aece8b368fbb\r\n\r\nI've reviewed the code carefully, and am happy about the extent of behaviors tested. I've also experimented by (combined with #25325) by adding code that regularly triggers a non-erasing sync of the active chain, while reindexing a mainnet node, running in `valgrind`, and running with `-sanitizers=undefined,address`, including restarts and `killall -KILL bitcoind`s. No problems observed.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1402748746",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1403613883,
      "node_id": "IC_kwDOABII585TqXK7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403613883",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T13:29:14Z",
      "updated_at": "2023-01-25T16:47:33Z",
      "author_association": "MEMBER",
      "body": "I added a variant of #15265 on top of this (https://github.com/Sjors/bitcoin/commit/4a2c802d6e2b1bdcf1d8546f3834344436a94522) and am currently running IBD on mainnet with a node pruned to 10GB with 16GB of dbcache. I also enabled `-sanitizers=undefined,address` and set `--enable-c++20` for some variation.\r\n\r\nThe original PR found there was no performance benefit, but it makes a good stress test. So far so good (365K blocks synced, multiple flushes, a manual node restart and a `kill -9` after several prune events). It should take about 2 days on my AMD Ryzen 7950x.\r\n\r\nI also noticed that, as expected, the cache size slightly decreases at every prune event, since we're deleting spent coins.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1403613883",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1403628053,
      "node_id": "IC_kwDOABII585TqaoV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403628053",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T13:35:05Z",
      "updated_at": "2023-01-25T13:36:09Z",
      "author_association": "MEMBER",
      "body": "@Sjors it's worth noting that based on benchmarks I've done in the past (https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557595582), most of the performance benefits are observable on spinning disks. ~~And certainly in the case of assumeutxo, when the flush is done before a sizable period of IBD, the difference is probably more pronounced than during normal tip maintenance.~~ Edit: I see that your bench includes cases like this.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1403628053",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 8354828085,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAHx_I81",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8354828085",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T13:35:05Z"
    },
    {
      "event": "subscribed",
      "id": 8354828105,
      "node_id": "SE_lADOABII584fNOyFzwAAAAHx_I9J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8354828105",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T13:35:05Z"
    },
    {
      "event": "commented",
      "id": 1403914399,
      "node_id": "IC_kwDOABII585Trgif",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403914399",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T16:47:22Z",
      "updated_at": "2023-01-25T16:47:22Z",
      "author_association": "MEMBER",
      "body": "Perhaps for a follow-up, but we shouldn't forget: add a call to `coins_view_cache.Sync()` in `src/test/fuzz/coins_view.cpp`.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1403914399",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1403924473,
      "node_id": "IC_kwDOABII585Tri_5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1403924473",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T16:54:51Z",
      "updated_at": "2023-01-25T16:54:51Z",
      "author_association": "MEMBER",
      "body": "Regarding performance, I think #15265 is a bit naive, and we shouldn't conclude too much based on benchmarks of just that.\r\n\r\nThe trade-off when syncing without wiping the cache is that on the next flush/sync, there will be more non-dirty entries in the cache that need to be iterated over. That iterating has a non-zero cost which is only a fraction of that of actually writing something to disk, but for millions of them, it still adds up. A better strategy is probably keeping some statistics on the ratio between dirty/nondirty entries in the cache, and decide whether to sync/flush based on that.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1403924473",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1404096255,
      "node_id": "IC_kwDOABII585TsM7_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404096255",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T19:02:26Z",
      "updated_at": "2023-01-25T19:02:26Z",
      "author_association": "MEMBER",
      "body": "ACK 1d7935b45ac61791399989effc18aece8b368fbb",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1404096255",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1404099795,
      "node_id": "IC_kwDOABII585TsNzT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1404099795",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-25T19:05:41Z",
      "updated_at": "2023-01-25T19:05:41Z",
      "author_association": "MEMBER",
      "body": "> Perhaps for a follow-up, but we shouldn't forget: add a call to `coins_view_cache.Sync()` in `src/test/fuzz/coins_view.cpp`.\r\n\r\nI'll leave this as-is to avoid disturbing the delicate congregation of ACKs (sounds like a nature documentary), but can do a quick follow-up.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1404099795",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 1269463879,
      "node_id": "PRR_kwDOABII585LqntH",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I still need to review `CCoinsViewCache::BatchWrite` which IIUC only gets involved when there's a stack of two `CCoinsViewCache`. See IRC chat of January 25th around 19:20 UTC.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1269463879",
      "submitted_at": "2023-01-25T20:26:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "reviewed",
      "id": 1270679645,
      "node_id": "PRR_kwDOABII585LvQhd",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I think this PR can be simplified by not touching the body of `CCoinsViewDB::BatchWrite` (other than adding an assert).\r\n\r\nMy understanding from yesterdays [IRC discussion](https://www.erisian.com.au/bitcoin-core-dev/log-2023-01-25.html#l-485) is that the only time `CCoinsViewCache::BatchWrite` is called is when you have two CCoinsViewCache's stacked on top of each other.\r\n\r\nThe big Flush() only happens in `Chainstate::FlushStateToDisk`. This involves `CoinsTip()` which is a `CCoinsViewCache` on top of a `CCoinsViewDB`. So in `base-> BatchWrite` is called on the `CCoinsViewDB` version.\r\n\r\nSame for `FlushSnapshotToDisk`.\r\n\r\nThere's also a `Flush()` call in `Chainstate::ReplayBlocks()`. This also involves a `CCoinsViewCache` on top of a `CCoinsViewDB`, but since this is only used at startup time, it's tiny anyway.\r\n\r\n\r\nThe only two places where we have two `CCoinsViewCache` objects stacked on top of each other are `ConnectTip` and `DisconnectTip()`. But here the top-most `CCoinsViewCache` is tiny and is not worth preserving.\r\n\r\nUnless something changes in AssumeUTXO followup PRs?\r\n",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1270679645",
      "submitted_at": "2023-01-26T09:32:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 1405365582,
      "node_id": "IC_kwDOABII585TxC1O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1405365582",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-26T17:41:20Z",
      "updated_at": "2023-01-26T17:41:20Z",
      "author_association": "MEMBER",
      "body": "> I think this PR can be simplified by not touching the body of CCoinsViewDB::BatchWrite (other than adding an assert).\r\n\r\nI don't think this is workable for my purposes. My motivation for filing the PR was for use in assumeutxo, where we load in a large number of coins to a CCoinsViewCache hierarchy. After all coins are loaded, [the coins cache is committed to disk](https://github.com/bitcoin/bitcoin/blob/master/src/validation.cpp#L5037-L5046), which results in a `BatchWrite()` call on a CCoinsViewDB object. If that method does not support `erase=false`, we will evict all freshly-loaded coins from the cache.\r\n\r\nBut perhaps you meant that we might be able to get away with not modifying CCoinsView**Cache**::BatchWrite() in this changeset. In a strict sense this may be possible, but then we would break the interface for `CCoinsView`, since one of its subclasses would support that parameter and another wouldn't. I think this would complicate the implementation somewhat, and might lead to surprising usages.\r\n\r\nIt is plausible to me that we could still add the `erase` parameter to all `BatchWrite()`s to maintain interface compatbility, but then do some kind of conditional assertion that `erase != true` if the type of `base` is CCoinsViewCache, but from what I'm reading, C++ doesn't like that kind of dynamic type-checking. This would also complicate our tests, which randomly build cache hierarchies and then call BatchWrite willy-nilly.\r\n\r\n---\r\n\r\nSo to sum up, I think what you're suggesting is possible, but IMO it's kind of a wash in terms of the complexity it might introduce. I'm personally not interested in spending the time to do the experimentation since my interest in assumeutxo (and subsequently this change) is waning. If others are interested in picking up this change and trying it, you have my full support!",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1405365582",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "commented",
      "id": 1406296508,
      "node_id": "IC_kwDOABII585T0mG8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1406296508",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-27T10:17:05Z",
      "updated_at": "2023-01-27T10:23:59Z",
      "author_association": "MEMBER",
      "body": "> I think this PR can be simplified by not touching the body of CCoinsViewDB::BatchWrite \r\n\r\nOops, my comment was the wrong way around. It should have said `not touching the body of CCoinsViewCache`. That's what the `assert` achieved in #15265 (in `CCoinsViewCache`, not in the base class).\r\n\r\nI agree there's a trade-off for where you're adding complexity: this PR makes `CCoinsViewDB::BatchWrite` more complicated, but the alternative might add make the tests more complicated.\r\n\r\nI'll continue to review the changed `CCoinsViewCache` method.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1406296508",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "reviewed",
      "id": 1272674305,
      "node_id": "PRR_kwDOABII585L23gB",
      "url": null,
      "actor": null,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "tACK 1d7935b45ac61791399989effc18aece8b368fbb\r\n\r\nIBD with debug stuff ~still needs half a day or so, but I'll update things here if it fails~ _is done_!",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#pullrequestreview-1272674305",
      "submitted_at": "2023-01-27T13:15:14Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
    },
    {
      "event": "commented",
      "id": 1408717267,
      "node_id": "IC_kwDOABII585T91HT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1408717267",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T14:26:12Z",
      "updated_at": "2023-01-30T14:26:12Z",
      "author_association": "MEMBER",
      "body": "Any updates @Sjors?\r\n\r\nIs there more review needed here, or is this looking ready to go?\r\n\r\n![image](https://user-images.githubusercontent.com/73197/215503880-fdbc18a6-ba3f-4df5-b275-f99e661a6512.png)\r\n",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1408717267",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17487"
    },
    {
      "event": "mentioned",
      "id": 8388795597,
      "node_id": "MEE_lADOABII584fNOyFzwAAAAH0AtzN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8388795597",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T14:26:12Z"
    },
    {
      "event": "subscribed",
      "id": 8388795630,
      "node_id": "SE_lADOABII584fNOyFzwAAAAH0Atzu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8388795630",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T14:26:12Z"
    },
    {
      "event": "merged",
      "id": 8389821337,
      "node_id": "ME_lADOABII584fNOyFzwAAAAH0EoOZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8389821337",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "82903a7a8dc327f94eff0bbbb97d8a0eb04e9044",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/82903a7a8dc327f94eff0bbbb97d8a0eb04e9044",
      "created_at": "2023-01-30T16:01:39Z"
    },
    {
      "event": "closed",
      "id": 8389821401,
      "node_id": "CE_lADOABII584fNOyFzwAAAAH0EoPZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8389821401",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T16:01:39Z"
    },
    {
      "event": "referenced",
      "id": 8389878865,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH0E2RR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8389878865",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8ff3d69a6ae43141d65c85bd0619f2ad680c65f0",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/8ff3d69a6ae43141d65c85bd0619f2ad680c65f0",
      "created_at": "2023-01-30T16:06:45Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-30T17:34:25Z",
      "updated_at": "2023-01-30T17:34:25Z",
      "source": {
        "issue": {
          "id": 1562874006,
          "node_id": "PR_kwDOABII585I1nwv",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26999",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26999/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26999/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26999/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26999",
          "number": 26999,
          "state": "closed",
          "state_reason": null,
          "title": "A few follow-ups to #17487 (coins write without cache drop)",
          "body": "This addresses a few nits left open in #17487.",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26999",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26999",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26999.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26999.patch"
          },
          "closed_at": "2023-01-30T22:17:06Z",
          "created_at": "2023-01-30T17:34:25Z",
          "updated_at": "2024-01-30T12:26:55Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 8393063144,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH0Q_ro",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8393063144",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "c8cb62272eacc6341cadae82349cadfbabe7700e",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c8cb62272eacc6341cadae82349cadfbabe7700e",
      "created_at": "2023-01-30T22:17:05Z"
    },
    {
      "event": "referenced",
      "id": 8393186831,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH0Rd4P",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8393186831",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "04f83d37fb1ccb0d1d523f869cd51b4fc67ad486",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/04f83d37fb1ccb0d1d523f869cd51b4fc67ad486",
      "created_at": "2023-01-30T22:36:47Z"
    },
    {
      "event": "referenced",
      "id": 8401970599,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH0y-Wn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8401970599",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d6f54dac8dee776188fd88d725e2728e0822b33f",
      "commit_url": "https://api.github.com/repos/jamesob/bitcoin/commits/d6f54dac8dee776188fd88d725e2728e0822b33f",
      "created_at": "2023-01-31T17:09:47Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-01-31T17:10:49Z",
      "updated_at": "2023-01-31T17:10:49Z",
      "source": {
        "issue": {
          "id": 1564705101,
          "node_id": "PR_kwDOABII585I70RM",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27008",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27008/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27008/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27008/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27008",
          "number": 27008,
          "state": "closed",
          "state_reason": null,
          "title": "assumeutxo: keep cache when flushing snapshot (#17487 followup)",
          "body": "Make use of #17487.\r\n\r\nBenchmark results available here:\r\n  https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-557226923",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27008",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27008",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27008.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27008.patch"
          },
          "closed_at": "2023-05-06T13:18:52Z",
          "created_at": "2023-01-31T17:10:49Z",
          "updated_at": "2023-05-06T13:18:52Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 8448000331,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH3ikFL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8448000331",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "d2a9939c8a91adc07e159f6c20e81ac2254fc33f",
      "commit_url": "https://api.github.com/repos/jamesob/bitcoin/commits/d2a9939c8a91adc07e159f6c20e81ac2254fc33f",
      "created_at": "2023-02-06T14:23:38Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-06T21:51:12Z",
      "updated_at": "2023-02-06T21:51:12Z",
      "source": {
        "issue": {
          "id": 1365358751,
          "node_id": "PR_kwDOABII584-jA0u",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26045",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26045/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26045/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26045/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26045",
          "number": 26045,
          "state": "open",
          "state_reason": null,
          "title": "rpc: Optimize serialization disk space of dumptxoutset",
          "body": "This is an attempt to implement #25675.\r\n\r\nI was able to reduce the serialized utxo set from 5GB to 4.1GB on mainnet.\r\n\r\nCloses #25675.",
          "user": {
            "login": "aureleoules",
            "id": 22493292,
            "node_id": "MDQ6VXNlcjIyNDkzMjky",
            "avatar_url": "https://avatars.githubusercontent.com/u/22493292?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/aureleoules",
            "html_url": "https://github.com/aureleoules",
            "followers_url": "https://api.github.com/users/aureleoules/followers",
            "following_url": "https://api.github.com/users/aureleoules/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/aureleoules/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/aureleoules/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/aureleoules/subscriptions",
            "organizations_url": "https://api.github.com/users/aureleoules/orgs",
            "repos_url": "https://api.github.com/users/aureleoules/repos",
            "events_url": "https://api.github.com/users/aureleoules/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/aureleoules/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 19,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26045",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26045",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26045.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26045.patch"
          },
          "created_at": "2022-09-08T00:57:46Z",
          "updated_at": "2024-01-25T03:53:29Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 8583290769,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAH_mp-R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8583290769",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "129d8f55ee63e22b2a1c638c4f4782f36b8528d5",
      "commit_url": "https://api.github.com/repos/jamesob/bitcoin/commits/129d8f55ee63e22b2a1c638c4f4782f36b8528d5",
      "created_at": "2023-02-22T17:05:06Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "LarryRuane",
        "id": 8321330,
        "node_id": "MDQ6VXNlcjgzMjEzMzA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LarryRuane",
        "html_url": "https://github.com/LarryRuane",
        "followers_url": "https://api.github.com/users/LarryRuane/followers",
        "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
        "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
        "repos_url": "https://api.github.com/users/LarryRuane/repos",
        "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-21T17:05:18Z",
      "updated_at": "2023-04-21T17:05:18Z",
      "source": {
        "issue": {
          "id": 1656304703,
          "node_id": "I_kwDOCoXYYs5iuTQ_",
          "url": "https://api.github.com/repos/LarryRuane/bitcoin/issues/7",
          "repository_url": "https://api.github.com/repos/LarryRuane/bitcoin",
          "labels_url": "https://api.github.com/repos/LarryRuane/bitcoin/issues/7/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/LarryRuane/bitcoin/issues/7/comments",
          "events_url": "https://api.github.com/repos/LarryRuane/bitcoin/issues/7/events",
          "html_url": "https://github.com/LarryRuane/bitcoin/issues/7",
          "number": 7,
          "state": "open",
          "state_reason": null,
          "title": "speed up IBD by not storing unspent coins in UTXO memory cache",
          "body": "## Background\r\n\r\nThe UTXO, aka chainstate, database is stored on disk and partially in a memory cache whose size is determined by [`-dbcache`](https://github.com/bitcoin/bitcoin/blob/master/doc/reduce-memory.md#in-memory-caches)`). The size of this cache significantly affects IBD time. As we validate each block, we loop through its transactions, and verify that each input spends an existing UTXO. Even if we're not checking signatures (AssumeValid), we verify that the input refers to an _unspent_ output (to prevent double-spends). It's much faster if the UTXO is in the memory cache. We also add each transaction output to our memory UTXO cache so a subsequent transaction can refer to it. This memory cache is implemented as an unordered map whose key is an outpoint (txid and output index) and whose data is the scriptPubKey (what's needed to validate the input that wants to spend this output). When this cache becomes full, we flush it to disk; you can see those flushing cliffs in [graphs](https://github.com/bitcoin/bitcoin/pull/25325#issue-1267157159).\r\n\r\nWe don't flush a \"dirty\" in-memory UTXO entry to disk right away, because another near-term tx may spend this UTXO -- even within the same block. In that case, we never write this UTXO to disk! That's a nice savings. I think this explains the downward arcs of those graphs before each flush. UTXOs are continuously added to the cache at about the same rate, but as the cache becomes populated, it's more likely that inputs spend UTXOs that are in the memory cache, which allows those UTXOs to be dropped (and never written to disk). So the net rate of addition to the cache slows down. If the cache is large enough to hold the entire UTXO set, then the cache size would gradually level off. But it's unusual for node runners to configure the cache to be this large.\r\n\r\nAs an aside, it seems like an improvement would be to retain these items in the memory cache after we flush them to disk, instead of clearing the memory cache. There may be a reason I'm not aware of that this can't be done (or done easily).\r\n\r\n## The problem\r\n\r\nThere are many coins, such as Satoshi's early coins, that to this day have not been spent. They will eventually get flushed to disk -- but they hold onto memory until that happens. This means there is less memory available for other UTXOs that _will_ be spent before being flushed. The time Satoshi's coins are sitting in memory isn't a very efficient use of that memory.\r\n\r\nOne interesting property of IBD is that we know the (likely) future. Every node will go through the same sequence of coin creation and spending (in the database) until reaching the tip.\r\n\r\n## A solution\r\n\r\nSo the idea is, we have a static, hard-coded bloom filter (in the source code) that's probably updated for each major release (similar to the AssumeValid block hash). This bloom filter will contain outpoints referring to UTXOs that remain unspent (at least up to the time the filter is constructed), such as Satoshi's coins. When we add an entry to the memory cache, if the outpoint is (probably) in the bloom filter, then we want to flush it to disk -- and _free its cache entry in memory_ -- soon. The flushing seems to be done in batches, so we may need to bundle up a bunch of these and flush them at the same time. (I haven't figured out how to do this yet.) This will free up cache space, making it more likely that an input we're validating refers to a UTXO that is in the memory cache (and thus doesn't need to be read from disk). It makes the cache more effective -- storing items that are more likely to be needed. It would have the same effect as having a larger cache.\r\n\r\nA bloom filter can have false-positives, so we may flush some cache entries that do get spent, and that may make it worse when those get spent than currently. But if we size the filter correctly, this should be rare. We could instead invert the sense of the filter so it contains entries that _will be spent_ (and flush entries that are _not_ in the filter). This way, the false positives would cause us to keep entries in the cache that would be better to flush. But that's no different from today. I'm not sure which way around the filter should be implemented, but for now, let's assume it contains _unspent_ UTXOs.\r\n\r\nA refinement to this idea would be to add UTXOs to the bloom filter that are long-lived, not spent \"soon\" for some definition of soon. Unfortunately, this definition would ideally depend on the node's `-dbcache` setting, which we can't predict when we're creating the static bloom filter. We could have a few filters and use the appropriate one based on cache size, but that may be getting too complicated. If we choose \"soon\" based on the default cache size, that may be close enough. Also, we could not activate this optimization (do these \"early\" flushes) at all until the cache becomes something like 90% full. That way if a node is configured with a very large cache, this change wouldn't make performance worse.\r\n\r\nAnother refinement (thanks to @theStack) would be to inspect the scriptPubKey to see if the output is likely or actually unspendable (for example, dust or public keys not on the curve, or time locks).\r\n\r\nNote that this idea doesn't increase trust in the devs; it's just a performance improvement in the most likely case.\r\n",
          "user": {
            "login": "LarryRuane",
            "id": 8321330,
            "node_id": "MDQ6VXNlcjgzMjEzMzA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8321330?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/LarryRuane",
            "html_url": "https://github.com/LarryRuane",
            "followers_url": "https://api.github.com/users/LarryRuane/followers",
            "following_url": "https://api.github.com/users/LarryRuane/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/LarryRuane/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/LarryRuane/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/LarryRuane/subscriptions",
            "organizations_url": "https://api.github.com/users/LarryRuane/orgs",
            "repos_url": "https://api.github.com/users/LarryRuane/repos",
            "events_url": "https://api.github.com/users/LarryRuane/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/LarryRuane/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "OWNER",
          "locked": false,
          "comments": 4,
          "created_at": "2023-04-05T21:14:01Z",
          "updated_at": "2023-04-21T17:05:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "referenced",
      "id": 9172807586,
      "node_id": "REFE_lADOABII584fNOyFzwAAAAIive-i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9172807586",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "17f636883d378450b2c6dd174f962823bedb82ec",
      "commit_url": "https://api.github.com/repos/jamesob/bitcoin/commits/17f636883d378450b2c6dd174f962823bedb82ec",
      "created_at": "2023-05-05T01:27:13Z"
    },
    {
      "event": "moved_columns_in_project",
      "id": 9191357732,
      "node_id": "MCIPE_lADOABII584fNOyFzwAAAAIj2P0k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9191357732",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T14:57:08Z",
      "project_card": {
        "id": 29282280,
        "url": "https://api.github.com/projects/columns/cards/29282280",
        "project_id": 2564674,
        "project_url": "https://api.github.com/projects/2564674",
        "column_name": "Done",
        "previous_column_name": "In progress"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T14:44:41Z",
      "updated_at": "2023-08-07T14:44:41Z",
      "source": {
        "issue": {
          "id": 1839616362,
          "node_id": "PR_kwDOABII585XWA3I",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28233",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28233/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28233/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28233/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28233",
          "number": 28233,
          "state": "open",
          "state_reason": null,
          "title": "validation: don't clear cache on periodic flush",
          "body": "Since https://github.com/bitcoin/bitcoin/pull/17487 we no longer need to clear the coins cache when syncing to disk. [A warm coins cache significantly speeds up block connection](https://github.com/bitcoin/bitcoin/pull/18941#issuecomment-633684774), and only needs to be fully flushed when nearing the `dbcache` limit.\r\n\r\nPeriodic flushes occur every 24 hours, which empties the cache and causes block connection to slow down. By keeping the cache through periodic flushes a node can run for several days with an increasingly hotter cache and connect blocks much more quickly.\r\n\r\nAlso note that this still clears the cache for pruning flushes. Having frequent pruning flushes with a large cache that doesn't clear is less performant than the status quo https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-458657451. See https://github.com/bitcoin/bitcoin/pull/28280.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28233",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28233",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28233.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28233.patch"
          },
          "created_at": "2023-08-07T14:44:40Z",
          "updated_at": "2023-12-04T19:57:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-16T20:17:52Z",
      "updated_at": "2023-08-16T20:17:52Z",
      "source": {
        "issue": {
          "id": 1845783856,
          "node_id": "PR_kwDOCU6Vg85Xq-Lc",
          "url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/6",
          "repository_url": "https://api.github.com/repos/andrewtoth/bitcoin",
          "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/6/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/6/comments",
          "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/6/events",
          "html_url": "https://github.com/andrewtoth/bitcoin/pull/6",
          "number": 6,
          "state": "closed",
          "state_reason": null,
          "title": "Don't empty dbcache on prune flushes: >30% faster IBD",
          "body": "Since https://github.com/bitcoin/bitcoin/pull/17487 we no longer need to clear the coins cache when syncing to disk. A warm coins cache significantly speeds up block connection, and only needs to be fully flushed when nearing the `dbcache` limit.\r\n\r\nFor frequent pruning flushes there's no need to empty the cache and kill connect block speed. However, simply using `Sync` in place of `Flush` actually slows down a pruned full IBD with a high `dbcache` value. This is because as the cache grows, sync takes longer since every coin in the cache is iterated to check if it's dirty. For frequent prune flushes and a large cache this starts to really slow IBD down, and just emptying the cache on every prune becomes faster.\r\n\r\nTo fix this, we can add two pointers to each cache entry and construct a doubly linked list of dirty entries. We can then only iterate through all dirty entries on each `Sync`, and simply clear the pointers. A third pointer to the `COutPoint` is also needed since the linked list iterator won't have the corresponding outpoint anymore.\r\n\r\nWith this approach a full IBD with `dbcache=16384` and `prune=550` was 34% faster than master. For default `dbcache=450` speedup was 10%. All benchmarks were run with `stopatheight=800000`.\r\n\r\n|  | prune | dbcache | time | max RSS | speedup |\r\n|-----------:|----------:|------------:|--------:|-------------:|--------------:|\r\n| master | 550 | 16384 | 8:52:57 | 2,417,464k |-|\r\n| branch | 550 | 16384 | 5:51:03 | 17,109,712k | 34% |\r\n| branch | 550 | 450 | 7:56:31 | 2,856,416k | 10.5% |\r\n| master | 0 | 16384 | 4:51:53 | 14,726,408k | - |\r\n| branch | 0 | 16384 | 4:43:13 | 17,256,760k | 2.7% |\r\n| master | 0 | 450 | 7:08:07 | 3,005,892k | - |\r\n| branch | 0 | 450 | 7:08:38 | 2,986,396k |-|\r\n\r\nWhile the 3 pointers add memory to each cache entry, it did not slow down IBD. For non-pruned IBD results were similar for this branch and master. A non-pruned IBD with full `dbcache` to tip ended up using 15% more memory, but it was also 2.7% faster somehow. For smaller `dbcache` values the `dbcache` limit is respected so does not consume more memory, and the potentially more frequent flushes were not significant enough to cause any slowdown.\r\n\r\nInspired by [this comment](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457720636).\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/11315.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "OWNER",
          "locked": false,
          "comments": 0,
          "pull_request": {
            "url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls/6",
            "html_url": "https://github.com/andrewtoth/bitcoin/pull/6",
            "diff_url": "https://github.com/andrewtoth/bitcoin/pull/6.diff",
            "patch_url": "https://github.com/andrewtoth/bitcoin/pull/6.patch"
          },
          "closed_at": "2023-08-16T22:36:58Z",
          "created_at": "2023-08-10T19:38:10Z",
          "updated_at": "2023-08-16T22:36:58Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-16T22:38:20Z",
      "updated_at": "2023-08-16T22:38:20Z",
      "source": {
        "issue": {
          "id": 1853990384,
          "node_id": "PR_kwDOABII585YGslf",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28280",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28280/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28280/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28280/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28280",
          "number": 28280,
          "state": "open",
          "state_reason": null,
          "title": "Don't empty dbcache on prune flushes: >30% faster IBD",
          "body": "Since https://github.com/bitcoin/bitcoin/pull/17487 we no longer need to clear the coins cache when syncing to disk. A warm coins cache significantly speeds up block connection, and only needs to be fully flushed when nearing the `dbcache` limit.\r\n\r\nFor frequent pruning flushes there's no need to empty the cache and kill connect block speed. However, simply using `Sync` in place of `Flush` actually slows down a pruned full IBD with a high `dbcache` value. This is because as the cache grows, sync takes longer since every coin in the cache is scanned to check if it's dirty. For frequent prune flushes and a large cache this constant scanning starts to really slow IBD down, and just emptying the cache on every prune becomes faster.\r\n\r\nTo fix this, we can add two pointers to each cache entry and construct a doubly linked list of dirty entries. We can then only iterate through all dirty entries on each `Sync`, and simply clear the pointers after.\r\n\r\nWith this approach a full IBD with `dbcache=16384` and `prune=550` was 32% faster than master. For default `dbcache=450` speedup was ~9%. All benchmarks were run with `stopatheight=800000`.\r\n\r\n|  | prune | dbcache | time | max RSS | speedup |\r\n|-----------:|----------:|------------:|--------:|-------------:|--------------:|\r\n| master | 550 | 16384 | 8:52:57 | 2,417,464k | - |\r\n| branch | 550 | 16384 | 6:01:00 | 16,216,736k | 32% |\r\n| branch | 550 | 450 | 8:05:08 | 2,818,072k | 8.8% |\r\n| master | 10000 | 5000 | 8:19:59 | 2,962,752k | - |\r\n| branch | 10000 | 5000| 5:56:39 | 6,179,764k | 28.8% |\r\n| master | 0 | 16384 | 4:51:53 | 14,726,408k | - |\r\n| branch | 0 | 16384 | 4:43:11 | 16,526,348k | 2.7% |\r\n| master | 0 | 450 | 7:08:07 | 3,005,892k | - |\r\n| branch | 0 | 450 | 6:57:24 | 3,013,556k |2.6%|\r\n\r\nWhile the 2 pointers add memory to each cache entry, it did not slow down IBD. For non-pruned IBD results were similar for this branch and master. A non-pruned IBD with full `dbcache` to tip ended up using 12% more memory, but it was also 2.7% faster somehow. Likely because the `Flush` iteration for short lived caches is faster because it also only iterates through dirty entries. For smaller `dbcache` values the `dbcache` limit is respected so does not consume more memory, and the potentially more frequent flushes were not significant enough to cause any slowdown.\r\n\r\nInspired by [this comment](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457720636).\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/11315.",
          "user": {
            "login": "andrewtoth",
            "id": 237213,
            "node_id": "MDQ6VXNlcjIzNzIxMw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andrewtoth",
            "html_url": "https://github.com/andrewtoth",
            "followers_url": "https://api.github.com/users/andrewtoth/followers",
            "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
            "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
            "repos_url": "https://api.github.com/users/andrewtoth/repos",
            "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28280",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28280",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28280.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28280.patch"
          },
          "created_at": "2023-08-16T22:38:19Z",
          "updated_at": "2024-01-25T01:37:34Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 11641026253,
      "node_id": "LOE_lADOABII584fNOyFzwAAAAK12_bN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11641026253",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-30T12:26:59Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346960653",
      "pull_request_review_id": 317801224,
      "id": 346960653,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Njk2MDY1Mw==",
      "diff_hunk": "@@ -144,8 +144,15 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = mapCoins.erase(it)) {\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {\n+    auto iter_fnc = [&mapCoins, erase](CCoinsMap::iterator it) {\n+        if (erase) {\n+            return mapCoins.erase(it);\n+        } else {\n+            return it++;\n+        }\n+    };",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 31,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "bd44f51d790edc07b7e1224e0f8bfce4252c74d5",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could use the ternary operator instead for less code and no captures?\r\n\r\n```cpp\r\nfor ( ... ; it = erase ? mapCoins.erase(it) : ++it) {",
      "created_at": "2019-11-15T18:45:55Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r346960653",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346960653"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346999363",
      "pull_request_review_id": 317853720,
      "id": 346999363,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0Njk5OTM2Mw==",
      "diff_hunk": "@@ -275,7 +275,7 @@ class CCoinsViewCache : public CCoinsViewBacked\n      * Failure to call this method before destruction will cause the changes to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n-    bool Flush();\n+    bool Flush(bool clear_cache = true);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 32,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "bd44f51d790edc07b7e1224e0f8bfce4252c74d5",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Isn't passing the argument explicitly better than with a default one? Also it's worthy to extend method comment a bit with effect of argument on cache.",
      "created_at": "2019-11-15T20:30:51Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r346999363",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/346999363"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 278,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/353418761",
      "pull_request_review_id": 326444938,
      "id": 353418761,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1MzQxODc2MQ==",
      "diff_hunk": "@@ -202,10 +202,24 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n-    cacheCoins.clear();\n-    cachedCoinsUsage = 0;\n+bool CCoinsViewCache::Flush(bool clear_cache) {\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ clear_cache);\n+    if (clear_cache) {\n+        cacheCoins.clear();\n+        cachedCoinsUsage = 0;\n+    } else {\n+        // Instead of clearing the cache, just clear the FRESH/DIRTY\n+        // flags, and erase any spent coins\n+        for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 63,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1e68aad46ed122c85ed60e1529c6cf512bbefa86",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it true that this loop is very slow with high dbcache? If so, a comment would be appropriate.\r\n\r\nOther than that I also agree with @ryanofsky comment to have \"separate methods like Flush() and Sync() or Flush() and Write()\". As a rule of thumb, if two functions have a completely different implementation, they should not be bundled in one and switched by a boolean.",
      "created_at": "2019-12-03T21:00:29Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r353418761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/353418761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 213,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/353872539",
      "pull_request_review_id": 327012115,
      "id": 353872539,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM1Mzg3MjUzOQ==",
      "diff_hunk": "@@ -202,10 +202,24 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n     return true;\n }\n \n-bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n-    cacheCoins.clear();\n-    cachedCoinsUsage = 0;\n+bool CCoinsViewCache::Flush(bool clear_cache) {\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ clear_cache);\n+    if (clear_cache) {\n+        cacheCoins.clear();\n+        cachedCoinsUsage = 0;\n+    } else {\n+        // Instead of clearing the cache, just clear the FRESH/DIRTY\n+        // flags, and erase any spent coins\n+        for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 63,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1e68aad46ed122c85ed60e1529c6cf512bbefa86",
      "in_reply_to_id": 353418761,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In my own benchmarking, I haven't seen anything to support the notion that this loop takes a long time. In the newest benchmarks (to be posted), calling `Flush(erase=true)` on a cache of size 3826 MB takes **7:17** and calling `Flush(erase=false)` on a cache of the same size takes **6:03** so the difference is either negligible or favorable. \r\n\r\nI got the times by subtracting timestamps from the last and second-to-last loglines below for each branch during snapshot activation.\r\n\r\n### Before this change\r\n```\r\n2019-12-03T23:18:26Z [snapshot] 63000000 coins loaded (99.39%, 3826 MB)\r\n2019-12-03T23:18:26Z [snapshot] loaded 63389760 (3877 MB) coins from snapshot 00000000000000000007316856900e76b4f7a9139cfbfba89842c8d196cd5f91\r\n2019-12-03T23:18:26Z [snapshot] flushing snapshot chainstate to disk\r\n2019-12-03T23:25:43Z [snapshot] validated snapshot (592 MB)\r\n```\r\n\r\n### After this change\r\n```\r\n2019-12-03T23:48:09Z [snapshot] 63000000 coins loaded (99.39%, 3826 MB)\r\n2019-12-03T23:48:10Z [snapshot] loaded 63389760 (3877 MB) coins from snapshot 00000000000000000007316856900e76b4f7a9139cfbfba89842c8d196cd5f91\r\n2019-12-03T23:48:10Z [snapshot] flushing snapshot chainstate to disk\r\n2019-12-03T23:54:13Z [snapshot] validated snapshot (3877 MB)\r\n```\r\n\r\n---\r\n\r\nI'll make the Flush() + Sync() change.",
      "created_at": "2019-12-04T17:10:23Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r353872539",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/353872539"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 213,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372353051",
      "pull_request_review_id": 350067640,
      "id": 372353051,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1MzA1MQ==",
      "diff_hunk": "@@ -150,9 +150,16 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n             bool test_havecoin_after = InsecureRandBits(2) == 0;\n \n             bool result_havecoin = test_havecoin_before ? stack.back()->HaveCoin(COutPoint(txid, 0)) : false;\n-            const Coin& entry = (InsecureRandRange(500) == 0) ? AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\n+\n+            // Infrequently, test usage of AccessByTxid instead of AccessCoin - the\n+            // former just delegates to the latter and returns the first unspent in a txn.",
      "path": "src/test/coins_tests.cpp",
      "position": 35,
      "original_position": 7,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "640861a52a7d2ad6f9f1242946ad43ba20e8a9d7",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `COutPoint(txid, 0)` doesn't exist and `COutPoint(txid, 0)` does, then `AccessByTxid` will randomly behave different from `AccessCoin`. But the coins are random anyway.",
      "created_at": "2020-01-29T12:26:12Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r372353051",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372353051"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372393219",
      "pull_request_review_id": 350067640,
      "id": 372393219,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM5MzIxOQ==",
      "diff_hunk": "@@ -223,14 +223,18 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n             // Every 100 iterations, flush an intermediate cache\n             if (stack.size() > 1 && InsecureRandBool() == 0) {\n                 unsigned int flushIndex = InsecureRandRange(stack.size() - 1);\n-                BOOST_CHECK(stack[flushIndex]->Flush());\n+                bool should_erase = InsecureRandRange(4) < 3;\n+                BOOST_CHECK(should_erase ? stack[flushIndex]->Flush() : stack[flushIndex]->Sync());\n+                flushed_without_erase |= !should_erase;\n             }\n         }\n         if (InsecureRandRange(100) == 0) {\n             // Every 100 iterations, change the cache stack.\n             if (stack.size() > 0 && InsecureRandBool() == 0) {\n                 //Remove the top cache\n-                BOOST_CHECK(stack.back()->Flush());\n+                bool should_erase = InsecureRandRange(4) < 3;",
      "path": "src/test/coins_tests.cpp",
      "position": 96,
      "original_position": 43,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "b12c4b092de159a38342fb7069cd1903bf5ce680",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Comment above should be \"Flush or sync the top cache\". Are you sure this test is working as advertised? What does `delete stack.back();` and  `stack.pop_back();` do here? Making them conditional doesn't break the test.",
      "created_at": "2020-01-29T13:52:42Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r372393219",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372393219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372404143",
      "pull_request_review_id": 350067640,
      "id": 372404143,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQwNDE0Mw==",
      "diff_hunk": "@@ -878,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: \"either ... and\"?",
      "created_at": "2020-01-29T14:12:52Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r372404143",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/372404143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 909,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377374863",
      "pull_request_review_id": 356335551,
      "id": 377374863,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NDg2Mw==",
      "diff_hunk": "@@ -203,12 +203,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 60,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is simply copying the pattern of `Flush()`, but `BatchWrite()` never returns `false`, so this parameter does nothing. I think all three functions should be cleaned up to not return anything so that the calling pattern is clear, but that can be done in a follow-up PR.",
      "created_at": "2020-02-10T23:18:05Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r377374863",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377374863"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377375703",
      "pull_request_review_id": 356335551,
      "id": 377375703,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NTcwMw==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 171,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: \"Hack to allow flushing\" isn't very illuminating. Perhaps \"A cache's hashBlock must be filled before flushing to disk. That's normally done in connect/disconnect block. Do it manually here\"",
      "created_at": "2020-02-10T23:20:36Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r377375703",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377375703"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 936,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377375875",
      "pull_request_review_id": 356335551,
      "id": 377375875,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NTg3NQ==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 245,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I don't think pruned is the right terminolgy, but this can be cleaned up with all the rest in a future PR.",
      "created_at": "2020-02-10T23:21:08Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r377375875",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377375875"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1010,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377376396",
      "pull_request_review_id": 356335551,
      "id": 377376396,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NjM5Ng==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 285,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this should say \"ensure that a FRESH spent coin is deleted by Sync()\". If the coin is FRESH but not spent, then a `Sync()` won't delete it.",
      "created_at": "2020-02-10T23:22:39Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r377376396",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377376396"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1050,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377376708",
      "pull_request_review_id": 356335551,
      "id": 377376708,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NjcwOA==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    // Add and spend from same cache without flushing.\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+\n+    // Coin should be FRESH in the cache.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // Base shouldn't have seen coin.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    BOOST_CHECK(all_caches[0]->SpendCoin(outp));\n+    all_caches[0]->Sync();\n+\n+    // Ensure there is no sign of the coin after spend/flush.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, ABSENT);\n+    BOOST_CHECK_EQUAL(flags, NO_ENTRY);",
      "path": "src/test/coins_tests.cpp",
      "position": 302,
      "original_position": 311,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I don't think we need these three lines. Just checking that `HaveCoinInCache()` fails is enough to show that the coin doesn't exist in the cache.",
      "created_at": "2020-02-10T23:23:39Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r377376708",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/377376708"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": 1071,
      "original_start_line": 1058,
      "start_side": "RIGHT",
      "line": 1073,
      "original_line": 1073,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/379682087",
      "pull_request_review_id": 359265516,
      "id": 379682087,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY4MjA4Nw==",
      "diff_hunk": "@@ -878,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();",
      "path": "src/test/coins_tests.cpp",
      "position": 164,
      "original_position": 63,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I like the naming destinction between `Sync()` and `Flush()` in the code because it made it easier to parse and that naming could have been used more here in the test as well. Now the destinction it is kind of hidden behind this `do_erasing_flush` parameter.  There could have been a `sync_all` helper method for example. But it's probably not worth the effort of changing now.",
      "created_at": "2020-02-14T23:00:56Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r379682087",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/379682087"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 935,
      "original_line": 935,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/379689269",
      "pull_request_review_id": 359265516,
      "id": 379689269,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY4OTI2OQ==",
      "diff_hunk": "@@ -203,12 +203,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\n+    // Instead of clearing the cache, just clear the FRESH/DIRTY",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "b2abb396c64e96585a0c38a269372b35cced08bd",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: If I look at this comment outside of the context of this PR \"Instead of clearing the cache\" might not make much sense because there is no cache clearing going on inside of this function and the relation to `Flush()` may not be immediately clear.",
      "created_at": "2020-02-14T23:33:25Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r379689269",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/379689269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 226,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402037193",
      "pull_request_review_id": 386091788,
      "id": 402037193,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAzNzE5Mw==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is the `std::move` gain really worth the added code complexity here?",
      "created_at": "2020-04-02T03:52:16Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r402037193",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402037193"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402040674",
      "pull_request_review_id": 386095540,
      "id": 402040674,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0MDY3NA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This has no effect, I think. All std::move does is cast to an rvalue reference. The ternary operator merges it back to the same type with the other branch.",
      "created_at": "2020-04-02T04:08:04Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r402040674",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/402040674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403710128",
      "pull_request_review_id": 387825369,
      "id": 403710128,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMDEyOA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It is indeed required. Try recompiling without this change and running the coins tests (`./src/test/test_bitcoin -t coins_tests`).\r\n\r\nThe std::move is necessary to erase the contents of the map being written to the parent.",
      "created_at": "2020-04-05T14:33:52Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403710128",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403710128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403738538",
      "pull_request_review_id": 387846183,
      "id": 403738538,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzczODUzOA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jamesob The `std::move` here has no effect; it is equivalent to `entry.coin = it->second.coin`. If you want to conditionally move, you need two separate statements.",
      "created_at": "2020-04-05T18:20:33Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403738538",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403738538"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403740488",
      "pull_request_review_id": 387847780,
      "id": 403740488,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0MDQ4OA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Did you actually try recompiling with your suggested change and running the tests? The result on my platform (`gcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0`) is failure.",
      "created_at": "2020-04-05T18:37:43Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403740488",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403740488"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403742681",
      "pull_request_review_id": 387849448,
      "id": 403742681,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0MjY4MQ==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jamesob It sounds like you're relying on the side effect of the moved-from object being cleared or something, but AFAIK it is in fact left in an undefined state...\r\n\r\nProbably should just copy and explicitly clear.",
      "created_at": "2020-04-05T18:56:44Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403742681",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403742681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743080",
      "pull_request_review_id": 387849763,
      "id": 403743080,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0MzA4MA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It seems I'm wrong; your code is correct.\r\n\r\nApparently what happens in this case is that a temporary variable is created, which `it->second.coin` is either copied or moved to (depending on `erase`), and then that temporary variable is move-assigned to `entry.coin`. This has the desired effect, though there is possibly an unnecessary (but cheap) move.\r\n\r\nIf you write it as\r\n\r\n```c++\r\nif (erase) {\r\n    entry.coin = std::move(it->second.coin);\r\n} else {\r\n    entry.coin = it->second.coin;\r\n}\r\n```\r\n\r\nI think you get the same semantics, but without the additional move.",
      "created_at": "2020-04-05T19:00:17Z",
      "updated_at": "2020-08-01T20:16:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403743080",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743080"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743513",
      "pull_request_review_id": 387850119,
      "id": 403743513,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0MzUxMw==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@luke-jr Well, the only member with move semantics is CScript, which is a prevector, and move assigning is well defined (it's in our own code), namely swapping.",
      "created_at": "2020-04-05T19:04:11Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403743513",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743513"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743776",
      "pull_request_review_id": 387850351,
      "id": 403743776,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0Mzc3Ng==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Abstractly, it is undefined, and `std::move` AFAIK does not guarantee move assignment, only allows it?",
      "created_at": "2020-04-05T19:06:35Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403743776",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403743776"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403744322",
      "pull_request_review_id": 387850787,
      "id": 403744322,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc0NDMyMg==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@luke-jr `std::move` just casts to an rvalue reference, nothing else. It's up to the involved classes to define what to do when assigned with or constructed from an rvalue.\r\n\r\nThe standard also defines what standard library classes do in this case: moved-from objects are in a valid but unspecified state (which means that you're only allowed to run operations on them that have no preconditions; e.g. empty() on them or assigning to them is ok).\r\n\r\nHowever, no standard library classes are involved here, so it doesn't apply.\r\n\r\nI agree with you insofar that if the desired effect is clearing, the code should just explicitly clear (potentially after a move, if that's more efficient). But it isn't UB to rely on the rvalue semantics of a class we defined ourselves.",
      "created_at": "2020-04-05T19:11:26Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r403744322",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/403744322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427429354",
      "pull_request_review_id": 414611820,
      "id": 427429354,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQyOTM1NA==",
      "diff_hunk": "@@ -214,12 +214,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\n+    // Instead of clearing the cache, just clear the FRESH/DIRTY\n+    // flags, and erase any spent coins\n+    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\n+        it->second.flags = 0;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: it seems a bit odd to clear the flags immediately before deleting in the case where the coin is spent. If you retouch this PR, the flag clearing can be moved into the else branch below.\r\n\r\nYou might also want to update the comment to reflect that change: \"Erase any spent coins and clear the FRESH/DIRTY flags for unspent coins\".",
      "created_at": "2020-05-19T16:18:00Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427429354",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427429354"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427435879",
      "pull_request_review_id": 414611820,
      "id": 427435879,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzNTg3OQ==",
      "diff_hunk": "@@ -116,7 +116,9 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n         }\n         count++;\n         CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        if (erase) {",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: I think it'd be clearer to avoid this use-once local variable by using the same pattern that you used in coins.cpp:\r\n\r\n```\r\nit = erase ? mapCoins.erase(it) : ++it;\r\n```",
      "created_at": "2020-05-19T16:27:41Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427435879",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427435879"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427454512",
      "pull_request_review_id": 414643354,
      "id": 427454512,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ1NDUxMg==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I like sipa's alternative.\r\n\r\nFWIW I also get a flood of errors when using `entry.coin = std::move(it->second.coin);` with `erase = false`. Conversely if I drop `std::move` it works fine, but I haven't looked at performance. In other words, we're not depending on some side-effect `std::move`, it's just a performance enhancer. ",
      "created_at": "2020-05-19T16:55:49Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427454512",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427454512"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427508528",
      "pull_request_review_id": 414643354,
      "id": 427508528,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwODUyOA==",
      "diff_hunk": "@@ -214,12 +214,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\n+    // Instead of clearing the cache, just clear the FRESH/DIRTY\n+    // flags, and erase any spent coins\n+    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\n+        it->second.flags = 0;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": 427429354,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Agreed. In addition, let's not assume there won't be new flags in the future, so maybe clear the `FRESH/DIRTY` flags explicitly with an `=&`?",
      "created_at": "2020-05-19T18:21:24Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427508528",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427508528"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427509760",
      "pull_request_review_id": 414643354,
      "id": 427509760,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwOTc2MA==",
      "diff_hunk": "@@ -297,12 +297,22 @@ class CCoinsViewCache : public CCoinsViewBacked\n     bool SpendCoin(const COutPoint &outpoint, Coin* moveto = nullptr);\n \n     /**\n-     * Push the modifications applied to this cache to its base.\n-     * Failure to call this method before destruction will cause the changes to be forgotten.\n+     * Push the modifications applied to this cache to its base and wipe local state.\n+     * Failure to call this method or Sync() before destruction will cause the changes\n+     * to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n     bool Flush();\n \n+    /**\n+     * Push the modifications applied to this cache to its base while retaining\n+     * the contents of this cache.",
      "path": "src/coins.h",
      "position": null,
      "original_position": 42,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "d5f4f7bcdb5e18702fcdcbaff922ce9c8f9f5654",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: `* the contents of this cache except for FRESH spent coins.`",
      "created_at": "2020-05-19T18:23:34Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427509760",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427509760"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427512576",
      "pull_request_review_id": 414643354,
      "id": 427512576,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUxMjU3Ng==",
      "diff_hunk": "@@ -116,7 +116,9 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n         }\n         count++;\n         CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        if (erase) {",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": 427435879,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Does this need an exception, to always delete `FRESH` spent coins? Or those can't exist at this level? ",
      "created_at": "2020-05-19T18:28:26Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427512576",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427512576"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427517198",
      "pull_request_review_id": 414643354,
      "id": 427517198,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUxNzE5OA==",
      "diff_hunk": "@@ -168,24 +175,29 @@ void SimulationTest(CCoinsView* base, bool fake_best_block)\n                 Coin newcoin;\n                 newcoin.out.nValue = InsecureRand32();\n                 newcoin.nHeight = 1;\n+\n+                // Infrequently test adding unspendable coins.\n                 if (InsecureRandRange(16) == 0 && coin.IsSpent()) {\n                     newcoin.out.scriptPubKey.assign(1 + InsecureRandBits(6), OP_RETURN);\n                     BOOST_CHECK(newcoin.out.scriptPubKey.IsUnspendable());\n                     added_an_unspendable_entry = true;\n                 } else {\n-                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 0); // Random sizes so we can test memory usage accounting\n+                    // Random sizes so we can test memory usage accounting\n+                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 1);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "f2abc6338204c8f593fb4d1c7d220270b7171b35",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Why did you switch the second argument of `assign` to `1`?",
      "created_at": "2020-05-19T18:36:17Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427517198",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427517198"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 186,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427525125",
      "pull_request_review_id": 414643354,
      "id": 427525125,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUyNTEyNQ==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 171,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377375703,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "[nit bump](https://github.com/bitcoin/bitcoin/pull/17487/commits/8bb1163805121b2863fef1c16c9b104803e8dfdd#r377375703)",
      "created_at": "2020-05-19T18:49:26Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427525125",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427525125"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 936,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427526583",
      "pull_request_review_id": 414643354,
      "id": 427526583,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUyNjU4Mw==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 285,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377376396,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "[nit bump](https://github.com/bitcoin/bitcoin/pull/17487/commits/8bb1163805121b2863fef1c16c9b104803e8dfdd#r377376396)",
      "created_at": "2020-05-19T18:51:55Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r427526583",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/427526583"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1050,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432012334",
      "pull_request_review_id": 420347257,
      "id": 432012334,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxMjMzNA==",
      "diff_hunk": "@@ -223,14 +223,18 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n             // Every 100 iterations, flush an intermediate cache\n             if (stack.size() > 1 && InsecureRandBool() == 0) {\n                 unsigned int flushIndex = InsecureRandRange(stack.size() - 1);\n-                BOOST_CHECK(stack[flushIndex]->Flush());\n+                bool should_erase = InsecureRandRange(4) < 3;\n+                BOOST_CHECK(should_erase ? stack[flushIndex]->Flush() : stack[flushIndex]->Sync());\n+                flushed_without_erase |= !should_erase;\n             }\n         }\n         if (InsecureRandRange(100) == 0) {\n             // Every 100 iterations, change the cache stack.\n             if (stack.size() > 0 && InsecureRandBool() == 0) {\n                 //Remove the top cache\n-                BOOST_CHECK(stack.back()->Flush());\n+                bool should_erase = InsecureRandRange(4) < 3;",
      "path": "src/test/coins_tests.cpp",
      "position": 96,
      "original_position": 43,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "b12c4b092de159a38342fb7069cd1903bf5ce680",
      "in_reply_to_id": 372393219,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, the point is to exercise cases where we do delete/pop parts of the cache stack - the test should pass in any case.",
      "created_at": "2020-05-28T17:43:04Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432012334",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432012334"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432014219",
      "pull_request_review_id": 420349660,
      "id": 432014219,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNDIxOQ==",
      "diff_hunk": "@@ -150,9 +150,16 @@ BOOST_AUTO_TEST_CASE(coins_cache_simulation_test)\n             bool test_havecoin_after = InsecureRandBits(2) == 0;\n \n             bool result_havecoin = test_havecoin_before ? stack.back()->HaveCoin(COutPoint(txid, 0)) : false;\n-            const Coin& entry = (InsecureRandRange(500) == 0) ? AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\n+\n+            // Infrequently, test usage of AccessByTxid instead of AccessCoin - the\n+            // former just delegates to the latter and returns the first unspent in a txn.",
      "path": "src/test/coins_tests.cpp",
      "position": 35,
      "original_position": 7,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "640861a52a7d2ad6f9f1242946ad43ba20e8a9d7",
      "in_reply_to_id": 372353051,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't understand the original comment - is there a typo in one of your `COutPoint`s?",
      "created_at": "2020-05-28T17:46:24Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432014219",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432014219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432015340",
      "pull_request_review_id": 420349660,
      "id": 432015340,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNTM0MA==",
      "diff_hunk": "@@ -168,24 +175,29 @@ void SimulationTest(CCoinsView* base, bool fake_best_block)\n                 Coin newcoin;\n                 newcoin.out.nValue = InsecureRand32();\n                 newcoin.nHeight = 1;\n+\n+                // Infrequently test adding unspendable coins.\n                 if (InsecureRandRange(16) == 0 && coin.IsSpent()) {\n                     newcoin.out.scriptPubKey.assign(1 + InsecureRandBits(6), OP_RETURN);\n                     BOOST_CHECK(newcoin.out.scriptPubKey.IsUnspendable());\n                     added_an_unspendable_entry = true;\n                 } else {\n-                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 0); // Random sizes so we can test memory usage accounting\n+                    // Random sizes so we can test memory usage accounting\n+                    newcoin.out.scriptPubKey.assign(InsecureRandBits(6), 1);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "f2abc6338204c8f593fb4d1c7d220270b7171b35",
      "in_reply_to_id": 427517198,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good question... can't remember doing that. Will revert.",
      "created_at": "2020-05-28T17:48:24Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432015340",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432015340"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 186,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432016064",
      "pull_request_review_id": 420349660,
      "id": 432016064,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNjA2NA==",
      "diff_hunk": "@@ -878,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 35,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 372404143,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2020-05-28T17:49:51Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432016064",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432016064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 909,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017156",
      "pull_request_review_id": 420349660,
      "id": 432017156,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNzE1Ng==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 245,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377375875,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2020-05-28T17:51:50Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432017156",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017156"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1010,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017479",
      "pull_request_review_id": 420349660,
      "id": 432017479,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNzQ3OQ==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 285,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377376396,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2020-05-28T17:52:27Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432017479",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1050,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017919",
      "pull_request_review_id": 420349660,
      "id": 432017919,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNzkxOQ==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    // Add and spend from same cache without flushing.\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+\n+    // Coin should be FRESH in the cache.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // Base shouldn't have seen coin.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    BOOST_CHECK(all_caches[0]->SpendCoin(outp));\n+    all_caches[0]->Sync();\n+\n+    // Ensure there is no sign of the coin after spend/flush.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, ABSENT);\n+    BOOST_CHECK_EQUAL(flags, NO_ENTRY);",
      "path": "src/test/coins_tests.cpp",
      "position": 302,
      "original_position": 311,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377376708,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm going to keep these in because I think it's worth being painfully explicit in coins tests.",
      "created_at": "2020-05-28T17:53:18Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432017919",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432017919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": 1071,
      "original_start_line": 1058,
      "start_side": "RIGHT",
      "line": 1073,
      "original_line": 1073,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432026105",
      "pull_request_review_id": 420349660,
      "id": 432026105,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyNjEwNQ==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@Sjors please see above - we do rely on the `std::move` to clear the entry from the child cache, it isn't just a performance optimization. If you remove the `move`, the coins unittests will fail.\r\n\r\nThat said I agree it seems tricky to rely upon this behavior implicitly based upon classes we've define ourselves, but I haven't tested the performance implications of adding `mapCoins.erase(it)`. Given that I'm essentially leaving the behavior as it was before this change in the case of the `move`, and we have unittests that will catch a change in behavior here, I don't feel the need to add an explicit `erase()` call. I have however clarified the phrasing with an explicit if-else as @sipa suggests.",
      "created_at": "2020-05-28T18:08:19Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432026105",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432026105"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432026636",
      "pull_request_review_id": 420349660,
      "id": 432026636,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyNjYzNg==",
      "diff_hunk": "@@ -203,12 +203,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\n+    // Instead of clearing the cache, just clear the FRESH/DIRTY",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "b2abb396c64e96585a0c38a269372b35cced08bd",
      "in_reply_to_id": 379689269,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "rephrased",
      "created_at": "2020-05-28T18:09:20Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432026636",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432026636"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 226,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432027751",
      "pull_request_review_id": 420349660,
      "id": 432027751,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyNzc1MQ==",
      "diff_hunk": "@@ -214,12 +214,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ false);\n+    // Instead of clearing the cache, just clear the FRESH/DIRTY\n+    // flags, and erase any spent coins\n+    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {\n+        it->second.flags = 0;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 64,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": 427429354,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2020-05-28T18:11:21Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432027751",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432027751"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 229,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432028244",
      "pull_request_review_id": 420349660,
      "id": 432028244,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAyODI0NA==",
      "diff_hunk": "@@ -297,12 +297,22 @@ class CCoinsViewCache : public CCoinsViewBacked\n     bool SpendCoin(const COutPoint &outpoint, Coin* moveto = nullptr);\n \n     /**\n-     * Push the modifications applied to this cache to its base.\n-     * Failure to call this method before destruction will cause the changes to be forgotten.\n+     * Push the modifications applied to this cache to its base and wipe local state.\n+     * Failure to call this method or Sync() before destruction will cause the changes\n+     * to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n     bool Flush();\n \n+    /**\n+     * Push the modifications applied to this cache to its base while retaining\n+     * the contents of this cache.",
      "path": "src/coins.h",
      "position": null,
      "original_position": 42,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "d5f4f7bcdb5e18702fcdcbaff922ce9c8f9f5654",
      "in_reply_to_id": 427509760,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fixed",
      "created_at": "2020-05-28T18:12:12Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432028244",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432028244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432039014",
      "pull_request_review_id": 420349660,
      "id": 432039014,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAzOTAxNA==",
      "diff_hunk": "@@ -116,7 +116,9 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n         }\n         count++;\n         CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        if (erase) {",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8bb1163805121b2863fef1c16c9b104803e8dfdd",
      "in_reply_to_id": 427435879,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good suggestion, thanks! Fixed.\r\n\r\n`FRESH` spent coins won't exist here because they will have been removed from the child cache first - for proof of this note that nothing calls `CCoinsViewDB::BatchWrite()` aside from CCoinsViewCache, and `SpendCoin()` only exists on CCoinsViewCache instances.",
      "created_at": "2020-05-28T18:31:58Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432039014",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432039014"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432067601",
      "pull_request_review_id": 420419755,
      "id": 432067601,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA2NzYwMQ==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> If you remove the move, the coins unittests will fail.\r\n\r\nOdd, I tried that. Will try again.",
      "created_at": "2020-05-28T19:25:01Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432067601",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432067601"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432088620",
      "pull_request_review_id": 420447855,
      "id": 432088620,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4ODYyMA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Odd, I tried that. Will try again.\r\n\r\nPerhaps you made the change in the relevant commit, but then didn't apply subsequent commits including the new tests? Just a guess.",
      "created_at": "2020-05-28T19:58:51Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432088620",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432088620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432101304",
      "pull_request_review_id": 420462970,
      "id": 432101304,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEwMTMwNA==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "FWIW I did try this before acking. I checked out this branch and changed the ternary to just use the copy assignment and the tests errored out. Will try again with updated commits.",
      "created_at": "2020-05-28T20:22:07Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432101304",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432101304"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432161196",
      "pull_request_review_id": 420538803,
      "id": 432161196,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE2MTE5Ng==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jnewbery has found that I was wrong - the std::move invocation isn't necessary for correctness, it's just an optimization. Thanks for pointing that out @Sjors. Will remove the new comment.",
      "created_at": "2020-05-28T22:34:49Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432161196",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432161196"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432221525",
      "pull_request_review_id": 420611467,
      "id": 432221525,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIyMTUyNQ==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Since this has caused so much confusion, I think it'd be better to update the comment than remove it entirely. Perhaps something like:\r\n\r\n```\r\n// We'll erase this entry from the map in the for increase expression.\r\n// Move the coin to the parent cache instead of copying as an optimization.",
      "created_at": "2020-05-29T02:21:45Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432221525",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432221525"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432902077",
      "pull_request_review_id": 421455405,
      "id": 432902077,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMjA3Nw==",
      "diff_hunk": "@@ -199,7 +205,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n             } else {\n                 // A normal modification.\n                 cachedCoinsUsage -= itUs->second.coin.DynamicMemoryUsage();\n-                itUs->second.coin = std::move(it->second.coin);\n+                itUs->second.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 49,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1ce5cd389f286627412bc5edc6cb34006b65ec0b",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should this also be updated to use an `if/else` block instead of a ternary like above?",
      "created_at": "2020-05-31T01:56:31Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432902077",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432902077"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432957388",
      "pull_request_review_id": 421504390,
      "id": 432957388,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NzM4OA==",
      "diff_hunk": "@@ -199,7 +205,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n             } else {\n                 // A normal modification.\n                 cachedCoinsUsage -= itUs->second.coin.DynamicMemoryUsage();\n-                itUs->second.coin = std::move(it->second.coin);\n+                itUs->second.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 49,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1ce5cd389f286627412bc5edc6cb34006b65ec0b",
      "in_reply_to_id": 432902077,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch. ",
      "created_at": "2020-05-31T15:23:16Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432957388",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432957388"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432989748",
      "pull_request_review_id": 421532480,
      "id": 432989748,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4OTc0OA==",
      "diff_hunk": "@@ -199,7 +206,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n             } else {\n                 // A normal modification.\n                 cachedCoinsUsage -= itUs->second.coin.DynamicMemoryUsage();\n-                itUs->second.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` predicate to actually remove",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 52,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "fdc1d80ce4348687ca87d544e8efe40e5344f5d3",
      "in_reply_to_id": null,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: the third part of the for loop is an expression, not a predicate (more precisely, the _increase_ or _iteration_ expression). A predicate is a function which returns true/false.",
      "created_at": "2020-05-31T22:12:47Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r432989748",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/432989748"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 211,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433210377",
      "pull_request_review_id": 421810809,
      "id": 433210377,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIxMDM3Nw==",
      "diff_hunk": "@@ -158,7 +158,7 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Otherwise we will need to create it in the parent\n                 // and move the data up and mark it as dirty\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                entry.coin = erase ? std::move(it->second.coin) : it->second.coin;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 402037193,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Pfew, I'm not insane :-) Thanks for adding the comment.",
      "created_at": "2020-06-01T12:41:01Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r433210377",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433210377"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 174,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433520706",
      "pull_request_review_id": 422221355,
      "id": 433520706,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzUyMDcwNg==",
      "diff_hunk": "@@ -861,4 +879,207 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance and\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            cache->SetBestBlock(InsecureRand256());  // Hack to allow flushing.\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but pruned and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, PRUNED);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH coin is deleted by Sync()\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    // Add and spend from same cache without flushing.\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+\n+    // Coin should be FRESH in the cache.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // Base shouldn't have seen coin.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    BOOST_CHECK(all_caches[0]->SpendCoin(outp));\n+    all_caches[0]->Sync();\n+\n+    // Ensure there is no sign of the coin after spend/flush.\n+    GetCoinsMapEntry(all_caches[0]->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, ABSENT);\n+    BOOST_CHECK_EQUAL(flags, NO_ENTRY);",
      "path": "src/test/coins_tests.cpp",
      "position": 302,
      "original_position": 311,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "eebaca7620bbd0af0ec385c6c7d47b2b4b524d55",
      "in_reply_to_id": 377376708,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If `HaveCoinInCache()` isn't explicit enough, should it be removed from lower in the test, or is that different somehow?",
      "created_at": "2020-06-01T22:21:19Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r433520706",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433520706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": 1071,
      "original_start_line": 1058,
      "start_side": "RIGHT",
      "line": 1073,
      "original_line": 1073,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433961320",
      "pull_request_review_id": 422790091,
      "id": 433961320,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2MTMyMA==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Should `++it` be outside the ternary conditional here?",
      "created_at": "2020-06-02T15:23:51Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r433961320",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/433961320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434003002",
      "pull_request_review_id": 422840668,
      "id": 434003002,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwMzAwMg==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 433961320,
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No. `std::unordered_map::erase()` returns an iterator to the next item in the map: https://en.cppreference.com/w/cpp/container/unordered_map/erase.",
      "created_at": "2020-06-02T16:13:15Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434003002",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434003002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434005792",
      "pull_request_review_id": 422844267,
      "id": 434005792,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwNTc5Mg==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 433961320,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh -- and it appears to be a convention. Thanks @jnewbery.",
      "created_at": "2020-06-02T16:17:42Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434005792",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434005792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434011129",
      "pull_request_review_id": 422851560,
      "id": 434011129,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxMTEyOQ==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 433961320,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`it = ++it;` is kind of strange though. How about `it = mapCoins.erase(it) : std::next(it);` ?",
      "created_at": "2020-06-02T16:26:09Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434011129",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434011129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434729703",
      "pull_request_review_id": 423768662,
      "id": 434729703,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyOTcwMw==",
      "diff_hunk": "@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\n+                    // the entry from the child map.\n+                    entry.coin = std::move(it->second.coin);",
      "path": "src/coins.cpp",
      "position": 40,
      "original_position": 38,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thinking about this more, is it not more than a pure optimization? If we copy instead of move, then we are increasing the memory footprint of our dbcache. For a large batch write won't all dirty entries exist in memory twice, potentially increasing the memory requirements of the node temporarily until the parent cache writes to disk?",
      "created_at": "2020-06-03T17:18:09Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434729703",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434729703"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434751546",
      "pull_request_review_id": 423796998,
      "id": 434751546,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc1MTU0Ng==",
      "diff_hunk": "@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\n+                    // the entry from the child map.\n+                    entry.coin = std::move(it->second.coin);",
      "path": "src/coins.cpp",
      "position": 40,
      "original_position": 38,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 434729703,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@andrewtoth I think this is offset by the fact that we're erasing as we iterate through the map, so coins will only be duplicated in memory one by one. But that's a good consideration, thanks for raising the point.",
      "created_at": "2020-06-03T17:55:44Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434751546",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434751546"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434751700",
      "pull_request_review_id": 423797199,
      "id": 434751700,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc1MTcwMA==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 433961320,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Will change if I rebase.",
      "created_at": "2020-06-03T17:56:01Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434751700",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434751700"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434763783",
      "pull_request_review_id": 423812734,
      "id": 434763783,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc2Mzc4Mw==",
      "diff_hunk": "@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\n+                    // the entry from the child map.\n+                    entry.coin = std::move(it->second.coin);",
      "path": "src/coins.cpp",
      "position": 40,
      "original_position": 38,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 434729703,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jamesob For this change we are no longer erasing as we iterate through the map, and also copying, right? For a `Sync()` with a large amount of dirty entries won't this cause memory usage to increase?",
      "created_at": "2020-06-03T18:17:08Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434763783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434763783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434892478",
      "pull_request_review_id": 423981011,
      "id": 434892478,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5MjQ3OA==",
      "diff_hunk": "@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\n+                    // the entry from the child map.\n+                    entry.coin = std::move(it->second.coin);",
      "path": "src/coins.cpp",
      "position": 40,
      "original_position": 38,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 434729703,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm ok I guess I'm missing how we're erasing during the iteration with `erase=false`. I tested a reindex-chainstate with max dbcache and did a `Sync` instead of `Flush` on shutdown, and it didn't increase memory usage at all when syncing. LGTM.",
      "created_at": "2020-06-03T22:28:02Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r434892478",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/434892478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435526117",
      "pull_request_review_id": 424798429,
      "id": 435526117,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUyNjExNw==",
      "diff_hunk": "@@ -171,7 +171,14 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n                 // Create the coin in the parent cache, move the data up\n                 // and mark it as dirty.\n                 CCoinsCacheEntry& entry = cacheCoins[it->first];\n-                entry.coin = std::move(it->second.coin);\n+                if (erase) {\n+                    // The `move` call here is purely an optimization; we rely on the\n+                    // `mapCoins.erase` call in the `for` expression to actually remove\n+                    // the entry from the child map.\n+                    entry.coin = std::move(it->second.coin);",
      "path": "src/coins.cpp",
      "position": 40,
      "original_position": 38,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 434729703,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@andrewtoth you don't see a big memory spike because in practice this implementation of `BatchWrite` is only called for small sets of coins [during `ConnectTip()`](https://github.com/jamesob/bitcoin/blob/8d5994ef2235c6706440bc18968006cd04c22fb4/src/validation.cpp#L2600-L2613) to make UTXO set changes atomic (i.e. a CCoinsViewCache on top of another CCoinsViewCache); calling `BatchWrite` for really sizable sets of coins happens on `CCoinsViewDB` (leveldb) objects (i.e. writing down from a CCoinsViewCache -> CCoinsViewDB). CCoinsViewDB doesn't have an in-memory cache (at least that we maintain) so there is no sizable duplication.\r\n\r\nBut once again, thanks for raising the point and testing.",
      "created_at": "2020-06-04T20:21:03Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r435526117",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/435526117"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 199,
      "original_line": 199,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463987009",
      "pull_request_review_id": 459595094,
      "id": 463987009,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk4NzAwOQ==",
      "diff_hunk": "@@ -297,12 +297,22 @@ class CCoinsViewCache : public CCoinsViewBacked\n     bool SpendCoin(const COutPoint &outpoint, Coin* moveto = nullptr);\n \n     /**\n-     * Push the modifications applied to this cache to its base.\n-     * Failure to call this method before destruction will cause the changes to be forgotten.\n+     * Push the modifications applied to this cache to its base and wipe local state.\n+     * Failure to call this method or Sync() before destruction will cause the changes\n+     * to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n     bool Flush();\n \n+    /**\n+     * Push the modifications applied to this cache to its base while retaining\n+     * the contents of this cache (except for FRESH spent coins, which we erase).",
      "path": "src/coins.h",
      "position": null,
      "original_position": 42,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "58616e0b8b37cae4d011062038fb6565064fe3d1",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think `except for FRESH spent coins, which we erase` is true?\r\n\r\nIf a FRESH coin is spent, it is deleted immediately, so there shouldn't be any such entries in the first place.",
      "created_at": "2020-08-01T18:21:43Z",
      "updated_at": "2020-08-01T20:16:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r463987009",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463987009"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463996447",
      "pull_request_review_id": 459601443,
      "id": 463996447,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5NjQ0Nw==",
      "diff_hunk": "@@ -297,12 +297,22 @@ class CCoinsViewCache : public CCoinsViewBacked\n     bool SpendCoin(const COutPoint &outpoint, Coin* moveto = nullptr);\n \n     /**\n-     * Push the modifications applied to this cache to its base.\n-     * Failure to call this method before destruction will cause the changes to be forgotten.\n+     * Push the modifications applied to this cache to its base and wipe local state.\n+     * Failure to call this method or Sync() before destruction will cause the changes\n+     * to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n     bool Flush();\n \n+    /**\n+     * Push the modifications applied to this cache to its base while retaining\n+     * the contents of this cache (except for FRESH spent coins, which we erase).",
      "path": "src/coins.h",
      "position": null,
      "original_position": 42,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "58616e0b8b37cae4d011062038fb6565064fe3d1",
      "in_reply_to_id": 463987009,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep, [you're right](https://github.com/jamesob/bitcoin/blob/0292b01cc4be18e5eb37563064cced7d73cd7025/src/coins.cpp#L120-L121), not sure what I was thinking there.",
      "created_at": "2020-08-01T20:17:09Z",
      "updated_at": "2020-08-01T20:17:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r463996447",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463996447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463996547",
      "pull_request_review_id": 459601537,
      "id": 463996547,
      "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5NjU0Nw==",
      "diff_hunk": "@@ -115,8 +115,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : ++it;",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "8d5994ef2235c6706440bc18968006cd04c22fb4",
      "in_reply_to_id": 433961320,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, thanks.",
      "created_at": "2020-08-01T20:18:28Z",
      "updated_at": "2020-08-01T20:18:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r463996547",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/463996547"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/767146237",
      "pull_request_review_id": 829525974,
      "id": 767146237,
      "node_id": "PRRC_kwDOABII584tubj9",
      "diff_hunk": "@@ -220,12 +234,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The following `TODO` comment in `src/validation.cpp` was removed in #23738. Making a note here so the `TODO` can be either be done in this PR or in a follow-up.\r\n```\r\n    coins_cache.Flush(); // TODO: if #17487 is merged, add erase=false here for better performance.\r\n```\r\n",
      "created_at": "2021-12-11T11:53:11Z",
      "updated_at": "2021-12-15T13:56:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r767146237",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/767146237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780710725",
      "pull_request_review_id": 847197360,
      "id": 780710725,
      "node_id": "PRRC_kwDOABII584uiLNF",
      "diff_hunk": "@@ -895,4 +895,209 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance or\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            // hashBlock must be filled before flushing to disk; value is\n+            // unimportant here. This is normally done during connect/disconnect block.\n+            cache->SetBestBlock(InsecureRand256());\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 61,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: These three variables could have been initialized here.",
      "created_at": "2022-01-08T21:39:47Z",
      "updated_at": "2022-01-09T12:23:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r780710725",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780710725"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 943,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780774706",
      "pull_request_review_id": 847197360,
      "id": 780774706,
      "node_id": "PRRC_kwDOABII584uia0y",
      "diff_hunk": "@@ -220,12 +234,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": 767146237,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Note: I found that the tests don't fail if `erase` is flipped to `false` on this line, other than in `Sync()`. The tests would need to become more granular to catch this case but it certainly has not gotten worse than from before this PR so it can be kept for a follow-up if it seems beneficial to test.",
      "created_at": "2022-01-09T12:22:39Z",
      "updated_at": "2022-01-09T12:23:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r780774706",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/780774706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073358171",
      "pull_request_review_id": 1253213780,
      "id": 1073358171,
      "node_id": "PRRC_kwDOABII584_-iVb",
      "diff_hunk": "@@ -878,4 +895,209 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance or\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            // hashBlock must be filled before flushing to disk; value is\n+            // unimportant here. This is normally done during connect/disconnect block.\n+            cache->SetBestBlock(InsecureRand256());\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(",
      "path": "src/test/coins_tests.cpp",
      "position": 227,
      "original_position": 232,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": null,
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```bash\r\ntest/coins_tests.cpp:1004:39: error: 'tmpCoin2' used after it was moved [bugprone-use-after-move,-warnings-as-errors]\r\n        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\r\n                                      ^\r\ntest/coins_tests.cpp:1004:15: note: move occurred here\r\n        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\r\n              ^\r\ntest/coins_tests.cpp:1004:39: note: the use happens in a later loop iteration than the move\r\n        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\r\n```",
      "created_at": "2023-01-18T10:29:08Z",
      "updated_at": "2023-01-18T10:32:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1073358171",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073358171"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 998,
      "original_line": 998,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073358683",
      "pull_request_review_id": 1253213780,
      "id": 1073358683,
      "node_id": "PRRC_kwDOABII584_-idb",
      "diff_hunk": "@@ -878,4 +895,209 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance or\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            // hashBlock must be filled before flushing to disk; value is\n+            // unimportant here. This is normally done during connect/disconnect block.\n+            cache->SetBestBlock(InsecureRand256());\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(\n+        view->AddCoin(outp, std::move(tmpCoin2), /*possible_overwrite*/ false),\n+        std::logic_error);\n+\n+    // --- 6. Spend the coin.\n+    //\n+    BOOST_CHECK(view->SpendCoin(outp));\n+\n+    // The coin should be in the cache, but spent and marked dirty.\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, SPENT);\n+    BOOST_CHECK_EQUAL(flags, DIRTY);\n+    BOOST_CHECK(!view->HaveCoin(outp)); // Coin should be considered spent in `view`.\n+    BOOST_CHECK(base.HaveCoin(outp));  // But coin should still be unspent in `base`.\n+\n+    flush_all(/*erase*/ false);\n+\n+    // Coin should be considered spent in both views.\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+\n+    // Spent coin should not be spendable.\n+    BOOST_CHECK(!view->SpendCoin(outp));\n+\n+    // --- Bonus check: ensure that a coin added to the base view via one cache\n+    //     can be spent by another cache which has never seen it.\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);\n+    all_caches[0]->Sync();\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoinInCache(outp));\n+\n+    BOOST_CHECK(all_caches[1]->SpendCoin(outp));\n+    flush_all(/*erase*/ false);\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    flush_all(/*erase*/ true); // Erase all cache content.\n+\n+    // --- Bonus check 2: ensure that a FRESH, spent coin is deleted by Sync()\n+    //\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[0]->HaveCoin(outp));\n+    BOOST_CHECK(!all_caches[1]->HaveCoin(outp));\n+\n+    // Add and spend from same cache without flushing.\n+    all_caches[0]->AddCoin(outp, std::move(coin), false);",
      "path": "src/test/coins_tests.cpp",
      "position": 286,
      "original_position": 290,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": null,
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```bash\r\ntest/coins_tests.cpp:1065:30: error: 'coin' used after it was moved [bugprone-use-after-move,-warnings-as-errors]\r\n    BOOST_CHECK_EQUAL(value, coin.out.nValue);\r\n                             ^\r\ntest/coins_tests.cpp:1061:20: note: move occurred here\r\n    all_caches[0]->AddCoin(outp, std::move(coin), false);\r\n                   ^\r\n```",
      "created_at": "2023-01-18T10:29:37Z",
      "updated_at": "2023-01-18T10:32:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1073358683",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073358683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1057,
      "original_line": 1057,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073360829",
      "pull_request_review_id": 1253213780,
      "id": 1073360829,
      "node_id": "PRRC_kwDOABII584_-i-9",
      "diff_hunk": "@@ -220,12 +234,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": null,
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "You can add the = to these comments so that clang-tidy will check them.\r\n```suggestion\r\n    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ true);\r\n```",
      "created_at": "2023-01-18T10:31:34Z",
      "updated_at": "2023-01-18T10:32:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1073360829",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1073360829"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082568301",
      "pull_request_review_id": 1263635473,
      "id": 1082568301,
      "node_id": "PRRC_kwDOABII585Ahq5t",
      "diff_hunk": "@@ -878,4 +895,209 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance or\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            // hashBlock must be filled before flushing to disk; value is\n+            // unimportant here. This is normally done during connect/disconnect block.\n+            cache->SetBestBlock(InsecureRand256());\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(",
      "path": "src/test/coins_tests.cpp",
      "position": 227,
      "original_position": 232,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": 1073358171,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Someone correct me if I'm wrong, but I think this is a spurious check. `tmpCoin2` is initialized fresh for every invocation in this function, and then never used again after move. Clang-tidy is throwing this error because the containing function, `TestFlushBehavior()`, is called in a loop below.",
      "created_at": "2023-01-20T13:57:03Z",
      "updated_at": "2023-01-20T13:57:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082568301",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082568301"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 998,
      "original_line": 998,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082606577",
      "pull_request_review_id": 1263685576,
      "id": 1082606577,
      "node_id": "PRRC_kwDOABII585Ah0Px",
      "diff_hunk": "@@ -878,4 +895,209 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n                     CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n }\n \n+\n+Coin MakeCoin()\n+{\n+    Coin coin;\n+    coin.out.nValue = InsecureRand32();\n+    coin.nHeight = InsecureRandRange(4096);\n+    coin.fCoinBase = 0;\n+    return coin;\n+}\n+\n+\n+//! For CCoinsViewCache instances backed by either another cache instance or\n+//! leveldb, test cache behavior and flag state (DIRTY/FRESH) by\n+//!\n+//! 1. Adding a random coin to the child-most cache,\n+//! 2. Flushing all caches (without erasing),\n+//! 3. Ensure the entry still exists in the cache and has been written to parent,\n+//! 4. (if `do_erasing_flush`) Flushing the caches again (with erasing),\n+//! 5. (if `do_erasing_flush`) Ensure the entry has been written to the parent and is no longer in the cache,\n+//! 6. Spend the coin, ensure it no longer exists in the parent.\n+//!\n+void TestFlushBehavior(\n+    CCoinsViewCacheTest* view,\n+    CCoinsViewDB& base,\n+    std::vector<CCoinsViewCacheTest*>& all_caches,\n+    bool do_erasing_flush)\n+{\n+    CAmount value;\n+    char flags;\n+    uint256 txid;\n+    COutPoint outp;\n+    Coin coin;\n+    size_t cache_usage;\n+\n+    auto flush_all = [&all_caches](bool erase) {\n+        // Flush in reverse order to ensure that flushes happen from children up.\n+        for (auto i = all_caches.rbegin(); i != all_caches.rend(); ++i) {\n+            auto cache = *i;\n+            // hashBlock must be filled before flushing to disk; value is\n+            // unimportant here. This is normally done during connect/disconnect block.\n+            cache->SetBestBlock(InsecureRand256());\n+            erase ? cache->Flush() : cache->Sync();\n+        }\n+    };\n+\n+    txid = InsecureRand256();\n+    outp = COutPoint(txid, 0);\n+    coin = MakeCoin();\n+    // Ensure the coins views haven't seen this coin before.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(!view->HaveCoin(outp));\n+\n+    // --- 1. Adding a random coin to the child cache\n+    //\n+    Coin tmpCoin{coin};\n+    view->AddCoin(outp, std::move(tmpCoin), false);\n+\n+    cache_usage = view->DynamicMemoryUsage();\n+    // `base` shouldn't have coin (no flush yet) but `view` should have cached it.\n+    BOOST_CHECK(!base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, DIRTY|FRESH);\n+\n+    // --- 2. Flushing all caches (without erasing)\n+    //\n+    flush_all(/*erase*/ false);\n+\n+    // CoinsMap usage should be unchanged since we didn't erase anything.\n+    BOOST_CHECK_EQUAL(cache_usage, view->DynamicMemoryUsage());\n+\n+    // --- 3. Ensuring the entry still exists in the cache and has been written to parent\n+    //\n+    GetCoinsMapEntry(view->map(), value, flags, outp);\n+    BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+    BOOST_CHECK_EQUAL(flags, 0);  // Flags should have been wiped.\n+\n+    // Both views should now have the coin.\n+    BOOST_CHECK(base.HaveCoin(outp));\n+    BOOST_CHECK(view->HaveCoin(outp));\n+\n+    if (do_erasing_flush) {\n+        // --- 4. Flushing the caches again (with erasing)\n+        //\n+        flush_all(/*erase*/ true);\n+\n+        // Memory usage should have gone down.\n+        BOOST_CHECK(view->DynamicMemoryUsage() < cache_usage);\n+\n+        // --- 5. Ensuring the entry is no longer in the cache\n+        //\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, ABSENT);\n+        BOOST_CHECK_EQUAL(flags, NO_ENTRY);\n+\n+        view->AccessCoin(outp);\n+        GetCoinsMapEntry(view->map(), value, flags, outp);\n+        BOOST_CHECK_EQUAL(value, coin.out.nValue);\n+        BOOST_CHECK_EQUAL(flags, 0);\n+    }\n+\n+    // Can't overwrite an entry without specifying that an overwrite is\n+    // expected.\n+    Coin tmpCoin2{coin};\n+    BOOST_CHECK_THROW(",
      "path": "src/test/coins_tests.cpp",
      "position": 227,
      "original_position": 232,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": 1073358171,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It may also be because the `BOOST_CHECK_THROW` macro expands to a loop?\r\n\r\nEither way, it should be trivial to work around by just replacing `std::move(tmpCoin2)` with `Coin{coin}`.",
      "created_at": "2023-01-20T14:24:04Z",
      "updated_at": "2023-01-20T14:24:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082606577",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082606577"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 998,
      "original_line": 998,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082702771",
      "pull_request_review_id": 1263815368,
      "id": 1082702771,
      "node_id": "PRRC_kwDOABII585AiLuz",
      "diff_hunk": "@@ -163,8 +163,8 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = mapCoins.erase(it)) {\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = erase ? mapCoins.erase(it) : ++it) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "a5b8b9a3059f4684320de400e535192c72297afe",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `it = ... ++it` evaluation modifies `it` twice, which has complicated rules about its validity: https://en.cppreference.com/w/cpp/language/eval_order. My reading of the rules there is that this is in fact well-defined since C++11, but I'd still recommend avoiding it by using `it = erase ? mapCoins.erase(it) : std::next(it)` instead for example.\r\n",
      "created_at": "2023-01-20T15:30:41Z",
      "updated_at": "2023-01-20T15:30:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082702771",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082702771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082712942",
      "pull_request_review_id": 1263836754,
      "id": 1082712942,
      "node_id": "PRRC_kwDOABII585AiONu",
      "diff_hunk": "@@ -163,8 +163,8 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = mapCoins.erase(it)) {\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = erase ? mapCoins.erase(it) : ++it) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "a5b8b9a3059f4684320de400e535192c72297afe",
      "in_reply_to_id": 1082702771,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good thought. Fixed.",
      "created_at": "2023-01-20T15:40:21Z",
      "updated_at": "2023-01-20T15:40:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082712942",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082712942"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082713316",
      "pull_request_review_id": 1263837907,
      "id": 1082713316,
      "node_id": "PRRC_kwDOABII585AiOTk",
      "diff_hunk": "@@ -220,12 +234,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase*/ true);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "0c2fc5154e88b46725b8a1c2149aa94c552d1e03",
      "in_reply_to_id": 1073360829,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, thanks.",
      "created_at": "2023-01-20T15:40:43Z",
      "updated_at": "2023-01-20T15:40:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082713316",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082713316"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082810385",
      "pull_request_review_id": 1263992791,
      "id": 1082810385,
      "node_id": "PRRC_kwDOABII585AimAR",
      "diff_hunk": "@@ -146,8 +146,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : std::next(it);",
      "path": "src/txdb.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In the first commit 79cedc36afe2, I'm unsure if this diff is a change of behavior, though haven't looked more into https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082702771 and if it applies here. Thoughts?",
      "created_at": "2023-01-20T16:46:59Z",
      "updated_at": "2023-01-21T02:12:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082810385",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082810385"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082859162",
      "pull_request_review_id": 1264048435,
      "id": 1082859162,
      "node_id": "PRRC_kwDOABII585Aix6a",
      "diff_hunk": "@@ -154,9 +154,16 @@ void SimulationTest(CCoinsView* base, bool fake_best_block)\n             bool test_havecoin_after = InsecureRandBits(2) == 0;\n \n             bool result_havecoin = test_havecoin_before ? stack.back()->HaveCoin(COutPoint(txid, 0)) : false;\n-            const Coin& entry = (InsecureRandRange(500) == 0) ? AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\n+\n+            // Infrequently, test usage of AccessByTxid instead of AccessCoin - the\n+            // former just delegates to the latter and returns the first unspent in a txn.\n+            const Coin& entry = (InsecureRandRange(500) == 0) ?",
      "path": "src/test/coins_tests.cpp",
      "position": 36,
      "original_position": 36,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In the second commit 6d8affca96c7a34f5f104 while adding the explanatory comment, it may be worth describing why it is run infrequently.  If I run `./src/test/test_bitcoin -t coins_tests` with the following change, the test run appears to hang (or take a very long time) with this loop being run `NUM_SIMULATION_ITERATIONS = 40000` iterations.  \r\n\r\n```diff\r\n            // Infrequently, test usage of AccessByTxid instead of AccessCoin - the\r\n            // former just delegates to the latter and returns the first unspent in a txn.\r\n-            const Coin& entry = (InsecureRandRange(500) == 0) ?\r\n-                AccessByTxid(*stack.back(), txid) : stack.back()->AccessCoin(COutPoint(txid, 0));\r\n+            const Coin& entry = AccessByTxid(*stack.back(), txid);\r\n```\r\n\r\n6d8affca96c7a34f5f104 nit, can drop redundant brackets while touching the line\r\n\r\n```suggestion\r\n            const Coin& entry = InsecureRandRange(500) == 0 ?\r\n```\r\n",
      "created_at": "2023-01-20T17:20:48Z",
      "updated_at": "2023-01-20T17:20:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082859162",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082859162"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082877263",
      "pull_request_review_id": 1264076713,
      "id": 1082877263,
      "node_id": "PRRC_kwDOABII585Ai2VP",
      "diff_hunk": "@@ -53,9 +53,9 @@ class CCoinsViewTest : public CCoinsView\n \n     uint256 GetBestBlock() const override { return hashBestBlock_; }\n \n-    bool BatchWrite(CCoinsMap& mapCoins, const uint256& hashBlock) override\n+    bool BatchWrite(CCoinsMap& mapCoins, const uint256& hashBlock, bool erase = true) override\n     {\n-        for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); ) {\n+        for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = erase ? mapCoins.erase(it) : ++it) {",
      "path": "src/test/coins_tests.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In the third commit  2c3cbd6c007a588e667, it looks like https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082702771 by @sipa would apply here as well.\r\n\r\n```suggestion\r\n        for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = erase ? mapCoins.erase(it) : std::next(it)) {\r\n```",
      "created_at": "2023-01-20T17:37:43Z",
      "updated_at": "2023-01-21T02:11:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1082877263",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1082877263"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 58,
      "original_line": 58,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086713195",
      "pull_request_review_id": 1269463879,
      "id": 1086713195,
      "node_id": "PRRC_kwDOABII585Axe1r",
      "diff_hunk": "@@ -233,12 +249,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ true);",
      "path": "src/coins.cpp",
      "position": 68,
      "original_position": 68,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "79cedc36afe2e72e42839d861734d73d545d21b8: nit drop space `/*erase=*/true` ",
      "created_at": "2023-01-25T14:30:46Z",
      "updated_at": "2023-01-25T20:26:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1086713195",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1086713195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 252,
      "original_line": 252,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087056241",
      "pull_request_review_id": 1269463879,
      "id": 1087056241,
      "node_id": "PRRC_kwDOABII585Ayylx",
      "diff_hunk": "@@ -282,12 +282,22 @@ class CCoinsViewCache : public CCoinsViewBacked\n     bool SpendCoin(const COutPoint &outpoint, Coin* moveto = nullptr);\n \n     /**\n-     * Push the modifications applied to this cache to its base.\n-     * Failure to call this method before destruction will cause the changes to be forgotten.\n+     * Push the modifications applied to this cache to its base and wipe local state.\n+     * Failure to call this method or Sync() before destruction will cause the changes\n+     * to be forgotten.\n      * If false is returned, the state of this cache (and its backing view) will be undefined.\n      */\n     bool Flush();\n \n+    /**\n+     * Push the modifications applied to this cache to its base while retaining\n+     * the contents of this cache (except for spent coins, which we erase).",
      "path": "src/coins.h",
      "position": 42,
      "original_position": 42,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is it strictly necessary or just nice to have to erase spent coins? ",
      "created_at": "2023-01-25T18:55:04Z",
      "updated_at": "2023-01-25T20:26:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1087056241",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087056241"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 294,
      "original_line": 294,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087065168",
      "pull_request_review_id": 1269463879,
      "id": 1087065168,
      "node_id": "PRRC_kwDOABII585Ay0xQ",
      "diff_hunk": "@@ -146,8 +146,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : std::next(it);",
      "path": "src/txdb.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": 1082810385,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Calling `erase(it)` on a [std::unordered_map](https://en.cppreference.com/w/cpp/container/unordered_map/erase) returns an iterator for the next element, which is was `itOld` was. So for `erase == true` the behaviour should be unchanged.\r\n\r\nI don't think @sipa's comment applies here, because the original code didn't update `it` twice, but used a temporary variable `itOld` instead. But even it did apply, that original was also well defined - at least since we moved to c++11. So this refactor goes from something that is well defined but ugly, to something nice.\r\n",
      "created_at": "2023-01-25T19:05:29Z",
      "updated_at": "2023-01-25T20:26:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1087065168",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087065168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087076903",
      "pull_request_review_id": 1269463879,
      "id": 1087076903,
      "node_id": "PRRC_kwDOABII585Ay3on",
      "diff_hunk": "@@ -233,12 +249,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ true);\n     cacheCoins.clear();\n     cachedCoinsUsage = 0;\n     return fOk;\n }\n \n+bool CCoinsViewCache::Sync()\n+{\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ false);\n+    // Instead of clearing `cacheCoins` as we would in Flush(), just clear the\n+    // FRESH/DIRTY flags of any coin that isn't spent.\n+    for (auto it = cacheCoins.begin(); it != cacheCoins.end(); ) {",
      "path": "src/coins.cpp",
      "position": 79,
      "original_position": 79,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Perhaps in a future refactor we could avoid this second loop by moving this into `base->BatchWrite`. Assuming that [improves performance](https://github.com/bitcoin/bitcoin/pull/15265#issuecomment-457793902).",
      "created_at": "2023-01-25T19:19:26Z",
      "updated_at": "2023-01-25T20:26:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1087076903",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087076903"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 263,
      "original_line": 263,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087087728",
      "pull_request_review_id": 1269463879,
      "id": 1087087728,
      "node_id": "PRRC_kwDOABII585Ay6Rw",
      "diff_hunk": "@@ -233,12 +249,29 @@ bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn\n }\n \n bool CCoinsViewCache::Flush() {\n-    bool fOk = base->BatchWrite(cacheCoins, hashBlock);\n+    bool fOk = base->BatchWrite(cacheCoins, hashBlock, /*erase=*/ true);\n     cacheCoins.clear();",
      "path": "src/coins.cpp",
      "position": 69,
      "original_position": 69,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So this was redundant all along? Since `BatchWrite` was already deleting all the elements.\r\n\r\nSeems so, since adding the following line above doesn't break any tests:\r\n```cpp\r\nif(cacheCoins.size() != 0) throw std::logic_error(\"Not all cached coins were erased\");\r\n```",
      "created_at": "2023-01-25T19:32:27Z",
      "updated_at": "2023-01-27T11:17:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1087087728",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087087728"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 253,
      "original_line": 253,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087584571",
      "pull_request_review_id": 1270679645,
      "id": 1087584571,
      "node_id": "PRRC_kwDOABII585A0zk7",
      "diff_hunk": "@@ -176,8 +176,10 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = mapCoins.erase(it)) {\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {",
      "path": "src/coins.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm starting to think we don't need this at all, because the change to `CCoinsViewDB::BatchWrite` is enough.\r\n\r\n#15265 had an assert in `CCoinsViewCache::BatchWrite`:\r\n```\r\nassert(erase_from_map); // We do not implement writes to a cache where we don't erase from the child!\r\n```",
      "created_at": "2023-01-26T09:13:52Z",
      "updated_at": "2023-01-26T09:32:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1087584571",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1087584571"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 179,
      "original_line": 179,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088140678",
      "pull_request_review_id": 1271483094,
      "id": 1088140678,
      "node_id": "PRRC_kwDOABII585A27WG",
      "diff_hunk": "@@ -146,8 +146,7 @@ bool CCoinsViewDB::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlock) {\n             changed++;\n         }\n         count++;\n-        CCoinsMap::iterator itOld = it++;\n-        mapCoins.erase(itOld);\n+        it = erase ? mapCoins.erase(it) : std::next(it);",
      "path": "src/txdb.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "79cedc36afe2e72e42839d861734d73d545d21b8",
      "in_reply_to_id": 1082810385,
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks @Sjors, agree, as a refresher I just verified this with https://godbolt.org/z/z54n51P5h\r\n\r\n<details><summary>code</summary><p>\r\n\r\n```cpp\r\n#include <iostream>\r\n#include <iterator>\r\n#include <string>\r\n#include <unordered_map>\r\n\r\nint main()\r\n{\r\n    auto print_key_value = [](const auto& key, const auto& value)\r\n    {\r\n        std::cout << \"Key:[\" << key << \"] Value:[\" << value << \"]\\n\";\r\n    };\r\n\r\n    std::unordered_map<std::string, std::string> m {\r\n        {\"RED\",\"#FF0000\"},\r\n        {\"GREEN\",\"#00FF00\"},\r\n        {\"BLUE\",\"#0000FF\"},\r\n        {\"BLACK\", \"#000000\"},\r\n        {\"WHITE\", \"#FFFFFF\"},\r\n    };\r\n    const auto m2{m};\r\n\r\n    std::cout << \"Iterate on unordered_map using std::next\\n\";\r\n    for (auto it = m.begin(); it != m.end();) {\r\n        print_key_value(it->first, it->second);\r\n        it = std::next(it);\r\n    }\r\n\r\n    std::cout << \"\\nSame, using increment iterator and erase\\n\";\r\n    for (auto it = m.begin(); it != m.end();) {\r\n        print_key_value(it->first, it->second);\r\n        auto itOld = it++;\r\n        m.erase(itOld);\r\n    }\r\n    if (m.empty()) {\r\n        std::cout << \"Unordered_map is now empty\\n\";\r\n    }\r\n\r\n    m = m2;\r\n\r\n    std::cout << \"\\nSame, using only erase\\n\";\r\n    for (auto it = m.begin(); it != m.end();) {\r\n        print_key_value(it->first, it->second);\r\n        it = m.erase(it);\r\n    }\r\n    if (m.empty()) {\r\n        std::cout << \"Unordered_map is now empty\\n\";\r\n    }\r\n\r\n    return 0;\r\n}\r\n```\r\n\r\n</p></details>\r\n\r\n<details><summary>output</summary><p>\r\n\r\n```\r\nIterate on unordered_map using std::next\r\nKey:[BLACK] Value:[#000000]\r\nKey:[BLUE] Value:[#0000FF]\r\nKey:[WHITE] Value:[#FFFFFF]\r\nKey:[GREEN] Value:[#00FF00]\r\nKey:[RED] Value:[#FF0000]\r\n\r\nSame, using increment iterator and erase\r\nKey:[BLACK] Value:[#000000]\r\nKey:[BLUE] Value:[#0000FF]\r\nKey:[WHITE] Value:[#FFFFFF]\r\nKey:[GREEN] Value:[#00FF00]\r\nKey:[RED] Value:[#FF0000]\r\nUnordered_map is now empty\r\n\r\nSame, using only erase\r\nKey:[BLACK] Value:[#000000]\r\nKey:[BLUE] Value:[#0000FF]\r\nKey:[RED] Value:[#FF0000]\r\nKey:[GREEN] Value:[#00FF00]\r\nKey:[WHITE] Value:[#FFFFFF]\r\nUnordered_map is now empty\r\n```\r\n\r\n</p></details>\r\n",
      "created_at": "2023-01-26T17:28:09Z",
      "updated_at": "2023-01-26T17:37:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1088140678",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088140678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088158149",
      "pull_request_review_id": 1271509559,
      "id": 1088158149,
      "node_id": "PRRC_kwDOABII585A2_nF",
      "diff_hunk": "@@ -176,8 +176,10 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     hashBlock = hashBlockIn;\n }\n \n-bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end(); it = mapCoins.erase(it)) {\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn, bool erase) {",
      "path": "src/coins.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "original_commit_id": "1d7935b45ac61791399989effc18aece8b368fbb",
      "in_reply_to_id": 1087584571,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "(see my comment here: https://github.com/bitcoin/bitcoin/pull/17487#issuecomment-1405365582)",
      "created_at": "2023-01-26T17:45:31Z",
      "updated_at": "2023-01-26T17:45:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/17487#discussion_r1088158149",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1088158149"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17487"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 179,
      "original_line": 179,
      "side": "RIGHT"
    }
  ]
}
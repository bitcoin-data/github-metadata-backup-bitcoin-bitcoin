{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003",
    "id": 3068971351,
    "node_id": "PR_kwDOABII58627MlX",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34003",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34003.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34003.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
    "number": 34003,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "test: interface_ipc.py minor fixes and cleanup",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This PR cleans up the `interface_ipc.py` test, fixing broken checks, fixing missing await calls, removing to_dict calls, renaming variables, reducing `.result` accesses, and giving template objects explicit lifetimes. More details are in the commit messages.\r\n\r\nThe first commit changes a lot of indentation so is easiest to review ignoring whitespace.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2025-12-03T21:23:36Z",
    "updated_at": "2025-12-19T07:51:12Z",
    "closed_at": "2025-12-16T14:05:25Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2025-12-16T14:05:25Z",
    "merged_by": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "merge_commit_sha": "ab643efc0a709087b12b93f45b6c9e20cde9aeb3",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "ryanofsky:pr/pyipc",
      "ref": "pr/pyipc",
      "sha": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 69901633,
        "node_id": "MDEwOlJlcG9zaXRvcnk2OTkwMTYzMw==",
        "name": "bitcoin",
        "full_name": "ryanofsky/bitcoin",
        "owner": {
          "login": "ryanofsky",
          "id": 7133040,
          "node_id": "MDQ6VXNlcjcxMzMwNDA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ryanofsky",
          "html_url": "https://github.com/ryanofsky",
          "followers_url": "https://api.github.com/users/ryanofsky/followers",
          "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
          "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
          "repos_url": "https://api.github.com/users/ryanofsky/repos",
          "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/ryanofsky/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ryanofsky/bitcoin",
        "archive_url": "https://api.github.com/repos/ryanofsky/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ryanofsky/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ryanofsky/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ryanofsky/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ryanofsky/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ryanofsky/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ryanofsky/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ryanofsky/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ryanofsky/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ryanofsky/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ryanofsky/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ryanofsky/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ryanofsky/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ryanofsky/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ryanofsky/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ryanofsky/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ryanofsky/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ryanofsky/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ryanofsky/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ryanofsky/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ryanofsky/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ryanofsky/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ryanofsky/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ryanofsky/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ryanofsky/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ryanofsky/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ryanofsky/bitcoin/hooks",
        "svn_url": "https://github.com/ryanofsky/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 12,
        "stargazers_count": 18,
        "watchers_count": 18,
        "size": 302450,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-16T02:10:57Z",
        "created_at": "2016-10-03T19:05:43Z",
        "updated_at": "2025-10-26T17:47:26Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "d5c8199b7904f4b13230d5677d4528591e4d5b41",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38373,
        "stargazers_count": 87281,
        "watchers_count": 87281,
        "size": 300582,
        "default_branch": "master",
        "open_issues_count": 722,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-12-18T15:57:51Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-12-19T06:04:54Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 172,
    "deletions": 146,
    "changed_files": 1,
    "commits": 3,
    "review_comments": 14,
    "comments": 9
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRlZDExZmIwNGQ4MjMxZGQ4MjBiZmEwNGIxMWE0YjdiMmIwYTA2Zjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8",
      "tree": {
        "sha": "ae553403002cd40c8b8e02567099e82c71b510a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ae553403002cd40c8b8e02567099e82c71b510a4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a29b2d331eed5b4cbd6922f63e397b68ff12447",
          "sha": "9a29b2d331eed5b4cbd6922f63e397b68ff12447",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9a29b2d331eed5b4cbd6922f63e397b68ff12447"
        }
      ],
      "message": "test: fix interface_ipc.py template destruction\n\nUse context managers to destroy block templates. Previously, block templates\nwere not being destroyed before disconnecting because the destroy coroutines\nwere called but never awaited. It's not necessary to explicitly destroy the\ntemplates since they will get garbage collected asynchronously, but it's good\nto destroy them to make the test more predictable, and to make the destroy\ncalls that are present actually do something.\n\nThis change also removes `await waitnext` expressions without changing\nbehavior, because the previous code was misleading about what order waitNext\ncalls were executed.\n\nThis change is easiest to review ignoring whitespace.\n\nCo-authored-by: Sjors Provoost <sjors@sprovoost.nl>",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-03T21:04:10Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-03T21:04:10Z"
      },
      "sha": "ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8"
    },
    {
      "event": "labeled",
      "id": 21343220352,
      "node_id": "LE_lADOABII587cDr__zwAAAAT4J7KA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21343220352",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-03T21:23:39Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 3608894881,
      "node_id": "IC_kwDOABII587XG12h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3608894881",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-03T21:23:43Z",
      "updated_at": "2025-12-16T10:08:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34003.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3632193600), [sedited](https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3582309850) |\n| Concept ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3544944968), [mercie-ux](https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3619834301) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34020](https://github.com/bitcoin/bitcoin/pull/34020) (mining: add getTransactions(ByWitnessID) IPC methods by Sjors)\n* [#33965](https://github.com/bitcoin/bitcoin/pull/33965) (mining: fix -blockreservedweight shadows IPC option by Sjors)\n* [#33936](https://github.com/bitcoin/bitcoin/pull/33936) (mining: pass missing context to createNewBlock() and checkBlock() by Sjors)\n* [#33922](https://github.com/bitcoin/bitcoin/pull/33922) (mining: add getMemoryLoad() and track template non-mempool memory footprint by Sjors)\n* [#33819](https://github.com/bitcoin/bitcoin/pull/33819) (mining: getCoinbase() returns struct instead of raw tx by Sjors)\n* [#32420](https://github.com/bitcoin/bitcoin/pull/32420) (miner: drop dummy extraNonce in coinbase scriptSig for templates requested via IPC by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3608894881",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "commented",
      "id": 3611379248,
      "node_id": "IC_kwDOABII587XQUYw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3611379248",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-04T10:29:29Z",
      "updated_at": "2025-12-04T10:29:29Z",
      "author_association": "MEMBER",
      "body": "cc @Sjors ",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3611379248",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "mentioned",
      "id": 21355384042,
      "node_id": "MEE_lADOABII587cDr__zwAAAAT44Uzq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21355384042",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-04T10:29:30Z"
    },
    {
      "event": "subscribed",
      "id": 21355384106,
      "node_id": "SE_lADOABII587cDr__zwAAAAT44U0q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21355384106",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-04T10:29:30Z"
    },
    {
      "event": "commented",
      "id": 3611494379,
      "node_id": "IC_kwDOABII587XQwfr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3611494379",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-04T10:53:06Z",
      "updated_at": "2025-12-04T10:53:06Z",
      "author_association": "MEMBER",
      "body": "> Destroy calls were being made at the end of the test instead of after templates were no longer needed.\r\n\r\nI take advantage of that in #33922, but I'll figure out a way to rebase if needed. E.g. I can just add another test with multiple templates.\r\n\r\nI tested on macOS 26.1 that the tests still pass.\r\n\r\nCan you split this into a few commits as it's quite a long list of changes now.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3611494379",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21369146828,
      "node_id": "HRFPE_lADOABII587cDr__zwAAAAT5s03M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21369146828",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "created_at": "2025-12-04T20:06:49Z"
    },
    {
      "event": "commented",
      "id": 3614166836,
      "node_id": "IC_kwDOABII587Xa880",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3614166836",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-04T20:17:26Z",
      "updated_at": "2025-12-04T20:17:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!-- begin push-2 -->\r\nUpdated d179f713792432c82befd39a288ab16fec13bab1 -> 6ef092c0e4343fc421c323ff09d3c791fb4bc33a ([`pr/pyipc.1`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.1) -> [`pr/pyipc.2`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.2), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/pyipc.1..pr/pyipc.2))<!-- end --> splitting into two commits\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3611494379\r\n\r\n> > Destroy calls were being made at the end of the test instead of after templates were no longer needed.\r\n> \r\n> I take advantage of that in #33922, but I'll figure out a way to rebase if needed. E.g. I can just add another test with multiple templates.\r\n\r\nI think this shouldn't change #33922 too much. You should be able to just add the check for nonzero memory usage inside the `with` block and the check for zero memory usage after it.\r\n\r\n> Can you split this into a few commits as it's quite a long list of changes now.\r\n\r\nYes, I split off a minimal change just introducing the context managers as the first commit, since it changes a lot of indentation. It should be pretty easy to review ignoring whitespace. The second commit contains all the other changes and should be more straightforward now. I could split it up more if desired, but it might be actually more work to review if the same lines change multiple times, so I kept it together for now.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3614166836",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "reviewed",
      "id": 3543353009,
      "node_id": "PRR_kwDOABII587TM0ax",
      "url": null,
      "actor": null,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-05T06:52:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 6ef092c0e4343fc421c323ff09d3c791fb4bc33a\r\n\r\nThanks for the cleanup! Have another suggestion for saving a few lines and naming clarity:\r\n\r\n<details>\r\n<summary>Diff</summary>\r\n\r\n```diff\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex 804f7f8f64..f8f3a76ec7 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -176,2 +176 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                template3 = await template2.waitNext(ctx, waitoptions)\r\n-                assert_equal(template3._has(\"result\"), False)\r\n+                assert_equal((await template2.waitNext(ctx, waitoptions))._has(\"result\"), False)\r\n@@ -181,2 +180,2 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                template4 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\r\n-                block3 = await self.parse_and_deserialize_block(template4, ctx)\r\n+                template3 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\r\n+                block3 = await self.parse_and_deserialize_block(template3, ctx)\r\n@@ -187,2 +186,2 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\r\n-                block4 = await self.parse_and_deserialize_block(template5, ctx)\r\n+                template4 = await stack.enter_async_context(destroying((await template3.waitNext(ctx, waitoptions)).result, ctx))\r\n+                block4 = await self.parse_and_deserialize_block(template4, ctx)\r\n@@ -194,3 +193,3 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                template6 = await stack.enter_async_context(destroying((await template5.waitNext(ctx, waitoptions)).result, ctx))\r\n-                block4 = await self.parse_and_deserialize_block(template6, ctx)\r\n-                assert_equal(len(block4.vtx), 3)\r\n+                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\r\n+                block5 = await self.parse_and_deserialize_block(template5, ctx)\r\n+                assert_equal(len(block5.vtx), 3)\r\n@@ -199,2 +198 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                template7 = await template6.waitNext(ctx, waitoptions)\r\n-                assert_equal(template7._has(\"result\"), False)\r\n+                assert_equal((await template5.waitNext(ctx, waitoptions))._has(\"result\"), False)\r\n@@ -209,2 +207 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                    template7 = await template6.waitNext(ctx, new_waitoptions)\r\n-                    assert_equal(template7._has(\"result\"), False)\r\n+                    assert_equal((await template5.waitNext(ctx, new_waitoptions))._has(\"result\"), False)\r\n@@ -215 +212 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n-                    template6.interruptWait()\r\n+                    template5.interruptWait()\r\n\r\n```\r\n\r\n</details>",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3543353009",
      "submitted_at": "2025-12-05T06:52:59Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "reviewed",
      "id": 3544944968,
      "node_id": "PRR_kwDOABII587TS5FI",
      "url": null,
      "actor": null,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-06T10:05:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 6ef092c0e4343fc421c323ff09d3c791fb4bc33a\r\n\r\nI'm new to this test, I built the `bitcoin-node` executable using `-DENABLE_IPC=ON` and ran the test using `venv` as mentioned in the readme file. I spent some time trying to understand the interfaces involving capnp. \r\n\r\nThe changes seem to clean the test quite a bit and makes it easier to go through. ",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3544944968",
      "submitted_at": "2025-12-05T14:18:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "commented",
      "id": 3619834301,
      "node_id": "IC_kwDOABII587Xwkm9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3619834301",
      "actor": {
        "login": "mercie-ux",
        "id": 71188215,
        "node_id": "MDQ6VXNlcjcxMTg4MjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/71188215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mercie-ux",
        "html_url": "https://github.com/mercie-ux",
        "followers_url": "https://api.github.com/users/mercie-ux/followers",
        "following_url": "https://api.github.com/users/mercie-ux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mercie-ux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mercie-ux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mercie-ux/subscriptions",
        "organizations_url": "https://api.github.com/users/mercie-ux/orgs",
        "repos_url": "https://api.github.com/users/mercie-ux/repos",
        "events_url": "https://api.github.com/users/mercie-ux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mercie-ux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-06T10:01:29Z",
      "updated_at": "2025-12-06T10:01:29Z",
      "author_association": "NONE",
      "body": "Concept ACK  #34003  \r\n\r\nI ran the interface_ipc.py test locally and it passes. The PR cleans up the test by fixing broken checks, missing await calls, and variable naming. \r\n\r\nIm new to PR reviews, but from what I can tell, the changes seem correct and improve readability. I dont see any issues with the changes.\r\n",
      "user": {
        "login": "mercie-ux",
        "id": 71188215,
        "node_id": "MDQ6VXNlcjcxMTg4MjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/71188215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mercie-ux",
        "html_url": "https://github.com/mercie-ux",
        "followers_url": "https://api.github.com/users/mercie-ux/followers",
        "following_url": "https://api.github.com/users/mercie-ux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mercie-ux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mercie-ux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mercie-ux/subscriptions",
        "organizations_url": "https://api.github.com/users/mercie-ux/orgs",
        "repos_url": "https://api.github.com/users/mercie-ux/repos",
        "events_url": "https://api.github.com/users/mercie-ux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mercie-ux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3619834301",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "reviewed",
      "id": 3552315179,
      "node_id": "PRR_kwDOABII587TvAcr",
      "url": null,
      "actor": null,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-08T14:34:07Z",
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3552315179",
      "submitted_at": "2025-12-08T14:34:07Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE1ZTYxYjE5MTdhZmY3NTY3NTk5YmViNTljYzcwOTM5NzhiN2UzMzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a5e61b1917aff7567599beb59cc7093978b7e336",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a5e61b1917aff7567599beb59cc7093978b7e336",
      "tree": {
        "sha": "3b032b07d7f691e43e3e2480b01244b6178dd4b5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3b032b07d7f691e43e3e2480b01244b6178dd4b5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8",
          "sha": "ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ded11fb04d8231dd820bfa04b11a4b7b2b0a06f8"
        }
      ],
      "message": "test: interface_ipc.py minor fixes and cleanup\n\nThere are a few things that are incorrect or messy in the interface_ipc.py test.\nThis commit tries to clean them up:\n\n- isTestChain and isInitialBlockDownload asserts were not checking the results\n  of those calls, only that calls were, made because they were not checking the\n  responses' .result member.\n\n- A lot of result accesses like `template.result` `mining.result` were repeated\n  unnecessarily because variables like `template` and `mining` were assigned\n  response objects instead of result objects. These variables are now changed\n  to point directly to results.\n\n- Some coroutine calls were assigned to temporary `wait` before being awaited.\n  This was unnecessarily confusing and would make code not run in top-down\n  order.\n\n- `to_dict` calls were being made to check if result variables were unset. This\n  was inefficient and indirect because it iterates over all fields in response\n  structs instead of just checking whether the result field is present. The\n  to_dict calls are now replaced with more direct `_has('result')` calls.\n\n- The `res` variables used to hold various responses did not have descriptive\n  names. These are replaced with clearer names.\n\nCo-authored-by: rkrux <rkrux.connect@gmail.com>",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-09T02:23:40Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-09T02:23:40Z"
      },
      "sha": "a5e61b1917aff7567599beb59cc7093978b7e336"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ4ZmU1ZjAzMjZjNWMwNTA1ZTBmN2U2ZTk3ODk2MWQyNGMyN2IxNzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "tree": {
        "sha": "2b3fcc147b422b57aca246e8d09f4efd1aa8dc4f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2b3fcc147b422b57aca246e8d09f4efd1aa8dc4f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a5e61b1917aff7567599beb59cc7093978b7e336",
          "sha": "a5e61b1917aff7567599beb59cc7093978b7e336",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a5e61b1917aff7567599beb59cc7093978b7e336"
        }
      ],
      "message": "test: improve interface_ipc.py waitNext tests\n\nAs pointed out by Sjors in\nhttps://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598844209 and\nhttps://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598858386 the\noriginal intention of having waitNext and waitTipChanged calls in the test was\nto ensure that if new blocks were connected or fees were increased *during* the\nwaits, that the calls would wake up and return.\n\nBut the tests were written incorrectly, to generate blocks and transactions\nbefore the wait calls instead of during the calls. So the tests were less\nmeaningful then they should be.\n\nThere was also a similar problem in the interruptWait test. The test was\nintended to test the interruptWait method, but it was never actually calling\nthe method due to a missing await keyword. Instead it was testing that\nminiwallet.send_self_transfer would interrupt the wait.\n\nThis commit fixes these issues by introducing a wait_and_do() helper function\nto start parallel tasks and trigger an action after a wait call is started.\n\nCo-authored-by: Sjors Provoost <sjors@sprovoost.nl>",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-09T03:22:43Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2025-12-09T03:22:43Z"
      },
      "sha": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175"
    },
    {
      "event": "referenced",
      "id": 21443009363,
      "node_id": "REFE_lADOABII587cDr__zwAAAAT-GltT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21443009363",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c358910b8cd6d1db51c10becb0cbcb58709b738f",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/c358910b8cd6d1db51c10becb0cbcb58709b738f",
      "created_at": "2025-12-09T04:03:02Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21443009411,
      "node_id": "HRFPE_lADOABII587cDr__zwAAAAT-GluD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21443009411",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c358910b8cd6d1db51c10becb0cbcb58709b738f",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/c358910b8cd6d1db51c10becb0cbcb58709b738f",
      "created_at": "2025-12-09T04:03:02Z"
    },
    {
      "event": "reviewed",
      "id": 3555280211,
      "node_id": "PRR_kwDOABII587T6UVT",
      "url": null,
      "actor": null,
      "commit_id": "c358910b8cd6d1db51c10becb0cbcb58709b738f",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-09T04:07:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the reviews!\n\n<!-- begin push-3 -->\nUpdated 6ef092c0e4343fc421c323ff09d3c791fb4bc33a -> c358910b8cd6d1db51c10becb0cbcb58709b738f ([`pr/pyipc.2`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.2) -> [`pr/pyipc.3`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.3), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/pyipc.2..pr/pyipc.3))<!-- end --> applying suggestions and adding a new commit to test actions during waitNext calls instead of before them.\n\nI tried to do the same thing with the waitTipChanged call as well, but for some reason waitTipChanged always seems to return right away even when the tip has not changed, and I'm not sure why that is, so I left it alone for now. Change I tried was:\n\n```diff\n-            self.generate(self.nodes[0], 1)\n-            newblockref = (await mining.waitTipChanged(ctx, blockref.result.hash)).result\n+            newblockref = (await wait_and_do(mining.waitTipChanged(ctx, blockref.result.hash), lambda: self.generate(self.nodes[0], 1))).result\n```\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3555280211",
      "submitted_at": "2025-12-09T04:07:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "commented",
      "id": 3631107711,
      "node_id": "IC_kwDOABII587Ybk5_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3631107711",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-09T09:00:48Z",
      "updated_at": "2025-12-09T09:09:55Z",
      "author_association": "MEMBER",
      "body": "ACK a5e61b1917aff7567599beb59cc7093978b7e336\r\n\r\nThough it would be nice to also fix this:\r\n\r\n> for some reason `waitTipChanged` always seems to return right away even when the tip has not changed\r\n\r\nBecause the timeout argument defaults to 0 when called from Python.\r\n\r\n```diff\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex 913aea16de..5242d61c1e 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -162,8 +162,10 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n             current_block_height = self.nodes[0].getchaintips()[0][\"height\"]\r\n             assert blockref.result.height == current_block_height\r\n             self.log.debug(\"Mine a block\")\r\n-            self.generate(self.nodes[0], 1)\r\n-            newblockref = (await mining.waitTipChanged(ctx, blockref.result.hash)).result\r\n+            newblockref = (await wait_and_do(\r\n+                mining.waitTipChanged(ctx, blockref.result.hash, timeout),\r\n+                lambda: self.generate(self.nodes[0], 1),\r\n+            )).result\r\n             assert_equal(len(newblockref.hash), block_hash_size)\r\n             assert_equal(newblockref.height, current_block_height + 1)\r\n             self.log.debug(\"Wait for timeout\")\r\n```\r\n\r\n(I find it more readable to have the `wait` and `do` arguments on separate lines) ",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3631107711",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21452686426,
      "node_id": "HRFPE_lADOABII587cDr__zwAAAAT-rgRa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21452686426",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "created_at": "2025-12-09T12:48:37Z"
    },
    {
      "event": "commented",
      "id": 3632106692,
      "node_id": "IC_kwDOABII587YfYzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3632106692",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-09T12:50:10Z",
      "updated_at": "2025-12-09T12:55:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "Nice suggestion!\r\n\r\n<!-- begin push-4 -->\r\nUpdated c358910b8cd6d1db51c10becb0cbcb58709b738f -> d8fe5f0326c5c0505e0f7e6e978961d24c27b175 ([`pr/pyipc.3`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.3) -> [`pr/pyipc.4`](https://github.com/ryanofsky/bitcoin/commits/pr/pyipc.4), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/pyipc.3..pr/pyipc.4))<!-- end -->  applying waitTipChanged suggestion and reformatting wait_and_do calls\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3632106692",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "commented",
      "id": 3632193600,
      "node_id": "IC_kwDOABII587YfuBA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3632193600",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-09T13:10:33Z",
      "updated_at": "2025-12-09T13:10:33Z",
      "author_association": "MEMBER",
      "body": "ACK d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3632193600",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    },
    {
      "event": "review_requested",
      "id": 21453202992,
      "node_id": "RRE_lADOABII587cDr__zwAAAAT-teYw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21453202992",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-09T13:10:38Z",
      "requested_reviewer": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 21453203302,
      "node_id": "RRE_lADOABII587cDr__zwAAAAT-tedm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21453203302",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-09T13:10:39Z",
      "requested_reviewer": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3582309850,
      "node_id": "PRR_kwDOABII587VhbXa",
      "url": null,
      "actor": null,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-16T10:08:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3582309850",
      "submitted_at": "2025-12-16T10:08:27Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "merged",
      "id": 21593603837,
      "node_id": "ME_lADOABII587cDr__zwAAAAUHFD79",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21593603837",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ab643efc0a709087b12b93f45b6c9e20cde9aeb3",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ab643efc0a709087b12b93f45b6c9e20cde9aeb3",
      "created_at": "2025-12-16T14:05:25Z"
    },
    {
      "event": "closed",
      "id": 21593603865,
      "node_id": "CE_lADOABII587cDr__zwAAAAUHFD8Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21593603865",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T14:05:25Z"
    },
    {
      "event": "reviewed",
      "id": 3583261099,
      "node_id": "PRR_kwDOABII587VlDmr",
      "url": null,
      "actor": null,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-16T14:09:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "Post-merge now as it got merged while I was reviewing.\r\n\r\nACK d8fe5f0326c5c0505e0f7e6e978961d24c27b175\r\n\r\nI have focussed only on the changes in this PR and have limited understanding of the mining/ipc domain.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#pullrequestreview-3583261099",
      "submitted_at": "2025-12-16T14:09:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
    },
    {
      "event": "referenced",
      "id": 21630163284,
      "node_id": "REFE_lADOABII587cDr__zwAAAAUJQhlU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21630163284",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7f2401e3769983eedacd57c9f3f92178ae446628",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/7f2401e3769983eedacd57c9f3f92178ae446628",
      "created_at": "2025-12-18T00:17:12Z"
    },
    {
      "event": "referenced",
      "id": 21630215301,
      "node_id": "REFE_lADOABII587cDr__zwAAAAUJQuSF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21630215301",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "4acd37e627b5fccf8b4386f317fa318c9624900c",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/4acd37e627b5fccf8b4386f317fa318c9624900c",
      "created_at": "2025-12-18T00:21:52Z"
    },
    {
      "event": "referenced",
      "id": 21630216570,
      "node_id": "REFE_lADOABII587cDr__zwAAAAUJQul6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21630216570",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0cd4974be07548b479d42ee33252eabbbde85287",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/0cd4974be07548b479d42ee33252eabbbde85287",
      "created_at": "2025-12-18T00:21:57Z"
    },
    {
      "event": "commented",
      "id": 3673974216,
      "node_id": "IC_kwDOABII587a_GXI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3673974216",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-19T07:51:12Z",
      "updated_at": "2025-12-19T07:51:12Z",
      "author_association": "MEMBER",
      "body": "The first commit in https://github.com/bitcoin/bitcoin/pull/33965 improves the `{create_block,wait_next}_template` helpers to return `None` if there's a timeout or failure.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#issuecomment-3673974216",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34003"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2592834249",
      "pull_request_review_id": 3544944968,
      "id": 2592834249,
      "node_id": "PRRC_kwDOABII586ai4LJ",
      "diff_hunk": "",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 1,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "original_commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 6ef092c0e4343fc421c323ff09d3c791fb4bc33a \"test: interface_ipc.py minor fixes and cleanup\"\r\n\r\nIn commit message:\r\n> Destroy calls were being made at the end of the test instead of after\r\n  templates were no longer needed. The `template` variable was assigned twice\r\n  but only (attempted to be) destroyed once. Fix these problems by using\r\n  python `with:` blocks\r\n\r\nWasn't this done in the first commit fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb?",
      "created_at": "2025-12-05T14:12:39Z",
      "updated_at": "2025-12-05T14:18:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2592834249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2592834249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2592842483",
      "pull_request_review_id": 3544944968,
      "id": 2592842483,
      "node_id": "PRRC_kwDOABII586ai6Lz",
      "diff_hunk": "@@ -230,26 +231,26 @@ async def interrupt_wait():\n                 self.log.debug(\"Submit a block with a bad version\")\n                 block.nVersion = 0\n                 block.solve()\n-                res = await mining.result.checkBlock(block.serialize(), check_opts)\n-                assert_equal(res.result, False)\n-                assert_equal(res.reason, \"bad-version(0x00000000)\")\n-                res = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\n-                assert_equal(res.result, False)\n+                check = await mining.checkBlock(block.serialize(), check_opts)\n+                assert_equal(check.result, False)\n+                assert_equal(check.reason, \"bad-version(0x00000000)\")\n+                submit = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 143,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 6ef092c0e4343fc421c323ff09d3c791fb4bc33a \"test: interface_ipc.py minor fixes and cleanup\"\r\n\r\n> A lot of result accesses like `template.result` `mining.result` were repeated\r\n  unnecessarily because variables like `template` and `mining` were assigned\r\n  response objects instead of result objects. These variables are now changed\r\n  to point directly to results.\r\n\r\nAlong the same lines:\r\n\r\n```diff\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex 90e22285e6..756c115c7e 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -234,23 +234,23 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n                 check = await mining.checkBlock(block.serialize(), check_opts)\r\n                 assert_equal(check.result, False)\r\n                 assert_equal(check.reason, \"bad-version(0x00000000)\")\r\n-                submit = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\r\n-                assert_equal(submit.result, False)\r\n+                submitted = (await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())).result\r\n+                assert_equal(submitted, False)\r\n                 self.log.debug(\"Submit a valid block\")\r\n                 block.nVersion = original_version\r\n                 block.solve()\r\n \r\n                 self.log.debug(\"First call checkBlock()\")\r\n-                check = await mining.checkBlock(block.serialize(), check_opts)\r\n-                assert_equal(check.result, True)\r\n+                block_valid = (await mining.checkBlock(block.serialize(), check_opts)).result\r\n+                assert_equal(block_valid, True)\r\n \r\n                 # The remote template block will be mutated, capture the original:\r\n                 remote_block_before = await self.parse_and_deserialize_block(template, ctx)\r\n \r\n                 self.log.debug(\"Submitted coinbase must include witness\")\r\n                 assert_not_equal(coinbase.serialize_without_witness().hex(), coinbase.serialize().hex())\r\n-                submit = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize_without_witness())\r\n-                assert_equal(submit.result, False)\r\n+                submitted = (await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize_without_witness())).result\r\n+                assert_equal(submitted, False)\r\n \r\n                 self.log.debug(\"Even a rejected submitBlock() mutates the template's block\")\r\n                 # Can be used by clients to download and inspect the (rejected)\r\n@@ -259,8 +259,8 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n                 assert_not_equal(remote_block_before.serialize().hex(), remote_block_after.serialize().hex())\r\n \r\n                 self.log.debug(\"Submit again, with the witness\")\r\n-                submit = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\r\n-                assert_equal(submit.result, True)\r\n+                submitted = (await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())).result\r\n+                assert_equal(submitted, True)\r\n \r\n             self.log.debug(\"Block should propagate\")\r\n             # Check that the IPC node actually updates its own chain\r\n```",
      "created_at": "2025-12-05T14:15:29Z",
      "updated_at": "2025-12-05T14:18:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2592842483",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2592842483"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598816528",
      "pull_request_review_id": 3552315179,
      "id": 2598816528,
      "node_id": "PRRC_kwDOABII586a5ssQ",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 101,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb _test: fix interface_ipc.py template destruction_: `await stack.enter_async_context(destroying((` is hard to read, so maybe move it into a helper:\r\n\r\n```diff\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex 3d28bba136..e01c753d24 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -96,6 +96,14 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n         tx.deserialize(coinbase_data)\r\n         return tx\r\n\r\n+    async def create_block_template(self, stack, ctx, mining, opts):\r\n+        # Destroyed when stack exits.\r\n+        return await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\r\n+\r\n+    async def wait_next_template(self, stack, ctx, template, waitoptions):\r\n+        # Destroyed when stack exits.\r\n+        return await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\r\n+\r\n     def run_echo_test(self):\r\n         self.log.info(\"Running echo test\")\r\n         async def async_routine():\r\n@@ -148,7 +156,7 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n                 opts.useMempool = True\r\n                 opts.blockReservedWeight = 4000\r\n                 opts.coinbaseOutputMaxAdditionalSigops = 0\r\n-                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\r\n+                template = await self.create_block_template(stack, ctx, mining, opts)\r\n                 self.log.debug(\"Test some inspectors of Template\")\r\n                 header = await template.getBlockHeader(ctx)\r\n                 assert_equal(len(header.result), block_header_size)\r\n@@ -168,7 +176,7 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n                 waitoptions.timeout = timeout\r\n                 waitoptions.feeThreshold = 1\r\n                 self.generate(self.nodes[0], 1)\r\n-                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\r\n+                template2 = await self.wait_next_template(stack, ctx, template, waitoptions)\r\n                 block2 = await self.parse_and_deserialize_block(template2, ctx)\r\n                 assert_equal(len(block2.vtx), 1)\r\n                 self.log.debug(\"Wait for another, but time out\")\r\n@@ -176,18 +184,18 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n                 assert_equal(template3.to_dict(), {})\r\n                 self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\r\n                 miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\r\n-                template4 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\r\n+                template4 = await self.wait_next_template(stack, ctx, template2, waitoptions)\r\n                 block3 = await self.parse_and_deserialize_block(template4, ctx)\r\n                 assert_equal(len(block3.vtx), 2)\r\n                 self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\r\n                 waitoptions.feeThreshold = 0\r\n-                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\r\n+                template5 = await self.wait_next_template(stack, ctx, template4, waitoptions)\r\n                 block4 = await self.parse_and_deserialize_block(template5, ctx)\r\n                 assert_equal(len(block4.vtx), 2)\r\n                 waitoptions.feeThreshold = 1\r\n                 self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\r\n                 miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\r\n-                template6 = await stack.enter_async_context(destroying((await template5.waitNext(ctx, waitoptions)).result, ctx))\r\n+                template6 = await self.wait_next_template(stack, ctx, template5, waitoptions)\r\n                 block4 = await self.parse_and_deserialize_block(template6, ctx)\r\n                 assert_equal(len(block4.vtx), 3)\r\n                 self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\r\n```\r\n\r\n",
      "created_at": "2025-12-08T14:18:20Z",
      "updated_at": "2025-12-08T14:34:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598816528",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598816528"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598844209",
      "pull_request_review_id": 3552315179,
      "id": 2598844209,
      "node_id": "PRRC_kwDOABII586a5zcx",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 121,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb _test: fix interface_ipc.py template destruction_:\r\n\r\nI think the original intention here was to demonstrate that `generate` interrupts an ongoing `waitNext()`.\r\n\r\nNow it only shows that `waitNext()` returns immediately if the tip has changes before calling. Though perhaps it always did that by accident.",
      "created_at": "2025-12-08T14:26:29Z",
      "updated_at": "2025-12-08T14:34:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598844209",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598844209"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 171,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598858386",
      "pull_request_review_id": 3552315179,
      "id": 2598858386,
      "node_id": "PRRC_kwDOABII586a526S",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\n+                block2 = await self.parse_and_deserialize_block(template2, ctx)\n+                assert_equal(len(block2.vtx), 1)\n+                self.log.debug(\"Wait for another, but time out\")\n+                template3 = await template2.waitNext(ctx, waitoptions)\n+                assert_equal(template3.to_dict(), {})\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n+                template4 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\n+                block3 = await self.parse_and_deserialize_block(template4, ctx)\n+                assert_equal(len(block3.vtx), 2)\n+                self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n+                waitoptions.feeThreshold = 0\n+                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\n+                block4 = await self.parse_and_deserialize_block(template5, ctx)\n+                assert_equal(len(block4.vtx), 2)\n+                waitoptions.feeThreshold = 1\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 139,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In https://github.com/bitcoin/bitcoin/commit/fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb _test: fix interface_ipc.py template destruction_: similar to my comment above, this only shows that `waitNext()` returns immediately if fees have gone up before the call, but the original intent was to show that a fee increase causes the wait to be interrupted.\r\n\r\n",
      "created_at": "2025-12-08T14:30:23Z",
      "updated_at": "2025-12-08T14:34:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598858386",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598858386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2599716362",
      "pull_request_review_id": 3553542014,
      "id": 2599716362,
      "node_id": "PRRC_kwDOABII586a9IYK",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 121,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": 2598844209,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598844209\r\n\r\n> I think the original intention here was to demonstrate that `generate` interrupts an ongoing `waitNext()`.\r\n> \r\n> Now it only shows that `waitNext()` returns immediately if the tip has changes before calling. Though perhaps it always did that by accident.\r\n\r\nYes behavior should be unchanged. Original code was:\r\n\r\n```python\r\nwaitnext = template.result.waitNext(ctx, waitoptions)\r\nself.generate(self.nodes[0], 1)\r\ntemplate2 = await waitnext\r\n```\r\n\r\nnew code is:\r\n\r\n```python\r\nself.generate(self.nodes[0], 1)\r\ntemplate2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\r\n```\r\n\r\nIn both cases, the waitNext() request would never be made until after the generate call because `waitNext` is an async method that's not executed until it's awaited. In order to actually test that a new block interrupts the waitNext the code would need to do something like the [`interruptWait`](https://github.com/ryanofsky/bitcoin/blob/6ef092c0e4343fc421c323ff09d3c791fb4bc33a/test/functional/interface_ipc.py#L202-L218) test is doing and start two asynchronous tasks that run in parallel: one starting the wait right away, and the other sleeping for a short amount of time and calling generate.\r\n\r\nI guess it's worth doing that in this PR in a followup commit, even though this commit is a refactoring.\r\n\r\nI should also add a note about why this commit is not changing behavior in the commit message.\r\n\r\n",
      "created_at": "2025-12-08T18:34:46Z",
      "updated_at": "2025-12-08T18:40:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2599716362",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2599716362"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 171,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2599729002",
      "pull_request_review_id": 3553542014,
      "id": 2599729002,
      "node_id": "PRRC_kwDOABII586a9Ldq",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\n+                block2 = await self.parse_and_deserialize_block(template2, ctx)\n+                assert_equal(len(block2.vtx), 1)\n+                self.log.debug(\"Wait for another, but time out\")\n+                template3 = await template2.waitNext(ctx, waitoptions)\n+                assert_equal(template3.to_dict(), {})\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n+                template4 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\n+                block3 = await self.parse_and_deserialize_block(template4, ctx)\n+                assert_equal(len(block3.vtx), 2)\n+                self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n+                waitoptions.feeThreshold = 0\n+                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\n+                block4 = await self.parse_and_deserialize_block(template5, ctx)\n+                assert_equal(len(block4.vtx), 2)\n+                waitoptions.feeThreshold = 1\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 139,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": 2598858386,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598858386\r\n\r\n> In [fac12f7](https://github.com/bitcoin/bitcoin/commit/fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb) _test: fix interface_ipc.py template destruction_: similar to my comment above, this only shows that `waitNext()` returns immediately if fees have gone up before the call, but the original intent was to show that a fee increase causes the wait to be interrupted.\r\n\r\nMakes sense. Again there should be no change of behavior in this commit, but this is worth following up on. \r\n\r\nPrevious code was:\r\n\r\n```python\r\nwaitnext = template5.result.waitNext(ctx, waitoptions)\r\nminiwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\r\ntemplate6 = await waitnext\r\n```\r\n\r\nSo waitNext call would not even begin to be executed until after the transfer, equivalent to the new code:\r\n\r\n```python\r\nminiwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\r\ntemplate6 = await stack.enter_async_context(destroying((await template5.waitNext(ctx, waitoptions)).result, ctx))\r\n```",
      "created_at": "2025-12-08T18:39:07Z",
      "updated_at": "2025-12-08T18:43:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2599729002",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2599729002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600995593",
      "pull_request_review_id": 3555280211,
      "id": 2600995593,
      "node_id": "PRRC_kwDOABII586bCAsJ",
      "diff_hunk": "",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 1,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "original_commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "in_reply_to_id": 2592834249,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2592834249\r\n\r\nThanks, fixed message. I forgot to update it when the commit was split up.",
      "created_at": "2025-12-09T03:56:48Z",
      "updated_at": "2025-12-09T04:07:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2600995593",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600995593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600996312",
      "pull_request_review_id": 3555280211,
      "id": 2600996312,
      "node_id": "PRRC_kwDOABII586bCA3Y",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 101,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": 2598816528,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598816528\r\n\r\nNice suggestion. Applied with a few tweaks",
      "created_at": "2025-12-09T03:57:22Z",
      "updated_at": "2025-12-09T04:07:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2600996312",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600996312"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600997265",
      "pull_request_review_id": 3555280211,
      "id": 2600997265,
      "node_id": "PRRC_kwDOABII586bCBGR",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 121,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": 2598844209,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598844209\r\n\r\nAdded a new commit to make this check work as originally intended and call generate during the wait instead of before.",
      "created_at": "2025-12-09T03:57:58Z",
      "updated_at": "2025-12-09T04:07:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2600997265",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600997265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 171,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600998615",
      "pull_request_review_id": 3555280211,
      "id": 2600998615,
      "node_id": "PRRC_kwDOABII586bCBbX",
      "diff_hunk": "@@ -134,126 +142,124 @@ async def async_routine():\n             assert_equal(oldblockref.result.hash, newblockref.result.hash)\n             assert_equal(oldblockref.result.height, newblockref.result.height)\n \n-            self.log.debug(\"Create a template\")\n-            opts = self.capnp_modules['mining'].BlockCreateOptions()\n-            opts.useMempool = True\n-            opts.blockReservedWeight = 4000\n-            opts.coinbaseOutputMaxAdditionalSigops = 0\n-            template = mining.result.createNewBlock(opts)\n-            self.log.debug(\"Test some inspectors of Template\")\n-            header = await template.result.getBlockHeader(ctx)\n-            assert_equal(len(header.result), block_header_size)\n-            block = await self.parse_and_deserialize_block(template, ctx)\n-            assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n-            assert len(block.vtx) >= 1\n-            txfees = await template.result.getTxFees(ctx)\n-            assert_equal(len(txfees.result), 0)\n-            txsigops = await template.result.getTxSigops(ctx)\n-            assert_equal(len(txsigops.result), 0)\n-            coinbase_data = BytesIO((await template.result.getCoinbaseTx(ctx)).result)\n-            coinbase = CTransaction()\n-            coinbase.deserialize(coinbase_data)\n-            assert_equal(coinbase.vin[0].prevout.hash, 0)\n-            self.log.debug(\"Wait for a new template\")\n-            waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n-            waitoptions.timeout = timeout\n-            waitoptions.feeThreshold = 1\n-            waitnext = template.result.waitNext(ctx, waitoptions)\n-            self.generate(self.nodes[0], 1)\n-            template2 = await waitnext\n-            block2 = await self.parse_and_deserialize_block(template2, ctx)\n-            assert_equal(len(block2.vtx), 1)\n-            self.log.debug(\"Wait for another, but time out\")\n-            template3 = await template2.result.waitNext(ctx, waitoptions)\n-            assert_equal(template3.to_dict(), {})\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template2.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template4 = await waitnext\n-            block3 = await self.parse_and_deserialize_block(template4, ctx)\n-            assert_equal(len(block3.vtx), 2)\n-            self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n-            waitoptions.feeThreshold = 0\n-            template5 = await template4.result.waitNext(ctx, waitoptions)\n-            block4 = await self.parse_and_deserialize_block(template5, ctx)\n-            assert_equal(len(block4.vtx), 2)\n-            waitoptions.feeThreshold = 1\n-            self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n-            waitnext = template5.result.waitNext(ctx, waitoptions)\n-            miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n-            template6 = await waitnext\n-            block4 = await self.parse_and_deserialize_block(template6, ctx)\n-            assert_equal(len(block4.vtx), 3)\n-            self.log.debug(\"Wait for another, but time out, since the fee threshold is set now\")\n-            template7 = await template6.result.waitNext(ctx, waitoptions)\n-            assert_equal(template7.to_dict(), {})\n+            async with AsyncExitStack() as stack:\n+                self.log.debug(\"Create a template\")\n+                opts = self.capnp_modules['mining'].BlockCreateOptions()\n+                opts.useMempool = True\n+                opts.blockReservedWeight = 4000\n+                opts.coinbaseOutputMaxAdditionalSigops = 0\n+                template = await stack.enter_async_context(destroying((await mining.result.createNewBlock(opts)).result, ctx))\n+                self.log.debug(\"Test some inspectors of Template\")\n+                header = await template.getBlockHeader(ctx)\n+                assert_equal(len(header.result), block_header_size)\n+                block = await self.parse_and_deserialize_block(template, ctx)\n+                assert_equal(ser_uint256(block.hashPrevBlock), newblockref.result.hash)\n+                assert len(block.vtx) >= 1\n+                txfees = await template.getTxFees(ctx)\n+                assert_equal(len(txfees.result), 0)\n+                txsigops = await template.getTxSigops(ctx)\n+                assert_equal(len(txsigops.result), 0)\n+                coinbase_data = BytesIO((await template.getCoinbaseTx(ctx)).result)\n+                coinbase = CTransaction()\n+                coinbase.deserialize(coinbase_data)\n+                assert_equal(coinbase.vin[0].prevout.hash, 0)\n+                self.log.debug(\"Wait for a new template\")\n+                waitoptions = self.capnp_modules['mining'].BlockWaitOptions()\n+                waitoptions.timeout = timeout\n+                waitoptions.feeThreshold = 1\n+                self.generate(self.nodes[0], 1)\n+                template2 = await stack.enter_async_context(destroying((await template.waitNext(ctx, waitoptions)).result, ctx))\n+                block2 = await self.parse_and_deserialize_block(template2, ctx)\n+                assert_equal(len(block2.vtx), 1)\n+                self.log.debug(\"Wait for another, but time out\")\n+                template3 = await template2.waitNext(ctx, waitoptions)\n+                assert_equal(template3.to_dict(), {})\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])\n+                template4 = await stack.enter_async_context(destroying((await template2.waitNext(ctx, waitoptions)).result, ctx))\n+                block3 = await self.parse_and_deserialize_block(template4, ctx)\n+                assert_equal(len(block3.vtx), 2)\n+                self.log.debug(\"Wait again, this should return the same template, since the fee threshold is zero\")\n+                waitoptions.feeThreshold = 0\n+                template5 = await stack.enter_async_context(destroying((await template4.waitNext(ctx, waitoptions)).result, ctx))\n+                block4 = await self.parse_and_deserialize_block(template5, ctx)\n+                assert_equal(len(block4.vtx), 2)\n+                waitoptions.feeThreshold = 1\n+                self.log.debug(\"Wait for another, get one after increase in fees in the mempool\")\n+                miniwallet.send_self_transfer(fee_rate=10, from_node=self.nodes[0])",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 139,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "fac12f7cf9ebc0b906bbb20ae126cf7e7552fdbb",
      "in_reply_to_id": 2598858386,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2598858386\r\n\r\nAdded a new commit to make this check work as originally intended and send the transaction during the wait instead of before.",
      "created_at": "2025-12-09T03:58:52Z",
      "updated_at": "2025-12-09T04:07:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2600998615",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2600998615"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2601000748",
      "pull_request_review_id": 3555280211,
      "id": 2601000748,
      "node_id": "PRRC_kwDOABII586bCB8s",
      "diff_hunk": "@@ -230,26 +231,26 @@ async def interrupt_wait():\n                 self.log.debug(\"Submit a block with a bad version\")\n                 block.nVersion = 0\n                 block.solve()\n-                res = await mining.result.checkBlock(block.serialize(), check_opts)\n-                assert_equal(res.result, False)\n-                assert_equal(res.reason, \"bad-version(0x00000000)\")\n-                res = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\n-                assert_equal(res.result, False)\n+                check = await mining.checkBlock(block.serialize(), check_opts)\n+                assert_equal(check.result, False)\n+                assert_equal(check.reason, \"bad-version(0x00000000)\")\n+                submit = await template.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())",
      "path": "test/functional/interface_ipc.py",
      "position": 1,
      "original_position": 143,
      "commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "original_commit_id": "6ef092c0e4343fc421c323ff09d3c791fb4bc33a",
      "in_reply_to_id": 2592842483,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2592842483\r\n\r\nMake sense, applied the suggestion",
      "created_at": "2025-12-09T04:00:19Z",
      "updated_at": "2025-12-09T04:07:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2601000748",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2601000748"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2623415518",
      "pull_request_review_id": 3583261099,
      "id": 2623415518,
      "node_id": "PRRC_kwDOABII586cXiTe",
      "diff_hunk": "@@ -38,6 +39,29 @@ async def wait_next_template(template, stack, ctx, opts):\n     \"\"\"Call template.waitNext() and return template, then call template.destroy() when stack exits.\"\"\"\n     return await stack.enter_async_context(destroying((await template.waitNext(ctx, opts)).result, ctx))\n \n+async def wait_and_do(wait_fn, do_fn):\n+    \"\"\"Call wait_fn, then sleep, then call do_fn in a parallel task. Wait for\n+    both tasks to complete.\"\"\"\n+    wait_started = asyncio.Event()\n+    result = None\n+\n+    async def wait():\n+        nonlocal result\n+        wait_started.set()\n+        result = await wait_fn\n+\n+    async def do():\n+        await wait_started.wait()\n+        await asyncio.sleep(0.1)\n+        # Let do_fn be either a callable or an awaitable object\n+        if inspect.isawaitable(do_fn):\n+            await do_fn\n+        else:\n+            do_fn()\n+\n+    await asyncio.gather(wait(), do())",
      "path": "test/functional/interface_ipc.py",
      "position": 32,
      "original_position": 32,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "original_commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In d8fe5f0326c5c0505e0f7e6e978961d24c27b175 \"test: improve interface_ipc.py waitNext tests\"\r\n\r\nAll are nits now I believe.\r\n\r\n1. I don't suppose the following is guaranteed? When event is set, then the wait of `do` is also over that makes it call the sleep in parallel. Reworded slightly to highlight the broader intent of the `wait_and_do` function.\r\n> Call wait_fn, then sleep,\r\n\r\n2. From an event's POV, it is set in `wait()` and waited for in `do()`; suggested `s/wait/setter` and `s/do/waiter`.\r\n\r\n3. `s/wait_started/event_over` because I got confused by `wait_started.set()` that could also suggest that the event wait starts now when instead it gets over at this stage.\r\n\r\n```diff\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex 7c8f51a81c..0da75d25cd 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -40,18 +40,18 @@ async def wait_next_template(template, stack, ctx, opts):\r\n     return await stack.enter_async_context(destroying((await template.waitNext(ctx, opts)).result, ctx))\r\n \r\n async def wait_and_do(wait_fn, do_fn):\r\n-    \"\"\"Call wait_fn, then sleep, then call do_fn in a parallel task. Wait for\r\n-    both tasks to complete.\"\"\"\r\n-    wait_started = asyncio.Event()\r\n+    \"\"\"Call wait_fn and do_fn in parallel tasks while ensuring do_fn is\r\n+    called after wait_fn is started. Wait for both tasks to complete.\"\"\"\r\n+    event_over = asyncio.Event()\r\n     result = None\r\n \r\n-    async def wait():\r\n+    async def setter():\r\n         nonlocal result\r\n-        wait_started.set()\r\n+        event_over.set()\r\n         result = await wait_fn\r\n \r\n-    async def do():\r\n-        await wait_started.wait()\r\n+    async def waiter():\r\n+        await event_over.wait()\r\n         await asyncio.sleep(0.1)\r\n         # Let do_fn be either a callable or an awaitable object\r\n         if inspect.isawaitable(do_fn):\r\n@@ -59,7 +59,7 @@ async def wait_and_do(wait_fn, do_fn):\r\n         else:\r\n             do_fn()\r\n \r\n-    await asyncio.gather(wait(), do())\r\n+    await asyncio.gather(setter(), waiter())\r\n     return result\r\n \r\n class IPCInterfaceTest(BitcoinTestFramework):\r\n```",
      "created_at": "2025-12-16T14:05:49Z",
      "updated_at": "2025-12-16T14:09:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2623415518",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2623415518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": 42,
      "original_start_line": 42,
      "start_side": "RIGHT",
      "line": 62,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2624442847",
      "pull_request_review_id": 3584593101,
      "id": 2624442847,
      "node_id": "PRRC_kwDOABII586cbdHf",
      "diff_hunk": "@@ -38,6 +39,29 @@ async def wait_next_template(template, stack, ctx, opts):\n     \"\"\"Call template.waitNext() and return template, then call template.destroy() when stack exits.\"\"\"\n     return await stack.enter_async_context(destroying((await template.waitNext(ctx, opts)).result, ctx))\n \n+async def wait_and_do(wait_fn, do_fn):\n+    \"\"\"Call wait_fn, then sleep, then call do_fn in a parallel task. Wait for\n+    both tasks to complete.\"\"\"\n+    wait_started = asyncio.Event()\n+    result = None\n+\n+    async def wait():\n+        nonlocal result\n+        wait_started.set()\n+        result = await wait_fn\n+\n+    async def do():\n+        await wait_started.wait()\n+        await asyncio.sleep(0.1)\n+        # Let do_fn be either a callable or an awaitable object\n+        if inspect.isawaitable(do_fn):\n+            await do_fn\n+        else:\n+            do_fn()\n+\n+    await asyncio.gather(wait(), do())",
      "path": "test/functional/interface_ipc.py",
      "position": 32,
      "original_position": 32,
      "commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "original_commit_id": "d8fe5f0326c5c0505e0f7e6e978961d24c27b175",
      "in_reply_to_id": 2623415518,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2623415518\r\n\r\nThanks for looking into this. The async code here is pretty confusing, so it's good to think through what it's doing and try to clarify things.\r\n\r\n>1. I don't suppose the following is guaranteed? When event is set, then the wait of `do` is also over that makes it call the sleep in parallel.\r\n\r\nActually the opposite should be true and setting the event happens first. When the event is set, `wait_fn` has not been awaited yet (meaning no `waitNext` or `waitTipChange` call has started), the sleep hasn't started yet, and `do_fn` has not been called.\r\n\r\nIn practice two orders are possible:\r\n\r\n1. `waitNext` or `waitTipChange` call starts, and the sleep(0.1) is long enough that `do_fn()` is called during the remote wait and interrupts it, causing it to return.\r\n2. `waitNext` or `waitTipChange` call starts, but the request is slow or the sleep(0.1) is short enough that `do_fn()` runs first and causes the remote wait to return right away without even blocking.\r\n\r\nA third scenario where the remote wait times out is also technically possible but should not happen because the wait timeout should be significantly longer than the sleep(0.1) here.\r\n\r\nThe main purpose of the `wait_started` event is to make it impossible for `do_fn()` to be called before the `wait()` coroutine starts executing, which would be bad because `do_fn()` can do anything and can potentially block the thread. \r\n\r\nUsing `wait_started` also makes it more likely that the `do_fn()` runs after wait_fn() has started waiting, but it can't guarantee this, because our wait functions to not provide any signal of when they have begun to wait.\r\n\r\nLooking at the suggested diff, I think \"ensuring do_fn is called after wait_fn is started\" would not be accurate because we can't ensure that. Similarly `setter` is probably not as a good a name as `wait` since main purpose of the coroutine is to start the wait, and setting the event is an implementation detail. Also the event is set when the wait should be starting, not when it is over so `wait_started` is probably a better name than `event_over`.\r\n\r\n\r\n",
      "created_at": "2025-12-16T19:14:16Z",
      "updated_at": "2025-12-16T19:14:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34003#discussion_r2624442847",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2624442847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34003"
        }
      },
      "start_line": 42,
      "original_start_line": 42,
      "start_side": "RIGHT",
      "line": 62,
      "original_line": 62,
      "side": "RIGHT"
    }
  ]
}
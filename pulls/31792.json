{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792",
    "id": 2313554406,
    "node_id": "PR_kwDOABII586J5gnm",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31792",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31792.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31792.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/ece9ac177d701da3a4fdb548453d9d87cc4eba49",
    "number": 31792,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "Double check all block rules in `ConnectBlock`, not only `CheckBlock`",
    "user": {
      "login": "darosior",
      "id": 22457751,
      "node_id": "MDQ6VXNlcjIyNDU3NzUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/darosior",
      "html_url": "https://github.com/darosior",
      "followers_url": "https://api.github.com/users/darosior/followers",
      "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
      "organizations_url": "https://api.github.com/users/darosior/orgs",
      "repos_url": "https://api.github.com/users/darosior/repos",
      "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/darosior/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "We currently only sanity check `CheckBlock()` in `ConnectBlock()`. Not running the rest of the block\r\nchecks makes it hard to reason about upgrade edge cases if we were to introduce new consensus rules\r\n(which would necessarily be context-dependent checks). For instance a timewarp fix or a BIP34\r\nsupplementation.\r\n\r\nThis is fine to do as the expensive check in `ContextualCheckBlock()` is cached since\r\n1ec6bbeb8d27d31647d1433ccb87b362f6d81f90 and the future-timestamp check is split out of\r\n`ContextualCheckBlockHeader()` beforehand.",
    "labels": [],
    "created_at": "2025-02-03T20:12:44Z",
    "updated_at": "2026-02-12T11:11:21Z",
    "closed_at": "2025-02-12T14:48:33Z",
    "mergeable_state": "unknown",
    "merged": false,
    "merge_commit_sha": "805995db564348c436e94296866ca7915bc17640",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "darosior:2502_ctx_checks_in_connectblock",
      "ref": "2502_ctx_checks_in_connectblock",
      "sha": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 168868367,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNjg4NjgzNjc=",
        "name": "bitcoin",
        "full_name": "darosior/bitcoin",
        "owner": {
          "login": "darosior",
          "id": 22457751,
          "node_id": "MDQ6VXNlcjIyNDU3NzUx",
          "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/darosior",
          "html_url": "https://github.com/darosior",
          "followers_url": "https://api.github.com/users/darosior/followers",
          "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
          "organizations_url": "https://api.github.com/users/darosior/orgs",
          "repos_url": "https://api.github.com/users/darosior/repos",
          "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/darosior/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/darosior/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/darosior/bitcoin",
        "archive_url": "https://api.github.com/repos/darosior/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/darosior/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/darosior/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/darosior/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/darosior/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/darosior/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/darosior/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/darosior/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/darosior/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/darosior/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/darosior/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/darosior/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/darosior/bitcoin/events",
        "forks_url": "https://api.github.com/repos/darosior/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/darosior/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/darosior/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/darosior/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/darosior/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/darosior/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/darosior/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/darosior/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/darosior/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/darosior/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/darosior/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/darosior/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/darosior/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/darosior/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/darosior/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/darosior/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:darosior/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/darosior/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/darosior/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/darosior/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/darosior/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/darosior/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/darosior/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/darosior/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/darosior/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/darosior/bitcoin/hooks",
        "svn_url": "https://github.com/darosior/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 285862,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-04T19:18:39Z",
        "created_at": "2019-02-02T19:20:27Z",
        "updated_at": "2025-11-23T06:08:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a43f08c4ae3235f2fa460dd17a7f5f9f9842efd9",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38903,
        "stargazers_count": 88084,
        "watchers_count": 88084,
        "size": 303642,
        "default_branch": "master",
        "open_issues_count": 731,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-12T09:43:32Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-12T10:44:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 54,
    "deletions": 766,
    "changed_files": 21,
    "commits": 6,
    "review_comments": 11,
    "comments": 19
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM1OWNiYmE1MThmYzg4MzViOWIyNjA0MGRkOTk3NGFlM2NkZGVkZmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c59cbba518fc8835b9b26040dd9974ae3cddedfa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c59cbba518fc8835b9b26040dd9974ae3cddedfa",
      "tree": {
        "sha": "d753e03cdd9c27a2797b6074677dd96895834f08",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d753e03cdd9c27a2797b6074677dd96895834f08"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35bf426e02210c1bbb04926f4ca2e0285fbfcd11",
          "sha": "35bf426e02210c1bbb04926f4ca2e0285fbfcd11",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/35bf426e02210c1bbb04926f4ca2e0285fbfcd11"
        }
      ],
      "message": "update comment on MinimumChainWork check",
      "committer": {
        "name": "marcofleon",
        "email": "marleo23@proton.me",
        "date": "2025-01-17T13:34:54Z"
      },
      "author": {
        "name": "marcofleon",
        "email": "marleo23@proton.me",
        "date": "2025-01-15T14:42:32Z"
      },
      "sha": "c59cbba518fc8835b9b26040dd9974ae3cddedfa"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMwMTAxN2M2MjE3Mzc4Y2E4NjhlMTdjN2NiOGZmZTM0NDdhYmIxMWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/301017c6217378ca868e17c7cb8ffe3447abb11d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/301017c6217378ca868e17c7cb8ffe3447abb11d",
      "tree": {
        "sha": "8d902e45183bbe80684362ddfdd98dc297dd5e26",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8d902e45183bbe80684362ddfdd98dc297dd5e26"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c59cbba518fc8835b9b26040dd9974ae3cddedfa",
          "sha": "c59cbba518fc8835b9b26040dd9974ae3cddedfa",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c59cbba518fc8835b9b26040dd9974ae3cddedfa"
        }
      ],
      "message": "Remove checkpoints\n\nThe headers presync logic should be enough to prevent memory DoS using\nlow-work headers. Therefore, we no longer have any use for checkpoints.",
      "committer": {
        "name": "marcofleon",
        "email": "marleo23@proton.me",
        "date": "2025-01-17T13:35:06Z"
      },
      "author": {
        "name": "marcofleon",
        "email": "marleo23@proton.me",
        "date": "2025-01-13T15:08:41Z"
      },
      "sha": "301017c6217378ca868e17c7cb8ffe3447abb11d"
    },
    {
      "event": "commented",
      "id": 2631973272,
      "node_id": "IC_kwDOABII586c4LmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2631973272",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-03T20:12:47Z",
      "updated_at": "2025-02-12T13:10:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31792.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592504179) |\n| Approach NACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2653664441) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31714](https://github.com/bitcoin/bitcoin/pull/31714) (validation: Do less work in NeedsRedownload by mzumsande)\n* [#31564](https://github.com/bitcoin/bitcoin/pull/31564) (Add checkblock RPC and checkBlock() to Mining interface by Sjors)\n* [#31250](https://github.com/bitcoin/bitcoin/pull/31250) (wallet: Disable creating and loading legacy wallets by achow101)\n* [#30595](https://github.com/bitcoin/bitcoin/pull/30595) (kernel: Introduce initial C header API by TheCharlatan)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2631973272",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "labeled",
      "id": 16168614308,
      "node_id": "LE_lADOABII586olmcWzwAAAAPDuXmk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16168614308",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-03T21:19:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2592216351,
      "node_id": "PRR_kwDOABII586aghUf",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-04T09:24:39Z",
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Armss9936",
        "id": 193652958,
        "node_id": "U_kgDOC4ro3g",
        "avatar_url": "https://avatars.githubusercontent.com/u/193652958?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Armss9936",
        "html_url": "https://github.com/Armss9936",
        "followers_url": "https://api.github.com/users/Armss9936/followers",
        "following_url": "https://api.github.com/users/Armss9936/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Armss9936/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Armss9936/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Armss9936/subscriptions",
        "organizations_url": "https://api.github.com/users/Armss9936/orgs",
        "repos_url": "https://api.github.com/users/Armss9936/repos",
        "events_url": "https://api.github.com/users/Armss9936/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Armss9936/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592216351",
      "submitted_at": "2025-02-04T09:24:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2592270272,
      "node_id": "PRR_kwDOABII586agufA",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-04T09:43:15Z",
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Armss9936",
        "id": 193652958,
        "node_id": "U_kgDOC4ro3g",
        "avatar_url": "https://avatars.githubusercontent.com/u/193652958?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Armss9936",
        "html_url": "https://github.com/Armss9936",
        "followers_url": "https://api.github.com/users/Armss9936/followers",
        "following_url": "https://api.github.com/users/Armss9936/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Armss9936/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Armss9936/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Armss9936/subscriptions",
        "organizations_url": "https://api.github.com/users/Armss9936/orgs",
        "repos_url": "https://api.github.com/users/Armss9936/repos",
        "events_url": "https://api.github.com/users/Armss9936/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Armss9936/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592270272",
      "submitted_at": "2025-02-04T09:43:15Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2592504179,
      "node_id": "PRR_kwDOABII586ahnlz",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-04T11:17:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592504179",
      "submitted_at": "2025-02-04T11:17:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2593082094,
      "node_id": "PRR_kwDOABII586aj0ru",
      "url": null,
      "actor": null,
      "commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-04T14:40:02Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2593082094",
      "submitted_at": "2025-02-04T14:40:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "commented",
      "id": 2634312015,
      "node_id": "IC_kwDOABII586dBGlP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2634312015",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T15:27:16Z",
      "updated_at": "2025-02-04T15:27:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think what you're doing here is:\r\n\r\n * redoing the contextual checks in ConnectBlock\r\n * currently, this could result in errors on startup if we accepted a block with timestamp T, but then our clock went backwards and is now set to a time prior to T-2 hours\r\n * so to avoid that, we move the T+2h check out of the contextual checks into its own special function, and call that from the appropriate places\r\n * once we redo contextual checks in ConnectBlock, `verifychain` rpc can detect contexual errors, so check that it does (should also check `-reindex-chainstate` sees them too?)\r\n\r\nI think it would be better to just add declarations for the functions rather than shuffling the code around, and I would have separated the commits a bit differently, more like https://github.com/ajtowns/bitcoin/commits/202502-pr31792/ (except with explanations in the commit messages)\r\n\r\nI'm not sure what the behaviour is now vs with this patch in the situation where you're node has followed a high work chain that is no longer valid under a newer version's rules. I think so long as the block that violates the rule is more than 6 blocks behind the tip, that both will just continue following the invalid chain until you manually -reindex. Will running verifychain with this PR just cause your node to crash rather than to reorg? It might be good to replace this comment:\r\n\r\n```c++\r\n    // NOTE: We don't currently (re-)invoke ContextualCheckBlock() or\r\n    // ContextualCheckBlockHeader() here. This means that if we add a new\r\n    // consensus rule that is enforced in one of those two functions, then we\r\n    // may have let in a block that violates the rule prior to updating the\r\n    // software, and we would NOT be enforcing the rule here. Fully solving\r\n    // upgrade from one software version to the next after a consensus rule\r\n    // change is potentially tricky and issue-specific (see NeedsRedownload()\r\n    // for one approach that was used for BIP 141 deployment).\r\n```\r\n\r\nwith the actual post-this-PR upgrade-behaviour, rather than just deleting it?",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2634312015",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16181298348,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPEewSs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16181298348",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b4a3cd6855fd0f6b9129cfc32a84cdef735710e9",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/b4a3cd6855fd0f6b9129cfc32a84cdef735710e9",
      "created_at": "2025-02-04T15:51:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16181334672,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPEe5KQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16181334672",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/dd2714ed13eea3591162dbade8132ff517ca5509",
      "created_at": "2025-02-04T15:54:08Z"
    },
    {
      "event": "reviewed",
      "id": 2593464262,
      "node_id": "PRR_kwDOABII586alR_G",
      "url": null,
      "actor": null,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-04T16:47:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "> This is fine to do as the expensive check in ContextualCheckBlock() is cached since\r\nhttps://github.com/bitcoin/bitcoin/commit/1ec6bbeb8d27d31647d1433ccb87b362f6d81f90\r\n\r\nAs discussed out of band, only the most recent block will be cached in memory and passed to `ActivateBestChain` / `ConnectTip`. During IBD when blocks arrive out of order ABC will frequently connect multiple blocks, which then need to be reloaded from disk during `ConnectTip()` . For these, the `CheckWitnessMalleation` check will be done twice after this PR, so there is a possible performance impact on IBD.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2593464262",
      "submitted_at": "2025-02-04T16:45:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "commented",
      "id": 2634905893,
      "node_id": "IC_kwDOABII586dDXkl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2634905893",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T19:42:16Z",
      "updated_at": "2025-02-04T19:42:16Z",
      "author_association": "MEMBER",
      "body": "I seem to have a problem running IBD with this change @ dd2714ed13eea3591162dbade8132ff517ca5509, which I have not investigated yet:\r\n\r\n<details>\r\n<summary>tail debug.log</summary>\r\n\r\n```log\r\n<snip>\r\n2025-02-04T19:38:24Z init message: Verifying blocksâ€¦\r\n2025-02-04T19:38:24Z Block index and chainstate loaded\r\n2025-02-04T19:38:24Z Setting NODE_NETWORK on non-prune mode\r\n2025-02-04T19:38:24Z initload thread start\r\n2025-02-04T19:38:24Z [bench]   - Load block from disk: 0.05ms\r\n2025-02-04T19:38:24Z [validation] BlockChecked: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f state=Valid\r\n2025-02-04T19:38:24Z [bench]   - Connect total: 0.05ms [0.00s (0.05ms/blk)]\r\n2025-02-04T19:38:24Z [bench]   - Flush: 0.02ms [0.00s (0.02ms/blk)]\r\n2025-02-04T19:38:24Z [bench]   - Writing chainstate: 0.01ms [0.00s (0.01ms/blk)]\r\n2025-02-04T19:38:24Z [validation] Enqueuing MempoolTransactionsRemovedForBlock: block height=0 txs removed=0\r\n2025-02-04T19:38:24Z UpdateTip: new best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f height=0 version=0x00000001 log2_work=32.000022 tx=1 date='2009-01-03T18:15:05Z' progress=0.000000 cache=0.3MiB(0txo)\r\n2025-02-04T19:38:24Z [bench]   - Connect postprocess: 0.06ms [0.00s (0.06ms/blk)]\r\n2025-02-04T19:38:24Z [bench] - Connect block: 0.19ms [0.00s (0.19ms/blk)]\r\n2025-02-04T19:38:24Z [validation] Enqueuing BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z [validation] Enqueuing UpdatedBlockTip: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f fork block hash=null (in IBD=true)\r\n2025-02-04T19:38:24Z [validation] ActiveTipChange: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z [validation] MempoolTransactionsRemovedForBlock: block height=0 txs removed=0\r\n2025-02-04T19:38:24Z block tree size = 1\r\n2025-02-04T19:38:24Z nBestHeight = 0\r\n2025-02-04T19:38:24Z [validation] BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z init message: Starting network threadsâ€¦\r\n2025-02-04T19:38:24Z Failed to open mempool file. Continuing anyway.\r\n2025-02-04T19:38:24Z initload thread exit\r\n2025-02-04T19:38:24Z DNS seeding disabled\r\n2025-02-04T19:38:24Z net thread start\r\n2025-02-04T19:38:24Z init message: Done loading\r\n2025-02-04T19:38:24Z addcon thread start\r\n2025-02-04T19:38:24Z msghand thread start\r\n2025-02-04T19:38:24Z opencon thread start\r\n2025-02-04T19:38:24Z [validation] UpdatedBlockTip: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f fork block hash=null (in IBD=true)\r\n2025-02-04T19:38:24Z New manual v2 peer connected: version: 70016, blocks=882316, peer=0\r\n2025-02-04T19:38:24Z Pre-synchronizing blockheaders, height: 2000 (~0.24%)\r\n2025-02-04T19:38:25Z Pre-synchronizing blockheaders, height: 18000 (~2.14%)\r\n\r\n<snip>\r\n\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000002f0aba7c60667df80ee657873bfa22e5dba80f13fafcb height=859992\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000002e66a5fe60350d7a5900c797dde1ac989e36de05e2cf3 height=859993\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000220ed045522462a2a96bc3e3898364f19dad67fe842a8 height=859994\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000124d178d6056cf493873ba3a865eb2a4fc64e2e9b2ccb height=859995\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000000bc91fb6007041636f724770df4d16184af479102c69e height=859996\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=000000000000000000028c2e4e0e6e83da708aabf189b252e5f8f62cbd090053 height=859997\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000000de531aab72aa763d8f1dea92efdb47c96ea5d209b8ef height=859998\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000196a7111c7aa3368af5a803a81c7bfb32860100dfd9c7 height=859999\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000095dd5c0c8e176a6498eb335c491b96df1a1ae178bfbd height=860000\r\n2025-02-04T19:38:43Z Synchronizing blockheaders, height: 860000 (~97.51%)\r\n2025-02-04T19:31:58Z [bench]   - Using cached block\r\n2025-02-04T19:31:58Z [bench]   - Load block from disk: 0.01ms\r\n2025-02-04T19:31:58Z ERROR: ContextualCheckBlockHeader: forked chain older than last checkpoint (height 1)\r\n2025-02-04T19:31:58Z [error] ConnectBlock: Consensus::ContextualCheckBlockHeader: bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 state=bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z InvalidChainFound: invalid block=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048  height=1  log2_work=33.000022  date=2009-01-09T02:54:25Z\r\n2025-02-04T19:31:58Z InvalidChainFound:  current best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f  height=0  log2_work=32.000022  date=2009-01-03T18:15:05Z\r\n2025-02-04T19:31:58Z [error] ConnectTip: ConnectBlock 00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 failed, bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z InvalidChainFound: invalid block=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048  height=1  log2_work=33.000022  date=2009-01-09T02:54:25Z\r\n2025-02-04T19:31:58Z InvalidChainFound:  current best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f  height=0  log2_work=32.000022  date=2009-01-03T18:15:05Z\r\n2025-02-04T19:31:58Z [validation] ActiveTipChange: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000082b5015589a3fdf2d4baff403e6f0be035a5d9742c1cae6295464449 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000082b5015589a3fdf2d4baff403e6f0be035a5d9742c1cae6295464449 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000004ebadb55ee9096c9a2f8880e09da59c0d68b1c228da88e48844a1485 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000004ebadb55ee9096c9a2f8880e09da59c0d68b1c228da88e48844a1485 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000009b7262315dbf071787ad3656097b892abffd1f95a1a022f896f533fc is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000009b7262315dbf071787ad3656097b892abffd1f95a1a022f896f533fc state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000003031a0e73735690c5a1ff2a4be82553b2a12b776fbd3a215dc8f778d is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000003031a0e73735690c5a1ff2a4be82553b2a12b776fbd3a215dc8f778d state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000071966c2b1d065fd446b1e485b2c9d9594acd2007ccbd5441cfc89444 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000071966c2b1d065fd446b1e485b2c9d9594acd2007ccbd5441cfc89444 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000408c48f847aa786c2268fc3e6ec2af68e8468a34a28c61b7f1de0dc6 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000408c48f847aa786c2268fc3e6ec2af68e8468a34a28c61b7f1de0dc6 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000008d9dc510f23c2657fc4f67bea30078cc05a90eb89e84cc475c080805 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000008d9dc510f23c2657fc4f67bea30078cc05a90eb89e84cc475c080805 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000002c05cc2e78923c34df87fd108b22221ac6076c18f3ade378a4d915e9 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000002c05cc2e78923c34df87fd108b22221ac6076c18f3ade378a4d915e9 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000097be56d606cdd9c54b04d4747e957d3608abe69198c661f2add73073 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000097be56d606cdd9c54b04d4747e957d3608abe69198c661f2add73073 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000027c2488e2510d1acf4369787784fa20ee084c258b58d9fbd43802b5e is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000027c2488e2510d1acf4369787784fa20ee084c258b58d9fbd43802b5e state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000005c51de2031a895adc145ee2242e919a01c6d61fb222a54a54b4d3089 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000005c51de2031a895adc145ee2242e919a01c6d61fb222a54a54b4d3089 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000080f17a0c5a67f663a9bc9969eb37e81666d9321125f0e293656f8a37 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000080f17a0c5a67f663a9bc9969eb37e81666d9321125f0e293656f8a37 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000b3322c8c3ef7d2cf6da009a776e6a99ee65ec5a32f3f345712238473 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000b3322c8c3ef7d2cf6da009a776e6a99ee65ec5a32f3f345712238473 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000174a25bb399b009cc8deff1c4b3ea84df7e93affaaf60dc3416cc4f5 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000174a25bb399b009cc8deff1c4b3ea84df7e93affaaf60dc3416cc4f5 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] header 00000000000000000001b3fc0c62b55c57a0d46b4069100ab041af9c345a1059 has prev block invalid: 0000000000000000000095dd5c0c8e176a6498eb335c491b96df1a1ae178bfbd\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n^C2025-02-04T19:32:03Z Shutdown: In progress...\r\n2025-02-04T19:32:03Z opencon thread exit\r\n2025-02-04T19:32:03Z addcon thread exit\r\n2025-02-04T19:32:03Z net thread exit\r\n2025-02-04T19:32:03Z msghand thread exit\r\n2025-02-04T19:32:03Z scheduler thread exit\r\n2025-02-04T19:32:03Z Writing 0 mempool transactions to file...\r\n2025-02-04T19:32:03Z Writing 0 unbroadcast transactions to file.\r\n2025-02-04T19:32:03Z Dumped mempool: 0.000s to copy, 0.006s to dump, 27 bytes dumped to file\r\n2025-02-04T19:32:03Z Flushed fee estimates to fee_estimates.dat.\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block and undo data to disk started\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block and undo data to disk completed (16.65ms)\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block index to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk completed (1348.48ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) completed (0.03ms)\r\n2025-02-04T19:32:05Z [validation] Enqueuing ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z [validation] ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block and undo data to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block and undo data to disk completed (27.61ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk completed (5.74ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) completed (0.03ms)\r\n2025-02-04T19:32:05Z [validation] Enqueuing ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z Shutdown: done\r\n```\r\n\r\n</details>\r\n\r\nI connected to a single manual peer which is why `Warning: not punishing manually connected peer 0!` appears. With a selection of network peers I observed an endless header presync->sync->presync loop.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2634905893",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2635261821,
      "node_id": "IC_kwDOABII586dEud9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2635261821",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T23:05:11Z",
      "updated_at": "2025-02-04T23:05:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "`feature_unsupported_utxo_db.py` fails (times out)",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2635261821",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16188256537,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPE5TEZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16188256537",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e66ee7b5d550717c45c1fe4b8672be9e9cfce61f",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/e66ee7b5d550717c45c1fe4b8672be9e9cfce61f",
      "created_at": "2025-02-05T03:56:04Z"
    },
    {
      "event": "commented",
      "id": 2635662333,
      "node_id": "IC_kwDOABII586dGQP9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2635662333",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-05T04:13:22Z",
      "updated_at": "2025-02-05T04:13:22Z",
      "author_association": "MEMBER",
      "body": "> I seem to have a problem running IBD with this change @ [dd2714e](https://github.com/bitcoin/bitcoin/commit/dd2714ed13eea3591162dbade8132ff517ca5509), which I have not investigated yet:\r\n\r\nThis is because we'd now perform the checkpoints check twice, but it'd fail the second time since a checkpoint with a higher height would already be in the index. Instead of introducing more complexity there i rebased on top of #31649.\r\n\r\n> `feature_unsupported_utxo_db.py` fails (times out)\r\n\r\nThis was failing in the final restart of the node, because the upgraded node is now checking all consensus rules (including Segwit which is always active on testnet) and was tripping on a `bad-witness-nonce-size` since the block was created by the unupgraded node.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2635662333",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "unlabeled",
      "id": 16190028197,
      "node_id": "UNLE_lADOABII586olmcWzwAAAAPFADml",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16190028197",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-05T07:32:35Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBkYWQ2OGVjMDZhZjRjNTNiZjRhM2NkNmMyNjZlOGNiOGZlNWVmNTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55",
      "tree": {
        "sha": "d684344a76dbf8db642914d76e8800c6f5ea1d07",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d684344a76dbf8db642914d76e8800c6f5ea1d07"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/301017c6217378ca868e17c7cb8ffe3447abb11d",
          "sha": "301017c6217378ca868e17c7cb8ffe3447abb11d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/301017c6217378ca868e17c7cb8ffe3447abb11d"
        }
      ],
      "message": "[refactor] validation: split out future timestamp check\n\nIn the following commits we'll make it so all consensus rules are checked when\nconnecting blocks. However we should not check again there that the block\ntimestamp is not more than 2 hours in the future, just in case our system clock\nwent backward.\n\nTo achieve this we first split out the future timestamp check in its own function.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T19:47:37Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T19:39:47Z"
      },
      "sha": "0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk2NTVlZGFlYzMxN2YwZThhYTE0ZmY3ZmVhYjY4ZWM2NjhhODYwNzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9655edaec317f0e8aa14ff7feab68ec668a86076",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9655edaec317f0e8aa14ff7feab68ec668a86076",
      "tree": {
        "sha": "5cdad1a4d41a1a062273e96c0406640f9e44722a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5cdad1a4d41a1a062273e96c0406640f9e44722a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55",
          "sha": "0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55"
        }
      ],
      "message": "[refactor]: move future timestamp check out of CtxCheckBlockHeader\n\nWe want to check all consensus rules when connecting a block, and therefore to\ncall CtxCheckBlockHeader in ConnectBlock. But we don't want to perform the future\ntimestamp check there again in case our system clock went backware. Therefore move\nthe future timestamp check out of CtxCheckBlockHeader to its callers.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T19:49:00Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T19:49:00Z"
      },
      "sha": "9655edaec317f0e8aa14ff7feab68ec668a86076"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVlMDVlYjQ0MDMxMGExYjlkNmRlZjhhMjY0NDI0MzNkZmZkMWExMjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ee05eb440310a1b9d6def8a26442433dffd1a122",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ee05eb440310a1b9d6def8a26442433dffd1a122",
      "tree": {
        "sha": "c99d5ef0beac2da4bec4740e895c97d084391731",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c99d5ef0beac2da4bec4740e895c97d084391731"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9655edaec317f0e8aa14ff7feab68ec668a86076",
          "sha": "9655edaec317f0e8aa14ff7feab68ec668a86076",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9655edaec317f0e8aa14ff7feab68ec668a86076"
        }
      ],
      "message": "validation: (re-)check all consensus rules when connecting blocks\n\nAt the moment we only sanity check part of the consensus rules when connecting blocks (only\nCheckBlock() is called in ConnectBlock()). This makes it hard to reason about software upgrades\nif we were to introduce new consensus rules. For instance a timewarp fix or a BIP34 supplementation\nwould go into CtxCheckBlock{Header}, and a block invalid according to the new rules could be let in\nby an unupgraded version and still be connected by an upgraded one.\n\nThese additional checks should not noticeably increase block propagation at tip since their expensive\npart (the witness merkle root check) has been cached since 1ec6bbeb8d27d31647d1433ccb87b362f6d81f90.\nThey would however have a performance impact on IBD as the cache is not leveraged there.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T19:56:01Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T18:56:08Z"
      },
      "sha": "ee05eb440310a1b9d6def8a26442433dffd1a122"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVjZTlhYzE3N2Q3MDFkYTNhNGZkYjU0ODQ1M2Q5ZDg3Y2M0ZWJhNDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "tree": {
        "sha": "1d4da5d43b32267ac8269b08d7b691cb56f64436",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1d4da5d43b32267ac8269b08d7b691cb56f64436"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ee05eb440310a1b9d6def8a26442433dffd1a122",
          "sha": "ee05eb440310a1b9d6def8a26442433dffd1a122",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ee05eb440310a1b9d6def8a26442433dffd1a122"
        }
      ],
      "message": "qa: sanity check ConnectBlock now checks all rules",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-05T20:06:51Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T20:04:32Z"
      },
      "sha": "ece9ac177d701da3a4fdb548453d9d87cc4eba49"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16200292021,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPFnNa1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16200292021",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "created_at": "2025-02-05T20:16:04Z"
    },
    {
      "event": "commented",
      "id": 2637944040,
      "node_id": "IC_kwDOABII586dO9To",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2637944040",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-05T20:21:29Z",
      "updated_at": "2025-02-07T16:25:30Z",
      "author_association": "MEMBER",
      "body": "> * (should also check `-reindex-chainstate` sees them too?)\r\n\r\nI tried to add a functional test for this but our test framework assumes an RPC interface is always available, and this error would happen before it is. This would make the test code really clunky, plus `verifychain` tests the same already and `feature_unsupported_utxo_db.py` implicitly tests this (not setting `-testactivationheight=segwit@2` with `-rescan-chainstate` would trigger a ConnectBlock error).\r\n\r\n> I think it would be better to just add declarations for the functions rather than shuffling the code around, and I would have separated the commits a bit differently\r\n\r\nI have now re-arranged the commits as you suggested (essentially just splitting the first commit in two), and used forward declarations instead of moving the function definitions. I also added more details to the commit, notably Martin's point that this change would probably have an impact on IBD.\r\n\r\n> It might be good to replace this comment [...] with the actual post-this-PR upgrade-behaviour, rather than just deleting it?\r\n\r\nI couldn't come up with any useful comment to replace it with. The original comment is a warning about the surprising original behavior. Now that the surprising behavior is removed, it makes sense to just delete the warning and not replace it with \"this does what you'd expect\"?\r\n\r\n---\r\n\r\nI started an IBD on top of this branch. EDIT: IBD completed successfully.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2637944040",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2638834293,
      "node_id": "IC_kwDOABII586dSWp1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2638834293",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T05:05:21Z",
      "updated_at": "2025-02-06T05:07:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> > It might be good to replace this comment [...] with the actual post-this-PR upgrade-behaviour, rather than just deleting it?\r\n> \r\n> I couldn't come up with any useful comment to replace it with. The original comment is a warning about the surprising original behavior. Now that the surprising behavior is removed, it makes sense to just delete the warning and not replace it with \"this does what you'd expect\"?\r\n\r\nI guess it's not obvious to me what you should expect here.\r\n\r\nI believe the current high-level behaviour with the PR is:\r\n\r\n * Running normally will continue from the current tip as if it were valid, even if it strictly isn't, you'll reorg to a valid chain automatically if it ever has more work. If you run invalidateblock on the first invalid block, you'll reorg back to that point and continue on to a valid chain, if one exists.\r\n * Running with -checklevel=4 will detect errors within the last 6 blocks (-checkblocks), and cause startup failure\r\n * Running with -reindex will detect errors anywhere, and leave you at the last valid block\r\n * Running with -reindex-chainstate will leave you stuck in an infinite loop revalidating an invalid tip?\r\n\r\nAs far as the low-level behaviour goes, eg, it's not clear to me why `TestBlockValidity()` needs to duplicate the checks (previously, it would have made some sense in order to ensure CheckBlock errors are reported prior to ContextualCheckBlock errors, but it seems less useful now).\r\n\r\nI guess it might make more sense to add a docstring for ConnectBlock that it (re)validates the block its connecting (and to what degree it does so), and move the \"Check it again in case a previous version\" comment to VerifyDB saying that this will catch errors in the examined blocks, and that invalidateblock, a -reindex or special handling like for segwit is necessary if you want to force a reorg onto an valid chain?",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2638834293",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2639237263,
      "node_id": "IC_kwDOABII586dT5CP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2639237263",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T09:15:24Z",
      "updated_at": "2025-02-06T09:15:53Z",
      "author_association": "MEMBER",
      "body": "Can you mention in the PR description that this builds on #31649? That also helps prevent review comments on the checkpoint change from being spread between two pull requests.\r\n\r\nThe first two `[refactor]` commits 0dad68ec06af4c53bf4a3cd6c266e8cb8fe5ef55 and 9655edaec317f0e8aa14ff7feab68ec668a86076 look correct to me.\r\n\r\nAlthough the `CheckHeaderNotFuture` is now performed earlier than before, it's cheap enough that this doesn't seem dangerous. The tests that it moves ahead of are similarly cheap.\r\n\r\nTechnically 9655edaec317f0e8aa14ff7feab68ec668a86076 should update this comment in `ConnectBlock()`:\r\n\r\n```cpp\r\n// Also, currently the rule against blocks more than 2 hours in the future\r\n// is enforced in ContextualCheckBlockHeader(); we wouldn't want to\r\n```\r\n\r\nBut you're already doing that in the next commit. It might just be confusing to update the comment twice.\r\n\r\nWill review the actual change of this PR later.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2639237263",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "reviewed",
      "id": 2598192203,
      "node_id": "PRR_kwDOABII586a3URL",
      "url": null,
      "actor": null,
      "commit_id": "9655edaec317f0e8aa14ff7feab68ec668a86076",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-06T09:58:28Z",
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2598192203",
      "submitted_at": "2025-02-06T09:58:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2598253714,
      "node_id": "PRR_kwDOABII586a3jSS",
      "url": null,
      "actor": null,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-02-06T13:08:56Z",
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2598253714",
      "submitted_at": "2025-02-06T13:08:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "commented",
      "id": 2639841215,
      "node_id": "IC_kwDOABII586dWMe_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2639841215",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T13:31:49Z",
      "updated_at": "2025-02-06T13:31:49Z",
      "author_association": "MEMBER",
      "body": "Some historical context. The 2 hour future check used to be in `CheckBlockHeader`, but was moved in #8068 (Compact Blocks) in order to \"prevent yet more includes and the crazy-looking GetAdjustedTime call from within the GetBlock stuff.\": https://github.com/bitcoin/bitcoin/pull/8068/files#r66835690\r\n\r\n> In order to avoid checking the merkle tree twice (which is incredibly expensive), I had to call CheckBlock, which required three #includes (including main.h) to blockencodings.cpp, despite them being really unrelated.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2639841215",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2640229392,
      "node_id": "IC_kwDOABII586dXrQQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640229392",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T15:58:00Z",
      "updated_at": "2025-02-06T15:59:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Running with -reindex-chainstate will leave you stuck in an infinite loop revalidating an invalid tip?\r\n\r\nI wouldn't expect that. `ConnectTip()` will call `InvalidBlockFound()` which should mark the block index as failed,  and we won't revalidate / instead will stay at the last valid block - same scenario as if it failed the script checks. \r\n\r\nI can see the infinite loop happening only if a previously admitted block fails with `BLOCK_MUTATED` during connection, but mutation rules shouldn't be affected by any of the currently discussed softforks?! ",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640229392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2640271485,
      "node_id": "IC_kwDOABII586dX1h9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640271485",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T16:08:38Z",
      "updated_at": "2025-02-06T16:08:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "> > Running with -reindex-chainstate will leave you stuck in an infinite loop revalidating an invalid tip?\r\n> \r\n> I wouldn't expect that. `ConnectTip()` will call `InvalidBlockFound()` which should mark the block index as failed, and we won't revalidate / instead will stay at the last valid block - same scenario as if it failed the script checks.\r\n> \r\n> I can see the infinite loop happening only if a previously admitted block fails with `BLOCK_MUTATED` during connection, but mutation rules shouldn't be affected by any of the currently discussed softforks?!\r\n\r\nAh, that's fair: I'm testing by mining some blocks then changing the segwit activation, so it's getting a \"CheckWitnessMalleation\" failure, because the blocks are marked as having been witness-verified.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640271485",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2640677459,
      "node_id": "IC_kwDOABII586dZYpT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640677459",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:24:03Z",
      "updated_at": "2025-02-06T18:24:03Z",
      "author_association": "CONTRIBUTOR",
      "body": "Given that this will likely make IBD a bit slower due to repeated checks, I think there should be more tangible benefits than just simpler reasoning about edge cases - or maybe it would be good to explain these edge cases a bit more to be able to judge how relevant they are.\r\n\r\nOnce we are synced to the tip, block acception and connection typically happen right after each other in `ProcessNewBlock()`, so I can only think of of rather far-fetched scenarios for the repeated checks to become relevant out of IBD:\r\nE.g. Bitcoind could be shutting down right after `AcceptBlock()` but before `ActivateBestChain()` finished, and then restart with different consensus rules under which the accepted block is invalid - this doesn't sound  very likely to happen in practice due to timing-issues - and even if did, it should resolve itself quickly when more blocks arrive and we reorg out of the invalid chain.\r\n\r\nAre there more realistic scenarios in which the double check would improve behavior compared to master?",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640677459",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2640695928,
      "node_id": "IC_kwDOABII586dZdJ4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640695928",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:33:44Z",
      "updated_at": "2025-02-06T18:33:44Z",
      "author_association": "MEMBER",
      "body": "This becomes a bit likelier in IBD, but i agree. As i [said yesterday on IRC](https://bitcoin-irc.chaincode.com/bitcoin-core-dev/2025-02-05#1738786490-1738786524;) i am not sure this change is worth doing especially since we can never really solve the issue of a non-upgraded node having accepted invalid blocks short of re-connecting the whole chain when upgrading.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640695928",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2640697895,
      "node_id": "IC_kwDOABII586dZdon",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640697895",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:34:49Z",
      "updated_at": "2025-02-06T18:34:49Z",
      "author_association": "MEMBER",
      "body": "I'll try to bug @sdaftuar, who introduced this comment, to see if we are missing something.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640697895",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "mentioned",
      "id": 16214473771,
      "node_id": "MEE_lADOABII586olmcWzwAAAAPGdTwr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16214473771",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:34:51Z"
    },
    {
      "event": "subscribed",
      "id": 16214473783,
      "node_id": "SE_lADOABII586olmcWzwAAAAPGdTw3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16214473783",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:34:51Z"
    },
    {
      "event": "commented",
      "id": 2640736710,
      "node_id": "IC_kwDOABII586dZnHG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2640736710",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-06T18:55:18Z",
      "updated_at": "2025-02-06T18:57:44Z",
      "author_association": "MEMBER",
      "body": "> short of re-connecting the whole chain when upgrading\r\n\r\nAs a generic method for all soft forks, it's the only way. And it's a potential pain, especially because for some reason unwinding is much slower than IBD (last time I tried). And doesn't work on a too-far-pruned node.\r\n\r\nBut for specific soft-forks there may be quicker ways. E.g. it's easy to scan the headers for timewarp violations. Checking coinbases for the new proposed BIP34 rule is only possible for non-pruned blocks, but would be quick (well, maybe not on a spinning disk without `-txindex`).\r\n\r\nThe new proposed sigops check on the other hand probably just requires an unwind. It would still be good to log a warning that we didn't retroactively check the new rule, and suggest using the RPC method to check if they want (with the caveat that it's slow and won't work on a too-far-pruned node).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2640736710",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2653664441,
      "node_id": "IC_kwDOABII586eK7S5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2653664441",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T13:07:36Z",
      "updated_at": "2025-02-12T13:10:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Given that this seemed like a change that would affect IBD, I ran a few reindex-chainstates and a few full IBDs to check for regressions.\r\nThe reindexes are usually very stable so I only ran 2 iterations of before and after, comparing a full reindex-chainstate until 880k against master.\r\n\r\n<details>\r\n<summary>reindex details</summary>\r\n\r\n```bash\r\nc59cbba518 update comment on MinimumChainWork check\r\nece9ac177d qa: sanity check ConnectBlock now checks all rules\r\n\r\nCOMMITS=\"c59cbba518fc8835b9b26040dd9974ae3cddedfa ece9ac177d701da3a4fdb548453d9d87cc4eba49\"; \\\r\nSTOP_HEIGHT=880000; DBCACHE=10000; \\\r\nC_COMPILER=gcc; CXX_COMPILER=g++; \\\r\nhyperfine \\\r\n--export-json \"/mnt/my_storage/rdx-${COMMITS/ /-}-${STOP_HEIGHT}-${DBCACHE}-${C_COMPILER}.json\" \\\r\n--runs 2 \\\r\n--parameter-list COMMIT ${COMMITS/ /,} \\\r\n--prepare \"killall bitcoind; rm -f /mnt/my_storage/BitcoinData/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF -DCMAKE_C_COMPILER=$C_COMPILER -DCMAKE_CXX_COMPILER=$CXX_COMPILER && cmake --build build -j$(nproc) --target bitcoind && ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=$STOP_HEIGHT -dbcache=10000 -printtoconsole=0 || true\" \\\r\n--cleanup \"cp /mnt/my_storage/BitcoinData/debug.log /mnt/my_storage/logs/debug-{COMMIT}-$(date +%s).log || true\" \\\r\n\"COMPILER=$C_COMPILER COMMIT={COMMIT} ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE -printtoconsole=0 -reindex-chainstate -connect=0\"\r\n\r\nBenchmark 1: COMPILER=gcc COMMIT=c59cbba518fc8835b9b26040dd9974ae3cddedfa ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0 -reindex-chainstate -connect=0\r\n  Time (mean Â± Ïƒ):     25451.781 s Â± 34.971 s    [User: 38952.582 s, System: 869.341 s]\r\n  Range (min â€¦ max):   25427.053 s â€¦ 25476.510 s    2 runs\r\n\r\nBenchmark 2: COMPILER=gcc COMMIT=ece9ac177d701da3a4fdb548453d9d87cc4eba49 ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0 -reindex-chainstate -connect=0\r\n  Time (mean Â± Ïƒ):     25707.027 s Â± 53.363 s    [User: 39183.014 s, System: 869.561 s]\r\n  Range (min â€¦ max):   25669.293 s â€¦ 25744.760 s    2 runs\r\n\r\nSummary\r\n  COMPILER=gcc COMMIT=c59cbba518fc8835b9b26040dd9974ae3cddedfa ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0 -reindex-chainstate -connect=0 ran\r\n    1.01 Â± 0.00 times faster than COMPILER=gcc COMMIT=ece9ac177d701da3a4fdb548453d9d87cc4eba49 ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0 -reindex-chainstate -connect=0\r\n```\r\n\r\n</details>\r\n\r\nthis results in a 1% slowdown - which is unfortunate, but I personally could live with that.\r\n\r\n-----\r\n\r\nThe full IBD however resulted in a bigger diff (which is more volatile so I ran each 3 times to get meaningful results):\r\n\r\n<details>\r\n<summary>IBD details</summary>\r\n\r\n```bash\r\nc59cbba518 update comment on MinimumChainWork check\r\nece9ac177d qa: sanity check ConnectBlock now checks all rules\r\n\r\nCOMMITS=\"c59cbba518fc8835b9b26040dd9974ae3cddedfa ece9ac177d701da3a4fdb548453d9d87cc4eba49\"; \\\r\nSTOP_HEIGHT=880000; DBCACHE=10000; \\\r\nC_COMPILER=gcc; CXX_COMPILER=g++; \\\r\nhyperfine \\\r\n--export-json \"/mnt/my_storage/ibd-${COMMITS/ /-}-${STOP_HEIGHT}-${DBCACHE}-${C_COMPILER}.json\" \\\r\n--runs 3 \\\r\n--parameter-list COMMIT ${COMMITS/ /,} \\\r\n--prepare \"killall bitcoind; rm -rf /mnt/my_storage/BitcoinData/*; git checkout {COMMIT}; git clean -fxd; git reset --hard; cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF -DCMAKE_C_COMPILER=$C_COMPILER -DCMAKE_CXX_COMPILER=$CXX_COMPILER && cmake --build build -j$(nproc) --target bitcoind && ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=1 -printtoconsole=0 || true\" \\\r\n--cleanup \"cp /mnt/my_storage/BitcoinData/debug.log /mnt/my_storage/logs/debug-{COMMIT}-$(date +%s).log || true\" \\\r\n\"COMPILER=$C_COMPILER COMMIT={COMMIT} ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE -printtoconsole=0\"\r\nBenchmark 1: COMPILER=gcc COMMIT=c59cbba518fc8835b9b26040dd9974ae3cddedfa ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     35311.267 s Â± 32.492 s    [User: 58346.765 s, System: 2046.013 s]\r\n  Range (min â€¦ max):   35275.243 s â€¦ 35338.360 s    3 runs\r\n\r\nBenchmark 2: COMPILER=gcc COMMIT=ece9ac177d701da3a4fdb548453d9d87cc4eba49 ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     36975.379 s Â± 964.756 s    [User: 59059.701 s, System: 2312.492 s]\r\n  Range (min â€¦ max):   36213.629 s â€¦ 38060.212 s    3 runs\r\n\r\nSummary\r\n  COMPILER=gcc COMMIT=c59cbba518fc8835b9b26040dd9974ae3cddedfa ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0 ran\r\n    1.05 Â± 0.03 times faster than COMPILER=gcc COMMIT=ece9ac177d701da3a4fdb548453d9d87cc4eba49 ./build/src/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=880000 -dbcache=10000 -printtoconsole=0\r\n```\r\n\r\n</details>\r\n\r\n\r\nSo on average it's **~4.7%** slower and in the best case it was **~2.6%** slower. I'm measuring the same again on a different server in reverse order to make sure this is representative, but this is a significant slowdown that I'd like us to eliminate - let me know how I can help, but until we do, it's an Approach NACK from my part.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2653664441",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2653904862,
      "node_id": "IC_kwDOABII586eL1_e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2653904862",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T14:40:12Z",
      "updated_at": "2025-02-12T14:40:12Z",
      "author_association": "MEMBER",
      "body": "Thanks, it's helpful to have numbers. I don't think a 3-4% IBD slowdown should necessarily be a deal breaker, but as discussed above i do not think this change is useful enough to be worth it.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2653904862",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2653926167,
      "node_id": "IC_kwDOABII586eL7MX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2653926167",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T14:46:14Z",
      "updated_at": "2025-02-12T14:46:14Z",
      "author_association": "MEMBER",
      "body": "> I'll try to bug `@`sdaftuar, who introduced this comment, to see if we are missing something.\r\n\r\nHad a quick chat about this with Suhas and a couple others at Chaincode. My takeaway from the discussion is that if we wanted this we should probably go all the way to actually re-validate past connected blocks that were not fully validated, not only those received but not yet connected. Also there is no reason to see this comment as a blocker to introduce new consensus rules (depending on the nature of the rule of course) when we have historically never supported this edge case.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2653926167",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2653935678,
      "node_id": "IC_kwDOABII586eL9g-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2653935678",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T14:48:31Z",
      "updated_at": "2025-02-12T14:48:31Z",
      "author_association": "MEMBER",
      "body": "I'll have a look at whether it's worth storing flags representing what rules have been checked against a block in the index, to enable re-validating past connected blocks against new rules when upgrading. In the meantime, this can be closed as i do not think it is worth doing on its own.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2653935678",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "closed",
      "id": 16282222300,
      "node_id": "CE_lADOABII586olmcWzwAAAAPKfv7c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16282222300",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T14:48:33Z"
    },
    {
      "event": "locked",
      "id": 22731759754,
      "node_id": "LOE_lADOABII586olmcWzwAAAAVK6yCK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22731759754",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-12T11:11:21Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940976853",
      "pull_request_review_id": 2592504179,
      "id": 1940976853,
      "node_id": "PRRC_kwDOABII585zsPTV",
      "diff_hunk": "@@ -4194,6 +4194,15 @@ arith_uint256 CalculateClaimedHeadersWork(std::span<const CBlockHeader> headers)\n     return total_work;\n }\n \n+/** Check the timestamp of the block header is not too far in the future. **/\n+static bool CheckHeaderNotFuture(const CBlockHeader& block, BlockValidationState& state)",
      "path": "src/validation.cpp",
      "position": 49,
      "original_position": 5,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62:\r\nCan you add some context to the commit message for why this move is being done? Maybe:\r\n\"A call to ContextualCheckBlockHeader is added to ConnectBlock in the following commits, but it should not re-check the timestamp of the header there. Move the timestamp check into a separate function to avoid this.\"",
      "created_at": "2025-02-04T11:15:21Z",
      "updated_at": "2025-02-04T11:17:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1940976853",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940976853"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4201,
      "original_line": 4201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940977644",
      "pull_request_review_id": 2592504179,
      "id": 1940977644,
      "node_id": "PRRC_kwDOABII585zsPfs",
      "diff_hunk": "@@ -4345,6 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n             LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckBlockHeader: %s, %s\\n\", __func__, hash.ToString(), state.ToString());\n             return false;\n         }\n+        if (!CheckHeaderNotFuture(block, state)) {\n+            LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckHeaderNotFuture: %s, %s\\n\", __func__, hash.ToString(), state.ToString());",
      "path": "src/validation.cpp",
      "position": 120,
      "original_position": 33,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Why is this not `LogError`?",
      "created_at": "2025-02-04T11:15:56Z",
      "updated_at": "2025-02-04T11:17:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1940977644",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940977644"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4333,
      "original_line": 4333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941306874",
      "pull_request_review_id": 2593082094,
      "id": 1941306874,
      "node_id": "PRRC_kwDOABII585ztf36",
      "diff_hunk": "@@ -277,6 +277,9 @@ def _test_getdeploymentinfo(self):\n         # calling with an explicit hash works\n         self.check_signalling_deploymentinfo_result(self.nodes[0].getdeploymentinfo(gbci207[\"bestblockhash\"]), gbci207[\"blocks\"], gbci207[\"bestblockhash\"], \"started\")\n \n+        # restart clean with default activation heights\n+        self.restart_node(0)",
      "path": "test/functional/rpc_blockchain.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "~~Should this line be in the following commit?~~\r\n\r\nNo, it shouldn't.",
      "created_at": "2025-02-04T14:40:02Z",
      "updated_at": "2025-02-04T15:27:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941306874",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941306874"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 272,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941355885",
      "pull_request_review_id": 2593165345,
      "id": 1941355885,
      "node_id": "PRRC_kwDOABII585ztr1t",
      "diff_hunk": "@@ -4194,6 +4194,15 @@ arith_uint256 CalculateClaimedHeadersWork(std::span<const CBlockHeader> headers)\n     return total_work;\n }\n \n+/** Check the timestamp of the block header is not too far in the future. **/\n+static bool CheckHeaderNotFuture(const CBlockHeader& block, BlockValidationState& state)",
      "path": "src/validation.cpp",
      "position": 49,
      "original_position": 5,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": 1940976853,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-02-04T15:05:22Z",
      "updated_at": "2025-02-04T15:05:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941355885",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941355885"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4201,
      "original_line": 4201,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941384261",
      "pull_request_review_id": 2593213711,
      "id": 1941384261,
      "node_id": "PRRC_kwDOABII585ztyxF",
      "diff_hunk": "@@ -4345,6 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n             LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckBlockHeader: %s, %s\\n\", __func__, hash.ToString(), state.ToString());\n             return false;\n         }\n+        if (!CheckHeaderNotFuture(block, state)) {\n+            LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckHeaderNotFuture: %s, %s\\n\", __func__, hash.ToString(), state.ToString());",
      "path": "src/validation.cpp",
      "position": 120,
      "original_position": 33,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": 1940977644,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "To keep the existing level for this error. I suppose the existing level is debug due to log-filling concerns, maybe with very-low-difficulty headers?\r\n\r\nThanks for pointing this out though, i double checked the other log line in `TestBlockValidity` and there it should have been `LogError`. Fixed.",
      "created_at": "2025-02-04T15:21:39Z",
      "updated_at": "2025-02-04T15:21:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941384261",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941384261"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4333,
      "original_line": 4333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941394003",
      "pull_request_review_id": 2593229959,
      "id": 1941394003,
      "node_id": "PRRC_kwDOABII585zt1JT",
      "diff_hunk": "@@ -277,6 +277,9 @@ def _test_getdeploymentinfo(self):\n         # calling with an explicit hash works\n         self.check_signalling_deploymentinfo_result(self.nodes[0].getdeploymentinfo(gbci207[\"bestblockhash\"]), gbci207[\"blocks\"], gbci207[\"bestblockhash\"], \"started\")\n \n+        # restart clean with default activation heights\n+        self.restart_node(0)",
      "path": "test/functional/rpc_blockchain.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "in_reply_to_id": 1941306874,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "No, it's to make this commit pass the test on its own. This is because this sub-test restart the node with a different deployment height for Segwit, and its caller then calls `verifychain`. This would fail if we don't restart the node with the default deployment height because `ConnectBlock` would detect unexpected witnesses before activation height. This is essentially what the next commit checks explicitly.",
      "created_at": "2025-02-04T15:27:17Z",
      "updated_at": "2025-02-04T15:27:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941394003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941394003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 272,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944416573",
      "pull_request_review_id": 2598162172,
      "id": 1944416573,
      "node_id": "PRRC_kwDOABII585z5XE9",
      "diff_hunk": "@@ -4345,6 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n             LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckBlockHeader: %s, %s\\n\", __func__, hash.ToString(), state.ToString());\n             return false;\n         }\n+        if (!CheckHeaderNotFuture(block, state)) {\n+            LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckHeaderNotFuture: %s, %s\\n\", __func__, hash.ToString(), state.ToString());",
      "path": "src/validation.cpp",
      "position": 120,
      "original_position": 33,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": 1940977644,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Someone else making an invalid block is not a reason for our node to shut down, so `LogError` would be wrong.\r\n\r\nWe also run this before the actual proof-of-work check, and headers can be sent repeatedly, so need to be careful about log spam.\r\n\r\nYou can however drop `__func__`, because we have `-logsourcelocations`.",
      "created_at": "2025-02-06T09:46:20Z",
      "updated_at": "2025-02-06T09:46:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1944416573",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944416573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4333,
      "original_line": 4333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944435217",
      "pull_request_review_id": 2598192203,
      "id": 1944435217,
      "node_id": "PRRC_kwDOABII585z5boR",
      "diff_hunk": "@@ -4669,6 +4667,10 @@ bool TestBlockValidity(BlockValidationState& state,\n     indexDummy.phashBlock = &block_hash;\n \n     // NOTE: CheckBlockHeader is called by CheckBlock\n+    if (!CheckHeaderNotFuture(block, state)) {\n+        LogError(\"%s: Consensus::CheckHeaderNotFuture: %s\\n\", __func__, state.ToString());",
      "path": "src/validation.cpp",
      "position": 131,
      "original_position": 29,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "9655edaec317f0e8aa14ff7feab68ec668a86076",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "9655edaec317f0e8aa14ff7feab68ec668a86076 nit: you can drop `__func__`.\r\n\r\nThe use of `LogError` here is fine; it's consistent with the other checks, failure here implies our mining subsystem is broken, and this code isn't accessible via p2p.\r\n\r\nIt also reminded me that I need to preserve this logging behavior in https://github.com/bitcoin/bitcoin/pull/31564#discussion_r1944441787",
      "created_at": "2025-02-06T09:58:28Z",
      "updated_at": "2025-02-06T10:04:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1944435217",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944435217"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4663,
      "original_line": 4671,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944473646",
      "pull_request_review_id": 2598253714,
      "id": 1944473646,
      "node_id": "PRRC_kwDOABII585z5lAu",
      "diff_hunk": "@@ -2451,16 +2454,8 @@ bool Chainstate::ConnectBlock(const CBlock& block, BlockValidationState& state,\n     const CChainParams& params{m_chainman.GetParams()};\n \n     // Check it again in case a previous version let a bad block in\n-    // NOTE: We don't currently (re-)invoke ContextualCheckBlock() or\n-    // ContextualCheckBlockHeader() here. This means that if we add a new\n-    // consensus rule that is enforced in one of those two functions, then we\n-    // may have let in a block that violates the rule prior to updating the\n-    // software, and we would NOT be enforcing the rule here. Fully solving\n-    // upgrade from one software version to the next after a consensus rule\n-    // change is potentially tricky and issue-specific (see NeedsRedownload()\n-    // for one approach that was used for BIP 141 deployment).",
      "path": "src/validation.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "ee05eb440310a1b9d6def8a26442433dffd1a122",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "ee05eb440310a1b9d6def8a26442433dffd1a122: dropping the \"Fully solving\" part of this remark seems too optimistic. When you upgrade a node after a soft-fork activates, we don't roll back and recheck.\r\n\r\nThe only thing this commit fixes are `-reindex(-chainstate)` and (manually called) `verifychain` scenarios.",
      "created_at": "2025-02-06T10:24:01Z",
      "updated_at": "2025-02-06T13:08:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1944473646",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944473646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2461,
      "original_line": 2461,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944480843",
      "pull_request_review_id": 2598253714,
      "id": 1944480843,
      "node_id": "PRRC_kwDOABII585z5mxL",
      "diff_hunk": "@@ -2451,16 +2454,8 @@ bool Chainstate::ConnectBlock(const CBlock& block, BlockValidationState& state,\n     const CChainParams& params{m_chainman.GetParams()};\n \n     // Check it again in case a previous version let a bad block in\n-    // NOTE: We don't currently (re-)invoke ContextualCheckBlock() or\n-    // ContextualCheckBlockHeader() here. This means that if we add a new\n-    // consensus rule that is enforced in one of those two functions, then we\n-    // may have let in a block that violates the rule prior to updating the\n-    // software, and we would NOT be enforcing the rule here. Fully solving\n-    // upgrade from one software version to the next after a consensus rule\n-    // change is potentially tricky and issue-specific (see NeedsRedownload()\n-    // for one approach that was used for BIP 141 deployment).\n-    // Also, currently the rule against blocks more than 2 hours in the future\n-    // is enforced in ContextualCheckBlockHeader(); we wouldn't want to\n+    // Note the rule against blocks more than 2 hours in the future\n+    // is not enforced in ContextualCheckBlockHeader(); we wouldn't want to\n     // re-enforce that rule here (at least until we make it impossible for\n     // the clock to go backward).",
      "path": "src/validation.cpp",
      "position": 27,
      "original_position": 27,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "ee05eb440310a1b9d6def8a26442433dffd1a122",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "ee05eb440310a1b9d6def8a26442433dffd1a122: this seems nonsensical to me, but it's pre-existing behavior. If you run `-reindex(-chainstate)` on a node with a broken clock, it seems perfectly fine to me that it's going to stop validation with an error. The user can then just fix their clock and continue.\r\n\r\nAdditionally, what if the users clock was too far in the future and they accidentally accepted a block they shouldn't have. It seems fine that during a reindex, after the user fixed their clock, such a block gets rejected if it's _still_ too far in the future.\r\n\r\nBut maybe I'm missing some consideration that went into this.\r\n\r\nIn any case I think it's fine to preserve the existing behavior in this regard, to keep the PR focussed.",
      "created_at": "2025-02-06T10:28:37Z",
      "updated_at": "2025-02-06T13:08:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1944480843",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944480843"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2460,
      "original_line": 2460,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944710838",
      "pull_request_review_id": 2598650981,
      "id": 1944710838,
      "node_id": "PRRC_kwDOABII585z6e62",
      "diff_hunk": "@@ -2451,16 +2454,8 @@ bool Chainstate::ConnectBlock(const CBlock& block, BlockValidationState& state,\n     const CChainParams& params{m_chainman.GetParams()};\n \n     // Check it again in case a previous version let a bad block in\n-    // NOTE: We don't currently (re-)invoke ContextualCheckBlock() or\n-    // ContextualCheckBlockHeader() here. This means that if we add a new\n-    // consensus rule that is enforced in one of those two functions, then we\n-    // may have let in a block that violates the rule prior to updating the\n-    // software, and we would NOT be enforcing the rule here. Fully solving\n-    // upgrade from one software version to the next after a consensus rule\n-    // change is potentially tricky and issue-specific (see NeedsRedownload()\n-    // for one approach that was used for BIP 141 deployment).\n-    // Also, currently the rule against blocks more than 2 hours in the future\n-    // is enforced in ContextualCheckBlockHeader(); we wouldn't want to\n+    // Note the rule against blocks more than 2 hours in the future\n+    // is not enforced in ContextualCheckBlockHeader(); we wouldn't want to\n     // re-enforce that rule here (at least until we make it impossible for\n     // the clock to go backward).",
      "path": "src/validation.cpp",
      "position": 27,
      "original_position": 27,
      "commit_id": "ece9ac177d701da3a4fdb548453d9d87cc4eba49",
      "original_commit_id": "ee05eb440310a1b9d6def8a26442433dffd1a122",
      "in_reply_to_id": 1944480843,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "cc @sdaftuar who wrote this comment in #11737",
      "created_at": "2025-02-06T13:18:28Z",
      "updated_at": "2025-02-06T13:18:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1944710838",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1944710838"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2460,
      "original_line": 2460,
      "side": "RIGHT"
    }
  ]
}
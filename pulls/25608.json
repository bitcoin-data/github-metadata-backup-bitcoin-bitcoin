{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608",
    "id": 995824731,
    "node_id": "PR_kwDOABII5847WxRb",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/25608",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/25608.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/25608.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/dd91f294206ac87b213d23bb76656a0a5f0f4781",
    "number": 25608,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "BResult improvements, allow returning values on failure",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is a draft PR trying to make some improvements to the `BResult` class to make it more usable. Adds a `util::Result` class with the following improvements (and implements `BResult` in terms of it so existing code doesn't have to change):\r\n\r\n- Supports returning error strings and error information at the same time. This functionality is needed by the `LoadChainstate` function in #25308 or any function that can fail in multiple ways which need to be handled differently. And it means Result class is compatible with rust-style error handling and pattern matching, unlike BResult.\r\n\r\n- Makes Result class provide same operators and methods as std::optional, so it doesn't require calling less familiar `HasRes`/`GetObj`/`ReleaseObj` methods, and so error reporting functionality can be easily added or dropped from existing code by switching between util::Result and std::optional.\r\n\r\n- Supports `Result<void>` return values, so it is possible to return error reporting information from functions in a uniform way even if they don't have other return values.\r\n\r\n- Supports `Result<bilingual_str>` return values. Drops ambiguous and potentially misleading `BResult` constructor that treats any bilingual string as an error, and any other type as a non-error. Adds `util::Error` constructor so errors have to be explicitly constructed and not any `bilingual_str` will be turned into one.\r\n\r\n- Puts `src/util/` code in the `util::` namespace so naming reflects code organization and it is obvious where the class is coming from. Drops \"B\" from name because it is undocumented what it stands for (bilingual?)\r\n\r\n- Adds unit tests.\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
    "labels": [],
    "created_at": "2022-07-13T18:40:13Z",
    "updated_at": "2023-07-21T10:13:49Z",
    "closed_at": "2022-07-21T12:55:48Z",
    "mergeable_state": "unknown",
    "merge_commit_sha": "1c8ab451a64b7b12e62c2a94a10e992e8eb086a7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "ryanofsky:pr/bresult",
      "ref": "pr/bresult",
      "sha": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 69901633,
        "node_id": "MDEwOlJlcG9zaXRvcnk2OTkwMTYzMw==",
        "name": "bitcoin",
        "full_name": "ryanofsky/bitcoin",
        "owner": {
          "login": "ryanofsky",
          "id": 7133040,
          "node_id": "MDQ6VXNlcjcxMzMwNDA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ryanofsky",
          "html_url": "https://github.com/ryanofsky",
          "followers_url": "https://api.github.com/users/ryanofsky/followers",
          "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
          "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
          "repos_url": "https://api.github.com/users/ryanofsky/repos",
          "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ryanofsky/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ryanofsky/bitcoin",
        "archive_url": "https://api.github.com/repos/ryanofsky/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ryanofsky/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ryanofsky/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ryanofsky/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ryanofsky/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ryanofsky/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ryanofsky/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ryanofsky/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ryanofsky/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ryanofsky/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ryanofsky/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ryanofsky/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ryanofsky/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ryanofsky/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ryanofsky/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ryanofsky/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ryanofsky/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ryanofsky/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ryanofsky/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ryanofsky/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ryanofsky/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ryanofsky/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ryanofsky/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ryanofsky/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ryanofsky/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ryanofsky/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ryanofsky/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ryanofsky/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ryanofsky/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ryanofsky/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ryanofsky/bitcoin/hooks",
        "svn_url": "https://github.com/ryanofsky/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 8,
        "stargazers_count": 9,
        "watchers_count": 9,
        "size": 231874,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-02T19:06:27Z",
        "created_at": "2016-10-03T19:05:43Z",
        "updated_at": "2023-07-28T06:57:01Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ad466b85cd8e6cd138518c3247086eaf83f427f1",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35476,
        "stargazers_count": 70608,
        "watchers_count": 70608,
        "size": 236222,
        "default_branch": "master",
        "open_issues_count": 672,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-08-02T23:26:31Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-08-02T18:21:18Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 225,
    "deletions": 26,
    "changed_files": 5,
    "commits": 1,
    "review_comments": 15,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 1183561635,
      "node_id": "IC_kwDOABII585Gi7ej",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183561635",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-13T18:48:07Z",
      "updated_at": "2022-07-13T18:48:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "I would like to clean this up more and implement it on top of #25308 so the LoadChainstate function can use this class. But this class contains all the essential things I think are missing from BResult: support for error values, support for void values, support for multiple errors, chained errors, and warnings.\r\n\r\nWas motivated to work on this by suggestion to use BResult in #25308 https://github.com/bitcoin/bitcoin/pull/25308#issuecomment-1181674645 and by #25601, which adds the same error type functionality this PR does, but doesn't support returning custom errors for error handling and returning standardized errors for error reporting at the same time.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#issuecomment-1183561635",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608"
    },
    {
      "event": "reviewed",
      "id": 1037818667,
      "node_id": "PRR_kwDOABII584929sr",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1037818667",
      "submitted_at": "2022-07-13T18:48:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "reviewed",
      "id": 1037820622,
      "node_id": "PRR_kwDOABII58492-LO",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Nice! Concept ACK",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1037820622",
      "submitted_at": "2022-07-13T18:53:11Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "reviewed",
      "id": 1037837927,
      "node_id": "PRR_kwDOABII58493CZn",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1037837927",
      "submitted_at": "2022-07-13T19:05:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-13T19:14:43Z",
      "updated_at": "2022-07-13T19:14:43Z",
      "source": {
        "issue": {
          "id": 1302783338,
          "node_id": "PR_kwDOABII5847TWiW",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25601",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25601/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25601/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25601/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25601",
          "number": 25601,
          "state": "closed",
          "state_reason": null,
          "title": "util: Make `BResult` error a generic type instead of only `bilingual_str`",
          "body": "This PR makes `BResult` error a generic type instead of only `bilingual_str` and changes the class name to `StructuredResult` as `BResut` is not related to the purpose of the class.\r\n\r\nThe motivation is that some methods, like `src/wallet/wallet.h:{RestoreWallet(...),CreateWallet(...),LoadWallet(...)}` have more output parameters than just `bilingual_str& error` such as `DatabaseStatus& status` and `std::vector<bilingual_str>& warnings`.\r\n\r\nWith a generic template for error, it will be possible to create a struct that has `bilingual_str& error` and `DatabaseStatus& status`, for example, and use it in `StructuredResult`.\r\n\r\nBuilt on top of #25594",
          "user": {
            "login": "w0xlt",
            "id": 94266259,
            "node_id": "U_kgDOBZ5jkw",
            "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/w0xlt",
            "html_url": "https://github.com/w0xlt",
            "followers_url": "https://api.github.com/users/w0xlt/followers",
            "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
            "organizations_url": "https://api.github.com/users/w0xlt/orgs",
            "repos_url": "https://api.github.com/users/w0xlt/repos",
            "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/w0xlt/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25601",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25601",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25601.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25601.patch"
          },
          "closed_at": "2022-08-03T04:15:11Z",
          "created_at": "2022-07-13T01:20:46Z",
          "updated_at": "2022-08-03T04:15:12Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1037890573,
      "node_id": "PRR_kwDOABII58493PQN",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK. I don't have a strong opinion between this approach or #25601.\r\n\r\nBut I don't think we should maintain `BResult`. As done at https://github.com/bitcoin/bitcoin/pull/25601, the use of `BResult` should be replaced by the new interface.\r\n\r\nIt's going to be confusing to have a class that shouldn't be used anymore, as said in the comment, when that can easily be replaced.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1037890573",
      "submitted_at": "2022-07-13T19:52:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "reviewed",
      "id": 1037899819,
      "node_id": "PRR_kwDOABII58493Rgr",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1037899819",
      "submitted_at": "2022-07-13T20:01:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "commented",
      "id": 1183954772,
      "node_id": "IC_kwDOABII585GkbdU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1183954772",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T03:51:24Z",
      "updated_at": "2022-07-19T22:48:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#25601](https://github.com/bitcoin/bitcoin/pull/25601) (util: Make `BResult` error a generic type instead of only `bilingual_str` by w0xlt)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#issuecomment-1183954772",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T04:07:24Z",
      "updated_at": "2022-07-14T04:07:24Z",
      "source": {
        "issue": {
          "id": 1302078651,
          "node_id": "PR_kwDOABII5847Q-KG",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25594",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25594/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25594/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25594/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25594",
          "number": 25594,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Return BResult from restoreWallet",
          "body": "This avoids the `error` in-out param (and if `warnings` is added to `BResult`, it will avoid passing that in-out param as well).\r\n\r\nAlso, as it is needed for this change, prepare `BResult` for non-copyable types.",
          "user": {
            "login": "MarcoFalke",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/MarcoFalke",
            "html_url": "https://github.com/MarcoFalke",
            "followers_url": "https://api.github.com/users/MarcoFalke/followers",
            "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
            "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
            "repos_url": "https://api.github.com/users/MarcoFalke/repos",
            "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25594",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25594",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25594.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25594.patch"
          },
          "closed_at": "2022-07-14T08:05:48Z",
          "created_at": "2022-07-12T13:37:47Z",
          "updated_at": "2023-07-16T10:13:10Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 6992522810,
      "node_id": "LE_lADOABII585NtnaZzwAAAAGgyW46",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/6992522810",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-14T09:12:22Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1038713947,
      "node_id": "PRR_kwDOABII58496YRb",
      "url": null,
      "actor": null,
      "commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1038713947",
      "submitted_at": "2022-07-14T11:27:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRkOTFmMjk0MjA2YWM4N2IyMTNkMjNiYjc2NjU2YTBhNWYwZjQ3ODE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "tree": {
        "sha": "c653e4c9e14e7ec98728a9946f3aff300564d44b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c653e4c9e14e7ec98728a9946f3aff300564d44b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/948f5ba6363fcc64f95fed3f04dbda3d50d61827",
          "sha": "948f5ba6363fcc64f95fed3f04dbda3d50d61827",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/948f5ba6363fcc64f95fed3f04dbda3d50d61827"
        }
      ],
      "message": "BResult improvements\n\nThis is a draft commit trying to make some improvements to the `BResult` class to make it more usable. Adds a `util::Result` class with the following improvements (and implements `BResult` in terms of it so existing code doesn't have to change):\n\n- Supports returning error strings and error information at the same time. This functionality is needed by the `LoadChainstate` function in #25308 or any function that can fail in multiple ways which need to be handled differently. And it means Result class is compatible with rust-style error handling and pattern matching, unlike BResult.\n\n- Makes Result class provide same operators and methods as std::optional, so it doesn't require calling less familiar `HasRes`/`GetObj`/`ReleaseObj` methods, and so error reporting functionality can be easily added or dropped from existing code by switching between util::Result and std::optional.\n\n- Supports `Result<void>` return values, so it is possible to return error reporting information from functions in a uniform way even if they don't have other return values.\n\n- Supports `Result<bilingual_str>` return values. Drops ambiguous and potentially misleading `BResult` constructor that treats any bilingual string as an error, and any other type as a non-error. Adds `util::Error` constructor so errors have to be explicitly constructed and not any `bilingual_str` will be turned into one.\n\n- Puts `src/util/` code in the `util::` namespace so naming reflects code organization and it is obvious where the class is coming from. Drops \"B\" from name because it is undocumented what it stands for (bilingual?)\n\n- Adds unit tests.",
      "committer": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2022-07-19T11:29:05Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2022-07-13T18:32:18Z"
      },
      "sha": "dd91f294206ac87b213d23bb76656a0a5f0f4781"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7022355200,
      "node_id": "HRFPE_lADOABII585NtnaZzwAAAAGikKMA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7022355200",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T16:43:13Z"
    },
    {
      "event": "commented",
      "id": 1189322624,
      "node_id": "IC_kwDOABII585G45-A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1189322624",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T16:45:48Z",
      "updated_at": "2022-07-19T16:45:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased 39769cc0599a93cbc28e693f6fccbabedae67fb5 -> dd91f294206ac87b213d23bb76656a0a5f0f4781 ([`pr/bresult.2`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult.2) -> [`pr/bresult.3`](https://github.com/ryanofsky/bitcoin/commits/pr/bresult.3), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/bresult.2-rebase..pr/bresult.3)) due to conflict with #25594\r\n\r\n(@martinus suggestion to optimize happy path when there are no warnings or errors a makes a lot of sense so I started implementing that, but I figured I'd rebase this in the meantime due to the conflict)",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#issuecomment-1189322624",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608"
    },
    {
      "event": "mentioned",
      "id": 7022374273,
      "node_id": "MEE_lADOABII585NtnaZzwAAAAGikO2B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7022374273",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T16:45:49Z"
    },
    {
      "event": "subscribed",
      "id": 7022374280,
      "node_id": "SE_lADOABII585NtnaZzwAAAAGikO2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7022374280",
      "actor": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T16:45:49Z"
    },
    {
      "event": "unlabeled",
      "id": 7022485742,
      "node_id": "UNLE_lADOABII585NtnaZzwAAAAGikqDu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7022485742",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-19T17:03:08Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1045428196,
      "node_id": "PRR_kwDOABII584-T_fk",
      "url": null,
      "actor": null,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#pullrequestreview-1045428196",
      "submitted_at": "2022-07-20T17:38:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
    },
    {
      "event": "renamed",
      "id": 7037993990,
      "node_id": "RTE_lADOABII585NtnaZzwAAAAGjf0QG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7037993990",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T12:45:47Z",
      "rename": {
        "from": "BResult improvements",
        "to": "BResult improvements, allow returning values on failure"
      }
    },
    {
      "event": "commented",
      "id": 1191450773,
      "node_id": "IC_kwDOABII585HBBiV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1191450773",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T12:55:48Z",
      "updated_at": "2022-07-21T12:55:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Closing for now in favor of #25665 which implements Martinus suggestion. Will post a comparison of different approaches there.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#issuecomment-1191450773",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25608"
    },
    {
      "event": "closed",
      "id": 7038071505,
      "node_id": "CE_lADOABII585NtnaZzwAAAAGjgHLR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7038071505",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-21T12:55:48Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-07-27T16:45:24Z",
      "updated_at": "2022-07-27T16:45:24Z",
      "source": {
        "issue": {
          "id": 1313204802,
          "node_id": "PR_kwDOABII58472hm-",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25665",
          "number": 25665,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Add util::Result failure values, multiple error and warning messages",
          "body": "Add `util::Result` support for returning more error information and make use of it in [LoadChainstate method](https://github.com/bitcoin/bitcoin/pull/25665/commits/584e3fa4ea8ca15b3a8b46e023f218c5e0ed73b0) as an initial application. Followup PR [#25722](https://github.com/bitcoin/bitcoin/pull/25722) uses it more broadly to return errors and warnings from wallet loading functions as well.\r\n\r\nThis change adds two major features to the result class:\r\n\r\n- For better error handling, adds the ability to return a value on failure, not just a value on success. This is a key missing feature that makes the result class not useful for functions like `LoadChainstate()` which produce different errors that need to be handled differently [^1].\r\n\r\n[^1]: Ability to return error values was actually present in the original implementation of [#25218](https://github.com/bitcoin/bitcoin/pull/25218), but unfortunately removed in later iterations.\r\n\r\n- For better error reporting, adds the ability to return warning messages and multiple errors, not just a single error string. This provides a way for functions to report errors and warnings in a standard way, and simplifies interfaces:\r\n\r\n    ```diff\r\n    -virtual std::unique_ptr<Wallet> loadWallet(const std::string& name, bilingual_str& error, std::vector<bilingual_str>& warnings) = 0;\r\n    +virtual util::Result<std::unique_ptr<Wallet>> loadWallet(const std::string& name) = 0;\r\n    ```\r\n\r\n    ```diff\r\n    -std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const DatabaseOptions& options, DatabaseStatus& status, bilingual_str& error);\r\n    +util::Result<std::unique_ptr<WalletDatabase>, DatabaseError> MakeDatabase(const fs::path& path, const DatabaseOptions& options);\r\n   ```\r\n\r\nThis change also makes some more minor improvements:\r\n\r\n- Smaller type size. `util::Result<int>` is 16 bytes, and `util::Result<void>` is 8 bytes. Previously both were 72 bytes.\r\n\r\n- Broader type compatibility. Supports noncopyable and nonmovable success and error types.\r\n\r\n### Alternatives & design notes\r\n\r\nThe main goal for the `util::Result` class is to provide a standard way for functions to report error and warnings strings. The interface tries to make it easy to provide detailed error feedback to end users, without cluttering code or making it harder to return other result information. There have been multiple iterations of the design using different internal representations and providing different capabilities:\r\n\r\n|   | Representation (approximate)                   | Notes |\r\n|---|------------------------------------------------|-------|\r\n| _(1)_ | `tuple<T,optional<bilingual_str>>`        | Original #25218 implementation in da98fd2efc1a6b9c6e876cf3e227a8c2e9a10827. Good capabilities, but larger type size. Supports error standardized error reporting and customized error handling with failure values. |\r\n| _(2)_ | `variant<T,bilingual_str>`                | Final #25218 implementation in 7a45c33d1f8a758850cf8e7bd6ad508939ba5c0d. No support for returning failure values so not useful in many cases.\r\n| _(3)_ | `variant<monostate,T,F>`                 | Pending #25601 implementation that allows choosing whether to use standardized error reporting or return custom failure values, but doesn't support having both at the same time, like approaches _(1)_, _(4)_, _(5)_, _(6)_ do. |\r\n | _(4)_ | `tuple<variant<T,F>,bilingual_str>`      | Original #25608 implementation in c29d3008de9314dd463ed08e8bff39fe55324498. Basically the same as _(1)_ except it uses separate success and failure types instead of the same type. Using separate success and failure types makes the result class a little less flexible but can help avoid some ambiguity and inconsistent result states. |\r\n| _(5)_ | `tuple<T,optional<bilingual_str>>`        | Final #25608 implementation in dd91f294206ac87b213d23bb76656a0a5f0f4781. Essentially the same as original implementation _(1)_ except has some usability improvements. |\r\n| _(6)_ | `tuple<T,unique_ptr<tuple<F,bilingual_str>>` | Pending #25665 implementation (this PR). Supports returning failure values, uses separate success and failure types to avoid ambiguity, uses `unique_ptr` to reduce result type size, and avoids heap allocation in the happy path. |\r\n\r\n### Prior discussions & history\r\n\r\n- _furszy_ introduced a `BResult` class providing a standard error reporting mechanism in [#25218](https://github.com/bitcoin/bitcoin/pull/25218). It was renamed to `util::Result` in [#25721](https://github.com/bitcoin/bitcoin/pull/25721) but kept the same representation and capabilities.\r\n\r\n- _MarcoFalke_ suggested using `BResult` for the `LoadChainstate` function in [#25308 (comment)](https://github.com/bitcoin/bitcoin/pull/25308#issuecomment-1181674645). Inability to use `BResult` there due to lack of support for failure values led to initial work on [#25608](https://github.com/bitcoin/bitcoin/pull/25608).\r\n\r\n- _w0xlt_ wrote a `StructuredResult` class in [#25308](https://github.com/bitcoin/bitcoin/pull/25601) adding the ability to return failure values but sacrificing standard error reporting, which led to more work on [#25608](https://github.com/bitcoin/bitcoin/pull/25608).\r\n\r\n- _martinus_ suggested a space optimization in [#25608 (comment)](https://github.com/bitcoin/bitcoin/pull/25608#discussion_r921049409) that also made it easier to support distinct failure & success types, leading to [#25665](https://github.com/bitcoin/bitcoin/pull/25665) as a replacement for [#25608](https://github.com/bitcoin/bitcoin/pull/25608).",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 19,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25665",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25665.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25665.patch"
          },
          "created_at": "2022-07-21T12:46:09Z",
          "updated_at": "2023-08-02T23:32:58Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "locked",
      "id": 9883770670,
      "node_id": "LOE_lADOABII585NtnaZzwAAAAJNHl8u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9883770670",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-21T10:13:49Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920399401",
      "pull_request_review_id": 1037818667,
      "id": 920399401,
      "node_id": "PRRC_kwDOABII58423C4p",
      "diff_hunk": "@@ -0,0 +1,14 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+#include <util/string.h>\n+\n+namespace util {\n+bilingual_str ErrorDescription(const Result<void>& result)",
      "path": "src/util/result.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Any reason not to just include this as a method called e.g. `result.ErrorsStr()`?",
      "created_at": "2022-07-13T18:48:16Z",
      "updated_at": "2022-07-13T18:52:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920399401",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920399401"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 9,
      "original_line": 9,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920400885",
      "pull_request_review_id": 1037820622,
      "id": 920400885,
      "node_id": "PRRC_kwDOABII58423DP1",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n public:\n-    BResult() : m_variant(Untranslated(\"\")) {}\n-    BResult(const T& _obj) : m_variant(_obj) {}\n-    BResult(const bilingual_str& error) : m_variant(error) {}\n+    //! Success case constructor.\n+    Result() = default;\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n+    }\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if",
      "path": "src/util/result.h",
      "position": 104,
      "original_position": 100,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think you meant `Result<T>`",
      "created_at": "2022-07-13T18:50:06Z",
      "updated_at": "2022-07-13T18:53:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920400885",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920400885"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 84,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920403378",
      "pull_request_review_id": 1037824186,
      "id": 920403378,
      "node_id": "PRRC_kwDOABII58423D2y",
      "diff_hunk": "@@ -0,0 +1,14 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+#include <util/string.h>\n+\n+namespace util {\n+bilingual_str ErrorDescription(const Result<void>& result)",
      "path": "src/util/result.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 920399401,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is an error formatting function and I think Result class should only be responsible for returning errors, not formatting them.\r\n\r\nAlso I generally think classes with private state should have fewer methods accessing that state to keep code readable and maintainable. If a function can use a class's public interface, it should use that instead of poking around at internals.",
      "created_at": "2022-07-13T18:53:16Z",
      "updated_at": "2022-07-13T18:53:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920403378",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920403378"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 9,
      "original_line": 9,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920409067",
      "pull_request_review_id": 1037831980,
      "id": 920409067,
      "node_id": "PRRC_kwDOABII58423FPr",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n public:\n-    BResult() : m_variant(Untranslated(\"\")) {}\n-    BResult(const T& _obj) : m_variant(_obj) {}\n-    BResult(const bilingual_str& error) : m_variant(error) {}\n+    //! Success case constructor.\n+    Result() = default;\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n+    }\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if",
      "path": "src/util/result.h",
      "position": 104,
      "original_position": 100,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 920400885,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I think you meant `Result<T>`\r\n\r\nI should probably rewrite this comment but it is trying to say if you have an existing function returning `std::optional<T>` you can most likely change it to return `util::Result<T>` and provide error information to new callers without affecting existing callers.",
      "created_at": "2022-07-13T19:00:19Z",
      "updated_at": "2022-07-13T19:00:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920409067",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920409067"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 84,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920413028",
      "pull_request_review_id": 1037837927,
      "id": 920413028,
      "node_id": "PRRC_kwDOABII58423GNk",
      "diff_hunk": "@@ -0,0 +1,106 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(result_tests)\n+\n+util::Result<void> VoidSuccessFn()\n+{\n+    return {};\n+}\n+\n+util::Result<void> VoidFailFn()\n+{\n+    return {util::Error{}, Untranslated(\"void fail\")};\n+}\n+\n+util::Result<int> IntSuccessFn(int ret)\n+{\n+    return {ret};\n+}\n+\n+util::Result<int> IntFailFn()\n+{\n+    return {util::Error{}, Untranslated(\"int fail\")};\n+}\n+\n+enum FnStatus { SUCCESS, ERR1, ERR2 };\n+\n+util::Result<FnStatus> StatusSuccessFn(FnStatus ret)\n+{\n+    return {ret};\n+}\n+\n+util::Result<FnStatus> StatusFailFn(FnStatus ret)\n+{\n+    return {util::Error{}, Untranslated(\"status fail\"), ret};\n+}\n+\n+util::Result<int> ChainedFailFn(FnStatus arg, int ret)\n+{\n+    return {util::ErrorChain{}, Untranslated(\"chained fail\"), StatusFailFn(arg), ret};",
      "path": "src/test/result_tests.cpp",
      "position": 45,
      "original_position": 45,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": null,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Might be nice to have an interface that uses static constructor shorthands for concision, like\r\n```cpp\r\nreturn Result::Err(ret, StatusFailFn(arg), Untranslated(\"chained fail\"));\r\n```\r\nor for the function above\r\n```cpp\r\nreturn Result::Err(ret, Untranslated(\"status fail\"));\r\n```\r\n\r\nEdit: ah, I guess not so easy because in practice `Result` would need to be templated.",
      "created_at": "2022-07-13T19:05:41Z",
      "updated_at": "2022-07-13T19:07:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920413028",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920413028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 45,
      "original_line": 45,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920424075",
      "pull_request_review_id": 1037853599,
      "id": 920424075,
      "node_id": "PRRC_kwDOABII58423I6L",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n public:\n-    BResult() : m_variant(Untranslated(\"\")) {}\n-    BResult(const T& _obj) : m_variant(_obj) {}\n-    BResult(const bilingual_str& error) : m_variant(error) {}\n+    //! Success case constructor.\n+    Result() = default;\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n+    }\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if",
      "path": "src/util/result.h",
      "position": 104,
      "original_position": 100,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 920400885,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh yeah, my mistake, misread :sweat_smile:. Existing comment seems fine.",
      "created_at": "2022-07-13T19:20:42Z",
      "updated_at": "2022-07-13T19:21:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920424075",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920424075"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 84,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920425479",
      "pull_request_review_id": 1037855580,
      "id": 920425479,
      "node_id": "PRRC_kwDOABII58423JQH",
      "diff_hunk": "@@ -0,0 +1,106 @@\n+// Copyright (c) 2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <util/result.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_AUTO_TEST_SUITE(result_tests)\n+\n+util::Result<void> VoidSuccessFn()\n+{\n+    return {};\n+}\n+\n+util::Result<void> VoidFailFn()\n+{\n+    return {util::Error{}, Untranslated(\"void fail\")};\n+}\n+\n+util::Result<int> IntSuccessFn(int ret)\n+{\n+    return {ret};\n+}\n+\n+util::Result<int> IntFailFn()\n+{\n+    return {util::Error{}, Untranslated(\"int fail\")};\n+}\n+\n+enum FnStatus { SUCCESS, ERR1, ERR2 };\n+\n+util::Result<FnStatus> StatusSuccessFn(FnStatus ret)\n+{\n+    return {ret};\n+}\n+\n+util::Result<FnStatus> StatusFailFn(FnStatus ret)\n+{\n+    return {util::Error{}, Untranslated(\"status fail\"), ret};\n+}\n+\n+util::Result<int> ChainedFailFn(FnStatus arg, int ret)\n+{\n+    return {util::ErrorChain{}, Untranslated(\"chained fail\"), StatusFailFn(arg), ret};",
      "path": "src/test/result_tests.cpp",
      "position": 45,
      "original_position": 45,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 920413028,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It would be possible and not very difficult to change syntax from\r\n\r\n```c++\r\nreturn {util::Error{}, \"error string\", error_value};\r\n``` \r\n\r\nto\r\n\r\n```c++\r\nreturn util::Error(\"error string\", error_value);\r\n```\r\n\r\nfor both Error and ErrorChain with some template magic. It just made the implementation a little uglier so I decided to drop it.",
      "created_at": "2022-07-13T19:22:37Z",
      "updated_at": "2022-07-13T19:22:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920425479",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920425479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 45,
      "original_line": 45,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920454434",
      "pull_request_review_id": 1037899819,
      "id": 920454434,
      "node_id": "PRRC_kwDOABII58423QUi",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n public:\n-    BResult() : m_variant(Untranslated(\"\")) {}\n-    BResult(const T& _obj) : m_variant(_obj) {}\n-    BResult(const bilingual_str& error) : m_variant(error) {}\n+    //! Success case constructor.\n+    Result() = default;\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n+    }\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }",
      "path": "src/util/result.h",
      "position": 85,
      "original_position": 81,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe a `GetWarnings()` method ?\r\nOr `m_errors` and `m_warnings` can be public.\r\nI think there are some success cases that also return warnings. ",
      "created_at": "2022-07-13T20:01:00Z",
      "updated_at": "2022-07-13T20:16:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r920454434",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/920454434"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 65,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921049409",
      "pull_request_review_id": 1038713947,
      "id": 921049409,
      "node_id": "PRRC_kwDOABII58425hlB",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;",
      "path": "src/util/result.h",
      "position": 50,
      "original_position": 44,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": null,
      "user": {
        "login": "martinus",
        "id": 14386,
        "node_id": "MDQ6VXNlcjE0Mzg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/14386?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/martinus",
        "html_url": "https://github.com/martinus",
        "followers_url": "https://api.github.com/users/martinus/followers",
        "following_url": "https://api.github.com/users/martinus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/martinus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/martinus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/martinus/subscriptions",
        "organizations_url": "https://api.github.com/users/martinus/orgs",
        "repos_url": "https://api.github.com/users/martinus/repos",
        "events_url": "https://api.github.com/users/martinus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/martinus/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "how about moving the members into a single `std::unique_ptr`, something like this:\r\n\r\n```cpp\r\nprotected:\r\n    struct ErrorsAndWarnings {\r\n            std::vector<bilingual_str> m_errors;\r\n            std::vector<bilingual_str> m_warnings;\r\n    };\r\n    std::unique_ptr<ErrorsAndWarnings> m_errors_and_warnings{};\r\n```\r\n\r\nThis has the advantage that the default case when no error/warning happens is really fast: no temporary `std::vector` need to be constructed. Also, `sizeof()` is much smaller, only a single pointer. Then `Result` is also noncopyable. I think this would be an advantage, because usually these are supposed to be moved as the return value, and not copied.",
      "created_at": "2022-07-14T11:27:15Z",
      "updated_at": "2022-07-14T11:27:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r921049409",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/921049409"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 41,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925879666",
      "pull_request_review_id": 1045428196,
      "id": 925879666,
      "node_id": "PRRC_kwDOABII5843L81y",
      "diff_hunk": "@@ -7,42 +7,119 @@\n \n #include <util/translation.h>\n \n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n \n-public:\n-    BResult() : m_variant{Untranslated(\"\")} {}\n-    BResult(T obj) : m_variant{std::move(obj)} {}\n-    BResult(bilingual_str error) : m_variant{std::move(error)} {}\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+public:\n+    //! Success case constructor.\n+    Result() = default;\n+\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n-    T ReleaseObj()\n+\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n     {\n-        assert(HasRes());\n-        return std::move(std::get<T>(m_variant));\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if",
      "path": "src/util/result.h",
      "position": 104,
      "original_position": 104,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think this is true? `std::optional` with `nullopt` must not be dereferenced, whereas `Result` can be, and would return a default constructed object?",
      "created_at": "2022-07-20T17:34:42Z",
      "updated_at": "2022-07-20T17:38:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r925879666",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925879666"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 84,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925882047",
      "pull_request_review_id": 1045428196,
      "id": 925882047,
      "node_id": "PRRC_kwDOABII5843L9a_",
      "diff_hunk": "@@ -7,42 +7,119 @@\n \n #include <util/translation.h>\n \n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n \n-public:\n-    BResult() : m_variant{Untranslated(\"\")} {}\n-    BResult(T obj) : m_variant{std::move(obj)} {}\n-    BResult(bilingual_str error) : m_variant{std::move(error)} {}\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+public:\n+    //! Success case constructor.\n+    Result() = default;\n+\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n-    T ReleaseObj()\n+\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n     {\n-        assert(HasRes());\n-        return std::move(std::get<T>(m_variant));\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if\n+    //! it is no longer needed.\n+    bool has_value() const { return m_errors.empty(); }\n+    const T& value() const { return m_result; }\n+    T& value() { return m_result; }\n+    template<typename U> T value_or(const U& default_value) const\n+    {\n+        return has_value() ? value() : default_value;\n     }\n+    const T* operator->() const { return &value(); }\n+    const T& operator*() const { return value(); }\n+    T* operator->() { return &value(); }\n+    T& operator*() { return value(); }\n+};\n+\n+//! Helper method to retrieve a simple error string from Result<T> or\n+//! Result<void>.\n+bilingual_str ErrorDescription(const Result<void>& result);\n+} // namespace util\n \n+/**\n+ * Backwards-compatible interface for util::Result class. New code should prefer\n+ * util::Result class which supports returning error information along with\n+ * result information and supports returing `void` and `bilingual_str` results.\n+*/\n+template<class T>\n+class BResult {\n+private:\n+    util::Result<std::optional<T>> m_result;",
      "path": "src/util/result.h",
      "position": 132,
      "original_position": 132,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't think this is too helpful to force most call sites (that can use BResult or use it today) into a double wrapping `util::Result<std::optional<T>>`. I liked a single wrapping better.",
      "created_at": "2022-07-20T17:37:35Z",
      "updated_at": "2022-07-20T17:38:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r925882047",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/925882047"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926632645",
      "pull_request_review_id": 1046469268,
      "id": 926632645,
      "node_id": "PRRC_kwDOABII5843O0rF",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;",
      "path": "src/util/result.h",
      "position": 50,
      "original_position": 44,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 921049409,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> how about moving the members into a single `std::unique_ptr`, something like this:\r\n\r\nThis is a great idea, and implemented in #25665",
      "created_at": "2022-07-21T12:47:26Z",
      "updated_at": "2022-07-21T12:56:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r926632645",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926632645"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 41,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926633493",
      "pull_request_review_id": 1046469268,
      "id": 926633493,
      "node_id": "PRRC_kwDOABII5843O04V",
      "diff_hunk": "@@ -6,37 +6,117 @@\n #define BITCOIN_UTIL_RESULT_H\n \n #include <util/translation.h>\n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n+\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n+\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n public:\n-    BResult() : m_variant(Untranslated(\"\")) {}\n-    BResult(const T& _obj) : m_variant(_obj) {}\n-    BResult(const bilingual_str& error) : m_variant(error) {}\n+    //! Success case constructor.\n+    Result() = default;\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n+    }\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }",
      "path": "src/util/result.h",
      "position": 85,
      "original_position": 81,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "39769cc0599a93cbc28e693f6fccbabedae67fb5",
      "in_reply_to_id": 920454434,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Maybe a `GetWarnings()` method ? Or `m_errors` and `m_warnings` can be public. I think there are some success cases that also return warnings.\r\n\r\nYes sorry interface is just incomplete while in draft.",
      "created_at": "2022-07-21T12:48:20Z",
      "updated_at": "2022-07-21T12:56:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r926633493",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926633493"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 65,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926636596",
      "pull_request_review_id": 1046469268,
      "id": 926636596,
      "node_id": "PRRC_kwDOABII5843O1o0",
      "diff_hunk": "@@ -7,42 +7,119 @@\n \n #include <util/translation.h>\n \n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n \n-public:\n-    BResult() : m_variant{Untranslated(\"\")} {}\n-    BResult(T obj) : m_variant{std::move(obj)} {}\n-    BResult(bilingual_str error) : m_variant{std::move(error)} {}\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+public:\n+    //! Success case constructor.\n+    Result() = default;\n+\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n-    T ReleaseObj()\n+\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n     {\n-        assert(HasRes());\n-        return std::move(std::get<T>(m_variant));\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if",
      "path": "src/util/result.h",
      "position": 104,
      "original_position": 104,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "in_reply_to_id": 925879666,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I don't think this is true? `std::optional` with `nullopt` must not be dereferenced, whereas `Result` can be, and would return a default constructed object?\r\n\r\nI can clarify comment, but this interface is superset of std::optional interface and allows dereferencing in cases when original object can't be derefenced. The object does not have to be default constructable since util::Error{} can forward any constructor arguments",
      "created_at": "2022-07-21T12:51:24Z",
      "updated_at": "2022-07-21T12:56:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r926636596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926636596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 84,
      "original_line": 84,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926638792",
      "pull_request_review_id": 1046469268,
      "id": 926638792,
      "node_id": "PRRC_kwDOABII5843O2LI",
      "diff_hunk": "@@ -7,42 +7,119 @@\n \n #include <util/translation.h>\n \n-#include <variant>\n+#include <optional>\n \n-/*\n- * 'BResult' is a generic class useful for wrapping a return object\n- * (in case of success) or propagating the error cause.\n-*/\n-template<class T>\n-class BResult {\n-private:\n-    std::variant<bilingual_str, T> m_variant;\n+namespace util {\n \n-public:\n-    BResult() : m_variant{Untranslated(\"\")} {}\n-    BResult(T obj) : m_variant{std::move(obj)} {}\n-    BResult(bilingual_str error) : m_variant{std::move(error)} {}\n+//! Function result type intended for high-level functions that return error and\n+//! warning strings in addition to normal result types.\n+//!\n+//! The Result<T> class is meant to be a drop-in replacement for\n+//! std::optional<T> except it has additional methods to return error and\n+//! warning strings for error reporting. Also, unlike std::optional, in order to\n+//! support error handling in cases where callees need to pass additional\n+//! information about failures back to callers, Result<T> objects can always be\n+//! dereferenced regardless of the function's success or failure.\n+//!\n+//! This class is not intended to be used by low-level functions that do not\n+//! return error or warning strings. These functions should use plain\n+//! std::optional or std::variant types instead.\n+//!\n+//! See unit tests in result_tests.cpp for example usages.\n+template<typename T>\n+class Result;\n+\n+//! Tag types for result constructors.\n+struct Error{};\n+struct ErrorChain{};\n \n-    /* Whether the function succeeded or not */\n-    bool HasRes() const { return std::holds_alternative<T>(m_variant); }\n+//! Result<void> specialization. Only returns errors and warnings, no values.\n+template<>\n+class Result<void>\n+{\n+protected:\n+    std::vector<bilingual_str> m_errors;\n+    std::vector<bilingual_str> m_warnings;\n \n-    /* In case of success, the result object */\n-    const T& GetObj() const {\n-        assert(HasRes());\n-        return std::get<T>(m_variant);\n+public:\n+    //! Success case constructor.\n+    Result() = default;\n+\n+    //! Error case constructor for a single error.\n+    Result(Error, bilingual_str error)\n+    {\n+        m_errors.emplace_back(std::move(error));\n     }\n-    T ReleaseObj()\n+\n+    //! Error case constructor for a chained error.\n+    Result(ErrorChain, bilingual_str error, Result<void>&& previous) : m_errors{std::move(previous.m_errors)}, m_warnings{std::move(previous.m_warnings)}\n     {\n-        assert(HasRes());\n-        return std::move(std::get<T>(m_variant));\n+        m_errors.emplace_back(std::move(error));\n     }\n \n-    /* In case of failure, the error cause */\n-    const bilingual_str& GetError() const {\n-        assert(!HasRes());\n-        return std::get<bilingual_str>(m_variant);\n+    //! Success check.\n+    operator bool() const { return m_errors.empty(); }\n+\n+    //! Error retrieval.\n+    const std::vector<bilingual_str>& GetErrors() const { return m_errors; }\n+    std::tuple<const std::vector<bilingual_str>&, const std::vector<bilingual_str>&> GetErrorsAndWarnings() const { return {m_errors, m_warnings}; }\n+};\n+\n+template<typename T>\n+class Result : public Result<void>\n+{\n+protected:\n+    T m_result;\n+\n+public:\n+    //! Constructors that forward to the base class and pass additional arguments to m_result.\n+    template<typename... Args>\n+    Result(Args&&... args) : m_result{std::forward<Args>(args)...} {}\n+    template<typename Str, typename...Args>\n+    Result(Error, Str&& str, Args&&... args) : Result<void>{Error{}, std::forward<Str>(str)}, m_result{std::forward<Args>(args)...} {};\n+    template<typename Str, typename Prev, typename...Args>\n+    Result(ErrorChain, Str&& str, Prev&& prev, Args&&... args) : Result<void>{ErrorChain{}, std::forward<Str>(str), std::forward<Prev>(prev)}, m_result{std::forward<Args>(args)...} {};\n+\n+    //! std::optional methods, so Result<T> can be easily swapped for\n+    //! std::optional<T> to add error reporting to existing code or remove it if\n+    //! it is no longer needed.\n+    bool has_value() const { return m_errors.empty(); }\n+    const T& value() const { return m_result; }\n+    T& value() { return m_result; }\n+    template<typename U> T value_or(const U& default_value) const\n+    {\n+        return has_value() ? value() : default_value;\n     }\n+    const T* operator->() const { return &value(); }\n+    const T& operator*() const { return value(); }\n+    T* operator->() { return &value(); }\n+    T& operator*() { return value(); }\n+};\n+\n+//! Helper method to retrieve a simple error string from Result<T> or\n+//! Result<void>.\n+bilingual_str ErrorDescription(const Result<void>& result);\n+} // namespace util\n \n+/**\n+ * Backwards-compatible interface for util::Result class. New code should prefer\n+ * util::Result class which supports returning error information along with\n+ * result information and supports returing `void` and `bilingual_str` results.\n+*/\n+template<class T>\n+class BResult {\n+private:\n+    util::Result<std::optional<T>> m_result;",
      "path": "src/util/result.h",
      "position": 132,
      "original_position": 132,
      "commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "original_commit_id": "dd91f294206ac87b213d23bb76656a0a5f0f4781",
      "in_reply_to_id": 925882047,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> I don't think this is too helpful to force most call sites (that can use BResult or use it today) into a double wrapping `util::Result<std::optional<T>>`. I liked a single wrapping better.\r\n\r\nRight this was supposed to be only temporary within the PR. A followup commit basically like 6a06a7c3ad264c0ddf4904949839be1ade8011a5 (from #25665) would replace `BResult<T>` with `util::Result<T>`\r\n\r\nstd::optional was used here just because it's the simplest type definition that preserves BResult semantics.",
      "created_at": "2022-07-21T12:53:30Z",
      "updated_at": "2022-07-21T12:58:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/25608#discussion_r926638792",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/926638792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25608"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 112,
      "original_line": 112,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448",
    "id": 1109891769,
    "node_id": "PR_kwDOABII585CJ5q5",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/26448",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/26448.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/26448.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26448",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26448/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/74d975318a1443aebfbcee36e331df4e54ec1fbe",
    "number": 26448,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "test: fix intermittent failure in p2p_sendtxrcncl.py",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`p2p_sendtxrcncl.py` currently fails intermittently in the CI, see e.g. https://cirrus-ci.com/task/5511952184115200?logs=ci#L4024\r\n\r\nI believe that this is related to the reuse of the parameter `p2p_idx=2` of `add_outbound_p2p_connection` in this test: When we call `peer_disconnect`, we don't wait until the node has completed the disconnection. So there is a race between setting up the next connection (next  `addconnection` RPC), and if the old one hasn't been removed and has an identical port like the new one (because we didn't increment `p2p_idx`), `CConnman::OpenNetworkConnection` just [returns](https://github.com/bitcoin/bitcoin/blob/5274f324375fd31cf8507531fbc612765d03092f/src/net.cpp#L1976) without establishing a connection, and the test fails.\r\n\r\nFix this by using distinct `disconnect_p2ps` instead of `peer_disconnect`, which waits for the disconnect to complete. We can then use the same value for `p2p_idx` everywhere.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2022-11-03T17:06:07Z",
    "updated_at": "2022-11-04T20:55:54Z",
    "closed_at": "2022-11-04T15:52:06Z",
    "mergeable_state": "unknown",
    "merged_at": "2022-11-04T15:52:06Z",
    "merge_commit_sha": "e42ba134f4a06980cb2d8a134a50ada5562063d8",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "mzumsande:202211_fix_sendtxrcncl",
      "ref": "202211_fix_sendtxrcncl",
      "sha": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 187673073,
        "node_id": "MDEwOlJlcG9zaXRvcnkxODc2NzMwNzM=",
        "name": "bitcoin",
        "full_name": "mzumsande/bitcoin",
        "owner": {
          "login": "mzumsande",
          "id": 48763452,
          "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
          "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/mzumsande",
          "html_url": "https://github.com/mzumsande",
          "followers_url": "https://api.github.com/users/mzumsande/followers",
          "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
          "organizations_url": "https://api.github.com/users/mzumsande/orgs",
          "repos_url": "https://api.github.com/users/mzumsande/repos",
          "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/mzumsande/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/mzumsande/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/mzumsande/bitcoin",
        "archive_url": "https://api.github.com/repos/mzumsande/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/mzumsande/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/mzumsande/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/mzumsande/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/mzumsande/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/mzumsande/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/mzumsande/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/mzumsande/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/mzumsande/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/mzumsande/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/mzumsande/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/mzumsande/bitcoin/events",
        "forks_url": "https://api.github.com/repos/mzumsande/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/mzumsande/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/mzumsande/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/mzumsande/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/mzumsande/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/mzumsande/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/mzumsande/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/mzumsande/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/mzumsande/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/mzumsande/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/mzumsande/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/mzumsande/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/mzumsande/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:mzumsande/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/mzumsande/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/mzumsande/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/mzumsande/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/mzumsande/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/mzumsande/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/mzumsande/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/mzumsande/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/mzumsande/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/mzumsande/bitcoin/hooks",
        "svn_url": "https://github.com/mzumsande/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 216760,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-05T17:01:53Z",
        "created_at": "2019-05-20T16:03:10Z",
        "updated_at": "2023-06-07T20:16:50Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "28653a596ab7e0811ffec3bbb7632e17d54f8e43",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34349,
        "stargazers_count": 69857,
        "watchers_count": 69857,
        "size": 234261,
        "default_branch": "master",
        "open_issues_count": 631,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-09T11:53:48Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-09T12:01:40Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 19,
    "deletions": 15,
    "changed_files": 2,
    "commits": 1,
    "review_comments": 9,
    "comments": 3
  },
  "events": [
    {
      "event": "labeled",
      "id": 7734322352,
      "node_id": "LE_lADOABII585ViFuYzwAAAAHNAGSw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7734322352",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-03T17:08:10Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "reviewed",
      "id": 1167375907,
      "node_id": "PRR_kwDOABII585FlL4j",
      "url": null,
      "actor": null,
      "commit_id": "b1cc46d57d1aa6448356cb40fa59df133890a72f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "lgtm, but I am not really a fan of writing racy tests unless racyness is the goal of the test.",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#pullrequestreview-1167375907",
      "submitted_at": "2022-11-03T17:18:58Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7735720828,
      "node_id": "HRFPE_lADOABII585ViFuYzwAAAAHNFbt8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7735720828",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-03T20:35:24Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc0ZDk3NTMxOGExNDQzYWViZmJjZWUzNmUzMzFkZjRlNTRlYzFmYmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "tree": {
        "sha": "217b8e1fa0734da6ad818a5069051eac2198bb91",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/217b8e1fa0734da6ad818a5069051eac2198bb91"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5274f324375fd31cf8507531fbc612765d03092f",
          "sha": "5274f324375fd31cf8507531fbc612765d03092f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5274f324375fd31cf8507531fbc612765d03092f"
        }
      ],
      "message": "test: fix intermittent failure in p2p_sendtxrcncl.py\n\nUsing disconnect_p2ps instead of peer_disconnect makes\nthe node wait for the disconnect to complete. As a result,\nwe can reuse p2p_idx=0 in the add_outbound_p2p_connection calls.",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2022-11-03T20:41:50Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2022-11-03T15:46:07Z"
      },
      "sha": "74d975318a1443aebfbcee36e331df4e54ec1fbe"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 7735761999,
      "node_id": "HRFPE_lADOABII585ViFuYzwAAAAHNFlxP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7735761999",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-03T20:42:24Z"
    },
    {
      "event": "commented",
      "id": 1303194792,
      "node_id": "IC_kwDOABII585NrSyo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303194792",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-04T09:55:57Z",
      "updated_at": "2022-11-04T09:55:57Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#26359](https://github.com/bitcoin/bitcoin/pull/26359) (p2p, refactor: #23443 (Erlay support signaling) follow-ups by naumenkogs)\n* [#26257](https://github.com/bitcoin/bitcoin/pull/26257) (script, test: python linter fixups and updates by jonatack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#issuecomment-1303194792",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26448"
    },
    {
      "event": "reviewed",
      "id": 1168333340,
      "node_id": "PRR_kwDOABII585Fo1oc",
      "url": null,
      "actor": null,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "thanks, however this fixes one race, but introduces two more",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#pullrequestreview-1168333340",
      "submitted_at": "2022-11-04T11:12:31Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
    },
    {
      "event": "commented",
      "id": 1303697491,
      "node_id": "IC_kwDOABII585NtNhT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1303697491",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-04T15:02:25Z",
      "updated_at": "2022-11-04T15:02:25Z",
      "author_association": "MEMBER",
      "body": "review ACK 74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#issuecomment-1303697491",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26448"
    },
    {
      "event": "merged",
      "id": 7741995645,
      "node_id": "ME_lADOABII585ViFuYzwAAAAHNdXp9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7741995645",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e42ba134f4a06980cb2d8a134a50ada5562063d8",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e42ba134f4a06980cb2d8a134a50ada5562063d8",
      "created_at": "2022-11-04T15:52:06Z"
    },
    {
      "event": "closed",
      "id": 7741995673,
      "node_id": "CE_lADOABII585ViFuYzwAAAAHNdXqZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7741995673",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-04T15:52:06Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 7742727503,
      "node_id": "HRDE_lADOABII585ViFuYzwAAAAHNgKVP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7742727503",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-04T17:31:59Z"
    },
    {
      "event": "commented",
      "id": 1304246879,
      "node_id": "IC_kwDOABII585NvTpf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1304246879",
      "actor": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-11-04T20:55:53Z",
      "updated_at": "2022-11-04T20:55:53Z",
      "author_association": "MEMBER",
      "body": "Post-merge ACK",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#issuecomment-1304246879",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26448"
    },
    {
      "event": "referenced",
      "id": 7744848578,
      "node_id": "REFE_lADOABII585ViFuYzwAAAAHNoQLC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7744848578",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7d09b61ed57942d31f15541f98ccc49151535465",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/7d09b61ed57942d31f15541f98ccc49151535465",
      "created_at": "2022-11-05T03:46:41Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013199935",
      "pull_request_review_id": 1167375907,
      "id": 1013199935,
      "node_id": "PRRC_kwDOABII5848ZDQ_",
      "diff_hunk": "@@ -625,6 +625,9 @@ def add_outbound_p2p_connection(self, p2p_conn, *, wait_for_verack=True, p2p_idx\n \n         This method adds the p2p connection to the self.p2ps list and returns\n         the connection to the caller.\n+\n+        p2p_idx must be different for simultaneously connected peers. Reusing it for the next peer\n+        after disconnecting the previous one can lead to a race condition and should be avoided.",
      "path": "test/functional/test_framework/test_node.py",
      "position": null,
      "original_position": 6,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "b1cc46d57d1aa6448356cb40fa59df133890a72f",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: the race wouldn't happen with disconnect_p2ps",
      "created_at": "2022-11-03T17:16:33Z",
      "updated_at": "2022-11-03T17:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013199935",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013199935"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013201223",
      "pull_request_review_id": 1167375907,
      "id": 1013201223,
      "node_id": "PRRC_kwDOABII5848ZDlH",
      "diff_hunk": "@@ -155,36 +155,41 @@ def run_test(self):\n         peer.peer_disconnect()\n \n         self.log.info('SENDTXRCNCL sent to an outbound')\n+        ob_peer_id = 0\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=1, connection_type=\"outbound-full-relay\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=ob_peer_id, connection_type=\"outbound-full-relay\")\n         assert peer.sendtxrcncl_msg_received\n         assert peer.sendtxrcncl_msg_received.initiator\n         assert not peer.sendtxrcncl_msg_received.responder\n         assert_equal(peer.sendtxrcncl_msg_received.version, 1)\n         peer.peer_disconnect()",
      "path": "test/functional/p2p_sendtxrcncl.py",
      "position": null,
      "original_position": 12,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "b1cc46d57d1aa6448356cb40fa59df133890a72f",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: If there is no guarantee that this will disconnect the peer (due to races), it might be better to remove it, or replace it with `disconnect_p2ps`, which would also avoid having to modify the index.",
      "created_at": "2022-11-03T17:17:42Z",
      "updated_at": "2022-11-03T17:18:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013201223",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013201223"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013373838",
      "pull_request_review_id": 1167629753,
      "id": 1013373838,
      "node_id": "PRRC_kwDOABII5848ZtuO",
      "diff_hunk": "@@ -625,6 +625,9 @@ def add_outbound_p2p_connection(self, p2p_conn, *, wait_for_verack=True, p2p_idx\n \n         This method adds the p2p connection to the self.p2ps list and returns\n         the connection to the caller.\n+\n+        p2p_idx must be different for simultaneously connected peers. Reusing it for the next peer\n+        after disconnecting the previous one can lead to a race condition and should be avoided.",
      "path": "test/functional/test_framework/test_node.py",
      "position": null,
      "original_position": 6,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "b1cc46d57d1aa6448356cb40fa59df133890a72f",
      "in_reply_to_id": 1013199935,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed the wording.",
      "created_at": "2022-11-03T20:35:36Z",
      "updated_at": "2022-11-03T20:35:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013373838",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013373838"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013375811",
      "pull_request_review_id": 1167632576,
      "id": 1013375811,
      "node_id": "PRRC_kwDOABII5848ZuND",
      "diff_hunk": "@@ -155,36 +155,41 @@ def run_test(self):\n         peer.peer_disconnect()\n \n         self.log.info('SENDTXRCNCL sent to an outbound')\n+        ob_peer_id = 0\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=1, connection_type=\"outbound-full-relay\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=ob_peer_id, connection_type=\"outbound-full-relay\")\n         assert peer.sendtxrcncl_msg_received\n         assert peer.sendtxrcncl_msg_received.initiator\n         assert not peer.sendtxrcncl_msg_received.responder\n         assert_equal(peer.sendtxrcncl_msg_received.version, 1)\n         peer.peer_disconnect()",
      "path": "test/functional/p2p_sendtxrcncl.py",
      "position": null,
      "original_position": 12,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "b1cc46d57d1aa6448356cb40fa59df133890a72f",
      "in_reply_to_id": 1013201223,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ok, I used `disconnect_p2ps` everywhere instead of `peer_disconnect`, and also  changed `p2p_idx=0` everywhere for consistency - this should also work.",
      "created_at": "2022-11-03T20:38:07Z",
      "updated_at": "2022-11-03T20:38:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013375811",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013375811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 165,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013886636",
      "pull_request_review_id": 1168333340,
      "id": 1013886636,
      "node_id": "PRRC_kwDOABII5848bq6s",
      "diff_hunk": "@@ -152,39 +152,39 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['Forget txreconciliation state of peer']):\n             peer.send_message(create_sendtxrcncl_msg())\n             peer.send_message(msg_verack())\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL sent to an outbound')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=1, connection_type=\"outbound-full-relay\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"outbound-full-relay\")\n         assert peer.sendtxrcncl_msg_received\n         assert peer.sendtxrcncl_msg_received.initiator\n         assert not peer.sendtxrcncl_msg_received.responder\n         assert_equal(peer.sendtxrcncl_msg_received.version, 1)\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL should not be sent if block-relay-only')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=2, connection_type=\"block-relay-only\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"block-relay-only\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info(\"SENDTXRCNCL should not be sent if feeler\")\n-        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=2, connection_type=\"feeler\")\n+        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=0, connection_type=\"feeler\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL if block-relay-only triggers a disconnect')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            PeerNoVerack(), wait_for_verack=False, p2p_idx=3, connection_type=\"block-relay-only\")\n+            PeerNoVerack(), wait_for_verack=False, p2p_idx=0, connection_type=\"block-relay-only\")\n         with self.nodes[0].assert_debug_log([\"we indicated no tx relay; disconnecting\"]):\n             peer.send_message(create_sendtxrcncl_msg(initiator=False))\n             peer.wait_for_disconnect()",
      "path": "test/functional/p2p_sendtxrcncl.py",
      "position": 75,
      "original_position": 75,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this is racy, so you'd have to call `self.nodes[0].disconnect_p2ps()` or use a unique index",
      "created_at": "2022-11-04T11:10:49Z",
      "updated_at": "2022-11-04T11:12:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013886636",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013886636"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 182,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013887303",
      "pull_request_review_id": 1168333340,
      "id": 1013887303,
      "node_id": "PRRC_kwDOABII5848brFH",
      "diff_hunk": "@@ -625,6 +625,10 @@ def add_outbound_p2p_connection(self, p2p_conn, *, wait_for_verack=True, p2p_idx\n \n         This method adds the p2p connection to the self.p2ps list and returns\n         the connection to the caller.\n+\n+        p2p_idx must be different for simultaneously connected peers. When reusing it for the next peer\n+        after disconnecting the previous one, it is necessary to wait for the disconnect to finish to avoid\n+        a race condition.",
      "path": "test/functional/test_framework/test_node.py",
      "position": 7,
      "original_position": 7,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "in_reply_to_id": null,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Maybe mention that `disconnect_p2ps` avoids the race?",
      "created_at": "2022-11-04T11:11:38Z",
      "updated_at": "2022-11-04T11:12:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1013887303",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1013887303"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 631,
      "original_line": 631,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014127574",
      "pull_request_review_id": 1168695868,
      "id": 1014127574,
      "node_id": "PRRC_kwDOABII5848clvW",
      "diff_hunk": "@@ -152,39 +152,39 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['Forget txreconciliation state of peer']):\n             peer.send_message(create_sendtxrcncl_msg())\n             peer.send_message(msg_verack())\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL sent to an outbound')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=1, connection_type=\"outbound-full-relay\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"outbound-full-relay\")\n         assert peer.sendtxrcncl_msg_received\n         assert peer.sendtxrcncl_msg_received.initiator\n         assert not peer.sendtxrcncl_msg_received.responder\n         assert_equal(peer.sendtxrcncl_msg_received.version, 1)\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL should not be sent if block-relay-only')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=2, connection_type=\"block-relay-only\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"block-relay-only\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info(\"SENDTXRCNCL should not be sent if feeler\")\n-        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=2, connection_type=\"feeler\")\n+        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=0, connection_type=\"feeler\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL if block-relay-only triggers a disconnect')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            PeerNoVerack(), wait_for_verack=False, p2p_idx=3, connection_type=\"block-relay-only\")\n+            PeerNoVerack(), wait_for_verack=False, p2p_idx=0, connection_type=\"block-relay-only\")\n         with self.nodes[0].assert_debug_log([\"we indicated no tx relay; disconnecting\"]):\n             peer.send_message(create_sendtxrcncl_msg(initiator=False))\n             peer.wait_for_disconnect()",
      "path": "test/functional/p2p_sendtxrcncl.py",
      "position": 75,
      "original_position": 75,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "in_reply_to_id": 1013886636,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can you explain why? We called `disconnect_p2ps()` before `add_outbound_p2p_connection`, so are guaranteed to have no peer when doing so. Within the`with` block we call `wait_for_disconnect` (which waits until the disconnect initiated by the node is completed), so the subsequent subtest  also shouldn't be able to run before the disconnect of the current one is completed. What am I missing? ",
      "created_at": "2022-11-04T14:57:24Z",
      "updated_at": "2022-11-04T14:57:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1014127574",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014127574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 182,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014132735",
      "pull_request_review_id": 1168709269,
      "id": 1014132735,
      "node_id": "PRRC_kwDOABII5848cm__",
      "diff_hunk": "@@ -152,39 +152,39 @@ def run_test(self):\n         with self.nodes[0].assert_debug_log(['Forget txreconciliation state of peer']):\n             peer.send_message(create_sendtxrcncl_msg())\n             peer.send_message(msg_verack())\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL sent to an outbound')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=1, connection_type=\"outbound-full-relay\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"outbound-full-relay\")\n         assert peer.sendtxrcncl_msg_received\n         assert peer.sendtxrcncl_msg_received.initiator\n         assert not peer.sendtxrcncl_msg_received.responder\n         assert_equal(peer.sendtxrcncl_msg_received.version, 1)\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL should not be sent if block-relay-only')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=2, connection_type=\"block-relay-only\")\n+            SendTxrcnclReceiver(), wait_for_verack=True, p2p_idx=0, connection_type=\"block-relay-only\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info(\"SENDTXRCNCL should not be sent if feeler\")\n-        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=2, connection_type=\"feeler\")\n+        peer = self.nodes[0].add_outbound_p2p_connection(P2PFeelerReceiver(), p2p_idx=0, connection_type=\"feeler\")\n         assert not peer.sendtxrcncl_msg_received\n-        peer.peer_disconnect()\n+        self.nodes[0].disconnect_p2ps()\n \n         self.log.info('SENDTXRCNCL if block-relay-only triggers a disconnect')\n         peer = self.nodes[0].add_outbound_p2p_connection(\n-            PeerNoVerack(), wait_for_verack=False, p2p_idx=3, connection_type=\"block-relay-only\")\n+            PeerNoVerack(), wait_for_verack=False, p2p_idx=0, connection_type=\"block-relay-only\")\n         with self.nodes[0].assert_debug_log([\"we indicated no tx relay; disconnecting\"]):\n             peer.send_message(create_sendtxrcncl_msg(initiator=False))\n             peer.wait_for_disconnect()",
      "path": "test/functional/p2p_sendtxrcncl.py",
      "position": 75,
      "original_position": 75,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "in_reply_to_id": 1013886636,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh, right. As the disconnect happens on the side of the node, there shouldn't be a race where the node is not aware of the disconnect.",
      "created_at": "2022-11-04T15:02:09Z",
      "updated_at": "2022-11-04T15:02:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1014132735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014132735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 182,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014196166",
      "pull_request_review_id": 1168794345,
      "id": 1014196166,
      "node_id": "PRRC_kwDOABII5848c2fG",
      "diff_hunk": "@@ -625,6 +625,10 @@ def add_outbound_p2p_connection(self, p2p_conn, *, wait_for_verack=True, p2p_idx\n \n         This method adds the p2p connection to the self.p2ps list and returns\n         the connection to the caller.\n+\n+        p2p_idx must be different for simultaneously connected peers. When reusing it for the next peer\n+        after disconnecting the previous one, it is necessary to wait for the disconnect to finish to avoid\n+        a race condition.",
      "path": "test/functional/test_framework/test_node.py",
      "position": 7,
      "original_position": 7,
      "commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "original_commit_id": "74d975318a1443aebfbcee36e331df4e54ec1fbe",
      "in_reply_to_id": 1013887303,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I tried to describe it in more general terms because `disconnect_p2ps` can only be used if there is no other, unrelated connection that we need to keep.",
      "created_at": "2022-11-04T15:46:44Z",
      "updated_at": "2022-11-04T15:46:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/26448#discussion_r1014196166",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1014196166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26448"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 631,
      "original_line": 631,
      "side": "RIGHT"
    }
  ]
}
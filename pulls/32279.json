{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32279",
    "id": 2461191229,
    "node_id": "PR_kwDOABII586Sssw9",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32279",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32279.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32279.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32279/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32279/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
    "number": 32279,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "[IBD] prevector: allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This change is part of [[IBD] - Tracking PR for speeding up Initial Block Download](https://github.com/bitcoin/bitcoin/pull/32043)\r\n\r\n### Summary\r\n\r\nThe current `prevector` size of 28 bytes (chosen to fill the `sizeof(CScript)` aligned size) was introduced in 2015 (https://github.com/bitcoin/bitcoin/pull/6914) before SegWit and TapRoot.\r\nHowever, the increasingly common `P2WSH` and `P2TR` scripts are both 34 bytes, and are forced to use heap (re)allocation rather than efficient inline storage.\r\n\r\nThe core trade-off of this change is to eliminate heap allocations for common 34-36 byte scripts at the cost of increasing the base memory footprint of all `CScript` objects by 8 bytes (while still respecting peak memory usage defined by `-dbcache`).\r\n\r\n### Context\r\nIncreasing the `prevector` size allows these scripts to be stored on the stack, avoiding heap allocations, reducing potential memory fragmentation, and improving performance during cache flushes. Massif analysis confirms a lower stable memory usage after flushing, suggesting the elimination of heap allocations outweighs the larger base size for common workloads.\r\n\r\nDue to memory alignment, increasing the prevector size to 36 bytes doesn't change the overall `sizeof(CScript)` compared to an increase to 34 bytes, allowing us to include `P2PK` scripts as well at no additional memory cost.\r\n\r\n<details>\r\n<summary>Massif measurements</summary>\r\n\r\n> dbcache=440\r\n\r\nMassif before, with a heap threshold of `28`:\r\n```bash\r\n    MB\r\n744.1^#                                                                       \r\n     |#: ::::::@: :::::::   :@:: @::::::::::::::@@                            \r\n     |#: ::::::@::::: :::   :@:::@:::::: :: ::::@                             \r\n     |#: ::::::@::::: :::   :@:::@:::::: :: ::::@                             \r\n     |#: ::::::@::::: ::: : :@:::@:::::: :: ::::@                             \r\n     |#: ::::::@::::: ::: : :@:::@:::::: :: ::::@                             \r\n     |#: ::::::@::::: ::: : :@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: ::: : :@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: ::: :::@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: ::: :::@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: ::: :::@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: ::: :::@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@                             \r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n     |#::::::::@::::: :::::::@:::@:::::: :: ::::@ :::::@:::::@:::::@:::::@::::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.805\r\n```\r\n\r\nand after, with a heap threshold of `36`:\r\n```bash\r\n    MB\r\n744.2^       :                                                                \r\n     |#  :  :::::::::::   : : :: ::: @@:::::: ::  :                           \r\n     |#  :  :::: ::::::   : : :: ::: @ :: ::  :   :                           \r\n     |#  :  :::: :::::::  : :@:: ::: @ :: ::  : :::                           \r\n     |#  :  :::: :::::::  : :@:: ::: @ :: ::  : : :                           \r\n     |#  :  :::: :::::::  : :@:: ::: @ :: ::  : : :                           \r\n     |#  :  :::: :::::::  : :@:: ::: @ :: ::  : : :                           \r\n     |#  :: :::: :::::::  : :@:: ::: @ :: ::  : : :                           \r\n     |#  :: :::: :::::::  : :@:: ::::@ :: ::  : : :                           \r\n     |#:::: :::: :::::::  :::@:: ::::@ :: ::  : : :                           \r\n     |#: ::::::: :::::::  :::@:: ::::@ :: :: @: : :                           \r\n     |#: ::::::: :::::::  :::@:::::::@ :: :: @: : :                           \r\n     |#: ::::::: ::::::::::::@:::::::@ :: :: @: : :                           \r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :                           \r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n     |#: ::::::: :::::::: :::@:::::::@ :: :: @: : :::@:::@::::@::::::@:::::@::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.618\r\n```\r\n\r\n---\r\n\r\n> for `dbcache=4500`:\r\n\r\nMassif before, with a heap threshold of `28`:\r\n```bash\r\n    GB\r\n4.565^   ::                                                                   \r\n     | ##:   @@:::  :::: :@::::  :::: ::::                                    \r\n     | # :   @ ::   :::  :@: ::  : :: :::                                     \r\n     | # :   @ :: :::::  :@: ::  : :: :::                                     \r\n     | # :   @ :: : :::  :@: :: @: :: :::                                     \r\n     | # :   @ :: : :::  :@: :: @: :: :::                                     \r\n     | # :   @ :: : :::  :@: :: @: :: :::                                     \r\n     | # :   @ :: : :::  :@: :: @: :: :::                                     \r\n     | # : ::@ :: : :::  :@: :: @: :: :::                                     \r\n     | # : : @ :: : :::  :@: :: @: :: :::                                     \r\n     | # : : @ :: : :::  :@: :: @: ::::::                                     \r\n     | # : : @ :: : :::  :@: :: @: ::::::                                     \r\n     | # : : @ :: : :::  :@: :: @: ::::::                                     \r\n     | # : : @ :: : ::: ::@: :: @: ::::::                                     \r\n     | # : : @ :: : ::: ::@: :: @: ::::::                                     \r\n     | # : : @ :: : ::: ::@: :: @: ::::::                                     \r\n     | # : : @ :: : ::: ::@: :: @: :::::: @::                                 \r\n     | # : : @ :: : ::: ::@: :: @: :::::: @:                                  \r\n     | # : : @ :: : ::: ::@: :::@: :::::: @:                                  \r\n     | # : : @ :: : ::: ::@: :::@: :::::: @: :::::::::::::::::::::::::::::@:::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.500\r\n```\r\n\r\nand after, with a heap threshold of `36`:\r\n```\r\n    GB\r\n4.640^    :                                                                   \r\n     | ##::  :::::   ::::  ::::::@  ::::                                      \r\n     | # ::  : :::   ::::  :: :::@  ::::                                      \r\n     | # :: :: :::   ::::  :: :::@  ::::                                      \r\n     | # :: :: :::  :::::  :: :::@  ::::                                      \r\n     | # :: :: :::  :::::  :: :::@  ::::                                      \r\n     | # :: :: :::  :::::  :: :::@  ::::                                      \r\n     | # :: :: :::  :::::  :: :::@  ::::                                      \r\n     | # :: :: :::  :::::  :: :::@  ::::  :@@                                 \r\n     | # :: :: :::  ::::: ::: :::@  :::::::@                                  \r\n     | # :: :: :::  ::::: ::: :::@  ::::: :@                                  \r\n     | # :: :: :::  ::::: ::: :::@::::::: :@                                  \r\n     | # ::::: :::  ::::: ::: :::@: ::::: :@                                  \r\n     | # ::::: :::  ::::: ::: :::@: ::::: :@                                  \r\n     | # ::::: :::::::::: ::: :::@: ::::: :@                                  \r\n     | # ::::: :::: ::::: ::: :::@: ::::: :@                                  \r\n     | # ::::: :::: ::::: ::: :::@: ::::: :@                                  \r\n     | # ::::: :::: ::::::::: :::@: ::::: :@                                  \r\n     | # ::::: :::: ::::::::: :::@: ::::: :@                                  \r\n     | # ::::: :::: ::::::::: :::@: ::::: :@ ::::::@:::@:::@::::@:::::@::::@::\r\n   0 +----------------------------------------------------------------------->h\r\n     0                                                                   1.360\r\n```\r\n\r\n</details>\r\n\r\n### Benchmarks and Memory\r\n\r\nPerformance benchmarks for `AssumeUTXO` load and flush show:\r\n- Small dbcache (450MB): ~1-3% performance improvement (despite more frequent flushes)\r\n- Large dbcache (4500MB): ~6-8% performance improvement due to fewer heap allocations (and basically the number of flushes)\r\n- Very large dbcache (4500MB): ~5-6% performance improvement due to fewer heap allocations (and memory limit not being reached, so there's no memory penalty)\r\n\r\nFull IBD and reindex-chainstate with also show an overall ~2-3% speedup (both for smaller and larger dbcache values).\r\n\r\nWe haven't investigated using different prevector sizes based on script type, though this could be explored in the future if needed.",
    "labels": [],
    "created_at": "2025-04-15T16:20:13Z",
    "updated_at": "2025-04-18T07:58:09Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "031984118ffa6e751ce2ec59e5086ae52a628356",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/prevector-size",
      "ref": "l0rinc/prevector-size",
      "sha": "a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 258431,
        "default_branch": "master",
        "open_issues_count": 3,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-17T17:12:15Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-04-15T21:38:46Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "e66e30c9e5383a467789574e61114b57536193b9",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37073,
        "stargazers_count": 82945,
        "watchers_count": 82945,
        "size": 279879,
        "default_branch": "master",
        "open_issues_count": 703,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-17T17:51:44Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-04-18T07:05:01Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32279"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 107,
    "deletions": 24,
    "changed_files": 5,
    "commits": 2,
    "review_comments": 0,
    "comments": 7
  },
  "events": [
    {
      "event": "commented",
      "id": 2806724474,
      "node_id": "IC_kwDOABII586nSzd6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2806724474",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T16:20:16Z",
      "updated_at": "2025-04-16T06:14:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32279.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28531](https://github.com/bitcoin/bitcoin/pull/28531) (improve MallocUsage() accuracy by LarryRuane)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2806724474",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "renamed",
      "id": 17272999282,
      "node_id": "RTE_lADOABII586yoiw8zwAAAAQFjQ1y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17272999282",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T16:40:29Z",
      "rename": {
        "from": "prevector: allocate `P2WSH` and `P2TR` scripts on stack as well",
        "to": "[IBD] prevector: allocate `P2WSH` and `P2TR` scripts on stack as well"
      }
    },
    {
      "event": "commented",
      "id": 2806901240,
      "node_id": "IC_kwDOABII586nTen4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2806901240",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T17:08:21Z",
      "updated_at": "2025-04-18T07:58:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "### Additional info:\r\n\r\nAdded logging to the original `prevector` destructor to measure its final size - and printed the values during an assumeutxo load & dump:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/b41d216c-97f9-4e12-8cd8-bfc44e7c5cc5\" />\r\n\r\nI haven't investigated in detail why there are so many empty prevectors, can very well be just an unoptimized debug run artifact of all the Coin copies.\r\n\r\n----\r\n\r\nIf we plot the coin cache size vs height, we see that with the original prevector size, the first part of the sync fits more values initially and fewer ones later:\r\n<img width=\"1000\" alt=\"Original cache occupancy\" src=\"https://github.com/user-attachments/assets/fbb571fb-0864-4127-afe2-d18c15ea3a9b\" />\r\n\r\nAfter this change, the occupancy is more predictable:\r\n<img width=\"1000\" alt=\"New cache occupancy\" src=\"https://github.com/user-attachments/assets/9195b0f3-cbb9-470b-ba53-fd8f9246d145\" />\r\n\r\n-----\r\n\r\n### AssumeUTXO\r\n\r\nRan some AssumeUTXO benchmarks with different values (on *SSD*):\r\n\r\n<details>\r\n<summary>Benchmark</summary>\r\n\r\n```bash\r\nCOMMITS=\"847a891cdfdf9cfd69a77a8688c995e532ea29db dc0c79a46b5663eddc0a4365b9b7de22cf3fefae\"; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/ShallowBitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; UTXO_SNAPSHOT_PATH=\"$BASE_DIR/utxo-880000.dat\"; \\\r\n(for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done) && \\\r\nfor DBCACHE in 450 4500 45000; do \\\r\n  hyperfine \\\r\n  --sort 'command' \\\r\n  --runs 5 \\\r\n  --export-json \"$BASE_DIR/assumeutxo-${COMMITS// /-}-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -rf $DATA_DIR/chainstate $DATA_DIR/chainstate_snapshot $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind --target bitcoin-cli && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -daemon -blocksonly=1 -connect=0 -dbcache=$DBCACHE -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-assumeutxo-{COMMIT}-dbcache-$DBCACHE-$(date +%s).log; build/bin/bitcoin-cli -datadir=$DATA_DIR stop; sleep 10; killall bitcoind; sleep 10;\" \\\r\n  \"COMPILER=$CC DBCACHE=$DBCACHE COMMIT={COMMIT} ./build/bin/bitcoin-cli -datadir=$DATA_DIR -rpcclienttimeout=0 loadtxoutset $UTXO_SNAPSHOT_PATH\"; \\\r\ndone\r\n\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>No significant difference with small cache (450MB)</summary>\r\n\r\n> 847a891cdf test: assert CScript allocation characteristics\r\n> dc0c79a46b Allocate P2WSH/P2TR/P2PK scripts on stack as well\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=450 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     451.840 s ±  2.255 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   448.790 s … 454.846 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=450 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     451.480 s ±  5.381 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   447.360 s … 459.782 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.00 ±  0.01  COMPILER=gcc DBCACHE=450 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=450 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>~6% faster with large cache (4500MB)</summary>\r\n\r\n> 847a891cdf test: assert CScript allocation characteristics\r\n> dc0c79a46b Allocate P2WSH/P2TR/P2PK scripts on stack as well\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=4500 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     480.316 s ±  2.640 s    [User: 0.001 s, System: 0.002 s]\r\n  Range (min … max):   477.157 s … 483.803 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=4500 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     452.521 s ±  7.533 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   445.367 s … 460.740 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.06 ±  0.02  COMPILER=gcc DBCACHE=4500 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=4500 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>~5% faster with very large cache (45000MB)</summary>\r\n\r\n> 847a891cdf test: assert CScript allocation characteristics\r\n> dc0c79a46b Allocate P2WSH/P2TR/P2PK scripts on stack as well\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=45000 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     469.846 s ±  1.583 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   467.909 s … 472.053 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=45000 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     448.079 s ±  1.180 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   447.280 s … 450.165 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.05 ±  0.00  COMPILER=gcc DBCACHE=45000 COMMIT=847a891cdfdf9cfd69a77a8688c995e532ea29db ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=45000 COMMIT=dc0c79a46b5663eddc0a4365b9b7de22cf3fefae ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\nAnd on *HDD*:\r\n\r\n<details>\r\n<summary>Benchmark</summary>\r\n\r\n```bash\r\nCOMMITS=\"156f9913a26598009c8356c34548002e6a6aba02 a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7\"; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/ShallowBitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; UTXO_SNAPSHOT_PATH=\"$BASE_DIR/utxo-880000.dat\"; \\\r\n(for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done) && \\\r\nfor DBCACHE in 450 4500 45000; do \\\r\n  hyperfine \\\r\n  --sort 'command' \\\r\n  --runs 5 \\\r\n  --export-json \"$BASE_DIR/assumeutxo-${COMMITS// /-}-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -rf $DATA_DIR/chainstate $DATA_DIR/chainstate_snapshot $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind --target bitcoin-cli && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -daemon -blocksonly=1 -connect=0 -dbcache=$DBCACHE -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-assumeutxo-{COMMIT}-dbcache-$DBCACHE-$(date +%s).log; build/bin/bitcoin-cli -datadir=$DATA_DIR stop; sleep 10; killall bitcoind; sleep 10;\" \\\r\n  \"COMPILER=$CC DBCACHE=$DBCACHE COMMIT={COMMIT} ./build/bin/bitcoin-cli -datadir=$DATA_DIR -rpcclienttimeout=0 loadtxoutset $UTXO_SNAPSHOT_PATH\"; \\\r\ndone\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>~3% faster with small dbcache (450MB)</summary>\r\n\r\n> 156f9913a2 test: assert CScript allocation characteristics\r\n> a2a3e0cfd8 Allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=450 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     949.219 s ± 24.273 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   919.208 s … 969.841 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=450 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     923.687 s ± 15.431 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   909.239 s … 948.855 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.03 ±  0.03  COMPILER=gcc DBCACHE=450 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=450 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>~8% faster with large dbcache (4500MB)</summary>\r\n\r\n> 156f9913a2 test: assert CScript allocation characteristics\r\n> a2a3e0cfd8 Allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=4500 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     778.101 s ± 14.503 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   765.670 s … 801.459 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=4500 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     718.500 s ± 17.941 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   693.273 s … 735.929 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.08 ±  0.03  COMPILER=gcc DBCACHE=4500 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=4500 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>~6% faster with very large dbcache (45000MB)</summary>\r\n\r\n> 156f9913a2 test: assert CScript allocation characteristics\r\n> a2a3e0cfd8 Allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc DBCACHE=45000 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     567.985 s ±  9.220 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   556.441 s … 578.439 s    5 runs\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=45000 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n  Time (mean ± σ):     535.541 s ± 11.944 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   520.044 s … 549.775 s    5 runs\r\n \r\nRelative speed comparison\r\n        1.06 ±  0.03  COMPILER=gcc DBCACHE=45000 COMMIT=156f9913a26598009c8356c34548002e6a6aba02 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n        1.00          COMPILER=gcc DBCACHE=45000 COMMIT=a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-880000.dat\r\n```\r\n\r\n</details>\r\n\r\n\r\n### Reindex-chainstate\r\n\r\n<details>\r\n<summary>Benchmark with dbcache=450</summary>\r\n\r\n```bash\r\nCOMMITS=\"156f9913a26598009c8356c34548002e6a6aba02 a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=450; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done) && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 2 \\\r\n  --export-json \"$BASE_DIR/rdx-${COMMITS// /-}-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=5000 -printtoconsole=0; sleep 100\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\"\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>~2% faster with small dbcache</summary>\r\n\r\n> 156f9913a2 test: assert CScript allocation characteristics\r\n> a2a3e0cfd8 Allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=450 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0 (COMMIT = 156f9913a26598009c8356c34548002e6a6aba02)\r\n  Time (mean ± σ):     19748.586 s ±  3.502 s    [User: 35991.245 s, System: 2756.673 s]\r\n  Range (min … max):   19746.110 s … 19751.062 s    2 runs\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=450 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0 (COMMIT = a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7)\r\n  Time (mean ± σ):     19333.189 s ±  6.061 s    [User: 35338.722 s, System: 2733.049 s]\r\n  Range (min … max):   19328.903 s … 19337.474 s    2 runs\r\n \r\nRelative speed comparison\r\n        1.02 ±  0.00  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=450 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0 (COMMIT = 156f9913a26598009c8356c34548002e6a6aba02)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=450 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0 (COMMIT = a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7)\r\n```\r\n\r\n</details>\r\n\r\n\r\n### Full IBD\r\n\r\n<details>\r\n<summary>Benchmark with dbcache=45000</summary>\r\n\r\n```bash\r\nCOMMITS=\"847a891cdfdf9cfd69a77a8688c995e532ea29db dc0c79a46b5663eddc0a4365b9b7de22cf3fefae\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=45000; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done) && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 2 \\\r\n  --export-json \"$BASE_DIR/ibd-${COMMITS// /-}-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -rf $DATA_DIR/*; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; sleep 100\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE -blocksonly -printtoconsole=0\"\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>~2% faster with very large dbcache</summary>\r\n\r\n> 847a891cdf test: assert CScript allocation characteristics\r\n> dc0c79a46b Allocate P2WSH/P2TR/P2PK scripts on stack as well\r\n\r\n```bash\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=45000 -blocksonly -printtoconsole=0 (COMMIT = 847a891cdfdf9cfd69a77a8688c995e532ea29db)\r\n  Time (mean ± σ):     39061.975 s ± 366.257 s    [User: 37221.558 s, System: 1941.817 s]\r\n  Range (min … max):   38802.992 s … 39320.958 s    2 runs\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=45000 -blocksonly -printtoconsole=0 (COMMIT = dc0c79a46b5663eddc0a4365b9b7de22cf3fefae)\r\n  Time (mean ± σ):     38214.234 s ± 65.671 s    [User: 36851.441 s, System: 2103.990 s]\r\n  Range (min … max):   38167.797 s … 38260.670 s    2 runs\r\n \r\nRelative speed comparison\r\n        1.02 ±  0.01  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=45000 -blocksonly -printtoconsole=0 (COMMIT = 847a891cdfdf9cfd69a77a8688c995e532ea29db)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -dbcache=45000 -blocksonly -printtoconsole=0 (COMMIT = dc0c79a46b5663eddc0a4365b9b7de22cf3fefae)\r\n```\r\n\r\n</details>\r\n\r\n### Memory\r\n\r\nNote that this was measured for `prevector<34>`, but should be basically the same for the current `36` as well.\r\n\r\n<details>\r\n<summary>prevector 28 massif measurement summary for assumeutxo loads</summary>\r\n\r\n```bash\r\n-------------------------------------------------------------------------------\r\n  n       time(ms)         total(B)   useful-heap(B) extra-heap(B)    stacks(B)\r\n--------------------------------------------------------------------------------\r\n  0              0                0                0             0            0\r\n  1        142,755    4,881,866,480    4,646,778,126   235,088,354            0\r\n95.18% (4,646,778,126B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\r\n->73.76% (3,600,809,984B) 0x5502B7: CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&&, Coin&&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->73.76% (3,600,809,984B) 0x49DDCF: ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, node::SnapshotMetadata const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->73.76% (3,600,809,984B) 0x49F3CA: ChainstateManager::ActivateSnapshot(AutoFile&, node::SnapshotMetadata const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->73.76% (3,600,809,984B) 0x367A0F: loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|       ->73.76% (3,600,809,984B) 0x3680F6: std::_Function_handler<UniValue (RPCHelpMan const&, JSONRPCRequest const&), loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|         ->73.76% (3,600,809,984B) 0x60403B: RPCHelpMan::HandleRequest(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->73.76% (3,600,809,984B) 0x373359: CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)\r\n|             ->73.76% (3,600,809,984B) 0x425F6C: ExecuteCommand(CRPCCommand const&, JSONRPCRequest const&, UniValue&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|               ->73.76% (3,600,809,984B) 0x427373: CRPCTable::execute(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->73.76% (3,600,809,984B) 0x4274C6: JSONRPCExec(JSONRPCRequest const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                   ->73.76% (3,600,809,984B) 0x4FF1C3: HTTPReq_JSONRPC(std::any const&, HTTPRequest*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                     ->73.76% (3,600,809,984B) 0x50CA81: WorkQueue<HTTPClosure>::Run() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                       ->73.76% (3,600,809,984B) 0x505F06: HTTPWorkQueueRun(WorkQueue<HTTPClosure>*, int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                         ->73.76% (3,600,809,984B) 0x49A6DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)\r\n|                           ->73.76% (3,600,809,984B) 0x4CEBAA3: start_thread (pthread_create.c:447)\r\n|                             ->73.76% (3,600,809,984B) 0x4D78A33: clone (clone.S:100)\r\n|                               \r\n->08.19% (399,758,776B) 0x5522AC: std::__detail::_Hashtable_alloc<PoolAllocator<std::__detail::_Hash_node<std::pair<COutPoint const, CCoinsCacheEntry>, false>, 144ul, 8ul> >::_M_allocate_buckets(unsigned long) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->08.19% (399,758,776B) 0x5526AD: std::_Hashtable<COutPoint, std::pair<COutPoint const, CCoinsCacheEntry>, PoolAllocator<std::pair<COutPoint const, CCoinsCacheEntry>, 144ul, 8ul>, std::__detail::_Select1st, std::equal_to<COutPoint>, SaltedOutpointHasher, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_rehash(unsigned long, unsigned long const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->08.19% (399,758,776B) 0x5528D5: std::_Hashtable<COutPoint, std::pair<COutPoint const, CCoinsCacheEntry>, PoolAllocator<std::pair<COutPoint const, CCoinsCacheEntry>, 144ul, 8ul>, std::__detail::_Select1st, std::equal_to<COutPoint>, SaltedOutpointHasher, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_insert_unique_node(unsigned long, unsigned long, std::__detail::_Hash_node<std::pair<COutPoint const, CCoinsCacheEntry>, false>*, unsigned long) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->08.19% (399,758,776B) 0x550219: CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&&, Coin&&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|       ->08.19% (399,758,776B) 0x49DDCF: ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, node::SnapshotMetadata const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|         ->08.19% (399,758,776B) 0x49F3CA: ChainstateManager::ActivateSnapshot(AutoFile&, node::SnapshotMetadata const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->08.19% (399,758,776B) 0x367A0F: loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|             ->08.19% (399,758,776B) 0x3680F6: std::_Function_handler<UniValue (RPCHelpMan const&, JSONRPCRequest const&), loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|               ->08.19% (399,758,776B) 0x60403B: RPCHelpMan::HandleRequest(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->08.19% (399,758,776B) 0x373359: CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)\r\n|                   ->08.19% (399,758,776B) 0x425F6C: ExecuteCommand(CRPCCommand const&, JSONRPCRequest const&, UniValue&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                     ->08.19% (399,758,776B) 0x427373: CRPCTable::execute(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                       ->08.19% (399,758,776B) 0x4274C6: JSONRPCExec(JSONRPCRequest const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                         ->08.19% (399,758,776B) 0x4FF1C3: HTTPReq_JSONRPC(std::any const&, HTTPRequest*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                           ->08.19% (399,758,776B) 0x50CA81: WorkQueue<HTTPClosure>::Run() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                             ->08.19% (399,758,776B) 0x505F06: HTTPWorkQueueRun(WorkQueue<HTTPClosure>*, int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                               ->08.19% (399,758,776B) 0x49A6DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)\r\n|                                 ->08.19% (399,758,776B) 0x4CEBAA3: start_thread (pthread_create.c:447)\r\n|                                   ->08.19% (399,758,776B) 0x4D78A33: clone (clone.S:100)\r\n|                                     \r\n->07.53% (367,723,723B) 0x2F508F: prevector<28u, unsigned char, unsigned int, int>::change_capacity(unsigned int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->07.53% (367,723,579B) 0x4A5D3F: prevector<28u, unsigned char, unsigned int, int>::resize(unsigned int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | ->07.52% (367,274,326B) 0x49DF47: ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, node::SnapshotMetadata const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | | ->07.52% (367,274,326B) 0x49F3CA: ChainstateManager::ActivateSnapshot(AutoFile&, node::SnapshotMetadata const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |   ->07.52% (367,274,326B) 0x367A0F: loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n| | |     ->07.52% (367,274,326B) 0x3680F6: std::_Function_handler<UniValue (RPCHelpMan const&, JSONRPCRequest const&), loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n| | |       ->07.52% (367,274,326B) 0x60403B: RPCHelpMan::HandleRequest(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |         ->07.52% (367,274,326B) 0x373359: CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)\r\n| | |           ->07.52% (367,274,326B) 0x425F6C: ExecuteCommand(CRPCCommand const&, JSONRPCRequest const&, UniValue&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |             ->07.52% (367,274,326B) 0x427373: CRPCTable::execute(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |               ->07.52% (367,274,326B) 0x4274C6: JSONRPCExec(JSONRPCRequest const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |                 ->07.52% (367,274,326B) 0x4FF1C3: HTTPReq_JSONRPC(std::any const&, HTTPRequest*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |                   ->07.52% (367,274,326B) 0x50CA81: WorkQueue<HTTPClosure>::Run() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |                     ->07.52% (367,274,326B) 0x505F06: HTTPWorkQueueRun(WorkQueue<HTTPClosure>*, int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | |                       ->07.52% (367,274,326B) 0x49A6DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)\r\n| | |                         ->07.52% (367,274,326B) 0x4CEBAA3: start_thread (pthread_create.c:447)\r\n| | |                           ->07.52% (367,274,326B) 0x4D78A33: clone (clone.S:100)\r\n| | |                             \r\n| | ->00.01% (449,253B) in 1+ places, all below ms_print's threshold (01.00%)\r\n| | \r\n| ->00.00% (144B) in 1+ places, all below ms_print's threshold (01.00%)\r\n| \r\n->03.64% (177,834,800B) 0x286989: node::BlockManager::InsertBlockIndex(uint256 const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->01.82% (88,980,600B) 0x28ABA8: kernel::BlockTreeDB::LoadBlockIndexGuts(Consensus::Params const&, std::function<CBlockIndex* (uint256 const&)>, util::SignalInterrupt const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | ->01.82% (88,980,600B) 0x28AFA8: node::BlockManager::LoadBlockIndex(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |   ->01.82% (88,980,600B) 0x28B9FE: node::BlockManager::LoadBlockIndexDB(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |     ->01.82% (88,980,600B) 0x48329F: ChainstateManager::LoadBlockIndex() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |       ->01.82% (88,980,600B) 0x29ABA7: node::CompleteChainstateInitialization(ChainstateManager&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |         ->01.82% (88,980,600B) 0x29BB79: node::LoadChainstate(ChainstateManager&, kernel::CacheSizes const&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |           ->01.82% (88,980,600B) 0x1EE0BE: InitAndLoadChainstate(node::NodeContext&, bool, bool, kernel::CacheSizes const&, ArgsManager const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |             ->01.82% (88,980,600B) 0x1F3C54: AppInitMain(node::NodeContext&, interfaces::BlockAndHeaderTipInfo*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |               ->01.82% (88,980,600B) 0x1BE757: main (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |                 \r\n| ->01.82% (88,854,200B) 0x28ABC4: kernel::BlockTreeDB::LoadBlockIndexGuts(Consensus::Params const&, std::function<CBlockIndex* (uint256 const&)>, util::SignalInterrupt const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->01.82% (88,854,200B) 0x28AFA8: node::BlockManager::LoadBlockIndex(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->01.82% (88,854,200B) 0x28B9FE: node::BlockManager::LoadBlockIndexDB(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|       ->01.82% (88,854,200B) 0x48329F: ChainstateManager::LoadBlockIndex() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|         ->01.82% (88,854,200B) 0x29ABA7: node::CompleteChainstateInitialization(ChainstateManager&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->01.82% (88,854,200B) 0x29BB79: node::LoadChainstate(ChainstateManager&, kernel::CacheSizes const&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|             ->01.82% (88,854,200B) 0x1EE0BE: InitAndLoadChainstate(node::NodeContext&, bool, bool, kernel::CacheSizes const&, ArgsManager const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|               ->01.82% (88,854,200B) 0x1F3C54: AppInitMain(node::NodeContext&, interfaces::BlockAndHeaderTipInfo*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->01.82% (88,854,200B) 0x1BE757: main (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                   \r\n->02.06% (100,650,843B) in 1084 places, all below massif's threshold (1.00%)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>prevector 34 massif measurement summary for assumeutxo loads</summary>\r\n\r\n```bash\r\n--------------------------------------------------------------------------------\r\n  n       time(ms)         total(B)   useful-heap(B) extra-heap(B)    stacks(B)\r\n--------------------------------------------------------------------------------\r\n  0              0                0                0             0            0\r\n  1         85,674    3,026,857,896    3,008,671,214    18,186,682            0\r\n99.40% (3,008,671,214B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\r\n->84.57% (2,559,836,160B) 0x5511A7: CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&&, Coin&&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->84.57% (2,559,836,160B) 0x49E98F: ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, node::SnapshotMetadata const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->84.57% (2,559,836,160B) 0x49FF9A: ChainstateManager::ActivateSnapshot(AutoFile&, node::SnapshotMetadata const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->84.57% (2,559,836,160B) 0x367FAF: loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|       ->84.57% (2,559,836,160B) 0x368686: std::_Function_handler<UniValue (RPCHelpMan const&, JSONRPCRequest const&), loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|         ->84.57% (2,559,836,160B) 0x60446B: RPCHelpMan::HandleRequest(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->84.57% (2,559,836,160B) 0x373939: CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)\r\n|             ->84.57% (2,559,836,160B) 0x4269CC: ExecuteCommand(CRPCCommand const&, JSONRPCRequest const&, UniValue&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|               ->84.57% (2,559,836,160B) 0x427DD3: CRPCTable::execute(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->84.57% (2,559,836,160B) 0x427F26: JSONRPCExec(JSONRPCRequest const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                   ->84.57% (2,559,836,160B) 0x4FFED3: HTTPReq_JSONRPC(std::any const&, HTTPRequest*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                     ->84.57% (2,559,836,160B) 0x50D791: WorkQueue<HTTPClosure>::Run() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                       ->84.57% (2,559,836,160B) 0x506C16: HTTPWorkQueueRun(WorkQueue<HTTPClosure>*, int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                         ->84.57% (2,559,836,160B) 0x49A6DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)\r\n|                           ->84.57% (2,559,836,160B) 0x4CEBAA3: start_thread (pthread_create.c:447)\r\n|                             ->84.57% (2,559,836,160B) 0x4D78A33: clone (clone.S:100)\r\n|                               \r\n->06.50% (196,857,944B) 0x5531FC: std::__detail::_Hashtable_alloc<PoolAllocator<std::__detail::_Hash_node<std::pair<COutPoint const, CCoinsCacheEntry>, false>, 152ul, 8ul> >::_M_allocate_buckets(unsigned long) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->06.50% (196,857,944B) 0x5535FD: std::_Hashtable<COutPoint, std::pair<COutPoint const, CCoinsCacheEntry>, PoolAllocator<std::pair<COutPoint const, CCoinsCacheEntry>, 152ul, 8ul>, std::__detail::_Select1st, std::equal_to<COutPoint>, SaltedOutpointHasher, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_rehash(unsigned long, unsigned long const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->06.50% (196,857,944B) 0x553825: std::_Hashtable<COutPoint, std::pair<COutPoint const, CCoinsCacheEntry>, PoolAllocator<std::pair<COutPoint const, CCoinsCacheEntry>, 152ul, 8ul>, std::__detail::_Select1st, std::equal_to<COutPoint>, SaltedOutpointHasher, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<false, false, true> >::_M_insert_unique_node(unsigned long, unsigned long, std::__detail::_Hash_node<std::pair<COutPoint const, CCoinsCacheEntry>, false>*, unsigned long) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->06.50% (196,857,944B) 0x551107: CCoinsViewCache::EmplaceCoinInternalDANGER(COutPoint&&, Coin&&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|       ->06.50% (196,857,944B) 0x49E98F: ChainstateManager::PopulateAndValidateSnapshot(Chainstate&, AutoFile&, node::SnapshotMetadata const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|         ->06.50% (196,857,944B) 0x49FF9A: ChainstateManager::ActivateSnapshot(AutoFile&, node::SnapshotMetadata const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->06.50% (196,857,944B) 0x367FAF: loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|             ->06.50% (196,857,944B) 0x368686: std::_Function_handler<UniValue (RPCHelpMan const&, JSONRPCRequest const&), loadtxoutset()::{lambda(RPCHelpMan const&, JSONRPCRequest const&)\r\n|               ->06.50% (196,857,944B) 0x60446B: RPCHelpMan::HandleRequest(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->06.50% (196,857,944B) 0x373939: CRPCCommand::CRPCCommand(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, RPCHelpMan (*)())::{lambda(JSONRPCRequest const&, UniValue&, bool)\r\n|                   ->06.50% (196,857,944B) 0x4269CC: ExecuteCommand(CRPCCommand const&, JSONRPCRequest const&, UniValue&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                     ->06.50% (196,857,944B) 0x427DD3: CRPCTable::execute(JSONRPCRequest const&) const (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                       ->06.50% (196,857,944B) 0x427F26: JSONRPCExec(JSONRPCRequest const&, bool) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                         ->06.50% (196,857,944B) 0x4FFED3: HTTPReq_JSONRPC(std::any const&, HTTPRequest*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                           ->06.50% (196,857,944B) 0x50D791: WorkQueue<HTTPClosure>::Run() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                             ->06.50% (196,857,944B) 0x506C16: HTTPWorkQueueRun(WorkQueue<HTTPClosure>*, int) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                               ->06.50% (196,857,944B) 0x49A6DB3: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.33)\r\n|                                 ->06.50% (196,857,944B) 0x4CEBAA3: start_thread (pthread_create.c:447)\r\n|                                   ->06.50% (196,857,944B) 0x4D78A33: clone (clone.S:100)\r\n|                                     \r\n->05.88% (177,834,800B) 0x286859: node::BlockManager::InsertBlockIndex(uint256 const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| ->02.94% (88,980,600B) 0x28AA78: kernel::BlockTreeDB::LoadBlockIndexGuts(Consensus::Params const&, std::function<CBlockIndex* (uint256 const&)>, util::SignalInterrupt const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| | ->02.94% (88,980,600B) 0x28AE78: node::BlockManager::LoadBlockIndex(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |   ->02.94% (88,980,600B) 0x28B8CE: node::BlockManager::LoadBlockIndexDB(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |     ->02.94% (88,980,600B) 0x483E9F: ChainstateManager::LoadBlockIndex() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |       ->02.94% (88,980,600B) 0x29ABB7: node::CompleteChainstateInitialization(ChainstateManager&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |         ->02.94% (88,980,600B) 0x29BB89: node::LoadChainstate(ChainstateManager&, kernel::CacheSizes const&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |           ->02.94% (88,980,600B) 0x1EE0EE: InitAndLoadChainstate(node::NodeContext&, bool, bool, kernel::CacheSizes const&, ArgsManager const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |             ->02.94% (88,980,600B) 0x1F3C84: AppInitMain(node::NodeContext&, interfaces::BlockAndHeaderTipInfo*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |               ->02.94% (88,980,600B) 0x1BE717: main (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n| |                 \r\n| ->02.94% (88,854,200B) 0x28AA94: kernel::BlockTreeDB::LoadBlockIndexGuts(Consensus::Params const&, std::function<CBlockIndex* (uint256 const&)>, util::SignalInterrupt const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|   ->02.94% (88,854,200B) 0x28AE78: node::BlockManager::LoadBlockIndex(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|     ->02.94% (88,854,200B) 0x28B8CE: node::BlockManager::LoadBlockIndexDB(std::optional<uint256> const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|       ->02.94% (88,854,200B) 0x483E9F: ChainstateManager::LoadBlockIndex() (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|         ->02.94% (88,854,200B) 0x29ABB7: node::CompleteChainstateInitialization(ChainstateManager&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|           ->02.94% (88,854,200B) 0x29BB89: node::LoadChainstate(ChainstateManager&, kernel::CacheSizes const&, node::ChainstateLoadOptions const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|             ->02.94% (88,854,200B) 0x1EE0EE: InitAndLoadChainstate(node::NodeContext&, bool, bool, kernel::CacheSizes const&, ArgsManager const&) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|               ->02.94% (88,854,200B) 0x1F3C84: AppInitMain(node::NodeContext&, interfaces::BlockAndHeaderTipInfo*) (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                 ->02.94% (88,854,200B) 0x1BE717: main (in /mnt/my_storage/bitcoin/build/bin/bitcoind)\r\n|                   \r\n```\r\n\r\n</details>\r\n\r\nDiffing the two reveals a dramatic difference: `prevector<28u, unsigned char, unsigned int, int>::change_capacity` is 07.53% of prevector<28>, but is completely missing in prevector<34> since the P2WSH/P2TR scripts are now allocated on the stack and don't need any capacity change anymore.\r\n\r\nThe other difference visible directly in these peak snapshot header lines is the extra-heap(B):\r\n* prevector<28> peaks at ~235 MiB of extra-heap.\r\n* prevector<34> peaks at only ~21 MiB of extra-heap.\r\n\r\nThese explain the 7% speedup for large memory use cases: elimination of millions of small, separate heap allocations triggered when CScripts (like P2WSH/P2TR) exceed the 28-byte inline limit, each incurring overhead.\r\n\r\n\r\n\r\n\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2806901240",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "renamed",
      "id": 17276569360,
      "node_id": "RTE_lADOABII586yoiw8zwAAAAQFw4cQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17276569360",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T20:54:15Z",
      "rename": {
        "from": "[IBD] prevector: allocate `P2WSH` and `P2TR` scripts on stack as well",
        "to": "[IBD] prevector: allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17276589011,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQFw9PT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17276589011",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7a5a6ac8c9532c2e009626ea6c50acf3cb61f965",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/7a5a6ac8c9532c2e009626ea6c50acf3cb61f965",
      "created_at": "2025-04-15T20:55:20Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17276983660,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQFydls",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17276983660",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "75888f99f81263841d45505088f2ac93e9ad1b78",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/75888f99f81263841d45505088f2ac93e9ad1b78",
      "created_at": "2025-04-15T21:18:15Z"
    },
    {
      "event": "labeled",
      "id": 17276984399,
      "node_id": "LE_lADOABII586yoiw8zwAAAAQFydxP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17276984399",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T21:18:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2807542533,
      "node_id": "IC_kwDOABII586nV7MF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2807542533",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T21:18:22Z",
      "updated_at": "2025-04-15T21:18:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40612214686</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2807542533",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "unlabeled",
      "id": 17277759715,
      "node_id": "UNLE_lADOABII586yoiw8zwAAAAQF1bDj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17277759715",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T22:27:03Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "ready_for_review",
      "id": 17277864550,
      "node_id": "RFRE_lADOABII586yoiw8zwAAAAQF10pm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17277864550",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T22:37:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17282861808,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQGI4rw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17282861808",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "21077a667e74d94d6171d7b57f3e45ddef93f195",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/21077a667e74d94d6171d7b57f3e45ddef93f195",
      "created_at": "2025-04-16T06:44:16Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17283066556,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQGJqq8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17283066556",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f3fd198883d8284bd1fb3335c9b34338b321dee3",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/f3fd198883d8284bd1fb3335c9b34338b321dee3",
      "created_at": "2025-04-16T06:56:41Z"
    },
    {
      "event": "labeled",
      "id": 17284143522,
      "node_id": "LE_lADOABII586yoiw8zwAAAAQGNxmi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17284143522",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T08:01:36Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2808735694,
      "node_id": "IC_kwDOABII586naefO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2808735694",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T08:01:38Z",
      "updated_at": "2025-04-16T08:01:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40633401176</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2808735694",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17284208256,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQGOBaA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17284208256",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "0347061f6a53782c5ed177378e68c56a74f92ed1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/0347061f6a53782c5ed177378e68c56a74f92ed1",
      "created_at": "2025-04-16T08:05:21Z"
    },
    {
      "event": "unlabeled",
      "id": 17285165606,
      "node_id": "UNLE_lADOABII586yoiw8zwAAAAQGRrIm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17285165606",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T09:05:18Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2810386877,
      "node_id": "IC_kwDOABII586ngxm9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2810386877",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T18:27:45Z",
      "updated_at": "2025-04-16T18:27:45Z",
      "author_association": "MEMBER",
      "body": "Since this results in more flushes, I think we should wait for the composition of the UTXO set to change to the point that this provides an improvement for nodes with default dbcache.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2810386877",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "commented",
      "id": 2810593017,
      "node_id": "IC_kwDOABII586nhj75",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2810593017",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T19:46:56Z",
      "updated_at": "2025-04-16T19:46:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the idea and comment @achow101!\r\nI'll measure IBD with default settings after the benchmarking servers free up, but so far it seems that there's barely any slowdown (if any) for default dbcache and a measurable speedup for larger memory settings. So we might already be at the point where it's either a neutral or a net positive change.\r\nAnd given that we have a few other PRs in the queue that speed up small dbcache IBDs as well (see https://github.com/bitcoin/bitcoin/pull/32043), we can cover all important scenarios via multiple focused changes.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2810593017",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "mentioned",
      "id": 17294996874,
      "node_id": "MEE_lADOABII586yoiw8zwAAAAQG3LWK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17294996874",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T19:46:58Z"
    },
    {
      "event": "subscribed",
      "id": 17294996901,
      "node_id": "SE_lADOABII586yoiw8zwAAAAQG3LWl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17294996901",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T19:46:58Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE1NmY5OTEzYTI2NTk4MDA5YzgzNTZjMzQ1NDgwMDJlNmE2YWJhMDI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/156f9913a26598009c8356c34548002e6a6aba02",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/156f9913a26598009c8356c34548002e6a6aba02",
      "tree": {
        "sha": "906489d906e45f044663623ae1382914fedc4624",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/906489d906e45f044663623ae1382914fedc4624"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e66e30c9e5383a467789574e61114b57536193b9",
          "sha": "e66e30c9e5383a467789574e61114b57536193b9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e66e30c9e5383a467789574e61114b57536193b9"
        }
      ],
      "message": "test: assert CScript allocation characteristics\n\nVerifies that script types are correctly allocated using prevector's direct (stack) or indirect (heap) storage based on their size:\n\nDirect (stack) allocated script types (size ≤ 28 bytes):\n* OP_RETURN (small)\n* P2WPKH\n* P2SH\n* P2PKH\n\nIndirect (heap) allocated script types (size > 28 bytes):\n* P2WSH\n* P2TR\n* P2PK\n* MULTISIG (small)\n\nThis test provides a baseline for verifying changes to prevector's inline capacity.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-04-17T07:46:09Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-04-15T10:31:20Z"
      },
      "sha": "156f9913a26598009c8356c34548002e6a6aba02"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGEyYTNlMGNmZDg1NDllM2JlMDNmZDgxZTc1ZWJiNzUyN2U5MzQ1ZDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
      "tree": {
        "sha": "ee203697626cebd5ad660e2489137bdbd4d3e24f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee203697626cebd5ad660e2489137bdbd4d3e24f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/156f9913a26598009c8356c34548002e6a6aba02",
          "sha": "156f9913a26598009c8356c34548002e6a6aba02",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/156f9913a26598009c8356c34548002e6a6aba02"
        }
      ],
      "message": "Allocate `P2WSH`/`P2TR`/`P2PK` scripts on stack\n\nThe current `prevector` size of 28 bytes (chosen to fill the `sizeof(CScript)` aligned size) was introduced in 2015 (https://github.com/bitcoin/bitcoin/pull/6914) before SegWit and TapRoot.\nHowever, the increasingly common `P2WSH` and `P2TR` scripts are both 34 bytes, and are forced to use heap (re)allocation rather than efficient inline storage.\n\nThe core trade-off of this change is to eliminate heap allocations for common 34-36 byte scripts at the cost of increasing the base memory footprint of all `CScript` objects by 8 bytes (while still respecting peak memory usage defined by `-dbcache`).\n\nIncreasing the `prevector` size allows these scripts to be stored on the stack, avoiding heap allocations, reducing potential memory fragmentation, and improving performance during cache flushes. Massif analysis confirms a lower stable memory usage after flushing, suggesting the elimination of heap allocations outweighs the larger base size for common workloads.\n\nDue to memory alignment, increasing the `prevector` size to 36 bytes doesn't change the overall `sizeof(CScript)` compared to an increase to 34 bytes, allowing us to include `P2PK` scripts as well at no additional memory cost.\n\nPerformance benchmarks for AssumeUTXO load and flush show:\n- Small dbcache (450MB): ~1% performance penalty due to more frequent flushes\n- Large dbcache (4500-4500MB+): ~6-7% performance improvement due to fewer heap allocations\n\nFull IBD and reindex-chainstate with larger `dbcache` values also show an overall ~3% speedup.\n\nCo-authored-by: Ava Chow <github@achow101.com>\nCo-authored-by: Andrew Toth <andrewstoth@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-04-17T07:46:09Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-03-27T17:40:08Z"
      },
      "sha": "a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17301655835,
      "node_id": "HRFPE_lADOABII586yoiw8zwAAAAQHQlEb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17301655835",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a2a3e0cfd8549e3be03fd81e75ebb7527e9345d7",
      "created_at": "2025-04-17T07:46:30Z"
    },
    {
      "event": "commented",
      "id": 2814858797,
      "node_id": "IC_kwDOABII586nx1Yt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2814858797",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-18T07:55:20Z",
      "updated_at": "2025-04-18T07:55:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "A few previous measurements were done on `34` byte prevector, the latest version bumped it to `36` (which included P2PK scripts on stack as well).\r\nI've rerun the `AssumeUTXO`, `reindex-chainstate` and `IBD` benchmarks (both on *SSD* and *HDD*, since they have different performance profiles) and couldn't find a single instance where `master` was any faster.\r\n\r\n> this provides an improvement for nodes with default dbcache\r\n\r\n@achow101, what other usecases do you think I should measure to make sure this is indeed the case?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32279#issuecomment-2814858797",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32279"
    },
    {
      "event": "mentioned",
      "id": 17316934719,
      "node_id": "MEE_lADOABII586yoiw8zwAAAAQIK3Q_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17316934719",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-18T07:55:21Z"
    },
    {
      "event": "subscribed",
      "id": 17316934730,
      "node_id": "SE_lADOABII586yoiw8zwAAAAQIK3RK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17316934730",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-18T07:55:21Z"
    }
  ],
  "comments": []
}
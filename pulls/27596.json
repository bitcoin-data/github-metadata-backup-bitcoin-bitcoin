{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596",
    "id": 1342350793,
    "node_id": "PR_kwDOABII585QAqXJ",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27596",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27596.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27596.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/9f9ffb655e4236f8d567b961102f53c5933e8aa8",
    "number": 27596,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "assumeutxo (2)",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "- Background and FAQ: https://github.com/jamesob/assumeutxo-docs/tree/2019-04-proposal/proposal\r\n- Prior progress/project: https://github.com/bitcoin/bitcoin/projects/11\r\n- Replaces https://github.com/bitcoin/bitcoin/pull/15606, which was closed due to Github slowness. Original description and commentary can be found there.\r\n\r\n---\r\n\r\nThis changeset finishes the first phase of the assumeutxo project. It makes UTXO snapshots loadable via RPC (`loadtxoutset`) and adds `assumeutxo` parameters to chainparams. It contains all the remaining changes necessary to both use an assumedvalid snapshot chainstate and do a full validation sync in the background.\r\n\r\nThis may look like a lot to review, but note that\r\n- ~200 lines are a (non-essential) demo shell script\r\n- Many lines are functional test, documentation, and relatively dilute RPC code.\r\n\r\nSo it shouldn't be as burdensome to review as the linecount might suggest.\r\n\r\n- **P2P**: minor changes are made to `init.cpp` and `net_processing.cpp` to make simultaneous IBD across multiple chainstates work.\r\n- **Pruning**: implement correct pruning behavior when using a background chainstate\r\n- **Blockfile separation**: to prevent \"fragmentation\" in blockfile storage, have background chainstates use separate blockfiles from active snapshot chainstates to avoid interleaving heights and impairing pruning.\r\n- **Indexing**: some `CValidationInterface` events are given with an additional parameter, ChainstateRole, and all indexers ignore events from ChainstateRole::ASSUMEDVALID so that indexation only happens sequentially.\r\n- Have `-reindex` properly wipe snapshot chainstates.\r\n- **RPC**: introduce RPC commands `loadtxoutset` and (hidden) `getchainstates`.\r\n- **Release docs & first assumeutxo commitment**: add notes and a particular assumeutxo hash value for first AU-enabled release.\r\n  - This will complete the project and allow use of UTXO snapshots for faster node bootstrap.\r\n\r\nThe next phase, if it were to be pursued, would be coming up with a way to distribute the UTXO snapshots over the P2P network.\r\n\r\n---\r\n\r\n### UTXO snapshots\r\n\r\n- **788'000**\r\n  - HTTP: http://img.jameso.be/utxo-788000.dat\r\n  - Torrent: `magnet:?xt=urn:btih:a457a54c76dfdbb3f44e3485a84c4772bea647e0&dn=utxo-788000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n  - Create your own with `./contrib/devtools/utxo_snapshot.sh`\r\n    - e.g. `./contrib/devtools/utxo_snapshot.sh 788000 utxo.dat ./src/bitcoin-cli -datadir=$(pwd)/testdata`\r\n\r\n### Testing\r\n\r\n#### For fun (~5min)\r\n\r\nIf you want to do a quick test, you can run `./contrib/devtools/test_utxo_snapshots.sh` and follow the instructions. This is mostly obviated by the functional tests, though.\r\n\r\n#### For real (longer)\r\n\r\nIf you'd like to experience a real usage of assumeutxo, you can do that too.\r\nI've cut a new snapshot at height 788'000 (http://img.jameso.be/utxo-788000.dat - but you can do it yourself with `./contrib/devtools/utxo_snapshot.sh` if you want). Download that, and then create a datadir for testing:\r\n```sh\r\n$ cd ~/src/bitcoin  # or whatever\r\n\r\n# get the snapshot\r\n$ curl http://img.jameso.be/utxo-788000.dat > utxo-788000.dat\r\n\r\n# you'll want to do this if you like copy/pasting \r\n$ export AU_DATADIR=/home/${USER}/au-test # or wherever\r\n\r\n$ mkdir ${AU_DATADIR}\r\n$ vim ${AU_DATADIR}/bitcoin.conf\r\n\r\ndbcache=8000  # or, you know, something high\r\nblockfilterindex=1\r\ncoinstatsindex=1\r\nprune=3000\r\nlogthreadnames=1\r\n```\r\nObtain this branch, build it, and then start bitcoind:\r\n```sh\r\n$ git remote add jamesob https://github.com/jamesob/bitcoin\r\n$ git fetch jamesob assumeutxo\r\n$ git checkout jamesob/assumeutxo\r\n\r\n$ ./configure $conf_args && make  # (whatever you like to do here)\r\n\r\n# start 'er up and watch the logs\r\n$ ./src/bitcoind -datadir=${AU_DATADIR}\r\n```\r\nThen, in some other window, load the snapshot\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} loadtxoutset $(pwd)/utxo-788000.dat\r\n```\r\n\r\nYou'll see some log messages about headers retrieval and waiting to see the snapshot in the headers chain. Once you get the full headers chain, you'll spend a decent amount of time (~10min) loading the snapshot, checking it, and flushing it to disk. After all that happens, you should be syncing to tip in pretty short order, and you'll see the occasional `[background validation]` log message go by.\r\n\r\nIn yet another window, you can check out chainstate status with\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} getchainstates\r\n```\r\nas well as usual favorites like `getblockchaininfo`.",
    "labels": [],
    "created_at": "2023-05-08T15:08:28Z",
    "updated_at": "2023-09-13T20:09:51Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "6b5000f8467a431dfacb39263bf2b098c2de80ac",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "jamesob:assumeutxo",
      "ref": "assumeutxo",
      "sha": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 42077031,
        "node_id": "MDEwOlJlcG9zaXRvcnk0MjA3NzAzMQ==",
        "name": "bitcoin",
        "full_name": "jamesob/bitcoin",
        "owner": {
          "login": "jamesob",
          "id": 73197,
          "node_id": "MDQ6VXNlcjczMTk3",
          "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jamesob",
          "html_url": "https://github.com/jamesob",
          "followers_url": "https://api.github.com/users/jamesob/followers",
          "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
          "organizations_url": "https://api.github.com/users/jamesob/orgs",
          "repos_url": "https://api.github.com/users/jamesob/repos",
          "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jamesob/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jamesob/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jamesob/bitcoin",
        "archive_url": "https://api.github.com/repos/jamesob/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jamesob/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jamesob/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jamesob/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jamesob/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jamesob/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jamesob/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jamesob/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jamesob/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jamesob/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jamesob/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jamesob/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jamesob/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jamesob/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jamesob/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jamesob/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jamesob/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jamesob/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jamesob/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jamesob/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jamesob/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jamesob/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jamesob/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jamesob/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jamesob/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jamesob/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jamesob/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jamesob/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jamesob/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jamesob/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jamesob/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jamesob/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jamesob/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jamesob/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jamesob/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jamesob/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jamesob/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jamesob/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jamesob/bitcoin/hooks",
        "svn_url": "https://github.com/jamesob/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 262347,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-09-12T14:09:55Z",
        "created_at": "2015-09-07T22:18:03Z",
        "updated_at": "2023-05-05T06:31:51Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "8f7b9eb8711fdb32e8bdb59d2a7462a46c7a8086",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35668,
        "stargazers_count": 71313,
        "watchers_count": 71313,
        "size": 239417,
        "default_branch": "master",
        "open_issues_count": 691,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-09-13T20:23:20Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-09-13T19:36:32Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 1496,
    "deletions": 258,
    "changed_files": 43,
    "commits": 25,
    "review_comments": 185,
    "comments": 34
  },
  "events": [
    {
      "event": "commented",
      "id": 1538523343,
      "node_id": "IC_kwDOABII585btADP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538523343",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T15:08:30Z",
      "updated_at": "2023-09-13T20:09:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [naumenkogs](https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1715132009) |\n| Concept ACK | [D33r-Gee](https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1516971308) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28452](https://github.com/bitcoin/bitcoin/pull/28452) (Do not use std::vector = {} to release memory by sipa)\n* [#28202](https://github.com/bitcoin/bitcoin/pull/28202) (Silent Payments: receiving by josibake)\n* [#28120](https://github.com/bitcoin/bitcoin/pull/28120) (p2p: make block download logic aware of limited peers threshold by furszy)\n* [#28031](https://github.com/bitcoin/bitcoin/pull/28031) (Package Relay 1/3: Introduce TxPackageTracker as Orphan Resolution Module by glozow)\n* [#27866](https://github.com/bitcoin/bitcoin/pull/27866) (blockstorage: Return on fatal flush errors by TheCharlatan)\n* [#27837](https://github.com/bitcoin/bitcoin/pull/27837) (net: introduce block tracker to retry to download blocks after failure by furszy)\n* [#27827](https://github.com/bitcoin/bitcoin/pull/27827) (Silent Payments: send and receive by josibake)\n* [#27770](https://github.com/bitcoin/bitcoin/pull/27770) (Introduce 'getblockfileinfo' RPC command by furszy)\n* [#26966](https://github.com/bitcoin/bitcoin/pull/26966) (index: blockfilter initial sync speedup, parallelize process by furszy)\n* [#26762](https://github.com/bitcoin/bitcoin/pull/26762) (bugfix: Make `CCheckQueue` RAII-styled (attempt 2) by hebasto)\n* [#25970](https://github.com/bitcoin/bitcoin/pull/25970) (Add headerssync tuning parameters optimization script to repo by sipa)\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1538523343",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T15:09:17Z",
      "updated_at": "2023-05-08T15:09:17Z",
      "source": {
        "issue": {
          "id": 421531882,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MjYxNTYxNTQ3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/15606/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/15606",
          "number": 15606,
          "state": "closed",
          "state_reason": null,
          "title": "assumeutxo",
          "body": "**See the proposal for assumeutxo [here](https://github.com/jamesob/assumeutxo-docs/tree/2019-04-proposal/proposal).**\r\n\r\nTesting instructions can be found below the \"Progress\" section.\r\n\r\n---\r\n\r\n### Progress\r\n\r\nAll items here have corresponding commits here, but are unchecked if they haven't been merged yet.\r\n\r\n- [x] **Chainstate interface**\r\n  - https://github.com/bitcoin/bitcoin/pull/15976\r\n- [x] **Localize chainstate data**\r\n  - https://github.com/bitcoin/bitcoin/pull/16443\r\n- [x] **Share block data**\r\n  - https://github.com/bitcoin/bitcoin/pull/16194\r\n- [x] **Deglobalize chainstate**\r\n  - https://github.com/bitcoin/bitcoin/pull/15948\r\n- [x] **UpdateTip/CheckBlockIndex** modifications\r\n  - https://github.com/bitcoin/bitcoin/pull/21526\r\n- [x] **ChainstateManager**\r\n  - https://github.com/bitcoin/bitcoin/pull/17737\r\n- [x] **Mempool**\r\n  - https://github.com/bitcoin/bitcoin/pull/22415\r\n- [x] **LoadBlockIndex**\r\n  - https://github.com/bitcoin/bitcoin/pull/23174\r\n- [x] **Init/teardown**\r\n  - https://github.com/bitcoin/bitcoin/pull/24232\r\n  - https://github.com/bitcoin/bitcoin/pull/25667\r\n  - https://github.com/bitcoin/bitcoin/pull/25740\r\n- [x] **Wallet**: includes avoiding rescans when assumed-valid block data is in use\r\n  - https://github.com/bitcoin/bitcoin/pull/23997\r\n  - https://github.com/bitcoin/bitcoin/pull/26282\r\n- [ ] **P2P**: minor changes are made to `init.cpp` and `net_processing.cpp` to make simultaneous IBD across multiple chainstates work.\r\n  - #24008 \r\n- [ ] **Pruning**: implement correct pruning behavior when using a background chainstate\r\n- [ ] **Blockfile separation**: to prevent \"fragmentation\" in blockfile storage, have background chainstates use separate blockfiles from active snapshot chainstates to avoid interleaving heights and impairing pruning.\r\n- [ ] **Indexing**: all existing `CValidationInterface` events are given with an additional parameter, ChainstateRole, and all indexers ignore events from ChainstateRole::ASSUMEDVALID so that indexation only happens sequentially.\r\n- [ ] Raise error when both `-reindex` and assumeutxo are in use.\r\n- [ ] **RPC**: introduce RPC commands `dumptxoutset`, `loadtxoutset`, and (the probably temporary) `monitorsnapshot`.\r\n  - https://github.com/bitcoin/bitcoin/pull/16899\r\n- [ ] **Release docs & first assumeutxo commitment**: add notes and a particular assumeutxo hash value for first AU-enabled release.\r\n  - This will complete the project and allow use of UTXO snapshots for faster node bootstrap.\r\n- [ ] *(optional)* **Coinscache optimization**: allow flushing chainstate data without emptying the coins cache; results in better performance after UTXO snapshot load.\r\n  - https://github.com/bitcoin/bitcoin/pull/17487\r\n  - https://github.com/bitcoin/bitcoin/pull/27008\r\n\r\n---\r\n\r\n### Testing\r\n\r\n#### For fun (~5min)\r\n\r\nIf you want to do a quick test, you can run `./contrib/devtools/test_utxo_snapshots.sh` and follow the instructions. This is mostly obviated by the functional tests, though.\r\n\r\n#### For real (longer)\r\n\r\nIf you'd like to experience a real usage of assumeutxo, you can do that too.\r\nI've cut a new snapshot at height 788'000 (http://img.jameso.be/utxo-788000.dat - but you can do it yourself with `./contrib/devtools/utxo_snapshot.sh` if you want). Download that, and then create a datadir for testing:\r\n```sh\r\n$ cd ~/src/bitcoin  # or whatever\r\n\r\n# get the snapshot\r\n$ curl http://img.jameso.be/utxo-788000.dat > utxo-788000.dat\r\n\r\n# you'll want to do this if you like copy/pasting \r\n$ export AU_DATADIR=/home/${USER}/au-test # or wherever\r\n\r\n$ mkdir ${AU_DATADIR}\r\n$ vim ${AU_DATADIR}/bitcoin.conf\r\n\r\ndbcache=8000  # or, you know, something high\r\nblockfilterindex=1\r\ncoinstatsindex=1\r\nprune=3000\r\nlogthreadnames=1\r\n```\r\nObtain this branch, build it, and then start bitcoind:\r\n```sh\r\n$ git remote add jamesob https://github.com/jamesob/bitcoin\r\n$ git fetch jamesob utxo-dumpload-compressed\r\n$ git checkout jamesob/utxo-dumpload-compressed\r\n\r\n$ ./configure $conf_args && make  # (whatever you like to do here)\r\n\r\n# start 'er up and watch the logs\r\n$ ./src/bitcoind -datadir=${AU_DATADIR}\r\n```\r\nThen, in some other window, load the snapshot\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} loadtxoutset $(pwd)/utxo-788000.dat\r\n```\r\n\r\nYou'll see some log messages about headers retrieval and waiting to see the snapshot in the headers chain. Once you get the full headers chain, you'll spend a decent amount of time (~10min) loading the snapshot, checking it, and flushing it to disk. After all that happens, you should be syncing to tip in pretty short order, and you'll see the occasional `[background validation]` log message go by.\r\n\r\nIn yet another window, you can check out chainstate status with\r\n```sh\r\n$ ./src/bitcoin-cli -datadir=${AU_DATADIR} getchainstates\r\n```\r\nas well as usual favorites like `getblockchaininfo`.\r\n\r\n---\r\n\r\n### Original change description\r\n\r\nFor those unfamiliar with assumeutxo, here's a brief summary from [the issue](https://github.com/bitcoin/bitcoin/issues/15605) (where any conceptual discussion not specific to this implementation should happen):\r\n\r\n> assumeutxo would be a way to initialize a node using a headers chain and a serialized version of the UTXO state which was generated from another node at some block height. A client making use of this UTXO \"snapshot\" would specify a hash and expect the content of the resulting UTXO set to yield this hash after deserialization. \r\n> \r\n> This would allow users to bootstrap a usable pruned node & wallet far more quickly (and with less disk usage) than waiting for a full initial block download to complete, since we only have to sync blocks between the base of the snapshot and the current network tip. Needless to say this is at expense of accepting a different trust model, though how different this really ends up being from `assumevalid` in effect is worth debate.\r\n\r\nIn short, this is an interesting change because it would allow nodes to get up and running within minutes given a ~3GB file (at time of writing) under an almost identical trust model to assumevalid.\r\n\r\nIn this implementation, I add a few RPC commands: `dumptxoutset` creates a UTXO snapshot and writes it to disk, and `loadtxoutset` intakes a snapshot from disk, constructs and activates chainstate based on it, and continues a from-scratch initial block download in the background for the sole purpose of validating the snapshot. Once the snapshot is validated, we throw away the chainstate used for background validation.\r\n\r\nThe assumeutxo procedure as implemented is as follows:\r\n\r\n1. A UTXO snapshot is loaded with the `loadtxoutset <path>` RPC command.\r\n1. A new chainstate (`CChainState`) is initialized using `ChainstateManager::ActivateSnapshot()`:\r\n   1. The serialized UTXO data is read in and various sanity checks are performed, e.g. compare expected coin count, recompute the hash and compare it with assumeutxo hash in source code.\r\n   1. We \"fast forward\" `new_chainstate->m_chain` to have a tip at the base of the snapshot (with or without block data). Lacking block data, we fake the `nTx` counts of the constituent `CBlockIndex` entries.\r\n   1. `LoadChainTip()` is called on the new snapshot and it is installed as our active chainstate.\r\n1. The new assumed-valid chainstate is now our active, and so that enters IBD until it is synced to the network's tip. Presumably the snapshot would be taken relatively close to the current tip but far enough away to avoid meaningful reorgs, say 10,000 blocks deep.\r\n1. Once the active chainstate is out of IBD, our old validation chain continues IBD \"in the background\" while the active chainstate services requests from most of the system.\r\n1. Once the background validation chainstate reaches a height equal the base of the snapshot, we take the hash of its UTXO set and ensure it equals the expected hash based on the snapshot. If the hashes are equivalent, we delete the validation chainstate and move on without event; if they aren't, we log loudly and fall back to the validation chainstate (we should probably just shut down).\r\n\r\nThe implicit assumption is that the background validation chain will always be a subset of the assumed-valid snapshot chain while the latter is active. We don't properly handle reorgs that go deeper than the base of the snapshot.\r\n\r\n### Changes (already merged/outdated)\r\n\r\n![chainstate-beforeafter (1)](https://user-images.githubusercontent.com/73197/54435797-a16b0780-4707-11e9-89c3-c90b5686804d.png)\r\n \r\nThe crux of this change is in removing any assumptions in the codebase that there is a single chainstate, i.e. any references to global variables `chainActive`, `pcoinsTip`, et al. need to be replaced with functions that return the relevant chainstate data at that moment in time. This change also takes `CChainState` to its logical conclusion by making it more self-contained - any references to globals like `chainActive` are removed with class-local references (`m_chain`).\r\n\r\nA few minor notes on the implementation:\r\n\r\n- When we attempt to load a wallet with a BestBlock locator lower than the base of a snapshot and the snapshot has not yet been validated, we refuse to load the wallet.\r\n\r\n- For additional notes, see [the new assumeutxo docs](https://github.com/jamesob/bitcoin/blob/utxo-dumpload-compressed/doc/assumeutxo.md).",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            },
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 66,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/15606",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/15606",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/15606.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/15606.patch"
          },
          "closed_at": "2023-05-08T15:09:24Z",
          "created_at": "2019-03-15T13:58:22Z",
          "updated_at": "2023-05-08T15:09:24Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 9191648566,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIj3W02",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9191648566",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T15:23:18Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9191740914,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIj3tXy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9191740914",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T15:33:13Z"
    },
    {
      "event": "unlabeled",
      "id": 9192326444,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIj58Us",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9192326444",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T16:39:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1538759099,
      "node_id": "IC_kwDOABII585bt5m7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1538759099",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T17:26:04Z",
      "updated_at": "2023-05-08T17:26:04Z",
      "author_association": "MEMBER",
      "body": "CI's passing after a silent conflict in the rebase. I've added a link to @Sjors' snapshot torrent in the PR description.\r\n\r\nNo known outstanding issues here; ready for testing!",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1538759099",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9192696774,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIj7WvG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9192696774",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T17:26:04Z"
    },
    {
      "event": "subscribed",
      "id": 9192696784,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIj7WvQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9192696784",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T17:26:04Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T23:55:12Z",
      "updated_at": "2023-05-08T23:55:12Z",
      "source": {
        "issue": {
          "id": 1674612117,
          "node_id": "PR_kwDOABII585OqCkB",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27491",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27491/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27491/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27491/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27491",
          "number": 27491,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Move chain constants to the util library",
          "body": "This pull request is part of the `libbitcoinkernel` project https://github.com/bitcoin/bitcoin/issues/24303 https://github.com/bitcoin/bitcoin/projects/18 and more specifically its \"Step 2: Decouple most non-consensus code from libbitcoinkernel\". It is also a follow up to #26177.\r\n\r\nIt replaces pull request https://github.com/bitcoin/bitcoin/pull/27294, which just moved the constants to a new file, but did not re-declare them as enums.\r\n\r\nThe code move of the chain name constants out of the `chainparamsbase` to their own separate header allows the kernel `chainparams` to no longer include `chainparamsbase`. The `chainparamsbase` contain references to the `ArgsManager` and networking related options that should not belong to the kernel library. Besides this move, the constants are re-declared as enums with helper functions facilitating string conversions.",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 13,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27491",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27491",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27491.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27491.patch"
          },
          "closed_at": "2023-05-09T14:42:52Z",
          "created_at": "2023-04-19T10:19:09Z",
          "updated_at": "2023-05-10T10:41:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T00:29:21Z",
      "updated_at": "2023-05-09T00:29:21Z",
      "source": {
        "issue": {
          "id": 1644651433,
          "node_id": "PR_kwDOABII585NGx1S",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27357",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27357/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27357/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27357/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27357",
          "number": 27357,
          "state": "closed",
          "state_reason": null,
          "title": "validation: Move warningcache to ChainstateManager and rename to m_warningcache",
          "body": "Removes `warningcache`  and moves it to `ChainstateManager`. Also removes the respective `TODO`  completely.",
          "user": {
            "login": "dimitaracev",
            "id": 33068296,
            "node_id": "MDQ6VXNlcjMzMDY4Mjk2",
            "avatar_url": "https://avatars.githubusercontent.com/u/33068296?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/dimitaracev",
            "html_url": "https://github.com/dimitaracev",
            "followers_url": "https://api.github.com/users/dimitaracev/followers",
            "following_url": "https://api.github.com/users/dimitaracev/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/dimitaracev/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/dimitaracev/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/dimitaracev/subscriptions",
            "organizations_url": "https://api.github.com/users/dimitaracev/orgs",
            "repos_url": "https://api.github.com/users/dimitaracev/repos",
            "events_url": "https://api.github.com/users/dimitaracev/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/dimitaracev/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27357",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27357",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27357.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27357.patch"
          },
          "closed_at": "2023-06-12T12:20:31Z",
          "created_at": "2023-03-28T21:01:36Z",
          "updated_at": "2023-06-12T12:20:31Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T00:48:46Z",
      "updated_at": "2023-05-09T00:48:46Z",
      "source": {
        "issue": {
          "id": 1630933364,
          "node_id": "PR_kwDOABII585MY9Lb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27277",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27277/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27277/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27277/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27277",
          "number": 27277,
          "state": "open",
          "state_reason": null,
          "title": "Move log messages: tx enqueue to mempool, allocation to blockstorage",
          "body": "When running with `-debug=validation` the log is filled with:\r\n\r\n```\r\n2023-03-19T12:46:01Z [validation] Enqueuing TransactionAddedToMempool: txid=37c8e1ef87d75a67fbaf44e116018fbc70d9c4ef0e27e2ae56861395101f9b8e wtxid=24e2d76012f9cde451d085ead4feab136feddae6cb55d37221a81aac6c0eaf42\r\n2023-03-19T12:46:01Z [validation] TransactionAddedToMempool: txid=37c8e1ef87d75a67fbaf44e116018fbc70d9c4ef0e27e2ae56861395101f9b8e wtxid=24e2d76012f9cde451d085ead4feab136feddae6cb55d37221a81aac6c0eaf42\r\n```\r\n\r\nThese log entries are more appropriate for `-debug=mempool`.\r\n\r\nThis change limits `-debug=validation` to messages that are related to blocks and headers. It also downgrades `Enqueuing` messages to the `Trace` level.\r\n\r\nIt makes it easier to run for a long time without excessive log file growth. This debug category is particularly useful for keeping track of problematic headers that were seen, the timing of reorgs, see also #27276.\r\n\r\nSince this PR touches `validationinterface.cpp` anyway, it also includes a commit to drop function names from log messages, since we now have `-logsourcelocations`.\r\n\r\nSimilarly, though less important, I moved `[validation] Pre-allocating up to position 0xâ€¦ in revâ€¦.dat` messages to blockstorage. This reduces the number of `[validation]` log messages further. ~to 3 per (normal) block.~\r\n\r\n\r\nThe volume of log messages [could also have been reduced](https://github.com/bitcoin/bitcoin/pull/27277#discussion_r1141375638) by changing the log level of these messages to `trace`. Doing so would prevent a whack-a-mole game of moving log messages to different categories. However in this case I think the change in log category would be justified even if it didn't have a big impact on noise. I.e. someone running with `-debug=mempool` would expect to see the `TransactionAddedToMempool` messages and someone running with `-debug=blockstorage` would perhaps be surprised to not see the `Pre-allocating` message.",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 241832923,
              "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
              "name": "Utils/log/libs",
              "description": "",
              "color": "5319e7",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27277",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27277",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27277.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27277.patch"
          },
          "created_at": "2023-03-19T13:04:39Z",
          "updated_at": "2023-09-13T20:20:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T01:11:00Z",
      "updated_at": "2023-05-09T01:11:00Z",
      "source": {
        "issue": {
          "id": 1590648067,
          "node_id": "PR_kwDOABII585KSHhz",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27125",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27125/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27125/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27125/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27125",
          "number": 27125,
          "state": "closed",
          "state_reason": null,
          "title": "refactor, kernel: Decouple ArgsManager from blockstorage",
          "body": "The libbitcoin_kernel library should not rely on the `ArgsManager`, but rather use option structs that can be passed to the various classes it uses. This PR removes reliance on the `ArgsManager` from the `blockstorage.*` files. Like similar prior work, it uses the options struct in the `BlockManager` that can be populated with `ArgsManager` values.\r\n\r\nSome related prior work: https://github.com/bitcoin/bitcoin/pull/26889 https://github.com/bitcoin/bitcoin/pull/25862 https://github.com/bitcoin/bitcoin/pull/25527 https://github.com/bitcoin/bitcoin/pull/25487\r\n\r\nRelated PR removing blockstorage globals: https://github.com/bitcoin/bitcoin/pull/25781",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 35,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27125",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27125",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27125.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27125.patch"
          },
          "closed_at": "2023-05-11T09:29:03Z",
          "created_at": "2023-02-19T11:10:11Z",
          "updated_at": "2023-05-11T09:29:03Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T01:28:32Z",
      "updated_at": "2023-05-09T01:28:32Z",
      "source": {
        "issue": {
          "id": 1570294980,
          "node_id": "PR_kwDOABII585JOgro",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27039",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27039/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27039/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27039/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27039",
          "number": 27039,
          "state": "open",
          "state_reason": null,
          "title": "blockstorage: do not flush block to disk if it is already there",
          "body": "Closes https://github.com/bitcoin/bitcoin/issues/2039\r\nReplaces https://github.com/bitcoin/bitcoin/pull/26535 (added test, addressed feedback from reviews)\r\n\r\nWhen reindexing from flat-file block storage there is no need to write anything back to disk, since the block data is already there. This PR skips flushing to disk those blocks that already have a known position in the datastore. Skipping this means that users can write-protect the `blk` files on disk which may be useful for security or even safely sharing that data between multiple bitcoind instances.\r\n\r\n`FindBlockPos()` may also flush the undo data file, but again this is skipped if the corresponding block position is known, like during the initial stage of a reindex when block data is being indexed. Once the block index is complete the validation mechanism will call `ConnectBlock()` which will save undo data at that time.\r\n\r\nThe call stack looks like this:\r\n\r\n```\r\ninit()\r\nThreadImport() <-- process fReindex flag\r\nLoadExternalBlockFile()\r\nAcceptBlock()\r\nSaveBlockToDisk()\r\nFindBlockPos()\r\nFlushBlockFile() <-- unnecessary if block is already on disk\r\n```\r\n\r\nA larger refactor of this part of the code was started by mzumsande here:  https://github.com/mzumsande/bitcoin/tree/202207_refactor_findblockpos including this fix, reviewers can let me know if the changes should be combined.\r\n\r\nThis branch also adds a unit test for `BlockManager` to ensure that the patch does not affect currently expected behavior.",
          "user": {
            "login": "pinheadmz",
            "id": 2084648,
            "node_id": "MDQ6VXNlcjIwODQ2NDg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/pinheadmz",
            "html_url": "https://github.com/pinheadmz",
            "followers_url": "https://api.github.com/users/pinheadmz/followers",
            "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
            "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
            "repos_url": "https://api.github.com/users/pinheadmz/repos",
            "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 219890555,
              "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
              "name": "Block storage",
              "color": "000000",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 1648013533,
              "node_id": "MDU6TGFiZWwxNjQ4MDEzNTMz",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Review%20club",
              "name": "Review club",
              "description": "",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 20,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27039",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27039",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27039.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27039.patch"
          },
          "created_at": "2023-02-03T18:50:50Z",
          "updated_at": "2023-09-12T11:10:47Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T01:43:44Z",
      "updated_at": "2023-05-09T01:43:44Z",
      "source": {
        "issue": {
          "id": 1556671710,
          "node_id": "PR_kwDOABII585Ig7Js",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26966",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26966/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26966/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26966/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26966",
          "number": 26966,
          "state": "open",
          "state_reason": null,
          "title": "index: blockfilter initial sync speedup, parallelize process",
          "body": "The current procedure for building the block filter index involves processing filters one at a time;\r\nReading blocks, undo data, and previous headers from disk sequentially.\r\n\r\nThis PR introduces a new mechanism that employs concurrent processing. Dividing the\r\nfilters generation workload among a pool of workers that can be configured by the user,\r\nsignificantly increasing the speed of the index construction process.\r\n\r\nThe same concurrent processing model has been applied to the transactions index as well.\r\n\r\nThe newly introduced init flag `-indexworkers=<n>` enables the concurrent sync\r\nbehavior.\r\nWhere \"n\" is the number of worker threads that will be spawned at startup to create ranges\r\nof block filters during the initial sync process. Destroying the workers pool once the\r\ninitial sync completes.\r\nNote: by default, the parallelized sync process is not enabled.\r\n\r\nNow the juicy part:\r\nIn my computer, with the node in debug mode and on IBD, with `-indexworkers=4`, the\r\nblock filter index generation took less than an hour. While, in master, the sync took more than 7 hours.\r\n\r\nImportant Note:\r\nAs the access to the block data on disk is protected by `cs_main`, this new feature runs substantially\r\nfaster when the node is not in IBD.\r\n\r\nFootnote:\r\nThis is part of a larger project :).",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 9,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26966",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26966",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26966.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26966.patch"
          },
          "created_at": "2023-01-25T13:36:23Z",
          "updated_at": "2023-09-12T23:55:05Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T02:03:40Z",
      "updated_at": "2023-05-09T02:03:40Z",
      "source": {
        "issue": {
          "id": 1512790127,
          "node_id": "PR_kwDOABII585GTG8c",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26762",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26762/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26762/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/26762/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/26762",
          "number": 26762,
          "state": "open",
          "state_reason": null,
          "title": "bugfix: Make `CCheckQueue` RAII-styled (attempt 2)",
          "body": "This PR:\r\n- makes `CCheckQueue` RAII-styled\r\n- gets rid of the global `scriptcheckqueue`\r\n- fixes https://github.com/bitcoin/bitcoin/issues/25448\r\n\r\nThe previous attempt was in https://github.com/bitcoin/bitcoin/pull/18731.\r\n\r\n",
          "user": {
            "login": "hebasto",
            "id": 32963518,
            "node_id": "MDQ6VXNlcjMyOTYzNTE4",
            "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/hebasto",
            "html_url": "https://github.com/hebasto",
            "followers_url": "https://api.github.com/users/hebasto/followers",
            "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
            "organizations_url": "https://api.github.com/users/hebasto/orgs",
            "repos_url": "https://api.github.com/users/hebasto/repos",
            "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/hebasto/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 17,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/26762",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/26762",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/26762.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/26762.patch"
          },
          "created_at": "2022-12-28T13:17:37Z",
          "updated_at": "2023-08-24T23:39:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T03:17:11Z",
      "updated_at": "2023-05-09T03:17:11Z",
      "source": {
        "issue": {
          "id": 1359327472,
          "node_id": "PR_kwDOABII584-PJqZ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25977",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25977/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25977/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25977/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25977",
          "number": 25977,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Replace `std::optional<bilingual_str>` with `util::Result`",
          "body": "Replace uses of `std::optional<bilingual_str>` with `util::Result` as suggested https://github.com/bitcoin/bitcoin/pull/25648#discussion_r936311768, https://github.com/bitcoin/bitcoin/pull/27632#discussion_r1192007516, https://github.com/bitcoin/bitcoin/pull/27632#discussion_r1194858242, https://github.com/bitcoin/bitcoin/pull/24313#discussion_r1204047087\r\n\r\n\r\n",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignee": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "ryanofsky",
              "id": 7133040,
              "node_id": "MDQ6VXNlcjcxMzMwNDA=",
              "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/ryanofsky",
              "html_url": "https://github.com/ryanofsky",
              "followers_url": "https://api.github.com/users/ryanofsky/followers",
              "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
              "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
              "repos_url": "https://api.github.com/users/ryanofsky/repos",
              "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25977",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25977",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25977.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25977.patch"
          },
          "closed_at": "2023-05-26T12:09:41Z",
          "created_at": "2022-09-01T19:47:18Z",
          "updated_at": "2023-05-29T08:12:12Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T03:24:00Z",
      "updated_at": "2023-05-09T03:24:00Z",
      "source": {
        "issue": {
          "id": 1357999291,
          "node_id": "PR_kwDOABII584-Kqme",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25970",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25970/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25970/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25970/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25970",
          "number": 25970,
          "state": "open",
          "state_reason": null,
          "title": "Add headerssync tuning parameters optimization script to repo",
          "body": "Builds upon #25946, as it incorporates changes based on the selected values there.\r\n\r\nThis adds the headerssync tuning parameters optimization script from https://gist.github.com/sipa/016ae445c132cdf65a2791534dfb7ae1 to the repository, updates the parameters based on its output, and adds release process instructions for doing this update in the future.\r\n\r\nA few considerations:\r\n* It would be a bit cleaner to have these parameters be part of `CChainParams`, but due to the nature of the approach, it really only applies to chains with unforgeable proof-of-work, which we really can only reasonably expect from mainnet, so I think it's fine to keep them local to `headerssync.cpp`. Keeping them as compile-time evaluatable constants also has a (likely negligible) performance impact (avoiding runtime modulo operations).\r\n* If we want to make sure the chainparams and headerssync params don't go out of date, it could be possible to run the script in CI, and and possibly even have the parameters be generated automatically at build time. I think that's overkill for how unfrequently these need to change, and running the script has non-trivial cost (~minutes in the normal python interpreter).\r\n* A viable alternative is just leaving this out-of-repo entirely, and just do ad-hoc updating from time to time. Having it in the repo and release notes does make sure it's not forgotten, though adds a cost to contributors/maintainers who follow the process.",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            },
            {
              "id": 231994551,
              "node_id": "MDU6TGFiZWwyMzE5OTQ1NTE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Scripts%20and%20tools",
              "name": "Scripts and tools",
              "color": "ffffee",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 6,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25970",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25970",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25970.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25970.patch"
          },
          "created_at": "2022-08-31T22:54:57Z",
          "updated_at": "2023-08-25T00:06:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T03:37:09Z",
      "updated_at": "2023-05-09T03:37:09Z",
      "source": {
        "issue": {
          "id": 1320033494,
          "node_id": "PR_kwDOABII5848NBt5",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25722/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25722",
          "number": 25722,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Use util::Result class for wallet loading",
          "body": "**This is based on #25665.** The non-base commits are:\r\n\r\n- [`1a540b591c74` refactor: Use util::Result class for wallet loading](https://github.com/bitcoin/bitcoin/pull/25722/commits/1a540b591c742594cca285ef9b8b16c6d8507d58)\r\n\r\n---\r\n\r\nWallet loading functions up and down the stack have lots of error and warning parameters, and return error information in different ways. This PR makes them uniformly return `util::Result`, without changing behavior.",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25722",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25722",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25722.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25722.patch"
          },
          "created_at": "2022-07-27T19:26:58Z",
          "updated_at": "2023-08-24T12:14:19Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T03:38:46Z",
      "updated_at": "2023-05-09T03:38:46Z",
      "source": {
        "issue": {
          "id": 1313204802,
          "node_id": "PR_kwDOABII58472hm-",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25665/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25665",
          "number": 25665,
          "state": "open",
          "state_reason": null,
          "title": "refactor: Add util::Result failure values, multiple error and warning messages",
          "body": "Add `util::Result` support for returning more error information and make use of it in [LoadChainstate method](https://github.com/bitcoin/bitcoin/pull/25665/commits/0b099d463ac0644be3c7646708ded0d4a67eecae) as an initial application. Followup PR [#25722](https://github.com/bitcoin/bitcoin/pull/25722) uses it more broadly to return errors and warnings from wallet loading functions as well.\r\n\r\nThis change adds two major features to the result class:\r\n\r\n- For better error handling, adds the ability to return a value on failure, not just a value on success. This is a key missing feature that makes the result class not useful for functions like `LoadChainstate()` which produce different errors that need to be handled differently [^1].\r\n\r\n[^1]: Ability to return error values was actually present in the original implementation of [#25218](https://github.com/bitcoin/bitcoin/pull/25218), but unfortunately removed in later iterations.\r\n\r\n- For better error reporting, adds the ability to return warning messages and multiple errors, not just a single error string. This provides a way for functions to report errors and warnings in a standard way, and simplifies interfaces:\r\n\r\n    ```diff\r\n    -virtual std::unique_ptr<Wallet> loadWallet(const std::string& name, bilingual_str& error, std::vector<bilingual_str>& warnings) = 0;\r\n    +virtual util::Result<std::unique_ptr<Wallet>> loadWallet(const std::string& name) = 0;\r\n    ```\r\n\r\n    ```diff\r\n    -std::unique_ptr<WalletDatabase> MakeDatabase(const fs::path& path, const DatabaseOptions& options, DatabaseStatus& status, bilingual_str& error);\r\n    +util::Result<std::unique_ptr<WalletDatabase>, DatabaseError> MakeDatabase(const fs::path& path, const DatabaseOptions& options);\r\n   ```\r\n\r\nThis change also makes some more minor improvements:\r\n\r\n- Smaller type size. `util::Result<int>` is 16 bytes, and `util::Result<void>` is 8 bytes. Previously both were 72 bytes.\r\n\r\n- Broader type compatibility. Supports noncopyable and nonmovable success and error types.\r\n\r\n### Alternatives & design notes\r\n\r\nThe main goal for the `util::Result` class is to provide a standard way for functions to report error and warnings strings. The interface tries to make it easy to provide detailed error feedback to end users, without cluttering code or making it harder to return other result information. There have been multiple iterations of the design using different internal representations and providing different capabilities:\r\n\r\n|   | Representation (approximate)                   | Notes |\r\n|---|------------------------------------------------|-------|\r\n| _(1)_ | `tuple<T,optional<bilingual_str>>`        | Original #25218 implementation in da98fd2efc1a6b9c6e876cf3e227a8c2e9a10827. Good capabilities, but larger type size. Supports error standardized error reporting and customized error handling with failure values. |\r\n| _(2)_ | `variant<T,bilingual_str>`                | Final #25218 implementation in 7a45c33d1f8a758850cf8e7bd6ad508939ba5c0d. No support for returning failure values so not useful in many cases.\r\n| _(3)_ | `variant<monostate,T,F>`                 | Pending #25601 implementation that allows choosing whether to use standardized error reporting or return custom failure values, but doesn't support having both at the same time, like approaches _(1)_, _(4)_, _(5)_, _(6)_ do. |\r\n | _(4)_ | `tuple<variant<T,F>,bilingual_str>`      | Original #25608 implementation in c29d3008de9314dd463ed08e8bff39fe55324498. Basically the same as _(1)_ except it uses separate success and failure types instead of the same type. Using separate success and failure types makes the result class a little less flexible but can help avoid some ambiguity and inconsistent result states. |\r\n| _(5)_ | `tuple<T,optional<bilingual_str>>`        | Final #25608 implementation in dd91f294206ac87b213d23bb76656a0a5f0f4781. Essentially the same as original implementation _(1)_ except has some usability improvements. |\r\n| _(6)_ | `tuple<T,unique_ptr<tuple<F,bilingual_str>>` | Pending #25665 implementation (this PR). Supports returning failure values, uses separate success and failure types to avoid ambiguity, uses `unique_ptr` to reduce result type size, and avoids heap allocation in the happy path. |\r\n\r\n### Prior discussions & history\r\n\r\n- _furszy_ introduced a `BResult` class providing a standard error reporting mechanism in [#25218](https://github.com/bitcoin/bitcoin/pull/25218). It was renamed to `util::Result` in [#25721](https://github.com/bitcoin/bitcoin/pull/25721) but kept the same representation and capabilities.\r\n\r\n- _MarcoFalke_ suggested using `BResult` for the `LoadChainstate` function in [#25308 (comment)](https://github.com/bitcoin/bitcoin/pull/25308#issuecomment-1181674645). Inability to use `BResult` there due to lack of support for failure values led to initial work on [#25608](https://github.com/bitcoin/bitcoin/pull/25608).\r\n\r\n- _w0xlt_ wrote a `StructuredResult` class in [#25308](https://github.com/bitcoin/bitcoin/pull/25601) adding the ability to return failure values but sacrificing standard error reporting, which led to more work on [#25608](https://github.com/bitcoin/bitcoin/pull/25608).\r\n\r\n- _martinus_ suggested a space optimization in [#25608 (comment)](https://github.com/bitcoin/bitcoin/pull/25608#discussion_r921049409) that also made it easier to support distinct failure & success types, leading to [#25665](https://github.com/bitcoin/bitcoin/pull/25665) as a replacement for [#25608](https://github.com/bitcoin/bitcoin/pull/25608).",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 24,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25665",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25665",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25665.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25665.patch"
          },
          "created_at": "2022-07-21T12:46:09Z",
          "updated_at": "2023-09-12T14:29:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T04:00:24Z",
      "updated_at": "2023-05-09T04:00:24Z",
      "source": {
        "issue": {
          "id": 1245716041,
          "node_id": "PR_kwDOABII5844Umrw",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25193",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25193/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25193/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25193/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25193",
          "number": 25193,
          "state": "closed",
          "state_reason": null,
          "title": "indexes: Read the locator's top block during init, allow interaction with reindex-chainstate",
          "body": "This makes two improvements to the index init phase:\r\n\r\n**1) Prevent index corruption in case a reorg happens when the index was switched off**:\r\nThis is done by reading in the top block stored in the locator instead of looking for a fork point already in `BaseIndex::Init()`.\r\nBefore, we'd just go back to the fork point by calling `FindForkInGlobalIndex()`, which would have corrupted the coinstatsindex because its saved muhash needs to be reverted step by step by un-applying all blocks in between, which wasn't done before. This is now being done a bit later in  `ThreadSync()`, which has existing logic to call the custom `Rewind()` method when going back along the chain to the forking point (thanks ryanofsky for pointing this out to me!).\r\n\r\n**2) Allow using the `-reindex-chainstate` option without needing to disabling indexes**:\r\nWith `BaseIndex::Init()` not calling `FindForkInGlobalIndex()` anymore, we can allow `reindex-chainstate` with active indexes. `reindex-chainstate` deletes the chain and rebuilds it later in `ThreadImport`, so there is no chain available during `BaseIndex::Init()`, which would lead to problems (see #24789).\r\nBut now we'll only need the chain a bit later in `BaseIndex::ThreadSync`, which will wait for the reindex-chainstate in `ThreadImport` to finish and will continue syncing after that.",
          "user": {
            "login": "mzumsande",
            "id": 48763452,
            "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
            "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mzumsande",
            "html_url": "https://github.com/mzumsande",
            "followers_url": "https://api.github.com/users/mzumsande/followers",
            "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
            "organizations_url": "https://api.github.com/users/mzumsande/orgs",
            "repos_url": "https://api.github.com/users/mzumsande/repos",
            "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/mzumsande/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 15,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25193",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25193",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25193.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25193.patch"
          },
          "closed_at": "2023-05-17T17:27:55Z",
          "created_at": "2022-05-23T21:27:22Z",
          "updated_at": "2023-06-29T09:30:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T04:13:50Z",
      "updated_at": "2023-05-09T04:13:50Z",
      "source": {
        "issue": {
          "id": 1120958552,
          "node_id": "PR_kwDOABII584x6sdb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24230/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
          "number": 24230,
          "state": "open",
          "state_reason": null,
          "title": "indexes: Stop using node internal types and locking cs_main, improve sync logic",
          "body": "This PR lets indexing code mostly run outside of the node process. It also improves indexing sync logic, which is moved out of indexing code to a new [`node::SyncChain()`](https://github.com/ryanofsky/bitcoin/blob/8d8cdcb37005030f646ba3c45f7f54f556efb8bf/src/node/chain.h#L24-L39) function.\r\n\r\nAlmost all the commits in this PR are small refactoring changes that move code from `src/index/` to `src/node/`, or replace references to node types like `CBlockIndex`, `CChain`, `CChainState` in index code. There are only two commits affecting indexing sync logic which make complicated or substantive changes:\r\n\r\n- [`8746b35301c5` indexes: Rewrite chain sync logic, remove racy init](https://github.com/bitcoin/bitcoin/pull/24230/commits/8746b35301c5f65ff3200555fb2b82417fd2c758)\r\n- [`ad88f50ddd12` indexes: Initialize indexes without holding cs_main](https://github.com/bitcoin/bitcoin/pull/24230/commits/ad88f50ddd129dddd974bbf9fd7d86ec86b65508)\r\n\r\n\r\nThe commit messages have more details about these and other changes. Followups to this PR will reuse indexing sync code for wallets (#15719, #11756) and let indexes run in separate processes (#10102)",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 37,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24230",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24230",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24230.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24230.patch"
          },
          "created_at": "2022-02-01T16:56:28Z",
          "updated_at": "2023-09-13T00:33:33Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T04:27:39Z",
      "updated_at": "2023-05-09T04:27:39Z",
      "source": {
        "issue": {
          "id": 1096591544,
          "node_id": "PR_kwDOABII584wrFC4",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24008",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24008/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24008/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/24008/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/24008",
          "number": 24008,
          "state": "closed",
          "state_reason": null,
          "title": "assumeutxo: net_processing changes",
          "body": "This is part of the [assumeutxo project](https://github.com/bitcoin/bitcoin/projects/11) (parent PR: #27596) \r\n\r\n---\r\n\r\nThis PR includes the changes necessary to perform network functionality with multiple chainstates in use. Various pieces of net_processing logic have to be modified in order to support block download that is simultaneous across numerous chainstates.\r\n\r\nChanges include\r\n\r\n- Modify FindNextBlocksToDownload() to parameterize the chainstate\r\n  being worked on.\r\n\r\n- Change GetNodeStateStats to take the max nCommonHeight per peer across\r\n  all chainstates.\r\n\r\n- Add CNodeState::chainstate_to_last_common_block\r\n  * we need this to allow handling for a single peer to distinguish\r\n    between separate chainstates we're simultaneously downloading blocks for\r\n\r\n- Share `requests_available` across chainstates when finding the next blocks\r\n  to download (during calls to FindNextBlocksToDownload()).\r\n\r\n---\r\n\r\nThis PR shares commit https://github.com/jamesob/bitcoin/commit/17906dd52543fb75d2c45de884799b35ec5721f4 with #24006, and is included here so that the two changes can be reviewed in parallel.\r\n\r\nThis PR excludes a small net_processing commit, https://github.com/jamesob/bitcoin/commit/3e6164d96f9a42ecbf34359f6fd1af5413346933, which will be proposed for merge after #24006 since it relies on the introduction of the `BackgroundBlockConnected()` validationinterface event that the indexing changes introduce.\r\n\r\n---\r\n\r\nSome commits here are best reviewed with `--ignore-space-change`.\r\n\r\nUnit-testing net_processing is notoriously difficult and with that in mind I haven't included any unittests here, but in parallel with review of these changes I will attempt to write some tests. Note that this behavior is covered in the functional tests included in the parent PR: https://github.com/jamesob/bitcoin/commit/c4949f2daf05289e76123b3c705277bf735a79d6",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            },
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 17,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/24008",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/24008",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/24008.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/24008.patch"
          },
          "closed_at": "2023-05-26T21:26:05Z",
          "created_at": "2022-01-07T19:08:10Z",
          "updated_at": "2023-06-25T04:22:13Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9202181109,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIkfiP1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9202181109",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T15:29:30Z"
    },
    {
      "event": "commented",
      "id": 1540397377,
      "node_id": "IC_kwDOABII585b0JlB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1540397377",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T15:30:23Z",
      "updated_at": "2023-05-09T15:30:23Z",
      "author_association": "MEMBER",
      "body": "Rebased.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1540397377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T18:16:05Z",
      "updated_at": "2023-05-09T18:16:05Z",
      "source": {
        "issue": {
          "id": 1702212340,
          "node_id": "PR_kwDOABII585QGncm",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27607/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27607",
          "number": 27607,
          "state": "closed",
          "state_reason": null,
          "title": "index: make startup more efficient",
          "body": "Simplifies index startup code, eliminating the `g_indexes_ready_to_sync` variable, \r\ndeduplicating code and moving the prune violation check out of the `BaseIndex` class.\r\n\r\nAlso makes startup more efficient by running the prune violation check once for all indexes\r\ninstead of once for each index, and by delaying the prune violation check and moving it off\r\nof the main thread so the node can start up faster and perform the block data availability\r\nverification even when the '-reindex\" or the \"-reindex-chainstate\" flags are enabled (which\r\nhasn't  being possible so far).",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 21,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27607",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27607",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27607.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27607.patch"
          },
          "closed_at": "2023-07-10T15:56:33Z",
          "created_at": "2023-05-09T14:55:04Z",
          "updated_at": "2023-07-20T23:00:15Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1541467462,
      "node_id": "IC_kwDOABII585b4O1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1541467462",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T07:10:56Z",
      "updated_at": "2023-05-10T07:10:56Z",
      "author_association": "MEMBER",
      "body": "When running 8f431ad3b600a8f7e6dff83354ac3475b8936505 I noticed (and reproduced) that `-prune` is not fully honored when loading a snapshot and doing background validation. When I set `-prune=550` the blocks dir ends up somewhere between 3 and 5 GB. Judging by the blkâ€¦.dat timestamps it seems that both the snapshot and background IBD hold on to more blocks than they should. Tested on Ubuntu 23.04 and with coinstats- and blockfilterindex enabled. The first time I tested I allowed the node to sync for a few hours before loading the snapshot, the second time I loaded the snapshot almost immediately.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1541467462",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "commented",
      "id": 1542165949,
      "node_id": "IC_kwDOABII585b65W9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542165949",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T12:58:09Z",
      "updated_at": "2023-05-10T12:58:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "@jamesob What's your feeling on how important figuring out the fix for the pruning issue is at the moment? People don't consider it blocking #24008, right? Just curious about where to spend review time right now. FWIW, I noted the same issue on `getblockfrompeer` and wrote a test for it back then, in case you haven't seen it, it might come in handy: https://github.com/bitcoin/bitcoin/pull/23813",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1542165949",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9211455321,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIlC6dZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9211455321",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T12:58:09Z"
    },
    {
      "event": "subscribed",
      "id": 9211455336,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIlC6do",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9211455336",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T12:58:09Z"
    },
    {
      "event": "commented",
      "id": 1542375384,
      "node_id": "IC_kwDOABII585b7sfY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542375384",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T15:05:33Z",
      "updated_at": "2023-05-10T15:05:33Z",
      "author_association": "MEMBER",
      "body": "> What's your feeling on how important figuring out the fix for the pruning issue is at the moment? People don't consider it blocking https://github.com/bitcoin/bitcoin/pull/24008, right?\r\n\r\nRight, pruning issues shouldn't block #24008 - those changes need to happen regardless of how we manage pruning with snapshots.\r\n\r\nI'll reproduce/investigate the pruning issues over the coming days. But it's worth noting that @Sjors didn't see any regressions in pruning on this branch _before_ loading the snapshot, meaning the degraded pruning behavior only kicks in if the user loads a snapshot. And even though, the code just doesn't prune as aggressively as it seems it should.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1542375384",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9212848731,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIlIOpb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9212848731",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T15:05:34Z"
    },
    {
      "event": "subscribed",
      "id": 9212848747,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIlIOpr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9212848747",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T15:05:34Z"
    },
    {
      "event": "commented",
      "id": 1542394306,
      "node_id": "IC_kwDOABII585b7xHC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1542394306",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-10T15:17:11Z",
      "updated_at": "2023-05-10T15:17:11Z",
      "author_association": "MEMBER",
      "body": "Hm, for what it's worth, pruning is working as expected for me on this branch.\r\n\r\n![image](https://github.com/bitcoin/bitcoin/assets/73197/95b5615a-f4ca-4af5-96e4-30969fdc6940)\r\n\r\n```\r\nEvery 2.0s: cat <(./src/bitcoin-cli -datadir=/home/james/tmp/bitcoin-au-testing getmempoolinfo) <( ./src/bitcoin-cli -datadir=/home/james/tmp/bitcoin-au-testing getchainstates)                                                                                                                                                                         fido: Wed May 10 11:16:49 2023\r\n\r\n{\r\n  \"loaded\": true,\r\n  \"size\": 108146,\r\n  \"bytes\": 42192499,\r\n  \"usage\": 234882016,\r\n  \"total_fee\": 23.04459003,\r\n  \"maxmempool\": 300000000,\r\n  \"mempoolminfee\": 0.00013381,\r\n  \"minrelaytxfee\": 0.00001000,\r\n  \"incrementalrelayfee\": 0.00001000,\r\n  \"unbroadcastcount\": 0,\r\n  \"fullrbf\": false\r\n}\r\n{\r\n  \"active_chain_type\": \"validated_snapshot\",\r\n  \"validated_snapshot\": {\r\n    \"blocks\": 789094,\r\n    \"bestblockhash\": \"00000000000000000002dad6b3cd82fc00075978eb0d63dcbf6bce3bdc2c3f32\",\r\n    \"difficulty\": 48005534313578.78,\r\n    \"verificationprogress\": 0.9999931560421257,\r\n    \"snapshot_blockhash\": \"00000000000000000001f3fa1b4c03c877740778f56b0d5456b18dd88f7f695e\",\r\n    \"initialblockdownload\": false,\r\n    \"coins_db_cache_bytes\": 8388608,\r\n    \"coins_tip_cache_bytes\": 11498684416,\r\n    \"has_mempool\": true\r\n  },\r\n  \"headers\": 789094\r\n}\r\n```\r\n\r\nWill attempt to repro with a fresh run, I guess?\r\n",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1542394306",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "labeled",
      "id": 9220692496,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIlmJoQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9220692496",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-11T10:24:07Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9228083178,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAImCV_q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9228083178",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T01:12:01Z"
    },
    {
      "event": "commented",
      "id": 1544970920,
      "node_id": "IC_kwDOABII585cFmKo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1544970920",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T01:22:37Z",
      "updated_at": "2023-05-12T01:22:37Z",
      "author_association": "MEMBER",
      "body": "Rebased.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1544970920",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "unlabeled",
      "id": 9228540173,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAImEFkN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9228540173",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T03:11:13Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T05:04:41Z",
      "updated_at": "2023-05-12T05:04:41Z",
      "source": {
        "issue": {
          "id": 1706695176,
          "node_id": "PR_kwDOABII585QVsrH",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27632",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27632/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27632/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27632/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27632",
          "number": 27632,
          "state": "closed",
          "state_reason": null,
          "title": "Raise on invalid -debug and -loglevel config options",
          "body": "and rename BCLog::BLOCKSTORE to BLOCKSTORAGE so the enum is the same as its value like the other BCLog enums.\r\n\r\nPer discussion in bitcoin-core-dev IRC today from https://bitcoin-irc.chaincode.com/bitcoin-core-dev/2023-05-11#921458.\r\n",
          "user": {
            "login": "jonatack",
            "id": 2415484,
            "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jonatack",
            "html_url": "https://github.com/jonatack",
            "followers_url": "https://api.github.com/users/jonatack/followers",
            "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
            "organizations_url": "https://api.github.com/users/jonatack/orgs",
            "repos_url": "https://api.github.com/users/jonatack/repos",
            "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jonatack/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27632",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27632",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27632.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27632.patch"
          },
          "closed_at": "2023-06-20T17:55:31Z",
          "created_at": "2023-05-11T23:25:39Z",
          "updated_at": "2023-08-21T22:35:44Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T05:10:32Z",
      "updated_at": "2023-05-12T05:10:32Z",
      "source": {
        "issue": {
          "id": 1705885197,
          "node_id": "PR_kwDOABII585QS9YY",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27626/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27626",
          "number": 27626,
          "state": "closed",
          "state_reason": null,
          "title": "Parallel compact block downloads, take 3",
          "body": "This is an attempt at mitigating https://github.com/bitcoin/bitcoin/issues/25258 , which is a revival of https://github.com/bitcoin/bitcoin/pull/10984, which is a revival of https://github.com/bitcoin/bitcoin/pull/9447.\r\n\r\nThis PR attempts to mitigate a single case, where high bandwidth peers can bail us out of a flakey\r\npeer not completing blocks for us. We allow up to 2 additional getblocktxns requests per unique block.\r\nThis would hopefully allow the chance for an honest high bandwidth peer to hand us the transactions\r\neven if the first in flight peer stalls out.\r\n\r\nIn contrast to previous effort:\r\n\r\n1) it will not help if subsequent peers send block headers only, so only high-bandwidth peers this time. See: https://github.com/bitcoin/bitcoin/pull/10984/files#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R1411\r\n2)  `MAX_GETBLOCKTXN_TXN_AFTER_FIRST_IN_FLIGHT` is removed, in favor of aiding recovery during turbulent mempools\r\n3) We require one of the 3 block fetching slots to be an outbound peer. This can be the original offering peer, or subsequent compact blocks given by high bandwidth peers.\r\n",
          "user": {
            "login": "instagibbs",
            "id": 5767891,
            "node_id": "MDQ6VXNlcjU3Njc4OTE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/instagibbs",
            "html_url": "https://github.com/instagibbs",
            "followers_url": "https://api.github.com/users/instagibbs/followers",
            "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
            "organizations_url": "https://api.github.com/users/instagibbs/orgs",
            "repos_url": "https://api.github.com/users/instagibbs/repos",
            "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/instagibbs/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "milestone": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60",
            "html_url": "https://github.com/bitcoin/bitcoin/milestone/60",
            "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60/labels",
            "id": 9286970,
            "node_id": "MI_kwDOABII584AjbU6",
            "number": 60,
            "state": "open",
            "title": "26.0",
            "description": "",
            "creator": {
              "login": "fanquake",
              "id": 863730,
              "node_id": "MDQ6VXNlcjg2MzczMA==",
              "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/fanquake",
              "html_url": "https://github.com/fanquake",
              "followers_url": "https://api.github.com/users/fanquake/followers",
              "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
              "organizations_url": "https://api.github.com/users/fanquake/orgs",
              "repos_url": "https://api.github.com/users/fanquake/repos",
              "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/fanquake/received_events",
              "type": "User",
              "site_admin": false
            },
            "open_issues": 8,
            "closed_issues": 38,
            "created_at": "2023-04-15T11:36:05Z",
            "updated_at": "2023-09-13T07:33:22Z"
          },
          "locked": false,
          "comments": 32,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27626",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27626",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27626.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27626.patch"
          },
          "closed_at": "2023-05-24T09:09:27Z",
          "created_at": "2023-05-11T14:05:20Z",
          "updated_at": "2023-06-02T15:00:47Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T13:38:32Z",
      "updated_at": "2023-05-12T13:38:32Z",
      "source": {
        "issue": {
          "id": 1707158131,
          "node_id": "PR_kwDOABII585QXPe6",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27636",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27636/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27636/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27636/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27636",
          "number": 27636,
          "state": "closed",
          "state_reason": null,
          "title": "kernel: Remove util/system from kernel library, interface_ui from validation.",
          "body": "This pull request is part of the `libbitcoinkernel` project https://github.com/bitcoin/bitcoin/issues/27587 https://github.com/bitcoin/bitcoin/projects/18 and more specifically its \"Step 2: Decouple most non-consensus code from libbitcoinkernel\".\r\n\r\n---\r\n\r\nIt removes the kernel library's dependency on `util/system` and `interface_ui`. `util/system` contains networking and shell-related code that should not be part of the kernel library. The following pull requests prepared `util/system` for this final step: https://github.com/bitcoin/bitcoin/pull/27419 https://github.com/bitcoin/bitcoin/pull/27254 https://github.com/bitcoin/bitcoin/pull/27238.\r\n\r\n`interface_ui` defines functions for a more general node interface and has a dependency on `boost/signals2`. After applying the patches from this pull request, the kernel's reliance on boost is down to `boost::multiindex`.\r\n\r\nThe approach implemented here introduces some indirection, which makes the code a bit harder to read. Any suggestions for improving or reworking this pull request to make it more concise, or even reworking it into a more proper interface, are appreciated.",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignee": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "ryanofsky",
              "id": 7133040,
              "node_id": "MDQ6VXNlcjcxMzMwNDA=",
              "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/ryanofsky",
              "html_url": "https://github.com/ryanofsky",
              "followers_url": "https://api.github.com/users/ryanofsky/followers",
              "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
              "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
              "repos_url": "https://api.github.com/users/ryanofsky/repos",
              "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 23,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27636",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27636",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27636.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27636.patch"
          },
          "closed_at": "2023-05-30T13:57:34Z",
          "created_at": "2023-05-12T08:03:05Z",
          "updated_at": "2023-05-30T13:57:35Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1545856135,
      "node_id": "IC_kwDOABII585cI-SH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1545856135",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T14:43:06Z",
      "updated_at": "2023-05-12T14:43:06Z",
      "author_association": "MEMBER",
      "body": "I've done a number of runs here with some combination of indexing and pruning, and I think this is in about as good a shape as it can be, with the following caveat:\r\n\r\nWhen using assumeutxo with pruning and indexing, the snapshot chainstate cannot be pruned because of how we handle indexing during bg sync. Since the snapshot chainstate isn't indexed until after the background sync completes (in order to avoid out-of-order indexation), we aren't able to prune the snapshot chainstate based upon the prune blocks that the indices configure.\r\n\r\nSo the upshot of all this is that pruning, when used with assumeutxo and indexing, is basically best-effort. I think that's an okay state as long as we're clear about it to end users. Probably merits some kind of GUI alert which I think can be done later.\r\n\r\nAfter bg sync completes, we're in a pretty good state (`-blockfilterindex` + `-coinstatsindex` + `-prune=550`):\r\n```\r\n777M    /home/james/tmp/bitcoin-au-testing/blocks\r\ntotal 667M\r\ndrwx------ 3 james users 4.0K May 12 07:02 .\r\ndrwx------ 5 james users 4.0K May 12 10:34 ..\r\n-rw------- 1 james users 128M May 11 21:24 blk00014.dat\r\n-rw------- 1 james users 128M May 11 21:24 blk00015.dat\r\n-rw------- 1 james users 127M May 11 21:24 blk00016.dat\r\n-rw------- 1 james users 128M May 12 05:04 blk00017.dat\r\n-rw------- 1 james users  32M May 12 06:41 blk02910.dat\r\n-rw------- 1 james users  48M May 12 10:31 blk03593.dat\r\ndrwx------ 2 james users 4.0K May 12 10:34 index\r\n-rw------- 1 james users  18M May 11 21:24 rev00014.dat\r\n-rw------- 1 james users  18M May 11 21:24 rev00015.dat\r\n-rw------- 1 james users  18M May 11 21:24 rev00016.dat\r\n-rw------- 1 james users  16M May 12 05:04 rev00017.dat\r\n-rw------- 1 james users 3.3M May 12 06:41 rev02910.dat\r\n-rw------- 1 james users 6.0M May 12 10:31 rev03593.dat\r\n```\r\n\r\n---\r\n\r\nThrough the last few days of testing, I did find that I forgot to the divide the prune target by the number of chainstates outstanding, so that may have created some of the weirdness @Sjors was seeing. But otherwise I just think that enabling all these features together results in the necessary trade-off of blowing out the pruning budget.\r\n\r\nAlso worth noting that based on the current size of blocks over the last few weeks, the 244 block trailing prune window is potentially going to result in over 550MB of block data, which is our lowest allowable target.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1545856135",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9233827014,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAImYQTG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9233827014",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T14:43:06Z"
    },
    {
      "event": "subscribed",
      "id": 9233827029,
      "node_id": "SE_lADOABII585lWq3pzwAAAAImYQTV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9233827029",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-12T14:43:06Z"
    },
    {
      "event": "reviewed",
      "id": 1425210799,
      "node_id": "PRR_kwDOABII585U8v2v",
      "url": null,
      "actor": null,
      "commit_id": "b8fd765a06998a79ef6efef5355c956a4679df6f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I started testing this by creating / loading a snapshot on signet at height 100016. I haven't really looked at the code yet and also didn't read the provided docs so that I could do things by trial and error, and hopefully get to the desired result anyway but have a better chance to encounter some edge cases / bugs along the way.\r\n\r\nThings worked really well! Just some observations / minor issues:\r\n- Didn't encounter any problems with indexes, pruning, `-reindex` or `reindex-chainstate`\r\n- In one run, I successfully loaded the chainstate from disk, and then restarted bitcoind (without loading any additional blocks via p2p). Then, init would fail the verification checks with the next startup because the blocks aren't there:\r\n(`Verification error: ReadBlockFromDisk failed at 100016, hash=000001301bada810147463d5b1d72caf0807ad1fdaf015d084f5c474b8cc44c6`)\r\n- I am allowed to do `invalidateblock` on a block smaller than the `assumeUTXO` block before the background state has been loaded and corrupt my block database that way. That's obviously not an issue in practice, so probably no need to fix - just wanted to mention it.\r\n- could add an empty `m_assumeutxo_data` entry in chainparams for signet, like testnet has\r\n- in the `getchainstates` rpc, the field `verificationprogress` has some numerical fluctuations - maybe round this to some reasonable precision\r\n- after the background chainstate has been fully validated, I observed some warnings in the log while running with indexes, not sure if this is something serious:\r\n`2023-05-12T22:06:22Z ChainStateFlushed: WARNING: Locator contains block (hash=000001301bada810147463d5b1d72caf0807ad1fdaf015d084f5c474b8cc44c6) not on known best chain (tip=000000f04acd86089bf33802cfa46e31fa9f99918c32d5a4e7535ae7de57f805); not writing index locator`",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1425210799",
      "submitted_at": "2023-05-12T22:18:07Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-14T09:23:15Z",
      "updated_at": "2023-05-14T09:23:15Z",
      "source": {
        "issue": {
          "id": 1696736253,
          "node_id": "PR_kwDOABII585P0RGI",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27576",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27576/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27576/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27576/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27576",
          "number": 27576,
          "state": "closed",
          "state_reason": null,
          "title": "kernel: Remove args, settings, chainparams, chainparamsbase from kernel library",
          "body": "This pull request is part of the `libbitcoinkernel` project https://github.com/bitcoin/bitcoin/issues/27587 https://github.com/bitcoin/bitcoin/projects/18 and more specifically its \"Step 2: Decouple most non-consensus code from libbitcoinkernel\".\r\n\r\n---\r\n\r\nThis completes the removal of the node's chainparams, chainparamsbase, args and settings files and their respective classes from the kernel library. This is the last pull request in a long series working towards decoupling the `ArgsManager` and the `gArgs` global from kernel code. These prior pull requests are: https://github.com/bitcoin/bitcoin/pull/26177 https://github.com/bitcoin/bitcoin/pull/27125 https://github.com/bitcoin/bitcoin/pull/25527 https://github.com/bitcoin/bitcoin/pull/25487 https://github.com/bitcoin/bitcoin/pull/25290\r\n\r\n",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27576",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27576",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27576.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27576.patch"
          },
          "closed_at": "2023-06-09T18:59:02Z",
          "created_at": "2023-05-04T21:36:34Z",
          "updated_at": "2023-06-13T13:22:49Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "labeled",
      "id": 9253040634,
      "node_id": "LE_lADOABII585lWq3pzwAAAAInhjH6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9253040634",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T03:43:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T10:04:25Z",
      "updated_at": "2023-05-16T10:04:25Z",
      "source": {
        "issue": {
          "id": 1711688372,
          "node_id": "I_kwDOABII585mBkq0",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27669",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27669/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27669/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27669/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/27669",
          "number": 27669,
          "state": "open",
          "state_reason": null,
          "title": "Use muhash for assumeUTXO snapshot ",
          "body": "Currently `dumptxoutset` uses `hash_serialized_2` for its `txoutset_hash`. The proposed `loadtxoutset` (#27596) then checks this against the hash we hardcode in `CChainParams`.\r\n\r\nUnfortunately the only way to check this hash, if you're not using it yourself, is to rollback the chain to the assume-utxo snapshot height, call the (slow) `gettxoutsetinfo` and then replay to the tip. This process is slow and potentially wreaks havoc on your lightning node if you forget to shut it down first.\r\n\r\nIf we used the MuHash instead then any user with `-coinstatsindex` can verify it with a simple `gettxoutsetinfo muhash HEIGHT`.\r\n\r\n~For good measure we should also modify `gettxoutsetinfo` so it can calculate the muhash for the current UTXO set without relying on the index. This would help users with pruned nodes (and without the index) to verify a newly proposed snapshot (if they haven't pruned beyond it).~ (we already do this)\r\n\r\nI think this can be changed after #27596 is merged. It would just require offering two snapshots for download for a while.",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 5,
          "created_at": "2023-05-16T10:04:25Z",
          "updated_at": "2023-05-17T20:07:28Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1549423309,
      "node_id": "IC_kwDOABII585cWlLN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1549423309",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-16T10:42:43Z",
      "updated_at": "2023-05-16T10:43:16Z",
      "author_association": "MEMBER",
      "body": "Here's a signet snapshot torrent: `magnet:?xt=urn:btih:0e1a61b4ed9a57c41d98f1ddd5061bc088c857b6&dn=utxo-signet-140000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n\r\nCan be added to `kernel/chainparams.cpp` with:\r\n\r\n```cpp\r\nm_assumeutxo_data = MapAssumeutxo{\r\n            {\r\n                140'000,\r\n                {AssumeutxoHash{uint256S(\"0x91412d7018c8564beef1938eef2bfe18feee53674fd26bea425daa4280437641\")}, 2233882},\r\n            },\r\n        };\r\n```\r\n\r\nThis basically gets you to the signet tip faster than you can hit enter :-)",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1549423309",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "labeled",
      "id": 9272897054,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIotS4e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9272897054",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-17T19:12:00Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1431794725,
      "node_id": "PRR_kwDOABII585VV3Ql",
      "url": null,
      "actor": null,
      "commit_id": "b8fd765a06998a79ef6efef5355c956a4679df6f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Did the following more or less random test scenario (build at commit b8fd765a06998a79ef6efef5355c956a4679df6f) over the last days:\r\n- start up `bitcoind -prune=800 -blockfilterindex=1` (-dbcache intentionally left at default)\r\n- load snapshot from height 788000 via `bitcoind loadtxoutset /path/to/utxo-788000.dat` (thanks for providing the file!)\r\n- wait until snapshot chainstate reaches network tip\r\n- shut down the node and wait 1-2 days (with the idea to again provoke both chainstates being in IBD again)\r\n- restart `bitcoind -prune=800 -blockfilterindex=1`\r\n- wait until snapshot chainstate reaches network tip\r\n- watch background validation proceed\r\n\r\nSo far so good, everything went quite smooth and nothing unexpected happened! The only disappointment was finding that apparently the provided prune target of 800MB was not respected:\r\n```\r\n$ du -h ./datadir/blocks/ \r\n116M    ./datadir/blocks/index\r\n4.8G    ./datadir/blocks/\r\n```\r\n(background validation was at block ~230000 at that point)\r\n\r\nLooking at the block files (being in ranges blk00001-blk00030 and blk00084-blk00086), it _seems_ that in my case the prune target is respected only for the background chainstate, but the block files blk00001.dat-blk00030.dat (which were obviously created in the course of snapshot chainstate validation, catching up to the network tip for the second time, looking at the timestamp) are just sitting there and didn't get pruned anymore for some reason. Any idea what's going on here?",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1431794725",
      "submitted_at": "2023-05-18T00:37:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1553127188,
      "node_id": "IC_kwDOABII585cktcU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1553127188",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:15:02Z",
      "updated_at": "2023-05-18T14:15:02Z",
      "author_association": "MEMBER",
      "body": "Thanks for testing, @theStack!\r\n\r\n> So far so good, everything went quite smooth and nothing unexpected happened! The only disappointment was finding that apparently the provided prune target of 800MB was not respected:\r\n\r\nYes, this is unfortunately expected behavior. Since you have `-blockfilterindex` enabled and the background sync hasn't yet completed, prune locks are preventing any pruning from happening on the snapshot chainstate. I mentioned this obliquely here: https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1545856135\r\n\r\nThe only way around this would be to mark indexes which can be built out of order (i.e. everything except coinstats) and only halt snapshot indexation for those that can't. But this is something that could be done after the initial assumeutxo feature.\r\n",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1553127188",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9280332010,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIpJqDq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280332010",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:15:03Z"
    },
    {
      "event": "subscribed",
      "id": 9280332023,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIpJqD3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9280332023",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-18T14:15:03Z"
    },
    {
      "event": "commented",
      "id": 1558205497,
      "node_id": "IC_kwDOABII585c4FQ5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1558205497",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T23:55:28Z",
      "updated_at": "2023-05-22T23:55:28Z",
      "author_association": "CONTRIBUTOR",
      "body": ">>So far so good, everything went quite smooth and nothing unexpected happened! The only disappointment was finding that apparently the provided prune target of 800MB was not respected:\r\n>\r\n>Yes, this is unfortunately expected behavior. Since you have -blockfilterindex enabled and the background sync hasn't yet completed, prune locks are preventing any pruning from happening on the snapshot chainstate. I mentioned this obliquely here: https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1545856135\r\n\r\n@jamesob: Thanks for clarifying (admittedly I didn't read your comment just a few posts above before posting my test results), it makes sense that we have to keep the blocks from the snapshot chainstate for the indexer at least until background sync completes. I'd agree that this is not a problem as long as it is clearly communicated to the user, e.g. by putting a well-visible warning into the `loadtxoutset` RPC help. The ultra-conservative approach here would be to simply throw an error if a snapshot is loaded on a node that was started with both pruning and an index enabled (if keeping the `-prune` target promise has absolute highest priority), but that seems to be too limiting.\r\n\r\n",
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1558205497",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9308857647,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIq2eUv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9308857647",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T23:55:28Z"
    },
    {
      "event": "subscribed",
      "id": 9308857656,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIq2eU4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9308857656",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T23:55:29Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9318328693,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIraml1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318328693",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:12:14Z"
    },
    {
      "event": "commented",
      "id": 1559752787,
      "node_id": "IC_kwDOABII585c9_BT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559752787",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:12:29Z",
      "updated_at": "2023-05-23T16:12:29Z",
      "author_association": "MEMBER",
      "body": "Rebased",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1559752787",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:46:01Z",
      "updated_at": "2023-05-23T16:46:01Z",
      "source": {
        "issue": {
          "id": 1015261643,
          "node_id": "PR_kwDOABII584spOXp",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23174",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23174/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23174/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/23174/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/23174",
          "number": 23174,
          "state": "closed",
          "state_reason": null,
          "title": "validation: have LoadBlockIndex account for snapshot use",
          "body": "This is part of the [assumeutxo project](https://github.com/bitcoin/bitcoin/projects/11) (parent PR: #15606) \r\n\r\n---\r\n\r\nCurrently, `BlockManager::LoadBlockIndex` adds all blocks that have downloaded transactions to the active chain state's `setBlockIndexCandidates` set, ignoring the background chain state.\r\n\r\nThis PR changes ChainstateManager::LoadBlockIndex to update `setBlockIndexCandidates` in the background chain, not just the active chain. In the active chain, the same blocks are added as before. In the background chain, only blocks that have actually been validated, not blocks marked assumed-valid are added so the background chain will continue to download and validate assumed-valid blocks.",
          "user": {
            "login": "jamesob",
            "id": 73197,
            "node_id": "MDQ6VXNlcjczMTk3",
            "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jamesob",
            "html_url": "https://github.com/jamesob",
            "followers_url": "https://api.github.com/users/jamesob/followers",
            "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
            "organizations_url": "https://api.github.com/users/jamesob/orgs",
            "repos_url": "https://api.github.com/users/jamesob/repos",
            "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/jamesob/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/23174",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/23174",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/23174.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/23174.patch"
          },
          "closed_at": "2021-12-15T10:08:54Z",
          "created_at": "2021-10-04T14:33:59Z",
          "updated_at": "2023-05-23T18:40:22Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1559813326,
      "node_id": "IC_kwDOABII585c-NzO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1559813326",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:48:37Z",
      "updated_at": "2023-05-23T16:48:37Z",
      "author_association": "MEMBER",
      "body": "Cross-linking to some discussion on how we load the block index that @sdaftuar has surfaced: https://github.com/bitcoin/bitcoin/pull/23174/files#r1198450499\r\n\r\nIf anyone has encountered an issue like this while testing this branch, a comment would be welcome.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1559813326",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9318704026,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIrcCOa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318704026",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:48:38Z"
    },
    {
      "event": "subscribed",
      "id": 9318704044,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIrcCOs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318704044",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T16:48:38Z"
    },
    {
      "event": "unlabeled",
      "id": 9318951103,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIrc-i_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9318951103",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:18:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:41:07Z",
      "updated_at": "2023-05-23T17:41:07Z",
      "source": {
        "issue": {
          "id": 1720000759,
          "node_id": "PR_kwDOABII585RCLoW",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27720",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27720/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27720/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27720/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27720",
          "number": 27720,
          "state": "closed",
          "state_reason": null,
          "title": "index: prevent race by calling 'CustomInit' prior setting 'synced' flag",
          "body": "Decoupled from #27607.\r\n\r\nFixed a potential race condition in master (not possible so far) that could become an actual issue soon.\r\nWhere the index's  `CustomAppend` method could be called (from `BlockConnected`) before its\r\n`CustomInit` method, causing the index to try to update itself before it is initialized.\r\n\r\nThis could happen because we set the index `m_synced` flag (which enables `BlockConnected` events)\r\nbefore calling to the child class init function (`CustomInit`). So, for example, the block filter index could\r\nprocess a block before initialize the next filter position field and end up overwriting the first stored filter.\r\n \r\nThis race was introduced in https://github.com/bitcoin/bitcoin/commit/bef4e405f3de2718dfee279a9abff4daf016da26 from https://github.com/bitcoin/bitcoin/pull/25494.\r\n",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 97470796,
              "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
              "name": "UTXO Db and Indexes",
              "color": "fbca04",
              "default": false
            }
          ],
          "assignee": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "ryanofsky",
              "id": 7133040,
              "node_id": "MDQ6VXNlcjcxMzMwNDA=",
              "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/ryanofsky",
              "html_url": "https://github.com/ryanofsky",
              "followers_url": "https://api.github.com/users/ryanofsky/followers",
              "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
              "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
              "repos_url": "https://api.github.com/users/ryanofsky/repos",
              "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 2,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27720",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27720",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27720.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27720.patch"
          },
          "closed_at": "2023-05-31T17:56:44Z",
          "created_at": "2023-05-22T16:08:54Z",
          "updated_at": "2023-05-31T18:26:53Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:46:27Z",
      "updated_at": "2023-05-23T17:46:27Z",
      "source": {
        "issue": {
          "id": 1718465932,
          "node_id": "PR_kwDOABII585Q9EjQ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27711",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27711/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27711/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27711/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27711",
          "number": 27711,
          "state": "closed",
          "state_reason": null,
          "title": "kernel:  Remove shutdown globals from kernel library",
          "body": "This pull request is part of the `libbitcoinkernel` project https://github.com/bitcoin/bitcoin/issues/27587 https://github.com/orgs/bitcoin/projects/3 and more specifically its \"Step 2: Decouple most non-consensus code from libbitcoinkernel\".\r\n\r\n---\r\n\r\nThis removes the shutdown files from the kernel library. As a standalone library the libbitcoinkernel should not have to rely on code that accesses shutdown state through a global. Instead, replace it with an interrupt class that is owned by the kernel context. Additionally this moves the remaining usages of the `uiInterface` out of the kernel code. The process of moving the `uiInterface` out of the kernel was started in https://github.com/bitcoin/bitcoin/pull/27636.\r\n\r\nThe approach taken here uses the notification interface to externalize the existing shutdown code from the kernel library. The `SignalInterrupt` kernel context member is passed by reference to the `ChainstateManager` to allow for the termination of long-running kernel functions and sending interrupt signals.\r\n",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 20,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27711",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27711",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27711.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27711.patch"
          },
          "closed_at": "2023-07-08T10:45:07Z",
          "created_at": "2023-05-21T11:20:12Z",
          "updated_at": "2023-07-08T10:45:07Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 9319195935,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIrd6Uf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9319195935",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T17:49:29Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1560035238,
      "node_id": "IC_kwDOABII585c_D-m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1560035238",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-23T19:49:26Z",
      "updated_at": "2023-05-25T20:08:32Z",
      "author_association": "MEMBER",
      "body": "New bug, albeit pretty minor:\r\n\r\n- [x] ~~if you restart the node after activating the snapshot but before connecting any blocks to the snapshot chainstate, `ReadBlockFromDisk` checks fail when calling `VerifyDB()` during chainstate initialization. I'm not sure when this would happen in practice, but it's an annoying edge case.~~\r\n\r\nEdit: fixed this.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1560035238",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "labeled",
      "id": 9326073484,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIr4JaM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9326073484",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T10:38:39Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T20:05:01Z",
      "updated_at": "2023-05-24T20:05:01Z",
      "source": {
        "issue": {
          "id": 1724651759,
          "node_id": "PR_kwDOABII585RSIlY",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27746",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27746/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27746/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27746/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27746",
          "number": 27746,
          "state": "closed",
          "state_reason": null,
          "title": "Rework validation logic for assumeutxo",
          "body": "This PR proposes a clean up of the relationship between block storage and the chainstate objects, by moving the decision of whether to store a block on disk to something that is not chainstate-specific.  Philosophically, the decision of whether to store a block on disk is related to validation rules that do not require any UTXO state; for anti-DoS reasons we were using some chainstate-specific heuristics, and those have been reworked here to achieve the proposed separation.\r\n\r\nThis PR also fixes a bug in how a chainstate's `setBlockIndexCandidates` was being initialized; it should always have all the HAVE_DATA block index entries that have more work than the chain tip.  During startup, we were not fully populating `setBlockIndexCandidates` in some scenarios involving multiple chainstates.\r\n\r\nFurther, this PR establishes a concept that whenever we have 2 chainstates, that we always know the snapshotted chain's base block and the base block's hash must be an element of our block index. Given that, we can establish a new invariant that the background validation chainstate only needs to consider blocks leading to that snapshotted block entry as potential candidates for its tip. As a followup I would imagine that when writing net_processing logic to download blocks for the background chainstate, that we would use this concept to only download blocks towards the snapshotted entry as well.",
          "user": {
            "login": "sdaftuar",
            "id": 7463573,
            "node_id": "MDQ6VXNlcjc0NjM1NzM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sdaftuar",
            "html_url": "https://github.com/sdaftuar",
            "followers_url": "https://api.github.com/users/sdaftuar/followers",
            "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
            "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
            "repos_url": "https://api.github.com/users/sdaftuar/repos",
            "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 18,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27746",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27746",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27746.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27746.patch"
          },
          "closed_at": "2023-07-31T20:18:35Z",
          "created_at": "2023-05-24T19:57:32Z",
          "updated_at": "2023-09-11T17:56:32Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9344052785,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIs8u4x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344052785",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:07:09Z"
    },
    {
      "event": "commented",
      "id": 1563455744,
      "node_id": "IC_kwDOABII585dMHEA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563455744",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:16:40Z",
      "updated_at": "2023-05-25T20:16:40Z",
      "author_association": "MEMBER",
      "body": "Rebased.\r\n\r\nI've made a few changes/improvements that I think fixes the bug @sdaftuar found (not adding all potential tips to `setBlockIndexCandidates`), albeit I'm not yet integrating the changes in #27746.\r\n\r\n- More comprehensive functional tests: the tests now stop and start at more points throughout the sync process, including immediately after snapshot load and before bg validation completes.\r\n- We now include the blockhash of the snapshot base in `m_assumeutxo_data`; this allows us to move the `nChainTx` reconstruction where it belongs, into `BlockManager::LoadBlockIndex()`.\r\n- All blocks for which we have data (or are assumedvalid) are added to all chainstates' `setBlockIndexCandidates`.\r\n  - Some related changes in `CheckBlockIndex()` needed to be made to update some outdated assertions.\r\n\r\nI'm going to be taking a close look at @sdaftuar's proposed changes over the next few days to see if I can integrate them here.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1563455744",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 9344121793,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAIs8_vB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344121793",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:16:41Z"
    },
    {
      "event": "subscribed",
      "id": 9344121803,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIs8_vL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344121803",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:16:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9344167985,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIs9LAx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344167985",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:23:21Z"
    },
    {
      "event": "labeled",
      "id": 9344168520,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIs9LJI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344168520",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:23:26Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9344227981,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIs9ZqN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9344227981",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T20:32:06Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1563571639,
      "node_id": "IC_kwDOABII585dMjW3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563571639",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T22:13:48Z",
      "updated_at": "2023-05-25T22:13:48Z",
      "author_association": "MEMBER",
      "body": "> All blocks for which we have data (or are assumedvalid) are added to all chainstates' setBlockIndexCandidates.\r\n\r\nBeing assumedvalid is unrelated to whether we should add an entry to `setBlockIndexCandidates`; `setBlockIndexCandidates` should have the current tip and any block for which we HAVE_DATA and for which we HAVE_DATA for all the blocks that we'd need to connect, in order to get from our current tip to that target block.  \r\n\r\nThe assumedvalid bit is really just something we're using to help with adjusting the invariants in `CheckBlockIndex()`; it should have no bearing on any of the actual validation logic outside of that.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1563571639",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T03:11:04Z",
      "updated_at": "2023-05-26T03:11:04Z",
      "source": {
        "issue": {
          "id": 1724281348,
          "node_id": "PR_kwDOABII585RQ35P",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27742",
          "number": 27742,
          "state": "open",
          "state_reason": null,
          "title": "[NO MERGE] BIP331 Ancestor Package Relay",
          "body": "**WORK IN PROGRESS.** Please do not run it for any use other than testing.\r\n  \r\nThis PR is not meant for merge. This branch exists to help reviewers see what package relay would look like all together. I will open separate PRs for these components and expect to add more tests, docs, and polish along the way. This PR contains all of the functionality built in a linear manner. However, since there are pieces in various areas of the codebase and they can make progress in parallel, commits don't necessarily need to be merged in this order.\r\n\r\n**See #27463 for what PR(s) are open for review right now.**\r\n\r\n## Note to Reviewers\r\n\r\nThe major purpose of this PR is to solicit \"approach\" review.\r\n\r\nThis is a large project, and the first few p2p commits essentially define the interface. I'd like to get rough consensus on approach before we start looking at code details and merging PRs, because I believe it will help us \"get useful stuff in\" faster and avoid premature optimizations.\r\n\r\nHere are some questions I hope are answered before we try to merge anything (originally https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1572205313):\r\n\r\n1. Does the proposed protocol look sound?\r\n2. Are these 3 milestones appropriate?\r\n3. Is there important functionality that is in the \"todo improvements\" section but should be included in one of the 3 milestones? Alternatively, is there not-that-important stuff in the milestones that we should defer until later?\r\n4. Does it make sense to have this PeerManager <-> TxPackageTracker <-> TxOrphanage relationship?\r\n\r\n\r\nComments about naming, typos, code details, etc. are also appreciated but please note I may wait until their respective PRs are open to incorporate your comments. Thank you for your patience.\r\n\r\n## Project Structure\r\n\r\n### 3 Major Milestones\r\n\r\nThis project is split into 3 milestones, each of which gives us something useful.\r\n\r\n1. Modularize and improve orphan-handling (also some refactoring).\r\n\t- Introduce a `TxPackageTracker` class, responsible for orphan handling. It starts out as a wrapper for the `TxOrphanage`.\r\n\t- Use all announcers as potential candidates for resolving an orphan. Add a `TxRequestTracker` Orphan Request Tracker which helps track orphans we need to resolve. Preferentially request orphan resolution from outbounds, preferred relay, etc., over inbounds.\r\n\r\n2. When package relay peers are available, use `ancpkginfo` instead of missing parents when handling orphans.\r\n\t- Add `sendpackages` negotiation logic.\r\n\t- Add a separate rejections filter for transactions that are eligible for reconsideration when validated together as a package, so that children of low-feerate transactions are still considered.\r\n\t- Send `getdata(MSG_ANCPKGINFO)` to package relay peers for orphan resolution. Use `ancpkginfo` to request missing ancestors through normal individual transaction relay.\r\n\r\n3. Download and validate ancestor packages using `getpkgtxns` and `pkgtxns`.\r\n\t- Add support for `getpkgtxns` and `pkgtxns`. Send a `pkgtxns` using the list of missing transactions from `ancpkginfo`.\r\n\t- Ensure we can process \"normal\" orphans even if a peer is trying to overwhelm/churn our orphanage. Do this by \"opportunistically\" protecting orphans from random eviction if they were sent by package relay peers, and redownloading orphans if we cannot afford to protect them. Each peer is allocated a certain amount of orphans they can protect at a time (\"token bucket\" style but the number of tokens is static for now). Outbound peers get more than inbounds.\r\n\t- If a transaction's parent(s) are below the fee filter, don't announce it (save the bandwidth of legacy nodes).\r\n\r\n###  Todo improvements \r\nThese could be added to the milestones or deferred until basic functionality is deployed.\r\n- Store orphans serialized instead of as CTransactionRefs to significantly reduce their memory usage.\r\n- Perhaps try to keep orphans in disk and/or process them asynchronously, given the incredibly DoSable nature of orphan handling.\r\n- Dynamically allocate tokens for orphan protection. For example, if a long-standing inbound peer continuously provides good packages for orphans, they should have more tokens. If a peer is obviously serving us garbage, reduce their tokens.\r\n- Detect when we have received all the transactions for a package, regardless of how (individual or block or other), and return `PackageToValidate`  in `GetTxToReconsider`.\r\n- New format for mempool.dat, packages instead of transactions.",
          "user": {
            "login": "glozow",
            "id": 25183001,
            "node_id": "MDQ6VXNlcjI1MTgzMDAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/glozow",
            "html_url": "https://github.com/glozow",
            "followers_url": "https://api.github.com/users/glozow/followers",
            "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
            "organizations_url": "https://api.github.com/users/glozow/orgs",
            "repos_url": "https://api.github.com/users/glozow/repos",
            "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/glozow/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 11,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27742",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27742.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27742.patch"
          },
          "created_at": "2023-05-24T15:38:55Z",
          "updated_at": "2023-09-05T13:07:49Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9354464696,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAItkc24",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9354464696",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T20:28:39Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9354729431,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAItldfX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9354729431",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T21:14:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9354950531,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAItmTeD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9354950531",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T22:06:43Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T22:22:20Z",
      "updated_at": "2023-05-26T22:22:20Z",
      "source": {
        "issue": {
          "id": 1728254466,
          "node_id": "PR_kwDOABII585ReWin",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27770",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27770/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27770/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27770/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27770",
          "number": 27770,
          "state": "open",
          "state_reason": null,
          "title": "Introduce 'getblockfileinfo' RPC command",
          "body": "Implemented `getblockfileinfo` RPC command to obtain block files related data.\r\n\r\nThe new RPC could be useful for:\r\n\r\n1) Make manual pruning process more transparent: Currently, users blindly provide a height to `pruneblockchain` and only realizes up to which block the node was pruned from the RPC command result. This new introduced command lets the user know where to set the `pruneblockchain` height by knowing the highest and lowest block heights stored on each file. So users will actually be able to remove specific block ranges (with some exceptions, as blocks can be stored out of order in different block files.. but that is a different topic).\r\n\r\n2) Make tests more robust and readable by removing magic numbers like the ones presented in `rpc_getblockfrompeer.py` (which are actually off by a good degree and not really document anywhere, see [comment](https://github.com/bitcoin/bitcoin/pull/27770#issuecomment-1567161622)).\r\n\r\n3) And also for testing AssumeUTXO. Which, per mzumzande comment: it usage could result in block files with a very mixed-up block order. So having a way to analyse this better seems like it could be helpful. Also see a live scenario in [theStack comment](https://github.com/bitcoin/bitcoin/pull/27770#issuecomment-1569050370).",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98279177,
              "node_id": "MDU6TGFiZWw5ODI3OTE3Nw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/RPC/REST/ZMQ",
              "name": "RPC/REST/ZMQ",
              "color": "0052cc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 12,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27770",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27770",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27770.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27770.patch"
          },
          "created_at": "2023-05-26T21:14:48Z",
          "updated_at": "2023-08-24T22:56:08Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 9355218352,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAItnU2w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9355218352",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T23:18:28Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1450841472,
      "node_id": "PRR_kwDOABII585WehWA",
      "url": null,
      "actor": null,
      "commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1450841472",
      "submitted_at": "2023-05-30T12:38:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1450842970,
      "node_id": "PRR_kwDOABII585Wehta",
      "url": null,
      "actor": null,
      "commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1450842970",
      "submitted_at": "2023-05-30T12:39:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "labeled",
      "id": 9380216126,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIvGr0-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9380216126",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-30T15:50:58Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9391935604,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIvzZB0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9391935604",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T15:13:01Z"
    },
    {
      "event": "commented",
      "id": 1570432290,
      "node_id": "IC_kwDOABII585dmuUi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570432290",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T15:16:04Z",
      "updated_at": "2023-05-31T15:16:04Z",
      "author_association": "MEMBER",
      "body": "Rebased\r\n\r\nAlso fixed the minor issues with the `test_utxo_snapshots.sh` demo script.\r\n\r\nSince last push, I've completed a full test of the mainnet snapshot; after a few days having finished the background sync, `-prune=550` (and everything else) working as expected.\r\n\r\n```\r\n759M    /home/james/tmp/bitcoin-au-testing/blocks\r\ntotal 650M\r\ndrwx------ 3 james users 4.0K May 31 10:54 .\r\ndrwx------ 5 james users 4.0K May 31 11:09 ..\r\n-rw------- 1 james users 127M May 29 15:33 blk03626.dat\r\n-rw------- 1 james users 128M May 30 02:38 blk03627.dat\r\n-rw------- 1 james users 128M May 30 17:29 blk03628.dat\r\n-rw------- 1 james users 128M May 31 06:05 blk03629.dat\r\n-rw------- 1 james users  64M May 31 10:57 blk03630.dat\r\ndrwx------ 2 james users 4.0K May 31 10:54 index\r\n-rw------- 1 james users  17M May 29 15:30 rev03626.dat\r\n-rw------- 1 james users  15M May 30 02:36 rev03627.dat\r\n-rw------- 1 james users  19M May 30 17:23 rev03628.dat\r\n-rw------- 1 james users  18M May 31 06:01 rev03629.dat\r\n-rw------- 1 james users 8.0M May 31 10:57 rev03630.dat\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1570432290",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "unlabeled",
      "id": 9393194606,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIv4MZu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9393194606",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T17:06:32Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9393291513,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIv4kD5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9393291513",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T17:17:52Z"
    },
    {
      "event": "labeled",
      "id": 9393292068,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIv4kMk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9393292068",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T17:17:57Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 9394409182,
      "node_id": "LE_lADOABII585lWq3pzwAAAAIv807e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9394409182",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T19:11:31Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9394505678,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAIv9MfO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9394505678",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T19:21:02Z"
    },
    {
      "event": "commented",
      "id": 1570801767,
      "node_id": "IC_kwDOABII585doIhn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1570801767",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T19:21:26Z",
      "updated_at": "2023-05-31T19:21:26Z",
      "author_association": "MEMBER",
      "body": "Rebased",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1570801767",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "unlabeled",
      "id": 9395585890,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIwBUNi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9395585890",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-31T21:15:08Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9397722692,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAIwJd5E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9397722692",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-01T03:40:51Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "subscribed",
      "id": 9452072828,
      "node_id": "SE_lADOABII585lWq3pzwAAAAIzYy98",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9452072828",
      "actor": {
        "login": "mailinger-mate",
        "id": 10153820,
        "node_id": "MDQ6VXNlcjEwMTUzODIw",
        "avatar_url": "https://avatars.githubusercontent.com/u/10153820?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mailinger-mate",
        "html_url": "https://github.com/mailinger-mate",
        "followers_url": "https://api.github.com/users/mailinger-mate/followers",
        "following_url": "https://api.github.com/users/mailinger-mate/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mailinger-mate/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mailinger-mate/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mailinger-mate/subscriptions",
        "organizations_url": "https://api.github.com/users/mailinger-mate/orgs",
        "repos_url": "https://api.github.com/users/mailinger-mate/repos",
        "events_url": "https://api.github.com/users/mailinger-mate/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mailinger-mate/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-07T00:24:00Z"
    },
    {
      "event": "commented",
      "id": 1583637570,
      "node_id": "IC_kwDOABII585eZGRC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1583637570",
      "actor": {
        "login": "hazeycode",
        "id": 22148308,
        "node_id": "MDQ6VXNlcjIyMTQ4MzA4",
        "avatar_url": "https://avatars.githubusercontent.com/u/22148308?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hazeycode",
        "html_url": "https://github.com/hazeycode",
        "followers_url": "https://api.github.com/users/hazeycode/followers",
        "following_url": "https://api.github.com/users/hazeycode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hazeycode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hazeycode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hazeycode/subscriptions",
        "organizations_url": "https://api.github.com/users/hazeycode/orgs",
        "repos_url": "https://api.github.com/users/hazeycode/repos",
        "events_url": "https://api.github.com/users/hazeycode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hazeycode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-09T00:05:10Z",
      "updated_at": "2023-06-09T00:24:32Z",
      "author_association": "NONE",
      "body": "Related minor issue: https://github.com/bitcoin/bitcoin/issues/27841. I don't think it matters but posting for visibility in case it happens to be helpful to someone.",
      "user": {
        "login": "hazeycode",
        "id": 22148308,
        "node_id": "MDQ6VXNlcjIyMTQ4MzA4",
        "avatar_url": "https://avatars.githubusercontent.com/u/22148308?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hazeycode",
        "html_url": "https://github.com/hazeycode",
        "followers_url": "https://api.github.com/users/hazeycode/followers",
        "following_url": "https://api.github.com/users/hazeycode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hazeycode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hazeycode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hazeycode/subscriptions",
        "organizations_url": "https://api.github.com/users/hazeycode/orgs",
        "repos_url": "https://api.github.com/users/hazeycode/repos",
        "events_url": "https://api.github.com/users/hazeycode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hazeycode/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1583637570",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "commented",
      "id": 1585587421,
      "node_id": "IC_kwDOABII585egiTd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1585587421",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-10T09:45:27Z",
      "updated_at": "2023-06-10T09:45:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "> This may look like a lot to review, but note that\r\n> \r\n>     * 200 lines are duplicated in #24008\r\n\r\nThis should refer to #27746 now, shouldn't it?\r\n",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1585587421",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "labeled",
      "id": 9502327933,
      "node_id": "LE_lADOABII585lWq3pzwAAAAI2YgR9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9502327933",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-12T12:53:14Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1504152824,
      "node_id": "PRR_kwDOABII585Zp4z4",
      "url": null,
      "actor": null,
      "commit_id": "3dc6fd620e28de6060a36e9fb53875348f67836d",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "While testing.\r\n>Once you get the full headers chain, you'll spend a decent amount of time (~10min) loading the snapshot, checking it, and flushing it to disk\r\n\r\n`FlushSnapshotToDisk: saving snapshot chain state (10588 MB) started` takes about 5 hours to complete on pop-OS 22.\r\nDuring the `FlushSnapshotToDisk` process, I believe there should be some progress indication, similar to what occurs during the snapshot loading process. Currently, it appears to be like it is stuck.\r\n\r\nWhen I attempted to shut down `bitcoind` while `FlushSnapshotToDisk` was in progress, it resulted in some sort of a deadlock.\r\n\r\nBelow are the logs after I stop `bitcoind` while saving the snapshot.\r\n```\r\n2023-06-27T17:45:52Z [httpworker.0] [snapshot] 90000000 coins loaded (99.72%, 10561 MB)\r\n2023-06-27T17:45:52Z [httpworker.0] [snapshot] loaded 90249783 (10588 MB) coins from snapshot 00000000000000000001f3fa1b4c03c877740778f56b0d5456b18dd88f7f695e\r\n2023-06-27T17:45:52Z [httpworker.0] FlushSnapshotToDisk: saving snapshot chainstate (10588 MB) started\r\n2023-06-27T18:00:33Z [httpworker.1] [snapshot] waiting to see blockheader 00000000000000000001f3fa1b4c03c877740778f56b0d5456b18dd88f7f695e in headers chain before snapshot activation\r\n2023-06-27T18:15:54Z [init] tor: Thread interrupt\r\n2023-06-27T18:15:54Z [addcon] addcon thread exit\r\n2023-06-27T18:15:54Z [torcontrol] torcontrol thread exit\r\n2023-06-27T18:15:54Z [init] Shutdown: In progress...\r\n2023-06-27T18:15:54Z [net] net thread exit\r\n```\r\n\r\nTried to `pkill bitcoind` but it's still running possibly waiting for the flush to finish.",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1504152824",
      "submitted_at": "2023-06-28T21:45:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "comment_deleted",
      "id": 9672435093,
      "node_id": "CDE_lADOABII585lWq3pzwAAAAJAhaWV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9672435093",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-29T04:29:04Z"
    },
    {
      "event": "reviewed",
      "id": 1516971308,
      "node_id": "PRR_kwDOABII585aayUs",
      "url": null,
      "actor": null,
      "commit_id": "3dc6fd620e28de6060a36e9fb53875348f67836d",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "Tested ACK built with and tested on WSL Ubuntu 22.04\r\n\r\n> you'll spend a decent amount of time (~10min) loading the snapshot\r\n\r\nthis took closer to 30 min with an Intel(R) Core(TM) i9-10980HK CPU @ 2.40GHz   3.10 GHz\r\n\r\n`getchainstates` returns:\r\n```\r\n{\r\n  \"active_chain_type\": \"snapshot\",\r\n  \"ibd\": {\r\n    \"blocks\": 896,\r\n    \"bestblockhash\": \"00000000dabe35441efb615ad072e22ece58326cf0a43b990fc00aab808e8589\",\r\n    \"difficulty\": 1,\r\n    \"verificationprogress\": 1.076164026301743e-06,\r\n    \"snapshot_blockhash\": \"0000000000000000000000000000000000000000000000000000000000000000\",\r\n    \"initialblockdownload\": true,\r\n    \"coins_db_cache_bytes\": 419430,\r\n    \"coins_tip_cache_bytes\": 366490419,\r\n    \"has_mempool\": false\r\n  },\r\n  \"snapshot\": {\r\n    \"blocks\": 789045,\r\n    \"bestblockhash\": \"000000000000000000030939094d57c25369fbed9b6bafe94896de37f47d77f5\",\r\n    \"difficulty\": 48005534313578.78,\r\n    \"verificationprogress\": 0.9786754966337523,\r\n    \"snapshot_blockhash\": \"00000000000000000001f3fa1b4c03c877740778f56b0d5456b18dd88f7f695e\",\r\n    \"initialblockdownload\": true,\r\n    \"coins_db_cache_bytes\": 7969177,\r\n    \"coins_tip_cache_bytes\": 6963317964,\r\n    \"has_mempool\": true\r\n  },\r\n  \"headers\": 797452\r\n}\r\n```\r\n\r\nAnd `getblockchaininfo` returns:\r\n```\r\n{\r\n  \"chain\": \"main\",\r\n  \"blocks\": 789140,\r\n  \"headers\": 797452,\r\n  \"bestblockhash\": \"000000000000000000049973648ea7a15bf2c7f3585eb8700f889e9aca5af73c\",\r\n  \"difficulty\": 48005534313578.78,\r\n  \"time\": 1683751586,\r\n  \"mediantime\": 1683748352,\r\n  \"verificationprogress\": 0.9788762180334918,\r\n  \"initialblockdownload\": true,\r\n  \"chainwork\": \"0000000000000000000000000000000000000000481500309c4ab2d789f587f6\",\r\n  \"size_on_disk\": 2225580771,\r\n  \"pruned\": true,\r\n  \"pruneheight\": 788001,\r\n  \"automatic_pruning\": true,\r\n  \"prune_target_size\": 3145728000,\r\n  \"warnings\": \"This is a pre-release test build - use at your own risk - do not use for mining or merchant applications\"\r\n}\r\n```\r\n",
      "user": {
        "login": "D33r-Gee",
        "id": 111142327,
        "node_id": "U_kgDOBp_ltw",
        "avatar_url": "https://avatars.githubusercontent.com/u/111142327?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/D33r-Gee",
        "html_url": "https://github.com/D33r-Gee",
        "followers_url": "https://api.github.com/users/D33r-Gee/followers",
        "following_url": "https://api.github.com/users/D33r-Gee/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/D33r-Gee/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/D33r-Gee/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/D33r-Gee/subscriptions",
        "organizations_url": "https://api.github.com/users/D33r-Gee/orgs",
        "repos_url": "https://api.github.com/users/D33r-Gee/repos",
        "events_url": "https://api.github.com/users/D33r-Gee/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/D33r-Gee/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1516971308",
      "submitted_at": "2023-07-06T17:04:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1659794915,
      "node_id": "IC_kwDOABII585i7nXj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1659794915",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T08:11:49Z",
      "updated_at": "2023-08-01T08:11:57Z",
      "author_association": "MEMBER",
      "body": "With #24008 landed this would a great time for a rebase (I briefly tried but it's non-trivial).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1659794915",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "commented",
      "id": 1660856546,
      "node_id": "IC_kwDOABII585i_qji",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1660856546",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-01T18:21:12Z",
      "updated_at": "2023-08-01T18:21:12Z",
      "author_association": "MEMBER",
      "body": "In the process of rebasing now.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1660856546",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10027491249,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJVr1-x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10027491249",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T18:24:21Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10027556076,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJVsFzs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10027556076",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T18:31:33Z"
    },
    {
      "event": "unlabeled",
      "id": 10027619632,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJVsVUw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10027619632",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T18:39:37Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1668468059,
      "node_id": "IC_kwDOABII585jcs1b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1668468059",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T19:36:21Z",
      "updated_at": "2023-08-07T19:36:21Z",
      "author_association": "MEMBER",
      "body": "Rebased [`au.027`](https://github.com/jamesob/bitcoin/tree/au.027) -> [`au.029`](https://github.com/jamesob/bitcoin/tree/au.029)\r\n\r\nThe merge of #27607 really made that difficult.\r\n\r\nThis rebase fixes merge conflicts as well as incorporates @sdaftuar's changes from #27746. His net changes are in the first commit here.\r\n\r\nI'm very tired of this project and hope we can focus effort on getting this changeset reviewed and merged to be done with the development of this feature.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1668468059",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 10028067085,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJVuCkN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10028067085",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T19:36:21Z"
    },
    {
      "event": "subscribed",
      "id": 10028067099,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJVuCkb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10028067099",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T19:36:21Z"
    },
    {
      "event": "labeled",
      "id": 10028580801,
      "node_id": "LE_lADOABII585lWq3pzwAAAAJVv__B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10028580801",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-07T20:45:04Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1669064576,
      "node_id": "IC_kwDOABII585je-eA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1669064576",
      "actor": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-08T07:29:12Z",
      "updated_at": "2023-08-08T07:29:12Z",
      "author_association": "MEMBER",
      "body": "(The next rebase should be trivial, only a one-line include conflict, I think)",
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1669064576",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10036540498,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJWOXRS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10036540498",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-08T14:45:23Z"
    },
    {
      "event": "unlabeled",
      "id": 10036983481,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJWQDa5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10036983481",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-08T15:22:16Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T02:25:04Z",
      "updated_at": "2023-08-09T02:25:04Z",
      "source": {
        "issue": {
          "id": 1837354188,
          "node_id": "PR_kwDOABII585XOtuA",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28218",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28218/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28218/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28218/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28218",
          "number": 28218,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Make IsInitialBlockDownload & NotifyHeaderTip not require a Chainstate",
          "body": "This change makes `IsInitialBlockDownload` and `NotifyHeaderTip` functions no longer tied to individual `Chainstate` objects. It makes them work with the `ChainstateManager` object instead so code is simpler and it is no longer possible to call them incorrectly with an inactive `Chainstate`.\r\n\r\nThis change also makes `m_cached_finished_ibd` caching easier to reason about, because now there is only one cached value instead of two (for background and snapshot chainstates) so the cached IBD state now no longer gets reset when a snapshot is loaded.\r\n\r\nThere should be no change in behavior because these functions were always called on the active `ChainState` objects.\r\n\r\nThese changes were discussed previously https://github.com/bitcoin/bitcoin/pull/27746#discussion_r1246868905 and https://github.com/bitcoin/bitcoin/pull/27746#discussion_r1237552792 as possible followups for that PR.",
          "user": {
            "login": "ryanofsky",
            "id": 7133040,
            "node_id": "MDQ6VXNlcjcxMzMwNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ryanofsky",
            "html_url": "https://github.com/ryanofsky",
            "followers_url": "https://api.github.com/users/ryanofsky/followers",
            "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
            "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
            "repos_url": "https://api.github.com/users/ryanofsky/repos",
            "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28218",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28218",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28218.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28218.patch"
          },
          "closed_at": "2023-08-21T09:55:55Z",
          "created_at": "2023-08-04T21:14:06Z",
          "updated_at": "2023-08-21T09:55:55Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T02:53:41Z",
      "updated_at": "2023-08-09T02:53:41Z",
      "source": {
        "issue": {
          "id": 1833553731,
          "node_id": "PR_kwDOABII585XB6sb",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28202",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28202/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28202/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28202/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28202",
          "number": 28202,
          "state": "open",
          "state_reason": null,
          "title": "Silent Payments: receiving",
          "body": "This PR is a child of https://github.com/bitcoin/bitcoin/pull/27827 and only implements the receiving logic. For the rest:\r\n\r\n* #28122 - implement the silent payments scheme\r\n* #28201 - implements sending\r\n* #27827 - all three PRs together - this PR is meant for tracking progress and is useful for reviewers who want to compile all three PRs at once for testing\r\n\r\nThis PR depends on #28122 and is marked as a draft until it is merged. Commits up to https://github.com/bitcoin/bitcoin/commit/8ee791e7b34a354ce6835b968fe12924b8908d7c belong to #28122; please review those commits on #28122\r\n\r\n## Receiving \r\n\r\n_Description coming soon_",
          "user": {
            "login": "josibake",
            "id": 7444140,
            "node_id": "MDQ6VXNlcjc0NDQxNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/josibake",
            "html_url": "https://github.com/josibake",
            "followers_url": "https://api.github.com/users/josibake/followers",
            "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
            "organizations_url": "https://api.github.com/users/josibake/orgs",
            "repos_url": "https://api.github.com/users/josibake/repos",
            "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/josibake/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 1,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28202",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28202",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28202.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28202.patch"
          },
          "created_at": "2023-08-02T16:42:41Z",
          "updated_at": "2023-09-13T19:25:13Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T02:58:54Z",
      "updated_at": "2023-08-09T02:58:54Z",
      "source": {
        "issue": {
          "id": 1833304785,
          "node_id": "PR_kwDOABII585XBDwg",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28200",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28200/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28200/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28200/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28200",
          "number": 28200,
          "state": "closed",
          "state_reason": null,
          "title": "refactor: Remove unused includes from wallet.cpp",
          "body": "This makes compilation of wallet.cpp use a few % less memory and time, locally.\r\n\r\nCreated in the context of https://github.com/bitcoin/bitcoin/issues/28109, but I don't think it is enough to actually fix this problem.",
          "user": {
            "login": "MarcoFalke",
            "id": 6399679,
            "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/MarcoFalke",
            "html_url": "https://github.com/MarcoFalke",
            "followers_url": "https://api.github.com/users/MarcoFalke/followers",
            "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
            "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
            "repos_url": "https://api.github.com/users/MarcoFalke/repos",
            "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 135961,
              "node_id": "MDU6TGFiZWwxMzU5NjE=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
              "name": "Refactoring",
              "color": "E6F6D6",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 18,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28200",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28200",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28200.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28200.patch"
          },
          "closed_at": "2023-08-22T09:34:19Z",
          "created_at": "2023-08-02T14:29:39Z",
          "updated_at": "2023-08-22T09:48:55Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T06:00:38Z",
      "updated_at": "2023-08-09T06:00:38Z",
      "source": {
        "issue": {
          "id": 1753345859,
          "node_id": "PR_kwDOABII585SzgaM",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27866",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27866/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27866/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27866/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27866",
          "number": 27866,
          "state": "open",
          "state_reason": null,
          "title": "blockstorage: Return on fatal flush errors",
          "body": "The goal of this PR is to establish that fatal blockstorage flush errors should be treated as errors at their call site.\r\n\r\nPrior to this patch `FlushBlockFile` may have failed without returning in `Chainstate::FlushStateToDisk`, leading to a potential write from `WriteBlockIndexDB` that may refer to a block that is not fully flushed to disk yet. By returning if either `FlushUndoFile` or `FlushBlockFile` fail, we ensure that no further write operations take place that may lead to an inconsistent database when crashing. Add `[[nodiscard]]` annotations to them such that they are not ignored in future.\r\n\r\nFunctions that call either `FlushUndoFile` or `FlushBlockFile`, need to handle these extra abort cases properly. Since `Chainstate::FlushStateToDisk` already produces an abort error in case of `WriteBlockIndexDB` failing, no extra logic for functions calling `Chainstate::FlushStateToDisk` is required.\r\n\r\nBesides `Chainstate::FlushStateToDisk`, `FlushBlockFile` is also called by `FindBlockPos`, while `FlushUndoFile` is only called by `FlushBlockFile` and `WriteUndoDataForBlock`. For both these cases, the flush error is not further bubbled up. Instead, the error is logged and a comment is provided why bubbling up an error would be less desirable in these cases.\r\n\r\n---\r\n\r\nThis pull request is part of a larger effort towards improving the shutdown / abort / fatal error handling in validation code. It is a first step towards implementing proper fatal error return type enforcement similar as proposed by theuni in this pull request [comment](https://github.com/bitcoin/bitcoin/pull/27711#issuecomment-1563561502). For ease of review of these critical changes, a first step would be checking that `AbortNode` leads to early and error-conveying returns at its call site. Further work for enforcing returns when `AbortNode` is called is done in https://github.com/bitcoin/bitcoin/pull/27862.",
          "user": {
            "login": "TheCharlatan",
            "id": 8421793,
            "node_id": "MDQ6VXNlcjg0MjE3OTM=",
            "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/TheCharlatan",
            "html_url": "https://github.com/TheCharlatan",
            "followers_url": "https://api.github.com/users/TheCharlatan/followers",
            "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
            "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
            "repos_url": "https://api.github.com/users/TheCharlatan/repos",
            "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 118379652,
              "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
              "name": "Validation",
              "color": "6060aa",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 13,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27866",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27866",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27866.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27866.patch"
          },
          "created_at": "2023-06-12T18:43:00Z",
          "updated_at": "2023-09-11T15:59:53Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T06:19:31Z",
      "updated_at": "2023-08-09T06:19:31Z",
      "source": {
        "issue": {
          "id": 1741647494,
          "node_id": "PR_kwDOABII585SMBHD",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27827",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27827/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27827/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27827/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27827",
          "number": 27827,
          "state": "open",
          "state_reason": null,
          "title": "Silent Payments: send and receive",
          "body": "## For reviewers\r\n\r\nIn an attempt to make reviewing a bit more sane, I'm breaking this up into a few smaller PRs, but will keep this one open as the parent PR and keep it rebased on the child PRs. The main purpose of having this PR is to track progress on child PRs and also have an easy way to compile `bitcoind` with both send and receive support for testing. Additionally, I'll be adding more functional tests to this PR since it's much easier to test when `bitcoind` can both send and receive.\r\n\r\n## PRs\r\n\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/28122\r\n  - Implements the logic from BIP352 without any wallet code. This PR adds the necessary cryptographic functions and implements the logic needed for sending and scanning. This PR also includes the test vectors from the BIP as unit tests. Both the send and receive PRs have this as a dependency. In terms of priority, this PR should be reviewed first\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/28201\r\n  - Implements sending in the Bitcoin Core wallet. This PR allows a wallet to send to a silent payment address, regardless of whether or not the wallet can receive silent payments\r\n  - Ready for review, but marked as a draft until dependencies are merged\r\n- [ ] https://github.com/bitcoin/bitcoin/pull/28202\r\n  - Implements receiving in the Bitcoin Core wallet. This PR allows a wallet to generate silent payment addresses and scan for silent payments, regardless of whether or not the wallet can send to a silent payment address\r\n  - Ready for review but marked as a draft until dependencies are merged\r\n\r\nFor the silent payments specification, see https://github.com/bitcoin/bips/pull/1458\r\n\r\n## Overall\r\n\r\nThis PR implements the full silent payments scheme: sending and receiving. The following items are not covered in this PR and are intended for follow-up PRs:\r\n\r\n* Adding labels for the receiver wallet\r\n* Full RPC coverage (only `sendtoaddress` and `sendmany` are covered in this PR)\r\n* Light client support (vending the tweak data per block, either in an index or to serve to indexer, such as electrum server)\r\n* Add benchmarks to validate that there are no DoS concerns for doing silent payment verification for transactions in the mempool\r\n* External signer support (dependent on hardware wallets supporting silent payments)\r\n* More unit / functional test coverage\r\n\r\n## Major changes\r\n\r\nThis PR is a continuation of the work done in https://github.com/bitcoin/bitcoin/pull/24897. Below is a summary of the major changes:\r\n\r\n* Remove labels\r\n  * The original draft included labels, but this has been deferred for a later PR. Labels are not necessary for sending and receiving and there are still some open questions on how best to implement them in Bitcoin Core. Labels can also be added at any point by the receiver without requiring any changes from the sender\r\n* Remove indexes\r\n  * In the original draft, indexes were used when scanning for silent payments and when doing wallet rescans. This has been removed in favor of using `rev*.dat` files for rescanning. It may make sense to add an index in the future, but for the purpose of vending tweak data to light clients, which is still an open question\r\n* Update to implement the most current version of BIP352\r\n  * Since the original draft, there have been a few changes in the BIP which are reflected in the current PR. Most notably, using 33-byte compressed keys for the silent payment address (as opposed to X-only keys in the original draft) \r\n\r\nIt may be helpful for context to read through the discussions on #24897 , but ongoing review should happen in the relevant child PRs listed above.",
          "user": {
            "login": "josibake",
            "id": 7444140,
            "node_id": "MDQ6VXNlcjc0NDQxNDA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/josibake",
            "html_url": "https://github.com/josibake",
            "followers_url": "https://api.github.com/users/josibake/followers",
            "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
            "organizations_url": "https://api.github.com/users/josibake/orgs",
            "repos_url": "https://api.github.com/users/josibake/repos",
            "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/josibake/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 5,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27827",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27827",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27827.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27827.patch"
          },
          "created_at": "2023-06-05T12:12:23Z",
          "updated_at": "2023-09-13T19:56:27Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-09T13:42:27Z",
      "updated_at": "2023-08-09T13:42:27Z",
      "source": {
        "issue": {
          "id": 777385114,
          "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ3Njk5OTI3",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20827",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20827/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20827/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/20827/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/20827",
          "number": 20827,
          "state": "open",
          "state_reason": null,
          "title": "During IBD, prune as much as possible until we get close to where we will eventually keep blocks",
          "body": "This should reduce pruning flushes even more, speeding up IBD with pruning on systems that have a sufficient dbcache.\r\n\r\nAssumes 1 MB per block between tip and best header chain. Simply adds this to the buffer pruning is trying to leave available, which results in pruning almost everything up until we get close to where we need to be keeping blocks.",
          "user": {
            "login": "luke-jr",
            "id": 1095675,
            "node_id": "MDQ6VXNlcjEwOTU2NzU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/luke-jr",
            "html_url": "https://github.com/luke-jr",
            "followers_url": "https://api.github.com/users/luke-jr/followers",
            "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
            "organizations_url": "https://api.github.com/users/luke-jr/orgs",
            "repos_url": "https://api.github.com/users/luke-jr/repos",
            "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/luke-jr/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 219890555,
              "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
              "name": "Block storage",
              "color": "000000",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 27,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/20827",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/20827",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/20827.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/20827.patch"
          },
          "created_at": "2021-01-02T01:49:09Z",
          "updated_at": "2023-08-21T11:28:32Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1572046251,
      "node_id": "PRR_kwDOABII585ds4Wr",
      "url": null,
      "actor": null,
      "commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "The net processing changes look much better (no chainstate pointers on CNodeState, yay!).",
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1572046251",
      "submitted_at": "2023-08-10T14:54:18Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1477561344,
      "node_id": "PRR_kwDOABII585YEcwA",
      "url": null,
      "actor": null,
      "commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Leaving some initial comments and will do some manual testing next.\r\n\r\n@jamesob there are several todo comments in the code that sound like you were planning to address them before merge. Are you still planning to address those? Otherwise, could you update the comments so that we know what your plan is for those changes?",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1477561344",
      "submitted_at": "2023-08-11T22:00:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1677134971,
      "node_id": "IC_kwDOABII585j9wx7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1677134971",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-14T11:17:09Z",
      "updated_at": "2023-08-16T09:05:30Z",
      "author_association": "MEMBER",
      "body": "Test failure for a66790c662d6516b9fec9ca2cc97e410a72fe899 on Ubuntu 23.04 (gcc 12.3.0) \r\n\r\n```\r\n$ src/test/test_bitcoin --run_test=validation_chainstatemanager_tests\r\nRunning 7 test cases...\r\nnode/blockstorage.cpp:307 LoadBlockIndex: Assertion `GetParams().AssumeutxoForBlockhash(*snapshot_blockhash)' failed.\r\nunknown location(0): fatal error: in \"validation_chainstatemanager_tests/chainstatemanager_loadblockindex\": signal: SIGABRT (application abort requested)\r\ntest/validation_chainstatemanager_tests.cpp(441): last checkpoint\r\ntest_bitcoin: common/args.cpp:577: void ArgsManager::AddArg(const std::string&, const std::string&, unsigned int, const OptionsCategory&): Assertion `ret.second' failed.\r\nunknown location(0): fatal error: in \"validation_chainstatemanager_tests/chainstatemanager_snapshot_init\": signal: SIGABRT (application abort requested)\r\ntest/validation_chainstatemanager_tests.cpp(508): last checkpoint: \"chainstatemanager_snapshot_init\" fixture ctor\r\ntest_bitcoin: common/args.cpp:577: void ArgsManager::AddArg(const std::string&, const std::string&, unsigned int, const OptionsCategory&): Assertion `ret.second' failed.\r\nunknown location(0): fatal error: in \"validation_chainstatemanager_tests/chainstatemanager_snapshot_completion\": signal: SIGABRT (application abort requested)\r\ntest/validation_chainstatemanager_tests.cpp(577): last checkpoint: \"chainstatemanager_snapshot_completion\" fixture ctor\r\ntest_bitcoin: common/args.cpp:577: void ArgsManager::AddArg(const std::string&, const std::string&, unsigned int, const OptionsCategory&): Assertion `ret.second' failed.\r\nunknown location(0): fatal error: in \"validation_chainstatemanager_tests/chainstatemanager_snapshot_completion_hash_mismatch\": signal: SIGABRT (application abort requested)\r\ntest/validation_chainstatemanager_tests.cpp(660): last checkpoint: \"chainstatemanager_snapshot_completion_hash_mismatch\" fixture ctor\r\n```\r\n\r\nIt's happy again the next commit fe735572d05b95569e9c82fa1b1767c7da23b423.\r\n\r\n\r\nâ€”\r\nHere's a torrent for 800,000: `magnet:?xt=urn:btih:50ee955bef37f5ec3e5b0df4cf0288af3d715a2e&dn=utxo-800000.dat&tr=udp%3A%2F%2Ftracker.bitcoin.sprovoost.nl%3A6969`\r\n\r\nYou'll need this:\r\n\r\n```json\r\n{\r\n  \"coins_written\": 111535121,\r\n  \"base_hash\": \"00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054\",\r\n  \"base_height\": 800000,\r\n  \"txoutset_hash\": \"7d69b87512db3d13b9758ea32b93ce468d18cf7456fb5d250c9e1bed9339e4d2\",\r\n  \"nchaintx\": 868965226\r\n}\r\n```\r\n\r\nI'll try a sync with this shortly. _Update_: ran successful IBD on Intel macOS and on Ubuntu 23. With the latter I first had it sync until 2013 so the dbcache would be 1 GB, before loading the snapshot. \r\n\r\nâ€”\r\n\r\nOn macOS the shutdown (a day) after completing background sync seems gets stuck:\r\n\r\n```\r\n023-08-16T07:48:43Z [msghand] [net] Saw new cmpctblock header hash=0000000000000000000229118fcb007fc035045c3a3394233116aa25d496129e peer=398\r\n2023-08-16T07:48:44Z [msghand] UpdateTip: new best=0000000000000000000229118fcb007fc035045c3a3394233116aa25d496129e height=803421 version=0x20000000 log2_work=94.362393 tx=879900343 date='2023-08-16T07:48:37Z' progress=1.000000 cache=114.9MiB(924996txo)\r\n2023-08-16T07:49:00Z [msghand] New outbound peer connected: version: 70016, blocks=803421, peer=491 (block-relay-only)\r\n^C2023-08-16T07:50:33Z [addcon] addcon thread exit\r\n2023-08-16T07:50:33Z [opencon] opencon thread exit\r\n2023-08-16T07:50:33Z [init] Shutdown: In progress...\r\n2023-08-16T07:50:33Z [net] net thread exit\r\n2023-08-16T07:50:33Z [msghand] msghand thread exit\r\n2023-08-16T07:55:12Z [scheduler] Flushed fee estimates to fee_estimates.dat.\r\n2023-08-16T08:23:36Z [scheduler] Potential stale tip detected, will try using extra outbound peer (last tip update: 2092 seconds ago)\r\n```\r\n\r\nI didn't run with useful debug flags unfortunately. It was a pruned node. Despite `kill -9` it was able to restart in good shape though:\r\n\r\n```\r\n2023-08-16T09:03:57Z [init] [snapshot] cleaning up unneeded background chainstate, then reinitializing\r\n```",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1677134971",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-15T06:12:11Z",
      "updated_at": "2023-08-15T06:12:11Z",
      "source": {
        "issue": {
          "id": 1789806361,
          "node_id": "PR_kwDOABII585Ut7YI",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28031",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28031/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28031/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28031/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28031",
          "number": 28031,
          "state": "open",
          "state_reason": null,
          "title": "Package Relay 1/3: Introduce TxPackageTracker as Orphan Resolution Module",
          "body": "Depends on #28199, please review that first.\r\n\r\nThis is milestone 1 of package relay p2p changes. See #27463 for full project tracking.\r\n\r\nPlease see #27742 for how this PR fits into the big picture. I strongly suggest that reviewers look at that PR first to decide if they are comfortable with the overall approach.\r\n\r\nThis PR is mainly refactors, with a few behavior changes and improvements:\r\n- Introduces `TxDownloadManager`, which handles all transaction downloading. It contains the `TxRequestTracker`, `TxOrphanage`, and filters for `AlreadyHaveTx`.\r\n- Updates logs for tx {validation, relay, orphans} to include both txid and wtxid when possible.\r\n- Adds a new log category, `TXPACKAGES`. Logging in the orphanage is changed from `MEMPOOL` to `TXPACKAGES`.\r\n- Adds support for tracking when multiple peers provided the same tx in the orphanage.\r\n- Makes `TxDownloadManager` responsible for tracking the orphans we need to resolve and deciding how/when to resolve them.\r\n- Adds all announcers of an orphan as potential resolution candidates. This tracker is a `TxDownloadManager` which helps us schedule requests.\r\n   - In this PR, \"orphan resolution\" means requesting missing parents by `getdata(MSG_TX | MSG_WITNESS_FLAG, missing_txid)`.\r\n    - In a future PR, we'll add another resolution method, requesting ancestor wtxids using `getdata(MSG_ANCPKGINFO, orphan_wtxid)`.",
          "user": {
            "login": "glozow",
            "id": 25183001,
            "node_id": "MDQ6VXNlcjI1MTgzMDAx",
            "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/glozow",
            "html_url": "https://github.com/glozow",
            "followers_url": "https://api.github.com/users/glozow/followers",
            "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
            "organizations_url": "https://api.github.com/users/glozow/orgs",
            "repos_url": "https://api.github.com/users/glozow/repos",
            "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/glozow/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28031",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28031",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28031.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28031.patch"
          },
          "created_at": "2023-07-05T15:30:40Z",
          "updated_at": "2023-09-13T14:35:49Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1578539655,
      "node_id": "PRR_kwDOABII585eFpqH",
      "url": null,
      "actor": null,
      "commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Started review (will update list below with progress).\r\n- [X] 6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b First draft of background sync logic (1/23)\r\n- [x] a62ed3267d69ae8f4e9edf68f4a0f5348fdefe2d bugfix: correct is_snapshot_cs in VerifyDB (2/23)\r\n- [x] 3b9d3d63d9ccb609ec08da34776f7c5f29d21a20 assumeutxo: disallow -reindex when background syncing (3/23)\r\n- [x] cdb73e44b7f0d4ea186ba657ddf7809434f0a12a chainparams: add blockhash to AssumeutxoData (4/23)\r\n- [x] 5ea9abfbac3543f2d2cef90a1528abed35623822 validation: MaybeRebalanceCaches when chain leaves IBD (5/23)\r\n- [x] d9afcd70910f30fe9c99afa4dbbcdd7ccaf29d6e validation: add ChainstateRole (6/23)\r\n- [x] 2856710077abbc8f07a97adfff5f6829358155be validation: pass ChainstateRole for validationinterface calls (7/23)\r\n- [ ] f2a15428277090d6ad387de6d517303b9bc4e2af validationinterface: only send zmq notifications for active (8/23)\r\n- [ ] 550ac6248d1a596207c357181edbec79236d576d wallet: validationinterface: only handle active chain notifications (9/23)\r\n- [ ] ddbd0639e0af4a56cd5f647e11e0d38f06d20a68 net_processing: validationinterface: ignore some events for bg chain (10/23)\r\n- [ ] c177b8f442892a9b865b0b771f0a4823f797322d index: cache indexer references on ChainstateManager (11/23)\r\n- [ ] f64eeaeeb83d1c21f2d9e65c630eee2a1a5d48ba validation: indexing changes for assumeutxo (12/23)\r\n- [ ] 9e2b8ef836aeb1dc2e4b57449fc56badebea6772 validation: pruning for multiple chainstates (13/23)\r\n- [ ] a66790c662d6516b9fec9ca2cc97e410a72fe899 validation: populate nChainTx value for assumedvalid chainstates (14/23)\r\n- [ ] fe735572d05b95569e9c82fa1b1767c7da23b423 blockstorage: segment normal/assumedvalid blockfiles (15/23)\r\n- [ ] d342085067306231a2a454c39d276495dbd13cd3 validation: assumeutxo: swap m_mempool on snapshot activation (16/23)\r\n- [ ] 8ac7427b41fdec1dbc7e06d0aa2c0e469b879ba2 rpc: add loadtxoutset (17/23)\r\n- [ ] bc3042436e4e4a84328a2e56ca021a617d37c27a rpc: add getchainstates (18/23)\r\n- [ ] 24497a881ebf699b92c01342a24f1c4b35b79590 test: add feature_assumeutxo functional test (19/23)\r\n- [ ] c5ce27802be60d81f909a8f0f6a3827f956d88e3 contrib: add script to demo/test assumeutxo (20/23)\r\n- [ ] 9e46cf539533076d6206964e8d74e504030fc4a5 doc: update release-process.md for assumeutxo (21/23)\r\n- [ ] 9e62b849852bfea64eda18f51137a4a53e80f8c0 chainparams: add assumeutxo param at height 788_000 (22/23)\r\n- [ ] 253bcd5fd392f70de82ec7c675f9777d1e098d50 assumeutxo: swap mempool on existing activation (23/23)\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1578539655",
      "submitted_at": "2023-08-15T16:49:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1579020103,
      "node_id": "PRR_kwDOABII585eHe9H",
      "url": null,
      "actor": null,
      "commit_id": "6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1579020103",
      "submitted_at": "2023-08-15T16:58:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-16T08:27:04Z",
      "updated_at": "2023-08-16T08:27:04Z",
      "source": {
        "issue": {
          "id": 1844923348,
          "node_id": "I_kwDOABII585t90vU",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28249",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28249/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28249/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28249/events",
          "html_url": "https://github.com/bitcoin/bitcoin/issues/28249",
          "number": 28249,
          "state": "open",
          "state_reason": null,
          "title": "Raise maximum -dbcache setting",
          "body": "### Please describe the feature you'd like to see added.\n\n`nMaxDbCache` was set to 16 GB back in 2015:  https://github.com/bitcoin/bitcoin/commit/b3ed4236beb7f68e1720ceb3da15e0c3682ef629#diff-d102b6032635ce90158c1e6e614f03b50e4449aa46ce23370da5387a658342fd\r\n\r\nThe UTXO set has been growing significantly over the past few months so we should probably raise it.\n\n### Is your feature related to a problem, if so please describe it.\n\nDoing IBD without flushing dbcache is faster. That said, I'm not sure how much one single flush matters.\n\n### Describe the solution you'd like\n\nMake `nMaxDbCache` bigger.\n\n### Describe any alternatives you've considered\n\n_No response_\n\n### Please leave any additional context\n\nMuch growth recently:\r\nhttps://statoshi.info/d/000000009/unspent-transaction-output-set?orgId=1&from=now%2Fy&to=now&refresh=5s&viewPanel=8",
          "user": {
            "login": "Sjors",
            "id": 10217,
            "node_id": "MDQ6VXNlcjEwMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Sjors",
            "html_url": "https://github.com/Sjors",
            "followers_url": "https://api.github.com/users/Sjors/followers",
            "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
            "organizations_url": "https://api.github.com/users/Sjors/orgs",
            "repos_url": "https://api.github.com/users/Sjors/repos",
            "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/Sjors/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 64583,
              "node_id": "MDU6TGFiZWw2NDU4Mw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
              "name": "Feature",
              "color": "7cf575",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 8,
          "created_at": "2023-08-10T10:43:08Z",
          "updated_at": "2023-08-28T16:05:23Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1580896920,
      "node_id": "PRR_kwDOABII585eOpKY",
      "url": null,
      "actor": null,
      "commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1580896920",
      "submitted_at": "2023-08-16T18:01:37Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "labeled",
      "id": 10144184531,
      "node_id": "LE_lADOABII585lWq3pzwAAAAJco_jT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10144184531",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-21T11:18:32Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1592088142,
      "node_id": "PRR_kwDOABII585e5VZO",
      "url": null,
      "actor": null,
      "commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1592088142",
      "submitted_at": "2023-08-23T21:25:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10186066436,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJfIwoE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186066436",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:10:31Z"
    },
    {
      "event": "commented",
      "id": 1692415097,
      "node_id": "IC_kwDOABII585k4DR5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1692415097",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:03Z",
      "updated_at": "2023-08-24T21:11:03Z",
      "author_association": "MEMBER",
      "body": "Rebased, but only part of the way addressing all feedback so far.\r\n\r\n- Took @ryanofsky's net_processing cleanup commit\r\n- Better error handling in loadtxoutset (@theStack)\r\n- Cleaned up unnecessary chainstate roles (@dergoegge, @ryanofsky)\r\n  - Refactoring and behavior changes are now separate commits\r\n",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1692415097",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 10186070226,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfIxjS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070226",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "subscribed",
      "id": 10186070239,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfIxjf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070239",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "mentioned",
      "id": 10186070255,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfIxjv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070255",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "subscribed",
      "id": 10186070272,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfIxkA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070272",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "mentioned",
      "id": 10186070288,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfIxkQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070288",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "subscribed",
      "id": 10186070295,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfIxkX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186070295",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:11:04Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T21:37:16Z",
      "updated_at": "2023-08-24T21:37:16Z",
      "source": {
        "issue": {
          "id": 1862112513,
          "node_id": "PR_kwDOABII585YiJtd",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28327",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28327/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28327/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28327/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28327",
          "number": 28327,
          "state": "closed",
          "state_reason": null,
          "title": "RFC: remove clientversion.h usage from kernel",
          "body": "RFC because this is rather hackish and I'd like to know if anyone has a better idea.\r\n\r\nI'm working on trimming out headers that libbitcoinkernel should not export. To be clear: the problem is not what headers libbitcoinkernel itself uses, but what headers it requires users to use. Basically.. the headers used directly and indirectly by `bitcoin-chainstate.cpp`.\r\n\r\nTopping the list of headers we definitely don't want to require for users are `bitcoin-config.h` and `clientversion.h`. The former is somewhat complicated, but `clientversion.h` only comes from one place: `dbwrapper.h`.\r\n\r\nThis PR gets rid of that include by creating a new constructor that sets the version in the cpp file, working around the problem.\r\n\r\nAnother potential solution would be to create a `MakeClientVersionCDataStream()` function which just creates a stream and sets the version, and relies on the caller to do the rest.\r\n\r\nAny better ideas? Otherwise I'll undraft and ask for review.",
          "user": {
            "login": "theuni",
            "id": 417043,
            "node_id": "MDQ6VXNlcjQxNzA0Mw==",
            "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/theuni",
            "html_url": "https://github.com/theuni",
            "followers_url": "https://api.github.com/users/theuni/followers",
            "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
            "organizations_url": "https://api.github.com/users/theuni/orgs",
            "repos_url": "https://api.github.com/users/theuni/repos",
            "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/theuni/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 11,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28327",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28327",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28327.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28327.patch"
          },
          "closed_at": "2023-09-07T12:48:56Z",
          "created_at": "2023-08-22T19:57:54Z",
          "updated_at": "2023-09-07T12:48:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T22:24:45Z",
      "updated_at": "2023-08-24T22:24:45Z",
      "source": {
        "issue": {
          "id": 1815856452,
          "node_id": "PR_kwDOABII585WGd4K",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28120/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28120",
          "number": 28120,
          "state": "open",
          "state_reason": null,
          "title": "p2p: make block download logic aware of limited peers threshold",
          "body": "Even when the node believes it has IBD completed, need to avoid\r\nrequesting historical blocks from network-limited peers.\r\nOtherwise, the limited peer will disconnect right away.\r\n\r\nThe simplest scenario could be a node that gets synced, drops\r\nconnections, and stays inactive for a while. Then, once it re-connects\r\n(IBD stays completed), the node tries to fetch all the missing blocks\r\nfrom any peer, getting disconnected by the limited ones.\r\n\r\nNote:\r\nCan verify the behavior by cherry-picking the test commit alone on\r\nmaster. It will fail there.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28120",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28120",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28120.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28120.patch"
          },
          "created_at": "2023-07-21T13:55:22Z",
          "updated_at": "2023-08-24T22:24:45Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T22:47:41Z",
      "updated_at": "2023-08-24T22:47:41Z",
      "source": {
        "issue": {
          "id": 1746501636,
          "node_id": "PR_kwDOABII585ScjM9",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27837/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27837",
          "number": 27837,
          "state": "open",
          "state_reason": null,
          "title": "net: introduce block tracker to retry to download blocks after failure",
          "body": "Built on top of #28120 and #28170. Coming from #27652.\r\n\r\nThe general idea is to keep track of the user requested blocks so, in\r\ncase of a bad behaving peer or a network disconnection, they can be\r\nfetched from another one automatically without any further user interaction.\r\n\r\nThis was requested by users because the `getblockfrompeer` RPC command\r\nlacks the functionality to notify them about block request failures or peer\r\ndisconnections (which is expected due to the asynchronous nature of the block\r\nrequests).\r\n\r\nCurrently, this new functionality is limited to blocks requested by the\r\nuser via the 'getblockfrompeer' RPC command.\r\n\r\nIn the future, this class could expand its scope and be utilized in the\r\nregular chain synchronization process. Or, even could be employed in\r\nspecial procedures like a prune node rescan that uses BIP158 block filters,\r\nor even into BIP157 itself.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 98298007,
              "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
              "name": "P2P",
              "color": "006b75",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27837",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27837",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27837.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27837.patch"
          },
          "created_at": "2023-06-07T19:01:56Z",
          "updated_at": "2023-09-11T17:22:20Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "unlabeled",
      "id": 10186761761,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJfLaYh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10186761761",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-24T23:02:05Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 10187117666,
      "node_id": "LE_lADOABII585lWq3pzwAAAAJfMxRi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10187117666",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T00:23:44Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 10189279724,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJfVBHs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10189279724",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T06:36:59Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10195829831,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJfuARH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195829831",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:09:26Z"
    },
    {
      "event": "commented",
      "id": 1693764004,
      "node_id": "IC_kwDOABII585k9Mmk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1693764004",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z",
      "updated_at": "2023-08-25T18:20:35Z",
      "author_association": "MEMBER",
      "body": "Okay, the latest rebase is pushed, and I believe I've addressed all outstanding feedback (with the exception of two marginal comments from @ryanofsky relating to the first commit here, which perhaps I'll leave to @sdaftuar... unless he doesn't get back in some amount of time, in which case I'll take a look myself).\r\n\r\nI've iterated through all commits to ensure they build and pass the chainstate unittests. I've also fixed the intermediate-commit test failure that @Sjors discovered, which was based on not updating the unittest to use a \"recognized\" snapshot early enough. I've introduced a commit that fixes that sequencing.\r\n\r\nFor anyone curious, the tag updates here are [`au.029`](https://github.com/jamesob/bitcoin/tree/au.029) -> [`au.031`](https://github.com/jamesob/bitcoin/tree/au.031) ([GitHub range diff](https://github.com/jamesob/bitcoin/compare/au.029..au.031)) but the diff is kind of useless because of the rebase.\r\n\r\nMuch more useful is doing the range-diff locally yourself:\r\n```sh\r\ngit range-diff master jamesob/au.029 jamesob/au.031\r\n```\r\n\r\nThanks again for continued review and testing @ryanofsky @dergoegge @fjahr @Sjors @theStack @achow101 @D33r-Gee @ismaelsadeeq @alexanderwiederin @mzumsande @hazeycode and anyone else I forgot.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1693764004",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 10195921216,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWlA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921216",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "subscribed",
      "id": 10195921220,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWlE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921220",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "mentioned",
      "id": 10195921228,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWlM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921228",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "subscribed",
      "id": 10195921232,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWlQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921232",
      "actor": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "mentioned",
      "id": 10195921240,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWlY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921240",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "subscribed",
      "id": 10195921249,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWlh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921249",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:35Z"
    },
    {
      "event": "mentioned",
      "id": 10195921264,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWlw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921264",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "subscribed",
      "id": 10195921305,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWmZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921305",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "mentioned",
      "id": 10195921321,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWmp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921321",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "subscribed",
      "id": 10195921333,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWm1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921333",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "mentioned",
      "id": 10195921347,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWnD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921347",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "subscribed",
      "id": 10195921355,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWnL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921355",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "mentioned",
      "id": 10195921362,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWnS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921362",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "subscribed",
      "id": 10195921375,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWnf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921375",
      "actor": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:36Z"
    },
    {
      "event": "mentioned",
      "id": 10195921387,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWnr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921387",
      "actor": {
        "login": "hazeycode",
        "id": 22148308,
        "node_id": "MDQ6VXNlcjIyMTQ4MzA4",
        "avatar_url": "https://avatars.githubusercontent.com/u/22148308?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hazeycode",
        "html_url": "https://github.com/hazeycode",
        "followers_url": "https://api.github.com/users/hazeycode/followers",
        "following_url": "https://api.github.com/users/hazeycode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hazeycode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hazeycode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hazeycode/subscriptions",
        "organizations_url": "https://api.github.com/users/hazeycode/orgs",
        "repos_url": "https://api.github.com/users/hazeycode/repos",
        "events_url": "https://api.github.com/users/hazeycode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hazeycode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "subscribed",
      "id": 10195921407,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWn_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921407",
      "actor": {
        "login": "hazeycode",
        "id": 22148308,
        "node_id": "MDQ6VXNlcjIyMTQ4MzA4",
        "avatar_url": "https://avatars.githubusercontent.com/u/22148308?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hazeycode",
        "html_url": "https://github.com/hazeycode",
        "followers_url": "https://api.github.com/users/hazeycode/followers",
        "following_url": "https://api.github.com/users/hazeycode/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hazeycode/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hazeycode/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hazeycode/subscriptions",
        "organizations_url": "https://api.github.com/users/hazeycode/orgs",
        "repos_url": "https://api.github.com/users/hazeycode/repos",
        "events_url": "https://api.github.com/users/hazeycode/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hazeycode/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "mentioned",
      "id": 10195921424,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWoQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921424",
      "actor": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "subscribed",
      "id": 10195921430,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWoW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921430",
      "actor": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "mentioned",
      "id": 10195921440,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWog",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921440",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "subscribed",
      "id": 10195921449,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWop",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921449",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "mentioned",
      "id": 10195921460,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWo0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921460",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "subscribed",
      "id": 10195921469,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWo9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921469",
      "actor": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "mentioned",
      "id": 10195921486,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJfuWpO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921486",
      "actor": {
        "login": "D33r-Gee",
        "id": 111142327,
        "node_id": "U_kgDOBp_ltw",
        "avatar_url": "https://avatars.githubusercontent.com/u/111142327?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/D33r-Gee",
        "html_url": "https://github.com/D33r-Gee",
        "followers_url": "https://api.github.com/users/D33r-Gee/followers",
        "following_url": "https://api.github.com/users/D33r-Gee/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/D33r-Gee/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/D33r-Gee/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/D33r-Gee/subscriptions",
        "organizations_url": "https://api.github.com/users/D33r-Gee/orgs",
        "repos_url": "https://api.github.com/users/D33r-Gee/repos",
        "events_url": "https://api.github.com/users/D33r-Gee/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/D33r-Gee/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:37Z"
    },
    {
      "event": "subscribed",
      "id": 10195921495,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJfuWpX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10195921495",
      "actor": {
        "login": "D33r-Gee",
        "id": 111142327,
        "node_id": "U_kgDOBp_ltw",
        "avatar_url": "https://avatars.githubusercontent.com/u/111142327?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/D33r-Gee",
        "html_url": "https://github.com/D33r-Gee",
        "followers_url": "https://api.github.com/users/D33r-Gee/followers",
        "following_url": "https://api.github.com/users/D33r-Gee/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/D33r-Gee/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/D33r-Gee/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/D33r-Gee/subscriptions",
        "organizations_url": "https://api.github.com/users/D33r-Gee/orgs",
        "repos_url": "https://api.github.com/users/D33r-Gee/repos",
        "events_url": "https://api.github.com/users/D33r-Gee/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/D33r-Gee/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-25T18:20:38Z"
    },
    {
      "event": "reviewed",
      "id": 1595889617,
      "node_id": "PRR_kwDOABII585fH1fR",
      "url": null,
      "actor": null,
      "commit_id": "e44815e9a754c967415402b34807633625393084",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Oops - forgot these comments. :)",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1595889617",
      "submitted_at": "2023-08-25T18:21:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1694660622,
      "node_id": "IC_kwDOABII585lAngO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1694660622",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T12:50:27Z",
      "updated_at": "2023-08-27T12:50:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "Small update, I did a lot of manual testing on 157e510bc6deaaca43401f15f10105e44926ca68 while also monitoring stats like the size of the datadir etc. I mostly created my own snapshots on the current tip and then patched chainparams myself to be able to use them to push the limit a bit. It worked well and I didn't run into any issues aside from what I mention in #28350 which is not only an assumeutxo problem.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1694660622",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "reviewed",
      "id": 1599109755,
      "node_id": "PRR_kwDOABII585fUHp7",
      "url": null,
      "actor": null,
      "commit_id": "e44815e9a754c967415402b34807633625393084",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "This all looks very good and I feel like I got through the most complicated changes, but I'm still working through the rest. Most of my comments are not too important but I do think the indexing and pruning changes can be simplified a bit.\r\n\r\nProgress so far:\r\n\r\n- [X] 08a34e56ba7aa8714982d352238f1cb6eba43e29 net_processing: Request assumeutxo background chain blocks (1/24)\r\n- [X] 37af5f47541e77753d20bfbb7c105b55c0caf305 bugfix: correct is_snapshot_cs in VerifyDB (2/24)\r\n- [X] 1755c53365d53693213a721138a44bdd889d8794 assumeutxo: remove snapshot during -reindex{-chainstate} (3/24)\r\n- [X] 3d103bbf266bf3c8f66b3aff2237cc0a95f96a75 chainparams: add blockhash to AssumeutxoData (4/24)\r\n- [X] 3e7d3537fc06c8aff8a48edc8f179a70af46e04c validation: MaybeRebalanceCaches when chain leaves IBD (5/24)\r\n- [X] 95f45e38b5e47eaef56468909d04418b93e9c962 validation: add ChainstateRole (6/24)\r\n- [X] 9eda8224119450b8614837e0c8decfc81a6b9915 validation: only call UpdatedBlockTip for active chainstate (7/24)\r\n- [X] 2873d91ada1c240de280a35bbf169ed0c708e057 validation: pass ChainstateRole for validationinterface calls (8/24)\r\n- [X] b48729144fba1dbc64d603b2644a76c3f00d44eb validationinterface: only send zmq notifications for active (9/24)\r\n- [X] ba2f21a9ef88ce9631a2143f16569ee231953a91 wallet: validationinterface: only handle active chain notifications (10/24)\r\n- [X] 5d096add65e84530c907b5ee934af144067d5ef1 net_processing: validationinterface: ignore some events for bg chain (11/24)\r\n- [X] 688b68f34fe061c3064a516cdf77d4c155bfcafd index: cache indexer references on ChainstateManager (12/24)\r\n- [X] 5d01151b41b244dabeda54122400df17a3dfc4d2 validation: indexing changes for assumeutxo (13/24)\r\n- [X] b9ac4f7925e2d9dec67be06fdc2a381532581136 validation: pruning for multiple chainstates (14/24)\r\n- [ ] abaf61487bd5eb2c33ed62dae602b5f479f757f9 test: adjust chainstate tests to use recognized snapshot base (15/24)\r\n- [ ] a2a49ea7f1ed2931ab388bac677196dedc10714e validation: populate nChainTx value for assumedvalid chainstates (16/24)\r\n- [ ] 07517a2311c410dd107c4feb4e113bb7c629da8e blockstorage: segment normal/assumedvalid blockfiles (17/24)\r\n- [ ] 0e507021932f72aa7345bf84b805c7cda68eea65 validation: assumeutxo: swap m_mempool on snapshot activation (18/24)\r\n- [ ] 03de0d5ac9457b89e577a11e146cc394a8494b7b rpc: add loadtxoutset (19/24)\r\n- [ ] 05aba13ce27bbe7346ffb72a619638b6f84d3679 rpc: add getchainstates (20/24)\r\n- [ ] 60d6f6bbe91879d542439bec05ef406eb9954eb8 test: add feature_assumeutxo functional test (21/24)\r\n- [ ] 5394f2e9b7fea36d3cba43af82143f5c72c08ae5 contrib: add script to demo/test assumeutxo (22/24)\r\n- [ ] a3f96fbee900fdf23a160a461164a65a0c0cfe84 doc: update release-process.md for assumeutxo (23/24)\r\n- [ ] e44815e9a754c967415402b34807633625393084 chainparams: add assumeutxo param at height 788_000 (24/24)\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1599109755",
      "submitted_at": "2023-08-29T02:48:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1697226564,
      "node_id": "IC_kwDOABII585lKZ9E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697226564",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T11:02:19Z",
      "updated_at": "2023-08-29T11:02:19Z",
      "author_association": "MEMBER",
      "body": "Did code review at e44815e9a754c967415402b34807633625393084. Most of the @ryanofsky I think are worth addressing. Once these are addressed or resolved I will do my own clean path.\r\n\r\nI also spotted a couple of typos along the way.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1697226564",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 10219717209,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJhJIJZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10219717209",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T11:02:19Z"
    },
    {
      "event": "subscribed",
      "id": 10219717222,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJhJIJm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10219717222",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T11:02:19Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10226161306,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJhhtaa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10226161306",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T21:41:36Z"
    },
    {
      "event": "reviewed",
      "id": 1600882627,
      "node_id": "PRR_kwDOABII585fa4fD",
      "url": null,
      "actor": null,
      "commit_id": "1af901b60287f4130f2363cb68c962f437d9aefc",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Okay, all feedback addressed - some good simplifications there. Thanks for the comprehensive review, @ryanofsky @naumenkogs.\r\n\r\nYou can check the diff with\r\n```\r\ngit range-diff upstream/master jamesob/au.031 jamesob/au.033\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1600882627",
      "submitted_at": "2023-08-29T21:44:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "labeled",
      "id": 10226680499,
      "node_id": "LE_lADOABII585lWq3pzwAAAAJhjsKz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10226680499",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T23:02:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10232752456,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJh62lI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10232752456",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-30T12:54:24Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-30T13:01:33Z",
      "updated_at": "2023-08-30T13:01:33Z",
      "source": {
        "issue": {
          "id": 1873415502,
          "node_id": "PR_kwDOABII585ZIF0m",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28368",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28368/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28368/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28368/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28368",
          "number": 28368,
          "state": "open",
          "state_reason": null,
          "title": "Fee Estimator updates from Validation Interface/CScheduler thread",
          "body": "This is an attempt to  #11775 \r\n\r\nThis Pr will enable fee estimator to listen to ValidationInterface notifications to process new transactions added and removed from the mempool.\r\n\r\nThis PR includes the following changes:\r\n\r\n- Added a new callback to the Validation Interface `MempoolBlockConnect`, which notifies listeners about the transactions that have been removed due to a new block being connected, along with the height at which the transactions were removed.\r\n- Modified the `TransactionAddedToMempool` callback parameter to include additional information about the transaction needed for fee estimation.\r\n- Updated `CBlockPolicyEstimator` to process transactions using` CTransactionRef` instead of `CTxMempoolEntry.`\r\n- Implemented the `CValidationInterface` interface in `CBlockPolicyEstimater` and overridden the `TransactionAddedToMempool`, `TransactionRemovedFromMempool`, and `MempoolBlockConnect` methods to receive updates from their notifications.\r\n\r\nPrior to this PR, the fee estimator updates from the mempool, i.e whenever a new block is connected all transactions in the block that are in our mempool are going to be removed using the `removeForBlock` function in `txmempool.cpp`. \r\n\r\nThis removal triggered updates to the fee estimator. As a result, the fee estimator would block mempool's `cs` until it finished updating every time a new block was connected.\r\nInstead of being blocked only on mempool tx removal, we were blocking on both tx removal and fee estimator updating.\r\nIf we want to further improve fee estimation, or add heavy-calulation steps to it, it is currently not viable as we would be slowing down block relay in the process\r\n\r\nThis PR is smaller in terms of the changes made compared to #11775, as it focuses solely on enabling fee estimator updates from the validationInterface/cscheduler thread notifications.\r\n\r\nI have not split the validation interface because, as I understand it, the rationale behind the split in #11775 was to have `MempoolInterface` signals come from the mempool and `CValidationInterface` events come from validation. I believe this separation can be achieved in a separate refactoring PR when the need arises.\r\n\r\nAlso left out some commits from #11775\r\n- Some refactoring which are no longer needed.\r\n- Handle reorgs much better in fee estimator. \r\n- Track witness hash malleation in fee estimator \r\n\r\nI believe they are a separate change that can come in a follow-up after this.\r\n\r\n",
          "user": {
            "login": "ismaelsadeeq",
            "id": 48946461,
            "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ismaelsadeeq",
            "html_url": "https://github.com/ismaelsadeeq",
            "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
            "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
            "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
            "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
            "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 82428251,
              "node_id": "MDU6TGFiZWw4MjQyODI1MQ==",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/TX%20fees%20and%20policy",
              "name": "TX fees and policy",
              "color": "5319e7",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 8,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28368",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28368",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28368.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28368.patch"
          },
          "created_at": "2023-08-30T10:45:22Z",
          "updated_at": "2023-09-13T20:07:53Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1699307923,
      "node_id": "IC_kwDOABII585lSWGT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1699307923",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-30T14:36:06Z",
      "updated_at": "2023-08-30T14:36:06Z",
      "author_association": "MEMBER",
      "body": "Had to push a small commit to fix underflow in pruning calculations.\r\n```\r\ngit range-diff upstream/master jamesob/au.033 jamesob/au.034\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1699307923",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "unlabeled",
      "id": 10234309313,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJiAyrB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10234309313",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-30T15:06:00Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1602900172,
      "node_id": "PRR_kwDOABII585filDM",
      "url": null,
      "actor": null,
      "commit_id": "b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Got as far as the blockstorage commit this time and wrote a lot of feedback on it. There's a lot of small cleanups I suggested there, but I also suggested a different approach in https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311007889 that I think would simplify code, avoid the needing to add any ChainstateRole arguments to BlockManager methods, and avoid potentially mixing blocks from the background and snapshot chainstates into the last background block file. I think the current approach is ok if you want to keep it, but it does seems messier than it needs to be and not as reliable as it could be.\r\n\r\nProgress so far:\r\n\r\n- [X] 7b93d4adc976bdb32306951b21d7c98d9dacc972 net_processing: Request assumeutxo background chain blocks (1/23)\r\n- [X] b85530c18bfe24ff434f32f959d8dd843afca54d bugfix: correct is_snapshot_cs in VerifyDB (2/23)\r\n- [X] 8f6d6a49552c84a3a9112b39499685f018abfa40 assumeutxo: remove snapshot during -reindex{-chainstate} (3/23)\r\n- [X] 7a62705f421b998a812f0f018dbf8f1211d57535 chainparams: add blockhash to AssumeutxoData (4/23)\r\n- [X] 167f94d905ca1cc77cb613e89cea74275807fed5 validation: MaybeRebalanceCaches when chain leaves IBD (5/23)\r\n- [X] 288dd732b5c0085618598fe3dbba23ac6d194173 validation: add ChainstateRole (6/23)\r\n- [X] b06daa581f35a8e4736682929e356d560fa6a5da validation: only call UpdatedBlockTip for active chainstate (7/23)\r\n- [X] d3b533d3f1e80addca2ab0b3ee97215d5d03d984 validation: pass ChainstateRole for validationinterface calls (8/23)\r\n- [X] 1fda82e7192c25363d57ab203b5db8eac6088491 validationinterface: only send zmq notifications for active (9/23)\r\n- [X] 3e446ffd122e11b206692f6ac702df989884fbe7 wallet: validationinterface: only handle active chain notifications (10/23)\r\n- [X] fbd05a9eed1e40be0c4915e2aef98b3771d7af6c net_processing: validationinterface: ignore some events for bg chain (11/23)\r\n- [X] 0dd0cda274c244c466b27ee5f390d4cdd2e1e195 validation: indexing changes for assumeutxo (12/23)\r\n- [X] 5e4c824433fb4bf8b380d0f61a0aa424dc5456d4 validation: pruning for multiple chainstates (13/23)\r\n- [X] 76d616c957522e7be52eaf10b3ac33accaf75c45 test: adjust chainstate tests to use recognized snapshot base (14/23)\r\n- [X] 9df91113b8bbab8c98924bef61da388a8141b4e6 validation: populate nChainTx value for assumedvalid chainstates (15/23)\r\n- [X] 1c668b690eeb4b98899be7e0ff33373b79932f2a blockstorage: segment normal/assumedvalid blockfiles (16/23)\r\n- [ ] f2dd7a0c1b67d3e4a6e086a619eff34fe6625263 validation: assumeutxo: swap m_mempool on snapshot activation (17/23)\r\n- [ ] 82a8744f1384f07dc30aaa6339b0b8fb32dc3af0 rpc: add loadtxoutset (18/23)\r\n- [ ] 555206238129c6ed9fcbbc498c81455c7fe6d851 rpc: add getchainstates (19/23)\r\n- [ ] cc85742de115a1e9533459acc8707b58c397ab6a test: add feature_assumeutxo functional test (20/23)\r\n- [ ] 194eb1fba6c9237affc273e5c087e54502ee7598 contrib: add script to demo/test assumeutxo (21/23)\r\n- [ ] 36cece6c488bfb810282e352f282a92941443be1 doc: update release-process.md for assumeutxo (22/23)\r\n- [ ] b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed chainparams: add assumeutxo param at height 788_000 (23/23)\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1602900172",
      "submitted_at": "2023-08-31T02:20:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1604300972,
      "node_id": "PRR_kwDOABII585fn7Cs",
      "url": null,
      "actor": null,
      "commit_id": "b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Reviewd up to 5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1604300972",
      "submitted_at": "2023-08-31T09:53:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1604598585,
      "node_id": "PRR_kwDOABII585fpDs5",
      "url": null,
      "actor": null,
      "commit_id": "b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1604598585",
      "submitted_at": "2023-08-31T12:28:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE0MjUxMGJhOTY1NmFhZGEyNTBjNWZkZjQwMmUzOTE0YmE2ZjUxZGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a42510ba9656aada250c5fdf402e3914ba6f51db",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a42510ba9656aada250c5fdf402e3914ba6f51db",
      "tree": {
        "sha": "ec4c165f7a55772f2b236102b77eeb4a5b38b1b2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ec4c165f7a55772f2b236102b77eeb4a5b38b1b2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1fa6411dde3a6c4c4a89d7aebfba03f114f12bb1",
          "sha": "1fa6411dde3a6c4c4a89d7aebfba03f114f12bb1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1fa6411dde3a6c4c4a89d7aebfba03f114f12bb1"
        }
      ],
      "message": "net_processing: Request assumeutxo background chain blocks\n\nAdd new PeerManagerImpl::TryDownloadingHistoricalBlocks method and use it to\nrequest background chain blocks in addition to blocks normally requested by\nFindNextBlocksToDownload.\n\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>\nCo-authored-by: James O'Beirne <james.obeirne@gmail.com>",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:08:51Z"
      },
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@chaincode.com",
        "date": "2023-05-04T18:08:37Z"
      },
      "sha": "a42510ba9656aada250c5fdf402e3914ba6f51db"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ1ZmJkMThlZGY4MTY3NzFjOGY5ZGMzZTg5YmQ4YzZjMmVkMjU4YWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab",
      "tree": {
        "sha": "8b5c4e15c2b460033ff9cc690014b998d01c2e81",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8b5c4e15c2b460033ff9cc690014b998d01c2e81"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a42510ba9656aada250c5fdf402e3914ba6f51db",
          "sha": "a42510ba9656aada250c5fdf402e3914ba6f51db",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a42510ba9656aada250c5fdf402e3914ba6f51db"
        }
      ],
      "message": "bugfix: correct is_snapshot_cs in VerifyDB",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:08:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-25T01:10:12Z"
      },
      "sha": "45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM0MDNiOGJkYzg5MzkzOGFhZmFmOTE0NmI2OTk1NjU5ODJhNWRiNTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3403b8bdc893938aafaf9146b699565982a5db59",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3403b8bdc893938aafaf9146b699565982a5db59",
      "tree": {
        "sha": "ee2338e41186e60e127ea6a00b7d1bc42de01f74",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee2338e41186e60e127ea6a00b7d1bc42de01f74"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab",
          "sha": "45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/45fbd18edf816771c8f9dc3e89bd8c6c2ed258ab"
        }
      ],
      "message": "assumeutxo: remove snapshot during -reindex{-chainstate}\n\nRemoving a snapshot chainstate from disk (and memory) is consistent with\nexisting reindex operations.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:08:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-03T19:39:51Z"
      },
      "sha": "3403b8bdc893938aafaf9146b699565982a5db59"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVjNDdjZTY2NjU5OTU4MGUzMjY2NGM3NGY3MjdmMDBhYmMwMWZhYjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c47ce666599580e32664c74f727f00abc01fab1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5c47ce666599580e32664c74f727f00abc01fab1",
      "tree": {
        "sha": "81a175880898e627f39d6c5f8613e7a367f4896d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/81a175880898e627f39d6c5f8613e7a367f4896d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3403b8bdc893938aafaf9146b699565982a5db59",
          "sha": "3403b8bdc893938aafaf9146b699565982a5db59",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3403b8bdc893938aafaf9146b699565982a5db59"
        }
      ],
      "message": "chainparams: add blockhash to AssumeutxoData\n\nThis allows us to reference assumeutxo configuration by blockhash as\nwell as height; this is helpful in future changes when we want to\nreference assumeutxo configurations before the block index is loaded.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:08:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-25T17:05:27Z"
      },
      "sha": "5c47ce666599580e32664c74f727f00abc01fab1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJhOTZiZGIzNmQwZjk4MDExNDg1ZjhjNmU1ZWZiMTJjYzg0ZWQxMjk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ba96bdb36d0f98011485f8c6e5efb12cc84ed129",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ba96bdb36d0f98011485f8c6e5efb12cc84ed129",
      "tree": {
        "sha": "389313f59db8ec1ab4d257c8128dcf428e220c3e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/389313f59db8ec1ab4d257c8128dcf428e220c3e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c47ce666599580e32664c74f727f00abc01fab1",
          "sha": "5c47ce666599580e32664c74f727f00abc01fab1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5c47ce666599580e32664c74f727f00abc01fab1"
        }
      ],
      "message": "validation: MaybeRebalanceCaches when chain leaves IBD\n\nCheck to see if we need to rebalance caches across chainstates when\na chain leaves IBD.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:08:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-01T21:39:28Z"
      },
      "sha": "ba96bdb36d0f98011485f8c6e5efb12cc84ed129"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcyMWYzZDM2N2EzMWQyYzdmY2ViNWFlMWFmMzhjYTAwMjhlNzk0Y2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/721f3d367a31d2c7fceb5ae1af38ca0028e794cf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/721f3d367a31d2c7fceb5ae1af38ca0028e794cf",
      "tree": {
        "sha": "9c2a99222658334206f0677d8a2c68022df19dd9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9c2a99222658334206f0677d8a2c68022df19dd9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ba96bdb36d0f98011485f8c6e5efb12cc84ed129",
          "sha": "ba96bdb36d0f98011485f8c6e5efb12cc84ed129",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ba96bdb36d0f98011485f8c6e5efb12cc84ed129"
        }
      ],
      "message": "validation: add ChainstateRole",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:11:16Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2022-11-10T17:03:39Z"
      },
      "sha": "721f3d367a31d2c7fceb5ae1af38ca0028e794cf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI1NzJkZjcwMTg3YmVkZTM3YWM5YWVhMmEwMmFjZDZmNGMxNjc5MTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2572df70187bede37ac9aea2a02acd6f4c167916",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2572df70187bede37ac9aea2a02acd6f4c167916",
      "tree": {
        "sha": "69419ab1d103a4bb2150b9b1aab2125aa3b26995",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/69419ab1d103a4bb2150b9b1aab2125aa3b26995"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/721f3d367a31d2c7fceb5ae1af38ca0028e794cf",
          "sha": "721f3d367a31d2c7fceb5ae1af38ca0028e794cf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/721f3d367a31d2c7fceb5ae1af38ca0028e794cf"
        }
      ],
      "message": "validation: only call UpdatedBlockTip for active chainstate\n\nThis notification isn't needed for background chainstates.\n\n`kernel::Notifications::blockTip` are also skipped.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:11:18Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-24T20:51:16Z"
      },
      "sha": "2572df70187bede37ac9aea2a02acd6f4c167916"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVjMjRmOTRjNzgyZDQxNDlkZTYzNzI5NjViNzQxYTRkNjQ1OWU1OGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c24f94c782d4149de6372965b741a4d6459e58e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5c24f94c782d4149de6372965b741a4d6459e58e",
      "tree": {
        "sha": "feda1370452f424e12d7c2e91e04d073a9cb0ecb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/feda1370452f424e12d7c2e91e04d073a9cb0ecb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2572df70187bede37ac9aea2a02acd6f4c167916",
          "sha": "2572df70187bede37ac9aea2a02acd6f4c167916",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2572df70187bede37ac9aea2a02acd6f4c167916"
        }
      ],
      "message": "validation: pass ChainstateRole for validationinterface calls\n\nThis allows consumers to decide how to handle events from background or\nassumedvalid chainstates.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:25:37Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-09-23T17:54:21Z"
      },
      "sha": "5c24f94c782d4149de6372965b741a4d6459e58e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ2M2M1MDViYWZkMWMzN2U1YzQ1YmMzMTU5YmFlOWFmNDZkMjMzZmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d63c505bafd1c37e5c45bc3159bae9af46d233fa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d63c505bafd1c37e5c45bc3159bae9af46d233fa",
      "tree": {
        "sha": "6bd60ef8c06674dd74abee07a9933480b095cee5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6bd60ef8c06674dd74abee07a9933480b095cee5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c24f94c782d4149de6372965b741a4d6459e58e",
          "sha": "5c24f94c782d4149de6372965b741a4d6459e58e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5c24f94c782d4149de6372965b741a4d6459e58e"
        }
      ],
      "message": "validationinterface: only send zmq notifications for active",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:26:00Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2022-11-10T21:09:25Z"
      },
      "sha": "d63c505bafd1c37e5c45bc3159bae9af46d233fa"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYwNWI1MGViNzIwNWFjMmI1ZDVkYzhkMGRjMDhlMzQ1OTA1ZTk5ZDY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/605b50eb7205ac2b5d5dc8d0dc08e345905e99d6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/605b50eb7205ac2b5d5dc8d0dc08e345905e99d6",
      "tree": {
        "sha": "4f21eaa108990c3b9a616a9e52c9566949cd6f34",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4f21eaa108990c3b9a616a9e52c9566949cd6f34"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d63c505bafd1c37e5c45bc3159bae9af46d233fa",
          "sha": "d63c505bafd1c37e5c45bc3159bae9af46d233fa",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d63c505bafd1c37e5c45bc3159bae9af46d233fa"
        }
      ],
      "message": "wallet: validationinterface: only handle active chain notifications",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:26:00Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2022-11-10T21:09:41Z"
      },
      "sha": "605b50eb7205ac2b5d5dc8d0dc08e345905e99d6"
    },
    {
      "event": "reviewed",
      "id": 1605373711,
      "node_id": "PRR_kwDOABII585fsA8P",
      "url": null,
      "actor": null,
      "commit_id": "b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1605373711",
      "submitted_at": "2023-08-31T18:32:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFhYjA1ODI5Zjc1YzRmMDRhZWEyZWM0NGNiNjM3Yzc2NDhjMTk5Yjk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ab05829f75c4f04aea2ec44cb637c7648c199b9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1ab05829f75c4f04aea2ec44cb637c7648c199b9",
      "tree": {
        "sha": "45eb80fe747978822cde19c44747e9088437f3be",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/45eb80fe747978822cde19c44747e9088437f3be"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/605b50eb7205ac2b5d5dc8d0dc08e345905e99d6",
          "sha": "605b50eb7205ac2b5d5dc8d0dc08e345905e99d6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/605b50eb7205ac2b5d5dc8d0dc08e345905e99d6"
        }
      ],
      "message": "net_processing: validationinterface: ignore some events for bg chain",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:41:48Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2022-11-10T21:10:35Z"
      },
      "sha": "1ab05829f75c4f04aea2ec44cb637c7648c199b9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVhNGIwYjA5YTIxZDE2NDI5OTAzYjcxMTFjOTk4YTZmYzBiOTcwMWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a4b0b09a21d16429903b7111c998a6fc0b9701a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5a4b0b09a21d16429903b7111c998a6fc0b9701a",
      "tree": {
        "sha": "428b7b245eed994bfd6f9d795f168c509aa8ebd4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/428b7b245eed994bfd6f9d795f168c509aa8ebd4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1ab05829f75c4f04aea2ec44cb637c7648c199b9",
          "sha": "1ab05829f75c4f04aea2ec44cb637c7648c199b9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1ab05829f75c4f04aea2ec44cb637c7648c199b9"
        }
      ],
      "message": "validation: indexing changes for assumeutxo\n\nWhen using an assumedvalid chainstate, only process validationinterface\ncallbacks from the background chainstate within indexes. This ensures\nthat all indexes are built in-order.\n\nLater, we can possibly designate indexes which can be built out of order\nand continue their operation during snapshot use.\n\nOnce the background sync has completed, restart the indexes so that\nthey continue to index the now-validated snapshot chainstate.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-31T18:41:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-09-23T18:44:54Z"
      },
      "sha": "5a4b0b09a21d16429903b7111c998a6fc0b9701a"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10248661106,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJi3ihy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10248661106",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-31T18:43:27Z"
    },
    {
      "event": "reviewed",
      "id": 1604775714,
      "node_id": "PRR_kwDOABII585fpu8i",
      "url": null,
      "actor": null,
      "commit_id": "1b1d7110e67da11752ae1efadb1c12a9054eb867",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Yesterday's feedback addressed; thanks @ryanofsky @naumenkogs. The diff gets smaller.\r\n\r\n```\r\ngit range-diff upstream/master au.034 au.035\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1604775714",
      "submitted_at": "2023-08-31T18:44:43Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1607670738,
      "node_id": "PRR_kwDOABII585f0xvS",
      "url": null,
      "actor": null,
      "commit_id": "1b1d7110e67da11752ae1efadb1c12a9054eb867",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "bitcoinfinancier",
        "id": 134175231,
        "node_id": "U_kgDOB_9Z_w",
        "avatar_url": "https://avatars.githubusercontent.com/u/134175231?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoinfinancier",
        "html_url": "https://github.com/bitcoinfinancier",
        "followers_url": "https://api.github.com/users/bitcoinfinancier/followers",
        "following_url": "https://api.github.com/users/bitcoinfinancier/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoinfinancier/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoinfinancier/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoinfinancier/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoinfinancier/orgs",
        "repos_url": "https://api.github.com/users/bitcoinfinancier/repos",
        "events_url": "https://api.github.com/users/bitcoinfinancier/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoinfinancier/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1607670738",
      "submitted_at": "2023-09-01T21:11:18Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1608559074,
      "node_id": "PRR_kwDOABII585f4Kni",
      "url": null,
      "actor": null,
      "commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1608559074",
      "submitted_at": "2023-09-03T17:51:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1609034756,
      "node_id": "PRR_kwDOABII585f5-wE",
      "url": null,
      "actor": null,
      "commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1609034756",
      "submitted_at": "2023-09-04T08:33:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1609046035,
      "node_id": "PRR_kwDOABII585f6BgT",
      "url": null,
      "actor": null,
      "commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1609046035",
      "submitted_at": "2023-09-04T08:39:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "commented",
      "id": 1704925919,
      "node_id": "IC_kwDOABII585lnxrf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1704925919",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-04T09:27:45Z",
      "updated_at": "2023-09-04T09:27:45Z",
      "author_association": "MEMBER",
      "body": "Reviewed everything 1b1d7110e67da11752ae1efadb1c12a9054eb867.\r\nACK once some remaining comments are addressed.",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1704925919",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "btsea",
        "id": 49500661,
        "node_id": "MDQ6VXNlcjQ5NTAwNjYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/49500661?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/btsea",
        "html_url": "https://github.com/btsea",
        "followers_url": "https://api.github.com/users/btsea/followers",
        "following_url": "https://api.github.com/users/btsea/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/btsea/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/btsea/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/btsea/subscriptions",
        "organizations_url": "https://api.github.com/users/btsea/orgs",
        "repos_url": "https://api.github.com/users/btsea/repos",
        "events_url": "https://api.github.com/users/btsea/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/btsea/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-08T00:18:00Z",
      "updated_at": "2023-09-08T00:18:00Z",
      "source": {
        "issue": {
          "id": 1879199028,
          "node_id": "I_kwDOIb0R9c5wAk00",
          "url": "https://api.github.com/repos/TABConf/2023.tabconf.com/issues/189",
          "repository_url": "https://api.github.com/repos/TABConf/2023.tabconf.com",
          "labels_url": "https://api.github.com/repos/TABConf/2023.tabconf.com/issues/189/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/TABConf/2023.tabconf.com/issues/189/comments",
          "events_url": "https://api.github.com/repos/TABConf/2023.tabconf.com/issues/189/events",
          "html_url": "https://github.com/TABConf/2023.tabconf.com/issues/189",
          "number": 189,
          "state": "closed",
          "state_reason": "completed",
          "title": "Socratic Session: Bitcoin Core - Cherry Picked PRs and Project Updates",
          "body": "# Description\nA focused Socratic Seminar on Bitcoin protocol development. If you are curious about the latest updates in Bitcoin Core, this is the event for you. We'll be reviewing select pull requests as well as surveying some of the long-running development priorities within the project. \n\nBecause this is the first event of the Socratic Village, we will also spend a few minutes introducing the village at the start of the event. \n\n# Moderators\n- @btsea\n- @fjahr\n\n# Topics\n## Cherry-picked PRs\n- [Silent Payments: send and receive](https://github.com/bitcoin/bitcoin/pull/27827) \n- [Make provably unsignable standard P2PK and P2MS outpoints unspendable](https://github.com/bitcoin/bitcoin/pull/28400)\n- [p2p: Restrict self-advertisements with privacy networks to avoid fingerprinting](https://github.com/bitcoin/bitcoin/pull/27411)\n- [p2p: Diversify automatic outbound connections with respect to networks](https://github.com/bitcoin/bitcoin/pull/27213)\n- [(WIP) add a stratum v2 template provider](https://github.com/bitcoin/bitcoin/pull/27854)\n\n## Long-Running Projects\n- [AssumeUTXO](https://github.com/bitcoin/bitcoin/pull/27596)\n- [BIP324 - Encrypted P2P Transport](https://github.com/bitcoin/bitcoin/issues/27634)\n- [libsecp256k1 0.4.0](https://github.com/bitcoin-core/secp256k1/blob/master/CHANGELOG.md#040---2023-09-04)\n- [Libbitcoinkernel](https://github.com/bitcoin/bitcoin/issues/27587)\n\n# Panel Discussion Details\nSocratic Sessions are condensed versions of a Socratic-style meetup. A discussion leader will curate content based on a general theme and come prepared to give background on the material and provide discussion questions for the group.\n\n\n\n",
          "user": {
            "login": "btsea",
            "id": 49500661,
            "node_id": "MDQ6VXNlcjQ5NTAwNjYx",
            "avatar_url": "https://avatars.githubusercontent.com/u/49500661?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/btsea",
            "html_url": "https://github.com/btsea",
            "followers_url": "https://api.github.com/users/btsea/followers",
            "following_url": "https://api.github.com/users/btsea/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/btsea/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/btsea/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/btsea/subscriptions",
            "organizations_url": "https://api.github.com/users/btsea/orgs",
            "repos_url": "https://api.github.com/users/btsea/repos",
            "events_url": "https://api.github.com/users/btsea/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/btsea/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5077569365,
              "node_id": "LA_kwDOIb0R9c8AAAABLqWPVQ",
              "url": "https://api.github.com/repos/TABConf/2023.tabconf.com/labels/Panel",
              "name": "Panel",
              "description": "Panels during TABConf 2023",
              "color": "F3C53F",
              "default": false
            },
            {
              "id": 5648591830,
              "node_id": "LA_kwDOIb0R9c8AAAABUK6r1g",
              "url": "https://api.github.com/repos/TABConf/2023.tabconf.com/labels/Accepted",
              "name": "Accepted",
              "description": "Accepted",
              "color": "0E8A16",
              "default": false
            },
            {
              "id": 5855837911,
              "node_id": "LA_kwDOIb0R9c8AAAABXQj-1w",
              "url": "https://api.github.com/repos/TABConf/2023.tabconf.com/labels/ACK",
              "name": "ACK",
              "description": "",
              "color": "C2E0C6",
              "default": false
            }
          ],
          "assignee": {
            "login": "fjahr",
            "id": 1322187,
            "node_id": "MDQ6VXNlcjEzMjIxODc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/fjahr",
            "html_url": "https://github.com/fjahr",
            "followers_url": "https://api.github.com/users/fjahr/followers",
            "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
            "organizations_url": "https://api.github.com/users/fjahr/orgs",
            "repos_url": "https://api.github.com/users/fjahr/repos",
            "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/fjahr/received_events",
            "type": "User",
            "site_admin": false
          },
          "assignees": [
            {
              "login": "fjahr",
              "id": 1322187,
              "node_id": "MDQ6VXNlcjEzMjIxODc=",
              "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/fjahr",
              "html_url": "https://github.com/fjahr",
              "followers_url": "https://api.github.com/users/fjahr/followers",
              "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
              "organizations_url": "https://api.github.com/users/fjahr/orgs",
              "repos_url": "https://api.github.com/users/fjahr/repos",
              "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/fjahr/received_events",
              "type": "User",
              "site_admin": false
            },
            {
              "login": "btsea",
              "id": 49500661,
              "node_id": "MDQ6VXNlcjQ5NTAwNjYx",
              "avatar_url": "https://avatars.githubusercontent.com/u/49500661?v=4",
              "gravatar_id": "",
              "url": "https://api.github.com/users/btsea",
              "html_url": "https://github.com/btsea",
              "followers_url": "https://api.github.com/users/btsea/followers",
              "following_url": "https://api.github.com/users/btsea/following%7B/other_user%7D",
              "gists_url": "https://api.github.com/users/btsea/gists%7B/gist_id%7D",
              "starred_url": "https://api.github.com/users/btsea/starred%7B/owner%7D%7B/repo%7D",
              "subscriptions_url": "https://api.github.com/users/btsea/subscriptions",
              "organizations_url": "https://api.github.com/users/btsea/orgs",
              "repos_url": "https://api.github.com/users/btsea/repos",
              "events_url": "https://api.github.com/users/btsea/events%7B/privacy%7D",
              "received_events_url": "https://api.github.com/users/btsea/received_events",
              "type": "User",
              "site_admin": false
            }
          ],
          "author_association": "COLLABORATOR",
          "locked": false,
          "comments": 3,
          "closed_at": "2023-09-08T16:39:24Z",
          "created_at": "2023-09-03T18:57:10Z",
          "updated_at": "2023-09-08T16:39:25Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMwNGJmZTNhNDY4ZjBjMmFiNDM3NmNiYjFmOTE5ZGIyN2JjN2I4MjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/304bfe3a468f0c2ab4376cbb1f919db27bc7b820",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/304bfe3a468f0c2ab4376cbb1f919db27bc7b820",
      "tree": {
        "sha": "e710010dfb1d6d4b9e43ad79cfd1857ea12a3308",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e710010dfb1d6d4b9e43ad79cfd1857ea12a3308"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a4b0b09a21d16429903b7111c998a6fc0b9701a",
          "sha": "5a4b0b09a21d16429903b7111c998a6fc0b9701a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5a4b0b09a21d16429903b7111c998a6fc0b9701a"
        }
      ],
      "message": "validation: pruning for multiple chainstates\n\nIntroduces ChainstateManager::GetPruneRange().\n\nThe prune budget is split evenly between the number of chainstates,\nhowever the prune budget may be exceeded if the resulting shares are\nbeneath `MIN_DISK_SPACE_FOR_BLOCK_FILES`.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-08T11:02:46Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-09-16T20:34:45Z"
      },
      "sha": "304bfe3a468f0c2ab4376cbb1f919db27bc7b820"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10319081780,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJnELE0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10319081780",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-08T14:42:41Z"
    },
    {
      "event": "reviewed",
      "id": 1617109738,
      "node_id": "PRR_kwDOABII585gYyLq",
      "url": null,
      "actor": null,
      "commit_id": "9634d71e8b2f9cdccb437e2a689ac298c05c0583",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "All feedback addressed, thanks @ryanofsky @andrewtoth @naumenkogs. \r\n\r\n[`au.036`](https://github.com/jamesob/bitcoin/releases/tag/au.036); range-diff:\r\n```shell\r\n( git remote -v | grep jamesob ) || git remote add jamesob https://github.com/jamesob/bitcoin\r\ngit fetch jamesob\r\ngit range-diff upstream/master jamesob/au.035 jamesob/au.036\r\n```",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1617109738",
      "submitted_at": "2023-09-08T14:54:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "reviewed",
      "id": 1618712088,
      "node_id": "PRR_kwDOABII585ge5YY",
      "url": null,
      "actor": null,
      "commit_id": "9634d71e8b2f9cdccb437e2a689ac298c05c0583",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I made some more progress reviewing 9634d71e8b2f9cdccb437e2a689ac298c05c0583, but unfortunately got bogged down in the chainstatemanager_loadblockindex test again and suggested a lot of clarifications for it [below](https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1320930329).\r\n\r\nRelated to this, I also found a possible bug in the `ChainstateManager::LoadBlockIndex` function and posted a comment in the earlier PR: https://github.com/bitcoin/bitcoin/pull/27746#discussion_r1320915269",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1618712088",
      "submitted_at": "2023-09-11T02:28:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    },
    {
      "event": "labeled",
      "id": 10331647728,
      "node_id": "LE_lADOABII585lWq3pzwAAAAJn0G7w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10331647728",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T09:32:19Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJiYjI3Y2ZkZWZlOTAyNWI3MmRkYmQwNjgzMDY3NjdkYWJhMDlkZGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2bb27cfdefe9025b72ddbd068306767daba09ddb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2bb27cfdefe9025b72ddbd068306767daba09ddb",
      "tree": {
        "sha": "8afa19fcb3e3995941b515fd9852ca1317f0374e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8afa19fcb3e3995941b515fd9852ca1317f0374e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/304bfe3a468f0c2ab4376cbb1f919db27bc7b820",
          "sha": "304bfe3a468f0c2ab4376cbb1f919db27bc7b820",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/304bfe3a468f0c2ab4376cbb1f919db27bc7b820"
        }
      ],
      "message": "test: adjust chainstate tests to use recognized snapshot base\n\nIn future commits, loading the block index while making use of a\nsnapshot is contingent on the snapshot being recognized by chainparams.\n\nEnsure all existing unittests that use snapshots use a recognized\nsnapshot (at height 110).\n\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:05:38Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-08-25T18:05:07Z"
      },
      "sha": "2bb27cfdefe9025b72ddbd068306767daba09ddb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUzY2FlODU3MzhjOGJmNDExNjU0N2FmOGQ4NjhjNmMwMTU3N2I4MGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e3cae85738c8bf4116547af8d868c6c01577b80f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e3cae85738c8bf4116547af8d868c6c01577b80f",
      "tree": {
        "sha": "dc4d8969d69424df53f3b0cbd48489b7f10a5f49",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dc4d8969d69424df53f3b0cbd48489b7f10a5f49"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2bb27cfdefe9025b72ddbd068306767daba09ddb",
          "sha": "2bb27cfdefe9025b72ddbd068306767daba09ddb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2bb27cfdefe9025b72ddbd068306767daba09ddb"
        }
      ],
      "message": "validation: populate nChainTx value for assumedvalid chainstates\n\nUse the expected AssumeutxoData in order to bootstrap nChainTx values\nfor assumedvalid blockindex entries in the snapshot chainstate. This\nis necessary because nChainTx is normally built up from nTx values,\nwhich are populated using blockdata which the snapshot chainstate\ndoes not yet have.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-05T19:54:13Z"
      },
      "sha": "e3cae85738c8bf4116547af8d868c6c01577b80f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNmZjI2YmM3MzM3NGI1MzU1MGRjMmRkMTdkZDNlMWM1ODI1OGZjMzA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "tree": {
        "sha": "c4428a034ae39fe5adf727fbfa9123e9d2070df7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c4428a034ae39fe5adf727fbfa9123e9d2070df7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e3cae85738c8bf4116547af8d868c6c01577b80f",
          "sha": "e3cae85738c8bf4116547af8d868c6c01577b80f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e3cae85738c8bf4116547af8d868c6c01577b80f"
        }
      ],
      "message": "blockstorage: segment normal/assumedvalid blockfiles\n\nWhen using an assumedvalid (snapshot) chainstate along with a background\nchainstate, we are syncing two very different regions of the chain\nsimultaneously. If we use the same blockfile space for both of these\nsyncs, wildly different height blocks will be stored alongside one\nanother, making pruning ineffective.\n\nThis change implements a separate blockfile cursor for the assumedvalid\nchainstate when one is in use.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-03T18:55:03Z"
      },
      "sha": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA5NThmMTFjMThjNjE1YzgzNjMyMTI5ZTdmOWQwMTBjNzFmNDgwZWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0958f11c18c615c83632129e7f9d010c71f480ea",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0958f11c18c615c83632129e7f9d010c71f480ea",
      "tree": {
        "sha": "6cca0b8a7d26a470d858f973125556816b8690a9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6cca0b8a7d26a470d858f973125556816b8690a9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
          "sha": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3ff26bc73374b53550dc2dd17dd3e1c58258fc30"
        }
      ],
      "message": "validation: assumeutxo: swap m_mempool on snapshot activation\n\nOtherwise we will not receive transactions during background sync until\nrestart.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-05-05T22:27:56Z"
      },
      "sha": "0958f11c18c615c83632129e7f9d010c71f480ea"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ5NDA1ZmUxYjdlYTMwODYxYmU3Yjg0NTE1ZTEzYTE0OTEwOWJlMzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9405fe1b7ea30861be7b84515e13a149109be36",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d9405fe1b7ea30861be7b84515e13a149109be36",
      "tree": {
        "sha": "2a3a3c6344562074da9856e3ca0bbb92fabd7152",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2a3a3c6344562074da9856e3ca0bbb92fabd7152"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0958f11c18c615c83632129e7f9d010c71f480ea",
          "sha": "0958f11c18c615c83632129e7f9d010c71f480ea",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0958f11c18c615c83632129e7f9d010c71f480ea"
        }
      ],
      "message": "rpc: add loadtxoutset\n\nCo-authored-by: Sebastian Falbesoner <sebastian.falbesoner@gmail.com>",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-03-29T19:31:54Z"
      },
      "sha": "d9405fe1b7ea30861be7b84515e13a149109be36"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5NDQ4YmI4MDU5MjA4ODA3NDkyMzAwYmM4NDI5NGE3ZjJmMzhlZGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9448bb8059208807492300bc84294a7f2f38edf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9448bb8059208807492300bc84294a7f2f38edf",
      "tree": {
        "sha": "e9574fc7cda8a198b5d7f215ea4f24eed6a9bf24",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e9574fc7cda8a198b5d7f215ea4f24eed6a9bf24"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d9405fe1b7ea30861be7b84515e13a149109be36",
          "sha": "d9405fe1b7ea30861be7b84515e13a149109be36",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d9405fe1b7ea30861be7b84515e13a149109be36"
        }
      ],
      "message": "refuse to activate a UTXO snapshot if mempool not empty\n\nThis ensures that we avoid any unexpected conditions inherent in\ntransferring non-empty mempools across chainstates.\n\nNote that this should never happen in practice given that snapshot\nactivation will not occur outside of IBD, based upon the height checks\nin `loadtxoutset`.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-08T10:29:32Z"
      },
      "sha": "b9448bb8059208807492300bc84294a7f2f38edf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUxZGJkZTJiYjczYmNkMDNmNzNlM2Q1ZWI2Yzk5OGU1ZTAxYjU1MzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536",
      "tree": {
        "sha": "e096e5abccacbad9d0a51a56807b4340869db659",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e096e5abccacbad9d0a51a56807b4340869db659"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9448bb8059208807492300bc84294a7f2f38edf",
          "sha": "b9448bb8059208807492300bc84294a7f2f38edf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9448bb8059208807492300bc84294a7f2f38edf"
        }
      ],
      "message": "rpc: add getchainstates",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2019-03-29T21:55:08Z"
      },
      "sha": "51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNjN2RhY2I4MjNiMGMyMjZjMDIzMDJiMmMxMmNmZTM3MTIxZTBiMGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c7dacb823b0c226c02302b2c12cfe37121e0b0d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3c7dacb823b0c226c02302b2c12cfe37121e0b0d",
      "tree": {
        "sha": "02b83c66366639951cea7ca61abea434dadc39a4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/02b83c66366639951cea7ca61abea434dadc39a4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536",
          "sha": "51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/51dbde2bb73bcd03f73e3d5eb6c998e5e01b5536"
        }
      ],
      "message": "test: add feature_assumeutxo functional test",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-06-17T20:09:38Z"
      },
      "sha": "3c7dacb823b0c226c02302b2c12cfe37121e0b0d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI2ZjZlYWJmZDg0ZTE0YTFkNjIxMTIxZTNjZDg0MWFjM2NlOTE5MzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6f6eabfd84e14a1d621121e3cd841ac3ce91932",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b6f6eabfd84e14a1d621121e3cd841ac3ce91932",
      "tree": {
        "sha": "598ffb090cb9e7d6027ab97383cd21247e7ace7a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/598ffb090cb9e7d6027ab97383cd21247e7ace7a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c7dacb823b0c226c02302b2c12cfe37121e0b0d",
          "sha": "3c7dacb823b0c226c02302b2c12cfe37121e0b0d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3c7dacb823b0c226c02302b2c12cfe37121e0b0d"
        }
      ],
      "message": "contrib: add script to demo/test assumeutxo\n\nAdd the script to the shellcheck exception list since the\nquoted variables rule needs to be violated in order to get\nbitcoind to pick up on $CHAIN_HACK_FLAGS.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-06-16T16:09:29Z"
      },
      "sha": "b6f6eabfd84e14a1d621121e3cd841ac3ce91932"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI3YWRjMzZhMTczZDU2MzZlODJkZmNhMjczNjRkYmRhMzRmM2IwMjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/27adc36a173d5636e82dfca27364dbda34f3b022",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/27adc36a173d5636e82dfca27364dbda34f3b022",
      "tree": {
        "sha": "a4710daadf3482f67528b9c8c18d39e55a70fa8c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a4710daadf3482f67528b9c8c18d39e55a70fa8c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b6f6eabfd84e14a1d621121e3cd841ac3ce91932",
          "sha": "b6f6eabfd84e14a1d621121e3cd841ac3ce91932",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b6f6eabfd84e14a1d621121e3cd841ac3ce91932"
        }
      ],
      "message": "doc: update release-process.md for assumeutxo",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-07-20T14:38:44Z"
      },
      "sha": "27adc36a173d5636e82dfca27364dbda34f3b022"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGExNDJjYWRlMzM1YjA4MGQxZjI0OTJiOTMyNWI5MjNmZjUxNjhmNzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a142cade335b080d1f2492b9325b923ff5168f74",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a142cade335b080d1f2492b9325b923ff5168f74",
      "tree": {
        "sha": "cdf4835a5fb1cd07a5b2852392966fa8f7ecdb36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cdf4835a5fb1cd07a5b2852392966fa8f7ecdb36"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/27adc36a173d5636e82dfca27364dbda34f3b022",
          "sha": "27adc36a173d5636e82dfca27364dbda34f3b022",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/27adc36a173d5636e82dfca27364dbda34f3b022"
        }
      ],
      "message": "chainparams: add assumeutxo param at height 788_000",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T16:06:23Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-06-03T14:59:13Z"
      },
      "sha": "a142cade335b080d1f2492b9325b923ff5168f74"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlmOWZmYjY1NWU0MjM2ZjhkNTY3Yjk2MTEwMmY1M2M1OTMzZThhYTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "tree": {
        "sha": "2b2e192a837770d0b3b02a7c127fd54de73c228f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2b2e192a837770d0b3b02a7c127fd54de73c228f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a142cade335b080d1f2492b9325b923ff5168f74",
          "sha": "a142cade335b080d1f2492b9325b923ff5168f74",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a142cade335b080d1f2492b9325b923ff5168f74"
        }
      ],
      "message": "doc: add note about confusing HaveTxsDownloaded name",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T17:41:28Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2023-09-11T17:41:28Z"
      },
      "sha": "9f9ffb655e4236f8d567b961102f53c5933e8aa8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10337183153,
      "node_id": "HRFPE_lADOABII585lWq3pzwAAAAJoJOWx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10337183153",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T17:43:46Z"
    },
    {
      "event": "unlabeled",
      "id": 10338371820,
      "node_id": "UNLE_lADOABII585lWq3pzwAAAAJoNwjs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10338371820",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T19:52:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1714510045,
      "node_id": "IC_kwDOABII585mMVjd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1714510045",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T20:10:41Z",
      "updated_at": "2023-09-11T20:10:41Z",
      "author_association": "MEMBER",
      "body": "Pushed an update adding @ryanofsky's good test changes, an import fix for the RPC code, and a documentation commit describing the confusing naming of `HaveTxsDownloaded()`.\r\n\r\n[`au.037`](https://github.com/jamesob/bitcoin/releases/tag/au.037)\r\n```\r\n( git remote -v | grep jamesob ) || git remote add jamesob https://github.com/jamesob/bitcoin\r\ngit fetch jamesob\r\ngit range-diff upstream/master jamesob/au.036 jamesob/au.037\r\n```\r\n\r\nI've run this locally for a few IBD cycles.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1714510045",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "mentioned",
      "id": 10338528615,
      "node_id": "MEE_lADOABII585lWq3pzwAAAAJoOW1n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10338528615",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T20:10:42Z"
    },
    {
      "event": "subscribed",
      "id": 10338528626,
      "node_id": "SE_lADOABII585lWq3pzwAAAAJoOW1y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10338528626",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T20:10:42Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T21:13:37Z",
      "updated_at": "2023-09-11T21:13:37Z",
      "source": {
        "issue": {
          "id": 1891230257,
          "node_id": "PR_kwDOABII585aD7yV",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28453",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28453/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28453/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28453/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28453",
          "number": 28453,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Receive silent payment transactions",
          "body": "This PR implements receiving silent payment transactions through the use of a new `ScriptPubKeyMan` type: `SilentPaymentsSPKM`. This is a descriptor wallet only feature, although it does not use descriptors.\r\n\r\nThis is an optional feature, so the only way to use it is to create a new wallet with `createwallet` with `silent_payments=true`. Such wallets will have a single `SilentPaymentsSPKM` that is used for both receiving and change. Since silent payments only have a single address, repeated calls to `getnewaddress` and `getrawchangeaddress` always return the same address, however the receiving and change addresses are different, see the BIP for how the change is generated.\r\n\r\nSince silent payments requires the spent coins in order to extract public keys from them, `TransactionAddedToMempool` is modified to also provide that information. For scanning blocks, the wallet will retrieve that information from the undo data. Additionally, when rescanning, a silent payments wallet must use the slow rescan method.\r\n\r\nThe labels feature has not been fully implemented yet and is left for a followup.\r\n\r\nBased on #28122 and #28201 \r\n\r\nAlternative to #28202",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 5334691551,
              "node_id": "LA_kwDOABII588AAAABPfju3w",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
              "name": "CI failed",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28453",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28453",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28453.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28453.patch"
          },
          "created_at": "2023-09-11T20:39:25Z",
          "updated_at": "2023-09-13T20:03:04Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1715132009,
      "node_id": "IC_kwDOABII585mOtZp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715132009",
      "actor": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-12T07:13:01Z",
      "updated_at": "2023-09-12T07:13:01Z",
      "author_association": "MEMBER",
      "body": "ACK 9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#issuecomment-1715132009",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27596"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-12T17:15:31Z",
      "updated_at": "2023-09-12T17:15:31Z",
      "source": {
        "issue": {
          "id": 1891020951,
          "node_id": "PR_kwDOABII585aDN8k",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28452",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28452/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28452/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/28452/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/28452",
          "number": 28452,
          "state": "open",
          "state_reason": null,
          "title": "Do not use std::vector = {} to release memory",
          "body": "It appears that invoking `v = {};` for an `std::vector<...> v` is equivalent to `v.clear()`, which does not release its allocated memory. There are a number of places in the codebase where it appears to be used for that purpose however (mostly written by me). Replace those with `std::vector<...>{}.swap(v);` (using a helper function `ClearShrink` in util/vector.h).\r\n\r\nTo explain what is going on: `v = {...};` is equivalent in general to `v.operator=({...});`. For many types, the `{}` is converted to the type of `v`, and then assigned to `v` - which for `std::vector` would ordinarily have the effect of clearing its memory (constructing a new empty vector, and then move-assigning it to `v`). However, since `std::vector<T>` has an `operator=(std::initializer_list<T>)` defined, it has precedence (since no implicit conversion is needed), and with an empty list, that is equivalent to `clear()`.\r\n\r\nI did consider using `v = std::vector<T>{};` as replacement for `v = {};` instances where memory releasing is desired, but it appears that it does not actually work universally either. `V{}.swap(v);` does.",
          "user": {
            "login": "sipa",
            "id": 548488,
            "node_id": "MDQ6VXNlcjU0ODQ4OA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sipa",
            "html_url": "https://github.com/sipa",
            "followers_url": "https://api.github.com/users/sipa/followers",
            "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
            "organizations_url": "https://api.github.com/users/sipa/orgs",
            "repos_url": "https://api.github.com/users/sipa/repos",
            "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/sipa/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 5483054654,
              "node_id": "LA_kwDOABII588AAAABRtDGPg",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20backport%20(25.x)",
              "name": "Needs backport (25.x)",
              "description": "",
              "color": "ff8200",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/28452",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/28452",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/28452.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/28452.patch"
          },
          "created_at": "2023-09-11T18:16:53Z",
          "updated_at": "2023-09-13T12:45:40Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1622395165,
      "node_id": "PRR_kwDOABII585gs8kd",
      "url": null,
      "actor": null,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Working through 9f9ffb655e4236f8d567b961102f53c5933e8aa8. Got through the segmented storage change which is much simpler now, but I did leave some comments. Will continue reviewing.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#pullrequestreview-1622395165",
      "submitted_at": "2023-09-12T17:37:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197159021",
      "pull_request_review_id": 1431794725,
      "id": 1197159021,
      "node_id": "PRRC_kwDOABII585HWzJt",
      "diff_hunk": "@@ -2700,6 +2700,86 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};",
      "path": "src/rpc/blockchain.cpp",
      "position": 41,
      "original_position": 28,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "bbaa5812258e33ca8a5a63f28c7da6b1d78433a1",
      "in_reply_to_id": null,
      "user": {
        "login": "theStack",
        "id": 91535,
        "node_id": "MDQ6VXNlcjkxNTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theStack",
        "html_url": "https://github.com/theStack",
        "followers_url": "https://api.github.com/users/theStack/followers",
        "following_url": "https://api.github.com/users/theStack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theStack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theStack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
        "organizations_url": "https://api.github.com/users/theStack/orgs",
        "repos_url": "https://api.github.com/users/theStack/repos",
        "events_url": "https://api.github.com/users/theStack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theStack/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right now if a non-existing file path is passed, a rather cryptic error message appears:\r\n```\r\n$ ./src/bitcoin-cli loadtxoutset jslkdf \r\nerror code: -1\r\nerror message:\r\nCAutoFile::operator>>: file handle is nullptr: unspecified iostream_category error\r\n```\r\n\r\nShould ensure that `afile` is not null and throw an explicit error if it is (like `dumptxoutset` already does), e.g.:\r\n```suggestion\r\n    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\r\n    if (afile.IsNull()) {\r\n        throw JSONRPCError(\r\n            RPC_INVALID_PARAMETER,\r\n            \"Couldn't open file \" + path.u8string() + \" for reading.\");\r\n    }\r\n```",
      "created_at": "2023-05-17T23:25:38Z",
      "updated_at": "2023-05-18T00:37:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1197159021",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1197159021"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2732,
      "original_line": 2732,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210211360",
      "pull_request_review_id": 1450841472,
      "id": 1210211360,
      "node_id": "PRRC_kwDOABII585IIlwg",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": null,
      "user": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Getting `syntax error: operand expected (error token is \"\"30000\" + \"20000\"\")` on macOS\r\n```suggestion\r\nFINAL_HEIGHT=$(($BASE_HEIGHT + $INCREMENTAL_HEIGHT))\r\n```",
      "created_at": "2023-05-30T12:38:57Z",
      "updated_at": "2023-05-30T12:38:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1210211360",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210211360"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210212400",
      "pull_request_review_id": 1450842970,
      "id": 1210212400,
      "node_id": "PRRC_kwDOABII585IImAw",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))\n+\n+SERVER_DATADIR=\"$(pwd)/utxodemo-data-server-$BASE_HEIGHT\"\n+CLIENT_DATADIR=\"$(pwd)/utxodemo-data-client-$BASE_HEIGHT\"\n+UTXO_DAT_FILE=\"$(pwd)/utxo.$BASE_HEIGHT.dat\"\n+\n+# Chosen to try to not interfere with any running bitcoind processes.\n+SERVER_PORT=8633\n+SERVER_RPC_PORT=8632\n+\n+CLIENT_PORT=8733\n+CLIENT_RPC_PORT=8732\n+\n+SERVER_PORTS=\"-port=${SERVER_PORT} -rpcport=${SERVER_RPC_PORT}\"\n+CLIENT_PORTS=\"-port=${CLIENT_PORT} -rpcport=${CLIENT_RPC_PORT}\"\n+\n+# Ensure the client exercises all indexes.\n+ALL_INDEXES=\"-txindex -coinstatsindex -blockfilterindex=1\"\n+\n+if ! command -v jq >/dev/null ; then\n+  echo \"This script requires jq to parse JSON RPC output. Please install it.\"\n+  echo \"(e.g. sudo apt install jq)\"\n+  exit 1\n+fi\n+\n+finish() {\n+  echo\n+  echo \"Killing server and client PIDs ($SERVER_PID, $CLIENT_PID) and cleaning up datadirs\"\n+  echo\n+  rm -f \"$UTXO_DAT_FILE\" \"$DUMP_OUTPUT\"\n+  rm -rf \"$SERVER_DATADIR\" \"$CLIENT_DATADIR\"\n+  kill -9 \"$SERVER_PID\" \"$CLIENT_PID\"\n+}\n+\n+trap finish EXIT\n+\n+# Need to specify these to trick client into accepting server as a peer\n+# it can IBD from.\n+CHAIN_HACK_FLAGS=\"-maxtipage=9223372036854775207 -minimumchainwork=0x00\"\n+\n+server_rpc() {\n+  ./src/bitcoin-cli -rpcport=$SERVER_RPC_PORT -datadir=\"$SERVER_DATADIR\" \"$@\"\n+}\n+client_rpc() {\n+  ./src/bitcoin-cli -rpcport=$CLIENT_RPC_PORT -datadir=\"$CLIENT_DATADIR\" \"$@\"\n+}\n+server_sleep_til_boot() {\n+  while ! server_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+}\n+client_sleep_til_boot() {\n+  while ! client_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+}\n+\n+mkdir -p \"$SERVER_DATADIR\" \"$CLIENT_DATADIR\"\n+\n+echo \"Hi, welcome to the assumeutxo demo/test\"\n+echo\n+echo \"We're going to\"\n+echo\n+echo \"  - start up a 'server' node, sync it via mainnet IBD to height ${BASE_HEIGHT}\"\n+echo \"  - create a UTXO snapshot at that height\"\n+echo \"  - IBD ${INCREMENTAL_HEIGHT} more blocks on top of that\"\n+echo\n+echo \"then we'll demonstrate assumeutxo by \"\n+echo\n+echo \"  - starting another node (the 'client') and loading the snapshot in\"\n+echo \"    * first you'll have to modify the code slightly (chainparams) and recompile\"\n+echo \"    * don't worry, we'll make it easy\"\n+echo \"  - observing the client sync ${INCREMENTAL_HEIGHT} blocks on top of the snapshot from the server\"\n+echo \"  - observing the client validate the snapshot chain via background IBD\"\n+echo\n+read -p \"Press [enter] to continue\" _\n+\n+echo\n+echo \"-- Starting the demo. You might want to run the two following commands in\"\n+echo \"   separate terminal windows:\"\n+echo\n+echo \"   watch -n0.1 tail -n 30 $SERVER_DATADIR/debug.log\"\n+echo \"   watch -n0.1 tail -n 30 $CLIENT_DATADIR/debug.log\"\n+echo\n+read -p \"Press [enter] to continue\" _\n+\n+echo\n+echo \"-- IBDing the blocks (height=$BASE_HEIGHT) required to the server node...\"\n+./src/bitcoind -logthreadnames=1 $SERVER_PORTS \\\n+    -datadir=\"$SERVER_DATADIR\" $CHAIN_HACK_FLAGS -stopatheight=\"$BASE_HEIGHT\" >/dev/null\n+\n+echo\n+echo \"-- Creating snapshot at ~ height $BASE_HEIGHT ($UTXO_DAT_FILE)...\"\n+sleep 2\n+./src/bitcoind -logthreadnames=1 $SERVER_PORTS \\\n+    -datadir=\"$SERVER_DATADIR\" $CHAIN_HACK_FLAGS -connect=0 -listen=0 >/dev/null &\n+SERVER_PID=\"$!\"\n+\n+DUMP_OUTPUT=\"dumptxoutset-output-$BASE_HEIGHT.json\"\n+\n+server_sleep_til_boot\n+server_rpc dumptxoutset \"$UTXO_DAT_FILE\" > \"$DUMP_OUTPUT\"\n+cat \"$DUMP_OUTPUT\"\n+kill -9 \"$SERVER_PID\"\n+\n+RPC_BASE_HEIGHT=$(jq -r .base_height < \"$DUMP_OUTPUT\")\n+RPC_AU=$(jq -r .txoutset_hash < \"$DUMP_OUTPUT\")\n+RPC_NCHAINTX=$(jq -r .nchaintx < \"$DUMP_OUTPUT\")\n+RPC_BLOCKHASH=$(jq -r .base_hash < \"$DUMP_OUTPUT\")\n+\n+# Wait for server to shutdown...\n+while server_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+\n+echo\n+echo \"-- Now: add the following to CMainParams::m_assumeutxo_data\"\n+echo \"   in src/kernel/chainparams.cpp, and recompile:\"\n+echo\n+echo \"   {${RPC_BASE_HEIGHT}, AssumeutxoHash{uint256S(\\\"0x${RPC_AU}\\\")}, ${RPC_NCHAINTX}, uint256S(\\\"0x${RPC_BLOCKHASH}\\\")},\"\n+echo\n+echo\n+echo \"-- IBDing more blocks to the server node (height=$FINAL_HEIGHT) so there is a diff between snapshot and tip...\"\n+./src/bitcoind $SERVER_PORTS -logthreadnames=1 -datadir=\"$SERVER_DATADIR\" \\\n+    $CHAIN_HACK_FLAGS -stopatheight=\"$FINAL_HEIGHT\" >/dev/null\n+\n+echo\n+echo \"-- Staring the server node to provide blocks to the client node...\"",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 141,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": null,
      "user": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Missing the second \"t\" of \"Starting\"\r\n```suggestion\r\necho \"-- Starting the server node to provide blocks to the client node...\"\r\n```",
      "created_at": "2023-05-30T12:39:49Z",
      "updated_at": "2023-05-30T12:39:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1210212400",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210212400"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 141,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210397176",
      "pull_request_review_id": 1451142607,
      "id": 1210397176,
      "node_id": "PRRC_kwDOABII585IJTH4",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Which version of Python are you using?",
      "created_at": "2023-05-30T14:45:25Z",
      "updated_at": "2023-05-30T14:45:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1210397176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210397176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210425053",
      "pull_request_review_id": 1451192866,
      "id": 1210425053,
      "node_id": "PRRC_kwDOABII585IJZ7d",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@Sjors this is bash :). If he's on macOS, probably some kind of zsh?",
      "created_at": "2023-05-30T15:05:14Z",
      "updated_at": "2023-05-30T15:05:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1210425053",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210425053"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210488998",
      "pull_request_review_id": 1451289875,
      "id": 1210488998,
      "node_id": "PRRC_kwDOABII585IJpim",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "MarcoFalke",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/MarcoFalke",
        "html_url": "https://github.com/MarcoFalke",
        "followers_url": "https://api.github.com/users/MarcoFalke/followers",
        "following_url": "https://api.github.com/users/MarcoFalke/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/MarcoFalke/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/MarcoFalke/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
        "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
        "repos_url": "https://api.github.com/users/MarcoFalke/repos",
        "events_url": "https://api.github.com/users/MarcoFalke/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "macOS ships an ancient version of bash",
      "created_at": "2023-05-30T15:52:07Z",
      "updated_at": "2023-05-30T15:52:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1210488998",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210488998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211504043",
      "pull_request_review_id": 1452852799,
      "id": 1211504043,
      "node_id": "PRRC_kwDOABII585INhWr",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "alexanderwiederin",
        "id": 37130778,
        "node_id": "MDQ6VXNlcjM3MTMwNzc4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37130778?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alexanderwiederin",
        "html_url": "https://github.com/alexanderwiederin",
        "followers_url": "https://api.github.com/users/alexanderwiederin/followers",
        "following_url": "https://api.github.com/users/alexanderwiederin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/alexanderwiederin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/alexanderwiederin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/alexanderwiederin/subscriptions",
        "organizations_url": "https://api.github.com/users/alexanderwiederin/orgs",
        "repos_url": "https://api.github.com/users/alexanderwiederin/repos",
        "events_url": "https://api.github.com/users/alexanderwiederin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/alexanderwiederin/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@jamesob line 1 (`#!/usr/bin/env bash`) sets the interpreter to Bash regardless of what the system default is.\r\n\r\n@MarcoFalke you were right! macOS comes with an outdated version of bash (`3.2.57`). I have updated to `5.2.15`. Script runs like a charm now. \r\n\r\nThanks for the help!",
      "created_at": "2023-05-31T10:41:26Z",
      "updated_at": "2023-05-31T10:41:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1211504043",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211504043"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211763951",
      "pull_request_review_id": 1453295026,
      "id": 1211763951,
      "node_id": "PRRC_kwDOABII585IOgzv",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> @Sjors this is bash :)\r\n\r\n*bashes head against table*",
      "created_at": "2023-05-31T13:56:41Z",
      "updated_at": "2023-05-31T13:56:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1211763951",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211763951"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211880620",
      "pull_request_review_id": 1453503822,
      "id": 1211880620,
      "node_id": "PRRC_kwDOABII585IO9Ss",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))\n+\n+SERVER_DATADIR=\"$(pwd)/utxodemo-data-server-$BASE_HEIGHT\"\n+CLIENT_DATADIR=\"$(pwd)/utxodemo-data-client-$BASE_HEIGHT\"\n+UTXO_DAT_FILE=\"$(pwd)/utxo.$BASE_HEIGHT.dat\"\n+\n+# Chosen to try to not interfere with any running bitcoind processes.\n+SERVER_PORT=8633\n+SERVER_RPC_PORT=8632\n+\n+CLIENT_PORT=8733\n+CLIENT_RPC_PORT=8732\n+\n+SERVER_PORTS=\"-port=${SERVER_PORT} -rpcport=${SERVER_RPC_PORT}\"\n+CLIENT_PORTS=\"-port=${CLIENT_PORT} -rpcport=${CLIENT_RPC_PORT}\"\n+\n+# Ensure the client exercises all indexes.\n+ALL_INDEXES=\"-txindex -coinstatsindex -blockfilterindex=1\"\n+\n+if ! command -v jq >/dev/null ; then\n+  echo \"This script requires jq to parse JSON RPC output. Please install it.\"\n+  echo \"(e.g. sudo apt install jq)\"\n+  exit 1\n+fi\n+\n+finish() {\n+  echo\n+  echo \"Killing server and client PIDs ($SERVER_PID, $CLIENT_PID) and cleaning up datadirs\"\n+  echo\n+  rm -f \"$UTXO_DAT_FILE\" \"$DUMP_OUTPUT\"\n+  rm -rf \"$SERVER_DATADIR\" \"$CLIENT_DATADIR\"\n+  kill -9 \"$SERVER_PID\" \"$CLIENT_PID\"\n+}\n+\n+trap finish EXIT\n+\n+# Need to specify these to trick client into accepting server as a peer\n+# it can IBD from.\n+CHAIN_HACK_FLAGS=\"-maxtipage=9223372036854775207 -minimumchainwork=0x00\"\n+\n+server_rpc() {\n+  ./src/bitcoin-cli -rpcport=$SERVER_RPC_PORT -datadir=\"$SERVER_DATADIR\" \"$@\"\n+}\n+client_rpc() {\n+  ./src/bitcoin-cli -rpcport=$CLIENT_RPC_PORT -datadir=\"$CLIENT_DATADIR\" \"$@\"\n+}\n+server_sleep_til_boot() {\n+  while ! server_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+}\n+client_sleep_til_boot() {\n+  while ! client_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+}\n+\n+mkdir -p \"$SERVER_DATADIR\" \"$CLIENT_DATADIR\"\n+\n+echo \"Hi, welcome to the assumeutxo demo/test\"\n+echo\n+echo \"We're going to\"\n+echo\n+echo \"  - start up a 'server' node, sync it via mainnet IBD to height ${BASE_HEIGHT}\"\n+echo \"  - create a UTXO snapshot at that height\"\n+echo \"  - IBD ${INCREMENTAL_HEIGHT} more blocks on top of that\"\n+echo\n+echo \"then we'll demonstrate assumeutxo by \"\n+echo\n+echo \"  - starting another node (the 'client') and loading the snapshot in\"\n+echo \"    * first you'll have to modify the code slightly (chainparams) and recompile\"\n+echo \"    * don't worry, we'll make it easy\"\n+echo \"  - observing the client sync ${INCREMENTAL_HEIGHT} blocks on top of the snapshot from the server\"\n+echo \"  - observing the client validate the snapshot chain via background IBD\"\n+echo\n+read -p \"Press [enter] to continue\" _\n+\n+echo\n+echo \"-- Starting the demo. You might want to run the two following commands in\"\n+echo \"   separate terminal windows:\"\n+echo\n+echo \"   watch -n0.1 tail -n 30 $SERVER_DATADIR/debug.log\"\n+echo \"   watch -n0.1 tail -n 30 $CLIENT_DATADIR/debug.log\"\n+echo\n+read -p \"Press [enter] to continue\" _\n+\n+echo\n+echo \"-- IBDing the blocks (height=$BASE_HEIGHT) required to the server node...\"\n+./src/bitcoind -logthreadnames=1 $SERVER_PORTS \\\n+    -datadir=\"$SERVER_DATADIR\" $CHAIN_HACK_FLAGS -stopatheight=\"$BASE_HEIGHT\" >/dev/null\n+\n+echo\n+echo \"-- Creating snapshot at ~ height $BASE_HEIGHT ($UTXO_DAT_FILE)...\"\n+sleep 2\n+./src/bitcoind -logthreadnames=1 $SERVER_PORTS \\\n+    -datadir=\"$SERVER_DATADIR\" $CHAIN_HACK_FLAGS -connect=0 -listen=0 >/dev/null &\n+SERVER_PID=\"$!\"\n+\n+DUMP_OUTPUT=\"dumptxoutset-output-$BASE_HEIGHT.json\"\n+\n+server_sleep_til_boot\n+server_rpc dumptxoutset \"$UTXO_DAT_FILE\" > \"$DUMP_OUTPUT\"\n+cat \"$DUMP_OUTPUT\"\n+kill -9 \"$SERVER_PID\"\n+\n+RPC_BASE_HEIGHT=$(jq -r .base_height < \"$DUMP_OUTPUT\")\n+RPC_AU=$(jq -r .txoutset_hash < \"$DUMP_OUTPUT\")\n+RPC_NCHAINTX=$(jq -r .nchaintx < \"$DUMP_OUTPUT\")\n+RPC_BLOCKHASH=$(jq -r .base_hash < \"$DUMP_OUTPUT\")\n+\n+# Wait for server to shutdown...\n+while server_rpc ping >/dev/null 2>&1; do sleep 0.1; done\n+\n+echo\n+echo \"-- Now: add the following to CMainParams::m_assumeutxo_data\"\n+echo \"   in src/kernel/chainparams.cpp, and recompile:\"\n+echo\n+echo \"   {${RPC_BASE_HEIGHT}, AssumeutxoHash{uint256S(\\\"0x${RPC_AU}\\\")}, ${RPC_NCHAINTX}, uint256S(\\\"0x${RPC_BLOCKHASH}\\\")},\"\n+echo\n+echo\n+echo \"-- IBDing more blocks to the server node (height=$FINAL_HEIGHT) so there is a diff between snapshot and tip...\"\n+./src/bitcoind $SERVER_PORTS -logthreadnames=1 -datadir=\"$SERVER_DATADIR\" \\\n+    $CHAIN_HACK_FLAGS -stopatheight=\"$FINAL_HEIGHT\" >/dev/null\n+\n+echo\n+echo \"-- Staring the server node to provide blocks to the client node...\"",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 141,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210212400,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, thanks",
      "created_at": "2023-05-31T15:13:11Z",
      "updated_at": "2023-05-31T15:13:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1211880620",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211880620"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 141,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211880971",
      "pull_request_review_id": 1453504505,
      "id": 1211880971,
      "node_id": "PRRC_kwDOABII585IO9YL",
      "diff_hunk": "@@ -0,0 +1,199 @@\n+#!/usr/bin/env bash\n+# Demonstrate the creation and usage of UTXO snapshots.\n+#\n+# A server node starts up, IBDs up to a certain height, then generates a UTXO\n+# snapshot at that point.\n+#\n+# The server then downloads more blocks (to create a diff from the snapshot).\n+#\n+# We bring a client up, load the UTXO snapshot, and we show the client sync to\n+# the \"network tip\" and then start a background validation of the snapshot it\n+# loaded. We see the background validation chainstate removed after validation\n+# completes.\n+#\n+\n+export LC_ALL=C\n+set -e\n+\n+BASE_HEIGHT=${1:-30000}\n+INCREMENTAL_HEIGHT=20000\n+FINAL_HEIGHT=$((\"$BASE_HEIGHT\" + \"$INCREMENTAL_HEIGHT\"))",
      "path": "contrib/devtools/test_utxo_snapshots.sh",
      "position": null,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fc6299c8c23479e3596c68920fa2a576488119c6",
      "in_reply_to_id": 1210211360,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, thanks all.",
      "created_at": "2023-05-31T15:13:24Z",
      "updated_at": "2023-05-31T15:13:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1211880971",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211880971"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 20,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290225497",
      "pull_request_review_id": 1572046251,
      "id": 1290225497,
      "node_id": "PRRC_kwDOABII585M50dZ",
      "diff_hunk": "@@ -1406,6 +1410,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)",
      "path": "src/net_processing.cpp",
      "position": 77,
      "original_position": 49,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This look suspiciously similar to `FindNextBlocksToDownload`, is there no way to unify the two?\r\n\r\n(sorry if I missed previous discussion on this)",
      "created_at": "2023-08-10T14:30:00Z",
      "updated_at": "2023-08-10T14:54:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1290225497",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290225497"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1386,
      "original_line": 1386,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290237668",
      "pull_request_review_id": 1572046251,
      "id": 1290237668,
      "node_id": "PRRC_kwDOABII585M53bk",
      "diff_hunk": "@@ -1901,7 +1970,10 @@ void PeerManagerImpl::BlockDisconnected(const std::shared_ptr<const CBlock> &blo\n  * Maintain state about the best-seen block and fast-announce a compact block\n  * to compatible peers.\n  */\n-void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock)\n+void PeerManagerImpl::NewPoWValidBlock(",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 136,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`NewPoWValidBlock` is already gated with `m_highest_fast_announce` but I think it would make sense to also ignore bg chainstate events explicitly.",
      "created_at": "2023-08-10T14:38:37Z",
      "updated_at": "2023-08-10T14:54:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1290237668",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290237668"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1974,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290241176",
      "pull_request_review_id": 1572046251,
      "id": 1290241176,
      "node_id": "PRRC_kwDOABII585M54SY",
      "diff_hunk": "@@ -87,13 +88,13 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": null,
      "user": {
        "login": "dergoegge",
        "id": 8077169,
        "node_id": "MDQ6VXNlcjgwNzcxNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8077169?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dergoegge",
        "html_url": "https://github.com/dergoegge",
        "followers_url": "https://api.github.com/users/dergoegge/followers",
        "following_url": "https://api.github.com/users/dergoegge/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dergoegge/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dergoegge/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dergoegge/subscriptions",
        "organizations_url": "https://api.github.com/users/dergoegge/orgs",
        "repos_url": "https://api.github.com/users/dergoegge/repos",
        "events_url": "https://api.github.com/users/dergoegge/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dergoegge/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "propbably not worth it to pass the chainstate role then?",
      "created_at": "2023-08-10T14:41:03Z",
      "updated_at": "2023-08-10T14:54:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1290241176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1290241176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291426426",
      "pull_request_review_id": 1477561344,
      "id": 1291426426,
      "node_id": "PRRC_kwDOABII585M-Zp6",
      "diff_hunk": "@@ -185,7 +185,14 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     chainman.InitializeChainstate(options.mempool);\n \n     // Load a chain created from a UTXO snapshot, if any exist.\n-    chainman.DetectSnapshotChainstate(options.mempool);\n+    bool has_snapshot = chainman.DetectSnapshotChainstate(options.mempool);\n+\n+    if (has_snapshot && (options.reindex || options.reindex_chainstate)) {\n+        return {ChainstateLoadStatus::FAILURE_NO_REINDEX, _(\n+            \"Reindex cannot be performed while background validation is in progress. \"\n+            \"Please wait for background sync to complete, or delete data directory \"",
      "path": "src/node/chainstate.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3b9d3d63d9ccb609ec08da34776f7c5f29d21a20",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Better to be precise and ask them to only recommend deleting `blocks`, `chainstate` and `indexes`. Or alternatively add a reminder that they should backup their wallet before deleting the whole datadir.",
      "created_at": "2023-08-11T14:42:31Z",
      "updated_at": "2023-08-11T22:00:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291426426",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291426426"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291431562",
      "pull_request_review_id": 1477561344,
      "id": 1291431562,
      "node_id": "PRRC_kwDOABII585M-a6K",
      "diff_hunk": "@@ -49,4 +51,15 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+template<typename V, typename L>\n+inline std::optional<V> FindFirst(const std::vector<V>& vec, const L fnc)",
      "path": "src/util/vector.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "cdb73e44b7f0d4ea186ba657ddf7809434f0a12a",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Doesn't `std::find_if` work for this?",
      "created_at": "2023-08-11T14:46:56Z",
      "updated_at": "2023-08-11T22:00:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291431562",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291431562"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 55,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291620032",
      "pull_request_review_id": 1477561344,
      "id": 1291620032,
      "node_id": "PRRC_kwDOABII585M_I7A",
      "diff_hunk": "@@ -173,6 +174,9 @@ void CZMQNotificationInterface::TransactionRemovedFromMempool(const CTransaction\n \n void CZMQNotificationInterface::BlockConnected(const ChainstateRole role, const std::shared_ptr<const CBlock>& pblock, const CBlockIndex* pindexConnected)\n {\n+    if (role == ChainstateRole::BACKGROUND) {",
      "path": "src/zmq/zmqnotificationinterface.cpp",
      "position": 15,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "f2a15428277090d6ad387de6d517303b9bc4e2af",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hmm, might be good to update ZMQ and wallet docs as a follow-up that blocks that are connected to the background chain will not be notified...",
      "created_at": "2023-08-11T17:31:20Z",
      "updated_at": "2023-08-11T22:00:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291620032",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291620032"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 176,
      "original_line": 176,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291649621",
      "pull_request_review_id": 1477561344,
      "id": 1291649621,
      "node_id": "PRRC_kwDOABII585M_QJV",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > nLastBlockWeCanPrune || fileinfo.nHeightFirst < min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), nLastBlockWeCanPrune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int chain_tip_height,\n+    int prune_height,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = GetPruneTarget() / chainman.GetAll().size();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9e2b8ef836aeb1dc2e4b57449fc56badebea6772",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I am not sure it makes sense to distribute the prune budget between all chainstates equally. Ideally we would sync the background chainstate block by block and throw them away instantly because if we are pruning the likelihood that we keep the bg blocks at the end of IBD is much lower. I'm not sure what the perfect distribution would be but I would shift it more towards the assumed chainstate.",
      "created_at": "2023-08-11T18:09:07Z",
      "updated_at": "2023-08-11T22:00:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291649621",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291649621"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291670706",
      "pull_request_review_id": 1477561344,
      "id": 1291670706,
      "node_id": "PRRC_kwDOABII585M_VSy",
      "diff_hunk": "@@ -2699,6 +2699,86 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n+    SnapshotMetadata metadata;\n+    afile >> metadata;\n+\n+    uint256 base_blockhash = metadata.m_base_blockhash;\n+    int max_secs_to_wait_for_headers = 60 * 10;\n+    CBlockIndex* snapshot_start_block = nullptr;\n+\n+    LogPrintf(\"[snapshot] waiting to see blockheader %s in headers chain before snapshot activation\\n\",\n+        base_blockhash.ToString());\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    while (max_secs_to_wait_for_headers > 0) {",
      "path": "src/rpc/blockchain.cpp",
      "position": 60,
      "original_position": 42,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "8ac7427b41fdec1dbc7e06d0aa2c0e469b879ba2",
      "in_reply_to_id": null,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "A bit simpler approach for this RPC would be to return to the user that the headers are not synced yet immediately and tell them they should try again when the headers are fully synced. I would be interested if others favor this approach as well.",
      "created_at": "2023-08-11T18:37:08Z",
      "updated_at": "2023-08-11T22:00:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291670706",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1291670706"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2751,
      "original_line": 2751,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294582794",
      "pull_request_review_id": 1578539655,
      "id": 1294582794,
      "node_id": "PRRC_kwDOABII585NKcQK",
      "diff_hunk": "@@ -1406,6 +1410,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)",
      "path": "src/net_processing.cpp",
      "position": 77,
      "original_position": 49,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": 1290225497,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"First draft of background sync logic\" (6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1290225497\r\n\r\n> This look suspiciously similar to `FindNextBlocksToDownload`, is there no way to unify the two?\r\n\r\nThis seems pretty bad. The most complicated part of the function is copied and pasted basically verbatim, and to make things worse, the comments which explain how it works are removed in the duplicated code.\r\n\r\nWould suggest 43b322188de227c1161fe3ee2dfd7b3a019cfc6a ([branch](https://github.com/ryanofsky/bitcoin/commits/pr/assumedl)) as a simpler alternative. It also add a commit description and a doxygen comment to explain all the variables which I found confusing. Feel free to add it to this PR or adopt anything there.\r\n\r\n\r\n",
      "created_at": "2023-08-15T13:14:53Z",
      "updated_at": "2023-08-15T16:49:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1294582794",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294582794"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1386,
      "original_line": 1386,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294850766",
      "pull_request_review_id": 1578539655,
      "id": 1294850766,
      "node_id": "PRRC_kwDOABII585NLdrO",
      "diff_hunk": "@@ -1406,6 +1409,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)\n+{\n+    if (vBlocks.size() >= count) {\n+        return;\n+    }\n+\n+    vBlocks.reserve(count);\n+    CNodeState *state = State(peer.m_id);\n+    assert(state != nullptr);\n+\n+    if (state->pindexBestKnownBlock == nullptr || state->pindexBestKnownBlock->GetAncestor(target_block->nHeight) != target_block) {\n+        // This peer is useless to us -- it has a chain that doesn't contain\n+        // our assumeutxo target.\n+        // Presumably this peer's chain has less work than our ActiveChain()'s tip, or else we\n+        // will eventually crash when we try to reorg to it. Let other logic\n+        // deal with whether we disconnect this peer.\n+        return;\n+    }\n+\n+    const CBlockIndex *pindexWalk = from_tip;\n+\n+    int nWindowEnd = pindexWalk->nHeight + BLOCK_DOWNLOAD_WINDOW;\n+    int nMaxHeight = std::min<int>(target_block->nHeight, nWindowEnd + 1);\n+\n+    std::vector<const CBlockIndex*> vToFetch;\n+\n+    while (pindexWalk->nHeight < nMaxHeight) {\n+        int nToFetch = std::min(nMaxHeight-pindexWalk->nHeight, std::max<int>(count-vBlocks.size(), 128));",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 48,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"First draft of background sync logic\" (6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b)\r\n\r\nThis code is just copied and pasted from previous code which was added back in #4468, but `std::max` seems like a bug here, and I would expect it to be `std::min` if the point is to read up to 128 successors of pIndexWalk at a time.",
      "created_at": "2023-08-15T16:30:39Z",
      "updated_at": "2023-08-15T16:49:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1294850766",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294850766"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1439,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294879351",
      "pull_request_review_id": 1579020103,
      "id": 1294879351,
      "node_id": "PRRC_kwDOABII585NLkp3",
      "diff_hunk": "@@ -1406,6 +1409,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)\n+{\n+    if (vBlocks.size() >= count) {\n+        return;\n+    }\n+\n+    vBlocks.reserve(count);\n+    CNodeState *state = State(peer.m_id);\n+    assert(state != nullptr);\n+\n+    if (state->pindexBestKnownBlock == nullptr || state->pindexBestKnownBlock->GetAncestor(target_block->nHeight) != target_block) {\n+        // This peer is useless to us -- it has a chain that doesn't contain",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"First draft of background sync logic\" (6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b)\r\n\r\nThis is an exaggeration, right? Peer doesn't seem completely useless if it doesn't contain the snapshot block because it could contain blocks leading up the snapshot block. It this is right it would be good to clarify, or maybe change to allow requesting blocks from the peer.",
      "created_at": "2023-08-15T16:58:54Z",
      "updated_at": "2023-08-15T16:58:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1294879351",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1294879351"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296088099",
      "pull_request_review_id": 1580896920,
      "id": 1296088099,
      "node_id": "PRRC_kwDOABII585NQLwj",
      "diff_hunk": "@@ -185,7 +185,14 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     chainman.InitializeChainstate(options.mempool);\n \n     // Load a chain created from a UTXO snapshot, if any exist.\n-    chainman.DetectSnapshotChainstate(options.mempool);\n+    bool has_snapshot = chainman.DetectSnapshotChainstate(options.mempool);\n+\n+    if (has_snapshot && (options.reindex || options.reindex_chainstate)) {\n+        return {ChainstateLoadStatus::FAILURE_NO_REINDEX, _(\n+            \"Reindex cannot be performed while background validation is in progress. \"\n+            \"Please wait for background sync to complete, or delete data directory \"",
      "path": "src/node/chainstate.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3b9d3d63d9ccb609ec08da34776f7c5f29d21a20",
      "in_reply_to_id": 1291426426,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"assumeutxo: disallow -reindex when background syncing\" (3b9d3d63d9ccb609ec08da34776f7c5f29d21a20)\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1291426426\r\n\r\nI don't understand the advice to \"wait for background sync to complete\" in this error message. I thought use-cases for reindex were mostly things like recovering from data corruption or restoring from backup. Is there a case where you would ever want to wait for a sync to complete and then reindex after that?\r\n\r\nAlso, I'm not sure why it needs be an error to reindex when a snapshot is loaded. The reindex options are supposed delete the UTXO database (and optionally other databases) without deleting block data, and rebuild using whatever data is left over. So if a snapshot is loaded it seems like the -reindex implementation could just delete both UTXO databases and then continue as normal without the snapshot. If the user still had a copy of the snapshot, they could reload it with the `loadtxoutset` RPC later and reuse the blocks that were already downloaded.\r\n\r\nIt seems like implementing this making making reindex work cleanly with assumeutxo would not be much harder than adding this error message.",
      "created_at": "2023-08-16T15:29:08Z",
      "updated_at": "2023-08-16T18:01:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1296088099",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296088099"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296254459",
      "pull_request_review_id": 1580896920,
      "id": 1296254459,
      "node_id": "PRRC_kwDOABII585NQ0X7",
      "diff_hunk": "@@ -1642,6 +1642,9 @@ bool Chainstate::IsInitialBlockDownload() const\n     }\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n     m_cached_finished_ibd.store(true, std::memory_order_relaxed);\n+    // Important that this comes *after* the previous line, else we'll wind up in an\n+    // infinite recursion.\n+    m_chainman.MaybeRebalanceCaches();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5ea9abfbac3543f2d2cef90a1528abed35623822",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: MaybeRebalanceCaches when chain leaves IBD\" (5ea9abfbac3543f2d2cef90a1528abed35623822)\r\n\r\nIt seems dangerous if just calling IsInitialBlockDownload to find out IBD state could now block and resize caches and flush state to disk. It also makes the codebase hard to understand if you can't answer a basic question like \"when do caches get resized\" without having to look up IsInitialBlockDownload() calls all over the codebase.\r\n\r\nI think it would be better to choose one place where it would be logical to check for the end of IBD and rebalance caches, like after a block is connected or after a header is received, and put the MaybeRebalanceCaches in a specific place instead of letting it happen anywhere.",
      "created_at": "2023-08-16T17:56:03Z",
      "updated_at": "2023-08-16T18:01:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1296254459",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1296254459"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1647,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303334266",
      "pull_request_review_id": 1592088142,
      "id": 1303334266,
      "node_id": "PRRC_kwDOABII585Nr016",
      "diff_hunk": "@@ -3178,15 +3179,16 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n             // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n             if (pindexFork != pindexNewTip) {\n                 // Notify ValidationInterface subscribers\n-                GetMainSignals().UpdatedBlockTip(pindexNewTip, pindexFork, fInitialDownload);\n-\n-                // Always notify the UI if a new block tip was connected\n-                if (kernel::IsInterrupted(m_chainman.GetNotifications().blockTip(GetSynchronizationState(fInitialDownload), *pindexNewTip))) {\n-                    // Just breaking and returning success for now. This could\n-                    // be changed to bubble up the kernel::Interrupted value to\n-                    // the caller so the caller could distinguish between\n-                    // completed and interrupted operations.\n-                    break;\n+                GetMainSignals().UpdatedBlockTip(this->GetRole(), pindexNewTip, pindexFork, fInitialDownload);\n+\n+                if (this == &m_chainman.ActiveChainstate() &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 50,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2856710077abbc8f07a97adfff5f6829358155be)\r\n\r\nWould suggest moving this change to a separate commit. Otherwise adding the chainstate check here is a behavior change in a refactoring commit. Also it doesn't seem directly related to the other changes here ",
      "created_at": "2023-08-23T17:28:41Z",
      "updated_at": "2023-08-23T21:25:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1303334266",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303334266"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303337523",
      "pull_request_review_id": 1592088142,
      "id": 1303337523,
      "node_id": "PRRC_kwDOABII585Nr1oz",
      "diff_hunk": "@@ -4057,7 +4060,18 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n             ret = AcceptBlock(block, state, &pindex, force_processing, nullptr, new_block, min_pow_checked);\n         }\n         if (!ret) {\n-            GetMainSignals().BlockChecked(*block, state);\n+            const auto& snapshot = this->SnapshotBlockhash();\n+            ChainstateRole role{ChainstateRole::NORMAL};\n+\n+            // Determine whether or not this block belongs to an assumedvalid chainstate, which\n+            // will affect block storage.\n+            if (snapshot) {\n+                const auto au_data = Assert(GetParams().AssumeutxoForBlockhash(*snapshot));\n+                role = (pindex->nHeight >= au_data->height) ?\n+                    ChainstateRole::ASSUMEDVALID : ChainstateRole::BACKGROUND;\n+            }\n+\n+            GetMainSignals().BlockChecked(role, *block, state);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2856710077abbc8f07a97adfff5f6829358155be)\r\n\r\nI don't see the BlockChecked `role` parameter being used later in the PR, and I don't know another reason why it should be added. It seems like it would be simpler to not add the parameter and get rid of the code above, which is not very straightforward and seems to basically be making up the `role` value.",
      "created_at": "2023-08-23T17:31:56Z",
      "updated_at": "2023-08-23T21:25:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1303337523",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303337523"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303342871",
      "pull_request_review_id": 1592088142,
      "id": 1303342871,
      "node_id": "PRRC_kwDOABII585Nr28X",
      "diff_hunk": "@@ -87,13 +88,13 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.\n      */\n-    virtual void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) {}\n+    virtual void UpdatedBlockTip(const ChainstateRole, const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) {}\n     /**\n      * Notifies listeners of a transaction having been added to mempool.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": null,
      "original_position": 21,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2856710077abbc8f07a97adfff5f6829358155be)\r\n\r\nThese TransactionAddedToMempool and TransactionRemovedFromMempool comments are a little confusing because I wouldn't expect the background chainstate to have a mempool, and even if there were multiple mempools, I wouldn't think knowing what chainstate they build on to be enough to identify them. I think it would be better to drop this new comment and avoid mixing up chainstate/mempool concepts.",
      "created_at": "2023-08-23T17:37:17Z",
      "updated_at": "2023-08-23T21:26:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1303342871",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1303342871"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304837385",
      "pull_request_review_id": 1594414348,
      "id": 1304837385,
      "node_id": "PRRC_kwDOABII585Nxj0J",
      "diff_hunk": "@@ -2700,6 +2700,86 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};",
      "path": "src/rpc/blockchain.cpp",
      "position": 41,
      "original_position": 28,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "bbaa5812258e33ca8a5a63f28c7da6b1d78433a1",
      "in_reply_to_id": 1197159021,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks - fixed and added you as a coauther.",
      "created_at": "2023-08-24T20:34:19Z",
      "updated_at": "2023-08-24T20:34:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1304837385",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304837385"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2732,
      "original_line": 2732,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304838783",
      "pull_request_review_id": 1594416523,
      "id": 1304838783,
      "node_id": "PRRC_kwDOABII585NxkJ_",
      "diff_hunk": "@@ -1406,6 +1410,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)",
      "path": "src/net_processing.cpp",
      "position": 77,
      "original_position": 49,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": 1290225497,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks guys - I've taken https://github.com/bitcoin/bitcoin/commit/43b322188de227c1161fe3ee2dfd7b3a019cfc6a and made a cosmetic refactoring change.",
      "created_at": "2023-08-24T20:36:01Z",
      "updated_at": "2023-08-24T20:36:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1304838783",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304838783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1386,
      "original_line": 1386,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304845272",
      "pull_request_review_id": 1594426081,
      "id": 1304845272,
      "node_id": "PRRC_kwDOABII585NxlvY",
      "diff_hunk": "@@ -87,13 +88,13 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": 1290241176,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good idea; done.",
      "created_at": "2023-08-24T20:42:27Z",
      "updated_at": "2023-08-24T20:42:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1304845272",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304845272"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304849279",
      "pull_request_review_id": 1594432267,
      "id": 1304849279,
      "node_id": "PRRC_kwDOABII585Nxmt_",
      "diff_hunk": "@@ -4057,7 +4060,18 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n             ret = AcceptBlock(block, state, &pindex, force_processing, nullptr, new_block, min_pow_checked);\n         }\n         if (!ret) {\n-            GetMainSignals().BlockChecked(*block, state);\n+            const auto& snapshot = this->SnapshotBlockhash();\n+            ChainstateRole role{ChainstateRole::NORMAL};\n+\n+            // Determine whether or not this block belongs to an assumedvalid chainstate, which\n+            // will affect block storage.\n+            if (snapshot) {\n+                const auto au_data = Assert(GetParams().AssumeutxoForBlockhash(*snapshot));\n+                role = (pindex->nHeight >= au_data->height) ?\n+                    ChainstateRole::ASSUMEDVALID : ChainstateRole::BACKGROUND;\n+            }\n+\n+            GetMainSignals().BlockChecked(role, *block, state);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": 1303337523,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good find! I'll remove this unused parameter.",
      "created_at": "2023-08-24T20:47:00Z",
      "updated_at": "2023-08-24T20:47:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1304849279",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304849279"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304849858",
      "pull_request_review_id": 1594433276,
      "id": 1304849858,
      "node_id": "PRRC_kwDOABII585Nxm3C",
      "diff_hunk": "@@ -1642,6 +1642,9 @@ bool Chainstate::IsInitialBlockDownload() const\n     }\n     LogPrintf(\"Leaving InitialBlockDownload (latching to false)\\n\");\n     m_cached_finished_ibd.store(true, std::memory_order_relaxed);\n+    // Important that this comes *after* the previous line, else we'll wind up in an\n+    // infinite recursion.\n+    m_chainman.MaybeRebalanceCaches();",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5ea9abfbac3543f2d2cef90a1528abed35623822",
      "in_reply_to_id": 1296254459,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, that's fair criticism. I've moved this potential rebalance to within `ActivateBestChain()`, which requires a little bit of extra code but is as you say much more explicit.",
      "created_at": "2023-08-24T20:47:45Z",
      "updated_at": "2023-08-24T20:47:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1304849858",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1304849858"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1647,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305702150",
      "pull_request_review_id": 1595799643,
      "id": 1305702150,
      "node_id": "PRRC_kwDOABII585N028G",
      "diff_hunk": "@@ -1901,7 +1970,10 @@ void PeerManagerImpl::BlockDisconnected(const std::shared_ptr<const CBlock> &blo\n  * Maintain state about the best-seen block and fast-announce a compact block\n  * to compatible peers.\n  */\n-void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock)\n+void PeerManagerImpl::NewPoWValidBlock(",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 136,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "253bcd5fd392f70de82ec7c675f9777d1e098d50",
      "in_reply_to_id": 1290237668,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep, makes sense. Done!",
      "created_at": "2023-08-25T14:01:32Z",
      "updated_at": "2023-08-25T14:01:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305702150",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305702150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1974,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305760028",
      "pull_request_review_id": 1595889617,
      "id": 1305760028,
      "node_id": "PRRC_kwDOABII585N1FEc",
      "diff_hunk": "@@ -185,7 +185,14 @@ ChainstateLoadResult LoadChainstate(ChainstateManager& chainman, const CacheSize\n     chainman.InitializeChainstate(options.mempool);\n \n     // Load a chain created from a UTXO snapshot, if any exist.\n-    chainman.DetectSnapshotChainstate(options.mempool);\n+    bool has_snapshot = chainman.DetectSnapshotChainstate(options.mempool);\n+\n+    if (has_snapshot && (options.reindex || options.reindex_chainstate)) {\n+        return {ChainstateLoadStatus::FAILURE_NO_REINDEX, _(\n+            \"Reindex cannot be performed while background validation is in progress. \"\n+            \"Please wait for background sync to complete, or delete data directory \"",
      "path": "src/node/chainstate.cpp",
      "position": null,
      "original_position": 10,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3b9d3d63d9ccb609ec08da34776f7c5f29d21a20",
      "in_reply_to_id": 1291426426,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Okay, good points. I've removed this error message completely and instead have implemented the behavior that the snapshot chainstate is completely removed during `-reindex{-chainstate}`. This is consistent with the spirit of the existing reindex operation, I think. The change is also about as simple as this one.",
      "created_at": "2023-08-25T14:45:34Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305760028",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305760028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305781595",
      "pull_request_review_id": 1595889617,
      "id": 1305781595,
      "node_id": "PRRC_kwDOABII585N1KVb",
      "diff_hunk": "@@ -49,4 +51,15 @@ inline V Cat(V v1, const V& v2)\n     return v1;\n }\n \n+template<typename V, typename L>\n+inline std::optional<V> FindFirst(const std::vector<V>& vec, const L fnc)",
      "path": "src/util/vector.h",
      "position": 15,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "cdb73e44b7f0d4ea186ba657ddf7809434f0a12a",
      "in_reply_to_id": 1291431562,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I went to change this and found that, surprisingly, massaging `find_if` into a `std::optional` output was actually wordier than the current approach:\r\n```diff\r\ndiff --git a/src/util/vector.h b/src/util/vector.h\r\nindex 9cd5e118a6..32d1e7f933 100644\r\n--- a/src/util/vector.h\r\n+++ b/src/util/vector.h\r\n@@ -54,12 +54,12 @@ inline V Cat(V v1, const V& v2)\r\n template<typename V, typename L>\r\n inline std::optional<V> FindFirst(const std::vector<V>& vec, const L fnc)\r\n {\r\n-    for (const auto& el : vec) {\r\n-        if (fnc(el)) {\r\n-            return el;\r\n-        }\r\n+    auto got = std::find_if(vec.begin(), vec.end(), fnc);\r\n+    if (got != vec.end()) {\r\n+        return *got;\r\n+    } else {\r\n+        return std::nullopt;\r\n     }\r\n-    return std::nullopt;\r\n }\r\n \r\n #endif // BITCOIN_UTIL_VECTOR_H\r\n```",
      "created_at": "2023-08-25T15:03:12Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305781595",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305781595"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 55,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305885944",
      "pull_request_review_id": 1595889617,
      "id": 1305885944,
      "node_id": "PRRC_kwDOABII585N1jz4",
      "diff_hunk": "@@ -173,6 +174,9 @@ void CZMQNotificationInterface::TransactionRemovedFromMempool(const CTransaction\n \n void CZMQNotificationInterface::BlockConnected(const ChainstateRole role, const std::shared_ptr<const CBlock>& pblock, const CBlockIndex* pindexConnected)\n {\n+    if (role == ChainstateRole::BACKGROUND) {",
      "path": "src/zmq/zmqnotificationinterface.cpp",
      "position": 15,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "f2a15428277090d6ad387de6d517303b9bc4e2af",
      "in_reply_to_id": 1291620032,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point, added release notes for ZMQ.",
      "created_at": "2023-08-25T16:28:30Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305885944",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305885944"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 176,
      "original_line": 176,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305946231",
      "pull_request_review_id": 1595889617,
      "id": 1305946231,
      "node_id": "PRRC_kwDOABII585N1yh3",
      "diff_hunk": "@@ -2699,6 +2699,86 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n+    SnapshotMetadata metadata;\n+    afile >> metadata;\n+\n+    uint256 base_blockhash = metadata.m_base_blockhash;\n+    int max_secs_to_wait_for_headers = 60 * 10;\n+    CBlockIndex* snapshot_start_block = nullptr;\n+\n+    LogPrintf(\"[snapshot] waiting to see blockheader %s in headers chain before snapshot activation\\n\",\n+        base_blockhash.ToString());\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    while (max_secs_to_wait_for_headers > 0) {",
      "path": "src/rpc/blockchain.cpp",
      "position": 60,
      "original_position": 42,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "8ac7427b41fdec1dbc7e06d0aa2c0e469b879ba2",
      "in_reply_to_id": 1291670706,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, agree this is weirdly implicit and am open to alternative approaches here. Since we expect headers to sync within a relatively short amount of time, I can see the utility of waiting. If anyone has strong feelings here please chime in.",
      "created_at": "2023-08-25T17:27:01Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305946231",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305946231"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2751,
      "original_line": 2751,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305947674",
      "pull_request_review_id": 1595889617,
      "id": 1305947674,
      "node_id": "PRRC_kwDOABII585N1y4a",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > nLastBlockWeCanPrune || fileinfo.nHeightFirst < min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), nLastBlockWeCanPrune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int chain_tip_height,\n+    int prune_height,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = GetPruneTarget() / chainman.GetAll().size();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9e2b8ef836aeb1dc2e4b57449fc56badebea6772",
      "in_reply_to_id": 1291649621,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah I definitely think we can be smarter about pruning, but because we do it chainstate-by-chainstate I think that better management of the prune budget between chainstates might take a little more rework. Maybe something for a follow-up?",
      "created_at": "2023-08-25T17:28:38Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305947674",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305947674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305951844",
      "pull_request_review_id": 1595889617,
      "id": 1305951844,
      "node_id": "PRRC_kwDOABII585N1z5k",
      "diff_hunk": "@@ -3178,15 +3179,16 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n             // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n             if (pindexFork != pindexNewTip) {\n                 // Notify ValidationInterface subscribers\n-                GetMainSignals().UpdatedBlockTip(pindexNewTip, pindexFork, fInitialDownload);\n-\n-                // Always notify the UI if a new block tip was connected\n-                if (kernel::IsInterrupted(m_chainman.GetNotifications().blockTip(GetSynchronizationState(fInitialDownload), *pindexNewTip))) {\n-                    // Just breaking and returning success for now. This could\n-                    // be changed to bubble up the kernel::Interrupted value to\n-                    // the caller so the caller could distinguish between\n-                    // completed and interrupted operations.\n-                    break;\n+                GetMainSignals().UpdatedBlockTip(this->GetRole(), pindexNewTip, pindexFork, fInitialDownload);\n+\n+                if (this == &m_chainman.ActiveChainstate() &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 50,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": 1303334266,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, thanks.",
      "created_at": "2023-08-25T17:32:42Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305951844",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305951844"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 3184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305965612",
      "pull_request_review_id": 1595889617,
      "id": 1305965612,
      "node_id": "PRRC_kwDOABII585N13Qs",
      "diff_hunk": "@@ -87,13 +88,13 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.\n      */\n-    virtual void UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) {}\n+    virtual void UpdatedBlockTip(const ChainstateRole, const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload) {}\n     /**\n      * Notifies listeners of a transaction having been added to mempool.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": null,
      "original_position": 21,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2856710077abbc8f07a97adfff5f6829358155be",
      "in_reply_to_id": 1303342871,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point, I think these are a vestige when mempool ownership wasn't so clear. I've removed them.",
      "created_at": "2023-08-25T17:45:09Z",
      "updated_at": "2023-08-25T18:21:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1305965612",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1305965612"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307949616",
      "pull_request_review_id": 1599109755,
      "id": 1307949616,
      "node_id": "PRRC_kwDOABII585N9bow",
      "diff_hunk": "@@ -892,6 +892,35 @@ class PeerManagerImpl final : public PeerManager\n      */\n     void FindNextBlocksToDownload(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    void TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex* from_tip, const CBlockIndex* target_block) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+    * \\brief Find next blocks to download from a peer after a starting block.\n+    *\n+    * \\param vBlocks      Vector of blocks to download which will be appended to.\n+    * \\param peer         ID of peer which blocks will be downloaded from.\n+    * \\param state        Pointer to the state of the peer.\n+    * \\param pindexWalk   Pointer to the starting block to add to vBlocks.\n+    * \\param count        Maximum number of blocks to allow in vBlocks. No more\n+    *                     blocks will be added if it reaches this size.\n+    * \\param nWindowEnd   Maximum height of blocks to allow in vBlocks. No\n+    *                     blocks will be added above this height.\n+    * \\param activeChain  Optional pointer to a chain to compare against. If\n+    *                     provided, any blocks contained by this chain will only\n+    *                     be used to update state->pindexLastCommonBlock, and\n+    *                     will not be appended to vBlocks.\n+    * \\param nodeStaller  Optional pointer to a NodeId variable that will receive\n+    *                     the ID of another peer that might be causing this peer\n+    *                     to stall. This is set to the ID of the peer which\n+    *                     first requested the first in-flight block in the\n+    *                     download window. It is only set if vBlocks is empty at\n+    *                     the end of this function call and if increasing\n+    *                     nWindowEnd by 1 would have caused it to be non-empty\n+    *                     (which indicates the download might be stalled since\n+    *                     every block in the window is in flight.)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: Request assumeutxo background chain blocks\" (08a34e56ba7aa8714982d352238f1cb6eba43e29)\r\n\r\nSuggested comment updates to clarify effect of passing `activeChain` and better describe what it means for a `nodeStaller` value to be returned:\r\n\r\n```diff\r\n--- a/src/net_processing.cpp\r\n+++ b/src/net_processing.cpp\r\n@@ -906,18 +906,20 @@ private:\r\n     * \\param nWindowEnd   Maximum height of blocks to allow in vBlocks. No\r\n     *                     blocks will be added above this height.\r\n     * \\param activeChain  Optional pointer to a chain to compare against. If\r\n-    *                     provided, any blocks contained by this chain will only\r\n-    *                     be used to update state->pindexLastCommonBlock, and\r\n-    *                     will not be appended to vBlocks.\r\n+    *                     provided, any next blocks which are already contained\r\n+    *                     in this chain will not be appended to vBlocks, but\r\n+    *                     instead will be used to update the\r\n+    *                     state->pindexLastCommonBlock pointer.\r\n     * \\param nodeStaller  Optional pointer to a NodeId variable that will receive\r\n     *                     the ID of another peer that might be causing this peer\r\n     *                     to stall. This is set to the ID of the peer which\r\n     *                     first requested the first in-flight block in the\r\n     *                     download window. It is only set if vBlocks is empty at\r\n     *                     the end of this function call and if increasing\r\n-    *                     nWindowEnd by 1 would have caused it to be non-empty\r\n-    *                     (which indicates the download might be stalled since\r\n-    *                     every block in the window is in flight.)\r\n+    *                     nWindowEnd by 1 would cause it to be non-empty (which\r\n+    *                     indicates the download might be stalled because every\r\n+    *                     block in the window is in flight and no other peer is\r\n+    *                     trying to download the next block).\r\n     */\r\n     void FindNextBlocks(std::vector<const CBlockIndex*>& vBlocks, const Peer& peer, CNodeState *state, const CBlockIndex *pindexWalk, unsigned int count, int nWindowEnd, const CChain* activeChain=nullptr, NodeId* nodeStaller=nullptr) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n \r\n```",
      "created_at": "2023-08-28T21:04:29Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307949616",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307949616"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 920,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307955088",
      "pull_request_review_id": 1599109755,
      "id": 1307955088,
      "node_id": "PRRC_kwDOABII585N9c-Q",
      "diff_hunk": "@@ -1406,6 +1409,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)\n+{\n+    if (vBlocks.size() >= count) {\n+        return;\n+    }\n+\n+    vBlocks.reserve(count);\n+    CNodeState *state = State(peer.m_id);\n+    assert(state != nullptr);\n+\n+    if (state->pindexBestKnownBlock == nullptr || state->pindexBestKnownBlock->GetAncestor(target_block->nHeight) != target_block) {\n+        // This peer is useless to us -- it has a chain that doesn't contain",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b",
      "in_reply_to_id": 1294879351,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1294879351\r\n\r\n> This is an exaggeration, right?\r\n\r\nIn commit \"net_processing: Request assumeutxo background chain blocks\" (08a34e56ba7aa8714982d352238f1cb6eba43e29)\r\n\r\nStill curious about this and think it would be good to either explain it more, or change the behavior, or just s/useless/less useful/ if that would be more accurate to avoid confusion.",
      "created_at": "2023-08-28T21:11:24Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307955088",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307955088"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307957163",
      "pull_request_review_id": 1599109755,
      "id": 1307957163,
      "node_id": "PRRC_kwDOABII585N9der",
      "diff_hunk": "@@ -1036,12 +1033,25 @@ class ChainstateManager\n     //! Otherwise, revert to using the ibd chainstate and shutdown.\n     SnapshotCompletionResult MaybeCompleteSnapshotValidation() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Returns nullptr if no snapshot has been loaded.\n+    const CBlockIndex* GetSnapshotBaseBlock() const EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/validation.h",
      "position": 51,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: Request assumeutxo background chain blocks\" (08a34e56ba7aa8714982d352238f1cb6eba43e29)\r\n\r\nAny reason these two lines are moving? This change seems like it have been accidentally added in a rebase. Would probably be good to revert.",
      "created_at": "2023-08-28T21:14:12Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307957163",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307957163"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1044,
      "original_line": 1044,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307968803",
      "pull_request_review_id": 1599109755,
      "id": 1307968803,
      "node_id": "PRRC_kwDOABII585N9gUj",
      "diff_hunk": "@@ -4070,6 +4070,11 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n     }\n+    BlockValidationState background_sync_state;\n+    if (WITH_LOCK(::cs_main, return BackgroundSyncInProgress()) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: Request assumeutxo background chain blocks\" (08a34e56ba7aa8714982d352238f1cb6eba43e29)\r\n\r\n`background_sync_state` variable is not actually referenced below, and code which locks and unlocks cs_main twice seems potentially racy. Would suggest cleaning this up with:\r\n\r\n```diff\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -4070,10 +4070,11 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\r\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\r\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\r\n     }\r\n-    BlockValidationState background_sync_state;\r\n-    if (WITH_LOCK(::cs_main, return BackgroundSyncInProgress()) &&\r\n-            !WITH_LOCK(::cs_main, return *m_ibd_chainstate).ActivateBestChain(state, block)) {\r\n-        return error(\"%s: [background] ActivateBestChain failed (%s)\", __func__, state.ToString());\r\n+\r\n+    Chainstate* bg_chain{WITH_LOCK(cs_main, return BackgroundSyncInProgress() ? m_ibd_chainstate.get() : nullptr)};\r\n+    BlockValidationState bg_state;\r\n+    if (bg_chain && !bg_chain->ActivateBestChain(bg_state, block)) {\r\n+        return error(\"%s: [background] ActivateBestChain failed (%s)\", __func__, bg_state.ToString());\r\n     }\r\n \r\n     return true;\r\n```",
      "created_at": "2023-08-28T21:24:09Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307968803",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307968803"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307984332",
      "pull_request_review_id": 1599109755,
      "id": 1307984332,
      "node_id": "PRRC_kwDOABII585N9kHM",
      "diff_hunk": "@@ -5831,6 +5889,14 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             std::vector<const CBlockIndex*> vToDownload;\n             NodeId staller = -1;\n             FindNextBlocksToDownload(*peer, MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(), vToDownload, staller);\n+            if (m_chainman.BackgroundSyncInProgress() && !IsLimitedPeer(*peer)) {\n+                const CBlockIndex *target = m_chainman.GetSnapshotBaseBlock();\n+                if (target != nullptr) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 112,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: Request assumeutxo background chain blocks\" (08a34e56ba7aa8714982d352238f1cb6eba43e29)\r\n\r\nIt seems impossible that target could be nullptr here if condition above is true and cs_main is held. Would be clearer to just `assert(target)` rather than checking for this condition which should be impossible. Or if this is actually expected would be good to add a comment saying when target may be null.",
      "created_at": "2023-08-28T21:35:54Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307984332",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307984332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5894,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307996274",
      "pull_request_review_id": 1599109755,
      "id": 1307996274,
      "node_id": "PRRC_kwDOABII585N9nBy",
      "diff_hunk": "@@ -5712,6 +5717,18 @@ util::Result<void> Chainstate::InvalidateCoinsDBOnDisk()\n     return {};\n }\n \n+void ChainstateManager::DeleteSnapshotChainstate()\n+{\n+    AssertLockHeld(::cs_main);\n+    Assert(m_snapshot_chainstate);\n+    Assert(m_ibd_chainstate);\n+\n+    fs::path snapshot_datadir = GetSnapshotCoinsDBPath(*m_snapshot_chainstate);\n+    DeleteCoinsDBFromDisk(snapshot_datadir, /*is_snapshot=*/ true);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1755c53365d53693213a721138a44bdd889d8794",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"assumeutxo: remove snapshot during -reindex{-chainstate}\" (1755c53365d53693213a721138a44bdd889d8794)\r\n\r\nReturn value from this delete is being ignored. I think DeleteSnapshotChainstate should return a bool and return false if this fails. It would also be good to mark both functions [[nodiscard]] and exit with InitError if the DeleteSnapshotChainstate call fails. I don't think it makes sense to ignore the failure and do a partial reindexing of the background chain only.",
      "created_at": "2023-08-28T21:52:22Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1307996274",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1307996274"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5727,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308014826",
      "pull_request_review_id": 1599109755,
      "id": 1308014826,
      "node_id": "PRRC_kwDOABII585N9rjq",
      "diff_hunk": "@@ -3195,6 +3202,11 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        if (exited_ibd) {\n+            LOCK(::cs_main);\n+            m_chainman.MaybeRebalanceCaches();",
      "path": "src/validation.cpp",
      "position": 110,
      "original_position": 47,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3e7d3537fc06c8aff8a48edc8f179a70af46e04c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: MaybeRebalanceCaches when chain leaves IBD\" (3e7d3537fc06c8aff8a48edc8f179a70af46e04c)\r\n\r\nI think it would be helpful to have a reminder about why this is necessary, maybe \"// Call MaybeRebalanceCaches in case background and snapshot chainstates both exist, and the snapshot chainstate is almost finished downloading blocks, so more resources can be shifted to the background download.\"",
      "created_at": "2023-08-28T22:21:44Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308014826",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308014826"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3214,
      "original_line": 3214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308025208",
      "pull_request_review_id": 1599109755,
      "id": 1308025208,
      "node_id": "PRRC_kwDOABII585N9uF4",
      "diff_hunk": "@@ -5729,6 +5729,16 @@ void ChainstateManager::DeleteSnapshotChainstate()\n     m_snapshot_chainstate.reset();\n }\n \n+ChainstateRole Chainstate::GetRole() const",
      "path": "src/validation.cpp",
      "position": 327,
      "original_position": 4,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "95f45e38b5e47eaef56468909d04418b93e9c962",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: add ChainstateRole\" (95f45e38b5e47eaef56468909d04418b93e9c962)\r\n\r\nI don't have a specific suggestion here, just an observation that this method seems like it is called from multiple threads but it doesn't require cs_main. So potentially there could be a race condition where a snapshot is loaded during this call, or validated during this call and it returns a stale value. I think this is not a new issue, since returning stale values also seems to be characteristic of the existing `GetAll()` and `ActiveChainstate()` methods. But in the long term it would probably be better if all of these methods were marked `EXCLUSIVE_LOCKS_REQUIRED(cs_main)` and stopped acquiring `cs_main` internally so they could not return stale values and create potential race conditions.",
      "created_at": "2023-08-28T22:38:42Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308025208",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308025208"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5778,
      "original_line": 5778,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308029027",
      "pull_request_review_id": 1599109755,
      "id": 1308029027,
      "node_id": "PRRC_kwDOABII585N9vBj",
      "diff_hunk": "@@ -3186,7 +3186,7 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n \n             // Notify external listeners about the new tip.\n             // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n-            if (pindexFork != pindexNewTip) {\n+            if (this == &m_chainman.ActiveChainstate() && pindexFork != pindexNewTip) {",
      "path": "src/validation.cpp",
      "position": 91,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9eda8224119450b8614837e0c8decfc81a6b9915",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: only call UpdatedBlockTip for active chainstate\" (9eda8224119450b8614837e0c8decfc81a6b9915)\r\n\r\nCould update commit message to mention that in addition to skipping `CValidationInterface::UpdatedBlockTip` notifications for the background chainstate, it also skips `kernel::Notifications::blockTip` notifications.",
      "created_at": "2023-08-28T22:45:57Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308029027",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308029027"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3194,
      "original_line": 3194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308031241",
      "pull_request_review_id": 1599109755,
      "id": 1308031241,
      "node_id": "PRRC_kwDOABII585N9vkJ",
      "diff_hunk": "@@ -19,7 +19,11 @@ struct TestChainstateManager : public ChainstateManager {\n class ValidationInterfaceTest\n {\n public:\n-    static void BlockConnected(CValidationInterface& obj, const std::shared_ptr<const CBlock>& block, const CBlockIndex* pindex);\n+    static void BlockConnected(\n+        const ChainstateRole role,\n+        CValidationInterface& obj,",
      "path": "src/test/util/validation.h",
      "position": null,
      "original_position": 7,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2873d91ada1c240de280a35bbf169ed0c708e057)\r\n\r\nArgument order here is a little weird. It would make more sense for it to be `obj, role` rather than `role, obj` so the object is still first and so `role` is right before `block` just like everywhere else.",
      "created_at": "2023-08-28T22:50:05Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308031241",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308031241"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 23,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308032026",
      "pull_request_review_id": 1599109755,
      "id": 1308032026,
      "node_id": "PRRC_kwDOABII585N9vwa",
      "diff_hunk": "@@ -87,7 +88,7 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2873d91ada1c240de280a35bbf169ed0c708e057)\r\n\r\nWould make more sense to update this comment in the previous commit \"validation: only call UpdatedBlockTip for active chainstate\" (9eda8224119450b8614837e0c8decfc81a6b9915) instead of this commit.\r\n",
      "created_at": "2023-08-28T22:51:43Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308032026",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308032026"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308039060",
      "pull_request_review_id": 1599109755,
      "id": 1308039060,
      "node_id": "PRRC_kwDOABII585N9xeU",
      "diff_hunk": "@@ -199,11 +205,11 @@ class CMainSignals {\n     void UpdatedBlockTip(const CBlockIndex *, const CBlockIndex *, bool fInitialDownload);\n     void TransactionAddedToMempool(const CTransactionRef&, uint64_t mempool_sequence);\n     void TransactionRemovedFromMempool(const CTransactionRef&, MemPoolRemovalReason, uint64_t mempool_sequence);\n-    void BlockConnected(const std::shared_ptr<const CBlock> &, const CBlockIndex *pindex);\n+    void BlockConnected(const ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *pindex);",
      "path": "src/validationinterface.h",
      "position": null,
      "original_position": 64,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pass ChainstateRole for validationinterface calls\" (2873d91ada1c240de280a35bbf169ed0c708e057)\r\n\r\nIgnore this comment if this was intentional, but it seems unusual to make the `ChainstateRole` parameter const, when the codebase doesn't use const value parameters in general or in this interface for other parameters like `MemPoolRemovalReason`. IMO the `const` just adds noise without being more safe, and makes the method less convenient to implement. But not a problem if this is just a style difference and was intended.",
      "created_at": "2023-08-28T23:05:30Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308039060",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308039060"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308042767",
      "pull_request_review_id": 1599109755,
      "id": 1308042767,
      "node_id": "PRRC_kwDOABII585N9yYP",
      "diff_hunk": "@@ -0,0 +1,7 @@\n+ZMQ",
      "path": "doc/release-notes-27596.md",
      "position": null,
      "original_position": 1,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b48729144fba1dbc64d603b2644a76c3f00d44eb",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validationinterface: only send zmq notifications for active\" (b48729144fba1dbc64d603b2644a76c3f00d44eb)\r\n\r\nI'm surprised to see this release note. It seems like no observable behavior change could be happening with this PR because it wasn't possible to load a snapshot previously. If this is the case, I think putting this information in release notes could only be confusing and it would be better to document this behavior in `doc/zmq.md` instead",
      "created_at": "2023-08-28T23:13:14Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308042767",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308042767"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308047801",
      "pull_request_review_id": 1599109755,
      "id": 1308047801,
      "node_id": "PRRC_kwDOABII585N9zm5",
      "diff_hunk": "@@ -144,7 +144,8 @@ void TryForEachAndRemoveFailed(std::list<std::unique_ptr<CZMQAbstractNotifier>>&\n \n void CZMQNotificationInterface::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload)\n {\n-    if (fInitialDownload || pindexNew == pindexFork) // In IBD or blocks were disconnected without any new ones\n+    // In IBD or blocks were disconnected without any new ones\n+    if (fInitialDownload || pindexNew == pindexFork)",
      "path": "src/zmq/zmqnotificationinterface.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b48729144fba1dbc64d603b2644a76c3f00d44eb",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validationinterface: only send zmq notifications for active\" (b48729144fba1dbc64d603b2644a76c3f00d44eb)\r\n\r\nThis seems like no-op change that could be reverted. Or if this is supposed to be a style cleanup, would probably make sense to add {} and modernize it since the line is changing anyway.",
      "created_at": "2023-08-28T23:22:33Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308047801",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308047801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308053648",
      "pull_request_review_id": 1599109755,
      "id": 1308053648,
      "node_id": "PRRC_kwDOABII585N91CQ",
      "diff_hunk": "@@ -909,6 +910,8 @@ class ChainstateManager\n \n     explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n \n+    std::vector<BaseIndex*> indexers{};",
      "path": "src/validation.h",
      "position": null,
      "original_position": 12,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "688b68f34fe061c3064a516cdf77d4c155bfcafd",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"index: cache indexer references on ChainstateManager\" (688b68f34fe061c3064a516cdf77d4c155bfcafd)\r\n\r\nHaven't reviewed later commits yet, but it seems not ideal for ChainstateManager to be aware of indexes. I think it would might be better to add a new ValidationInterface method that indexes (and wallets) could handle to start resyncing themselves whenever the background download finishes. \r\n\r\nMinor: Since this is a member, should be prefixed with `m_`. Also would be good to `s/indexer/index/` everywhere for consistency with `NodeContext::indexes and other index variables. (In general I think \"index\" sounds better than \"indexer\" and \"indexing\" sounds better than \"indexation\" to stick to more common terms.)\r\n\r\n",
      "created_at": "2023-08-28T23:35:37Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308053648",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308053648"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 913,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308066452",
      "pull_request_review_id": 1599109755,
      "id": 1308066452,
      "node_id": "PRRC_kwDOABII585N94KU",
      "diff_hunk": "@@ -1473,6 +1473,26 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.chainman = std::make_unique<ChainstateManager>(node.kernel->interrupt, chainman_opts, blockman_opts);\n         ChainstateManager& chainman = *node.chainman;\n \n+        // This is defined and set here instead of inline in validation.h to avoid a hard\n+        // dependency between validation and index/base, since the latter is not in\n+        // libbitcoinkernel.\n+        chainman.restart_indexers = [](const ChainstateManager& chainman) {\n+            LogPrintf(\"[snapshot] restarting indexers\\n\");\n+\n+            // Drain the validation interface queue to ensure that the old indexers\n+            // don't have any pending work.\n+            SyncWithValidationInterfaceQueue();\n+\n+            for (auto* indexer : chainman.indexers) {",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: validationinterface: ignore some events for bg chain\" (5d096add65e84530c907b5ee934af144067d5ef1)\r\n\r\nThis could probably loop over `node.indexes` instead of `chainman.indexers` and then the `chainman.indexers` variable could be eliminated.",
      "created_at": "2023-08-29T00:04:25Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308066452",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308066452"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308066973",
      "pull_request_review_id": 1599109755,
      "id": 1308066973,
      "node_id": "PRRC_kwDOABII585N94Sd",
      "diff_hunk": "@@ -1473,6 +1473,26 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.chainman = std::make_unique<ChainstateManager>(node.kernel->interrupt, chainman_opts, blockman_opts);\n         ChainstateManager& chainman = *node.chainman;\n \n+        // This is defined and set here instead of inline in validation.h to avoid a hard\n+        // dependency between validation and index/base, since the latter is not in\n+        // libbitcoinkernel.\n+        chainman.restart_indexers = [](const ChainstateManager& chainman) {\n+            LogPrintf(\"[snapshot] restarting indexers\\n\");",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: validationinterface: ignore some events for bg chain\" (5d096add65e84530c907b5ee934af144067d5ef1)\r\n\r\nWould be nice to s/indexers/indexes/, s/indexer/s/index/ /s/indexation/indexing/ everywhere.",
      "created_at": "2023-08-29T00:05:37Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308066973",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308066973"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308070723",
      "pull_request_review_id": 1599109755,
      "id": 1308070723,
      "node_id": "PRRC_kwDOABII585N95ND",
      "diff_hunk": "@@ -911,6 +911,10 @@ class ChainstateManager\n     explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n \n     std::vector<BaseIndex*> indexers{};\n+    //! Function to restart active indexers; set dynamically to avoid a circular\n+    //! dependency on `base/index.cpp`.\n+    std::function<void(const ChainstateManager&)> restart_indexers =",
      "path": "src/validation.h",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: validationinterface: ignore some events for bg chain\" (5d096add65e84530c907b5ee934af144067d5ef1)\r\n\r\nWould suggest simplifying function type to `std::function<void()>` because handler should be able to determine what state is needs to run and capture it explicitly. Also the reference might be unnecessary if the m_indexers variable is removed as suggested.",
      "created_at": "2023-08-29T00:13:48Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308070723",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308070723"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 916,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308071774",
      "pull_request_review_id": 1599109755,
      "id": 1308071774,
      "node_id": "PRRC_kwDOABII585N95de",
      "diff_hunk": "@@ -5838,3 +5848,9 @@ bool ChainstateManager::ValidatedSnapshotCleanup()\n     }\n     return true;\n }\n+\n+Chainstate& ChainstateManager::GetChainstateForIndexing()\n+{\n+    return (IsSnapshotActive() && !IsSnapshotValidated()) ?",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: validationinterface: ignore some events for bg chain\" (5d096add65e84530c907b5ee934af144067d5ef1)\r\n\r\nI'm surprised this method can't just return `m_ibd_chainstate.get()`. It would be good to simplify this code if possible or else add some explanation for the logic, which seems pretty complicated.",
      "created_at": "2023-08-29T00:16:15Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308071774",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308071774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5854,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308075373",
      "pull_request_review_id": 1599109755,
      "id": 1308075373,
      "node_id": "PRRC_kwDOABII585N96Vt",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {\n+        std::optional<int> snapshot_height{GetSnapshotBaseHeight()};",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 44,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nI think it would be good `assert(snapshot_height)` or else add a comment saying when `snapshot_height` is expected to be `nullopt`, rather than write code that seems like it is trying to handle an impossible condition.",
      "created_at": "2023-08-29T00:25:06Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308075373",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308075373"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5876,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308076179",
      "pull_request_review_id": 1599109755,
      "id": 1308076179,
      "node_id": "PRRC_kwDOABII585N96iT",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nSeems like the code would be a little simpler if this said `if (this->GetAll().size() > 1 && &chainstate == m_snapshot_chainstate.get())` so relevant conditions would be stated up front, and nested if statement below could go away",
      "created_at": "2023-08-29T00:26:50Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308076179",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308076179"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5875,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308082844",
      "pull_request_review_id": 1599109755,
      "id": 1308082844,
      "node_id": "PRRC_kwDOABII585N98Kc",
      "diff_hunk": "@@ -1248,6 +1244,17 @@ class ChainstateManager\n     //!   fully validated chain.\n     Chainstate& GetChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Return the [start, end] (inclusive) of block heights we can prune.\n+    //!\n+    //! If we're pruning the snapshot chainstate, be sure not to\n+    //! prune blocks being used by the background chainstate.\n+    std::pair<unsigned int, unsigned int> GetPruneRange(",
      "path": "src/validation.h",
      "position": null,
      "original_position": 19,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nWould definitely suggest using plain `int` instead of `unsigned int` for heights everywhere to avoid overflow bugs and extra type casts. The rest of the code represents block heights with ints, and unsigned types are great for representing bits but less great at representing quantities you would like to perform arithmetic on.",
      "created_at": "2023-08-29T00:42:46Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308082844",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308082844"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1251,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308085308",
      "pull_request_review_id": 1599109755,
      "id": 1308085308,
      "node_id": "PRRC_kwDOABII585N98w8",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};",
      "path": "src/validation.cpp",
      "position": 356,
      "original_position": 39,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"net_processing: validationinterface: ignore some events for bg chain\" (5d096add65e84530c907b5ee934af144067d5ef1)\r\n\r\nProbably doesn't matter in practice, but according to the function documentation, this would indicate the pruning range includes the genesis block. Would suggest returning `{1, 0}` here and also initializing `prune_start` to 1 instead of 0 below.",
      "created_at": "2023-08-29T00:48:47Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308085308",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308085308"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5897,
      "original_line": 5897,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308096895",
      "pull_request_review_id": 1599109755,
      "id": 1308096895,
      "node_id": "PRRC_kwDOABII585N9_l_",
      "diff_hunk": "@@ -2474,11 +2475,19 @@ bool Chainstate::FlushStateToDisk(\n             if (nManualPruneHeight > 0) {\n                 LOG_TIME_MILLIS_WITH_CATEGORY(\"find files to prune (manual)\", BCLog::BENCH);\n \n-                m_blockman.FindFilesToPruneManual(setFilesToPrune, std::min(last_prune, nManualPruneHeight), m_chain.Height());\n+                m_blockman.FindFilesToPruneManual(\n+                    setFilesToPrune,\n+                    std::min(last_prune, nManualPruneHeight),\n+                    m_chain.Height(),",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nNo reason to pass `m_chain.Height()` here anymore now this is passing `*this` chainstate reference. Having the redundant parameter makes code in the function more complicated and hard to follow because there are multiple variables referring to the same height.",
      "created_at": "2023-08-29T01:16:55Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308096895",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308096895"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308104549",
      "pull_request_review_id": 1599109755,
      "id": 1308104549,
      "node_id": "PRRC_kwDOABII585N-Bdl",
      "diff_hunk": "@@ -122,7 +128,13 @@ class BlockManager\n      *\n      * @param[out]   setFilesToPrune   The set of file indices that can be unlinked will be returned\n      */\n-    void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd);\n+    void FindFilesToPrune(\n+        std::set<int>& setFilesToPrune,\n+        uint64_t nPruneAfterHeight,\n+        int chain_tip_height,\n+        int prune_height,",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 31,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nSame as earlier comment, but again it is confusing to keep this `chain_tip_height` parameter which is redundant with the `chain` parameter and makes the implementation more complicated because there are multiple variables referring to the same height.\r\n\r\nAlso would suggest calling the `prune_height` parameter `last_prune` to be be more descriptive, and consistent with the argument that is passed in validation.cpp. Also could add documentation for the parameter as \"the last height we can prune\" or something similar.",
      "created_at": "2023-08-29T01:31:48Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308104549",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308104549"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 134,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 135,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308108294",
      "pull_request_review_id": 1599109755,
      "id": 1308108294,
      "node_id": "PRRC_kwDOABII585N-CYG",
      "diff_hunk": "@@ -1248,6 +1244,17 @@ class ChainstateManager\n     //!   fully validated chain.\n     Chainstate& GetChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Return the [start, end] (inclusive) of block heights we can prune.",
      "path": "src/validation.h",
      "position": 102,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nWould be good to say that `start > end` is possible and indicates prune range is empty.",
      "created_at": "2023-08-29T01:40:36Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308108294",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308108294"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308114692",
      "pull_request_review_id": 1599109755,
      "id": 1308114692,
      "node_id": "PRRC_kwDOABII585N-D8E",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > nLastBlockWeCanPrune || fileinfo.nHeightFirst < min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), nLastBlockWeCanPrune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int chain_tip_height,\n+    int prune_height,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = GetPruneTarget() / chainman.GetAll().size();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9e2b8ef836aeb1dc2e4b57449fc56badebea6772",
      "in_reply_to_id": 1291649621,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nI think if you divide by 2 you also need to take max with MIN_DISK_SPACE_FOR_BLOCK_FILES to avoid going below the minimum supported pruning size.\r\n\r\nMaybe the easiest and most conservative thing to do for now would just be to keep the pruning target the same and just write documentation that says if you load a snapshot, you may temporarily need twice as much disk space as otherwise,",
      "created_at": "2023-08-29T01:55:59Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308114692",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308114692"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308119179",
      "pull_request_review_id": 1599109755,
      "id": 1308119179,
      "node_id": "PRRC_kwDOABII585N-FCL",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nCode would be simpler if this line were dropped and `nManualPruneHeight` was passed as the parameter to `GetPruneRange` above instead of `chain_tip_height`. Passing `chain_tip_height` above has no effect because `GetPruneRange` already takes the min with the `chain.m_chain.Height()`.",
      "created_at": "2023-08-29T02:07:57Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308119179",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308119179"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308128467",
      "pull_request_review_id": 1599109755,
      "id": 1308128467,
      "node_id": "PRRC_kwDOABII585N-HTT",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {\n+        std::optional<int> snapshot_height{GetSnapshotBaseHeight()};\n+\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        if (&chainstate == m_snapshot_chainstate.get() && snapshot_height) {\n+            prune_start = *snapshot_height + 1;\n+        }\n+    }\n+\n+    unsigned int prune_end{0};\n+    unsigned int chain_height{static_cast<unsigned int>(chainstate.m_chain.Height())};\n+\n+    if (MIN_BLOCKS_TO_KEEP > chain_height) {\n+        // Prevent underflow.\n+        prune_end = 0;\n+    } else {\n+        // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n+        //\n+        // While you might be tempted to prune the background chainstate more\n+        // aggressively (i.e. fewer MIN_BLOCKS_TO_KEEP), this won't work with index\n+        // building - specifically blockfilterindex requires undo data, and if\n+        // we don't maintain this trailing window, we hit indexation failures.\n+        prune_end = std::min(prune_height, chain_height - MIN_BLOCKS_TO_KEEP);\n+    }",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (b9ac4f7925e2d9dec67be06fdc2a381532581136)\r\n\r\nWould suggest compressing this all down to:\r\n\r\n```c++\r\n// Set the end of the prune range to the maximum height which is at least\r\n// MIN_BLOCKS_TO_KEEP blocks away from the chain tip, and is not higher than the\r\n// highest block that is allowed to be pruned according to the caller.\r\nprune_end = std::min(std::max<int>(0, chain_height - MIN_BLOCKS_TO_KEEP), last_prune);\r\n```\r\n\r\nAssuming `prune_height` is renamed back to `last_prune` as suggested earlier and made into an int.",
      "created_at": "2023-08-29T02:29:53Z",
      "updated_at": "2023-08-29T02:48:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308128467",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308128467"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 5888,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 5899,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308540550",
      "pull_request_review_id": 1600003600,
      "id": 1308540550,
      "node_id": "PRRC_kwDOABII585N_r6G",
      "diff_hunk": "@@ -4070,6 +4070,11 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n     }\n+    BlockValidationState background_sync_state;\n+    if (WITH_LOCK(::cs_main, return BackgroundSyncInProgress()) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307968803,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": ">seems potentially racy\r\n\r\nHow so?",
      "created_at": "2023-08-29T10:13:04Z",
      "updated_at": "2023-08-29T10:13:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308540550",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308540550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308696215",
      "pull_request_review_id": 1600221022,
      "id": 1308696215,
      "node_id": "PRRC_kwDOABII585OAR6X",
      "diff_hunk": "@@ -4070,6 +4070,11 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n     }\n+    BlockValidationState background_sync_state;\n+    if (WITH_LOCK(::cs_main, return BackgroundSyncInProgress()) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307968803,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> > seems potentially racy\r\n> \r\n> How so?\r\n\r\nI don't think there is a real race condition here because if stale a BackgroundSyncInProgress value were used, it wouldn't cause any harm. By \"potentially racy\" I just meant that any time I see a mutex being unlocked and immediately relocked I have to turn on the part of my brain that thinks about race conditions, so it's nicer to use one lock than worry about what state can change in the gap between locks.",
      "created_at": "2023-08-29T11:49:09Z",
      "updated_at": "2023-08-29T11:49:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1308696215",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1308696215"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309104196",
      "pull_request_review_id": 1600876009,
      "id": 1309104196,
      "node_id": "PRRC_kwDOABII585OB1hE",
      "diff_hunk": "@@ -1036,12 +1033,25 @@ class ChainstateManager\n     //! Otherwise, revert to using the ibd chainstate and shutdown.\n     SnapshotCompletionResult MaybeCompleteSnapshotValidation() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Returns nullptr if no snapshot has been loaded.\n+    const CBlockIndex* GetSnapshotBaseBlock() const EXCLUSIVE_LOCKS_REQUIRED(::cs_main);",
      "path": "src/validation.h",
      "position": 51,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307957163,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep - this method now must be public to be made use of in [`PeerManagerImpl::SendMessages()`](https://github.com/bitcoin/bitcoin/commit/08a34e56ba7aa8714982d352238f1cb6eba43e29#diff-6875de769e90cec84d2e8a9c1b962cdbcda44d870d42e4215827e599e11e90e3R5893) (which was a refactoring from the commit you offered in an earlier review - the content of this function had been reproduced).",
      "created_at": "2023-08-29T16:47:21Z",
      "updated_at": "2023-08-29T16:47:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309104196",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309104196"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1044,
      "original_line": 1044,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309108048",
      "pull_request_review_id": 1600882627,
      "id": 1309108048,
      "node_id": "PRRC_kwDOABII585OB2dQ",
      "diff_hunk": "@@ -892,6 +892,35 @@ class PeerManagerImpl final : public PeerManager\n      */\n     void FindNextBlocksToDownload(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, NodeId& nodeStaller) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n+    void TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex* from_tip, const CBlockIndex* target_block) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n+\n+    /**\n+    * \\brief Find next blocks to download from a peer after a starting block.\n+    *\n+    * \\param vBlocks      Vector of blocks to download which will be appended to.\n+    * \\param peer         ID of peer which blocks will be downloaded from.\n+    * \\param state        Pointer to the state of the peer.\n+    * \\param pindexWalk   Pointer to the starting block to add to vBlocks.\n+    * \\param count        Maximum number of blocks to allow in vBlocks. No more\n+    *                     blocks will be added if it reaches this size.\n+    * \\param nWindowEnd   Maximum height of blocks to allow in vBlocks. No\n+    *                     blocks will be added above this height.\n+    * \\param activeChain  Optional pointer to a chain to compare against. If\n+    *                     provided, any blocks contained by this chain will only\n+    *                     be used to update state->pindexLastCommonBlock, and\n+    *                     will not be appended to vBlocks.\n+    * \\param nodeStaller  Optional pointer to a NodeId variable that will receive\n+    *                     the ID of another peer that might be causing this peer\n+    *                     to stall. This is set to the ID of the peer which\n+    *                     first requested the first in-flight block in the\n+    *                     download window. It is only set if vBlocks is empty at\n+    *                     the end of this function call and if increasing\n+    *                     nWindowEnd by 1 would have caused it to be non-empty\n+    *                     (which indicates the download might be stalled since\n+    *                     every block in the window is in flight.)",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 29,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307949616,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, thanks.",
      "created_at": "2023-08-29T16:50:42Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309108048",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309108048"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 920,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309115860",
      "pull_request_review_id": 1600882627,
      "id": 1309115860,
      "node_id": "PRRC_kwDOABII585OB4XU",
      "diff_hunk": "@@ -1406,6 +1409,62 @@ void PeerManagerImpl::FindNextBlocksToDownload(const Peer& peer, unsigned int co\n     }\n }\n \n+void PeerManagerImpl::TryDownloadingHistoricalBlocks(const Peer& peer, unsigned int count, std::vector<const CBlockIndex*>& vBlocks, const CBlockIndex *from_tip, const CBlockIndex* target_block)\n+{\n+    if (vBlocks.size() >= count) {\n+        return;\n+    }\n+\n+    vBlocks.reserve(count);\n+    CNodeState *state = State(peer.m_id);\n+    assert(state != nullptr);\n+\n+    if (state->pindexBestKnownBlock == nullptr || state->pindexBestKnownBlock->GetAncestor(target_block->nHeight) != target_block) {\n+        // This peer is useless to us -- it has a chain that doesn't contain",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "6be9fd22ee2b9759cdd30a7bca4d07a9346eb57b",
      "in_reply_to_id": 1294879351,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've rephrased the comment and added a note about potentially requesting partial subset of blocks in the future.",
      "created_at": "2023-08-29T16:57:46Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309115860",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309115860"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1395,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309121965",
      "pull_request_review_id": 1600882627,
      "id": 1309121965,
      "node_id": "PRRC_kwDOABII585OB52t",
      "diff_hunk": "@@ -5831,6 +5889,14 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             std::vector<const CBlockIndex*> vToDownload;\n             NodeId staller = -1;\n             FindNextBlocksToDownload(*peer, MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(), vToDownload, staller);\n+            if (m_chainman.BackgroundSyncInProgress() && !IsLimitedPeer(*peer)) {\n+                const CBlockIndex *target = m_chainman.GetSnapshotBaseBlock();\n+                if (target != nullptr) {",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 112,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307984332,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sounds good, since we've ensured that the snapshot base block index exists prior to snapshot activation (`PopulateAndValidateSnapshot()`).",
      "created_at": "2023-08-29T17:03:31Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309121965",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309121965"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5894,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309141159",
      "pull_request_review_id": 1600882627,
      "id": 1309141159,
      "node_id": "PRRC_kwDOABII585OB-in",
      "diff_hunk": "@@ -4070,6 +4070,11 @@ bool ChainstateManager::ProcessNewBlock(const std::shared_ptr<const CBlock>& blo\n     if (!ActiveChainstate().ActivateBestChain(state, block)) {\n         return error(\"%s: ActivateBestChain failed (%s)\", __func__, state.ToString());\n     }\n+    BlockValidationState background_sync_state;\n+    if (WITH_LOCK(::cs_main, return BackgroundSyncInProgress()) &&",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "08a34e56ba7aa8714982d352238f1cb6eba43e29",
      "in_reply_to_id": 1307968803,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point and thanks for the suggestion; took your diff.",
      "created_at": "2023-08-29T17:21:56Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309141159",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309141159"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309155137",
      "pull_request_review_id": 1600882627,
      "id": 1309155137,
      "node_id": "PRRC_kwDOABII585OCB9B",
      "diff_hunk": "@@ -5712,6 +5717,18 @@ util::Result<void> Chainstate::InvalidateCoinsDBOnDisk()\n     return {};\n }\n \n+void ChainstateManager::DeleteSnapshotChainstate()\n+{\n+    AssertLockHeld(::cs_main);\n+    Assert(m_snapshot_chainstate);\n+    Assert(m_ibd_chainstate);\n+\n+    fs::path snapshot_datadir = GetSnapshotCoinsDBPath(*m_snapshot_chainstate);\n+    DeleteCoinsDBFromDisk(snapshot_datadir, /*is_snapshot=*/ true);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 36,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1755c53365d53693213a721138a44bdd889d8794",
      "in_reply_to_id": 1307996274,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good points, fixed per your advice.",
      "created_at": "2023-08-29T17:35:52Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309155137",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309155137"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5727,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309161936",
      "pull_request_review_id": 1600882627,
      "id": 1309161936,
      "node_id": "PRRC_kwDOABII585OCDnQ",
      "diff_hunk": "@@ -3195,6 +3202,11 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n         }\n         // When we reach this point, we switched to a new tip (stored in pindexNewTip).\n \n+        if (exited_ibd) {\n+            LOCK(::cs_main);\n+            m_chainman.MaybeRebalanceCaches();",
      "path": "src/validation.cpp",
      "position": 110,
      "original_position": 47,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3e7d3537fc06c8aff8a48edc8f179a70af46e04c",
      "in_reply_to_id": 1308014826,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comment that's slightly more vague because I think the logic for how we balance the caches should be confined to `MaybeRebalanceCaches()` so that this comment doesn't fall out of date.",
      "created_at": "2023-08-29T17:42:56Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309161936",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309161936"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3214,
      "original_line": 3214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309196765",
      "pull_request_review_id": 1600882627,
      "id": 1309196765,
      "node_id": "PRRC_kwDOABII585OCMHd",
      "diff_hunk": "@@ -5729,6 +5729,16 @@ void ChainstateManager::DeleteSnapshotChainstate()\n     m_snapshot_chainstate.reset();\n }\n \n+ChainstateRole Chainstate::GetRole() const",
      "path": "src/validation.cpp",
      "position": 327,
      "original_position": 4,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "95f45e38b5e47eaef56468909d04418b93e9c962",
      "in_reply_to_id": 1308025208,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Definitely agree here, but it'd be nice to tackle this as a follow-up since inverting all the `cs_main` acquisitions for `ActiveChainstate()` will be a big diff (if not mechanical).\r\n\r\nFor now I can add `EXCLUSIVE_LOCKS_REQUIRED` annotations to `GetRole()`, which compiles okay at the HEAD of this branch.",
      "created_at": "2023-08-29T18:19:40Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309196765",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309196765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5778,
      "original_line": 5778,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309270401",
      "pull_request_review_id": 1600882627,
      "id": 1309270401,
      "node_id": "PRRC_kwDOABII585OCeGB",
      "diff_hunk": "@@ -3186,7 +3186,7 @@ bool Chainstate::ActivateBestChain(BlockValidationState& state, std::shared_ptr<\n \n             // Notify external listeners about the new tip.\n             // Enqueue while holding cs_main to ensure that UpdatedBlockTip is called in the order in which blocks are connected\n-            if (pindexFork != pindexNewTip) {\n+            if (this == &m_chainman.ActiveChainstate() && pindexFork != pindexNewTip) {",
      "path": "src/validation.cpp",
      "position": 91,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9eda8224119450b8614837e0c8decfc81a6b9915",
      "in_reply_to_id": 1308029027,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T19:30:34Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309270401",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309270401"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3194,
      "original_line": 3194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309271332",
      "pull_request_review_id": 1600882627,
      "id": 1309271332,
      "node_id": "PRRC_kwDOABII585OCeUk",
      "diff_hunk": "@@ -19,7 +19,11 @@ struct TestChainstateManager : public ChainstateManager {\n class ValidationInterfaceTest\n {\n public:\n-    static void BlockConnected(CValidationInterface& obj, const std::shared_ptr<const CBlock>& block, const CBlockIndex* pindex);\n+    static void BlockConnected(\n+        const ChainstateRole role,\n+        CValidationInterface& obj,",
      "path": "src/test/util/validation.h",
      "position": null,
      "original_position": 7,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": 1308031241,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I figured that since we'd immediately be filtering on `role` for many of these notifications it kind of made sense going first. I can change it but I won't do that unless you really want me to because I'm lazy.",
      "created_at": "2023-08-29T19:31:38Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309271332",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309271332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 23,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309272443",
      "pull_request_review_id": 1600882627,
      "id": 1309272443,
      "node_id": "PRRC_kwDOABII585OCel7",
      "diff_hunk": "@@ -87,7 +88,7 @@ class CValidationInterface {\n      * but may not be called on every intermediate tip. If the latter behavior is desired,\n      * subscribe to BlockConnected() instead.\n      *\n-     * Called on a background thread.\n+     * Called on a background thread. Only called for the active chainstate.",
      "path": "src/validationinterface.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": 1308032026,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T19:33:02Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309272443",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309272443"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309274440",
      "pull_request_review_id": 1600882627,
      "id": 1309274440,
      "node_id": "PRRC_kwDOABII585OCfFI",
      "diff_hunk": "@@ -199,11 +205,11 @@ class CMainSignals {\n     void UpdatedBlockTip(const CBlockIndex *, const CBlockIndex *, bool fInitialDownload);\n     void TransactionAddedToMempool(const CTransactionRef&, uint64_t mempool_sequence);\n     void TransactionRemovedFromMempool(const CTransactionRef&, MemPoolRemovalReason, uint64_t mempool_sequence);\n-    void BlockConnected(const std::shared_ptr<const CBlock> &, const CBlockIndex *pindex);\n+    void BlockConnected(const ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *pindex);",
      "path": "src/validationinterface.h",
      "position": null,
      "original_position": 64,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "2873d91ada1c240de280a35bbf169ed0c708e057",
      "in_reply_to_id": 1308039060,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed. Just dumb muscle memory on my part.",
      "created_at": "2023-08-29T19:35:34Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309274440",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309274440"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309281888",
      "pull_request_review_id": 1600882627,
      "id": 1309281888,
      "node_id": "PRRC_kwDOABII585OCg5g",
      "diff_hunk": "@@ -0,0 +1,7 @@\n+ZMQ",
      "path": "doc/release-notes-27596.md",
      "position": null,
      "original_position": 1,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b48729144fba1dbc64d603b2644a76c3f00d44eb",
      "in_reply_to_id": 1308042767,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T19:44:14Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309281888",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309281888"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309281932",
      "pull_request_review_id": 1600882627,
      "id": 1309281932,
      "node_id": "PRRC_kwDOABII585OCg6M",
      "diff_hunk": "@@ -144,7 +144,8 @@ void TryForEachAndRemoveFailed(std::list<std::unique_ptr<CZMQAbstractNotifier>>&\n \n void CZMQNotificationInterface::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockIndex *pindexFork, bool fInitialDownload)\n {\n-    if (fInitialDownload || pindexNew == pindexFork) // In IBD or blocks were disconnected without any new ones\n+    // In IBD or blocks were disconnected without any new ones\n+    if (fInitialDownload || pindexNew == pindexFork)",
      "path": "src/zmq/zmqnotificationinterface.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b48729144fba1dbc64d603b2644a76c3f00d44eb",
      "in_reply_to_id": 1308047801,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T19:44:17Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309281932",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309281932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309289948",
      "pull_request_review_id": 1600882627,
      "id": 1309289948,
      "node_id": "PRRC_kwDOABII585OCi3c",
      "diff_hunk": "@@ -5838,3 +5848,9 @@ bool ChainstateManager::ValidatedSnapshotCleanup()\n     }\n     return true;\n }\n+\n+Chainstate& ChainstateManager::GetChainstateForIndexing()\n+{\n+    return (IsSnapshotActive() && !IsSnapshotValidated()) ?",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": 1308071774,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We can't just return `m_ibd_chainstate` because we want the indexes to switch to the active (snapshot) chainstate once the background validation completes (but before a restart has happened). I'll make a note.",
      "created_at": "2023-08-29T19:53:38Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309289948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309289948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5854,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309291356",
      "pull_request_review_id": 1600882627,
      "id": 1309291356,
      "node_id": "PRRC_kwDOABII585OCjNc",
      "diff_hunk": "@@ -1473,6 +1473,26 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.chainman = std::make_unique<ChainstateManager>(node.kernel->interrupt, chainman_opts, blockman_opts);\n         ChainstateManager& chainman = *node.chainman;\n \n+        // This is defined and set here instead of inline in validation.h to avoid a hard\n+        // dependency between validation and index/base, since the latter is not in\n+        // libbitcoinkernel.\n+        chainman.restart_indexers = [](const ChainstateManager& chainman) {\n+            LogPrintf(\"[snapshot] restarting indexers\\n\");\n+\n+            // Drain the validation interface queue to ensure that the old indexers\n+            // don't have any pending work.\n+            SyncWithValidationInterfaceQueue();\n+\n+            for (auto* indexer : chainman.indexers) {",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": 1308066452,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point! Fixed.",
      "created_at": "2023-08-29T19:55:20Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309291356",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309291356"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1486,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309291418",
      "pull_request_review_id": 1600882627,
      "id": 1309291418,
      "node_id": "PRRC_kwDOABII585OCjOa",
      "diff_hunk": "@@ -1473,6 +1473,26 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n         node.chainman = std::make_unique<ChainstateManager>(node.kernel->interrupt, chainman_opts, blockman_opts);\n         ChainstateManager& chainman = *node.chainman;\n \n+        // This is defined and set here instead of inline in validation.h to avoid a hard\n+        // dependency between validation and index/base, since the latter is not in\n+        // libbitcoinkernel.\n+        chainman.restart_indexers = [](const ChainstateManager& chainman) {\n+            LogPrintf(\"[snapshot] restarting indexers\\n\");",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": 1308066973,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T19:55:24Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309291418",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309291418"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1480,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309294877",
      "pull_request_review_id": 1600882627,
      "id": 1309294877,
      "node_id": "PRRC_kwDOABII585OCkEd",
      "diff_hunk": "@@ -909,6 +910,8 @@ class ChainstateManager\n \n     explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n \n+    std::vector<BaseIndex*> indexers{};",
      "path": "src/validation.h",
      "position": null,
      "original_position": 12,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "688b68f34fe061c3064a516cdf77d4c155bfcafd",
      "in_reply_to_id": 1308053648,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is resolved after removing `ChainstateManager.indexers`.",
      "created_at": "2023-08-29T19:59:12Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309294877",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309294877"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 913,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309295887",
      "pull_request_review_id": 1600882627,
      "id": 1309295887,
      "node_id": "PRRC_kwDOABII585OCkUP",
      "diff_hunk": "@@ -911,6 +911,10 @@ class ChainstateManager\n     explicit ChainstateManager(const util::SignalInterrupt& interrupt, Options options, node::BlockManager::Options blockman_options);\n \n     std::vector<BaseIndex*> indexers{};\n+    //! Function to restart active indexers; set dynamically to avoid a circular\n+    //! dependency on `base/index.cpp`.\n+    std::function<void(const ChainstateManager&)> restart_indexers =",
      "path": "src/validation.h",
      "position": null,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5d01151b41b244dabeda54122400df17a3dfc4d2",
      "in_reply_to_id": 1308070723,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T20:00:22Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309295887",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309295887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 916,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309300988",
      "pull_request_review_id": 1600882627,
      "id": 1309300988,
      "node_id": "PRRC_kwDOABII585OClj8",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};",
      "path": "src/validation.cpp",
      "position": 356,
      "original_position": 39,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308085308,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.\r\n\r\nEdit: Initializing `prune_start` to 1 prevents the pruning of the blockfile with block height=0 in it, which causes the `feature_pruning.py` functional test to fail, so I'm keeping that part as-is.",
      "created_at": "2023-08-29T20:05:49Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309300988",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309300988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5897,
      "original_line": 5897,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309303935",
      "pull_request_review_id": 1600882627,
      "id": 1309303935,
      "node_id": "PRRC_kwDOABII585OCmR_",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {\n+        std::optional<int> snapshot_height{GetSnapshotBaseHeight()};",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 44,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308075373,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point, fixed.",
      "created_at": "2023-08-29T20:09:13Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309303935",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309303935"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5876,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309313670",
      "pull_request_review_id": 1600882627,
      "id": 1309313670,
      "node_id": "PRRC_kwDOABII585OCoqG",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > nLastBlockWeCanPrune || fileinfo.nHeightFirst < min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), nLastBlockWeCanPrune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int chain_tip_height,\n+    int prune_height,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = GetPruneTarget() / chainman.GetAll().size();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9e2b8ef836aeb1dc2e4b57449fc56badebea6772",
      "in_reply_to_id": 1291649621,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point @ryanofsky. I'm taking your first recommendation here because doubling the prune budget in all cases feels excessive to me.\r\n\r\nI've added release notes describing this issue.\r\n",
      "created_at": "2023-08-29T20:19:44Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309313670",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309313670"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 195,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309314011",
      "pull_request_review_id": 1600882627,
      "id": 1309314011,
      "node_id": "PRRC_kwDOABII585OCovb",
      "diff_hunk": "@@ -153,31 +158,54 @@ void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nM\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    unsigned int min_block_to_prune;\n+    unsigned int nLastBlockWeCanPrune;\n+\n+    std::tie(min_block_to_prune, nLastBlockWeCanPrune) = chainman.GetPruneRange(\n+        chain, chain_tip_height);\n+\n+    nLastBlockWeCanPrune = std::min(nLastBlockWeCanPrune, (unsigned)nManualPruneHeight);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308119179,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T20:20:06Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309314011",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309314011"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309318603",
      "pull_request_review_id": 1600882627,
      "id": 1309318603,
      "node_id": "PRRC_kwDOABII585OCp3L",
      "diff_hunk": "@@ -122,7 +128,13 @@ class BlockManager\n      *\n      * @param[out]   setFilesToPrune   The set of file indices that can be unlinked will be returned\n      */\n-    void FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd);\n+    void FindFilesToPrune(\n+        std::set<int>& setFilesToPrune,\n+        uint64_t nPruneAfterHeight,\n+        int chain_tip_height,\n+        int prune_height,",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 31,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308104549,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2023-08-29T20:25:28Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309318603",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309318603"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 134,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 135,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309320282",
      "pull_request_review_id": 1600882627,
      "id": 1309320282,
      "node_id": "PRRC_kwDOABII585OCqRa",
      "diff_hunk": "@@ -2474,11 +2475,19 @@ bool Chainstate::FlushStateToDisk(\n             if (nManualPruneHeight > 0) {\n                 LOG_TIME_MILLIS_WITH_CATEGORY(\"find files to prune (manual)\", BCLog::BENCH);\n \n-                m_blockman.FindFilesToPruneManual(setFilesToPrune, std::min(last_prune, nManualPruneHeight), m_chain.Height());\n+                m_blockman.FindFilesToPruneManual(\n+                    setFilesToPrune,\n+                    std::min(last_prune, nManualPruneHeight),\n+                    m_chain.Height(),",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308096895,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2023-08-29T20:27:23Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309320282",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309320282"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2481,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309320508",
      "pull_request_review_id": 1600882627,
      "id": 1309320508,
      "node_id": "PRRC_kwDOABII585OCqU8",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308076179,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2023-08-29T20:27:38Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309320508",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309320508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5875,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332220",
      "pull_request_review_id": 1600882627,
      "id": 1309332220,
      "node_id": "PRRC_kwDOABII585OCtL8",
      "diff_hunk": "@@ -5854,3 +5863,40 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     return (IsSnapshotActive() && !IsSnapshotValidated()) ?\n         *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<unsigned int, unsigned int> ChainstateManager::GetPruneRange(\n+    const Chainstate& chainstate, unsigned int prune_height)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    unsigned int prune_start{0};\n+\n+    if (this->GetAll().size() > 1) {\n+        std::optional<int> snapshot_height{GetSnapshotBaseHeight()};\n+\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        if (&chainstate == m_snapshot_chainstate.get() && snapshot_height) {\n+            prune_start = *snapshot_height + 1;\n+        }\n+    }\n+\n+    unsigned int prune_end{0};\n+    unsigned int chain_height{static_cast<unsigned int>(chainstate.m_chain.Height())};\n+\n+    if (MIN_BLOCKS_TO_KEEP > chain_height) {\n+        // Prevent underflow.\n+        prune_end = 0;\n+    } else {\n+        // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n+        //\n+        // While you might be tempted to prune the background chainstate more\n+        // aggressively (i.e. fewer MIN_BLOCKS_TO_KEEP), this won't work with index\n+        // building - specifically blockfilterindex requires undo data, and if\n+        // we don't maintain this trailing window, we hit indexation failures.\n+        prune_end = std::min(prune_height, chain_height - MIN_BLOCKS_TO_KEEP);\n+    }",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308128467,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T20:40:33Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309332220",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 5888,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 5899,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332321",
      "pull_request_review_id": 1600882627,
      "id": 1309332321,
      "node_id": "PRRC_kwDOABII585OCtNh",
      "diff_hunk": "@@ -1248,6 +1244,17 @@ class ChainstateManager\n     //!   fully validated chain.\n     Chainstate& GetChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Return the [start, end] (inclusive) of block heights we can prune.",
      "path": "src/validation.h",
      "position": 102,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308108294,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T20:40:40Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309332321",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332321"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1244,
      "original_line": 1244,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332387",
      "pull_request_review_id": 1600882627,
      "id": 1309332387,
      "node_id": "PRRC_kwDOABII585OCtOj",
      "diff_hunk": "@@ -1248,6 +1244,17 @@ class ChainstateManager\n     //!   fully validated chain.\n     Chainstate& GetChainstateForIndexing() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! Return the [start, end] (inclusive) of block heights we can prune.\n+    //!\n+    //! If we're pruning the snapshot chainstate, be sure not to\n+    //! prune blocks being used by the background chainstate.\n+    std::pair<unsigned int, unsigned int> GetPruneRange(",
      "path": "src/validation.h",
      "position": null,
      "original_position": 19,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b9ac4f7925e2d9dec67be06fdc2a381532581136",
      "in_reply_to_id": 1308082844,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-29T20:40:44Z",
      "updated_at": "2023-08-29T21:44:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1309332387",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1309332387"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1251,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310404663",
      "pull_request_review_id": 1602900172,
      "id": 1310404663,
      "node_id": "PRRC_kwDOABII585OGzA3",
      "diff_hunk": "@@ -5864,3 +5871,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);\n+\n+    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 48,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (5e4c824433fb4bf8b380d0f61a0aa424dc5456d4)\r\n\r\nWould s/user-specified/caller-specified/. In the manual pruning case it is actually user-specified, but in the automatic case it depends on prune locks.",
      "created_at": "2023-08-30T14:51:31Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310404663",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310404663"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310410195",
      "pull_request_review_id": 1602900172,
      "id": 1310410195,
      "node_id": "PRRC_kwDOABII585OG0XT",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);",
      "path": "src/node/blockstorage.cpp",
      "position": 28,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (5e4c824433fb4bf8b380d0f61a0aa424dc5456d4)\r\n\r\nIt looks like there was an overflow bug here previously which is fixed now? If chain_tip_height was less than MIN_BLOCKS_TO_KEEP, that would overflow and produce a large unsigned integer, so it would have been possible to manually prune chain data very close to the tip which the chain height was low previously, IIUC",
      "created_at": "2023-08-30T14:55:17Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310410195",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310410195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 157,
      "original_line": 157,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310423116",
      "pull_request_review_id": 1602900172,
      "id": 1310423116,
      "node_id": "PRRC_kwDOABII585OG3hM",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    int height = chain.m_chain.Height();\n+    if (height < 0 || target == 0) {\n         return;\n     }\n-    if ((uint64_t)chain_tip_height <= nPruneAfterHeight) {\n+    if ((uint64_t)height <= nPruneAfterHeight) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 59,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (5e4c824433fb4bf8b380d0f61a0aa424dc5456d4)\r\n\r\nI think it would simplify the code more to drop the nPruneAfterHeight parameter and replace it directly with `_chainman.GetParams().PruneAfterHeight()` to make it obvious this is a hardcoded parameter.\r\n\r\nAlso maybe replace the C cast with a static cast if this line is changing anyway.",
      "created_at": "2023-08-30T15:03:57Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310423116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310423116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310432926",
      "pull_request_review_id": 1602900172,
      "id": 1310432926,
      "node_id": "PRRC_kwDOABII585OG56e",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    int height = chain.m_chain.Height();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (5e4c824433fb4bf8b380d0f61a0aa424dc5456d4)\r\n\r\nSuggest keeping the name \"chain_tip_height\" instead of \"height\" for this variable. There are a lot of heights in this function so easy to forget what the the generic \"height\" is.",
      "created_at": "2023-08-30T15:10:35Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310432926",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310432926"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310435694",
      "pull_request_review_id": 1602900172,
      "id": 1310435694,
      "node_id": "PRRC_kwDOABII585OG6lu",
      "diff_hunk": "@@ -5864,3 +5871,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);\n+\n+    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n+    //\n+    // While you might be tempted to prune the background chainstate more\n+    // aggressively (i.e. fewer MIN_BLOCKS_TO_KEEP), this won't work with index\n+    // building - specifically blockfilterindex requires undo data, and if\n+    // we don't maintain this trailing window, we hit indexation failures.",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (5e4c824433fb4bf8b380d0f61a0aa424dc5456d4)\r\n\r\nLast remaining s/indexation/indexing/",
      "created_at": "2023-08-30T15:12:29Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310435694",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310435694"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5895,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310871911",
      "pull_request_review_id": 1602900172,
      "id": 1310871911,
      "node_id": "PRRC_kwDOABII585OIlFn",
      "diff_hunk": "@@ -76,16 +71,21 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     Chainstate& c2 = WITH_LOCK(::cs_main, return manager.ActivateExistingSnapshot(\n         &mempool, snapshot_blockhash));\n     chainstates.push_back(&c2);\n-\n-    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n-\n     c2.InitCoinsDB(\n         /*cache_size_bytes=*/1 << 23, /*in_memory=*/true, /*should_wipe=*/false);\n-    WITH_LOCK(::cs_main, c2.InitCoinsCache(1 << 23));\n-    c2.m_chain.SetTip(*active_tip);\n+    {\n+        LOCK(::cs_main);\n+        c2.InitCoinsCache(1 << 23);\n+        c2.m_chain.SetTip(*active_tip);\n+        c2.CoinsTip().SetBestBlock(active_tip->GetBlockHash());\n+        c2.setBlockIndexCandidates.insert(manager.m_blockman.LookupBlockIndex(active_tip->GetBlockHash()));\n+        c2.LoadChainTip();\n+    }\n     BlockValidationState _;\n     BOOST_CHECK(c2.ActivateBestChain(_, nullptr));\n \n+    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n+    BOOST_CHECK(c2.ActivateBestChain(_));",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"test: adjust chainstate tests to use recognized snapshot base\" (76d616c957522e7be52eaf10b3ac33accaf75c45)\r\n\r\nSeems pointless to call ActivateBestChain twice in a row here. Would be good to remove this line and simplify test setup or add a comment explaining why this is necessary.",
      "created_at": "2023-08-30T21:55:44Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310871911",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310871911"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310877098",
      "pull_request_review_id": 1602900172,
      "id": 1310877098,
      "node_id": "PRRC_kwDOABII585OImWq",
      "diff_hunk": "@@ -76,16 +71,21 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     Chainstate& c2 = WITH_LOCK(::cs_main, return manager.ActivateExistingSnapshot(\n         &mempool, snapshot_blockhash));\n     chainstates.push_back(&c2);\n-\n-    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n-\n     c2.InitCoinsDB(\n         /*cache_size_bytes=*/1 << 23, /*in_memory=*/true, /*should_wipe=*/false);\n-    WITH_LOCK(::cs_main, c2.InitCoinsCache(1 << 23));\n-    c2.m_chain.SetTip(*active_tip);\n+    {\n+        LOCK(::cs_main);\n+        c2.InitCoinsCache(1 << 23);\n+        c2.m_chain.SetTip(*active_tip);",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"test: adjust chainstate tests to use recognized snapshot base\" (76d616c957522e7be52eaf10b3ac33accaf75c45)\r\n\r\nThis SetTip call seems pointless now because the LoadChainTip call below will overwrite the chain tip. Would suggest removing this line or adding more explanation in a comment.",
      "created_at": "2023-08-30T22:01:46Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310877098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310877098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310888128",
      "pull_request_review_id": 1602900172,
      "id": 1310888128,
      "node_id": "PRRC_kwDOABII585OIpDA",
      "diff_hunk": "@@ -96,14 +96,15 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     auto& active_chain2 = WITH_LOCK(manager.GetMutex(), return manager.ActiveChain());\n     BOOST_CHECK_EQUAL(&active_chain2, &c2.m_chain);\n \n-    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 0);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 110);\n+    mineBlocks(1);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 111);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return c1.m_chain.Height()), 110);\n \n     auto active_tip2 = WITH_LOCK(manager.GetMutex(), return manager.ActiveTip());\n     auto exp_tip2 = c2.m_chain.Tip();\n     BOOST_CHECK_EQUAL(active_tip2, exp_tip2);\n \n-    BOOST_CHECK_EQUAL(exp_tip, exp_tip2);",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": 89,
      "original_position": 84,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"test: adjust chainstate tests to use recognized snapshot base\" (76d616c957522e7be52eaf10b3ac33accaf75c45)\r\n\r\nI think it would be good to clarify this code and verify both tips are set correctly at the end of the test.\r\n\r\nWould suggest:\r\n\r\n```diff\r\n-    auto exp_tip2 = c2.m_chain.Tip();\r\n-    BOOST_CHECK_EQUAL(active_tip2, exp_tip2);\r\n+    BOOST_CHECK_EQUAL(active_tip, active_tip2->pprev);\r\n+    BOOST_CHECK_EQUAL(active_tip, c1.m_chain.Tip());\r\n+    BOOST_CHECK_EQUAL(active_tip2, c2.m_chain.Tip());\r\n```",
      "created_at": "2023-08-30T22:14:51Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310888128",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310888128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 105,
      "original_line": 105,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310901739",
      "pull_request_review_id": 1602900172,
      "id": 1310901739,
      "node_id": "PRRC_kwDOABII585OIsXr",
      "diff_hunk": "@@ -488,13 +490,13 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n \n     // Note: cs2's tip is not set when ActivateExistingSnapshot is called.\n     Chainstate& cs2 = WITH_LOCK(::cs_main,\n-        return chainman.ActivateExistingSnapshot(&mempool, *assumed_base->phashBlock));\n+        return chainman.ActivateExistingSnapshot(&mempool, *assumed_tip->phashBlock));",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 131,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"test: adjust chainstate tests to use recognized snapshot base\" (76d616c957522e7be52eaf10b3ac33accaf75c45)\r\n\r\nWhat is going on here and in on line 499 below? It seems strange to advance the snapshot chain all the way to the chain tip if the point of the test below is to make sure setBlockIndexCandidates is initialized correctly after loading the snapshot, and setBlockIndexCandidates is supposed to be use to work towards the chain tip.\r\n\r\nAlso changing assumed_base to assumed_tip here and below seems contrary to the comments \"Set tip of the assume-valid-based chain to the assume-valid block\"\r\n\r\nIf I revert the changes this line and on line 499 the test still passes as of b6b62a96bd6d1eccaf6bd9eadfa1c60232aadeed, so I think they may be unnecessary",
      "created_at": "2023-08-30T22:33:55Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310901739",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310901739"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 493,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310947552",
      "pull_request_review_id": 1602900172,
      "id": 1310947552,
      "node_id": "PRRC_kwDOABII585OI3jg",
      "diff_hunk": "@@ -290,7 +290,13 @@ bool BlockManager::LoadBlockIndex()\n         // Pruned nodes may have deleted the block.\n         if (pindex->nTx > 0) {\n             if (pindex->pprev) {\n-                if (pindex->pprev->nChainTx > 0) {\n+                if (snapshot_blockhash && pindex->GetBlockHash() == *snapshot_blockhash) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: populate nChainTx value for assumedvalid chainstates\" (9df91113b8bbab8c98924bef61da388a8141b4e6)\r\n\r\nIt seems like this might be broken if a user loaded a snapshot and then quit before the snapshot block was successfully downloaded. In this case I think `pindex->nTx` for the snapshot block on line 291 would be 0 so the new code would not run.\r\n\r\nA good way to fix this might be to add something like `if (snapshot_blockhash) LookupBlockIndex(hash)->nChainTx = AssumeutxoForBlockhash(*snapshot_blockhash)` right after the LoadBlockIndexGuts call, before the for-loop.\r\n\r\nThe other advantage setting `nChainTx` before the for-loop would be that the for-loop can remain simpler and unchanged, and also be more efficient because it will no longer be need to compare `pindex->GetBlockHash() == *snapshot_blockhash)` for each block.\r\n\r\n\r\n",
      "created_at": "2023-08-30T23:38:38Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310947552",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310947552"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 293,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310950827",
      "pull_request_review_id": 1602900172,
      "id": 1310950827,
      "node_id": "PRRC_kwDOABII585OI4Wr",
      "diff_hunk": "@@ -4765,6 +4765,10 @@ void ChainstateManager::CheckBlockIndex()\n     CBlockIndex* pindexFirstAssumeValid = nullptr; // Oldest ancestor of pindex which has BLOCK_ASSUMED_VALID\n     while (pindex != nullptr) {\n         nNodes++;\n+        if (pindex->pprev && pindex->nTx > 0) {\n+            // nChainTx should increase monotonically\n+            assert(pindex->pprev->nChainTx <= pindex->nChainTx);",
      "path": "src/validation.cpp",
      "position": 175,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: populate nChainTx value for assumedvalid chainstates\" (9df91113b8bbab8c98924bef61da388a8141b4e6)\r\n\r\nCould you assert not that just that it increases monotonically, but that it increases by the number of transactions?\r\n\r\n```c++\r\n assert(pindex->nChainTx == pindex->nTx + pindex->pprev->nChainTx);\r\n```\r\n\r\nOr maybe add a comment if there's a special case where this does not hold.",
      "created_at": "2023-08-30T23:44:37Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310950827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310950827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4767,
      "original_line": 4767,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310965708",
      "pull_request_review_id": 1602900172,
      "id": 1310965708,
      "node_id": "PRRC_kwDOABII585OI7_M",
      "diff_hunk": "@@ -680,13 +753,14 @@ bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigne\n         pos.nPos = m_blockfile_info[nFile].nSize;\n     }\n \n-    if ((int)nFile != m_last_blockfile) {\n+    if (nFile != last_blockfile) {\n         if (!fKnown) {\n-            LogPrint(BCLog::BLOCKSTORAGE, \"Leaving block file %i: %s\\n\", m_last_blockfile, m_blockfile_info[m_last_blockfile].ToString());\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Leaving block file %i: %s (onto %i) (height %i)\\n\",\n+                m_last_blockfile, m_blockfile_info[last_blockfile].ToString(), nFile, nHeight);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 217,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: assumeutxo: swap m_mempool on snapshot activation\" (f2dd7a0c1b67d3e4a6e086a619eff34fe6625263)\r\n\r\nThis is still referencing ` m_last_blockfile` instead of `last_blockfile`, which does not make sense. I think it would be a good idea to remove the ` m_last_blockfile` member because this appears to be the only remaining usage.",
      "created_at": "2023-08-31T00:12:41Z",
      "updated_at": "2023-08-31T02:22:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310965708",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310965708"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 759,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310971801",
      "pull_request_review_id": 1602900172,
      "id": 1310971801,
      "node_id": "PRRC_kwDOABII585OI9eZ",
      "diff_hunk": "@@ -70,6 +71,30 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.\n+    NORMAL,\n+    ASSUMED,\n+};\n+\n+std::ostream& operator<<(std::ostream& os, const BlockfileType& type);\n+\n+struct BlockfileCursor {\n+    // The latest blockfile number.\n+    int file_num{0};\n+\n+    // Track the largest height block whose undo data is in `file_num` blockfile.\n+    // When we move to the next blockfile, if the undo data is keeping up then\n+    // we know we can trim the size of the file and truncate any excess\n+    // allocations. If not, we assume that eventually we'll add more undo data\n+    // to this file, and when we revisit it we'll trim it then.\n+    int undo_height{0};",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 30,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nThis comment appears to be copied from an old version of PR #27746 (commit 6b5b53eafefa38250bb4e5d914e5ad5743416563) that was updated later. The final version of the #27746 had a more complete comment which can be found on line 178 below documenting the `m_undo_height_in_last_blockfile` member.\r\n\r\nI think to avoid confusion and bugs it's pretty important to delete the `m_last_blockfile` and `m_undo_height_in_last_blockfile` members below fully replace them with new members in this struct and move the latest `m_undo_height_in_last_blockfile` comment over here. I also do think the old names `last_blockfile` and `undo_height_in_last_blockfile` are more descriptive than the new names `file_num` and `undo_height`, but I guess there was some reasoning for changing them, so not sure about that.",
      "created_at": "2023-08-31T00:27:40Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310971801",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310971801"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 87,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310979704",
      "pull_request_review_id": 1602900172,
      "id": 1310979704,
      "node_id": "PRRC_kwDOABII585OI_Z4",
      "diff_hunk": "@@ -70,6 +71,30 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.",
      "path": "src/node/blockstorage.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nI think it would make sense to move this comment to the `BlockfileTypeForRole` function. The comment seems out of context here since the enum isn't used yet here and the purpose isn't described until the `m_blockfile_cursors` comment 100 lines below.\r\n\r\n",
      "created_at": "2023-08-31T00:46:53Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310979704",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310979704"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": 74,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": 75,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310985324",
      "pull_request_review_id": 1602900172,
      "id": 1310985324,
      "node_id": "PRRC_kwDOABII585OJAxs",
      "diff_hunk": "@@ -377,6 +380,42 @@ bool BlockManager::LoadBlockIndexDB(const std::optional<uint256>& snapshot_block\n         }\n     }\n \n+    std::optional<unsigned int> snapshot_base_height{std::nullopt};\n+    if (snapshot_blockhash) {\n+        const auto au_data = GetParams().AssumeutxoForBlockhash(*snapshot_blockhash);\n+        snapshot_base_height = Assert(au_data)->height;\n+    }\n+\n+    {\n+        // Initialize the blockfile cursors.\n+        LOCK(cs_LastBlockFile);\n+        for (size_t i = 0; i < m_blockfile_info.size(); ++i) {\n+            const auto& fileinfo = m_blockfile_info[i];\n+            BlockfileType blockfile_type{BlockfileType::NORMAL};\n+\n+            // If we have a snapshot and the last height tracked by this blockfile\n+            // is in the chain region above the snapshot, updated the ASSUMED cursor.\n+            if (snapshot_base_height && fileinfo.nHeightLast > *snapshot_base_height) {\n+                blockfile_type = BlockfileType::ASSUMED;\n+            }\n+            m_blockfile_cursors[blockfile_type] = {static_cast<int>(i), 0};\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Set blockfile cursor %s to %i\\n\",\n+                blockfile_type, *m_blockfile_cursors[blockfile_type]);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 84,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nThis seems like it is going to create log spam if it is printing an intermediate cursor value for each block file on disk. I think it would make more sense just to print two final NORMAL and ASSUMED last file numbers after the loop, than all the intermediate last file numbers during the loop.",
      "created_at": "2023-08-31T01:00:23Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310985324",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310985324"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 402,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 403,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310990937",
      "pull_request_review_id": 1602900172,
      "id": 1310990937,
      "node_id": "PRRC_kwDOABII585OJCJZ",
      "diff_hunk": "@@ -583,15 +623,30 @@ void BlockManager::FlushBlockFile(bool fFinalize, bool finalize_undo)\n         // have populated `m_blockfile_info` via LoadBlockIndexDB().\n         return;\n     }\n-    assert(static_cast<int>(m_blockfile_info.size()) > m_last_blockfile);\n+    assert(static_cast<int>(m_blockfile_info.size()) > blockfile_num);\n \n-    FlatFilePos block_pos_old(m_last_blockfile, m_blockfile_info[m_last_blockfile].nSize);\n+    FlatFilePos block_pos_old(blockfile_num, m_blockfile_info[blockfile_num].nSize);\n     if (!BlockFileSeq().Flush(block_pos_old, fFinalize)) {\n         m_opts.notifications.flushError(\"Flushing block file to disk failed. This is likely the result of an I/O error.\");\n     }\n     // we do not always flush the undo file, as the chain tip may be lagging behind the incoming blocks,\n     // e.g. during IBD or a sync after a node going offline\n-    if (!fFinalize || finalize_undo) FlushUndoFile(m_last_blockfile, finalize_undo);\n+    if (!fFinalize || finalize_undo) FlushUndoFile(blockfile_num, finalize_undo);\n+}\n+\n+static BlockfileType BlockfileTypeForRole(ChainstateRole chainstate_role)\n+{\n+    return chainstate_role == ChainstateRole::ASSUMEDVALID ?\n+        BlockfileType::ASSUMED : BlockfileType::NORMAL;\n+}\n+\n+void BlockManager::FlushChainstateBlockFile(ChainstateRole chainstate_role, bool finalize, bool finalize_undo)\n+{\n+    LOCK(cs_LastBlockFile);\n+    auto& cursor = m_blockfile_cursors[BlockfileTypeForRole(chainstate_role)];\n+    if (cursor) {",
      "path": "src/node/blockstorage.cpp",
      "position": 288,
      "original_position": 155,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nI was confused by this at first about why it was not an error for the cursor to be null here. Would be helpful to add comment saying it is safe to skip flushing if the cursor does not exist, because this only happens when a new snapshot has been loaded and and no blocks have been downloaded or written yet.",
      "created_at": "2023-08-31T01:09:59Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310990937",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310990937"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 637,
      "original_line": 637,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310992182",
      "pull_request_review_id": 1602900172,
      "id": 1310992182,
      "node_id": "PRRC_kwDOABII585OJCc2",
      "diff_hunk": "@@ -377,6 +380,42 @@ bool BlockManager::LoadBlockIndexDB(const std::optional<uint256>& snapshot_block\n         }\n     }\n \n+    std::optional<unsigned int> snapshot_base_height{std::nullopt};\n+    if (snapshot_blockhash) {\n+        const auto au_data = GetParams().AssumeutxoForBlockhash(*snapshot_blockhash);\n+        snapshot_base_height = Assert(au_data)->height;\n+    }\n+\n+    {\n+        // Initialize the blockfile cursors.\n+        LOCK(cs_LastBlockFile);\n+        for (size_t i = 0; i < m_blockfile_info.size(); ++i) {\n+            const auto& fileinfo = m_blockfile_info[i];\n+            BlockfileType blockfile_type{BlockfileType::NORMAL};\n+\n+            // If we have a snapshot and the last height tracked by this blockfile\n+            // is in the chain region above the snapshot, updated the ASSUMED cursor.\n+            if (snapshot_base_height && fileinfo.nHeightLast > *snapshot_base_height) {\n+                blockfile_type = BlockfileType::ASSUMED;\n+            }\n+            m_blockfile_cursors[blockfile_type] = {static_cast<int>(i), 0};\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Set blockfile cursor %s to %i\\n\",\n+                blockfile_type, *m_blockfile_cursors[blockfile_type]);\n+        }\n+\n+        // If we haven't yet seen an ASSUMED blockfile, plan to use the one past the\n+        // last NORMAL blockfile.\n+        if (snapshot_blockhash && !m_blockfile_cursors[BlockfileType::ASSUMED]) {\n+            const auto newcursor = BlockfileCursor{this->MaxBlockfileNum() + 1, 0};\n+            m_blockfile_cursors[BlockfileType::ASSUMED] = newcursor;\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Initialized empty assumed blockfile cursor to %i\\n\", newcursor);\n+        }",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nIt seems pointless and little wasteful to create this cursor and increment the max block number before any blocl data is downloaded. Wouldn't it be simpler to just delete this code and let the code in BlockManager::FindBlockPos create the cursor when there is actually data ready to be written?",
      "created_at": "2023-08-31T01:13:02Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310992182",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310992182"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 406,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 404,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310998317",
      "pull_request_review_id": 1602900172,
      "id": 1310998317,
      "node_id": "PRRC_kwDOABII585OJD8t",
      "diff_hunk": "@@ -644,11 +699,22 @@ fs::path BlockManager::GetBlockPosFilename(const FlatFilePos& pos) const\n     return BlockFileSeq().FileName(pos);\n }\n \n-bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigned int nHeight, uint64_t nTime, bool fKnown)\n+bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigned int nHeight, ChainstateRole chainstate_role, uint64_t nTime, bool fKnown)\n {\n     LOCK(cs_LastBlockFile);\n \n-    unsigned int nFile = fKnown ? pos.nFile : m_last_blockfile;\n+    const BlockfileType chain_type = BlockfileTypeForRole(chainstate_role);\n+\n+    if (!m_blockfile_cursors[chain_type]) {\n+        // If a snapshot is loaded during runtime, we may not have initialized this cursor yet.\n+        assert(chain_type == BlockfileType::ASSUMED);\n+        const auto new_cursor = BlockfileCursor{this->MaxBlockfileNum() + 1, 0};\n+        m_blockfile_cursors[chain_type] = new_cursor;\n+        LogPrint(BCLog::BLOCKSTORAGE, \"[%s] initializing blockfile cursor to %s\\n\", chainstate_role, new_cursor);\n+    }\n+    const unsigned int last_blockfile = m_blockfile_cursors[chain_type]->file_num;",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 180,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nnFile was already unsigned previously, but I think it's a small regression to change last_blockfile variable from unsigned to signed and have this implicit cast. I think ideally all these numbers would just be signed and it would be better to move in that direction instead of the other way.",
      "created_at": "2023-08-31T01:27:07Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310998317",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1310998317"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 715,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311007889",
      "pull_request_review_id": 1602900172,
      "id": 1311007889,
      "node_id": "PRRC_kwDOABII585OJGSR",
      "diff_hunk": "@@ -583,15 +623,30 @@ void BlockManager::FlushBlockFile(bool fFinalize, bool finalize_undo)\n         // have populated `m_blockfile_info` via LoadBlockIndexDB().\n         return;\n     }\n-    assert(static_cast<int>(m_blockfile_info.size()) > m_last_blockfile);\n+    assert(static_cast<int>(m_blockfile_info.size()) > blockfile_num);\n \n-    FlatFilePos block_pos_old(m_last_blockfile, m_blockfile_info[m_last_blockfile].nSize);\n+    FlatFilePos block_pos_old(blockfile_num, m_blockfile_info[blockfile_num].nSize);\n     if (!BlockFileSeq().Flush(block_pos_old, fFinalize)) {\n         m_opts.notifications.flushError(\"Flushing block file to disk failed. This is likely the result of an I/O error.\");\n     }\n     // we do not always flush the undo file, as the chain tip may be lagging behind the incoming blocks,\n     // e.g. during IBD or a sync after a node going offline\n-    if (!fFinalize || finalize_undo) FlushUndoFile(m_last_blockfile, finalize_undo);\n+    if (!fFinalize || finalize_undo) FlushUndoFile(blockfile_num, finalize_undo);\n+}\n+\n+static BlockfileType BlockfileTypeForRole(ChainstateRole chainstate_role)\n+{\n+    return chainstate_role == ChainstateRole::ASSUMEDVALID ?\n+        BlockfileType::ASSUMED : BlockfileType::NORMAL;",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 148,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (1c668b690eeb4b98899be7e0ff33373b79932f2a)\r\n\r\nThis seems like like as soon as the snapshot is validated, the new blocks from the snapshot chainstate will start being added to the last background block file, preventing that file from being pruned potentially for a long time.\r\n\r\nThis really makes me think it is a mistake expose `ChainstateRole` to all these individual `BlockManager` methods and try to use it as a heuristic for selecting the cursor. I think a better approach that would keep block files more tidy and simplify the BlockManager API would be to give BlockManager an `int  m_snapshot_base_height` variable that could be initialized in `BlockManager::LoadBlockIndexDB` and used internally to derive the `BlockfileType` value without requiring ChainstateRole chainstate_role parameters to be passed around everywhere. This would also simplify the validation code, avoiding the need to change `ChainstateManager::AcceptBlock`.\r\n\r\nI think the new BlockManager::FlushChainstateBlockFile method would still need to be added, but the rest of the BlockManager API changes could be reverted, and FlushChainstateBlockFile could take a chain tip height instead of a ChainstateRole, so the same cursor select code could be used everywhere.",
      "created_at": "2023-08-31T01:50:13Z",
      "updated_at": "2023-08-31T02:20:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311007889",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311007889"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 639,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 640,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311331956",
      "pull_request_review_id": 1604300972,
      "id": 1311331956,
      "node_id": "PRRC_kwDOABII585OKVZ0",
      "diff_hunk": "@@ -5831,6 +5898,13 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             std::vector<const CBlockIndex*> vToDownload;\n             NodeId staller = -1;\n             FindNextBlocksToDownload(*peer, MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(), vToDownload, staller);\n+            if (m_chainman.BackgroundSyncInProgress() && !IsLimitedPeer(*peer)) {\n+                TryDownloadingHistoricalBlocks(\n+                    *peer,\n+                    MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(),",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 122,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "7b93d4adc976bdb32306951b21d7c98d9dacc972",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "7b93d4adc976bdb32306951b21d7c98d9dacc972\r\n\r\nCould use an assert this can't underflow",
      "created_at": "2023-08-31T09:08:00Z",
      "updated_at": "2023-08-31T09:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311331956",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311331956"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5904,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311353331",
      "pull_request_review_id": 1604300972,
      "id": 1311353331,
      "node_id": "PRRC_kwDOABII585OKanz",
      "diff_hunk": "@@ -5737,6 +5737,16 @@ bool ChainstateManager::DeleteSnapshotChainstate()\n     return true;\n }\n \n+ChainstateRole Chainstate::GetRole() const\n+{\n+    if (m_chainman.GetAll().size() <= 1) {",
      "path": "src/validation.cpp",
      "position": 329,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "288dd732b5c0085618598fe3dbba23ac6d194173",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "288dd732b5c0085618598fe3dbba23ac6d194173\r\n\r\nI wish the chainstate state machine was briefly mentioned here, or referenced where it's defined.\r\nA reviewer needs a way to understand why it's impossible to have 2+ chainstates, one of them being NORMAL (and others being something).",
      "created_at": "2023-08-31T09:25:03Z",
      "updated_at": "2023-08-31T09:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311353331",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311353331"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5780,
      "original_line": 5780,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311360137",
      "pull_request_review_id": 1604300972,
      "id": 1311360137,
      "node_id": "PRRC_kwDOABII585OKcSJ",
      "diff_hunk": "@@ -1961,7 +1965,10 @@ void PeerManagerImpl::BlockDisconnected(const std::shared_ptr<const CBlock> &blo\n  * Maintain state about the best-seen block and fast-announce a compact block\n  * to compatible peers.\n  */\n-void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock)\n+void PeerManagerImpl::NewPoWValidBlock(",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "d3b533d3f1e80addca2ab0b3ee97215d5d03d984",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d3b533d3f1e80addca2ab0b3ee97215d5d03d984\r\n\r\ncould add an assert for the invariant: can't be BACKGROUND role.",
      "created_at": "2023-08-31T09:30:05Z",
      "updated_at": "2023-08-31T09:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311360137",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311360137"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1968,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311369580",
      "pull_request_review_id": 1604300972,
      "id": 1311369580,
      "node_id": "PRRC_kwDOABII585OKels",
      "diff_hunk": "@@ -1961,7 +1965,10 @@ void PeerManagerImpl::BlockDisconnected(const std::shared_ptr<const CBlock> &blo\n  * Maintain state about the best-seen block and fast-announce a compact block\n  * to compatible peers.\n  */\n-void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock)\n+void PeerManagerImpl::NewPoWValidBlock(",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "d3b533d3f1e80addca2ab0b3ee97215d5d03d984",
      "in_reply_to_id": 1311360137,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is done later in fbd05a9eed1e40be0c4915e2aef98b3771d7af6c, although in a `return` way for some reason?",
      "created_at": "2023-08-31T09:37:54Z",
      "updated_at": "2023-08-31T09:53:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311369580",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311369580"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1968,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311371973",
      "pull_request_review_id": 1604300972,
      "id": 1311371973,
      "node_id": "PRRC_kwDOABII585OKfLF",
      "diff_hunk": "@@ -1916,9 +1916,15 @@ void PeerManagerImpl::BlockConnected(\n     const std::shared_ptr<const CBlock>& pblock,\n     const CBlockIndex* pindex)\n {\n-    m_orphanage.EraseForBlock(*pblock);\n+    // Update this for all chainstate roles so that we don't mistakenly see peers\n+    // helping us do background IBD as having a stale tip.\n     m_last_tip_update = GetTime<std::chrono::seconds>();\n \n+    if (role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 157,
      "original_position": 9,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fbd05a9eed1e40be0c4915e2aef98b3771d7af6c",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "fbd05a9eed1e40be0c4915e2aef98b3771d7af6c\r\n\r\nI see why we don't care about mempool stuff here, but `m_block_stalling_timeout` I'm not so sure. Is this logic completely irrelevant for background sync?",
      "created_at": "2023-08-31T09:39:53Z",
      "updated_at": "2023-08-31T09:53:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311371973",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311371973"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1933,
      "original_line": 1933,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311525906",
      "pull_request_review_id": 1604598585,
      "id": 1311525906,
      "node_id": "PRRC_kwDOABII585OLEwS",
      "diff_hunk": "@@ -4204,7 +4204,7 @@ VerifyDBResult CVerifyDB::VerifyDB(\n     bool skipped_l3_checks{false};\n     LogPrintf(\"Verification progress: 0%%\\n\");\n \n-    const bool is_snapshot_cs{!chainstate.m_from_snapshot_blockhash};\n+    const bool is_snapshot_cs{chainstate.m_from_snapshot_blockhash};",
      "path": "src/validation.cpp",
      "position": 156,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b85530c18bfe24ff434f32f959d8dd843afca54d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"bugfix: correct is_snapshot_cs in VerifyDB\" (b85530c18bfe24ff434f32f959d8dd843afca54d)\r\n\r\nWould it make sense to put this fix or other fixes into a backport PR? If this PR were merged and released with Bitcoin Core 26, would it be possible for someone to load an assumeutxo snapshot with Bitcoin Core 26, then downgrade to Bitcoin Core 25 or 24 and run into bugs processing the snapshot chainstate?",
      "created_at": "2023-08-31T12:03:21Z",
      "updated_at": "2023-08-31T12:28:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311525906",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311525906"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4237,
      "original_line": 4237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311642246",
      "pull_request_review_id": 1604775714,
      "id": 1311642246,
      "node_id": "PRRC_kwDOABII585OLhKG",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);",
      "path": "src/node/blockstorage.cpp",
      "position": 28,
      "original_position": 20,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": 1310410195,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep, looks so to me. Although `MIN_BLOCKS_TO_KEEP` is 288, so probably this would never be able to happen because of how quickly that part of the chain connects.",
      "created_at": "2023-08-31T13:34:08Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311642246",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311642246"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 157,
      "original_line": 157,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311643402",
      "pull_request_review_id": 1604775714,
      "id": 1311643402,
      "node_id": "PRRC_kwDOABII585OLhcK",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    int height = chain.m_chain.Height();",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": 1310432926,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-31T13:35:00Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311643402",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311643402"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311645346",
      "pull_request_review_id": 1604775714,
      "id": 1311645346,
      "node_id": "PRRC_kwDOABII585OLh6i",
      "diff_hunk": "@@ -144,40 +144,58 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    uint64_t nPruneAfterHeight,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    int height = chain.m_chain.Height();\n+    if (height < 0 || target == 0) {\n         return;\n     }\n-    if ((uint64_t)chain_tip_height <= nPruneAfterHeight) {\n+    if ((uint64_t)height <= nPruneAfterHeight) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 59,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": 1310423116,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yep, good point. Done.",
      "created_at": "2023-08-31T13:36:28Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311645346",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311645346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 193,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311646878",
      "pull_request_review_id": 1604775714,
      "id": 1311646878,
      "node_id": "PRRC_kwDOABII585OLiSe",
      "diff_hunk": "@@ -5864,3 +5871,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);\n+\n+    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 48,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": 1310404663,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.\r\n",
      "created_at": "2023-08-31T13:37:39Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311646878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311646878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311647326",
      "pull_request_review_id": 1604775714,
      "id": 1311647326,
      "node_id": "PRRC_kwDOABII585OLiZe",
      "diff_hunk": "@@ -5864,3 +5871,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);\n+\n+    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n+    //\n+    // While you might be tempted to prune the background chainstate more\n+    // aggressively (i.e. fewer MIN_BLOCKS_TO_KEEP), this won't work with index\n+    // building - specifically blockfilterindex requires undo data, and if\n+    // we don't maintain this trailing window, we hit indexation failures.",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 53,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "5e4c824433fb4bf8b380d0f61a0aa424dc5456d4",
      "in_reply_to_id": 1310435694,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-31T13:37:57Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311647326",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311647326"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5895,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311651383",
      "pull_request_review_id": 1604775714,
      "id": 1311651383,
      "node_id": "PRRC_kwDOABII585OLjY3",
      "diff_hunk": "@@ -76,16 +71,21 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     Chainstate& c2 = WITH_LOCK(::cs_main, return manager.ActivateExistingSnapshot(\n         &mempool, snapshot_blockhash));\n     chainstates.push_back(&c2);\n-\n-    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n-\n     c2.InitCoinsDB(\n         /*cache_size_bytes=*/1 << 23, /*in_memory=*/true, /*should_wipe=*/false);\n-    WITH_LOCK(::cs_main, c2.InitCoinsCache(1 << 23));\n-    c2.m_chain.SetTip(*active_tip);\n+    {\n+        LOCK(::cs_main);\n+        c2.InitCoinsCache(1 << 23);\n+        c2.m_chain.SetTip(*active_tip);",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": 1310877098,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point, done.",
      "created_at": "2023-08-31T13:40:43Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311651383",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311651383"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311651919",
      "pull_request_review_id": 1604775714,
      "id": 1311651919,
      "node_id": "PRRC_kwDOABII585OLjhP",
      "diff_hunk": "@@ -76,16 +71,21 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     Chainstate& c2 = WITH_LOCK(::cs_main, return manager.ActivateExistingSnapshot(\n         &mempool, snapshot_blockhash));\n     chainstates.push_back(&c2);\n-\n-    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n-\n     c2.InitCoinsDB(\n         /*cache_size_bytes=*/1 << 23, /*in_memory=*/true, /*should_wipe=*/false);\n-    WITH_LOCK(::cs_main, c2.InitCoinsCache(1 << 23));\n-    c2.m_chain.SetTip(*active_tip);\n+    {\n+        LOCK(::cs_main);\n+        c2.InitCoinsCache(1 << 23);\n+        c2.m_chain.SetTip(*active_tip);\n+        c2.CoinsTip().SetBestBlock(active_tip->GetBlockHash());\n+        c2.setBlockIndexCandidates.insert(manager.m_blockman.LookupBlockIndex(active_tip->GetBlockHash()));\n+        c2.LoadChainTip();\n+    }\n     BlockValidationState _;\n     BOOST_CHECK(c2.ActivateBestChain(_, nullptr));\n \n+    BOOST_CHECK_EQUAL(manager.SnapshotBlockhash().value(), snapshot_blockhash);\n+    BOOST_CHECK(c2.ActivateBestChain(_));",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 66,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": 1310871911,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-08-31T13:41:08Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311651919",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311651919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311653393",
      "pull_request_review_id": 1604775714,
      "id": 1311653393,
      "node_id": "PRRC_kwDOABII585OLj4R",
      "diff_hunk": "@@ -96,14 +96,15 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     auto& active_chain2 = WITH_LOCK(manager.GetMutex(), return manager.ActiveChain());\n     BOOST_CHECK_EQUAL(&active_chain2, &c2.m_chain);\n \n-    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 0);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 110);\n+    mineBlocks(1);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return manager.ActiveHeight()), 111);\n+    BOOST_CHECK_EQUAL(WITH_LOCK(manager.GetMutex(), return c1.m_chain.Height()), 110);\n \n     auto active_tip2 = WITH_LOCK(manager.GetMutex(), return manager.ActiveTip());\n     auto exp_tip2 = c2.m_chain.Tip();\n     BOOST_CHECK_EQUAL(active_tip2, exp_tip2);\n \n-    BOOST_CHECK_EQUAL(exp_tip, exp_tip2);",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": 89,
      "original_position": 84,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": 1310888128,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Makes sense, done.",
      "created_at": "2023-08-31T13:42:15Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311653393",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311653393"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 105,
      "original_line": 105,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311661327",
      "pull_request_review_id": 1604775714,
      "id": 1311661327,
      "node_id": "PRRC_kwDOABII585OLl0P",
      "diff_hunk": "@@ -488,13 +490,13 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n \n     // Note: cs2's tip is not set when ActivateExistingSnapshot is called.\n     Chainstate& cs2 = WITH_LOCK(::cs_main,\n-        return chainman.ActivateExistingSnapshot(&mempool, *assumed_base->phashBlock));\n+        return chainman.ActivateExistingSnapshot(&mempool, *assumed_tip->phashBlock));",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": null,
      "original_position": 131,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "76d616c957522e7be52eaf10b3ac33accaf75c45",
      "in_reply_to_id": 1310901739,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good catch. I think I was grasping at straws trying to get the tests to pass having changed heights to match up with the recognized chainparams snapshots. Not sure what I was thinking.",
      "created_at": "2023-08-31T13:47:56Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311661327",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311661327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 493,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311698766",
      "pull_request_review_id": 1604775714,
      "id": 1311698766,
      "node_id": "PRRC_kwDOABII585OLu9O",
      "diff_hunk": "@@ -290,7 +290,13 @@ bool BlockManager::LoadBlockIndex()\n         // Pruned nodes may have deleted the block.\n         if (pindex->nTx > 0) {\n             if (pindex->pprev) {\n-                if (pindex->pprev->nChainTx > 0) {\n+                if (snapshot_blockhash && pindex->GetBlockHash() == *snapshot_blockhash) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": 1310947552,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oh wow, that's a great simplification - thanks. Fixed.",
      "created_at": "2023-08-31T14:10:49Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311698766",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311698766"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 293,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311708335",
      "pull_request_review_id": 1604775714,
      "id": 1311708335,
      "node_id": "PRRC_kwDOABII585OLxSv",
      "diff_hunk": "@@ -4765,6 +4765,10 @@ void ChainstateManager::CheckBlockIndex()\n     CBlockIndex* pindexFirstAssumeValid = nullptr; // Oldest ancestor of pindex which has BLOCK_ASSUMED_VALID\n     while (pindex != nullptr) {\n         nNodes++;\n+        if (pindex->pprev && pindex->nTx > 0) {\n+            // nChainTx should increase monotonically\n+            assert(pindex->pprev->nChainTx <= pindex->nChainTx);",
      "path": "src/validation.cpp",
      "position": 175,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": 1310950827,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Getting test failures with this change, not certain why:\r\n```\r\n10:17:24 james@fido src/bitcoin (?Â± 11555828ee 1155582) % ./src/test/test_bitcoin\r\nRunning 578 test cases...\r\ntest_bitcoin: validation.cpp:4767: void ChainstateManager::CheckBlockIndex(): Assertion `pindex->nChainTx == pindex->nTx + pindex->pprev->nChainTx' failed.\r\nunknown location(0): fatal error: in \"validation_block_tests/processnewblock_signals_ordering\": signal: SIGABRT (application abort requested)\r\ntest/validation_block_tests.cpp(160): last checkpoint\r\nunknown location(0): fatal error: in \"validation_block_tests/mempool_locks_reorg\": memory access violation at address: 0x5824eadac8d1: no mapping at fault address\r\ntest/validation_block_tests.cpp(224): last checkpoint: \"mempool_locks_reorg\" fixture ctor\r\n\r\n*** 2 failures are detected in the test module \"Bitcoin Core Test Suite\"\r\ntest_bitcoin: checkqueue.h:198: CCheckQueue<CScriptCheck>::~CCheckQueue() [T = CScriptCheck]: Assertion `m_worker_threads.empty()' failed.\r\nzsh: IOT instruction (core dumped)  ./src/test/test_bitcoin\r\n./src/test/test_bitcoin  18.78s user 2.94s system 118% cpu 18.291 total\r\n```\r\n\r\nMaybe worth doing this improvement as a follow-up.",
      "created_at": "2023-08-31T14:17:38Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311708335",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311708335"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4767,
      "original_line": 4767,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311755065",
      "pull_request_review_id": 1604775714,
      "id": 1311755065,
      "node_id": "PRRC_kwDOABII585OL8s5",
      "diff_hunk": "@@ -377,6 +380,42 @@ bool BlockManager::LoadBlockIndexDB(const std::optional<uint256>& snapshot_block\n         }\n     }\n \n+    std::optional<unsigned int> snapshot_base_height{std::nullopt};\n+    if (snapshot_blockhash) {\n+        const auto au_data = GetParams().AssumeutxoForBlockhash(*snapshot_blockhash);\n+        snapshot_base_height = Assert(au_data)->height;\n+    }\n+\n+    {\n+        // Initialize the blockfile cursors.\n+        LOCK(cs_LastBlockFile);\n+        for (size_t i = 0; i < m_blockfile_info.size(); ++i) {\n+            const auto& fileinfo = m_blockfile_info[i];\n+            BlockfileType blockfile_type{BlockfileType::NORMAL};\n+\n+            // If we have a snapshot and the last height tracked by this blockfile\n+            // is in the chain region above the snapshot, updated the ASSUMED cursor.\n+            if (snapshot_base_height && fileinfo.nHeightLast > *snapshot_base_height) {\n+                blockfile_type = BlockfileType::ASSUMED;\n+            }\n+            m_blockfile_cursors[blockfile_type] = {static_cast<int>(i), 0};\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Set blockfile cursor %s to %i\\n\",\n+                blockfile_type, *m_blockfile_cursors[blockfile_type]);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 84,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310985324,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Removed.",
      "created_at": "2023-08-31T14:50:31Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311755065",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311755065"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 402,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 403,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311785924",
      "pull_request_review_id": 1604775714,
      "id": 1311785924,
      "node_id": "PRRC_kwDOABII585OMEPE",
      "diff_hunk": "@@ -583,15 +623,30 @@ void BlockManager::FlushBlockFile(bool fFinalize, bool finalize_undo)\n         // have populated `m_blockfile_info` via LoadBlockIndexDB().\n         return;\n     }\n-    assert(static_cast<int>(m_blockfile_info.size()) > m_last_blockfile);\n+    assert(static_cast<int>(m_blockfile_info.size()) > blockfile_num);\n \n-    FlatFilePos block_pos_old(m_last_blockfile, m_blockfile_info[m_last_blockfile].nSize);\n+    FlatFilePos block_pos_old(blockfile_num, m_blockfile_info[blockfile_num].nSize);\n     if (!BlockFileSeq().Flush(block_pos_old, fFinalize)) {\n         m_opts.notifications.flushError(\"Flushing block file to disk failed. This is likely the result of an I/O error.\");\n     }\n     // we do not always flush the undo file, as the chain tip may be lagging behind the incoming blocks,\n     // e.g. during IBD or a sync after a node going offline\n-    if (!fFinalize || finalize_undo) FlushUndoFile(m_last_blockfile, finalize_undo);\n+    if (!fFinalize || finalize_undo) FlushUndoFile(blockfile_num, finalize_undo);\n+}\n+\n+static BlockfileType BlockfileTypeForRole(ChainstateRole chainstate_role)\n+{\n+    return chainstate_role == ChainstateRole::ASSUMEDVALID ?\n+        BlockfileType::ASSUMED : BlockfileType::NORMAL;",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 148,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1311007889,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Hey thanks for this feedback, this has led to a big simplification in this commit. I had tried to do something like this earlier, but got hung up on the \"snapshot activated during runtime\" case. I forgot that ChainstateManager can just reach into the BlockManager and set the snapshot height dynamically.\r\n\r\nSo that's what I'm doing here, without trying to adapt ChainstateRole to BlockManager behavior. The result is a lot simpler and - as you point out - less buggy!",
      "created_at": "2023-08-31T15:10:29Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311785924",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311785924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 639,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 640,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311789064",
      "pull_request_review_id": 1604775714,
      "id": 1311789064,
      "node_id": "PRRC_kwDOABII585OMFAI",
      "diff_hunk": "@@ -583,15 +623,30 @@ void BlockManager::FlushBlockFile(bool fFinalize, bool finalize_undo)\n         // have populated `m_blockfile_info` via LoadBlockIndexDB().\n         return;\n     }\n-    assert(static_cast<int>(m_blockfile_info.size()) > m_last_blockfile);\n+    assert(static_cast<int>(m_blockfile_info.size()) > blockfile_num);\n \n-    FlatFilePos block_pos_old(m_last_blockfile, m_blockfile_info[m_last_blockfile].nSize);\n+    FlatFilePos block_pos_old(blockfile_num, m_blockfile_info[blockfile_num].nSize);\n     if (!BlockFileSeq().Flush(block_pos_old, fFinalize)) {\n         m_opts.notifications.flushError(\"Flushing block file to disk failed. This is likely the result of an I/O error.\");\n     }\n     // we do not always flush the undo file, as the chain tip may be lagging behind the incoming blocks,\n     // e.g. during IBD or a sync after a node going offline\n-    if (!fFinalize || finalize_undo) FlushUndoFile(m_last_blockfile, finalize_undo);\n+    if (!fFinalize || finalize_undo) FlushUndoFile(blockfile_num, finalize_undo);\n+}\n+\n+static BlockfileType BlockfileTypeForRole(ChainstateRole chainstate_role)\n+{\n+    return chainstate_role == ChainstateRole::ASSUMEDVALID ?\n+        BlockfileType::ASSUMED : BlockfileType::NORMAL;\n+}\n+\n+void BlockManager::FlushChainstateBlockFile(ChainstateRole chainstate_role, bool finalize, bool finalize_undo)\n+{\n+    LOCK(cs_LastBlockFile);\n+    auto& cursor = m_blockfile_cursors[BlockfileTypeForRole(chainstate_role)];\n+    if (cursor) {",
      "path": "src/node/blockstorage.cpp",
      "position": 288,
      "original_position": 155,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310990937,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, added.",
      "created_at": "2023-08-31T15:12:16Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311789064",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311789064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 637,
      "original_line": 637,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311984213",
      "pull_request_review_id": 1604775714,
      "id": 1311984213,
      "node_id": "PRRC_kwDOABII585OM0pV",
      "diff_hunk": "@@ -644,11 +699,22 @@ fs::path BlockManager::GetBlockPosFilename(const FlatFilePos& pos) const\n     return BlockFileSeq().FileName(pos);\n }\n \n-bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigned int nHeight, uint64_t nTime, bool fKnown)\n+bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigned int nHeight, ChainstateRole chainstate_role, uint64_t nTime, bool fKnown)\n {\n     LOCK(cs_LastBlockFile);\n \n-    unsigned int nFile = fKnown ? pos.nFile : m_last_blockfile;\n+    const BlockfileType chain_type = BlockfileTypeForRole(chainstate_role);\n+\n+    if (!m_blockfile_cursors[chain_type]) {\n+        // If a snapshot is loaded during runtime, we may not have initialized this cursor yet.\n+        assert(chain_type == BlockfileType::ASSUMED);\n+        const auto new_cursor = BlockfileCursor{this->MaxBlockfileNum() + 1, 0};\n+        m_blockfile_cursors[chain_type] = new_cursor;\n+        LogPrint(BCLog::BLOCKSTORAGE, \"[%s] initializing blockfile cursor to %s\\n\", chainstate_role, new_cursor);\n+    }\n+    const unsigned int last_blockfile = m_blockfile_cursors[chain_type]->file_num;",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 180,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310998317,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Okay, sounds good.",
      "created_at": "2023-08-31T17:43:32Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311984213",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311984213"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 715,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311986681",
      "pull_request_review_id": 1604775714,
      "id": 1311986681,
      "node_id": "PRRC_kwDOABII585OM1P5",
      "diff_hunk": "@@ -680,13 +753,14 @@ bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigne\n         pos.nPos = m_blockfile_info[nFile].nSize;\n     }\n \n-    if ((int)nFile != m_last_blockfile) {\n+    if (nFile != last_blockfile) {\n         if (!fKnown) {\n-            LogPrint(BCLog::BLOCKSTORAGE, \"Leaving block file %i: %s\\n\", m_last_blockfile, m_blockfile_info[m_last_blockfile].ToString());\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Leaving block file %i: %s (onto %i) (height %i)\\n\",\n+                m_last_blockfile, m_blockfile_info[last_blockfile].ToString(), nFile, nHeight);",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 217,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310965708,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oops, done.",
      "created_at": "2023-08-31T17:45:40Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311986681",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311986681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 759,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311988064",
      "pull_request_review_id": 1604775714,
      "id": 1311988064,
      "node_id": "PRRC_kwDOABII585OM1lg",
      "diff_hunk": "@@ -70,6 +71,30 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.",
      "path": "src/node/blockstorage.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310979704,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've just removed the comment because I don't think it adds much anymore.",
      "created_at": "2023-08-31T17:46:33Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311988064",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311988064"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": 74,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": 75,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311990281",
      "pull_request_review_id": 1604775714,
      "id": 1311990281,
      "node_id": "PRRC_kwDOABII585OM2IJ",
      "diff_hunk": "@@ -70,6 +71,30 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.\n+    NORMAL,\n+    ASSUMED,\n+};\n+\n+std::ostream& operator<<(std::ostream& os, const BlockfileType& type);\n+\n+struct BlockfileCursor {\n+    // The latest blockfile number.\n+    int file_num{0};\n+\n+    // Track the largest height block whose undo data is in `file_num` blockfile.\n+    // When we move to the next blockfile, if the undo data is keeping up then\n+    // we know we can trim the size of the file and truncate any excess\n+    // allocations. If not, we assume that eventually we'll add more undo data\n+    // to this file, and when we revisit it we'll trim it then.\n+    int undo_height{0};",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 30,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310971801,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oops, silent merge conflict. Fixed.\r\n\r\n`m_last_blockfile` just didn't make much sense to me when you're already in the context of a blockfile cursor; within that scope, `file_num` felt like it was a complete description. Same rationale for the other.",
      "created_at": "2023-08-31T17:47:53Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311990281",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1311990281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 87,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 96,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312004094",
      "pull_request_review_id": 1605373711,
      "id": 1312004094,
      "node_id": "PRRC_kwDOABII585OM5f-",
      "diff_hunk": "@@ -5205,6 +5205,9 @@ bool ChainstateManager::ActivateSnapshot(\n         const bool chaintip_loaded = m_snapshot_chainstate->LoadChainTip();\n         assert(chaintip_loaded);\n \n+        // Transfer possession of the mempool to the snapshot chianstate.\n+        m_snapshot_chainstate->m_mempool = m_active_chainstate->m_mempool;",
      "path": "src/validation.cpp",
      "position": 223,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "f2dd7a0c1b67d3e4a6e086a619eff34fe6625263",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: assumeutxo: swap m_mempool on snapshot activation\" (f2dd7a0c1b67d3e4a6e086a619eff34fe6625263)\r\n\r\nCan this code assert that the mempool is empty, or clear it, or else explain why contents of the mempool transactions are compatible with m_snapshot_chainstate?\r\n\r\nIt would also be good to assert existing m_snapshot_chainstate pointer is not set, and make the `ActivateSnapshot` and `ActivateExistingSnapshot` versions of this code the same.",
      "created_at": "2023-08-31T17:59:11Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312004094",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312004094"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5206,
      "original_line": 5206,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312011711",
      "pull_request_review_id": 1604775714,
      "id": 1312011711,
      "node_id": "PRRC_kwDOABII585OM7W_",
      "diff_hunk": "@@ -5831,6 +5898,13 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             std::vector<const CBlockIndex*> vToDownload;\n             NodeId staller = -1;\n             FindNextBlocksToDownload(*peer, MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(), vToDownload, staller);\n+            if (m_chainman.BackgroundSyncInProgress() && !IsLimitedPeer(*peer)) {\n+                TryDownloadingHistoricalBlocks(\n+                    *peer,\n+                    MAX_BLOCKS_IN_TRANSIT_PER_PEER - state.vBlocksInFlight.size(),",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 122,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "7b93d4adc976bdb32306951b21d7c98d9dacc972",
      "in_reply_to_id": 1311331956,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, now avoiding underflow with cast + max.",
      "created_at": "2023-08-31T18:06:58Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312011711",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312011711"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5904,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312013386",
      "pull_request_review_id": 1604775714,
      "id": 1312013386,
      "node_id": "PRRC_kwDOABII585OM7xK",
      "diff_hunk": "@@ -5737,6 +5737,16 @@ bool ChainstateManager::DeleteSnapshotChainstate()\n     return true;\n }\n \n+ChainstateRole Chainstate::GetRole() const\n+{\n+    if (m_chainman.GetAll().size() <= 1) {",
      "path": "src/validation.cpp",
      "position": 329,
      "original_position": 6,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "288dd732b5c0085618598fe3dbba23ac6d194173",
      "in_reply_to_id": 1311353331,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a pointer to the ChainstateManager documentation this.",
      "created_at": "2023-08-31T18:08:39Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312013386",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312013386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5780,
      "original_line": 5780,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312025166",
      "pull_request_review_id": 1605373711,
      "id": 1312025166,
      "node_id": "PRRC_kwDOABII585OM-pO",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add loadtxoutset\" (82a8744f1384f07dc30aaa6339b0b8fb32dc3af0)\r\n\r\nWould be good to simplify and remove gArgs reference:\r\n\r\n```diff\r\n--- a/src/rpc/blockchain.cpp\r\n+++ b/src/rpc/blockchain.cpp\r\n@@ -2718,10 +2718,8 @@ static RPCHelpMan loadtxoutset()\r\n         },\r\n         [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\r\n {\r\n-    fs::path path = fs::PathFromString(request.params[0].get_str());\r\n-    if (path.is_relative()) {\r\n-        path = gArgs.GetDataDirNet() / path;\r\n-    }\r\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\r\n+    fs::path path{AbsPathForConfigVal(EnsureArgsman(node), fs::u8path(request.params[0].get_str()))};\r\n     FILE* file{fsbridge::fopen(path, \"rb\")};\r\n     CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\r\n     if (afile.IsNull()) {\r\n@@ -2739,7 +2737,6 @@ static RPCHelpMan loadtxoutset()\r\n     LogPrintf(\"[snapshot] waiting to see blockheader %s in headers chain before snapshot activation\\n\",\r\n         base_blockhash.ToString());\r\n \r\n-    NodeContext& node = EnsureAnyNodeContext(request.context);\r\n     ChainstateManager& chainman = *node.chainman;\r\n \r\n     while (max_secs_to_wait_for_headers > 0) {\r\n\r\n```",
      "created_at": "2023-08-31T18:13:20Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312025166",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312025166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2723,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312027712",
      "pull_request_review_id": 1604775714,
      "id": 1312027712,
      "node_id": "PRRC_kwDOABII585OM_RA",
      "diff_hunk": "@@ -1961,7 +1965,10 @@ void PeerManagerImpl::BlockDisconnected(const std::shared_ptr<const CBlock> &blo\n  * Maintain state about the best-seen block and fast-announce a compact block\n  * to compatible peers.\n  */\n-void PeerManagerImpl::NewPoWValidBlock(const CBlockIndex *pindex, const std::shared_ptr<const CBlock>& pblock)\n+void PeerManagerImpl::NewPoWValidBlock(",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "d3b533d3f1e80addca2ab0b3ee97215d5d03d984",
      "in_reply_to_id": 1311360137,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Unclear if clients only want to know about NewPoWValidBlocks for background chainstate, but since the only usage is ignored (`PeerManagerImpl`) I'll just remove the role parameter and avoiding sending the notification from non-active chainstates.",
      "created_at": "2023-08-31T18:14:00Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312027712",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312027712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1968,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312036195",
      "pull_request_review_id": 1605373711,
      "id": 1312036195,
      "node_id": "PRRC_kwDOABII585ONBVj",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n+    if (afile.IsNull()) {\n+        throw JSONRPCError(\n+            RPC_INVALID_PARAMETER,\n+            \"Couldn't open file \" + path.u8string() + \" for reading.\");\n+    }\n+    SnapshotMetadata metadata;\n+    afile >> metadata;\n+\n+    uint256 base_blockhash = metadata.m_base_blockhash;\n+    int max_secs_to_wait_for_headers = 60 * 10;\n+    CBlockIndex* snapshot_start_block = nullptr;\n+\n+    LogPrintf(\"[snapshot] waiting to see blockheader %s in headers chain before snapshot activation\\n\",\n+        base_blockhash.ToString());\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    while (max_secs_to_wait_for_headers > 0) {\n+        {\n+            LOCK(cs_main);\n+            snapshot_start_block = chainman.m_blockman.LookupBlockIndex(base_blockhash);\n+        }\n+        max_secs_to_wait_for_headers -= 1;\n+\n+        if (!snapshot_start_block) {\n+            std::this_thread::sleep_for(std::chrono::seconds(1));\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    if (snapshot_start_block == nullptr) {\n+        LogPrintf(\"[snapshot] timed out waiting for snapshot start blockheader %s\\n\",\n+            base_blockhash.ToString());\n+        throw JSONRPCError(\n+            RPC_INTERNAL_ERROR,\n+            \"Timed out waiting for base block header to appear in headers chain\");\n+    }\n+\n+    // TODO jamesob: no real need to lock cs_main here, but during testing it makes it\n+    // easier to follow the logs. We may want to remove this before merge.\n+    //\n+    LOCK(::cs_main);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 72,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add loadtxoutset\" (82a8744f1384f07dc30aaa6339b0b8fb32dc3af0)\r\n\r\nShould probably remove this if testing code which isn't assuming cs_main is locked.",
      "created_at": "2023-08-31T18:18:13Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312036195",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312036195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 2767,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2770,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312037894",
      "pull_request_review_id": 1605373711,
      "id": 1312037894,
      "node_id": "PRRC_kwDOABII585ONBwG",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add loadtxoutset\" (82a8744f1384f07dc30aaa6339b0b8fb32dc3af0)\r\n\r\nMissing result description",
      "created_at": "2023-08-31T18:19:59Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312037894",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312037894"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 2713,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2722,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312038932",
      "pull_request_review_id": 1605373711,
      "id": 1312038932,
      "node_id": "PRRC_kwDOABII585ONCAU",
      "diff_hunk": "@@ -2729,6 +2814,7 @@ void RegisterBlockchainRPCCommands(CRPCTable& t)\n         {\"hidden\", &waitforblockheight},\n         {\"hidden\", &syncwithvalidationinterfacequeue},\n         {\"hidden\", &dumptxoutset},\n+        {\"hidden\", &loadtxoutset},",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add loadtxoutset\" (82a8744f1384f07dc30aaa6339b0b8fb32dc3af0)\r\n\r\nShould dumptxoutset and loadtxoutset still be hidden?",
      "created_at": "2023-08-31T18:21:07Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312038932",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312038932"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2880,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312040274",
      "pull_request_review_id": 1605373711,
      "id": 1312040274,
      "node_id": "PRRC_kwDOABII585ONCVS",
      "diff_hunk": "@@ -2784,6 +2784,69 @@ static RPCHelpMan loadtxoutset()\n     };\n }\n \n+static RPCHelpMan getchainstates()\n+{\n+return RPCHelpMan{\n+        \"getchainstates\",\n+        \"\\nReturn information about chainstates.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 11,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "555206238129c6ed9fcbbc498c81455c7fe6d851",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add getchainstates\" (555206238129c6ed9fcbbc498c81455c7fe6d851)\r\n\r\nMissing documentation for return value",
      "created_at": "2023-08-31T18:22:28Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312040274",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312040274"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2794,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312045678",
      "pull_request_review_id": 1605373711,
      "id": 1312045678,
      "node_id": "PRRC_kwDOABII585ONDpu",
      "diff_hunk": "@@ -2784,6 +2784,69 @@ static RPCHelpMan loadtxoutset()\n     };\n }\n \n+static RPCHelpMan getchainstates()\n+{\n+return RPCHelpMan{\n+        \"getchainstates\",\n+        \"\\nReturn information about chainstates.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getchainstates\", \"\")\n+    + HelpExampleRpc(\"getchainstates\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    LOCK(cs_main);\n+    UniValue obj(UniValue::VOBJ);\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    auto make_chain_data = [&](Chainstate* cs) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n+        AssertLockHeld(::cs_main);\n+        UniValue data(UniValue::VOBJ);\n+        if (!cs || !cs->m_chain.Tip()) {\n+            return data;\n+        }\n+        const CChain& chain = cs->m_chain;\n+        const CBlockIndex* tip = chain.Tip();\n+\n+        data.pushKV(\"blocks\",                (int)chain.Height());\n+        data.pushKV(\"bestblockhash\",         tip->GetBlockHash().GetHex());\n+        data.pushKV(\"difficulty\",            (double)GetDifficulty(tip));\n+        data.pushKV(\"verificationprogress\",  GuessVerificationProgress(Params().TxData(), tip));\n+        data.pushKV(\"snapshot_blockhash\",    cs->m_from_snapshot_blockhash.value_or(uint256{}).ToString());",
      "path": "src/rpc/blockchain.cpp",
      "position": 152,
      "original_position": 38,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "555206238129c6ed9fcbbc498c81455c7fe6d851",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add getchainstates\" (555206238129c6ed9fcbbc498c81455c7fe6d851)\r\n\r\nProbably would be a little better to make this null instead of \"\" if unset",
      "created_at": "2023-08-31T18:27:14Z",
      "updated_at": "2023-08-31T18:32:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312045678",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312045678"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2843,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312046441",
      "pull_request_review_id": 1604775714,
      "id": 1312046441,
      "node_id": "PRRC_kwDOABII585OND1p",
      "diff_hunk": "@@ -1916,9 +1916,15 @@ void PeerManagerImpl::BlockConnected(\n     const std::shared_ptr<const CBlock>& pblock,\n     const CBlockIndex* pindex)\n {\n-    m_orphanage.EraseForBlock(*pblock);\n+    // Update this for all chainstate roles so that we don't mistakenly see peers\n+    // helping us do background IBD as having a stale tip.\n     m_last_tip_update = GetTime<std::chrono::seconds>();\n \n+    if (role == ChainstateRole::BACKGROUND) {",
      "path": "src/net_processing.cpp",
      "position": 157,
      "original_position": 9,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "fbd05a9eed1e40be0c4915e2aef98b3771d7af6c",
      "in_reply_to_id": 1311371973,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good point! The `m_block_stalling_timeout` was added about a year ago, so when preparing these changes I didn't consider it. It looks like we should keep it up to date for both chainstates. Fixed.",
      "created_at": "2023-08-31T18:28:03Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312046441",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312046441"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1933,
      "original_line": 1933,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312047335",
      "pull_request_review_id": 1604775714,
      "id": 1312047335,
      "node_id": "PRRC_kwDOABII585ONEDn",
      "diff_hunk": "@@ -4204,7 +4204,7 @@ VerifyDBResult CVerifyDB::VerifyDB(\n     bool skipped_l3_checks{false};\n     LogPrintf(\"Verification progress: 0%%\\n\");\n \n-    const bool is_snapshot_cs{!chainstate.m_from_snapshot_blockhash};\n+    const bool is_snapshot_cs{chainstate.m_from_snapshot_blockhash};",
      "path": "src/validation.cpp",
      "position": 156,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b85530c18bfe24ff434f32f959d8dd843afca54d",
      "in_reply_to_id": 1311525906,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "My inclination is to say that if the user begins snapshot use with a client that has this changeset, they won't be able to downgrade without issue until the snapshot is validated (based on e.g. the net_processing changes here). I'm not sure where the best place to convey that would be... release notes?",
      "created_at": "2023-08-31T18:29:07Z",
      "updated_at": "2023-08-31T18:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312047335",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312047335"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4237,
      "original_line": 4237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312095629",
      "pull_request_review_id": 1605519579,
      "id": 1312095629,
      "node_id": "PRRC_kwDOABII585ONP2N",
      "diff_hunk": "@@ -5205,6 +5205,9 @@ bool ChainstateManager::ActivateSnapshot(\n         const bool chaintip_loaded = m_snapshot_chainstate->LoadChainTip();\n         assert(chaintip_loaded);\n \n+        // Transfer possession of the mempool to the snapshot chianstate.\n+        m_snapshot_chainstate->m_mempool = m_active_chainstate->m_mempool;",
      "path": "src/validation.cpp",
      "position": 223,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "f2dd7a0c1b67d3e4a6e086a619eff34fe6625263",
      "in_reply_to_id": 1312004094,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> It would also be good to assert existing m_snapshot_chainstate pointer is not set, and make the ActivateSnapshot and ActivateExistingSnapshot versions of this code the same.\r\n\r\nThat assertion happens here: https://github.com/bitcoin/bitcoin/blob/1b1d7110e67da11752ae1efadb1c12a9054eb867/src/validation.cpp#L5189\r\n\r\nEdit: oh oops, you're probably talking about `m_snapshot_chainstate->m_mempool`, which isn't checked.",
      "created_at": "2023-08-31T19:10:01Z",
      "updated_at": "2023-08-31T19:39:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312095629",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312095629"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5206,
      "original_line": 5206,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312115645",
      "pull_request_review_id": 1605548247,
      "id": 1312115645,
      "node_id": "PRRC_kwDOABII585ONUu9",
      "diff_hunk": "@@ -377,6 +380,42 @@ bool BlockManager::LoadBlockIndexDB(const std::optional<uint256>& snapshot_block\n         }\n     }\n \n+    std::optional<unsigned int> snapshot_base_height{std::nullopt};\n+    if (snapshot_blockhash) {\n+        const auto au_data = GetParams().AssumeutxoForBlockhash(*snapshot_blockhash);\n+        snapshot_base_height = Assert(au_data)->height;\n+    }\n+\n+    {\n+        // Initialize the blockfile cursors.\n+        LOCK(cs_LastBlockFile);\n+        for (size_t i = 0; i < m_blockfile_info.size(); ++i) {\n+            const auto& fileinfo = m_blockfile_info[i];\n+            BlockfileType blockfile_type{BlockfileType::NORMAL};\n+\n+            // If we have a snapshot and the last height tracked by this blockfile\n+            // is in the chain region above the snapshot, updated the ASSUMED cursor.\n+            if (snapshot_base_height && fileinfo.nHeightLast > *snapshot_base_height) {\n+                blockfile_type = BlockfileType::ASSUMED;\n+            }\n+            m_blockfile_cursors[blockfile_type] = {static_cast<int>(i), 0};\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Set blockfile cursor %s to %i\\n\",\n+                blockfile_type, *m_blockfile_cursors[blockfile_type]);\n+        }\n+\n+        // If we haven't yet seen an ASSUMED blockfile, plan to use the one past the\n+        // last NORMAL blockfile.\n+        if (snapshot_blockhash && !m_blockfile_cursors[BlockfileType::ASSUMED]) {\n+            const auto newcursor = BlockfileCursor{this->MaxBlockfileNum() + 1, 0};\n+            m_blockfile_cursors[BlockfileType::ASSUMED] = newcursor;\n+            LogPrint(BCLog::BLOCKSTORAGE, \"Initialized empty assumed blockfile cursor to %i\\n\", newcursor);\n+        }",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310992182,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, thanks.",
      "created_at": "2023-08-31T19:16:48Z",
      "updated_at": "2023-08-31T19:16:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312115645",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312115645"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 406,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 404,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312293323",
      "pull_request_review_id": 1605787687,
      "id": 1312293323,
      "node_id": "PRRC_kwDOABII585OOAHL",
      "diff_hunk": "@@ -4204,7 +4204,7 @@ VerifyDBResult CVerifyDB::VerifyDB(\n     bool skipped_l3_checks{false};\n     LogPrintf(\"Verification progress: 0%%\\n\");\n \n-    const bool is_snapshot_cs{!chainstate.m_from_snapshot_blockhash};\n+    const bool is_snapshot_cs{chainstate.m_from_snapshot_blockhash};",
      "path": "src/validation.cpp",
      "position": 156,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "b85530c18bfe24ff434f32f959d8dd843afca54d",
      "in_reply_to_id": 1311525906,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312047335\r\n\r\n> My inclination is to say that if the user begins snapshot use with a client that has this changeset, they won't be able to downgrade without issue until the snapshot is validated (based on e.g. the net_processing changes here). I'm not sure where the best place to convey that would be... release notes?\r\n\r\nI think the most helpful place would be the `loadtxoutset` RPC documentation, saying that using the  `loadtxoutset`  RPC will make it temporarily not possible to downgrade the node software until the snapshot is validated, and then after that it will be safe to downgrade again.\r\n\r\nI wonder if we can do something simple to avoid this problem, though, like tweaking the snapshot chainstate directory name before releasing, so old software ignores it, or backporting a patch to the stable branches that  makes them ignore the directory.\r\n\r\n",
      "created_at": "2023-08-31T21:18:08Z",
      "updated_at": "2023-08-31T21:18:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1312293323",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1312293323"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4237,
      "original_line": 4237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314295003",
      "pull_request_review_id": 1608559074,
      "id": 1314295003,
      "node_id": "PRRC_kwDOABII585OVozb",
      "diff_hunk": "@@ -144,40 +144,57 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    auto chain_tip_height = static_cast<uint64_t>(chain.m_chain.Height());\n+    if (chain_tip_height < 0 || target == 0) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: pruning for multiple chainstates\" (51622e9c1f7ed16f65844817a4a5e9bcbc157b4f)\r\n\r\nThis line gives a compilation warning. Checking if a `uint64_t` is negative is always false, and the `static_cast<uint64_t>` is also a possible underflow error if `chain.m_chain.Height() == -1`.\r\n\r\nPerhaps check if `chain.m_chain.Height() < 0` first and then assign to `chain_tip_height` after this line?",
      "created_at": "2023-09-03T17:51:21Z",
      "updated_at": "2023-09-03T17:52:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1314295003",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314295003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314610529",
      "pull_request_review_id": 1609034756,
      "id": 1314610529,
      "node_id": "PRRC_kwDOABII585OW11h",
      "diff_hunk": "@@ -0,0 +1,7 @@\n+Pruning\n+-------\n+\n+When using assumeutxo with `-prune`, the prune budget may be exceeded. Prune budget is",
      "path": "doc/release-notes-27596.md",
      "position": null,
      "original_position": 4,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f\r\n\r\nIt might be helpful to be more precise here (and in the prune doc). This is what a user (not a dev) will need to know assuming they have limited memory, no?\r\n\r\nHow large the exceeding can be?",
      "created_at": "2023-09-04T08:33:57Z",
      "updated_at": "2023-09-04T08:35:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1314610529",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314610529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314618726",
      "pull_request_review_id": 1609046035,
      "id": 1314618726,
      "node_id": "PRRC_kwDOABII585OW31m",
      "diff_hunk": "@@ -5863,3 +5867,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": null,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f\r\n\r\nit's better to have std::max at this line, not below. This way I spend much less time thinking about the underflow, so does a future reviewer.",
      "created_at": "2023-09-04T08:39:00Z",
      "updated_at": "2023-09-04T08:39:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1314618726",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314618726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5884,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314635072",
      "pull_request_review_id": 1609071331,
      "id": 1314635072,
      "node_id": "PRRC_kwDOABII585OW71A",
      "diff_hunk": "@@ -4765,6 +4765,10 @@ void ChainstateManager::CheckBlockIndex()\n     CBlockIndex* pindexFirstAssumeValid = nullptr; // Oldest ancestor of pindex which has BLOCK_ASSUMED_VALID\n     while (pindex != nullptr) {\n         nNodes++;\n+        if (pindex->pprev && pindex->nTx > 0) {\n+            // nChainTx should increase monotonically\n+            assert(pindex->pprev->nChainTx <= pindex->nChainTx);",
      "path": "src/validation.cpp",
      "position": 175,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": 1310950827,
      "user": {
        "login": "naumenkogs",
        "id": 7975071,
        "node_id": "MDQ6VXNlcjc5NzUwNzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7975071?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/naumenkogs",
        "html_url": "https://github.com/naumenkogs",
        "followers_url": "https://api.github.com/users/naumenkogs/followers",
        "following_url": "https://api.github.com/users/naumenkogs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/naumenkogs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/naumenkogs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/naumenkogs/subscriptions",
        "organizations_url": "https://api.github.com/users/naumenkogs/orgs",
        "repos_url": "https://api.github.com/users/naumenkogs/repos",
        "events_url": "https://api.github.com/users/naumenkogs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/naumenkogs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Well in theory that code is certainly prone to overflows, but I'm not sure whether that's the cause of a failure :)",
      "created_at": "2023-09-04T08:52:30Z",
      "updated_at": "2023-09-04T08:52:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1314635072",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1314635072"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4767,
      "original_line": 4767,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319642325",
      "pull_request_review_id": 1617109738,
      "id": 1319642325,
      "node_id": "PRRC_kwDOABII585OqCTV",
      "diff_hunk": "@@ -5205,6 +5205,9 @@ bool ChainstateManager::ActivateSnapshot(\n         const bool chaintip_loaded = m_snapshot_chainstate->LoadChainTip();\n         assert(chaintip_loaded);\n \n+        // Transfer possession of the mempool to the snapshot chianstate.\n+        m_snapshot_chainstate->m_mempool = m_active_chainstate->m_mempool;",
      "path": "src/validation.cpp",
      "position": 223,
      "original_position": 5,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "f2dd7a0c1b67d3e4a6e086a619eff34fe6625263",
      "in_reply_to_id": 1312004094,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added an assertion and comments. In practice, the mempool will be empty here because we wouldn't activate a snapshot outside of IBD, and acceptance to the mempool is closed until IBD completes. I'll add assertions elsewhere for that.",
      "created_at": "2023-09-08T09:52:36Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319642325",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319642325"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5206,
      "original_line": 5206,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319668545",
      "pull_request_review_id": 1617109738,
      "id": 1319668545,
      "node_id": "PRRC_kwDOABII585OqItB",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 25,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": 1312025166,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, thanks.",
      "created_at": "2023-09-08T10:17:02Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319668545",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319668545"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2723,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319668643",
      "pull_request_review_id": 1617109738,
      "id": 1319668643,
      "node_id": "PRRC_kwDOABII585OqIuj",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": 1312037894,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2023-09-08T10:17:08Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319668643",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319668643"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 2713,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2722,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319670355",
      "pull_request_review_id": 1617109738,
      "id": 1319670355,
      "node_id": "PRRC_kwDOABII585OqJJT",
      "diff_hunk": "@@ -2699,6 +2699,91 @@ UniValue CreateUTXOSnapshot(\n     return result;\n }\n \n+static RPCHelpMan loadtxoutset()\n+{\n+    return RPCHelpMan{\n+        \"loadtxoutset\",\n+        \"Load the serialized UTXO set from disk.\",\n+        {\n+            {\"path\",\n+                RPCArg::Type::STR,\n+                RPCArg::Optional::NO,\n+                \"path to the snapshot file. If relative, will be prefixed by datadir.\"},\n+        },\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"loadtxoutset\", \"utxo.dat\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    fs::path path = fs::PathFromString(request.params[0].get_str());\n+    if (path.is_relative()) {\n+        path = gArgs.GetDataDirNet() / path;\n+    }\n+    FILE* file{fsbridge::fopen(path, \"rb\")};\n+    CAutoFile afile{file, SER_DISK, CLIENT_VERSION};\n+    if (afile.IsNull()) {\n+        throw JSONRPCError(\n+            RPC_INVALID_PARAMETER,\n+            \"Couldn't open file \" + path.u8string() + \" for reading.\");\n+    }\n+    SnapshotMetadata metadata;\n+    afile >> metadata;\n+\n+    uint256 base_blockhash = metadata.m_base_blockhash;\n+    int max_secs_to_wait_for_headers = 60 * 10;\n+    CBlockIndex* snapshot_start_block = nullptr;\n+\n+    LogPrintf(\"[snapshot] waiting to see blockheader %s in headers chain before snapshot activation\\n\",\n+        base_blockhash.ToString());\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    while (max_secs_to_wait_for_headers > 0) {\n+        {\n+            LOCK(cs_main);\n+            snapshot_start_block = chainman.m_blockman.LookupBlockIndex(base_blockhash);\n+        }\n+        max_secs_to_wait_for_headers -= 1;\n+\n+        if (!snapshot_start_block) {\n+            std::this_thread::sleep_for(std::chrono::seconds(1));\n+        } else {\n+            break;\n+        }\n+    }\n+\n+    if (snapshot_start_block == nullptr) {\n+        LogPrintf(\"[snapshot] timed out waiting for snapshot start blockheader %s\\n\",\n+            base_blockhash.ToString());\n+        throw JSONRPCError(\n+            RPC_INTERNAL_ERROR,\n+            \"Timed out waiting for base block header to appear in headers chain\");\n+    }\n+\n+    // TODO jamesob: no real need to lock cs_main here, but during testing it makes it\n+    // easier to follow the logs. We may want to remove this before merge.\n+    //\n+    LOCK(::cs_main);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 72,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": 1312036195,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-09-08T10:18:56Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319670355",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319670355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": 2767,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 2770,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319670520",
      "pull_request_review_id": 1617109738,
      "id": 1319670520,
      "node_id": "PRRC_kwDOABII585OqJL4",
      "diff_hunk": "@@ -2729,6 +2814,7 @@ void RegisterBlockchainRPCCommands(CRPCTable& t)\n         {\"hidden\", &waitforblockheight},\n         {\"hidden\", &syncwithvalidationinterfacequeue},\n         {\"hidden\", &dumptxoutset},\n+        {\"hidden\", &loadtxoutset},",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 96,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "82a8744f1384f07dc30aaa6339b0b8fb32dc3af0",
      "in_reply_to_id": 1312038932,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, good point. Fixed.",
      "created_at": "2023-09-08T10:19:06Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319670520",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319670520"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2880,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319700227",
      "pull_request_review_id": 1617109738,
      "id": 1319700227,
      "node_id": "PRRC_kwDOABII585OqQcD",
      "diff_hunk": "@@ -2784,6 +2784,69 @@ static RPCHelpMan loadtxoutset()\n     };\n }\n \n+static RPCHelpMan getchainstates()\n+{\n+return RPCHelpMan{\n+        \"getchainstates\",\n+        \"\\nReturn information about chainstates.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",\n+        },\n+        RPCExamples{\n+            HelpExampleCli(\"getchainstates\", \"\")\n+    + HelpExampleRpc(\"getchainstates\", \"\")\n+        },\n+        [&](const RPCHelpMan& self, const JSONRPCRequest& request) -> UniValue\n+{\n+    LOCK(cs_main);\n+    UniValue obj(UniValue::VOBJ);\n+\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    ChainstateManager& chainman = *node.chainman;\n+\n+    auto make_chain_data = [&](Chainstate* cs) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\n+        AssertLockHeld(::cs_main);\n+        UniValue data(UniValue::VOBJ);\n+        if (!cs || !cs->m_chain.Tip()) {\n+            return data;\n+        }\n+        const CChain& chain = cs->m_chain;\n+        const CBlockIndex* tip = chain.Tip();\n+\n+        data.pushKV(\"blocks\",                (int)chain.Height());\n+        data.pushKV(\"bestblockhash\",         tip->GetBlockHash().GetHex());\n+        data.pushKV(\"difficulty\",            (double)GetDifficulty(tip));\n+        data.pushKV(\"verificationprogress\",  GuessVerificationProgress(Params().TxData(), tip));\n+        data.pushKV(\"snapshot_blockhash\",    cs->m_from_snapshot_blockhash.value_or(uint256{}).ToString());",
      "path": "src/rpc/blockchain.cpp",
      "position": 152,
      "original_position": 38,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "555206238129c6ed9fcbbc498c81455c7fe6d851",
      "in_reply_to_id": 1312045678,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Actually have no idea how to express \"std::string or null\" in our RPC framework... is this possible?",
      "created_at": "2023-09-08T10:51:02Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319700227",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319700227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2843,
      "original_line": 2843,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319702230",
      "pull_request_review_id": 1617109738,
      "id": 1319702230,
      "node_id": "PRRC_kwDOABII585OqQ7W",
      "diff_hunk": "@@ -2784,6 +2784,69 @@ static RPCHelpMan loadtxoutset()\n     };\n }\n \n+static RPCHelpMan getchainstates()\n+{\n+return RPCHelpMan{\n+        \"getchainstates\",\n+        \"\\nReturn information about chainstates.\\n\",\n+        {},\n+        RPCResult{\n+            RPCResult::Type::ELISION, \"\", \"\",",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 11,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "555206238129c6ed9fcbbc498c81455c7fe6d851",
      "in_reply_to_id": 1312040274,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2023-09-08T10:53:20Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319702230",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319702230"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2794,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319704895",
      "pull_request_review_id": 1617109738,
      "id": 1319704895,
      "node_id": "PRRC_kwDOABII585OqRk_",
      "diff_hunk": "@@ -144,40 +144,57 @@ void BlockManager::PruneOneBlockFile(const int fileNumber)\n     m_dirty_fileinfo.insert(fileNumber);\n }\n \n-void BlockManager::FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight, int chain_tip_height)\n+void BlockManager::FindFilesToPruneManual(\n+    std::set<int>& setFilesToPrune,\n+    int nManualPruneHeight,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     assert(IsPruneMode() && nManualPruneHeight > 0);\n \n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0) {\n+    if (chain.m_chain.Height() < 0) {\n         return;\n     }\n \n-    // last block to prune is the lesser of (user-specified height, MIN_BLOCKS_TO_KEEP from the tip)\n-    unsigned int nLastBlockWeCanPrune = std::min((unsigned)nManualPruneHeight, chain_tip_height - MIN_BLOCKS_TO_KEEP);\n+    const auto [min_block_to_prune, last_block_can_prune] = chainman.GetPruneRange(chain, nManualPruneHeight);\n+\n     int count = 0;\n     for (int fileNumber = 0; fileNumber < m_last_blockfile; fileNumber++) {\n-        if (m_blockfile_info[fileNumber].nSize == 0 || m_blockfile_info[fileNumber].nHeightLast > nLastBlockWeCanPrune) {\n+        const auto& fileinfo = m_blockfile_info[fileNumber];\n+        if (fileinfo.nSize == 0 || fileinfo.nHeightLast > (unsigned)last_block_can_prune || fileinfo.nHeightFirst < (unsigned)min_block_to_prune) {\n             continue;\n         }\n+\n         PruneOneBlockFile(fileNumber);\n         setFilesToPrune.insert(fileNumber);\n         count++;\n     }\n-    LogPrintf(\"Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\", nLastBlockWeCanPrune, count);\n+    LogPrintf(\"[%s] Prune (Manual): prune_height=%d removed %d blk/rev pairs\\n\",\n+        chain.GetRole(), last_block_can_prune, count);\n }\n \n-void BlockManager::FindFilesToPrune(std::set<int>& setFilesToPrune, uint64_t nPruneAfterHeight, int chain_tip_height, int prune_height, bool is_ibd)\n+void BlockManager::FindFilesToPrune(\n+    std::set<int>& setFilesToPrune,\n+    int last_prune,\n+    const Chainstate& chain,\n+    ChainstateManager& chainman)\n {\n     LOCK2(cs_main, cs_LastBlockFile);\n-    if (chain_tip_height < 0 || GetPruneTarget() == 0) {\n+    // Distribute our -prune budget over all chainstates.\n+    const auto target = std::max(\n+        MIN_DISK_SPACE_FOR_BLOCK_FILES, GetPruneTarget() / chainman.GetAll().size());\n+\n+    auto chain_tip_height = static_cast<uint64_t>(chain.m_chain.Height());\n+    if (chain_tip_height < 0 || target == 0) {",
      "path": "src/node/blockstorage.cpp",
      "position": null,
      "original_position": 54,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": 1314295003,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Oops, good catch. Fixed.",
      "created_at": "2023-09-08T10:56:15Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319704895",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319704895"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 189,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319707355",
      "pull_request_review_id": 1617109738,
      "id": 1319707355,
      "node_id": "PRRC_kwDOABII585OqSLb",
      "diff_hunk": "@@ -0,0 +1,7 @@\n+Pruning\n+-------\n+\n+When using assumeutxo with `-prune`, the prune budget may be exceeded. Prune budget is",
      "path": "doc/release-notes-27596.md",
      "position": null,
      "original_position": 4,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": 1314610529,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Mentioned specific values here.",
      "created_at": "2023-09-08T10:58:07Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319707355",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319707355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319709536",
      "pull_request_review_id": 1617109738,
      "id": 1319709536,
      "node_id": "PRRC_kwDOABII585OqStg",
      "diff_hunk": "@@ -5863,3 +5867,29 @@ Chainstate& ChainstateManager::GetChainstateForIndexing()\n     // indexed.\n     return (this->GetAll().size() > 1) ? *m_ibd_chainstate : *m_active_chainstate;\n }\n+\n+std::pair<int, int> ChainstateManager::GetPruneRange(const Chainstate& chainstate, int last_height_can_prune)\n+{\n+    if (chainstate.m_chain.Height() <= 0) {\n+        return {0, 0};\n+    }\n+    int prune_start{0};\n+\n+    if (this->GetAll().size() > 1 && m_snapshot_chainstate.get() == &chainstate) {\n+        // Leave the blocks in the background IBD chain alone if we're pruning\n+        // the snapshot chain.\n+        prune_start = *Assert(GetSnapshotBaseHeight()) + 1;\n+    }\n+\n+    int max_prune = chainstate.m_chain.Height() - static_cast<int>(MIN_BLOCKS_TO_KEEP);",
      "path": "src/validation.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "51622e9c1f7ed16f65844817a4a5e9bcbc157b4f",
      "in_reply_to_id": 1314618726,
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2023-09-08T11:00:05Z",
      "updated_at": "2023-09-08T14:54:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1319709536",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1319709536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 5884,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320930329",
      "pull_request_review_id": 1618712088,
      "id": 1320930329,
      "node_id": "PRRC_kwDOABII585Ou8wZ",
      "diff_hunk": "@@ -431,12 +428,16 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\n     int num_indexes{0};\n     int num_assumed_valid{0};\n     const int expected_assumed_valid{20};\n-    const int last_assumed_valid_idx{40};\n+    const int last_assumed_valid_idx{111};",
      "path": "src/test/validation_chainstatemanager_tests.cpp",
      "position": 149,
      "original_position": 104,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "64f431029f04cc47889dbe8fad55ccc139af9c07",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"test: adjust chainstate tests to use recognized snapshot base\" (64f431029f04cc47889dbe8fad55ccc139af9c07)\r\n\r\nOne problem with this change is that it makes the test less meaningful, now the snapshot block is the tip of the chain, and there are no blocks after it, so the test can no longer check that blocks after the snapshot block are added to the snapshot chain's setBlockIndex set. But it seems like if you just mine 20 blocks on line 435 and check for 120 blocks on line 440, the test will pass with no other changes and cover these blocks.\r\n\r\nAlso just in general I've been finding this test and the code around it very confusing, and think some extra comments and checks could help clarify it without having to change the existing code:\r\n\r\n```diff\r\n--- a/src/test/validation_chainstatemanager_tests.cpp\r\n+++ b/src/test/validation_chainstatemanager_tests.cpp\r\n@@ -422,17 +422,20 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\r\n \r\n     int num_indexes{0};\r\n     int num_assumed_valid{0};\r\n+    // Blocks in range [assumed_valid_start_idx, last_assumed_valid_idx) will be\r\n+    // marked as assumed-valid and not having data.\r\n     const int expected_assumed_valid{20};\r\n     const int last_assumed_valid_idx{111};\r\n     const int assumed_valid_start_idx = last_assumed_valid_idx - expected_assumed_valid;\r\n \r\n-    // Get to a valid assumeutxo snapshot\r\n-    mineBlocks(10);\r\n+    // Mine to height 120, past the hardcoded regtest assumeutxo snapshot at\r\n+    // height 110\r\n+    mineBlocks(20);\r\n \r\n     CBlockIndex* validated_tip{nullptr};\r\n     CBlockIndex* assumed_base{nullptr};\r\n     CBlockIndex* assumed_tip{WITH_LOCK(chainman.GetMutex(), return chainman.ActiveChain().Tip())};\r\n-    BOOST_CHECK_EQUAL(assumed_tip->nHeight, 110);\r\n+    BOOST_CHECK_EQUAL(assumed_tip->nHeight, 120);\r\n \r\n     auto reload_all_block_indexes = [&]() {\r\n         // For completeness, we also reset the block sequence counters to\r\n@@ -458,7 +461,7 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\r\n         LOCK(::cs_main);\r\n         auto index = cs1.m_chain[i];\r\n \r\n-        // Blocks with heights in range [90, 110] are marked ASSUMED_VALID\r\n+        // Blocks with heights in range [91, 110] are marked ASSUMED_VALID\r\n         if (i < last_assumed_valid_idx && i >= assumed_valid_start_idx) {\r\n             index->nStatus = BlockStatus::BLOCK_VALID_TREE | BlockStatus::BLOCK_ASSUMED_VALID;\r\n         }\r\n@@ -492,10 +495,36 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\r\n     // Set tip of the assume-valid-based chain to the assume-valid block\r\n     cs2.m_chain.SetTip(*assumed_base);\r\n \r\n+    // Sanity check test variables.\r\n+    BOOST_CHECK_EQUAL(num_indexes, 121); // 121 total blocks, including genesis\r\n+    BOOST_CHECK_EQUAL(assumed_tip->nHeight, 120);  // original chain has height 120\r\n+    BOOST_CHECK_EQUAL(validated_tip->nHeight, 90); // current cs1 chain has height 90\r\n+    BOOST_CHECK_EQUAL(assumed_base->nHeight, 110); // current cs2 chain has height 110\r\n+\r\n+    // Regenerate cs1.setBlockIndexCandidates and cs2.setBlockIndexCandidate and\r\n+    // check contents below.\r\n     reload_all_block_indexes();\r\n \r\n-    // The fully validated chain should have the current validated tip\r\n-    // and the assumed valid base as candidates.\r\n+    // The fully validated chain should only have the current validated tip and\r\n+    // the assumed valid base as candidates, blocks 90 and 110. Specifically:\r\n+    //\r\n+    // - It does not have blocks 0-89 because they contain less work than the\r\n+    //   chain tip.\r\n+    //\r\n+    // - It has block 90 because it has data and equal work to the chain tip,\r\n+    //   (since it is the chain tip).\r\n+    //\r\n+    // - It does not have blocks 91-109 because they do not contain data.\r\n+    //\r\n+    // - It has block 110 even though it does not have data, because\r\n+    //   LoadBlockIndex has a special case to always add the snapshot block as a\r\n+    //   candidate. The special case is only actually intended to apply to the\r\n+    //   snapshot chainstate cs2, not the background chainstate cs1, but it is\r\n+    //   written broadly and applies to both.\r\n+    //\r\n+    // - It does not have any blocks after height 110 because cs1 is a background\r\n+    //   chainstate, and only blocks where are ancestors of the snapshot block\r\n+    //   are added as candidates for the background chainstate.\r\n     BOOST_CHECK_EQUAL(cs1.setBlockIndexCandidates.size(), 2);\r\n     BOOST_CHECK_EQUAL(cs1.setBlockIndexCandidates.count(validated_tip), 1);\r\n     BOOST_CHECK_EQUAL(cs1.setBlockIndexCandidates.count(assumed_base), 1);\r\n@@ -503,8 +532,25 @@ BOOST_FIXTURE_TEST_CASE(chainstatemanager_loadblockindex, TestChain100Setup)\r\n     // The assumed-valid tolerant chain has the assumed valid base as a\r\n     // candidate, but otherwise has none of the assumed-valid (which do not\r\n     // HAVE_DATA) blocks as candidates.\r\n+    //\r\n+    // Specifically:\r\n+    // - All blocks below height 110 are not candidates, because cs2 chain tip\r\n+    //   has height 110 and they have less work than it does.\r\n+    //\r\n+    // - Block 110 is a candidate even though it does not have data, because it\r\n+    //   is the snapshot block, which is assumed valid.\r\n+    //\r\n+    // - Blocks 111-120 are added because they have data.\r\n+\r\n+    // Check that block 90 is absent\r\n     BOOST_CHECK_EQUAL(cs2.setBlockIndexCandidates.count(validated_tip), 0);\r\n+    // Check that block 109 is absent\r\n+    BOOST_CHECK_EQUAL(cs2.setBlockIndexCandidates.count(assumed_base->pprev), 0);\r\n+    // Check that block 110 is present\r\n+    BOOST_CHECK_EQUAL(cs2.setBlockIndexCandidates.count(assumed_base), 1);\r\n+    // Check that block 120 is present\r\n     BOOST_CHECK_EQUAL(cs2.setBlockIndexCandidates.count(assumed_tip), 1);\r\n+    // Check that 11 blocks total are present.\r\n     BOOST_CHECK_EQUAL(cs2.setBlockIndexCandidates.size(), num_indexes - last_assumed_valid_idx + 1);\r\n }\r\n \r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex f77325daedb5..9c8815914a57 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -3462,7 +3462,8 @@ void Chainstate::ResetBlockFailureFlags(CBlockIndex *pindex) {\r\n void Chainstate::TryAddBlockIndexCandidate(CBlockIndex* pindex)\r\n {\r\n     AssertLockHeld(cs_main);\r\n-    // The block only is a candidate for the most-work-chain if it has more work than our current tip.\r\n+    // The block only is a candidate for the most-work-chain if it has the same\r\n+    // or more work than our current tip.\r\n     if (m_chain.Tip() != nullptr && setBlockIndexCandidates.value_comp()(pindex, m_chain.Tip())) {\r\n         return;\r\n     }\r\n```\r\n\r\nI think it would be possible to make other improvements to the test beyond just adding comments. For example, I think it would be good to get rid of most of the variables and constants and just refer to blocks directly by height. Also, it would be good to add a fork to the chain below the snapshot height, to make sure blocks not leading up to the snapshot are not added as candidates to the background chainstate.",
      "created_at": "2023-09-11T02:21:12Z",
      "updated_at": "2023-09-11T02:30:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1320930329",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1320930329"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 428,
      "original_line": 428,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323131550",
      "pull_request_review_id": 1622395165,
      "id": 1323131550,
      "node_id": "PRRC_kwDOABII585O3WKe",
      "diff_hunk": "@@ -70,6 +70,35 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.\n+    NORMAL,\n+    ASSUMED,\n+};\n+\n+std::ostream& operator<<(std::ostream& os, const BlockfileType& type);\n+\n+struct BlockfileCursor {\n+    // The latest blockfile number.\n+    int file_num{0};\n+\n+    // Track the height of the highest block in m_last_blockfile whose undo",
      "path": "src/node/blockstorage.h",
      "position": 25,
      "original_position": 33,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\ns/m_last_blockfile/file_num/",
      "created_at": "2023-09-12T14:27:10Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323131550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323131550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323219325",
      "pull_request_review_id": 1622395165,
      "id": 1323219325,
      "node_id": "PRRC_kwDOABII585O3rl9",
      "diff_hunk": "@@ -92,7 +121,8 @@ class BlockManager\n      */\n     bool LoadBlockIndex(const std::optional<uint256>& snapshot_blockhash)\n         EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n-    void FlushBlockFile(bool fFinalize = false, bool finalize_undo = false);\n+    void FlushBlockFile(int blockfile_num, bool fFinalize = false, bool finalize_undo = false);",
      "path": "src/node/blockstorage.h",
      "position": 52,
      "original_position": 57,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nPrepending new parameter to a method with default arguments can be dangerous because it can lead to silent merge conflicts. (Argument value intended as the `fFinalize` parameter could be interpreted as the `blockfile_num` parameter).\r\n\r\nIt would be pretty easy to just drop all the default arguments and make the code explicit:\r\n\r\n```diff\r\n--- a/src/node/blockstorage.h\r\n+++ b/src/node/blockstorage.h\r\n@@ -121,8 +121,8 @@ private:\r\n      */\r\n     bool LoadBlockIndex(const std::optional<uint256>& snapshot_blockhash)\r\n         EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\n-    void FlushBlockFile(int blockfile_num, bool fFinalize = false, bool finalize_undo = false);\r\n-    void FlushChainstateBlockFile(int tip_height, bool fFinalize = false, bool finalize_undo = false);\r\n+    void FlushBlockFile(int blockfile_num, bool fFinalize, bool finalize_undo);\r\n+    void FlushChainstateBlockFile(int tip_height);\r\n     void FlushUndoFile(int block_file, bool finalize = false);\r\n     bool FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigned int nHeight, uint64_t nTime, bool fKnown);\r\n     bool FindUndoPos(BlockValidationState& state, int nFile, FlatFilePos& pos, unsigned int nAddSize);\r\n--- a/src/node/blockstorage.cpp\r\n+++ b/src/node/blockstorage.cpp\r\n@@ -630,14 +630,14 @@ BlockfileType BlockManager::BlockfileTypeForHeight(int height)\r\n     return (height >= *m_snapshot_height) ? BlockfileType::ASSUMED : BlockfileType::NORMAL;\r\n }\r\n \r\n-void BlockManager::FlushChainstateBlockFile(int tip_height, bool finalize, bool finalize_undo)\r\n+void BlockManager::FlushChainstateBlockFile(int tip_height)\r\n {\r\n     LOCK(cs_LastBlockFile);\r\n     auto& cursor = m_blockfile_cursors[BlockfileTypeForHeight(tip_height)];\r\n     if (cursor) {\r\n         // The cursor may not exist after a snapshot has been loaded but before any\r\n         // blocks have been downloaded.\r\n-        return FlushBlockFile(cursor->file_num, finalize, finalize_undo);\r\n+        return FlushBlockFile(cursor->file_num, /*fFinalize=*/false, /*finalize_undo=*/false);\r\n     }\r\n }\r\n \r\n```",
      "created_at": "2023-09-12T15:27:55Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323219325",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323219325"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 124,
      "original_line": 124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323226418",
      "pull_request_review_id": 1622395165,
      "id": 1323226418,
      "node_id": "PRRC_kwDOABII585O3tUy",
      "diff_hunk": "@@ -4765,6 +4765,10 @@ void ChainstateManager::CheckBlockIndex()\n     CBlockIndex* pindexFirstAssumeValid = nullptr; // Oldest ancestor of pindex which has BLOCK_ASSUMED_VALID\n     while (pindex != nullptr) {\n         nNodes++;\n+        if (pindex->pprev && pindex->nTx > 0) {\n+            // nChainTx should increase monotonically\n+            assert(pindex->pprev->nChainTx <= pindex->nChainTx);",
      "path": "src/validation.cpp",
      "position": 175,
      "original_position": 15,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "9df91113b8bbab8c98924bef61da388a8141b4e6",
      "in_reply_to_id": 1310950827,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310950827\r\n\r\nIn commit \"validation: populate nChainTx value for assumedvalid chainstates\" (e3cae85738c8bf4116547af8d868c6c01577b80f)\r\n\r\nIt seems like one thing that was causing this assert to fail is that the hardcoded regtest `nChainTx` value is wrong. If I change the snapshot `nChainTx` value from `110` to `111` tests are able to pass.\r\n\r\nAnother problem is that some tests avoid storing blocks, so leave the `nChainTx` value unset. If I update the assert to allow `nChainTx` to still be unset, all tests seem to pass.\r\n\r\nSo I think the following changes would be make the check stronger and clarify the code:\r\n\r\n```diff\r\n--- a/src/kernel/chainparams.cpp\r\n+++ b/src/kernel/chainparams.cpp\r\n@@ -493,7 +493,7 @@ public:\r\n             {\r\n                 .height = 110,\r\n                 .hash_serialized = AssumeutxoHash{uint256S(\"0x1ebbf5850204c0bdb15bf030f47c7fe91d45c44c712697e4509ba67adb01c618\")},\r\n-                .nChainTx = 110,\r\n+                .nChainTx = 111,\r\n                 .blockhash = uint256S(\"0x696e92821f65549c7ee134edceeeeaaa4105647a3c4fd9f298c0aec0ab50425c\")\r\n             },\r\n             {\r\n--- a/src/test/validation_tests.cpp\r\n+++ b/src/test/validation_tests.cpp\r\n@@ -138,11 +138,11 @@ BOOST_AUTO_TEST_CASE(test_assumeutxo)\r\n \r\n     const auto out110 = *params->AssumeutxoForHeight(110);\r\n     BOOST_CHECK_EQUAL(out110.hash_serialized.ToString(), \"1ebbf5850204c0bdb15bf030f47c7fe91d45c44c712697e4509ba67adb01c618\");\r\n-    BOOST_CHECK_EQUAL(out110.nChainTx, 110U);\r\n+    BOOST_CHECK_EQUAL(out110.nChainTx, 111U);\r\n \r\n     const auto out110_2 = *params->AssumeutxoForBlockhash(uint256S(\"0x696e92821f65549c7ee134edceeeeaaa4105647a3c4fd9f298c0aec0ab50425c\"));\r\n     BOOST_CHECK_EQUAL(out110_2.hash_serialized.ToString(), \"1ebbf5850204c0bdb15bf030f47c7fe91d45c44c712697e4509ba67adb01c618\");\r\n-    BOOST_CHECK_EQUAL(out110_2.nChainTx, 110U);\r\n+    BOOST_CHECK_EQUAL(out110_2.nChainTx, 111U);\r\n }\r\n \r\n BOOST_AUTO_TEST_SUITE_END()\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -4762,10 +4762,15 @@ void ChainstateManager::CheckBlockIndex()\r\n     CBlockIndex* pindexFirstAssumeValid = nullptr; // Oldest ancestor of pindex which has BLOCK_ASSUMED_VALID\r\n     while (pindex != nullptr) {\r\n         nNodes++;\r\n-        if (pindex->pprev && pindex->nTx > 0) {\r\n-            // nChainTx should increase monotonically\r\n-            assert(pindex->pprev->nChainTx <= pindex->nChainTx);\r\n-        }\r\n+\r\n+        // Make sure nChainTx sum is correctly computed.\r\n+        unsigned int prev_chain_tx = pindex->pprev ? pindex->pprev->nChainTx : 0;\r\n+        assert((pindex->nChainTx == pindex->nTx + prev_chain_tx)\r\n+               // For testing, allow transaction counts to be completely unset.\r\n+               || (pindex->nChainTx == 0 && pindex->nTx == 0)\r\n+               // For testing, allow this nChainTx to be unset if previous is also unset.\r\n+               || (pindex->nChainTx == 0 && prev_chain_tx == 0 && pindex->pprev));\r\n+\r\n         if (pindexFirstAssumeValid == nullptr && pindex->nStatus & BLOCK_ASSUMED_VALID) pindexFirstAssumeValid = pindex;\r\n         if (pindexFirstInvalid == nullptr && pindex->nStatus & BLOCK_FAILED_VALID) pindexFirstInvalid = pindex;\r\n         if (pindexFirstMissing == nullptr && !(pindex->nStatus & BLOCK_HAVE_DATA)) {\r\n```",
      "created_at": "2023-09-12T15:32:59Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323226418",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323226418"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4767,
      "original_line": 4767,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323283485",
      "pull_request_review_id": 1622395165,
      "id": 1323283485,
      "node_id": "PRRC_kwDOABII585O37Qd",
      "diff_hunk": "@@ -386,6 +395,15 @@ bool BlockManager::LoadBlockIndexDB(const std::optional<uint256>& snapshot_block\n         }\n     }\n \n+    {\n+        // Initialize the blockfile cursors.\n+        LOCK(cs_LastBlockFile);\n+        for (size_t i = 0; i < m_blockfile_info.size(); ++i) {\n+            const auto last_height_in_file = m_blockfile_info[i].nHeightLast;\n+            m_blockfile_cursors[BlockfileTypeForHeight(last_height_in_file)] = {static_cast<int>(i), 0};",
      "path": "src/node/blockstorage.cpp",
      "position": 227,
      "original_position": 106,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nNo need to change, but if you wanted an easy way to avoid repeatedly looking up the same two map elements in a loop, you could just replace the `m_blockfile_cursors` map with a fixed size array like @ajtowns recently suggested for https://github.com/bitcoin/bitcoin/pull/27213#discussion_r1281498873. I think the benefits would be similar: not just more efficiency but also more straightforward code where you don't have think about the `[]` operator default constructing elements or `at` method throwing exceptions.",
      "created_at": "2023-09-12T16:18:51Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323283485",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323283485"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 403,
      "original_line": 403,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323297281",
      "pull_request_review_id": 1622395165,
      "id": 1323297281,
      "node_id": "PRRC_kwDOABII585O3-oB",
      "diff_hunk": "@@ -187,6 +226,19 @@ class BlockManager\n \n     BlockMap m_block_index GUARDED_BY(cs_main);\n \n+    /**\n+     * The height of the base block of an assumeutxo snapshot, if one is in use.\n+     *\n+     * This controls how blockfiles are segmented by chainstate type to avoid\n+     * comingling different height regions of the chain when an assumedvalid chainstate\n+     * is in use. If heights are drastically different in the same blockfile, pruning\n+     * suffers.\n+     *\n+     * This is set during ActivateSnapshot() or upon LoadBlockIndex() if a snapshot\n+     * had been previously loaded.",
      "path": "src/node/blockstorage.h",
      "position": 142,
      "original_position": 123,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nCan the comment also say what happens after the snapshot is validated?",
      "created_at": "2023-09-12T16:31:13Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323297281",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323297281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": 237,
      "original_start_line": 237,
      "start_side": "RIGHT",
      "line": 238,
      "original_line": 238,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323311919",
      "pull_request_review_id": 1622395165,
      "id": 1323311919,
      "node_id": "PRRC_kwDOABII585O4CMv",
      "diff_hunk": "@@ -136,19 +166,26 @@ class BlockManager\n \n     RecursiveMutex cs_LastBlockFile;\n     std::vector<CBlockFileInfo> m_blockfile_info;\n-    int m_last_blockfile = 0;\n \n-    // Track the height of the highest block in m_last_blockfile whose undo\n-    // data has been written. Block data is written to block files in download\n-    // order, but is written to undo files in validation order, which is\n-    // usually in order by height. To avoid wasting disk space, undo files will\n-    // be trimmed whenever the corresponding block file is finalized and\n-    // the height of the highest block written to the block file equals the\n-    // height of the highest block written to the undo file. This is a\n-    // heuristic and can sometimes preemptively trim undo files that will write\n-    // more data later, and sometimes fail to trim undo files that can't have\n-    // more data written later.\n-    unsigned int m_undo_height_in_last_blockfile = 0;\n+    //! Since assumedvalid chainstates may be syncing a range of the chain that is very\n+    //! far away from the normal/background validation process, we should segment blockfiles\n+    //! for assumed chainstates. Otherwise, we might have wildly different height ranges\n+    //! mixed into the same block files, which would impair our ability to prune\n+    //! effectively.\n+    //!\n+    //! This data structure maintains separate blockfile number cursors for each\n+    //! BlockfileType. The ASSUMED state is initialized, when necessary, in FindBlockPos().\n+    std::map<BlockfileType, std::optional<BlockfileCursor>> m_blockfile_cursors GUARDED_BY(cs_LastBlockFile) = {\n+        {BlockfileType::NORMAL, BlockfileCursor{}},\n+        {BlockfileType::ASSUMED, std::nullopt},\n+    };\n+    int MaxBlockfileNum() const EXCLUSIVE_LOCKS_REQUIRED(cs_LastBlockFile)\n+    {\n+        static const BlockfileCursor empty_cursor{0, 0};",
      "path": "src/node/blockstorage.h",
      "position": 112,
      "original_position": 93,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nHere and other places in this PR, I think it would be nice avoid hardcoding these 0's, and just use the default values that are already assigned in the struct definition. Alternately, if you think it is better to explicitly assign every field, it might be better to remove the default assignments in the struct so the compiler can warn when the assignments are missing.",
      "created_at": "2023-09-12T16:45:01Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323311919",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323311919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323314721",
      "pull_request_review_id": 1622395165,
      "id": 1323314721,
      "node_id": "PRRC_kwDOABII585O4C4h",
      "diff_hunk": "@@ -783,10 +843,10 @@ bool BlockManager::WriteUndoDataForBlock(const CBlockUndo& blockundo, BlockValid\n         // in the block file info as below; note that this does not catch the case where the undo writes are keeping up\n         // with the block writes (usually when a synced up node is getting newly mined blocks) -- this case is caught in\n         // the FindBlockPos function\n-        if (_pos.nFile < m_last_blockfile && static_cast<uint32_t>(block.nHeight) == m_blockfile_info[_pos.nFile].nHeightLast) {\n+        if (_pos.nFile < static_cast<int>(cursor.file_num) && static_cast<uint32_t>(block.nHeight) == m_blockfile_info[_pos.nFile].nHeightLast) {",
      "path": "src/node/blockstorage.cpp",
      "position": 377,
      "original_position": 256,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nstatic_cast\\<int> here and below seems unnecessary because file_num should already be an int.",
      "created_at": "2023-09-12T16:47:41Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323314721",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323314721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 846,
      "original_line": 846,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323325683",
      "pull_request_review_id": 1622395165,
      "id": 1323325683,
      "node_id": "PRRC_kwDOABII585O4Fjz",
      "diff_hunk": "@@ -583,15 +623,30 @@ void BlockManager::FlushBlockFile(bool fFinalize, bool finalize_undo)\n         // have populated `m_blockfile_info` via LoadBlockIndexDB().\n         return;\n     }\n-    assert(static_cast<int>(m_blockfile_info.size()) > m_last_blockfile);\n+    assert(static_cast<int>(m_blockfile_info.size()) > blockfile_num);\n \n-    FlatFilePos block_pos_old(m_last_blockfile, m_blockfile_info[m_last_blockfile].nSize);\n+    FlatFilePos block_pos_old(blockfile_num, m_blockfile_info[blockfile_num].nSize);\n     if (!BlockFileSeq().Flush(block_pos_old, fFinalize)) {\n         m_opts.notifications.flushError(\"Flushing block file to disk failed. This is likely the result of an I/O error.\");\n     }\n     // we do not always flush the undo file, as the chain tip may be lagging behind the incoming blocks,\n     // e.g. during IBD or a sync after a node going offline\n-    if (!fFinalize || finalize_undo) FlushUndoFile(m_last_blockfile, finalize_undo);\n+    if (!fFinalize || finalize_undo) FlushUndoFile(blockfile_num, finalize_undo);\n+}\n+\n+static BlockfileType BlockfileTypeForRole(ChainstateRole chainstate_role)\n+{\n+    return chainstate_role == ChainstateRole::ASSUMEDVALID ?\n+        BlockfileType::ASSUMED : BlockfileType::NORMAL;\n+}\n+\n+void BlockManager::FlushChainstateBlockFile(ChainstateRole chainstate_role, bool finalize, bool finalize_undo)\n+{\n+    LOCK(cs_LastBlockFile);\n+    auto& cursor = m_blockfile_cursors[BlockfileTypeForRole(chainstate_role)];\n+    if (cursor) {",
      "path": "src/node/blockstorage.cpp",
      "position": 288,
      "original_position": 155,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310990937,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1310990937\r\n\r\nIn commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\nWould suggest following change to mention it should be safe not to flush and also move the comment to be clearer it is describing the `if` condition not the flush call:\r\n\r\n```diff\r\n--- a/src/node/blockstorage.cpp\r\n+++ b/src/node/blockstorage.cpp\r\n@@ -634,9 +634,10 @@ void BlockManager::FlushChainstateBlockFile(int tip_height, bool finalize, bool\r\n {\r\n     LOCK(cs_LastBlockFile);\r\n     auto& cursor = m_blockfile_cursors[BlockfileTypeForHeight(tip_height)];\r\n+    // If the cursor does not exist, it means an assumeutxo snapshot is loaded,\r\n+    // but no blocks past the snapshot height have been written yet, so there\r\n+    // is no data associated with the chainstate, and it is safe not to flush.\r\n     if (cursor) {\r\n-        // The cursor may not exist after a snapshot has been loaded but before any\r\n-        // blocks have been downloaded.\r\n         return FlushBlockFile(cursor->file_num, finalize, finalize_undo);\r\n     }\r\n }\r\n```",
      "created_at": "2023-09-12T16:57:49Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323325683",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323325683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 637,
      "original_line": 637,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323346256",
      "pull_request_review_id": 1622395165,
      "id": 1323346256,
      "node_id": "PRRC_kwDOABII585O4KlQ",
      "diff_hunk": "@@ -675,27 +724,35 @@ bool BlockManager::FindBlockPos(FlatFilePos& pos, unsigned int nAddSize, unsigne\n             }\n         }\n         assert(nAddSize < max_blockfile_size);\n+\n         while (m_blockfile_info[nFile].nSize + nAddSize >= max_blockfile_size) {\n             // when the undo file is keeping up with the block file, we want to flush it explicitly\n             // when it is lagging behind (more blocks arrive than are being connected), we let the\n             // undo block write case handle it\n-            finalize_undo = (m_blockfile_info[nFile].nHeightLast == m_undo_height_in_last_blockfile);\n-            nFile++;\n-            if (m_blockfile_info.size() <= nFile) {\n+            finalize_undo = (static_cast<int>(m_blockfile_info[nFile].nHeightLast) ==\n+                    Assert(m_blockfile_cursors[chain_type])->undo_height);\n+\n+            // Try the next unclaimed blockfile number\n+            nFile = this->MaxBlockfileNum() + 1;\n+            // Set to increment MaxBlockfileNum() for next iteration\n+            m_blockfile_cursors[chain_type] = BlockfileCursor{static_cast<int>(nFile), 0};",
      "path": "src/node/blockstorage.cpp",
      "position": 336,
      "original_position": 215,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "3ff26bc73374b53550dc2dd17dd3e1c58258fc30",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\n`static_cast<int>(nFile)` cast here and blow seems unnecessary since nFile is already an int",
      "created_at": "2023-09-12T17:18:47Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323346256",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323346256"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 738,
      "original_line": 738,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323349847",
      "pull_request_review_id": 1622395165,
      "id": 1323349847,
      "node_id": "PRRC_kwDOABII585O4LdX",
      "diff_hunk": "@@ -70,6 +71,30 @@ struct PruneLockInfo {\n     int height_first{std::numeric_limits<int>::max()}; //! Height of earliest block that should be kept and not pruned\n };\n \n+enum class BlockfileType {\n+    // For the purposes of blockfile fragmentation, treat background IBD chainstates\n+    // as normal.",
      "path": "src/node/blockstorage.h",
      "position": 14,
      "original_position": 14,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "1c668b690eeb4b98899be7e0ff33373b79932f2a",
      "in_reply_to_id": 1310979704,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1311988064\r\n\r\nIn commit \"blockstorage: segment normal/assumedvalid blockfiles\" (3ff26bc73374b53550dc2dd17dd3e1c58258fc30)\r\n\r\n> I've just removed the comment because I don't think it adds much anymore.\r\n\r\nComment seems to be here still (and would be good to remove)",
      "created_at": "2023-09-12T17:22:44Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323349847",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323349847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": 74,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": 75,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323352284",
      "pull_request_review_id": 1622395165,
      "id": 1323352284,
      "node_id": "PRRC_kwDOABII585O4MDc",
      "diff_hunk": "@@ -265,13 +265,26 @@ CBlockIndex* BlockManager::InsertBlockIndex(const uint256& hash)\n     return pindex;\n }\n \n-bool BlockManager::LoadBlockIndex()\n+bool BlockManager::LoadBlockIndex(const std::optional<uint256>& snapshot_blockhash)\n {\n     if (!m_block_tree_db->LoadBlockIndexGuts(\n             GetConsensus(), [this](const uint256& hash) EXCLUSIVE_LOCKS_REQUIRED(cs_main) { return this->InsertBlockIndex(hash); }, m_interrupt)) {\n         return false;\n     }\n \n+    int snapshot_height = -1;\n+    if (snapshot_blockhash) {\n+        const AssumeutxoData au_data = *Assert(GetParams().AssumeutxoForBlockhash(*snapshot_blockhash));\n+        snapshot_height = au_data.height;\n+        CBlockIndex* base{LookupBlockIndex(*snapshot_blockhash)};\n+\n+        // Since nChainTx (responsible for estiamted progress) isn't persisted",
      "path": "src/node/blockstorage.cpp",
      "position": 149,
      "original_position": 18,
      "commit_id": "9f9ffb655e4236f8d567b961102f53c5933e8aa8",
      "original_commit_id": "e3cae85738c8bf4116547af8d868c6c01577b80f",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"validation: populate nChainTx value for assumedvalid chainstates\" (e3cae85738c8bf4116547af8d868c6c01577b80f)\r\n\r\nestimated",
      "created_at": "2023-09-12T17:25:15Z",
      "updated_at": "2023-09-12T17:37:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27596#discussion_r1323352284",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323352284"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27596"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    }
  ]
}
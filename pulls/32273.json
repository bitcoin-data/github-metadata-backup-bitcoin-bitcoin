{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273",
    "id": 2459386917,
    "node_id": "PR_kwDOABII586Sl0Ql",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32273",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32273.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32273.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
    "number": 32273,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Fix relative path backup during migration.",
    "user": {
      "login": "davidgumberg",
      "id": 2257631,
      "node_id": "MDQ6VXNlcjIyNTc2MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidgumberg",
      "html_url": "https://github.com/davidgumberg",
      "followers_url": "https://api.github.com/users/davidgumberg/followers",
      "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
      "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
      "repos_url": "https://api.github.com/users/davidgumberg/repos",
      "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Support for wallets outside of the default wallet directory was added in #11687, and these external wallets can be specified with paths relative to the wallet directory, e.g.  `bitcoin-cli loadwallet ../../mywallet`. In the RPC commands, there is no distinction between a wallet's 'name' and a wallet's 'path'. This PR fixes an issue with wallet backup during migration where the wallet's 'name-path' is used in the backup filename. This goes south when that filename is appended to the directory where we want to put the file and the wallet's 'name' actually gets treated as a path:\r\n\r\n```cpp\r\n    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : wallet_name), GetTime()));\r\n    fs::path backup_path = this_wallet_dir / backup_filename;\r\n```\r\n\r\nAttempting to migrate a wallet with the 'name' `../../../mywallet` results in a backup being placed in `datadir/wallets/../../../mywallet/../../../mywallet_1744683963.legacy.bak`.\r\n\r\nIf permissions don't exist to write to that folder, migration can fail.\r\n\r\nThe solution implemented here is to put backup files in the top-level of the node's `walletdir` directory, using the folder name (and in some rare cases the file name)  of the wallet to name the backup file:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/9fa5480fc4c46fa11345c45fbe4dd21c127e3e05/src/wallet/wallet.cpp#L4254-L4268\r\n\r\n\r\n##### Steps to reproduce on master\r\nBuild and run `bitcoind` with legacy wallet creation enabled:\r\n```bash\r\n$ cmake -B build -DWITH_BDB=ON && cmake --build build -j $(nproc)\r\n$ ./build/bin/bitcoind -regtest -deprecatedrpc=create_bdb\r\n```\r\n\r\nCreate a wallet with some relative path specifiers (exercise caution with where this file may be written)\r\n\r\n```bash\r\n$ ./build/bin/bitcoin-cli -regtest -named createwallet wallet_name=\"../../../myrelativewallet\" descriptors=false\r\n```\r\n\r\nTry to migrate the wallet:\r\n```bash\r\n$ ./build/bin/bitcoin-cli -regtest -named migratewallet wallet_name=\"../../../myrelativewallet\"\r\n```\r\n\r\nYou will see a message in `debug.log` about trying to backup a file somewhere like: `/home/user/.bitcoin/regtest/wallets/../../../myrelativewallet/../../../myrelativewallet_1744686627.legacy.bak` and migration might fail because `bitcoind` doesn't have permissions to write the backup file.\r\n",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2025-04-15T03:32:24Z",
    "updated_at": "2025-07-25T22:43:27Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "fc39150db0d40290fe72310b2df296abbcb39399",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "davidgumberg:4-14-25-relative-migration",
      "ref": "4-14-25-relative-migration",
      "sha": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 529442895,
        "node_id": "R_kgDOH46oTw",
        "name": "bitcoin",
        "full_name": "davidgumberg/bitcoin",
        "owner": {
          "login": "davidgumberg",
          "id": 2257631,
          "node_id": "MDQ6VXNlcjIyNTc2MzE=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/davidgumberg",
          "html_url": "https://github.com/davidgumberg",
          "followers_url": "https://api.github.com/users/davidgumberg/followers",
          "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
          "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
          "repos_url": "https://api.github.com/users/davidgumberg/repos",
          "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/davidgumberg/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/davidgumberg/bitcoin",
        "archive_url": "https://api.github.com/repos/davidgumberg/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/davidgumberg/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/davidgumberg/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/davidgumberg/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/davidgumberg/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/davidgumberg/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/davidgumberg/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/davidgumberg/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/davidgumberg/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/davidgumberg/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/davidgumberg/bitcoin/events",
        "forks_url": "https://api.github.com/repos/davidgumberg/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/davidgumberg/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/davidgumberg/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/davidgumberg/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/davidgumberg/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/davidgumberg/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/davidgumberg/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/davidgumberg/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/davidgumberg/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/davidgumberg/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:davidgumberg/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/davidgumberg/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/davidgumberg/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/davidgumberg/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/davidgumberg/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/davidgumberg/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/davidgumberg/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/davidgumberg/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/davidgumberg/bitcoin/hooks",
        "svn_url": "https://github.com/davidgumberg/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 248298,
        "default_branch": "master",
        "open_issues_count": 8,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-17T00:51:07Z",
        "created_at": "2022-08-27T00:44:27Z",
        "updated_at": "2025-06-28T05:18:07Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "9f713b83dcf7480e6c4447f0f263bef096d55cc7",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37574,
        "stargazers_count": 84749,
        "watchers_count": 84749,
        "size": 289578,
        "default_branch": "master",
        "open_issues_count": 755,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-25T21:48:30Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-07-25T22:21:26Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 182,
    "deletions": 19,
    "changed_files": 2,
    "commits": 7,
    "review_comments": 30,
    "comments": 18
  },
  "events": [
    {
      "event": "commented",
      "id": 2803681753,
      "node_id": "IC_kwDOABII586nHMnZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2803681753",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T03:32:27Z",
      "updated_at": "2025-07-25T22:43:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32273.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-3049728359), [achow101](https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-3056922125) |\n| Concept ACK | [shahsb](https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2814523446) |\n| Stale ACK | [pseudoramdom](https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2811571133), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2781756291) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33034](https://github.com/bitcoin/bitcoin/pull/33034) (wallet: Store transactions in a separate sqlite table by achow101)\n* [#33031](https://github.com/bitcoin/bitcoin/pull/33031) (wallet: Set descriptor cache upgraded flag for migrated wallets by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- remove -> removes [subject ‚Äúfs::weakly_canonical‚Äù is singular, so the verb should be ‚Äúremoves‚Äù]\n- exist -> exists [‚Äúthe backup path‚Äù is singular, so it ‚Äúexists‚Äù]\n\n<sup>drahtbot_id_4_m</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2803681753",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "labeled",
      "id": 17260255075,
      "node_id": "LE_lADOABII586yg5qNzwAAAAQEypdj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17260255075",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T03:32:29Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 2768274932,
      "node_id": "PRR_kwDOABII586lAIX0",
      "url": null,
      "actor": null,
      "commit_id": "1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 1daaeedfafa0ee480a10756fa2a5cb25a268a3fa. Nice find and fix!\r\n\r\n> I suspect this may not be the only bug like this, since everywhere that a wallet's name appears in code, that name might be a path\r\n\r\nWallet paths are meant to be passed to the database driver once during opening and not manipulated or interpreted after that. Backup and migration code are an exception because they do interpret the paths after they are opened, so that code needs to be written in a consistent way, but it should be a small amount of code.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2768274932",
      "submitted_at": "2025-04-15T13:31:33Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17274055422,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAAQFnSr-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17274055422",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "96922fba854166b8c3ea52e61cc4f915f302ae2f",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/96922fba854166b8c3ea52e61cc4f915f302ae2f",
      "created_at": "2025-04-15T17:55:06Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17274084051,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAAQFnZrT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17274084051",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7343538aa35101815f2823d1f102bc990abc1232",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/7343538aa35101815f2823d1f102bc990abc1232",
      "created_at": "2025-04-15T17:57:22Z"
    },
    {
      "event": "subscribed",
      "id": 17274130449,
      "node_id": "SE_lADOABII586yg5qNzwAAAAQFnlAR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17274130449",
      "actor": {
        "login": "VahidNabavi",
        "id": 103521242,
        "node_id": "U_kgDOBiub2g",
        "avatar_url": "https://avatars.githubusercontent.com/u/103521242?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/VahidNabavi",
        "html_url": "https://github.com/VahidNabavi",
        "followers_url": "https://api.github.com/users/VahidNabavi/followers",
        "following_url": "https://api.github.com/users/VahidNabavi/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/VahidNabavi/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/VahidNabavi/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/VahidNabavi/subscriptions",
        "organizations_url": "https://api.github.com/users/VahidNabavi/orgs",
        "repos_url": "https://api.github.com/users/VahidNabavi/repos",
        "events_url": "https://api.github.com/users/VahidNabavi/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/VahidNabavi/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T18:01:11Z"
    },
    {
      "event": "reviewed",
      "id": 2772978869,
      "node_id": "PRR_kwDOABII586lSEy1",
      "url": null,
      "actor": null,
      "commit_id": "7343538aa35101815f2823d1f102bc990abc1232",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 7343538aa35101815f2823d1f102bc990abc1232, just changing a comment since the review\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/32273#issue-2994969229\r\n\r\n> This does not cause an issue for wallets with absolute pathnames \r\n\r\nIIUC, this is mostly true, but not totally. If intention for previous code was to place the wallet backup file inside the wallet directory, it looks like that was not previously happening, and that was also a bug which is now fixed.\r\n\r\nAlso IIUC, there wasn't an issue with relative paths generally like \"a/b/c\", only an issue with relative paths containing `..` pointing outside of the wallets directory? Might be good idea to change title to something like \"Fix external wallet backups during migration\". But title also seems ok currently since the detailed description is pretty clear.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2772978869",
      "submitted_at": "2025-04-16T15:34:42Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "commented",
      "id": 2810378440,
      "node_id": "IC_kwDOABII586ngvjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2810378440",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T18:23:59Z",
      "updated_at": "2025-04-16T18:23:59Z",
      "author_association": "MEMBER",
      "body": "Can you add a test for for failing to migrate a wallet specified by relative path? It's possible that restoration won't work as we expect it to.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2810378440",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17297559441,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAAQHA8-R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17297559441",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "faf0f2cc2ffe83485b2f4cc0e435fa77ba24d663",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/faf0f2cc2ffe83485b2f4cc0e435fa77ba24d663",
      "created_at": "2025-04-16T23:50:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17297596577,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAAQHBGCh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17297596577",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "db4ea2632f0c1a5a5d6885526545cbddae7305d7",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/db4ea2632f0c1a5a5d6885526545cbddae7305d7",
      "created_at": "2025-04-16T23:55:04Z"
    },
    {
      "event": "labeled",
      "id": 17297597260,
      "node_id": "LE_lADOABII586yg5qNzwAAAAQHBGNM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17297597260",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T23:55:10Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2811228853,
      "node_id": "IC_kwDOABII586nj_K1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2811228853",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T23:55:11Z",
      "updated_at": "2025-04-16T23:55:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40692364945</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2811228853",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "commented",
      "id": 2811266661,
      "node_id": "IC_kwDOABII586nkIZl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2811266661",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T00:04:10Z",
      "updated_at": "2025-04-17T00:04:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Can you add a test for for failing to migrate a wallet specified by relative path? It's possible that restoration won't work as we expect it to.\r\n\r\nAdded a test that the 'automatic' restoration from a backup after a failed migration works, and added a test that restoring a backup made from an external relative wallet works.\r\n\r\n> Also IIUC, there wasn't an issue with relative paths generally like \"a/b/c\", only an issue with relative paths containing `..` pointing outside of the wallets directory?\r\n\r\nI thought so too, but checked after reading your comment and this is also broken on master:\r\n\r\n```bash\r\n./build/bin/bitcoin-cli -regtest -named createwallet wallet_name=\"a/b/c/d\" descriptors=false\r\n./build/bin/bitcoin-cli -regtest -named migratewallet wallet_name=\"a/b/c/d\"\r\n```\r\n\r\nresults in:\r\n\r\n```console\r\nerror copying /home/user/.bitcoin/regtest/wallets/a/b/c/d/wallet.dat to\r\n/home/user/.bitcoin/regtest/wallets/a/b/c/d/a/b/c/d_1744848074.legacy.bak\r\n```\r\n",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2811266661",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "commented",
      "id": 2811571133,
      "node_id": "IC_kwDOABII586nlSu9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2811571133",
      "actor": {
        "login": "pseudoramdom",
        "id": 101169910,
        "node_id": "U_kgDOBge69g",
        "avatar_url": "https://avatars.githubusercontent.com/u/101169910?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pseudoramdom",
        "html_url": "https://github.com/pseudoramdom",
        "followers_url": "https://api.github.com/users/pseudoramdom/followers",
        "following_url": "https://api.github.com/users/pseudoramdom/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pseudoramdom/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pseudoramdom/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pseudoramdom/subscriptions",
        "organizations_url": "https://api.github.com/users/pseudoramdom/orgs",
        "repos_url": "https://api.github.com/users/pseudoramdom/repos",
        "events_url": "https://api.github.com/users/pseudoramdom/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pseudoramdom/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T02:28:01Z",
      "updated_at": "2025-04-17T02:28:01Z",
      "author_association": "NONE",
      "body": "Tested ACK https://github.com/bitcoin/bitcoin/pull/32273/commits/db4ea2632f0c1a5a5d6885526545cbddae7305d7\r\n\r\nThe patch works for both  paths containing `\"../\"` and `\"a/b/c/d\"`\r\n> I thought so too, but checked after reading your comment and this is also broken on master:\r\n\r\n+1. `master` does fail `migrate` for `\"a/b/c\"` style.\r\n\r\n<details>\r\n<summary>master</summary>\r\n\r\nMigrating with `..` style\r\n```\r\n2025-04-17T01:49:47Z copied /Library/Application Support/Bitcoin/regtest/wallets/../../../myrelativewallet/wallet.dat to /Library/Application Support/Bitcoin/regtest/wallets/../../../myrelativewallet/../../../amyrelativewallet_1744854587.legacy.bak\r\n```\r\n\r\nMigrating with `a/b/c` style\r\n```\r\n2025-04-17T02:12:59Z error copying /Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet/wallet.dat to /Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet/a/b/c/myrelativewallet_1744855979.legacy.bak - filesystem error: in copy_file: No such file or directory [\"/Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet/a/b/c/myrelativewallet_1744855979.legacy.bak\"] [\"/Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet/wallet.dat\"]\r\n```\r\n</details>\r\n\r\n<details>\r\n<summary>PR 32273</summary>\r\n\r\nMigrating with `..` style\r\n```\r\n2025-04-17T01:58:38Z copied /Library/Application Support/Bitcoin/regtest/wallets/../../../myrelativewallet2/wallet.dat to /Library/Application Support/Bitcoin/regtest/wallets/../../../myrelativewallet2/myrelativewallet2_1744855118.legacy.bak\r\n```\r\n\r\nMigrating with `a/b/c` style\r\n```\r\n2025-04-17T02:15:39Z copied /Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet2/wallet.dat to /Library/Application Support/Bitcoin/regtest/wallets/a/b/c/myrelativewallet2/myrelativewallet2_1744856139.legacy.bak\r\n```\r\n</details>\r\n\r\n\r\n",
      "user": {
        "login": "pseudoramdom",
        "id": 101169910,
        "node_id": "U_kgDOBge69g",
        "avatar_url": "https://avatars.githubusercontent.com/u/101169910?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pseudoramdom",
        "html_url": "https://github.com/pseudoramdom",
        "followers_url": "https://api.github.com/users/pseudoramdom/followers",
        "following_url": "https://api.github.com/users/pseudoramdom/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pseudoramdom/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pseudoramdom/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pseudoramdom/subscriptions",
        "organizations_url": "https://api.github.com/users/pseudoramdom/orgs",
        "repos_url": "https://api.github.com/users/pseudoramdom/repos",
        "events_url": "https://api.github.com/users/pseudoramdom/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pseudoramdom/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2811571133",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "review_requested",
      "id": 17298771759,
      "node_id": "RRE_lADOABII586yg5qNzwAAAAQHFk8v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17298771759",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T02:28:05Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17300714033,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAAQHM_Ix",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17300714033",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "created_at": "2025-04-17T06:26:23Z"
    },
    {
      "event": "reviewed",
      "id": 2774722336,
      "node_id": "PRR_kwDOABII586lYucg",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2774722336",
      "submitted_at": "2025-04-17T06:32:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "unlabeled",
      "id": 17301553548,
      "node_id": "UNLE_lADOABII586yg5qNzwAAAAQHQMGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17301553548",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T07:38:36Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2777511534,
      "node_id": "PRR_kwDOABII586ljXZu",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2777511534",
      "submitted_at": "2025-04-18T04:44:03Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "commented",
      "id": 2814523446,
      "node_id": "IC_kwDOABII586nwjg2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2814523446",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-18T04:44:26Z",
      "updated_at": "2025-04-18T04:44:26Z",
      "author_association": "NONE",
      "body": "Concept ACK",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2814523446",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "reviewed",
      "id": 2781756291,
      "node_id": "PRR_kwDOABII586lzjuD",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97. Main change is expansion of test to cover restoring from the backup.\r\n\r\nIIUC, PR description seems helpful for describing part of the problem, but contains inaccuracies and would be good to revise to avoid being misleading. Here are things I might add or correct:\r\n\r\n1. PR describes there being a problems with relative paths, but not all relative paths have a problem, and absolute paths have problems too. Things only currently work correctly when wallet names contains no slashes (e.g. `mywallet`). Whenever a wallet name has slashes, there are bugs which this PR fixes (the bugs are different depending on whether the path is absolute or relative).\r\n2. If wallet name is relative and has slashes like `my/wallet` there is a bug currently because migrate code tries to write a backup file inside the wallet directory at a path like `my/wallet/my/wallet_123.bak` and this fails when the backup file can't be written at a nonexistent subdirectory. This PR fixes that problem by dropping extra path components so the backup is saved at `my/wallet/wallet_123.bak`\r\n3. If wallet name is absolute and has slashes like `/my/wallet` there is a bug currently because instead of the backup being written inside the wallet directory at a location like `/my/wallet/wallet_123.bak` the backup is written outside the wallet directory, next to it,  at a location like `/my/wallet_123.bak`. The PR fixes that problem by always writing the backup file inside the wallet directory.\r\n4. If wallet name is relative and contains `..` there can be a combination of both problems: an attempt to write the backup file outside the wallet directory can happen, and the write can fail because the destination directory probably won't exist.\r\n\r\nAlso, I think I'd suggest dropping \"I suspect this may not be the only bug like this, since everywhere that a wallet's name appears in code, that name might be a path, and that path may contain relative specifiers, and the consequences of that are not always obvious, and test coverage for wallets with relative paths seems like it could be improved.\" because it increases vagueness and uncertainty in the PR description and I don't actually think it is true. Outside of backup and restore code wallet names are treated like identifiers, not like paths, so I don't think we should expect to see problems outside of backup & restore code.\r\n\r\nOverall changes look good though. Just trying to reconcile my understanding of the problem with the way it's described in the PR.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2781756291",
      "submitted_at": "2025-04-21T16:48:42Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "review_requested",
      "id": 17340852975,
      "node_id": "RRE_lADOABII586yg5qNzwAAAAQJmGrv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17340852975",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-21T16:48:46Z",
      "requested_reviewer": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 2819544950,
      "node_id": "IC_kwDOABII586oDtd2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2819544950",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-21T21:30:02Z",
      "updated_at": "2025-04-21T21:30:02Z",
      "author_association": "MEMBER",
      "body": "I think there's one more wrinkle to this issue: wallets outside of the wallets directory are probably stored where the wallet file is the name of the wallet, rather than the directory being the name, and containing a wallet.dat. An example of something similar to this is `test_direct_file` test case, although in that case the file is still in the wallets directory. In fact, I think this PR actually \"breaks\" that test case as the backup file is no longer named as we expect it (although the test does not check that, but it probably should).\r\n\r\nI believe this PR would be incorrect for such wallets since it uses the parent directory's name for the backup, rather than the wallet file's name. For such wallets, the name of the parent directory would probably be something unrelated to the wallet file's name. If there are multiple wallet files in the same directory, this would also be problematic.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2819544950",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "reviewed",
      "id": 2782326633,
      "node_id": "PRR_kwDOABII586l1u9p",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Won't this turn `/home/user/arbitrarywalletname.db` into `/home/user/user_%d.legacy.bak` ? Seems incorrect?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2782326633",
      "submitted_at": "2025-04-21T22:05:18Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "commented",
      "id": 2819690304,
      "node_id": "IC_kwDOABII586oEQ9A",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2819690304",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-21T23:21:20Z",
      "updated_at": "2025-04-21T23:21:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "I was under impression that the only wallet paths that could be loaded are:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/06439a14c884d7f81f331646ad361e88b3037a51/src/wallet/wallet.cpp#L2974-L2977\r\n\r\nSo it would not be possible to load a bare db outside -walletdir. And if the migration code was backing up a bare db file inside -walletdir like `arbitrarywalletname.db` it would just be backed up as `arbitrarywalletname.db_1223.bak`",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2819690304",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "commented",
      "id": 2819784017,
      "node_id": "IC_kwDOABII586oEn1R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2819784017",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-22T00:44:24Z",
      "updated_at": "2025-04-22T00:44:24Z",
      "author_association": "MEMBER",
      "body": "> So it would not be possible to load a bare db outside -walletdir.\r\n\r\nGood point\r\n\r\n> And if the migration code was backing up a bare db file inside -walletdir like `arbitrarywalletname.db` it would just be backed up as `arbitrarywalletname.db_1223.bak`\r\n\r\nThis PR currently breaks that. Although `test_direct_file` doesn't currently fail, adding a check for the wallet's name in the backup path does make it fail, e.g.\r\n\r\n```diff\r\ndiff --git a/test/functional/wallet_migration.py b/test/functional/wallet_migration.py\r\nindex c467d6ad36d..90088db34e7 100755\r\n--- a/test/functional/wallet_migration.py\r\n+++ b/test/functional/wallet_migration.py\r\n@@ -568,7 +568,8 @@ class WalletMigrationTest(BitcoinTestFramework):\r\n         )\r\n         assert (self.master_node.wallets_path / \"plainfile\").is_file()\r\n \r\n-        self.master_node.migratewallet(\"plainfile\")\r\n+        migrate_res = self.master_node.migratewallet(\"plainfile\")\r\n+        assert \"plainfile\" in os.path.basename(migrate_res[\"backup_path\"])\r\n         wallet = self.master_node.get_wallet_rpc(\"plainfile\")\r\n         info = wallet.getwalletinfo()\r\n         assert_equal(info[\"descriptors\"], True)\r\n```",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2819784017",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "commented",
      "id": 2821309098,
      "node_id": "IC_kwDOABII586oKcKq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2821309098",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-22T13:19:10Z",
      "updated_at": "2025-04-22T13:19:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Although `test_direct_file` doesn't currently fail, adding a check for the wallet's name in the backup path does make it fail, e.g.\r\n\r\nThat's a good point. Instead of backing up `plainfile` as `plainfile_123.legacy.bak` 47174476c04a7f1138fbd32eb0c9c38e85946393 backs it up as `wallets_123.legacy.bak` because it assumes the name of the parent directory is the name of the wallet. Following would seem to be a good fix:\r\n\r\n```diff\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -4499,13 +4499,14 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\r\n         return util::Error{_(\"Error: This wallet is already a descriptor wallet\")};\r\n     }\r\n \r\n-    // Make a backup of the DB in the wallet's directory with a unique filename using the wallet\r\n-    // name and current timestamp. If not the default wallet, the name of the folder containing\r\n-    // wallet data is used as the wallet's name, since its full name may contain slashes.\r\n-    fs::path legacy_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\r\n-    std::string legacy_wallet_dir_name = fs::PathToString(legacy_wallet_dir.filename());\r\n-    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : legacy_wallet_dir_name), GetTime()));\r\n-    fs::path backup_path = legacy_wallet_dir / backup_filename;\r\n+    // Make a backup of the DB in the wallet's directory with a unique filename\r\n+    // using the wallet name and current timestamp. The backup filename is based\r\n+    // on walletname but expanded to \"default_wallet\" if it is empty and only\r\n+    // the final filename portion is used if contains slashes.\r\n+    fs::path legacy_wallet_dir = fs::PathFromString(local_wallet->GetDatabase().Filename()).parent_path();\r\n+    std::string backup_prefix = fs::PathToString(fs::PathFromString(wallet_name).filename());\r\n+    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (backup_prefix.empty() ? \"default_wallet\" : backup_prefix), GetTime()));\r\n+    fs::path backup_path = fsbridge::AbsPathJoin(legacy_wallet_dir, backup_filename);\r\n     if (!local_wallet->BackupWallet(fs::PathToString(backup_path))) {\r\n         if (was_loaded) {\r\n             reload_wallet(local_wallet);\r\n```\r\n\r\nIt also drops the incorrect and unnecessary fs::absolute call since CWD should be irrelevant here.\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2821309098",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "labeled",
      "id": 17406211852,
      "node_id": "LE_lADOABII586yg5qNzwAAAAQNfbcM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17406211852",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-25T13:02:13Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2964023741,
      "node_id": "PRR_kwDOABII586wq2m9",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "tACK 6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97 \r\n\r\nI was able to reproduce the issue on `master`. As a detail, the CLI outputs \"_Unable to make a backup of your wallet_\" when the backup fails‚Äîmight be worth mentioning that in the PR description.\r\n\r\nThis branch fixes the problem as expected (checked both relatives `.../../` and `a/b/c`).\r\n\r\nNote that legacy wallet creation is no longer possible on `master`, so it might be helpful to update the reproduction steps. One option could be to use a previous release (e.g., v28.0 - `./releases/v28.0/bin/bitcoind`) via previously `./test/get_previous_releases.py -b`.\r\n\r\n> https://github.com/bitcoin/bitcoin/commit/47174476c04a7f1138fbd32eb0c9c38e85946393 backs it up as wallets_123.legacy.bak\r\n\r\nI've verified that the [above](https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2821309098) needs to be fixed for **plainfile** wallets migration.",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2964023741",
      "submitted_at": "2025-06-26T23:15:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "reviewed",
      "id": 2972374504,
      "node_id": "PRR_kwDOABII586xKtXo",
      "url": null,
      "actor": null,
      "commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2972374504",
      "submitted_at": "2025-06-30T19:18:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18397172827,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARIjpRb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18397172827",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "aaac0ac5325db1dcc05ac79a1b78ba16a3d3cf91",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/aaac0ac5325db1dcc05ac79a1b78ba16a3d3cf91",
      "created_at": "2025-07-01T00:10:46Z"
    },
    {
      "event": "unlabeled",
      "id": 18397648012,
      "node_id": "UNLE_lADOABII586yg5qNzwAAAARIldSM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18397648012",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T00:58:19Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 18397748064,
      "node_id": "LE_lADOABII586yg5qNzwAAAARIl1tg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18397748064",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T01:08:51Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3021334321,
      "node_id": "IC_kwDOABII5860Fecx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3021334321",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T01:08:53Z",
      "updated_at": "2025-07-01T01:08:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `MSan, depends`: https://github.com/bitcoin/bitcoin/runs/45091596520</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by an assertion failure related to fs::path in the bench_sanity_check test, leading to a subprocess abort.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3021334321",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18399113832,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARIrDJo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18399113832",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "c2dbf90f9ccd10b11e0ea0a3bdd0f6792c776243",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/c2dbf90f9ccd10b11e0ea0a3bdd0f6792c776243",
      "created_at": "2025-07-01T03:19:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18399205384,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARIrZgI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18399205384",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f66401becb78bb700813e39f65748d087831573e",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/f66401becb78bb700813e39f65748d087831573e",
      "created_at": "2025-07-01T03:30:50Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18399443861,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARIsTuV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18399443861",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "4f7415f7e1e50ac8e40d831cdbd90c41484bb2d8",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/4f7415f7e1e50ac8e40d831cdbd90c41484bb2d8",
      "created_at": "2025-07-01T03:58:49Z"
    },
    {
      "event": "unlabeled",
      "id": 18400061947,
      "node_id": "UNLE_lADOABII586yg5qNzwAAAARIuqn7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18400061947",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T04:58:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18401942664,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARI11yI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18401942664",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "fad80d14175ba3a8568ee074ac7e9a1a709db173",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/fad80d14175ba3a8568ee074ac7e9a1a709db173",
      "created_at": "2025-07-01T06:58:20Z"
    },
    {
      "event": "commented",
      "id": 3022237757,
      "node_id": "IC_kwDOABII5860I7A9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3022237757",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:17:59Z",
      "updated_at": "2025-07-01T07:17:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Won't this turn `/home/user/arbitrarywalletname.db` into `/home/user/user_%d.legacy.bak` ? Seems incorrect?\r\n\r\n> This PR currently breaks that. Although `test_direct_file` doesn't currently fail, adding a check for the wallet's name in the backup path does make it fail, e.g.\r\n> \r\n> [...]\r\n\r\n@luke-jr @achow101 \r\nThanks for catching this, I've added the test case @achow101 suggested for this in 5cd3e2794d78848e7040e.\r\n\r\n----\r\n\r\n@ryanofsky \r\n> Following would seem to be a good fix:\r\n>\r\n> [...]\r\n\r\nThanks, I've used parts of this suggestion but with some changes:\r\n- `backup_prefix = wallet_name.filename()` does not work when the wallet name ends in relative specifiers, since \"..\" will be the `backup_prefix`, (test case: fad80d14175ba3a8568ee074ac7e9a1a709db173). It also doesn't work when the wallet name ends in a `/`, since `filename()` will return `\"\"` in that case. (https://en.cppreference.com/w/cpp/filesystem/path/filename) (test: https://github.com/bitcoin/bitcoin/commit/e48bf2d84502e0c61558eac5fd02d0a7fcbc5065)\r\n- Absolute paths are needed here since what `WalletDatabase::Backup()` does with the path you pass it is an implementation detail, e.g. in the case of `SQLiteDatabase::Backup()`, the path gets [passed off](https://github.com/bitcoin/bitcoin/blob/fad80d14175ba3a8568ee074ac7e9a1a709db173/src/wallet/sqlite.cpp#L349) to the sqlite api.\r\n\r\nThere are also some subtle and likely unimportant edge cases that were not being handled during migration, e.g. disallowing the use of symbolic links to direct files in migrations, so the solution I've used is to reuse the path parsing logic used during wallet loading in [`CWallet::GetWalletPath()`](https://github.com/bitcoin/bitcoin/blob/1dd639f57f0e627357b62cdac0ea9dc2d45baaff/src/wallet/wallet.cpp#L2939-L2959):\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fad80d14175ba3a8568ee074ac7e9a1a709db173/src/wallet/wallet.cpp#L4234-L4243\r\n\r\nAnd to split up the handling of direct file wallets and normal wallets:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fad80d14175ba3a8568ee074ac7e9a1a709db173/src/wallet/wallet.cpp#L4245-L4261\r\n",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3022237757",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "mentioned",
      "id": 18402348653,
      "node_id": "MEE_lADOABII586yg5qNzwAAAARI3Y5t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348653",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "subscribed",
      "id": 18402348679,
      "node_id": "SE_lADOABII586yg5qNzwAAAARI3Y6H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348679",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "mentioned",
      "id": 18402348700,
      "node_id": "MEE_lADOABII586yg5qNzwAAAARI3Y6c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348700",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "subscribed",
      "id": 18402348729,
      "node_id": "SE_lADOABII586yg5qNzwAAAARI3Y65",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348729",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "mentioned",
      "id": 18402348756,
      "node_id": "MEE_lADOABII586yg5qNzwAAAARI3Y7U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348756",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "subscribed",
      "id": 18402348771,
      "node_id": "SE_lADOABII586yg5qNzwAAAARI3Y7j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18402348771",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T07:18:01Z"
    },
    {
      "event": "commented",
      "id": 3024221935,
      "node_id": "IC_kwDOABII5860Qfbv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3024221935",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T14:12:34Z",
      "updated_at": "2025-07-01T14:27:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Thanks, I've used parts of this suggestion but with some changes\r\n\r\nThanks for following up, and it's a good observation that calling `filename()` on an `fs::path` like I [suggested](https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2821309098) doesn't always always return a usable file prefix, since it can return odd fragments like \"..\" and doesn't handle trailing slashes.\r\n\r\nBut I feel like it would still be straightforward to address the problem of turning a wallet name into a safe prefix by making a replacement like:\r\n\r\n```diff\r\n-    std::string backup_prefix = fs::PathToString(fs::PathFromString(wallet_name).filename());\r\n+    std::string backup_prefix = [&] {\r\n+        // Normalize any .. components\r\n+        fs::path p{fs::PathFromString(wallet_name).lexically_normal()};\r\n+        // Drop trailing slash if any.\r\n+        if (p.filename().empty()) p = p.parent_path();\r\n+        // Return last path component\r\n+        return fs::PathToString(p.filename());\r\n+    }();\r\n```\r\n\r\nMore generally I have some concerns about the implementation in 15583b8c35014b59f4f1ea21522a1509b30cf221:\r\n\r\n- I feel like it doesn't make sense to store backups of a wallet *inside* the wallet being backed up. The approach I suggested of just backing up all wallets as `{prefix}_{timestamp}.legacy.bak` files in the top-level wallets directory seems like it should make the backup files easier to find, identify, and clean up.\r\n\r\n  By contrast the approach in 15583b8c35014b59f4f1ea21522a1509b30cf221 seems more complicated and inconsistent, creating backup files for *file* wallets as suggested, but creating backups for *directory* wallets by putting the backup files *inside* the wallet directories. I think this is not good because it is inconsistent, and will make the backup files harder to find, and it moves away from the concept that 1 directory = 1 wallet to one where 1 directory = (1 wallet + backups of itself).\r\n\r\n- Am also concerned that the implementation in 15583b8c35014b59f4f1ea21522a1509b30cf221 is fragile, accessing the filesystem with `symlink_status` and `weakly_canonical` where the should be no need to access the filesystem and the only job that actually needs to be done is turning the wallet name into a prefix string. Accessing the filesystem makes things more complicated and unpredictable (even introducing a `util::Error` case) than I think is ideal.\r\n\r\n---\r\n\r\nUpdate: Should note these are just initial thoughts and not a full review. 15583b8c35014b59f4f1ea21522a1509b30cf221 is just different than what I was expecting and may have advantages I'm not seeing or haven't thought of.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3024221935",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "commented",
      "id": 3025413663,
      "node_id": "IC_kwDOABII5860VCYf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3025413663",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-01T20:32:48Z",
      "updated_at": "2025-07-01T20:32:48Z",
      "author_association": "MEMBER",
      "body": "> The approach I suggested of just backing up all wallets as `{prefix}_{timestamp}.legacy.bak` files in the top-level wallets directory seems like it should make the backup files easier to find, identify, and clean up.\r\n\r\nThat seems reasonable to me.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3025413663",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "labeled",
      "id": 18439487844,
      "node_id": "LE_lADOABII586yg5qNzwAAAARLFEFk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18439487844",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-02T20:46:40Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18440124646,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARLHfjm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18440124646",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "52a0cea71623580ecf77870af783b1b82a4dc8c7",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/52a0cea71623580ecf77870af783b1b82a4dc8c7",
      "created_at": "2025-07-02T21:32:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18440172054,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARLHrIW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18440172054",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "fc77780693df463d0579222ac9d4ee31f7937ed1",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/fc77780693df463d0579222ac9d4ee31f7937ed1",
      "created_at": "2025-07-02T21:36:15Z"
    },
    {
      "event": "commented",
      "id": 3029455047,
      "node_id": "IC_kwDOABII5860kdDH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3029455047",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-02T22:10:30Z",
      "updated_at": "2025-07-03T17:33:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "> * I feel like it doesn't make sense to store backups of a wallet _inside_ the wallet being backed up. The approach I suggested of just backing up all wallets as `{prefix}_{timestamp}.legacy.bak` files in the top-level wallets directory seems like it should make the backup files easier to find, identify, and clean up.\r\n\r\n> That seems reasonable to me.\r\n\r\nAgreed, I've added https://github.com/bitcoin/bitcoin/pull/32273/commits/75df71398dc4feefaa6f6ee611e41c5daa8ebc2b which moves the backup from inside the wallet directory to being in the node's `-walletdir`.\r\n\r\n---\r\n\r\n> * Am also concerned that the implementation in https://github.com/bitcoin/bitcoin/commit/15583b8c35014b59f4f1ea21522a1509b30cf221 is fragile, accessing the filesystem with symlink_status and weakly_canonical where the should be no need to access the filesystem and the only job that actually needs to be done is turning the wallet name into a prefix string.\r\n\r\nUnfortunately, I think knowing the name of the wallet's parent folder requires filesystem access when arbitrary relative paths are permitted. `lexically_normal()` won't work in test cases like 8e20619341b465e30bdbfc22e6be515fb2ae2e6f where the wallet is specified by a relative path that ascends more than it descends, or [e.g. the wallet named `../`.](https://godbolt.org/z/eTnhqe8de)\r\n\r\n>  Accessing the filesystem makes things more complicated and unpredictable (even introducing a util::Error case) than I think is ideal.\r\n\r\nI think using `GetWalletPath()` and checking the `Util::error` case here is just a bit bit of belt and suspenders to ensure no wallet names that are not permitted elsewhere are permitted in migration, but in practice, bad names get caught [earlier on in migration](https://github.com/bitcoin/bitcoin/blob/68ca13e1f96a9dae997558a1d7a873b10056091b/src/wallet/wallet.cpp#L4211) when the legacy wallet is loaded, so this is currently unreachable.\r\n\r\nThis code could just as well be:\r\n\r\n```diff\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 6c94bd807c..ac1b37d262 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -4257,14 +4257,11 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\r\n     // cases, but in the case where the wallet name is a path to a data file,\r\n     // the name of the data file is used, and in the case where the wallet name\r\n     // is blank, \"default_wallet\" is used.\r\n-    auto legacy_wallet_path = GetWalletPath(wallet_name);\r\n-    if (!legacy_wallet_path) {\r\n-        return util::Error{util::ErrorString(legacy_wallet_path)};\r\n-    }\r\n+    const fs::path legacy_wallet_path = fsbridge::AbsPathJoin(GetWalletDir(), fs::PathFromString(wallet_name));\r\n\r\n     // Backwards-compatibility logic for migrating wallets whose names are\r\n     // paths to data files directly rather than directories.\r\n-    bool is_direct_file = fs::symlink_status(*legacy_wallet_path).type() == fs::file_type::regular;\r\n+    bool is_direct_file = fs::symlink_status(legacy_wallet_path).type() == fs::file_type::regular;\r\n```\r\n\r\nThis is verbatim what `GetWalletPath()` does, minus handing out errors for disallowed paths, which I felt off about omitting, but in practice, it's a no-op today because of the earlier checks.",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3029455047",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18441018220,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARLK5ts",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18441018220",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f8c4fa5d414d56e30a8f90e6a0080985893f5f2b",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/f8c4fa5d414d56e30a8f90e6a0080985893f5f2b",
      "created_at": "2025-07-02T23:02:52Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18441025792,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARLK7kA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18441025792",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "2e8a21a43a3c321c9f3a8c75024d036165658225",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/2e8a21a43a3c321c9f3a8c75024d036165658225",
      "created_at": "2025-07-02T23:03:52Z"
    },
    {
      "event": "commented",
      "id": 3029592937,
      "node_id": "IC_kwDOABII5860k-tp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3029592937",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-02T23:04:09Z",
      "updated_at": "2025-07-02T23:04:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased because of [spurious](https://github.com/bitcoin/bitcoin/actions/runs/16036317028/job/45248823045?pr=32273) CI failure fixed by #32859.",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3029592937",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "unlabeled",
      "id": 18441068028,
      "node_id": "UNLE_lADOABII586yg5qNzwAAAARLLF38",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18441068028",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-02T23:09:05Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2981001170,
      "node_id": "PRR_kwDOABII586xrnfS",
      "url": null,
      "actor": null,
      "commit_id": "2e8a21a43a3c321c9f3a8c75024d036165658225",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2981001170",
      "submitted_at": "2025-07-03T00:16:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "reviewed",
      "id": 2983599593,
      "node_id": "PRR_kwDOABII586x1h3p",
      "url": null,
      "actor": null,
      "commit_id": "2e8a21a43a3c321c9f3a8c75024d036165658225",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "re: https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3029455047\r\n\r\nSorry I didn't post my complete suggestion before. Here is the change I would suggest based on the current PR (2e8a21a43a3c321c9f3a8c75024d036165658225):\r\n\r\n<details><summary>diff</summary>\r\n<p>\r\n\r\n```diff\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -4253,30 +4253,16 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\r\n \r\n     // Make a backup of the DB in the wallet's directory with a unique filename\r\n     // using the wallet name and current timestamp. The backup filename is based\r\n-    // on the name of the parent directory containing the wallet data in most\r\n-    // cases, but in the case where the wallet name is a path to a data file,\r\n-    // the name of the data file is used, and in the case where the wallet name\r\n-    // is blank, \"default_wallet\" is used.\r\n-    auto legacy_wallet_path = GetWalletPath(wallet_name);\r\n-    if (!legacy_wallet_path) {\r\n-        return util::Error{util::ErrorString(legacy_wallet_path)};\r\n-    }\r\n-\r\n-    // Backwards-compatibility logic for migrating wallets whose names are\r\n-    // paths to data files directly rather than directories.\r\n-    bool is_direct_file = fs::symlink_status(*legacy_wallet_path).type() == fs::file_type::regular;\r\n-    std::string backup_prefix;\r\n-    if (wallet_name.empty()) {\r\n-        backup_prefix = \"default_wallet\";\r\n-    } else if (is_direct_file) {\r\n-        // We use filename() to strip slashes in the direct file name.\r\n-        backup_prefix = fs::PathToString(fs::PathFromString(wallet_name).filename());\r\n-    } else {\r\n-        // The canonical form resolves relative specifiers in the\r\n-        // wallet's path, useful for the backup prefix.\r\n-        auto legacy_wallet_dir = fs::weakly_canonical(*legacy_wallet_path);\r\n-        backup_prefix = fs::PathToString(legacy_wallet_dir.filename());\r\n-    }\r\n+    // on walletname but expanded to \"default_wallet\" if it is empty and only\r\n+    // the final filename portion is used if contains slashes.\r\n+    std::string backup_prefix = wallet_name.empty() ? \"default_wallet\" : [&] {\r\n+        // Normalize any .. components\r\n+        fs::path p{fs::PathFromString(wallet_name).lexically_normal()};\r\n+        // Drop trailing slash if any.\r\n+        if (p.filename().empty()) p = p.parent_path();\r\n+        // Return last path component\r\n+        return fs::PathToString(p.filename());\r\n+    }();\r\n     fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", backup_prefix, GetTime()));\r\n     fs::path backup_path = fsbridge::AbsPathJoin(GetWalletDir(), backup_filename);\r\n     if (!local_wallet->BackupWallet(fs::PathToString(backup_path))) {\r\n```\r\n</p>\r\n</details>\r\n\r\nThere isn't a reason I can see to access the filesystem just to convert a path into a backup prefix. IMO doing this makes the code unnecessarily fragile and complicated. I also don't think it's good to add a call to the `GetWalletPath()` function which is complicated enough to understand in the context of wallet loading, and shouldn't be responsible for supporting wallet migration code as well.\r\n\r\nI don't think belt and suspenders checks are a great idea in general, but even when they are appropriate I think they need to be labeled with \"// This condition is never expected to trigger\" or similar comments to avoid confusing people reading the code and trying understand why the checks are there.\r\n\r\n> Agreed, I've added [75df713](https://github.com/bitcoin/bitcoin/commit/75df71398dc4feefaa6f6ee611e41c5daa8ebc2b) which moves the backup from inside the wallet directory to being in the node's `-walletdir`.\r\n\r\nNice! I actually misinterpreted your commit and didn't realize storing backups inside wallet directories was actually previous behavior, but I think changing this does make sense and it is good to be able to remove the extra copy_file calls in the code.\r\n\r\n> Unfortunately, I think knowing the name of the wallet's parent folder requires filesystem access when arbitrary relative paths are permitted. `lexically_normal()` won't work in test cases like [8e20619](https://github.com/bitcoin/bitcoin/commit/8e20619341b465e30bdbfc22e6be515fb2ae2e6f) where the wallet is specified by a relative path that ascends more than it descends, or [e.g. the wallet named `../`.](https://godbolt.org/z/eTnhqe8de)\r\n\r\nI don't think this is true. If a wallet ascends more than it descends like `../../../../mywallet`, the suggested change would use \"mywallet\" as the prefix. If the path contains `.` components or internal `..`, `lexically_normal` will strip them out. If the path contains trailing slashes, the suggested code strips them out to. If the path is literally just `..` or `../..` or similar even that is fine, producing backups files like `.._1234.legacy.bak`\r\n\r\n> This code could just as well be: [...]\r\n\r\nYes, and I do think that change would be a clear simplification with no downsides. But I think it would be good to simplify even further and not resolve symlinks, not check to see if wallets are files or directories. None of this seems very helpful for choosing a good backup prefix.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2983599593",
      "submitted_at": "2025-07-03T16:04:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18461272174,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARMYKhu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18461272174",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "6b2e3fbf64b19b6065768ef85155f986859fcfb9",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/6b2e3fbf64b19b6065768ef85155f986859fcfb9",
      "created_at": "2025-07-03T22:33:03Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18461366718,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARMYhm-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18461366718",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9fa5480fc4c46fa11345c45fbe4dd21c127e3e05",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/9fa5480fc4c46fa11345c45fbe4dd21c127e3e05",
      "created_at": "2025-07-03T22:46:06Z"
    },
    {
      "event": "commented",
      "id": 3033891866,
      "node_id": "IC_kwDOABII58601YQa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3033891866",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-03T22:52:06Z",
      "updated_at": "2025-07-03T23:20:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I don't think belt and suspenders checks are a great idea in general, but even when they are appropriate I think they need to be labeled with \"// This condition is never expected to trigger\" or similar comments to avoid confusing people reading the code and trying understand why the checks are there.\r\n\r\nOK, in lieu of an assert/assume, I've gone to the simplified form suggested, and I've also used the lambda+ternary over if+else form as you suggested. I've also taken advantage of the fact that direct files will never have slashes in their names, so we can use the same logic for direct files and paths in picking a prefix:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/9fa5480fc4c46fa11345c45fbe4dd21c127e3e05/src/wallet/wallet.cpp#L4260-L4267\r\n\r\nBut, I have retained the use of `fs::weakly_canonical`, since:\r\n\r\n> If the path is literally just .. or ../.. or similar even that is fine, producing backups files like .._1234.legacy.bak\r\n\r\nWhile better than master, I don't think this is the right behavior, and I'm not sure I follow why it's fragile or complicated for us to ask the filesystem to resolve the canonical names of paths, and it's the only way to preserve what seems to me the ideal behavior of naming the wallet backup after the name of the wallet directory it comes from.\r\n",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3033891866",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "reviewed",
      "id": 2984991650,
      "node_id": "PRR_kwDOABII586x61ui",
      "url": null,
      "actor": null,
      "commit_id": "9fa5480fc4c46fa11345c45fbe4dd21c127e3e05",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2984991650",
      "submitted_at": "2025-07-04T00:15:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18462015141,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARMa_6l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18462015141",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "290042b08c92da194d6cc73a17c7ed4121c8602a",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/290042b08c92da194d6cc73a17c7ed4121c8602a",
      "created_at": "2025-07-04T00:30:40Z"
    },
    {
      "event": "labeled",
      "id": 18575380141,
      "node_id": "LE_lADOABII586yg5qNzwAAAARTLc6t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18575380141",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T23:28:03Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3010529273,
      "node_id": "PRR_kwDOABII586zcQf5",
      "url": null,
      "actor": null,
      "commit_id": "5ab42b413f1ed2ac421fc6ceb1eb3560d62ed94e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-3010529273",
      "submitted_at": "2025-07-11T14:24:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUyMmMzNTk5YzY3NzI3MzBlNzJlMTdmYzY4Yzk5ZmVlYTA5YjRkMjk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e22c3599c6772730e72e17fc68c99feea09b4d29",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e22c3599c6772730e72e17fc68c99feea09b4d29",
      "tree": {
        "sha": "67055cfcaf66fc1b51c42a8d9730690f5e503347",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/67055cfcaf66fc1b51c42a8d9730690f5e503347"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9f713b83dcf7480e6c4447f0f263bef096d55cc7",
          "sha": "9f713b83dcf7480e6c4447f0f263bef096d55cc7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9f713b83dcf7480e6c4447f0f263bef096d55cc7"
        }
      ],
      "message": "test: wallet: Check direct file backup name.\n\nThis check ensures that when migrating a legacy wallet with a direct\nfilename, the backup file is named as expected.\n\nCo-authored-by: Ava Chow <github@achow101.com>",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:54Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-06-30T21:46:33Z"
      },
      "sha": "e22c3599c6772730e72e17fc68c99feea09b4d29"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY2ZWU1OWI2ZTI5OTVhMzkxNmZiNGYwZDRjYmUxNWVjZTIwNTQ0OTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6ee59b6e2995a3916fb4f0d4cbe15ece2054494",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f6ee59b6e2995a3916fb4f0d4cbe15ece2054494",
      "tree": {
        "sha": "8cad82460cf102e333f144e1489befb3b3e41142",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8cad82460cf102e333f144e1489befb3b3e41142"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e22c3599c6772730e72e17fc68c99feea09b4d29",
          "sha": "e22c3599c6772730e72e17fc68c99feea09b4d29",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e22c3599c6772730e72e17fc68c99feea09b4d29"
        }
      ],
      "message": "wallet: migration: Make backup in walletdir",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-02T20:58:03Z"
      },
      "sha": "f6ee59b6e2995a3916fb4f0d4cbe15ece2054494"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDcwZjFjOTljOTAxZGU2NGQ2Y2NlYTc5M2I3ZTI2N2UyMGRmYTQ5Y2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70f1c99c901de64d6ccea793b7e267e20dfa49cf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/70f1c99c901de64d6ccea793b7e267e20dfa49cf",
      "tree": {
        "sha": "20cfed0bed316c2ad718ecc9bd89456d6b3c078e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/20cfed0bed316c2ad718ecc9bd89456d6b3c078e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6ee59b6e2995a3916fb4f0d4cbe15ece2054494",
          "sha": "f6ee59b6e2995a3916fb4f0d4cbe15ece2054494",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f6ee59b6e2995a3916fb4f0d4cbe15ece2054494"
        }
      ],
      "message": "wallet: Fix migration of wallets with pathnames.\n\nCo-authored-by: Russell Yanofsky <russ@yanofsky.org>",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-12T07:03:40Z"
      },
      "sha": "70f1c99c901de64d6ccea793b7e267e20dfa49cf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYzYzZkMzY0Mzc2OTA3YzEwYjliYWEzYzZmNGQ3MmUzZjE4ODFhYmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/63c6d364376907c10b9baa3c6f4d72e3f1881abc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/63c6d364376907c10b9baa3c6f4d72e3f1881abc",
      "tree": {
        "sha": "ecd87acdf8c8e1645828918e8b98380e681a88d8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ecd87acdf8c8e1645828918e8b98380e681a88d8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/70f1c99c901de64d6ccea793b7e267e20dfa49cf",
          "sha": "70f1c99c901de64d6ccea793b7e267e20dfa49cf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/70f1c99c901de64d6ccea793b7e267e20dfa49cf"
        }
      ],
      "message": "test: Migration of a wallet with `../` in path.",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-12T07:05:03Z"
      },
      "sha": "63c6d364376907c10b9baa3c6f4d72e3f1881abc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQxZmFlZjVmODBkNjllZDk4NGFmNjg1YmQ5ZDJhNDMyNjgwMDlmYjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/41faef5f80d69ed984af685bd9d2a43268009fb6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/41faef5f80d69ed984af685bd9d2a43268009fb6",
      "tree": {
        "sha": "dc1f5a0e9f4b8a4578bdd9f05d55c3335b8d2576",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dc1f5a0e9f4b8a4578bdd9f05d55c3335b8d2576"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/63c6d364376907c10b9baa3c6f4d72e3f1881abc",
          "sha": "63c6d364376907c10b9baa3c6f4d72e3f1881abc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/63c6d364376907c10b9baa3c6f4d72e3f1881abc"
        }
      ],
      "message": "test: Migration fail recovery w/ `../` in path",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-16T21:11:12Z"
      },
      "sha": "41faef5f80d69ed984af685bd9d2a43268009fb6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYwYmIzZDUwZmVmMDhkOWY5ODFlYWM0NTg0MWVmMmRmNzQ0NDAzMWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0bb3d50fef08d9f981eac45841ef2df7444031b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f0bb3d50fef08d9f981eac45841ef2df7444031b",
      "tree": {
        "sha": "2d09908970fdf031e24e33a8e23b6220c64a9cdd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2d09908970fdf031e24e33a8e23b6220c64a9cdd"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/41faef5f80d69ed984af685bd9d2a43268009fb6",
          "sha": "41faef5f80d69ed984af685bd9d2a43268009fb6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/41faef5f80d69ed984af685bd9d2a43268009fb6"
        }
      ],
      "message": "test: Migration of a wallet ending in `/`",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-03T22:29:27Z"
      },
      "sha": "f0bb3d50fef08d9f981eac45841ef2df7444031b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc2ZmUwZTU5ZWM0YTViMGM1YjE4ZjQ2YmZjYmJmOTk2MjhkNzRkNzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "tree": {
        "sha": "a240fb24c9b1031b0da3afd2d4a7dfb38feb74ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a240fb24c9b1031b0da3afd2d4a7dfb38feb74ab"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0bb3d50fef08d9f981eac45841ef2df7444031b",
          "sha": "f0bb3d50fef08d9f981eac45841ef2df7444031b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f0bb3d50fef08d9f981eac45841ef2df7444031b"
        }
      ],
      "message": "test: Migration of a wallet ending in `../`",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-17T00:50:58Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-07-03T22:30:18Z"
      },
      "sha": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18669951618,
      "node_id": "HRFPE_lADOABII586yg5qNzwAAAARY0NqC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18669951618",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "commit_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits/76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "created_at": "2025-07-17T00:51:08Z"
    },
    {
      "event": "commented",
      "id": 3081990855,
      "node_id": "IC_kwDOABII5863s3LH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3081990855",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-17T00:51:35Z",
      "updated_at": "2025-07-17T00:51:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased to address @pablomartin4btc's feedback and merge conflict. ",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-3081990855",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "mentioned",
      "id": 18669954594,
      "node_id": "MEE_lADOABII586yg5qNzwAAAARY0OYi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18669954594",
      "actor": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-17T00:51:37Z"
    },
    {
      "event": "subscribed",
      "id": 18669954600,
      "node_id": "SE_lADOABII586yg5qNzwAAAARY0OYo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18669954600",
      "actor": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-17T00:51:37Z"
    },
    {
      "event": "unlabeled",
      "id": 18670755875,
      "node_id": "UNLE_lADOABII586yg5qNzwAAAARY3SAj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18670755875",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-17T02:31:19Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3049728359,
      "node_id": "PRR_kwDOABII5861xyln",
      "url": null,
      "actor": null,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "tACK 76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77\r\n\r\nI've re-[tested](https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2964023741) the relative path cases and the plainfile [issue](https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2819784017) has been fixed.\r\n\r\nRegarding the usage of `fs::weakly_canonical` vs `lexically_normal()`, I agree with @ryanofsky, I think that resource cost-wise, to \"access\" the filesystem in order to validate the name that we'll use for the backup file that it'll be written and validated then (its existence/ permission and so on). If there's something that `lexically_normal()` can't do right comparing to what `fs::weakly_canonical` does, I think we should go around that logic (if possible).\r\n\r\ne.g. `fs::path(\"/foo/./bar/../baz\").lexically_normal()  ‚Üí \"/foo/baz\"` (even if /foo/baz doesn't exist ‚Äî this will still work).\r\n\r\nIn any case, are we logging the before & after applying this parsing (using `fs::weakly_canonical` or `lexically_normal()`)? Also perhaps we should document some examples somewhere so the users can find out why something they tried didn't meet their expectations (was accidentally stored somewhere else or with a different name). ",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-3049728359",
      "submitted_at": "2025-07-24T01:59:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    },
    {
      "event": "review_requested",
      "id": 18785563775,
      "node_id": "RRE_lADOABII586yg5qNzwAAAARftPR_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18785563775",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-24T01:59:49Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3056922125,
      "node_id": "PRR_kwDOABII5862NO4N",
      "url": null,
      "actor": null,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-3056922125",
      "submitted_at": "2025-07-25T22:43:24Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2044541799",
      "pull_request_review_id": 2768274932,
      "id": 2044541799,
      "node_id": "PRRC_kwDOABII58553Ttn",
      "diff_hunk": "@@ -4500,9 +4500,11 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\n     }\n \n     // Make a backup of the DB\n-    fs::path this_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n-    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : wallet_name), GetTime()));\n-    fs::path backup_path = this_wallet_dir / backup_filename;\n+    fs::path legacy_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n+    // Use the wallet directory's name, rather than the wallet name, to avoid issues with wallet's whose names contain relative file paths.",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "db3974ee11b50c5cdccd277aa6d5cce660032718",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"wallet: Fix relative path backup during migration.\" (db3974ee11b50c5cdccd277aa6d5cce660032718)\r\n\r\nThis comment doesn't seem right. A relative file path like \"foo\" would not cause issues here. The problems happen with paths that contains slashes, which is why the line below is calling `filename()` to drop everything before the last slash. \r\n\r\nWould suggest a different comment that explains what this is trying to do. Maybe: \"Create a backup copy of wallet data inside the wallet directory with a unique and descriptive filename, based on the name of the wallet and the current timestamp. If this wallet is not the default wallet, the last component of the wallet's directory name is used as the backup filename since the full wallet name may contain slashes.\"",
      "created_at": "2025-04-15T13:27:26Z",
      "updated_at": "2025-04-15T13:31:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2044541799",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2044541799"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045181728",
      "pull_request_review_id": 2769318679,
      "id": 2045181728,
      "node_id": "PRRC_kwDOABII58555v8g",
      "diff_hunk": "@@ -4500,9 +4500,11 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\n     }\n \n     // Make a backup of the DB\n-    fs::path this_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n-    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : wallet_name), GetTime()));\n-    fs::path backup_path = this_wallet_dir / backup_filename;\n+    fs::path legacy_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n+    // Use the wallet directory's name, rather than the wallet name, to avoid issues with wallet's whose names contain relative file paths.",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "db3974ee11b50c5cdccd277aa6d5cce660032718",
      "in_reply_to_id": 2044541799,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> This comment doesn't seem right.\r\n\r\nThis was wrong, thanks! I've added a variation of the comment you suggested that I edited for brevity. I think it should be more correct now.\r\n\r\n```cpp\r\n    // Make a backup of the DB in the wallet's directory with a unique filename using the wallet\r\n    // name and current timestamp. If not the default wallet, the name of the folder containing\r\n    // wallet data is used as the wallet's name, since its full name may contain slashes.\r\n```",
      "created_at": "2025-04-15T17:59:27Z",
      "updated_at": "2025-04-15T18:00:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2045181728",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2045181728"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 4504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2048325592",
      "pull_request_review_id": 2774722336,
      "id": 2048325592,
      "node_id": "PRRC_kwDOABII5856FvfY",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")",
      "path": "test/functional/wallet_migration.py",
      "position": 200,
      "original_position": 124,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Writing as a review comment since I didn't think a code comment was warranted here, the reason for putting this on a separate line even though it is only used once is to avoid the wrath of the slightly [imprecise](https://github.com/bitcoin/bitcoin/blob/e66e30c9e5383a467789574e61114b57536193b9/test/lint/lint-python-utf8-encoding.py#L31) python-utf8-encoding [lint check](https://github.com/bitcoin/bitcoin/blob/e66e30c9e5383a467789574e61114b57536193b9/test/lint/lint-python-utf8-encoding.py) which otherwise won't catch that the file is being opened in binary mode.",
      "created_at": "2025-04-17T06:32:31Z",
      "updated_at": "2025-04-17T06:32:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2048325592",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2048325592"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1076,
      "original_line": 1076,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050006636",
      "pull_request_review_id": 2777511534,
      "id": 2050006636,
      "node_id": "PRRC_kwDOABII5856MJ5s",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relative\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+        # listwalletdirs only returns wallets in the wallet directory",
      "path": "test/functional/wallet_migration.py",
      "position": 62,
      "original_position": 26,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "You could reframe the comment to explain why this is significant:\r\n\r\n```\r\n# Wallet created using relative path won't reside in the default wallet dir,\r\n# hence it should not appear in listwalletdir results.\r\n```",
      "created_at": "2025-04-18T04:22:26Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050006636",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050006636"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 580,
      "original_line": 580,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050007265",
      "pull_request_review_id": 2777511534,
      "id": 2050007265,
      "node_id": "PRRC_kwDOABII5856MKDh",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))",
      "path": "test/functional/wallet_migration.py",
      "position": 55,
      "original_position": 19,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If this assumption ever fails (say due to environment setup differences), the test will break early.\r\nConsider failing gracefully with a more informative message:\r\n\r\n```\r\nassert_equal(..., ..., \"Relative paths from wallet dirs to common parent must be identical for this test.\")\r\n```",
      "created_at": "2025-04-18T04:24:00Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050007265",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050007265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 573,
      "original_line": 573,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050010952",
      "pull_request_review_id": 2777511534,
      "id": 2050010952,
      "node_id": "PRRC_kwDOABII5856MK9I",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relative\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+        # listwalletdirs only returns wallets in the wallet directory\n+        assert {\"name\": relative_name} not in wallet.listwalletdir()[\"wallets\"]\n+        assert relative_name in wallet.listwallets()\n+\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+        wallet.unloadwallet()\n+\n+        # migratewallet uses current time in naming the backup file, set a mock time\n+        # to check that this works correctly.\n+        curr_time = int(time.time())\n+        self.master_node.setmocktime(curr_time)\n+        migrate_res = self.master_node.migratewallet(relative_name)\n+        self.master_node.setmocktime(0)\n+\n+        # Check that the wallet was migrated, knows the right txid, and has the right balance.\n+        wallet = self.master_node.get_wallet_rpc(relative_name)\n+        assert wallet.gettransaction(txid)\n+        assert_equal(bals, wallet.getbalances())\n+\n+        info = wallet.getwalletinfo()\n+        assert_equal(info[\"descriptors\"], True)\n+        assert_equal(info[\"format\"], \"sqlite\")\n+\n+        # The migrated wallet should not be in the wallet dir, but should be in the list of wallets.\n+        walletlist = wallet.listwallets()\n+        walletdirlist = wallet.listwalletdir()\n+        assert {\"name\": info[\"walletname\"]} not in walletdirlist[\"wallets\"]\n+        assert info[\"walletname\"] in walletlist\n+\n+        # Check that backup exists where expected and isn't in the wallet list.\n+        backup_filename = f\"{wallet_name}_{curr_time}.legacy.bak\"\n+        backup_path = os.path.join(common_parent, wallet_name, backup_filename)\n+        assert os.path.exists(backup_path)\n+        assert_equal(os.path.realpath(backup_path), os.path.realpath(migrate_res['backup_path']))\n+        assert {\"name\": backup_filename} not in walletdirlist[\"wallets\"]\n+\n+        # Check that old node can restore from the backup.\n+        self.old_node.restorewallet(\"relative_restored\", migrate_res['backup_path'])\n+        wallet = self.old_node.get_wallet_rpc(\"relative_restored\")\n+        assert wallet.gettransaction(txid)",
      "path": "test/functional/wallet_migration.py",
      "position": 95,
      "original_position": 69,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can we add more stricter checks on the transaction received here.\r\n\r\nFor example:\r\n```\r\ntx = wallet.gettransaction(txid)\r\nassert_equal(tx[\"amount\"], 1)\r\nassert_equal(tx[\"confirmations\"], 1)\r\n```\r\nThis gives you tighter guarantees and helps with debugging if the test fails.",
      "created_at": "2025-04-18T04:31:00Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050010952",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050010952"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 613,
      "original_line": 613,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050013797",
      "pull_request_review_id": 2777511534,
      "id": 2050013797,
      "node_id": "PRRC_kwDOABII5856MLpl",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 117,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit: May be a small comment with reason would help here:\r\n```\r\n# No 'failed_watchonly' directory should exist because migration cleanup should be complete\r\n```",
      "created_at": "2025-04-18T04:36:41Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050013797",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050013797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1072,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050015403",
      "pull_request_review_id": 2777511534,
      "id": 2050015403,
      "node_id": "PRRC_kwDOABII5856MMCr",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))",
      "path": "test/functional/wallet_migration.py",
      "position": 166,
      "original_position": 90,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Similar to previous test and all other places, can we fail gracefully with more informative message:\r\n```\r\nassert_equal(..., ..., \"Test requires that both wallet paths have the same relative path to the common parent\")\r\n```",
      "created_at": "2025-04-18T04:38:13Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050015403",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050015403"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1042,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050018648",
      "pull_request_review_id": 2777511534,
      "id": 2050018648,
      "node_id": "PRRC_kwDOABII5856MM1Y",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")\n+        with open(datfile, \"rb\") as f:",
      "path": "test/functional/wallet_migration.py",
      "position": 201,
      "original_position": 125,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We should first validate that file is present at the specified location and accessible and then only try to open and validate other things",
      "created_at": "2025-04-18T04:41:48Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050018648",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050018648"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1077,
      "original_line": 1077,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050019504",
      "pull_request_review_id": 2777511534,
      "id": 2050019504,
      "node_id": "PRRC_kwDOABII5856MNCw",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")\n+        with open(datfile, \"rb\") as f:",
      "path": "test/functional/wallet_migration.py",
      "position": 201,
      "original_position": 125,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "**Minor / Nit:** A separate helper function could be introduced to validate it's BDB for better readability.\r\nExample:\r\n```\r\ndef is_bdb_wallet(filepath):\r\n    with open(filepath, \"rb\") as f:\r\n        data = f.read(16)\r\n        _, _, magic = struct.unpack(\"QII\", data)\r\n        return magic == BTREE_MAGIC\r\n```\r\n\r\nand then:\r\n```\r\nassert is_bdb_wallet(datfile)\r\n```\r\n",
      "created_at": "2025-04-18T04:43:29Z",
      "updated_at": "2025-04-18T04:44:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2050019504",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2050019504"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1077,
      "original_line": 1077,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056790435",
      "pull_request_review_id": 2788554011,
      "id": 2056790435,
      "node_id": "PRRC_kwDOABII5856mCGj",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relative\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+        # listwalletdirs only returns wallets in the wallet directory",
      "path": "test/functional/wallet_migration.py",
      "position": 62,
      "original_position": 26,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2050006636,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Rather than explaining the line below, I added this comment to add context that I think isn't immediately available from the test, namely what the (obscure in both use and name) `listwalletdir` rpc does, I think your suggested comment would repeat what the test is asserting.",
      "created_at": "2025-04-23T19:56:53Z",
      "updated_at": "2025-04-23T19:56:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056790435",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056790435"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 580,
      "original_line": 580,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056813556",
      "pull_request_review_id": 2788591920,
      "id": 2056813556,
      "node_id": "PRRC_kwDOABII5856mHv0",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))",
      "path": "test/functional/wallet_migration.py",
      "position": 55,
      "original_position": 19,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2050007265,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Unlike, [`assert_not_equal`](https://github.com/bitcoin/bitcoin/blob/6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97/test/functional/test_framework/util.py#L79-L81), `assert_equal` [does not support](https://github.com/bitcoin/bitcoin/blob/6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97/test/functional/test_framework/util.py#L72-L77) passing an error message. Re: the conceptual change; while it might have some advantages over the style currently used, as far as I can tell it is almost never the case that we log the \"big picture\" of what went wrong in a functional test, rather than details about the exact comparison or check that failed.",
      "created_at": "2025-04-23T20:16:15Z",
      "updated_at": "2025-04-23T20:16:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056813556",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056813556"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 573,
      "original_line": 573,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056837989",
      "pull_request_review_id": 2788630870,
      "id": 2056837989,
      "node_id": "PRRC_kwDOABII5856mNtl",
      "diff_hunk": "@@ -531,6 +532,70 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_unloaded_by_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relative\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+        # listwalletdirs only returns wallets in the wallet directory\n+        assert {\"name\": relative_name} not in wallet.listwalletdir()[\"wallets\"]\n+        assert relative_name in wallet.listwallets()\n+\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+        wallet.unloadwallet()\n+\n+        # migratewallet uses current time in naming the backup file, set a mock time\n+        # to check that this works correctly.\n+        curr_time = int(time.time())\n+        self.master_node.setmocktime(curr_time)\n+        migrate_res = self.master_node.migratewallet(relative_name)\n+        self.master_node.setmocktime(0)\n+\n+        # Check that the wallet was migrated, knows the right txid, and has the right balance.\n+        wallet = self.master_node.get_wallet_rpc(relative_name)\n+        assert wallet.gettransaction(txid)\n+        assert_equal(bals, wallet.getbalances())\n+\n+        info = wallet.getwalletinfo()\n+        assert_equal(info[\"descriptors\"], True)\n+        assert_equal(info[\"format\"], \"sqlite\")\n+\n+        # The migrated wallet should not be in the wallet dir, but should be in the list of wallets.\n+        walletlist = wallet.listwallets()\n+        walletdirlist = wallet.listwalletdir()\n+        assert {\"name\": info[\"walletname\"]} not in walletdirlist[\"wallets\"]\n+        assert info[\"walletname\"] in walletlist\n+\n+        # Check that backup exists where expected and isn't in the wallet list.\n+        backup_filename = f\"{wallet_name}_{curr_time}.legacy.bak\"\n+        backup_path = os.path.join(common_parent, wallet_name, backup_filename)\n+        assert os.path.exists(backup_path)\n+        assert_equal(os.path.realpath(backup_path), os.path.realpath(migrate_res['backup_path']))\n+        assert {\"name\": backup_filename} not in walletdirlist[\"wallets\"]\n+\n+        # Check that old node can restore from the backup.\n+        self.old_node.restorewallet(\"relative_restored\", migrate_res['backup_path'])\n+        wallet = self.old_node.get_wallet_rpc(\"relative_restored\")\n+        assert wallet.gettransaction(txid)",
      "path": "test/functional/wallet_migration.py",
      "position": 95,
      "original_position": 69,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2050010952,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We are already asserting the transaction id exists in the migrated wallet, and that the wallet has the correct balance, I'm not totally opposed to checking the tx amount as opposed to the wallet balance, but I'm not sure that this change really does add any guarantees, or help with debugging when the test fails, so I will err on the side of keeping this as-is so it [parallels](https://github.com/bitcoin/bitcoin/blob/9a4c92eb9ac29204df3d826f5ae526ab16b8ad65/test/functional/wallet_migration.py#L530-L532) `test_unloaded_by_path` above, although after testing, I realized that the `assert` I had here does not do anything, since if `gettransaction` fails, it results in a `JSONRPCException`. ",
      "created_at": "2025-04-23T20:36:15Z",
      "updated_at": "2025-04-23T20:36:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056837989",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056837989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 613,
      "original_line": 613,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056840721",
      "pull_request_review_id": 2788635476,
      "id": 2056840721,
      "node_id": "PRRC_kwDOABII5856mOYR",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))",
      "path": "test/functional/wallet_migration.py",
      "position": 166,
      "original_position": 90,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2050015403,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "See https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056813556.",
      "created_at": "2025-04-23T20:38:43Z",
      "updated_at": "2025-04-23T20:38:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056840721",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056840721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1042,
      "original_line": 1042,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056844763",
      "pull_request_review_id": 2788641648,
      "id": 2056844763,
      "node_id": "PRRC_kwDOABII5856mPXb",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")\n+        with open(datfile, \"rb\") as f:",
      "path": "test/functional/wallet_migration.py",
      "position": 201,
      "original_position": 125,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2050018648,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If `open` fails an exception will be thrown and the block below it will not be executed.\r\n\r\nhttps://docs.python.org/3/reference/compound_stmts.html#with",
      "created_at": "2025-04-23T20:42:01Z",
      "updated_at": "2025-04-23T20:42:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2056844763",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2056844763"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1077,
      "original_line": 1077,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2175739001",
      "pull_request_review_id": 2972374504,
      "id": 2175739001,
      "node_id": "PRRC_kwDOABII586BryR5",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")\n+        with open(datfile, \"rb\") as f:\n+            data = f.read(16)\n+            _, _, magic = struct.unpack(\"QII\", data)\n+            assert_equal(magic, BTREE_MAGIC)\n+\n+\n     def test_blank(self):",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 131,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": null,
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: extra line here?\r\n```suggestion\r\n            assert_equal(magic, BTREE_MAGIC)\r\n\r\n    def test_blank(self):\r\n```",
      "created_at": "2025-06-30T19:18:25Z",
      "updated_at": "2025-06-30T19:18:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2175739001",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2175739001"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 1038,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2176170471",
      "pull_request_review_id": 2973113567,
      "id": 2176170471,
      "node_id": "PRRC_kwDOABII586Btbnn",
      "diff_hunk": "@@ -925,6 +990,54 @@ def test_failed_migration_cleanup(self):\n             wallets = self.master_node.listwallets()\n             assert \"failed\" in wallets and all(wallet not in wallets for wallet in [\"failed_watchonly\", \"failed_solvables\"])\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()\n+        # Since the file in failed_solvables is one that we put there, migration shouldn't touch it\n+        assert os.path.exists(solvables_path)\n+        new_shasum = sha256sum_file(os.path.join(solvables_path , \"wallet.dat\"))\n+        assert_equal(original_shasum, new_shasum)\n+\n+        # Check the wallet we tried to migrate is still BDB\n+        datfile = os.path.join(absolute_path, \"wallet.dat\")\n+        with open(datfile, \"rb\") as f:\n+            data = f.read(16)\n+            _, _, magic = struct.unpack(\"QII\", data)\n+            assert_equal(magic, BTREE_MAGIC)\n+\n+\n     def test_blank(self):",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 131,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "6b4b7ac2113ed969bd31ce42190b96bd2e1b9c97",
      "in_reply_to_id": 2175739001,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Fixed, thanks.",
      "created_at": "2025-07-01T00:11:52Z",
      "updated_at": "2025-07-01T00:11:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2176170471",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2176170471"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 1038,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2181204274",
      "pull_request_review_id": 2981001170,
      "id": 2181204274,
      "node_id": "PRRC_kwDOABII586CAoky",
      "diff_hunk": "@@ -148,7 +148,10 @@ def test_basic(self):\n         assert_equal(old_change_addr_info[\"hdkeypath\"], \"m/0'/1'/0'\")\n \n         # Note: migration could take a while.\n-        _, basic0 = self.migrate_and_get_rpc(\"basic0\")\n+        res0, basic0 = self.migrate_and_get_rpc(\"basic0\")\n+        backup_path = self.master_node.wallets_path / f\"basic0_{int(time.time())}.legacy.bak\"\n+        assert backup_path.exists()\n+        assert_equal(str(backup_path), res0['backup_path'])",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 8,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "c38297c741037c8cbb688f89307a0d7b5f34034a",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: we are already doing the backup file existence check at the end of `migrate_and_get_rpc()`, what if you include this extra check there too? ",
      "created_at": "2025-07-03T00:16:09Z",
      "updated_at": "2025-07-03T00:24:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2181204274",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2181204274"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 152,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183052507",
      "pull_request_review_id": 2983599593,
      "id": 2183052507,
      "node_id": "PRRC_kwDOABII586CHrzb",
      "diff_hunk": "@@ -551,6 +551,38 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_wallet_with_path_ending_in_slash(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in '/'\")\n+\n+        # The last directory in the wallet's path\n+        final_dir = \"mywallet\"\n+        wallet_name = f\"path/to/{final_dir}/\"\n+        wallet = self.create_legacy_wallet(wallet_name)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        wallet.unloadwallet()\n+\n+        wallet_path = f\"{self.old_node.wallets_path}/{wallet_name}\"\n+        migrate_res = self.master_node.migratewallet(wallet_path)\n+        expected_backup_path = self.master_node.wallets_path / f\"{final_dir}_{int(time.time())}.legacy.bak\"\n+        os.path.exists(expected_backup_path)",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 23,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "499099320b138c3d895d3ad8a622a08e404008d6",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"test: Migration of a wallet ending in `/`\" (499099320b138c3d895d3ad8a622a08e404008d6)\r\n\r\nThis fails on my system because the test is racy. By the time backup is created time.time() is higher than the backup time.\r\n\r\nAlso the os.path.exists() return value is discarded here so this doesn't actually check anything.\r\n\r\nHere are the changes I made to fix these problems. (Another approach might be to set a mock time instead)\r\n\r\n<details><summary>diff</summary>\r\n<p>\r\n\r\n```diff\r\n--- a/test/functional/wallet_migration.py\r\n+++ b/test/functional/wallet_migration.py\r\n@@ -5,6 +5,7 @@\r\n \"\"\"Test Migrating a wallet from legacy to descriptor.\"\"\"\r\n import os.path\r\n import random\r\n+import re\r\n import shutil\r\n import struct\r\n import time\r\n@@ -23,6 +24,7 @@ from test_framework.script import hash160\r\n from test_framework.script_util import key_to_p2pkh_script, key_to_p2pk_script, script_to_p2sh_script, script_to_p2wsh_script\r\n from test_framework.util import (\r\n     assert_equal,\r\n+    assert_not_equal,\r\n     assert_raises_rpc_error,\r\n     find_vout_for_address,\r\n     sha256sum_file,\r\n@@ -567,9 +569,8 @@ class WalletMigrationTest(BitcoinTestFramework):\r\n \r\n         wallet_ending_in_rel_path = f\"{self.old_node.wallets_path}/{wallet_ending_in_relative}\"\r\n         migrate_res = self.master_node.migratewallet(wallet_ending_in_rel_path)\r\n-        expected_backup_path = self.master_node.wallets_path / f\"ends_{int(time.time())}.legacy.bak\"\r\n-        os.path.exists(expected_backup_path)\r\n-        assert_equal(f\"{expected_backup_path}\", migrate_res['backup_path'])\r\n+        assert_not_equal(re.fullmatch(re.escape(str(self.master_node.wallets_path / \"ends\")) + r\"_\\d+\\.legacy\\.bak\", migrate_res['backup_path']), None)\r\n+        assert_equal(os.path.exists(migrate_res['backup_path']), True)\r\n \r\n         wallet = self.master_node.get_wallet_rpc(wallet_ending_in_rel_path)\r\n         info = wallet.getwalletinfo()\r\n@@ -598,9 +599,8 @@ class WalletMigrationTest(BitcoinTestFramework):\r\n \r\n         wallet_path = f\"{self.old_node.wallets_path}/{wallet_name}\"\r\n         migrate_res = self.master_node.migratewallet(wallet_path)\r\n-        expected_backup_path = self.master_node.wallets_path / f\"{final_dir}_{int(time.time())}.legacy.bak\"\r\n-        os.path.exists(expected_backup_path)\r\n-        assert_equal(f\"{expected_backup_path}\", migrate_res['backup_path'])\r\n+        assert_not_equal(re.fullmatch(re.escape(str(self.master_node.wallets_path / final_dir)) + r\"_\\d+\\.legacy\\.bak\", migrate_res['backup_path']), None)\r\n+        assert_equal(os.path.exists(migrate_res['backup_path']), True)\r\n \r\n         wallet = self.master_node.get_wallet_rpc(wallet_path)\r\n \r\n```\r\n</p>\r\n</details>\r\n\r\n\r\n\r\n",
      "created_at": "2025-07-03T15:15:03Z",
      "updated_at": "2025-07-03T16:04:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183052507",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183052507"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 572,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 573,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183868035",
      "pull_request_review_id": 2984881508,
      "id": 2183868035,
      "node_id": "PRRC_kwDOABII586CKy6D",
      "diff_hunk": "@@ -148,7 +148,10 @@ def test_basic(self):\n         assert_equal(old_change_addr_info[\"hdkeypath\"], \"m/0'/1'/0'\")\n \n         # Note: migration could take a while.\n-        _, basic0 = self.migrate_and_get_rpc(\"basic0\")\n+        res0, basic0 = self.migrate_and_get_rpc(\"basic0\")\n+        backup_path = self.master_node.wallets_path / f\"basic0_{int(time.time())}.legacy.bak\"\n+        assert backup_path.exists()\n+        assert_equal(str(backup_path), res0['backup_path'])",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 8,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "c38297c741037c8cbb688f89307a0d7b5f34034a",
      "in_reply_to_id": 2181204274,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks for this suggestion, I've implemented this approach in https://github.com/bitcoin/bitcoin/pull/32273/commits/55e60bd9c76ea74a108cd5c7275e26554b822b4c, and I've reused `migrate_and_get_rpc()` in the other tests added in this PR (except [`test_failed_migration_cleanup_relative_path()`](https://github.com/bitcoin/bitcoin/blob/6b2e3fbf64b19b6065768ef85155f986859fcfb9/test/functional/wallet_migration.py#L1038) where it's not feasible) ",
      "created_at": "2025-07-03T22:40:02Z",
      "updated_at": "2025-07-03T22:40:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183868035",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183868035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 152,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183873334",
      "pull_request_review_id": 2984887052,
      "id": 2183873334,
      "node_id": "PRRC_kwDOABII586CK0M2",
      "diff_hunk": "@@ -551,6 +551,38 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_wallet_with_path_ending_in_slash(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in '/'\")\n+\n+        # The last directory in the wallet's path\n+        final_dir = \"mywallet\"\n+        wallet_name = f\"path/to/{final_dir}/\"\n+        wallet = self.create_legacy_wallet(wallet_name)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        wallet.unloadwallet()\n+\n+        wallet_path = f\"{self.old_node.wallets_path}/{wallet_name}\"\n+        migrate_res = self.master_node.migratewallet(wallet_path)\n+        expected_backup_path = self.master_node.wallets_path / f\"{final_dir}_{int(time.time())}.legacy.bak\"\n+        os.path.exists(expected_backup_path)",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 23,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "499099320b138c3d895d3ad8a622a08e404008d6",
      "in_reply_to_id": 2183052507,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "As suggested by @furszy [above](https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2181204274) I moved this logic to `migrate_and_get_rpc()` in https://github.com/bitcoin/bitcoin/commit/55e60bd9c76ea74a108cd5c7275e26554b822b4c:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/6b2e3fbf64b19b6065768ef85155f986859fcfb9/test/functional/wallet_migration.py#L125-L147\r\n\r\nAnd I've reused `migrate_and_get_rpc()` in the tests added in this PR.",
      "created_at": "2025-07-03T22:43:41Z",
      "updated_at": "2025-07-03T22:43:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183873334",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183873334"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 572,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 573,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183964782",
      "pull_request_review_id": 2984991650,
      "id": 2183964782,
      "node_id": "PRRC_kwDOABII586CLKhu",
      "diff_hunk": "@@ -997,6 +997,53 @@ def test_failed_migration_cleanup(self):\n             _, _, magic = struct.unpack(\"QII\", data)\n             assert_equal(magic, BTREE_MAGIC)\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 38,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "e7fec273593d825e0e7dbec46a026aacc58c479f",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In e7fec273593d825e0e7dbec46a026aacc58c479f \"test: Migration fail recovery w/ `../` in path\"\r\n\r\nI think `failed_watchonly` is the wrong wallet name. Probably best to do `f\"{wallet_name}_watchonly\"`",
      "created_at": "2025-07-04T00:13:34Z",
      "updated_at": "2025-07-04T00:15:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183964782",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183964782"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1034,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183965661",
      "pull_request_review_id": 2984991650,
      "id": 2183965661,
      "node_id": "PRRC_kwDOABII586CLKvd",
      "diff_hunk": "@@ -618,6 +618,26 @@ def test_wallet_with_relative_path(self):\n         assert_equal(info[\"descriptors\"], False)\n         assert_equal(info[\"format\"], \"bdb\")\n \n+    def test_wallet_with_path_ending_in_slash(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in '/'\")\n+\n+        # The last directory in the wallet's path\n+        final_dir = \"mywallet\"\n+        wallet_name = f\"path/to/{final_dir}/\"\n+        wallet = self.create_legacy_wallet(wallet_name)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        _, wallet = self.migrate_and_get_rpc(wallet_name)",
      "path": "test/functional/wallet_migration.py",
      "position": 116,
      "original_position": 18,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "146b133697f07c8dda004d60087505b2e1ec14b9",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 146b133697f07c8dda004d60087505b2e1ec14b9 \"test: Migration of a wallet ending in `/`\"\r\n\r\nCould add a check for the expected backup path.",
      "created_at": "2025-07-04T00:15:10Z",
      "updated_at": "2025-07-04T00:15:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183965661",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183965661"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 634,
      "original_line": 634,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183965792",
      "pull_request_review_id": 2984991650,
      "id": 2183965792,
      "node_id": "PRRC_kwDOABII586CLKxg",
      "diff_hunk": "@@ -638,6 +638,24 @@ def test_wallet_with_path_ending_in_slash(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_wallet_with_path_ending_in_relative_specifier(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in a relative specifier, '..'\")\n+        wallet_ending_in_relative = \"path/that/ends/in/..\"\n+        # the wallet data is actually inside of path/that/ends/\n+        wallet = self.create_legacy_wallet(wallet_ending_in_relative)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        _, wallet = self.migrate_and_get_rpc(wallet_ending_in_relative)\n+\n+        assert wallet.gettransaction(txid)",
      "path": "test/functional/wallet_migration.py",
      "position": 136,
      "original_position": 18,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "9fa5480fc4c46fa11345c45fbe4dd21c127e3e05",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 9fa5480fc4c46fa11345c45fbe4dd21c127e3e05 \"test: Migration of a wallet ending in `../`\"\r\n\r\nCould add a check for the expected backup path.",
      "created_at": "2025-07-04T00:15:24Z",
      "updated_at": "2025-07-04T00:15:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183965792",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183965792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 654,
      "original_line": 654,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183974514",
      "pull_request_review_id": 2985003047,
      "id": 2183974514,
      "node_id": "PRRC_kwDOABII586CLM5y",
      "diff_hunk": "@@ -618,6 +618,26 @@ def test_wallet_with_relative_path(self):\n         assert_equal(info[\"descriptors\"], False)\n         assert_equal(info[\"format\"], \"bdb\")\n \n+    def test_wallet_with_path_ending_in_slash(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in '/'\")\n+\n+        # The last directory in the wallet's path\n+        final_dir = \"mywallet\"\n+        wallet_name = f\"path/to/{final_dir}/\"\n+        wallet = self.create_legacy_wallet(wallet_name)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        _, wallet = self.migrate_and_get_rpc(wallet_name)",
      "path": "test/functional/wallet_migration.py",
      "position": 116,
      "original_position": 18,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "146b133697f07c8dda004d60087505b2e1ec14b9",
      "in_reply_to_id": 2183965661,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I add this check to `migrate_and_get_rpc()` in 55e60bd9c76:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/9fa5480fc4c46fa11345c45fbe4dd21c127e3e05/test/functional/wallet_migration.py#L138-L146\r\n\r\n",
      "created_at": "2025-07-04T00:26:45Z",
      "updated_at": "2025-07-04T00:26:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183974514",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183974514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 634,
      "original_line": 634,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183974714",
      "pull_request_review_id": 2985003359,
      "id": 2183974714,
      "node_id": "PRRC_kwDOABII586CLM86",
      "diff_hunk": "@@ -638,6 +638,24 @@ def test_wallet_with_path_ending_in_slash(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_wallet_with_path_ending_in_relative_specifier(self):\n+        self.log.info(\"Test migrating a wallet with a name/path ending in a relative specifier, '..'\")\n+        wallet_ending_in_relative = \"path/that/ends/in/..\"\n+        # the wallet data is actually inside of path/that/ends/\n+        wallet = self.create_legacy_wallet(wallet_ending_in_relative)\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        _, wallet = self.migrate_and_get_rpc(wallet_ending_in_relative)\n+\n+        assert wallet.gettransaction(txid)",
      "path": "test/functional/wallet_migration.py",
      "position": 136,
      "original_position": 18,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "9fa5480fc4c46fa11345c45fbe4dd21c127e3e05",
      "in_reply_to_id": 2183965792,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "See above: https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183974514",
      "created_at": "2025-07-04T00:27:08Z",
      "updated_at": "2025-07-04T00:27:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183974714",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183974714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 654,
      "original_line": 654,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183977261",
      "pull_request_review_id": 2985006480,
      "id": 2183977261,
      "node_id": "PRRC_kwDOABII586CLNkt",
      "diff_hunk": "@@ -997,6 +997,53 @@ def test_failed_migration_cleanup(self):\n             _, _, magic = struct.unpack(\"QII\", data)\n             assert_equal(magic, BTREE_MAGIC)\n \n+    def test_failed_migration_cleanup_relative_path(self):\n+        self.log.info(\"Test that a failed migration with a relative path is cleaned up\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relativefailure\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+\n+        # Make a copy of the wallet with the solvables wallet name so that we are unable\n+        # to create the solvables wallet when migrating, thus failing to migrate\n+        wallet.unloadwallet()\n+        solvables_path = os.path.join(common_parent, f\"{wallet_name}_solvables\")\n+\n+        shutil.copytree(self.old_node.wallets_path / relative_name, solvables_path)\n+        original_shasum = sha256sum_file(os.path.join(solvables_path, \"wallet.dat\"))\n+\n+        self.old_node.loadwallet(relative_name)\n+\n+        # Add a multisig so that a solvables wallet is created\n+        wallet.addmultisigaddress(2, [wallet.getnewaddress(), get_generate_key().pubkey])\n+        wallet.importaddress(get_generate_key().p2pkh_addr)\n+\n+        self.old_node.unloadwallet(relative_name)\n+        assert_raises_rpc_error(-4, \"Failed to create database\", self.master_node.migratewallet, relative_name)\n+\n+        assert all(wallet not in self.master_node.listwallets() for wallet in [f\"{wallet_name}\", f\"{wallet_name}_watchonly\", f\"{wallet_name}_solvables\"])\n+\n+        assert not (self.master_node.wallets_path / \"failed_watchonly\").exists()",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 38,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "e7fec273593d825e0e7dbec46a026aacc58c479f",
      "in_reply_to_id": 2183964782,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks for catching this, I've applied your fix in f67d6fe811 ",
      "created_at": "2025-07-04T00:31:11Z",
      "updated_at": "2025-07-04T00:31:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2183977261",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2183977261"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1034,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2200871871",
      "pull_request_review_id": 3010529273,
      "id": 2200871871,
      "node_id": "PRRC_kwDOABII586DLqO_",
      "diff_hunk": "@@ -585,7 +585,8 @@ def test_direct_file(self):\n         )\n         assert (self.master_node.wallets_path / \"plainfile\").is_file()\n \n-        self.master_node.migratewallet(\"plainfile\")\n+        migrate_res = self.master_node.migratewallet(\"plainfile\")\n+        assert_equal(f\"plainfile_{int(time.time())}.legacy.bak\", os.path.basename(migrate_res[\"backup_path\"]))",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 6,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "5ab42b413f1ed2ac421fc6ceb1eb3560d62ed94e",
      "in_reply_to_id": null,
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Maybe you can use `mocktime` here for consistency?\r\n\r\n```diff --git a/test/functional/wallet_migration.py b/test/functional/wallet_migration.py\r\n--- a/test/functional/wallet_migration.py\r\n+++ b/test/functional/wallet_migration.py\r\n@@ -585,8 +585,10 @@ class WalletMigrationTest(BitcoinTestFramework):\r\n         )\r\n         assert (self.master_node.wallets_path / \"plainfile\").is_file()\r\n \r\n+        mocked_time = int(time.time())\r\n+        self.master_node.setmocktime(mocked_time)\r\n         migrate_res = self.master_node.migratewallet(\"plainfile\")\r\n-        assert_equal(f\"plainfile_{int(time.time())}.legacy.bak\", os.path.basename(migrate_res[\"backup_path\"]))\r\n+        assert_equal(f\"plainfile_{mocked_time}.legacy.bak\", os.path.basename(migrate_res[\"backup_path\"]))\r\n\r\n```",
      "created_at": "2025-07-11T14:24:07Z",
      "updated_at": "2025-07-11T14:24:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2200871871",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2200871871"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 588,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 589,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2211907184",
      "pull_request_review_id": 3027357553,
      "id": 2211907184,
      "node_id": "PRRC_kwDOABII586D1wZw",
      "diff_hunk": "@@ -585,7 +585,8 @@ def test_direct_file(self):\n         )\n         assert (self.master_node.wallets_path / \"plainfile\").is_file()\n \n-        self.master_node.migratewallet(\"plainfile\")\n+        migrate_res = self.master_node.migratewallet(\"plainfile\")\n+        assert_equal(f\"plainfile_{int(time.time())}.legacy.bak\", os.path.basename(migrate_res[\"backup_path\"]))",
      "path": "test/functional/wallet_migration.py",
      "position": null,
      "original_position": 6,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "5ab42b413f1ed2ac421fc6ceb1eb3560d62ed94e",
      "in_reply_to_id": 2200871871,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thank you, fixed!",
      "created_at": "2025-07-17T00:51:15Z",
      "updated_at": "2025-07-17T00:51:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2211907184",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2211907184"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": 588,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 589,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2232112912",
      "pull_request_review_id": 3056922125,
      "id": 2232112912,
      "node_id": "PRRC_kwDOABII586FC1cQ",
      "diff_hunk": "@@ -560,6 +563,60 @@ def test_unloaded_by_path(self):\n \n         assert_equal(bals, wallet.getbalances())\n \n+    def test_wallet_with_relative_path(self):\n+        self.log.info(\"Test migration of a wallet that isn't loaded, specified by a relative path\")\n+\n+        # Get the nearest common path of both nodes' wallet paths.\n+        common_parent = os.path.commonpath([self.master_node.wallets_path, self.old_node.wallets_path])\n+\n+        # This test assumes that the relative path from each wallet directory to the common path is identical.\n+        assert_equal(os.path.relpath(common_parent, start=self.master_node.wallets_path), os.path.relpath(common_parent, start=self.old_node.wallets_path))\n+\n+        wallet_name = \"relative\"\n+        absolute_path = os.path.abspath(os.path.join(common_parent, wallet_name))\n+        relative_name = os.path.relpath(absolute_path, start=self.master_node.wallets_path)\n+\n+        wallet = self.create_legacy_wallet(relative_name)\n+        # listwalletdirs only returns wallets in the wallet directory\n+        assert {\"name\": relative_name} not in wallet.listwalletdir()[\"wallets\"]\n+        assert relative_name in wallet.listwallets()\n+\n+        default = self.master_node.get_wallet_rpc(self.default_wallet_name)\n+        addr = wallet.getnewaddress()\n+        txid = default.sendtoaddress(addr, 1)\n+        self.generate(self.master_node, 1)\n+        bals = wallet.getbalances()\n+\n+        # migratewallet uses current time in naming the backup file, set a mock time\n+        # to check that this works correctly.\n+        curr_time = int(time.time())\n+        self.master_node.setmocktime(curr_time)",
      "path": "test/functional/wallet_migration.py",
      "position": 75,
      "original_position": 43,
      "commit_id": "76fe0e59ec4a5b0c5b18f46bfcbbf99628d74d77",
      "original_commit_id": "63c6d364376907c10b9baa3c6f4d72e3f1881abc",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 63c6d364376907c10b9baa3c6f4d72e3f1881abc \"test: Migration of a wallet with `../` in path.\"\r\n\r\nThis is unnecessary since `migrate_and_get_rpc` also sets and unsets the mocktime.",
      "created_at": "2025-07-25T22:24:59Z",
      "updated_at": "2025-07-25T22:43:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2232112912",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2232112912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 593,
      "original_line": 593,
      "side": "RIGHT"
    }
  ]
}
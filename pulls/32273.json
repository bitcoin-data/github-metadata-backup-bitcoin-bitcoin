{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273",
    "id": 2459386917,
    "node_id": "PR_kwDOABII586Sl0Ql",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32273",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32273.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32273.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
    "number": 32273,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: Fix relative path backup during migration.",
    "user": {
      "login": "davidgumberg",
      "id": 2257631,
      "node_id": "MDQ6VXNlcjIyNTc2MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidgumberg",
      "html_url": "https://github.com/davidgumberg",
      "followers_url": "https://api.github.com/users/davidgumberg/followers",
      "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
      "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
      "repos_url": "https://api.github.com/users/davidgumberg/repos",
      "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Support for wallets outside of the default wallet directory was added in #11687, and these external wallets can be specified with paths relative to the wallet directory, e.g.  `bitcoin-cli loadwallet ../../mywallet`. In the RPC commands, there is no distinction between a wallet's 'name' and a wallet's 'path'. I suspect this may not be the only bug like this, since everywhere that a wallet's name appears in code, that name might be a path, and that path may contain relative specifiers, and the consequences of that are not always obvious, and test coverage for wallets with relative paths seems like it could be improved.\r\n\r\nThis PR fixes an issue with wallet backup during migration where the wallet's 'name' is used in the backup filename. This goes south when that filename is appended (`/=`) to the directory where we want to put the file and the wallet's 'name' actually gets treated as a path:\r\n\r\n```cpp\r\n    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : wallet_name), GetTime()));\r\n    fs::path backup_path = this_wallet_dir / backup_filename;\r\n```\r\n\r\nAttempting to migrate a wallet with the 'name' `../../../mywallet` results in a backup being placed in `datadir/wallets/../../../mywallet/../../../mywallet_1744683963.legacy.bak`.\r\n\r\nThe solution implemented here is to use the wallet directory's name rather than the `wallet_name` when constructing the backup filename:\r\n\r\n```cpp\r\n    std::string legacy_wallet_dir_name = fs::PathToString(legacy_wallet_dir.filename());\r\n    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : legacy_wallet_dir_name), GetTime()));\r\n```\r\n\r\nAn alternative solution would have been to escape the path characters in the wallet's name, but that seemed both more difficult to implement correctly, and like it might cause confusion for users.\r\n\r\nThis does not cause an issue for wallets with absolute pathnames because [`std::filesystem::operator/(path lhs, path rhs)`](https://en.cppreference.com/w/cpp/filesystem/path/operator_slash) returns `rhs` if `rhs.is_absolute()`. (https://en.cppreference.com/w/cpp/filesystem/path/append)\r\n\r\n##### Steps to reproduce on master\r\nBuild and run `bitcoind` with legacy wallet creation enabled:\r\n```bash\r\n$ cmake -B build -DWITH_BDB=ON && cmake --build build -j $(nproc)\r\n$ ./build/bin/bitcoind -regtest -deprecatedrpc=create_bdb\r\n```\r\n\r\nCreate a wallet with some relative path specifiers (exercise caution with where this file may be written)\r\n\r\n```bash\r\n$ ./build/bin/bitcoin-cli -regtest -named createwallet wallet_name=\"../../../myrelativewallet\" descriptors=false\r\n```\r\n\r\nTry to migrate the wallet:\r\n```bash\r\n$ ./build/bin/bitcoin-cli -regtest -named migratewallet\r\n```\r\n\r\nYou will see a message in `debug.log` about trying to backup a file somewhere like: `/home/user/.bitcoin/regtest/wallets/../../../myrelativewallet/../../../myrelativewallet_1744686627.legacy.bak` and migration might fail because `bitcoind` doesn't have permissions to write the backup file.\r\n",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2025-04-15T03:32:24Z",
    "updated_at": "2025-04-15T13:31:37Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "6484963204e37995e4f99920afbe965043a588da",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "davidgumberg:4-14-25-relative-migration",
      "ref": "4-14-25-relative-migration",
      "sha": "1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 529442895,
        "node_id": "R_kgDOH46oTw",
        "name": "bitcoin",
        "full_name": "davidgumberg/bitcoin",
        "owner": {
          "login": "davidgumberg",
          "id": 2257631,
          "node_id": "MDQ6VXNlcjIyNTc2MzE=",
          "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/davidgumberg",
          "html_url": "https://github.com/davidgumberg",
          "followers_url": "https://api.github.com/users/davidgumberg/followers",
          "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
          "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
          "repos_url": "https://api.github.com/users/davidgumberg/repos",
          "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/davidgumberg/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/davidgumberg/bitcoin",
        "archive_url": "https://api.github.com/repos/davidgumberg/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/davidgumberg/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/davidgumberg/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/davidgumberg/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/davidgumberg/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/davidgumberg/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/davidgumberg/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/davidgumberg/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/davidgumberg/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/davidgumberg/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/davidgumberg/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/davidgumberg/bitcoin/events",
        "forks_url": "https://api.github.com/repos/davidgumberg/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/davidgumberg/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/davidgumberg/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/davidgumberg/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/davidgumberg/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/davidgumberg/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/davidgumberg/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/davidgumberg/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/davidgumberg/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/davidgumberg/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/davidgumberg/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:davidgumberg/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/davidgumberg/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/davidgumberg/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/davidgumberg/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/davidgumberg/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/davidgumberg/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/davidgumberg/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/davidgumberg/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/davidgumberg/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/davidgumberg/bitcoin/hooks",
        "svn_url": "https://github.com/davidgumberg/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 239589,
        "default_branch": "master",
        "open_issues_count": 8,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-15T03:30:50Z",
        "created_at": "2022-08-27T00:44:27Z",
        "updated_at": "2025-04-08T22:39:47Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "99a4ddf5ab1b3e514d08b90ad8565827fda7b63b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37042,
        "stargazers_count": 82894,
        "watchers_count": 82894,
        "size": 279803,
        "default_branch": "master",
        "open_issues_count": 701,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-04-15T10:07:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-04-15T12:24:32Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 61,
    "deletions": 3,
    "changed_files": 2,
    "commits": 2,
    "review_comments": 1,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRiMzk3NGVlMTFiNTBjNWNkY2NkMjc3YWE2ZDVjY2U2NjAwMzI3MTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/db3974ee11b50c5cdccd277aa6d5cce660032718",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/db3974ee11b50c5cdccd277aa6d5cce660032718",
      "tree": {
        "sha": "9d905283510fe197672a9ed5773ebaf1b77a80ac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9d905283510fe197672a9ed5773ebaf1b77a80ac"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/99a4ddf5ab1b3e514d08b90ad8565827fda7b63b",
          "sha": "99a4ddf5ab1b3e514d08b90ad8565827fda7b63b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/99a4ddf5ab1b3e514d08b90ad8565827fda7b63b"
        }
      ],
      "message": "wallet: Fix relative path backup during migration.",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-15T03:29:22Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-12T07:03:40Z"
      },
      "sha": "db3974ee11b50c5cdccd277aa6d5cce660032718"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFkYWFlZWRmYWZhMGVlNDgwYTEwNzU2ZmEyYTVjYjI1YTI2OGEzZmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "tree": {
        "sha": "fdec2267f036e3647a7841f5053c5141ccc54bf9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fdec2267f036e3647a7841f5053c5141ccc54bf9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/db3974ee11b50c5cdccd277aa6d5cce660032718",
          "sha": "db3974ee11b50c5cdccd277aa6d5cce660032718",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/db3974ee11b50c5cdccd277aa6d5cce660032718"
        }
      ],
      "message": "test: Migrating wallet with relative path.",
      "committer": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-15T03:29:53Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-04-12T07:05:03Z"
      },
      "sha": "1daaeedfafa0ee480a10756fa2a5cb25a268a3fa"
    },
    {
      "event": "commented",
      "id": 2803681753,
      "node_id": "IC_kwDOABII586nHMnZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2803681753",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T03:32:27Z",
      "updated_at": "2025-04-15T13:31:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32273.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2768274932) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#issuecomment-2803681753",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32273"
    },
    {
      "event": "labeled",
      "id": 17260255075,
      "node_id": "LE_lADOABII586yg5qNzwAAAAQEypdj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17260255075",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T03:32:29Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "reviewed",
      "id": 2768274932,
      "node_id": "PRR_kwDOABII586lAIX0",
      "url": null,
      "actor": null,
      "commit_id": "1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 1daaeedfafa0ee480a10756fa2a5cb25a268a3fa. Nice find and fix!\r\n\r\n> I suspect this may not be the only bug like this, since everywhere that a wallet's name appears in code, that name might be a path\r\n\r\nWallet paths are meant to be passed to the database driver once during opening and not manipulated or interpreted after that. Backup and migration code are an exception because they do interpret the paths after they are opened, so that code needs to be written in a consistent way, but it should be a small amount of code.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#pullrequestreview-2768274932",
      "submitted_at": "2025-04-15T13:31:33Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2044541799",
      "pull_request_review_id": 2768274932,
      "id": 2044541799,
      "node_id": "PRRC_kwDOABII58553Ttn",
      "diff_hunk": "@@ -4500,9 +4500,11 @@ util::Result<MigrationResult> MigrateLegacyToDescriptor(std::shared_ptr<CWallet>\n     }\n \n     // Make a backup of the DB\n-    fs::path this_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n-    fs::path backup_filename = fs::PathFromString(strprintf(\"%s_%d.legacy.bak\", (wallet_name.empty() ? \"default_wallet\" : wallet_name), GetTime()));\n-    fs::path backup_path = this_wallet_dir / backup_filename;\n+    fs::path legacy_wallet_dir = fs::absolute(fs::PathFromString(local_wallet->GetDatabase().Filename())).parent_path();\n+    // Use the wallet directory's name, rather than the wallet name, to avoid issues with wallet's whose names contain relative file paths.",
      "path": "src/wallet/wallet.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "1daaeedfafa0ee480a10756fa2a5cb25a268a3fa",
      "original_commit_id": "db3974ee11b50c5cdccd277aa6d5cce660032718",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit \"wallet: Fix relative path backup during migration.\" (db3974ee11b50c5cdccd277aa6d5cce660032718)\r\n\r\nThis comment doesn't seem right. A relative file path like \"foo\" would not cause issues here. The problems happen with paths that contains slashes, which is why the line below is calling `filename()` to drop everything before the last slash. \r\n\r\nWould suggest a different comment that explains what this is trying to do. Maybe: \"Create a backup copy of wallet data inside the wallet directory with a unique and descriptive filename, based on the name of the wallet and the current timestamp. If this wallet is not the default wallet, the last component of the wallet's directory name is used as the backup filename since the full wallet name may contain slashes.\"",
      "created_at": "2025-04-15T13:27:26Z",
      "updated_at": "2025-04-15T13:31:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32273#discussion_r2044541799",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2044541799"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32273"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4504,
      "original_line": 4504,
      "side": "RIGHT"
    }
  ]
}
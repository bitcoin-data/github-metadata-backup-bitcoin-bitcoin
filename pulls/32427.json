{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427",
    "id": 2501800868,
    "node_id": "PR_kwDOABII586VHnOk",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32427",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32427.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32427.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/fabd3ab615a7c718f37a60298a125864edb6106b",
    "number": 32427,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "(RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store",
    "user": {
      "login": "TheCharlatan",
      "id": 8421793,
      "node_id": "MDQ6VXNlcjg0MjE3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheCharlatan",
      "html_url": "https://github.com/TheCharlatan",
      "followers_url": "https://api.github.com/users/TheCharlatan/followers",
      "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
      "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
      "repos_url": "https://api.github.com/users/TheCharlatan/repos",
      "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Opening this PR mostly to get concept/approach feedback.\r\n\r\nThis is motivated by the kernel library, where the internal usage of leveldb is a limiting factor to its future use cases. Specifically it is not possible to share leveldb databases between two processes. A notable use-case for the kernel library is accessing and analyzing existing block data. Currently this can only be done by first shutting down the node writing this data. Moving away from leveldb opens the door towards doing this in parallel. A flat file based approach was chosen, since the requirements for persistence here are fairly simple (no deletion, constant-size entries). The change also offers better performance by making node startup faster, and has a smaller on-disk footprint, though this is negligible in the grand scheme of things.\r\n\r\nThe change also opens the door towards getting rid of having to reindex the block tree due to corruption (though switching from pruned -> un-pruned still requires extra logic). This would simplify a lot of kernel/validation code, as can be seen in this [commit](https://github.com/TheCharlatan/bitcoin/commit/bfb2709e1d116d4e613601c3f0140f099530159d#diff-28f178018e05634ee3f8ddce3f4e0cec334ae69915cecf92be8299c749d8d470). While the implementation here should be fairly robust against corruption, it could also be extended with a full write-ahead log that could eliminate most corruption vectors (e.g. loss of power) .\r\n\r\nThe BlockTreeStore introduces a new data format for storing block indexes and headers on disk. The class is very similar to the existing CBlockTreeDB, which stores the same data in a leveldb database. Unlike CBlockTreeDB, the data stored through the BlockTreeStore is directly serialized and written to flat .dat files. The storage schema introduced\r\nis simple. It relies on the assumption that no entry is ever deleted and that no duplicate entries are written. These assumptions hold for the current users of CBlockTreeDB. \r\n\r\nAn alternative to this pull request, that could allow the same kernel feature, would be closing and opening the leveldb database only when reading and writing. This might incur a (negligible) performance penalty, but more importantly requires careful consideration of how to handle any contentions when opening, which might have complex side effects due to our current locking mode. It would also be possible to introduce an existing database with the required features for just the block tree, but that would introduce reliance on a new dependency and come with its own tradeoffs. For these reasons I chose this approach.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-05-06T14:27:59Z",
    "updated_at": "2025-05-16T08:54:13Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "18c0c65daf69cd27204613b7ba5d67144cfcadd7",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "TheCharlatan:blocktreestore",
      "ref": "blocktreestore",
      "sha": "fabd3ab615a7c718f37a60298a125864edb6106b",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 94456368,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NDQ1NjM2OA==",
        "name": "bitcoin",
        "full_name": "TheCharlatan/bitcoin",
        "owner": {
          "login": "TheCharlatan",
          "id": 8421793,
          "node_id": "MDQ6VXNlcjg0MjE3OTM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/TheCharlatan",
          "html_url": "https://github.com/TheCharlatan",
          "followers_url": "https://api.github.com/users/TheCharlatan/followers",
          "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
          "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
          "repos_url": "https://api.github.com/users/TheCharlatan/repos",
          "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/TheCharlatan/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/TheCharlatan/bitcoin",
        "archive_url": "https://api.github.com/repos/TheCharlatan/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/TheCharlatan/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/TheCharlatan/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/TheCharlatan/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/TheCharlatan/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/events",
        "forks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/TheCharlatan/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/TheCharlatan/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/TheCharlatan/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/TheCharlatan/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/TheCharlatan/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/TheCharlatan/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/TheCharlatan/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/TheCharlatan/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/TheCharlatan/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:TheCharlatan/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/TheCharlatan/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/TheCharlatan/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/TheCharlatan/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/hooks",
        "svn_url": "https://github.com/TheCharlatan/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 5,
        "watchers_count": 5,
        "size": 262293,
        "default_branch": "master",
        "open_issues_count": 4,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-16T08:42:19Z",
        "created_at": "2017-06-15T16:03:35Z",
        "updated_at": "2025-05-07T18:23:14Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "baa848b8d38187ce6b24a57cfadf1ea180209711",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37225,
        "stargazers_count": 83600,
        "watchers_count": 83600,
        "size": 282037,
        "default_branch": "master",
        "open_issues_count": 725,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-05-16T08:57:50Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-05-16T08:57:56Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 887,
    "deletions": 99,
    "changed_files": 22,
    "commits": 6,
    "review_comments": 1,
    "comments": 22
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZhYzE4NTM0NzFlOTY2N2JiMTI5NmI5ZTQzNWUxMTAwMDEzNjE1Njc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fac1853471e9667bb1296b9e435e110001361567",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fac1853471e9667bb1296b9e435e110001361567",
      "tree": {
        "sha": "6938843c79c4ad9eb3c7e7589cefcd6db45e61b3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6938843c79c4ad9eb3c7e7589cefcd6db45e61b3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6938843c79c4ad9eb3c7e7589cefcd6db45e61b3\nparent 14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c\nauthor TheCharlatan <seb.kung@gmail.com> 1746200542 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746350451 +0200\n\nkernel: Add headerstorage module\n\nThe BlockTreeStore introduces a new data format for storing block\nindexes and headers on disk. The class is very similar to the existing\nCBlockTreeDB, which stores the same data in a leveldb database. Unlike\nCBlockTreeDB, the data stored through the BlockTreeStore is directly\nserialized and written to flat .dat files. The storage schema introduced\nis simple. It relies on the assumption that no entry is ever\ndeleted and that no duplicate entries are written. These assumptions\nhold for the current users of CBlockTreeDB.\n\nIn order to efficiently update a CBlockIndex entry in the store, a new\nfield is added to the class that tracks its position in the file. New\nserialization wrappers are added for both the CBlockIndex and\nCBlockFileInfo classes to avoid serializing integers as VARINT. Using\nVARINT encoding would make updating these fields impossible, since\nchanging them might overwrite existing entries in the file.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXMckACgkQm3m0VpHb\nQXPK0hAAienxzC2NB535r3VFOwX68G6KAnwmG/aSHEbPRcqHbg27lcumx/M0tXAq\nqHD7Z+2wz4rIyofqiLZf4DrQXzGwB04ZAe9laeapeXOiCryma7NWxnyU+/MRT2WG\nWvNocvv/dTdHO8YcGS/0zs2JLedtpG94D5p/HAeeiNwnOJZG2p6s8pq/2SXfi/2A\nGA7tTf9r9rztir5msrqqNpMaNUk5T8hVskQujIJNMq2ud16daA/rGLxm7l/x3XUv\nsmHoMW6fGoBezoP8e1e0XFGVoOHlai++yVHSid5Y3j5EDlDlxlm0tSsnEF/i91fC\nWGbebJFpUORWaZEHyg1ok9vKqOABYaAfedEtZ040u1Qk9ENWS6PyE5Z8QGSPMBLG\nicC60SH8UV4dBLhrktivGSrcDLRmBB4IiTxLfJrKjGjbUGIlq1ngqN/eX6sgrjjo\nQxWEIrrZgjyQsLxHyQmdSg2eWmHzaUiunv2KWhMIuo7KlkXkNZgs9ujYIvP7Lxeo\nMv2sssyZPQ/ySXJrVv4Rf9LFLKFLNrLt0Tngb0h2RytjyxUSYHGa4+hiFIz+ucnY\no3p0zC7EKnHuJ0mLI40EZyCwiK+RG1NsbKyvqiY++JNnu7FSAYC1Jfgjwe0mAhIt\nw8KmVPl20NwICd+3INs9NmXhwjfT7DTX/nNIGSzfye977eltdoY=\n=71oO\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c",
          "sha": "14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c"
        }
      ],
      "message": "kernel: Add headerstorage module\n\nThe BlockTreeStore introduces a new data format for storing block\nindexes and headers on disk. The class is very similar to the existing\nCBlockTreeDB, which stores the same data in a leveldb database. Unlike\nCBlockTreeDB, the data stored through the BlockTreeStore is directly\nserialized and written to flat .dat files. The storage schema introduced\nis simple. It relies on the assumption that no entry is ever\ndeleted and that no duplicate entries are written. These assumptions\nhold for the current users of CBlockTreeDB.\n\nIn order to efficiently update a CBlockIndex entry in the store, a new\nfield is added to the class that tracks its position in the file. New\nserialization wrappers are added for both the CBlockIndex and\nCBlockFileInfo classes to avoid serializing integers as VARINT. Using\nVARINT encoding would make updating these fields impossible, since\nchanging them might overwrite existing entries in the file.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T09:20:51Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-02T15:42:22Z"
      },
      "sha": "fac1853471e9667bb1296b9e435e110001361567"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVkOWMwODdjZWY4MDFiOTlmMDE3YjY5M2I4MWQ0ODliYWQ5YmQxOWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5d9c087cef801b99f017b693b81d489bad9bd19f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5d9c087cef801b99f017b693b81d489bad9bd19f",
      "tree": {
        "sha": "bc406c5b9293e52bffccc182bd1dddbca082e235",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bc406c5b9293e52bffccc182bd1dddbca082e235"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bc406c5b9293e52bffccc182bd1dddbca082e235\nparent fac1853471e9667bb1296b9e435e110001361567\nauthor TheCharlatan <seb.kung@gmail.com> 1746279594 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354084 +0200\n\nfuzz: Use BlockTreeStore in block index fuzz test\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXP60ACgkQm3m0VpHb\nQXMghg//ZU6FzkuAVIk//3MpW9KG4I1ChFPk68+pPEPBnaclVlI8hUO+iWyfJFWi\nAf33MUAe3ltE2s2ci/beDTvgiibbAjcf4p7rKC+H4WikEpPAIDlh7TQEBOmEVe3k\nJoKvV14h/qPz5WRuDhKdxJmq833hTySQzwU/Ea79CQSi2cCBd5LvO9uMKRXawfS4\nCmppyfjysDysi8unBw36jyPUVKyPIubGclczYnaoMglMc9s5IWaFbcBtsiiKNj89\nb5DkoYyn1BLskR0W34ZxSszkxe1I5sO/BR7GxbuiIFtaQaX10C9zAvxK4Giw5I7d\nGJWjTK4dnWQ6EAzR6u4eX0G1JRKNmsjQb5GxJEkWhZApiW9T2NevSTOMY2dhNCuG\n2skt5mGHmb7uT0tpMQPyiyteplwdxMPdgoVXvCTzbW4NzzZ/gpeH8p74l/zcr5Kh\n9x0LQoYBrws0KoqJUF8Q5DGAMi3hm6P2hBDlnjTEhxHJKIuF2xaB45wNPxaqpVNq\ntb/x2p0RIdBygJ8Z6FqdohSu1Na7jiqoSXB2jae2jGjhDuR+q/4gCy0RXXWqXgWi\nDy/iPmTvsww2uvFsDtKRcr7k2MvOjUncWGfBTJY2+DNg0gqEH6mmApxi6QmVDp6I\n2QYvZtBBHK4tBaapOXn8MkG2A1PmNpUNOD4uWQGEBwK0r8R/yIg=\n=uYYt\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fac1853471e9667bb1296b9e435e110001361567",
          "sha": "fac1853471e9667bb1296b9e435e110001361567",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fac1853471e9667bb1296b9e435e110001361567"
        }
      ],
      "message": "fuzz: Use BlockTreeStore in block index fuzz test\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:21:24Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-03T13:39:54Z"
      },
      "sha": "5d9c087cef801b99f017b693b81d489bad9bd19f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDIxZDBkNmQ1OTA2NDlkZGFkOTljMjM4ZGNkODUxZDBlYmE0OTJkNjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/21d0d6d590649ddad99c238dcd851d0eba492d60",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/21d0d6d590649ddad99c238dcd851d0eba492d60",
      "tree": {
        "sha": "82bae328e4006cd08de1f2ef9eb1f103972c4252",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/82bae328e4006cd08de1f2ef9eb1f103972c4252"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 82bae328e4006cd08de1f2ef9eb1f103972c4252\nparent 5d9c087cef801b99f017b693b81d489bad9bd19f\nauthor TheCharlatan <seb.kung@gmail.com> 1746281020 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354095 +0200\n\nblockstorage: Replace BlockTreeDB with BlockTreeStore\n\nThis hooks up the newly introduce BlockTreeStore class to the actual\ncodebase. It also adds a migration function to migrate old leveldb block\nindexes to the new format on startup.\n\nThe migration first reads from leveldb (blocks/index), and writes it to\na BlockTreeStore in a separate migration directory (blocks/migration).\nOnce done, the original directory (blocks/index) is deleted and the\nmigration directory renamed to the original name.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXP68ACgkQm3m0VpHb\nQXO1dxAAoXrbCPAU+bYyE6yj10jl0eJbPlVOYYn+Y4Zhz0UpTnzqHw3UkiHD5/Ub\nOaxyjsysoN3b8rRJ67zO+I1yuvGqo707iL0V3AlqROFQMvci1ceNH5TsmOEBBNJ2\n5SNH3ZcxM/elYR8fCUdnfYeMx/NFgSJ7fvgXCW+nqbkqphWWhhIzZuK7MrtS6RJ1\nhGlNQfR4U1Z5Sv3PV9vRZhV9+wMmGYtdmxENwxVmJQ2uHTUQ9uH83f0oZ2pCQs/P\nHGNvbVXDVYj/uQ2lvtqcqfRim4jOCdJ35n2DK7NKPm8jxZvwAgKbEPyqYcRM8EXJ\nbDgpsIn3c5+8zD4skB13H8uuiOnMpyAXkCEr8oiaQFfbaH7poiT/ldFfRlam7a9X\nUlXqv7O1diVWT2pfIr4nJxTwknA++cnbZsE1wNR3Wb4jcexyQk6tgy1p1BF3+MG/\nmPnTDN7NomscBY6px4uHTE+W8KpwQYJHwk9MCZYZWwJmsRZTyuw/9OUL2VNHb61/\nq/jsdZNF1tUzIce88tAFf23qq3J/IYyIyD04SFq47g+hUX77P8DM5hdNBhkewpIb\nvzzvBrmehst5fKfEDLD6K60C6m6racmLUpYU2Zli1l81zbP1pr7+nL0QKGy9cAAz\nF4L2V+09X6syzDUbnB9XcWjW6mruuz3OY7gk3lcvQZVnOJ542J8=\n=qkTh\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5d9c087cef801b99f017b693b81d489bad9bd19f",
          "sha": "5d9c087cef801b99f017b693b81d489bad9bd19f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5d9c087cef801b99f017b693b81d489bad9bd19f"
        }
      ],
      "message": "blockstorage: Replace BlockTreeDB with BlockTreeStore\n\nThis hooks up the newly introduce BlockTreeStore class to the actual\ncodebase. It also adds a migration function to migrate old leveldb block\nindexes to the new format on startup.\n\nThe migration first reads from leveldb (blocks/index), and writes it to\na BlockTreeStore in a separate migration directory (blocks/migration).\nOnce done, the original directory (blocks/index) is deleted and the\nmigration directory renamed to the original name.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:21:35Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-03T14:03:40Z"
      },
      "sha": "21d0d6d590649ddad99c238dcd851d0eba492d60"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ3OGFhODMzYjg4N2E5MzdiMDY2MGVmZGNlMWFjNTI5Y2I3MjRhZGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d78aa833b887a937b0660efdce1ac529cb724adf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d78aa833b887a937b0660efdce1ac529cb724adf",
      "tree": {
        "sha": "a10e11d6842e8a2f61b074ca8097ec95af147638",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a10e11d6842e8a2f61b074ca8097ec95af147638"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a10e11d6842e8a2f61b074ca8097ec95af147638\nparent 21d0d6d590649ddad99c238dcd851d0eba492d60\nauthor TheCharlatan <seb.kung@gmail.com> 1746177840 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354098 +0200\n\nkernel: Remove block tree db params\n\nThese are no longer needed after the migration to the new\nBlockTreeStore.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXP7IACgkQm3m0VpHb\nQXOtcA/8DIkrrz+HpoGNnRvj2UkFAYo7BllEKpeHP24XR1g9U2IcU7TQjxivBoTr\n6jgZI0MW7pb0DnAS9e/wD2RugmHPlFBnq7Ix+BftSTxrTWcb4fqzxmU7MbmUnPmV\n3NpaE7GiIVjfScrBDXrFAWjvyAR3eIt7CstO43PB/o3p7xpd8EOK3lFnOCz6HN0J\nL9Z7zbyrrWv/tx1FCIzixcyipJmyyFxR8vo+UFHbE+p7bGfCm3pUTv+oJY/sh70G\nC9KjbMpncsHWE6qSYyx8FgBdofgLFyB2LZKcJuwPn4WjvfC116qK3aPGLZGWpDIw\nDRkqz1uFkvs6imG/P/t4dTcKjVvpv3w91cQ6+x4iSBQGrDbHr1679uB1l5lyh3uj\nnDdsoeMYf6bR/hQWjRNCCgwNZAMS8L9ToSdYo6wm93tRjzb6UcFnxP6bxwGN9EyY\nPYst5+MMvBPlW+/pui40nozSl/dyYPsUVgvFsOGU3UxuHfHCQ3a0oBpM9B/eZH/P\nrqqtKC4xUztGI1gOnJaSDXjXKyGy6eK0p/h1muqnjN3GEam0J81fxQ1i/Cw3EREd\nA82fasufRlNY7Y0q85GYUs5OMiUEBft79yNglr5xTQPddnmbHcl/C+etIMfjQQ4z\nK0+IzXPey8bj4oOc0WC7DgSD04HHh5hcUG1pgLj+Oxld4MPAdsw=\n=JIjV\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/21d0d6d590649ddad99c238dcd851d0eba492d60",
          "sha": "21d0d6d590649ddad99c238dcd851d0eba492d60",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/21d0d6d590649ddad99c238dcd851d0eba492d60"
        }
      ],
      "message": "kernel: Remove block tree db params\n\nThese are no longer needed after the migration to the new\nBlockTreeStore.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:21:38Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-02T09:24:00Z"
      },
      "sha": "d78aa833b887a937b0660efdce1ac529cb724adf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQyMDFkY2Y2MjUzYThiZDRjZDkzNWMyM2Q1MWE3OTNjYTVlMTA0Njg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4201dcf6253a8bd4cd935c23d51a793ca5e10468",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4201dcf6253a8bd4cd935c23d51a793ca5e10468",
      "tree": {
        "sha": "8aba2128bf0fec77e99eed261a2f49e30fe59526",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8aba2128bf0fec77e99eed261a2f49e30fe59526"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8aba2128bf0fec77e99eed261a2f49e30fe59526\nparent d78aa833b887a937b0660efdce1ac529cb724adf\nauthor TheCharlatan <seb.kung@gmail.com> 1746281806 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354099 +0200\n\nkernel: Add assumed header store to chainparams\n\nAdds constants for pre-allocating the file size of the header storage\nfile in the BlockTreeStore. The chosen constants leave a bit of extra\nspace beyond the actual requirement. They may be updated on every\nrelease, though it is also not a strict requirement to do so.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXP7MACgkQm3m0VpHb\nQXMQdA//Yq/bApkeBHxI0CCdQQMMbXKG93yovxUdtAZ1V+OiC4W/o5oSbNYU7IIf\nMG87z/7YWkiih3MaJmOWwX7xa7FFUPog92c/RXFvGRoJpfQNe7DgNVrenIgdUdsF\n+s+PtSEfafaTohd/UVnf332d0MnJK842SEHWtkOUXMcsSjqn4d1xQqPjTKzrtxvC\nVKSwHE5q4SHwcpLzyZLUbEDyYylxgXqh+ubsx/kE+Xuy78fMXJe+1B0/llGK4xi3\nWtTJ1whkuNfTh3dASfd3G43LGz6CH1ZXNv/MsX9FXKkRx15Kps6d1CjVLi5Kr3us\nHC6soUBSV+rxPEZ0JdrVX7NvUGVe8T1uq4z10bvSfZ0cVGGsvwpWSggPQ449dnFo\nxCyXjH0UwRtJ1r9QBKa26cDoX3Q+yZyb8f/+SVbR7epNDul9sM+GCViaTopEgbE5\nBpGEKtNwEp/UUdIgr88HnxV/3aXIDoObm37VCYz6shx7ePQxjU7J+SK6dMUXiPpS\nJ6UHctTld1jH0ezMlpcRgfA4QQS8hWnBStftG07JHNxDYp3MqQMbiuqVIGKYu5v7\nA3ChRqWBznBAQiAFDYttcmLjdUpZ4gqtNxIiv4UFdP+xe90nxITlALKWpcCzN4Va\nvYF5zMCdN2wC4Kwt1FJuRd59vqlta3gh/b5tIfFeWPoOdgZXhRg=\n=j2I8\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d78aa833b887a937b0660efdce1ac529cb724adf",
          "sha": "d78aa833b887a937b0660efdce1ac529cb724adf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d78aa833b887a937b0660efdce1ac529cb724adf"
        }
      ],
      "message": "kernel: Add assumed header store to chainparams\n\nAdds constants for pre-allocating the file size of the header storage\nfile in the BlockTreeStore. The chosen constants leave a bit of extra\nspace beyond the actual requirement. They may be updated on every\nrelease, though it is also not a strict requirement to do so.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:21:39Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-03T14:16:46Z"
      },
      "sha": "4201dcf6253a8bd4cd935c23d51a793ca5e10468"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZhYmQzYWI2MTVhN2M3MThmMzdhNjAyOThhMTI1ODY0ZWRiNjEwNmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fabd3ab615a7c718f37a60298a125864edb6106b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fabd3ab615a7c718f37a60298a125864edb6106b",
      "tree": {
        "sha": "2910192943b64e6bc2cab5c0f682b31d482b370b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2910192943b64e6bc2cab5c0f682b31d482b370b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2910192943b64e6bc2cab5c0f682b31d482b370b\nparent 4201dcf6253a8bd4cd935c23d51a793ca5e10468\nauthor TheCharlatan <seb.kung@gmail.com> 1746349898 +0200\ncommitter TheCharlatan <seb.kung@gmail.com> 1746354101 +0200\n\nblockstorage: Remove BlockTreeDB dead code\n\nThis is not called by anything anymore, so just remove it.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIyBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmgXP7UACgkQm3m0VpHb\nQXM6uA/4o00FpuDIPeOw+QNrdjoeys5dOn5sHGFKxKPVe2B9fncGaHNfRZRNwMFe\n2lBBGu5jNy8kvsIjkbNohsqvrf2WZt6KA0j3pDBnVZZwZGGqFChh6nWw6XkTyuaq\n7/rZeVJuui/Lq6N69tWbbob2aSKdUToyTWvont6irEClSxc1jJJoW2i+lNsAFpmC\n4EdqiigHVhShLHL5cZ8Bd8p04/iBmeAyOjHBNwKf+d6+5R6yOoqEhsbl8G1ILwR+\ntFni6+PzrDspiZl4GKbJQIDbmRy7rmtOz4VjOGUbNRpyLUXaM2dGwJXDJSbdF0xU\n1Qo2DfstxpkEp6DhT3LIRBuLffFYVk0uasWcbCkUnMA0QE6LtIwEm4c9babn8Tqd\n6LwRuww8YTujWjxCXH/IRTRaMXIc8798UZRqDF+YGSXINNTf6gO9D9OO/Ux9fDoh\nAayxR39NabWohyc3i0zlHVKB0xevWjKzyTR5FtG0HCBr3gqbF2R1HWid3kO2333B\nyyEH6RSt54fPXTgh81Mo2ngvofS2R/srdbMl0QwfvpMn/8Yw+fyJq+LeyyE7nRzx\nNSwhoCDYKZ8NU4a6vT+zq7XQpq+4S1maUCQgy2BmigagED7wsnPMdgSbvCMclW5U\nmOWVUiyY+YDaUnUgrXuuxmPyzWh+a3X2+jHO7xS8LnazcH7JYg==\n=QA3x\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4201dcf6253a8bd4cd935c23d51a793ca5e10468",
          "sha": "4201dcf6253a8bd4cd935c23d51a793ca5e10468",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4201dcf6253a8bd4cd935c23d51a793ca5e10468"
        }
      ],
      "message": "blockstorage: Remove BlockTreeDB dead code\n\nThis is not called by anything anymore, so just remove it.\n\nThis commit is part of a series to replace the leveldb database\ncurrently used for storing block indexes and headers with a flat file\nstorage. This is motivated by the kernel library, where the usage of\nleveldb is a limiting factor to its future use cases. It also offers better\nperformance and has a smaller on-disk footprint, though this is mostly\nnegligible in the grand scheme of things.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T10:21:41Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-05-04T09:11:38Z"
      },
      "sha": "fabd3ab615a7c718f37a60298a125864edb6106b"
    },
    {
      "event": "commented",
      "id": 2854787092,
      "node_id": "IC_kwDOABII586qKJgU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2854787092",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-06T14:28:01Z",
      "updated_at": "2025-05-16T08:54:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\r\n\r\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\r\n\r\n<!--006a51241073e994b41acfe9ec718e94-->\r\n### Code Coverage & Benchmarks\r\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32427.\r\n<!--021abf342d371248e50ceaed478a90ca-->\r\n### Reviews\r\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\r\n| Type | Reviewers |\r\n| ---- | --------- |\r\n| Concept ACK | [josibake](https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2857741552), [theuni](https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2884164753) |\r\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2855495136) |\r\n\r\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\r\n<!--174a7506f384e20aa4161008e828411d-->\r\n### Conflicts\r\nReviewers, this pull request conflicts with the following ones:\r\n\r\n* [#31974](https://github.com/bitcoin/bitcoin/pull/31974) (Drop testnet3 by Sjors)\r\n* [#31533](https://github.com/bitcoin/bitcoin/pull/31533) (fuzz: Add fuzz target for block index tree and related validation events by mzumsande)\r\n* [#31382](https://github.com/bitcoin/bitcoin/pull/31382) (kernel: Flush in ChainstateManager destructor by TheCharlatan)\r\n* [#30595](https://github.com/bitcoin/bitcoin/pull/30595) (kernel: Introduce initial C header API by TheCharlatan)\r\n* [#19463](https://github.com/bitcoin/bitcoin/pull/19463) (Prune locks by luke-jr)\r\n\r\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\r\n\r\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2854787092",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2855495136,
      "node_id": "IC_kwDOABII586qM2Xg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2855495136",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-06T18:12:32Z",
      "updated_at": "2025-05-06T18:12:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK\r\n\r\nThe codebase changes seem surprisingly small for this proposal.\r\nChanging the code to reduce the dependency on LevelDB sounds good to me.",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2855495136",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2856855525,
      "node_id": "IC_kwDOABII586qSCfl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2856855525",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:43:25Z",
      "updated_at": "2025-05-07T02:43:25Z",
      "author_association": "NONE",
      "body": "Thanks @TheCharlatan for this proposal and making the code changes.!\r\n\r\nPlease find my review comments, suggestions and some clarifying questions:\r\n\r\n1) How will concurrent reads (and potentially writes) be handled with the flat file format?\r\n\r\n2) Even if no deletion occurs, file corruption or partial writes can happen. Are you planning mmap or memory buffering?\r\n\r\n3) What would be the \"Corruption Recovery Strategy?\" -- While the write-ahead log is mentioned as future work, providing even a minimal rollback/recovery mechanism in the initial version would make this stronger.\r\n\r\n4) What would be the \"**Migration Path**\"? -- Will there be tooling or a migration process from existing leveldb-based data\r\n\r\n5) Data Integrity Guarantees? -- Are checksums or hash-based verifications being added per entry or per file?",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2856855525",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "mentioned",
      "id": 17547927887,
      "node_id": "MEE_lADOABII5861YR-zzwAAAAQV8CFP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17547927887",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:43:26Z"
    },
    {
      "event": "subscribed",
      "id": 17547927892,
      "node_id": "SE_lADOABII5861YR-zzwAAAAQV8CFU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17547927892",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:43:26Z"
    },
    {
      "event": "commented",
      "id": 2856856921,
      "node_id": "IC_kwDOABII586qSC1Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2856856921",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:44:37Z",
      "updated_at": "2025-05-07T02:46:59Z",
      "author_association": "NONE",
      "body": "6. Consider including a pluggable interface that allows fallback to LevelDB for testing or backwards compatibility",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2856856921",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2856869458,
      "node_id": "IC_kwDOABII586qSF5S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2856869458",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:55:20Z",
      "updated_at": "2025-05-07T02:55:30Z",
      "author_association": "NONE",
      "body": "7. **Write contention and corruption risks:** -- While flat files avoid LevelDBâ€™s process-level locking, concurrent writes require a mechanism (e.g., file locks, flock()) to prevent race conditions.\r\n8. **Portability and Cross platform related edge cases:** -- Ensure file-locking mechanisms (e.g., fcntl on Unix, LockFileEx on Windows) are robust.",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2856869458",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2856870786,
      "node_id": "IC_kwDOABII586qSGOC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2856870786",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T02:56:34Z",
      "updated_at": "2025-05-07T02:56:34Z",
      "author_association": "NONE",
      "body": "9. How about Handling Large Files? -- Test edge cases like file sizes approaching OS limits (e.g., 2+ GB on 32-bit systems). What would happen in such cases?",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2856870786",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2856877928,
      "node_id": "IC_kwDOABII586qSH9o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2856877928",
      "actor": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T03:02:36Z",
      "updated_at": "2025-05-07T03:02:56Z",
      "author_association": "NONE",
      "body": "10. On similar lines to point-5 -- **Corruption Detection** mechanism could also be implemented to detect corruptions very early in the cycle.",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2856877928",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "reviewed",
      "id": 2820208053,
      "node_id": "PRR_kwDOABII586oGPW1",
      "url": null,
      "actor": null,
      "commit_id": "fabd3ab615a7c718f37a60298a125864edb6106b",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "The flat-file approach is a reasonable trade-off given the simplicity of the block tree storage requirements. \r\n\r\nHowever, there are major significant challenges and risks involved with this approach as highlighted in the above 10 comments. (Concurrency, Corruption/Integrity, Performance, Migration, Corruption detection, Portability, Backward compatibility etc.)",
      "user": {
        "login": "shahsb",
        "id": 20738488,
        "node_id": "MDQ6VXNlcjIwNzM4NDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/20738488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahsb",
        "html_url": "https://github.com/shahsb",
        "followers_url": "https://api.github.com/users/shahsb/followers",
        "following_url": "https://api.github.com/users/shahsb/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/shahsb/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/shahsb/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/shahsb/subscriptions",
        "organizations_url": "https://api.github.com/users/shahsb/orgs",
        "repos_url": "https://api.github.com/users/shahsb/repos",
        "events_url": "https://api.github.com/users/shahsb/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/shahsb/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#pullrequestreview-2820208053",
      "submitted_at": "2025-05-07T03:14:08Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427"
    },
    {
      "event": "labeled",
      "id": 17549552230,
      "node_id": "LE_lADOABII5861YR-zzwAAAAQWCOpm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17549552230",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T06:05:46Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 2857741552,
      "node_id": "IC_kwDOABII586qVazw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2857741552",
      "actor": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T08:57:46Z",
      "updated_at": "2025-05-07T08:57:46Z",
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\n> A notable use-case for the kernel library is accessing and analyzing existing block data\r\n\r\nA concrete example is index building in electrs / esplora / etc. For example, Electrs does this today by:\r\n\r\n1. Waiting for Bitcoin Core to finish IBD\r\n2. Reading all of the blocks out over JSON-RPC\r\n3. Parsing them and writing them into the appropriate indexes\r\n\r\nI started on a PoC for Electrs to use libbitcoinkernel for index building to demonstrate how this could be done much more efficiently and saw promising results. However, the requirement that Bitcoin Core be shut down before Electrs could process the block files made this approach clunky. I'll revive this PoC as a means of testing this PR and hopefully provide some use case motivated feedback on the approach.",
      "user": {
        "login": "josibake",
        "id": 7444140,
        "node_id": "MDQ6VXNlcjc0NDQxNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7444140?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/josibake",
        "html_url": "https://github.com/josibake",
        "followers_url": "https://api.github.com/users/josibake/followers",
        "following_url": "https://api.github.com/users/josibake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/josibake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/josibake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/josibake/subscriptions",
        "organizations_url": "https://api.github.com/users/josibake/orgs",
        "repos_url": "https://api.github.com/users/josibake/repos",
        "events_url": "https://api.github.com/users/josibake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/josibake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2857741552",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2858496851,
      "node_id": "IC_kwDOABII586qYTNT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2858496851",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T12:58:00Z",
      "updated_at": "2025-05-07T12:58:18Z",
      "author_association": "MEMBER",
      "body": "Have you considered simply having one block per file? Typical blk files are 130 MB, so for \"modern\" blocks it would 50x the number of files. But is that actually a problem? It's a lot simpler if we can just have `$HASH.dat`, maybe grouped in a directory per 10k blocks.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858496851",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2858550825,
      "node_id": "IC_kwDOABII586qYgYp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2858550825",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T13:13:46Z",
      "updated_at": "2025-05-07T13:13:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Have you considered simply having one block per file? Typical blk files are 130 MB, so for \"modern\" blocks it would 50x the number of files. But is that actually a problem? It's a lot simpler if we can just have $HASH.dat, maybe grouped in a directory per 10k blocks.\r\n\r\nI'm not sure what you are suggesting here. Are you suggesting we create ~900k files and then have some subdivision within those files into 10k groups where each of those has a single `$HASH.dat` with all the headers and file pointers for the blocks in that division? Is there something we gain through that? My impression is we do the file splitting in the first place to make pruning easier. We don't prune headers, so I don't think splitting the file gains us anything. I don't think there is much wrong with just having a single file. Maybe it even helps the OS a bit to manage the file buffers?",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858550825",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2858637715,
      "node_id": "IC_kwDOABII586qY1mT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2858637715",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T13:33:53Z",
      "updated_at": "2025-05-07T13:36:59Z",
      "author_association": "MEMBER",
      "body": "> Are you suggesting we create ~900k files\r\n\r\nYes. If we're going to redesign block storage, it seems good to wonder why can't let the file system handle things.\r\n\r\n> with all the headers and file pointers for the blocks in that division\r\n\r\nOne block per file. We can still have a single file for the block index, which would contain the header (not just the hash) and validation state. Block files themselves would be in a predictable location, so we wouldn't need an index for that.\r\n\r\n> My impression is we do the file splitting in the first place to make pruning easier. \r\n\r\nDo you mean compared to the alternative of having a single file for _all_ blocks? I would imagine that would create I/O problems, since the operating system wouldn't know which part of the big file changed. And it can't defragment it.\r\n\r\nHaving one file per block makes pruning marginally easier than now, since you don't have to worry about keeping nearby blocks in the same file.\r\n\r\nOne downside of what I'm suggesting is that the headers would either be stored redundantly (in the block file as well as in the index), or anyone parsing the block files has to prepend the header themselves.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858637715",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2858716091,
      "node_id": "IC_kwDOABII586qZIu7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2858716091",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T13:59:31Z",
      "updated_at": "2025-05-07T13:59:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "How worried are we about file corruption here? I thought the main reason we use leveldb and sqlite databases in places like this where we don't need indexing is that they support atomic updates, so you can pull the power cord any time and next time you reboot you will will see some consistent view of the data, even if it's not the latest data. I didn't look too closely at the implementation here but it seems like it is updating data in the files in place, so if writes are interrupted, data could be corrupt, and it's not clear if there are even checksums in place that would detect this.\r\n\r\nMaybe this is not an issue for the PR, but it would be good to make clear what types of corruption BlockTreeStore can and can't detect and what types of corruption it can recover from. If it can do simple things to detect corruption like adding checksums, or to prevent it like writing to temporary files and renaming them in place, those could be good to consider.\r\n\r\nIf this PR does introduce some increased risk of corruption, maybe that is worth it for reasons listed in the description. I also think another alternative could be to use sqlite for this since this would not necessarily introduce a new dependency and we already have a [ReadKey/WriteKey/EraseKey/HasKey](https://github.com/bitcoin/bitcoin/blob/6d5edfcc585bab3374ae14aa7918b3e178e016aa/src/wallet/sqlite.h#L76-L80) wrapper functions for sqlite that might help it be an easy replacement for leveldb.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858716091",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2859864794,
      "node_id": "IC_kwDOABII586qdhLa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2859864794",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T18:44:22Z",
      "updated_at": "2025-05-07T18:44:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858637715\r\n\r\n> Do you mean compared to the alternative of having a single file for all blocks? I would imagine that would create I/O problems, since the operating system wouldn't know which part of the big file changed. And it can't defragment it.\r\n\r\nYes, that is what I meant. We never change block files, so that is not a problem. I'm also not sure how real this problem actually is. A bunch of databases just maintain one big file and have good performance doing so. I'm still not sure what the benefit of what you propose would be. Either way, I think this is a bit out of scope, since while this change implements a database migration, it does not require a reindex, which a change to the block file format would. Improving pruning behavior is also not the goal here.\r\n\r\n\r\n",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2859864794",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2859921949,
      "node_id": "IC_kwDOABII586qdvId",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2859921949",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-07T19:05:17Z",
      "updated_at": "2025-05-07T19:05:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2858716091\r\n\r\n> How worried are we about file corruption here? \r\n\r\nI was hoping to provoke a discussion about this as I alluded to in the PR description - thanks for providing your thoughts on this. I think the proof of work and integrity checks done on loading the index already provide fairly solid guarantees on load, but agree that we should do better. I have also talked to some other people about it offline, and there seems to be some appetite for improving corruption resistance. It is my understanding that the feature for reindexing the block tree was added as a salvaging option, because leveldb does not provide strong anti-corruption guarantees, but has sprawled a bit since. Removing the need to provide code for reindexing the block tree would be a nice simplification of validation code in my eyes. I think adding a checksum for the entries and writing from a log file could be fairly simple to implement and provide strong guarantees. I'm open to suggestions here.\r\n\r\n> I also think another alternative could be to use sqlite for this since this would not necessarily introduce a new dependency and we already have a [ReadKey/WriteKey/EraseKey/HasKey](https://github.com/bitcoin/bitcoin/blob/6d5edfcc585bab3374ae14aa7918b3e178e016aa/src/wallet/sqlite.h#L76-L80) wrapper functions for sqlite that might help it be an easy replacement for leveldb.\r\n\r\nThis has also been brought up by some others. While I'm still not sure that we should be introducing a new validation dependency, maybe it would be good to implement it and open the change as an alternative draft / RFC pull request in the meantime?",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2859921949",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "reviewed",
      "id": 2823207472,
      "node_id": "PRR_kwDOABII586oRrow",
      "url": null,
      "actor": null,
      "commit_id": "fabd3ab615a7c718f37a60298a125864edb6106b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "A full `-reindex` can be necessary for two reasons:\r\n1. corruption in the block tree db\r\n2. corruption in the blk files.\r\n\r\nIn my personal experience of running a node on crappy hardware a long time ago, it was usually 2. that would happen (I knew that because the reindex wouldn't scan all block files but abort with an error somewhere, and switch to IBD from peers). My suspicion is that while 1. may have been the dominant reason in the early years, 2. may be just as important today.\r\n\r\nHowever, if that was the case, changing the block tree db format wouldn't allow us to get rid of `-reindex`, even if the new format would never corrupt.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#pullrequestreview-2823207472",
      "submitted_at": "2025-05-07T21:06:05Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32427"
    },
    {
      "event": "commented",
      "id": 2861994398,
      "node_id": "IC_kwDOABII586qlpGe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2861994398",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-08T07:01:05Z",
      "updated_at": "2025-05-08T07:07:27Z",
      "author_association": "MEMBER",
      "body": "> We never change block files, so that is not a problem. I'm also not sure how real this problem actually is. \r\n\r\nBut we prune blocks, and they may not all be at the start of the big file.\r\n\r\n> A bunch of databases just maintain one big file and have good performance doing so.\r\n\r\nEven on a spinning disk? That's where I tend to keep my `.dat` files.\r\n\r\n> I'm still not sure what the benefit of what you propose would be.\r\n\r\nCompared to the current situation where we bundle a bunch of, but not _all_, blocks in one file, it just seems simpler to have one file per block.\r\n\r\nIn the \"corruption in the blk files\" example above it also makes recovery really easy: just load the block files one by one, hash them, redownload if the hash doesn't match. No need to update any index.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2861994398",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2863677632,
      "node_id": "IC_kwDOABII586qsEDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2863677632",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-08T16:44:17Z",
      "updated_at": "2025-05-08T16:44:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "re: TheCharlatan https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2859921949\r\n\r\nThanks for clarifying the situation with leveldb. I just assumed based on its design that it would support atomic updates pretty robustly but if it has corruption problems of its own then it doesn't sound like we would lose much by switching to something simpler.\r\n\r\nI still do think using sqlite could be a nice solution because data consistency issues can be a significant source of pain for users and developers, and with sqlite we basically just don't need to think those issues. But I also understand not wanting to require sqlite as a kernel dependency. \r\n\r\nAnother thing about this PR (as of fabd3ab615a7c718f37a60298a125864edb6106b) is it seems like it doesn't actually remove much blockstorage code, and the BlockTreeDB class remains intact, I guess because migration code depends on it.\r\n\r\nAn idea that might improve this could be to make BlockTreeStore methods pure virtual and have FlatFile and LevelDB subclasses implementing them. This could organize the code more cleanly by letting FlatFile and LevelDB implementations both live side-by side outside of blockstorage instead of one being inside and one being outside. This could also let kernel applications provide alternate backends, and allow things like differential fuzz testing. (This was also the exact same approach used to replace bdb with sqlite in the wallet.)\r\n\r\nre: Sjors https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2861994398\r\n\r\nFWIW I also think using individual block files could be great (assuming a sharded directory structure like the .git/objects to avoid having many files per directory). That idea is mostly tangential to this PR though, I think? Possible I am missing some connections.\r\n\r\n\r\n\r\n\r\n\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2863677632",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2868847845,
      "node_id": "IC_kwDOABII586q_yTl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2868847845",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-10T13:24:48Z",
      "updated_at": "2025-05-10T13:24:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/32427#pullrequestreview-2823207472\r\n\r\n> In my personal experience of running a node on crappy hardware a long time ago, it was usually 2. that would happen (I knew that because the reindex wouldn't scan all block files but abort with an error somewhere, and switch to IBD from peers). \r\n\r\nThat is interesting, I don't think I've ever run into blk file corruption. I agree with you that if that is something we need to be able to salvage from, that the reindex logic would have to remain for it. If that is the case though, shouldn't we also be cleaning left over block data then? Seems like the user could just end up with 100's of GBs of unusable block data otherwise.",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2868847845",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2881521463,
      "node_id": "IC_kwDOABII586rwIc3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2881521463",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-14T20:44:53Z",
      "updated_at": "2025-05-14T20:44:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "I didn't have time to review this in detail - nor to form a detailed concept/approach feedback, but I ran a few reindexes to see if it affects performance because somebody was referring to this as an optimization and wanted to understand if that's indeed the case.\r\n\r\nI ran a `reindex` until 888,888 comparing the speed against master.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```bash\r\nCOMMITS=\"14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c fabd3ab615a7c718f37a60298a125864edb6106b\"; \\\r\nSTOP_HEIGHT=888888; DBCACHE=4500; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 1 \\\r\n  --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g; s/-$//' <<< \"$COMMITS\")-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=5000 -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=$DBCACHE\"\r\n```\r\n\r\n> 14b8dfb2bd Merge bitcoin/bitcoin#31398: wallet: refactor: various master key encryption cleanups\r\n> fabd3ab615 blockstorage: Remove BlockTreeDB dead code\r\n\r\n```python\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=4500 (COMMIT = 14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c)\r\n  Time (abs â‰¡):        27076.605 s               [User: 32171.870 s, System: 1311.182 s]\r\n\r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=4500 (COMMIT = fabd3ab615a7c718f37a60298a125864edb6106b)\r\n  Time (abs â‰¡):        27034.197 s               [User: 32220.994 s, System: 1286.553 s]\r\n\r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=4500 (COMMIT = 14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888888 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=4500 (COMMIT = fabd3ab615a7c718f37a60298a125864edb6106b)\r\n```\r\n\r\n</details>\r\n\r\nWhich indicates there's no measurable speed difference.\r\nBut here the chainstate reindexing dominates, so I did one until block 1 as well.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```bash\r\nCOMMITS=\"14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c fabd3ab615a7c718f37a60298a125864edb6106b\"; \\\r\nSTOP_HEIGHT=1; DBCACHE=450; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch origin $c -q && git log -1 --pretty=format:'%h %s' $c || exit 1; done; echo \"\") && \\\r\nhyperfine \\\r\n  --sort 'command' \\\r\n  --runs 1 \\\r\n  --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g; s/-$//' <<< \"$COMMITS\")-$STOP_HEIGHT-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind; rm -f $DATA_DIR/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; \\\r\n    cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF && cmake --build build -j$(nproc) --target bitcoind && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -dbcache=5000 -printtoconsole=0; sleep 10\" \\\r\n  --cleanup \"cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP_HEIGHT -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=$DBCACHE\"\r\n```\r\n    \r\n> 14b8dfb2bd Merge bitcoin/bitcoin#31398: wallet: refactor: various master key encryption cleanups\r\n> fabd3ab615 blockstorage: Remove BlockTreeDB dead code\r\n\r\n```python\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=1 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=450 (COMMIT = 14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c)\r\n  Time (abs â‰¡):        7718.677 s               [User: 7368.404 s, System: 174.230 s]\r\n\r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=1 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=450 (COMMIT = fabd3ab615a7c718f37a60298a125864edb6106b)\r\n  Time (abs â‰¡):        7683.972 s               [User: 7344.276 s, System: 165.120 s]\r\n\r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=1 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=450 (COMMIT = 14b8dfb2bd5e2ca2b7c0c9a7f7d50e1e60adf75c)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=1 -reindex -blocksonly -connect=0 -printtoconsole=0 -dbcache=450 (COMMIT = fabd3ab615a7c718f37a60298a125864edb6106b)\r\n```\r\n\r\n</details>\r\n\r\nWhich also indicates there's no measurable speed difference.\r\nSo at least I can confirm that - if my measurements were accurate - there doesn't seem to be a speed regression caused by this change.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2881521463",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2884164753,
      "node_id": "IC_kwDOABII586r6NyR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2884164753",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:03:48Z",
      "updated_at": "2025-05-15T15:03:48Z",
      "author_association": "MEMBER",
      "body": "Concept ACK. Neat :)\r\n\r\n> Maybe this is not an issue for the PR, but it would be good to make clear what types of corruption BlockTreeStore can and can't detect and what types of corruption it can recover from. If it can do simple things to detect corruption like adding checksums, or to prevent it like writing to temporary files and renaming them in place, those could be good to consider.\r\n\r\nYeah, I think this is the heart of it. I'm onboard for a new impl outside of leveldb, but before getting too deep into the implementation itself we need to decide 2 main things:\r\n\r\n1. Is the current block/index storage layout ideal? I think @Sjors's one-block-per-file idea is interesting. Undo data could go in the same file without breaking any append-only guarantees. Not requiring file offset record keeping sounds nice. But what would the consequences be? Do any filesystems hate that type of dir layout? Would performance suffer due to a bajillion opens/closes?\r\n2. After figuring out 1, like @ryanofsky asked, what guarantees do we need to provide? Are we just protecting against power outages? Cosmic bit-flip corruption? Bad sectors? Malicious users?\r\n\r\nThe impl here with no slicing or atomicity attempts isn't very robust, but that's obviously fine for an RFC. ",
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2884164753",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "mentioned",
      "id": 17674300527,
      "node_id": "MEE_lADOABII5861YR-zzwAAAAQdeGxv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17674300527",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:03:49Z"
    },
    {
      "event": "subscribed",
      "id": 17674300559,
      "node_id": "SE_lADOABII5861YR-zzwAAAAQdeGyP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17674300559",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:03:49Z"
    },
    {
      "event": "mentioned",
      "id": 17674300592,
      "node_id": "MEE_lADOABII5861YR-zzwAAAAQdeGyw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17674300592",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:03:49Z"
    },
    {
      "event": "subscribed",
      "id": 17674300620,
      "node_id": "SE_lADOABII5861YR-zzwAAAAQdeGzM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17674300620",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:03:49Z"
    },
    {
      "event": "commented",
      "id": 2884199732,
      "node_id": "IC_kwDOABII586r6WU0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2884199732",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T15:14:23Z",
      "updated_at": "2025-05-15T15:15:06Z",
      "author_association": "MEMBER",
      "body": "I think a file structure of `$DATADIR/blocks/[${(HEIGHT//2016)*2016}]/$HEIGHT-$HASH.dat` would be a nice color for the bikeshed. That would mean typically 2016 block files per directory (if no branches appear), organized neatly per retarget period.\r\n\r\nAs for putting block and undo data in the same file, I'm unsure. Undo data to me feels more like a validation-level thing, while block data is more a storage-level thing.\r\n\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2884199732",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2885100223,
      "node_id": "IC_kwDOABII586r9yK_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2885100223",
      "actor": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-15T21:31:37Z",
      "updated_at": "2025-05-15T21:31:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "### Re: One file per block\r\n\r\nFWIW the idea of using one file per block gets me going too. :) It is slightly orthogonal but would be nice to avoid changing formats twice in short succession.\r\n\r\nMy bikeshed color: Since block hashes start with zeroes, maybe one could shard based off the last two bytes:\r\n\r\nGenesis block ends up in something like:\r\n`$DATADIR/blocks/e2/6f/000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f.dat`\r\nBlock [896819](https://mempool.space/block/000000000000000000012f13426140d43426f9db96fe9c93d3db4ebddfbf8428) from today ends up in:\r\n`$DATADIR/blocks/84/28/000000000000000000012f13426140d43426f9db96fe9c93d3db4ebddfbf8428.dat`\r\n\r\nUsing two levels deep directories of 256 entries at each branch point means we start averaging 1000 files per leaf directory at block height 65'536'000 (a bit earlier due to re-orgs). (File system limitations: <https://stackoverflow.com/a/466596>).\r\n\r\nIf having the height as the key is more useful than the hash, I prefer  https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2884199732.\r\n\r\n#### Possible argument against\r\n\r\nSpinning disks typically perform much better when sequentially accessed data is stored within the same file, so the current approach of multiple blocks per file may be more performant for some types of operations. I don't know if or how frequently we access the contents of blocks sequentially though.\r\n",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2885100223",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    },
    {
      "event": "commented",
      "id": 2885370086,
      "node_id": "IC_kwDOABII586r-0Dm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2885370086",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-16T00:57:51Z",
      "updated_at": "2025-05-16T00:57:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "> My bikeshed color: Since block hashes start with zeroes, maybe one could shard based off the last two bytes:\r\n\r\nJust curious because the FAT32 file limit per-directory is so small, is there any scenario where a miner could DoS nodes with this format by also mining the last two bytes? \r\n\r\nI think no, because at tip the additional hash needed for two bytes would be prohibitively expensive, although I'm not sure if there is a birthday-problem-like advantage because an attacker doesn't necessarily need to target only one two-byte suffix. And for IBD, headers-first sync would prevent an attack where someone suffix-mines >65,000 blocks from genesis and tries to get nodes to download them.",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32427#issuecomment-2885370086",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32427"
    }
  ],
  "comments": []
}
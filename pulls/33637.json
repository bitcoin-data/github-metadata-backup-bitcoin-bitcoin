{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33637",
    "id": 2919092278,
    "node_id": "PR_kwDOABII586t_dA2",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33637",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33637.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33637.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33637",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33637/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33637/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33637/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/f74572eb1d9eba95aab42cd0b98793d7dc38e2ef",
    "number": 33637,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "refactor: optimize block index comparisons (1.4-7.7x faster)",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "### Summary\r\nProfiling of the performance regression in #33618 revealed that `CBlockIndexWorkComparator` and its underlying `base_uint<256u>::CompareTo` are hot paths during block validation, consuming ~4% of CPU time.\r\n\r\n### Usage\r\nThe comparator is often called directly to compare two separate values and also defines the sorting order for `setBlockIndexCandidates`, a sorted tree containing valid block headers where the comparator is invoked extensively.\r\n\r\n### Testing\r\nTo ensure the optimized implementations are both fast and correct, the first commit adds a dedicated benchmark to measure `CBlockIndexWorkComparator` performance, and the second commit adds randomized tests comparing the new implementation with the original one.\r\n\r\n### Results\r\n\r\n> GCC 15.0.1:\r\n\r\n* `CBlockIndexWorkComparator`: 98.53 ops/s → 760.42 ops/s = 7.72x faster\r\n* `CheckBlockIndex`: 9,072.00 ops/s → 14,619.58 ops/s = 1.61x faster\r\n\r\n> Clang 22.0.0:\r\n\r\n* `CBlockIndexWorkComparator`: 102.82 ops/s → 497.29 ops/s = 4.84x faster\r\n* `CheckBlockIndex`: 10,273.03 ops/s → 15,070.71 ops/s = 1.47x faster\r\n\r\n<details>\r\n<summary>gcc and clang measurements</summary>\r\n\r\n> Compiler: gcc 15.0.1\r\n\r\nadbce49f43 bench: add benchmark to measure `CBlockIndexWorkComparator` performance\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|       10,149,522.07 |               98.53 |    0.0% |   67,993,951.57 |   36,443,026.47 |  1.866 |  14,173,411.20 |    1.9% |      5.54 | `CBlockIndexWorkComparator`\r\n|          110,229.31 |            9,072.00 |    0.8% |    1,014,400.11 |      395,734.30 |  2.563 |     313,018.11 |    0.0% |      5.54 | `CheckBlockIndex`\r\n\r\n01bc11c888 refactor: inline `arith_uint256` comparison operator\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        6,154,042.07 |              162.49 |    0.0% |   35,020,255.42 |   22,097,459.30 |  1.585 |   7,166,307.18 |    3.8% |      5.50 | `CBlockIndexWorkComparator`\r\n|          106,263.71 |            9,410.55 |    0.2% |      913,130.11 |      381,506.71 |  2.393 |     276,692.11 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\n9ce57c9e88 refactor: optimize `arith_uint256` comparison with spaceship operator\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        5,754,008.39 |              173.79 |    0.0% |   32,859,459.01 |   20,665,311.70 |  1.590 |   8,613,785.78 |    3.2% |      5.52 | `CBlockIndexWorkComparator`\r\n|           82,267.16 |           12,155.52 |    0.0% |      743,326.08 |      295,391.14 |  2.516 |     232,580.08 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\n143b120da5 refactor: optimize/simplify `CBlockIndexWorkComparator` with std::tie\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,315,062.22 |              760.42 |    0.1% |   16,190,416.37 |    4,719,274.15 |  3.431 |   3,062,352.32 |    0.2% |      5.50 | `CBlockIndexWorkComparator`\r\n|           68,401.42 |           14,619.58 |    0.1% |      585,826.07 |      245,598.44 |  2.385 |     181,920.07 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\n> Compiler: clang 22.0.0\r\n\r\nadbce49f43 bench: add benchmark to measure `CBlockIndexWorkComparator` performance\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        9,725,387.98 |              102.82 |    0.0% |   65,279,729.14 |   34,921,328.12 |  1.869 |  13,616,338.78 |    2.1% |      5.49 | `CBlockIndexWorkComparator`\r\n|           97,342.31 |           10,273.03 |    0.1% |      802,811.10 |      349,481.16 |  2.297 |     234,818.10 |    0.0% |      5.53 | `CheckBlockIndex`\r\n\r\n01bc11c888 refactor: inline `arith_uint256` comparison operator\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        6,589,310.94 |              151.76 |    0.0% |   29,743,496.88 |   23,658,709.86 |  1.257 |   6,104,956.63 |    4.6% |      5.50 | `CBlockIndexWorkComparator`\r\n|           89,494.33 |           11,173.89 |    0.1% |      646,488.09 |      321,260.26 |  2.012 |     195,191.09 |    0.0% |      5.51 | `CheckBlockIndex`\r\n\r\n9ce57c9e88 refactor: optimize `arith_uint256` comparison with spaceship operator\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        6,004,336.82 |              166.55 |    0.0% |   30,205,175.26 |   21,564,960.34 |  1.401 |   6,548,885.04 |    4.2% |      5.50 | `CBlockIndexWorkComparator`\r\n|           74,457.21 |           13,430.53 |    0.0% |      650,863.08 |      267,296.72 |  2.435 |     150,039.07 |    0.0% |      5.52 | `CheckBlockIndex`\r\n\r\n143b120da5 refactor: optimize/simplify `CBlockIndexWorkComparator` with std::tie\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        2,010,902.39 |              497.29 |    0.0% |   20,120,605.09 |    7,221,902.28 |  2.786 |   4,020,752.02 |    0.1% |      5.50 | `CBlockIndexWorkComparator`\r\n|           66,353.88 |           15,070.71 |    0.1% |      559,208.07 |      238,238.33 |  2.347 |     132,342.07 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\n</details>\r\n\r\n### Reproducer\r\n\r\nRun the equivalence tests with:\r\n```bash\r\ncmake -B build && cmake --build build && ./build/bin/test_bitcoin --run_test=arith_uint256_tests,blockchain_tests\r\n```\r\n\r\nEach commit shows how it changes the relevant benchmarks.\r\n\r\n<details>\r\n<summary>Benchmark script</summary>\r\n\r\n```bash\r\nfor compiler in gcc clang; do \\\r\n  if [ \"$compiler\" = \"gcc\" ]; then CC=gcc; CXX=g++; COMP_VER=$(gcc -dumpfullversion); \\\r\n  else CC=clang; CXX=clang++; COMP_VER=$(clang -dumpversion); fi && \\\r\n  echo \"> Compiler: $compiler $COMP_VER\" && \\\r\n  for commit in dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10 55d7d8ad03eaf2f4199d5728ef31c78b69685b4d d55d4f59f9364fbd3a8dafb3f8348252016caad5 f74572eb1d9eba95aab42cd0b98793d7dc38e2ef; do \\\r\n    git fetch origin $commit >/dev/null 2>&1 && git checkout $commit >/dev/null 2>&1 && git log -1 --pretty='%h %s' && \\\r\n    rm -rf build && \\\r\n    cmake -B build -DBUILD_BENCH=ON -DENABLE_IPC=OFF -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX >/dev/null 2>&1 && \\\r\n    cmake --build build -j$(nproc) >/dev/null 2>&1 && \\\r\n    for i in 1; do \\\r\n      build/bin/bench_bitcoin -filter='CBlockIndexWorkComparator|CheckBlockIndex' -min-time=5000; \\\r\n    done; \\\r\n  done; \\\r\ndone\r\n```\r\n\r\n</details>\r\n\r\nNote: something similar was already started in https://github.com/bitcoin/bitcoin/pull/33334, but this in a broader optimization that doesn't use the same technique: added as coauthor regardless.",
    "labels": [
      {
        "id": 135961,
        "node_id": "MDU6TGFiZWwxMzU5NjE=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Refactoring",
        "name": "Refactoring",
        "color": "E6F6D6",
        "default": false
      }
    ],
    "created_at": "2025-10-16T01:54:31Z",
    "updated_at": "2025-10-16T01:54:47Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "1e79658de1afba8a7ae8224bede3a8482ee57a9a",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/block_index_comparators",
      "ref": "l0rinc/block_index_comparators",
      "sha": "f74572eb1d9eba95aab42cd0b98793d7dc38e2ef",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 3,
        "watchers_count": 3,
        "size": 274321,
        "default_branch": "master",
        "open_issues_count": 11,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-16T01:52:44Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2025-10-15T18:02:28Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "e14451ac87339ed61b8c872f027184a978dd96eb",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38036,
        "stargazers_count": 86206,
        "watchers_count": 86206,
        "size": 294954,
        "default_branch": "master",
        "open_issues_count": 826,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-10-15T14:01:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-10-16T00:26:10Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33637"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 146,
    "deletions": 45,
    "changed_files": 9,
    "commits": 5,
    "review_comments": 0,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRjN2U3MGU5YWNhODA5MDBjOWM2NGZlMmM2ODVmZDkxYzNkZDdkMTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10",
      "tree": {
        "sha": "93d46b75dec475a55a3389f0c680ce776230ec77",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/93d46b75dec475a55a3389f0c680ce776230ec77"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e14451ac87339ed61b8c872f027184a978dd96eb",
          "sha": "e14451ac87339ed61b8c872f027184a978dd96eb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e14451ac87339ed61b8c872f027184a978dd96eb"
        }
      ],
      "message": "bench: add benchmark to measure `CBlockIndexWorkComparator` performance\n\nProfiling shows this comparator consumes a significant portion `CheckBlockIndex`:\n... ChainstateManager::CheckBlockIndex()\n    ... std::_Rb_tree<...>::find(...)\n        ... node::CBlockIndexWorkComparator::operator()(...)\n            ... base_uint<256u>::CompareTo(...) const\n\nThis commit introduces a benchmark that performs pairwise comparisons on 1000 randomly generated block indices (with some duplicates) to establish baseline performance metrics before further optimization.\n\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|       10,149,522.07 |               98.53 |    0.0% |   67,993,951.57 |   36,443,026.47 |  1.866 |  14,173,411.20 |    1.9% |      5.54 | `CBlockIndexWorkComparator`\n|          110,229.31 |            9,072.00 |    0.8% |    1,014,400.11 |      395,734.30 |  2.563 |     313,018.11 |    0.0% |      5.54 | `CheckBlockIndex`",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-16T01:23:57Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-14T17:56:55Z"
      },
      "sha": "dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNhY2I2YjZjZDBhZjZkNTQ5MmI2ZDNkYWYyY2M4YjZmMzkxMmM3NWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c",
      "tree": {
        "sha": "23197ca746617b667aceaaf2fb237cdeaba6336b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/23197ca746617b667aceaaf2fb237cdeaba6336b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10",
          "sha": "dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/dc7e70e9aca80900c9c64fe2c685fd91c3dd7d10"
        }
      ],
      "message": "test: add comparison equivalence tests for upcoming optimizations\n\nAdd equivalence tests to verify behavioral compatibility when optimizing comparison operations.\nThese are duplicating behavior for now, but this way the reviewers can validate that the behave the same wway before the optimizations.\n\nThe `arith_uint256` test verifies that the spaceship operator produces identical results to the original `CompareTo` method for all comparison operators (<, >, <=, >=, ==, !=).\n\nThe `CBlockIndexWorkComparator` test captures the current comparison logic in a lambda and verifies that optimized versions maintain identical sorting behavior for chain work, sequence ID, and pointer tiebreaking.\n\nYou can run the tests with:\n> cmake -B build && cmake --build build && ./build/bin/test_bitcoin --run_test=arith_uint256_tests,blockchain_tests",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-16T01:23:58Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-15T15:05:56Z"
      },
      "sha": "3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU1ZDdkOGFkMDNlYWYyZjQxOTlkNTcyOGVmMzFjNzhiNjk2ODViNGQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55d7d8ad03eaf2f4199d5728ef31c78b69685b4d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/55d7d8ad03eaf2f4199d5728ef31c78b69685b4d",
      "tree": {
        "sha": "c7a419e0e42c0a353321a310bf5c029415cd429c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c7a419e0e42c0a353321a310bf5c029415cd429c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c",
          "sha": "3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3acb6b6cd0af6d5492b6d3daf2cc8b6f3912c75c"
        }
      ],
      "message": "refactor: inline `arith_uint256` comparison operator\n\nRemove the `CompareTo` method and inline its logic directly into `operator<=>`, updating related comments.\nThis eliminates function call overhead in the hot path during block generation and chain selection.\n\nThe comparison algorithm remains unchanged, iterating from most significant to least significant word, but now returns `std::strong_ordering` directly instead of an integer that gets converted via spaceship operator.\n\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|        6,154,042.07 |              162.49 |    0.0% |   35,020,255.42 |   22,097,459.30 |  1.585 |   7,166,307.18 |    3.8% |      5.50 | `CBlockIndexWorkComparator`\n|          106,263.71 |            9,410.55 |    0.2% |      913,130.11 |      381,506.71 |  2.393 |     276,692.11 |    0.0% |      5.50 | `CheckBlockIndex`",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-16T01:23:58Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-15T14:31:27Z"
      },
      "sha": "55d7d8ad03eaf2f4199d5728ef31c78b69685b4d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ1NWQ0ZjU5ZjkzNjRmYmQzYThkYWZiM2Y4MzQ4MjUyMDE2Y2FhZDU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d55d4f59f9364fbd3a8dafb3f8348252016caad5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d55d4f59f9364fbd3a8dafb3f8348252016caad5",
      "tree": {
        "sha": "938b3a1c717eaf1dd915f511aedd57923ba6cc05",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/938b3a1c717eaf1dd915f511aedd57923ba6cc05"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55d7d8ad03eaf2f4199d5728ef31c78b69685b4d",
          "sha": "55d7d8ad03eaf2f4199d5728ef31c78b69685b4d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/55d7d8ad03eaf2f4199d5728ef31c78b69685b4d"
        }
      ],
      "message": "refactor: optimize `arith_uint256` comparison with spaceship operator\n\nReplace multiple comparisons with a single C++20 spaceship operator call directly.\n\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|        5,754,008.39 |              173.79 |    0.0% |   32,859,459.01 |   20,665,311.70 |  1.590 |   8,613,785.78 |    3.2% |      5.52 | `CBlockIndexWorkComparator`\n|           82,267.16 |           12,155.52 |    0.0% |      743,326.08 |      295,391.14 |  2.516 |     232,580.08 |    0.0% |      5.50 | `CheckBlockIndex`",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-16T01:23:58Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-14T17:56:59Z"
      },
      "sha": "d55d4f59f9364fbd3a8dafb3f8348252016caad5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY3NDU3MmViMWQ5ZWJhOTVhYWI0MmNkMGI5ODc5M2Q3ZGMzOGUyZWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f74572eb1d9eba95aab42cd0b98793d7dc38e2ef",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f74572eb1d9eba95aab42cd0b98793d7dc38e2ef",
      "tree": {
        "sha": "968bd813fda7a7251f1cd1d0823940db61b2d3b8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/968bd813fda7a7251f1cd1d0823940db61b2d3b8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d55d4f59f9364fbd3a8dafb3f8348252016caad5",
          "sha": "d55d4f59f9364fbd3a8dafb3f8348252016caad5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d55d4f59f9364fbd3a8dafb3f8348252016caad5"
        }
      ],
      "message": "refactor: optimize `CBlockIndexWorkComparator` with std::tie\n\nReplace manual comparison branches with a single tuple comparison, allowing the compilers to generate more efficient comparison code.\nAlso, inlined the code implicitly by moving it to the header for additional gains.\nFor symmetry, `CBlockIndexHeightOnlyComparator` was also moved to the header.\n\n               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|        1,315,062.22 |              760.42 |    0.1% |   16,190,416.37 |    4,719,274.15 |  3.431 |   3,062,352.32 |    0.2% |      5.50 | `CBlockIndexWorkComparator`\n|           68,401.42 |           14,619.58 |    0.1% |      585,826.07 |      245,598.44 |  2.385 |     181,920.07 |    0.0% |      5.50 | `CheckBlockIndex`\n\nCo-authored-by: Raimo33 <claudio.raimondi@protonmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-16T01:52:37Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-10-15T15:06:02Z"
      },
      "sha": "f74572eb1d9eba95aab42cd0b98793d7dc38e2ef"
    },
    {
      "event": "labeled",
      "id": 20308153714,
      "node_id": "LE_lADOABII587Rz6mDzwAAAAS6ddVy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20308153714",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-16T01:54:35Z",
      "label": {
        "name": "Refactoring",
        "color": "E6F6D6"
      }
    },
    {
      "event": "commented",
      "id": 3408879876,
      "node_id": "IC_kwDOABII587LL2EE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3408879876",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-16T01:54:37Z",
      "updated_at": "2025-10-16T01:54:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33637.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33637#issuecomment-3408879876",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33637"
    }
  ],
  "comments": []
}
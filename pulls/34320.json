{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320",
    "id": 3181854676,
    "node_id": "PR_kwDOABII5869pz_U",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34320",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34320.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34320.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
    "number": 34320,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove redundant and confusing `CCoinsViewDB::HaveCoin`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Split out of https://github.com/bitcoin/bitcoin/pull/34132#discussion_r2692307054.\r\n\r\n### Problem\r\nWe have two ways to check if a coin exists in the db.\r\nOne tries to deserialize, the other just returns whether any value is associated with the key.\r\nBut we usually need the full value we probed for, and `HaveCoin` cannot cache the returned value, so it can trigger an extra lookup if `HaveCoin` uses `Exists` and the caller later needs the actual value.\r\nWe're already delegating most `HaveCoin` calls to `GetCoin` anyway for the above reasons, so the `CCoinsViewDB` implementation of `HaveCoin` is redundant.\r\n\r\n### Fix\r\nRemove `CCoinsViewDB::HaveCoin` (falls back to the base `CCoinsView::HaveCoin` which delegates to `GetCoin`) and simplify `CCoinsViewCache::HaveCoin` to use `AccessCoin`.\r\n\r\n### Testing\r\nA unit test was added to confirm that `HaveInputs` calls the database's `::GetCoin` (not `::HaveCoin`) on cache miss and checks cache first.\r\nAlso added a benchmark to track throughput before/after changes to ensure no regression.\r\n\r\n----\r\n\r\nNote: the latest version of the change keeps most `HaveCoin` calls for convenience, a previous version removed all of them.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2026-01-16T16:17:29Z",
    "updated_at": "2026-02-03T18:55:22Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "5ea5f5f752bb6cbde30bf005fe9a2534940d5aab",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/remove-HaveCoin",
      "ref": "l0rinc/remove-HaveCoin",
      "sha": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 283284,
        "default_branch": "master",
        "open_issues_count": 41,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-03T17:56:51Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-31T18:51:50Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b58eebf1520f503bd4c7c5693546a6859064ce51",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38847,
        "stargazers_count": 87908,
        "watchers_count": 87908,
        "size": 303024,
        "default_branch": "master",
        "open_issues_count": 744,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-03T11:26:44Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-03T18:39:56Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 151,
    "deletions": 35,
    "changed_files": 8,
    "commits": 4,
    "review_comments": 20,
    "comments": 10
  },
  "events": [
    {
      "event": "labeled",
      "id": 22099797162,
      "node_id": "LE_lADOABII587j2bERzwAAAAUlQCSq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22099797162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-16T16:17:33Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3760801609,
      "node_id": "IC_kwDOABII587gKUdJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3760801609",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-16T16:17:39Z",
      "updated_at": "2026-02-02T10:51:45Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34320.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34132](https://github.com/bitcoin/bitcoin/pull/34132) (coins: fail fast on database read deserialization errors by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32427](https://github.com/bitcoin/bitcoin/pull/32427) ((RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store by sedited)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3760801609",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3773430088,
      "node_id": "IC_kwDOABII587g6flI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3773430088",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T15:22:55Z",
      "updated_at": "2026-01-20T15:22:55Z",
      "author_association": "MEMBER",
      "body": "> One tries to deserialize, the other just returns whether any value is associated with the key.\r\n> But we usually need the full value we probed for, and `HaveCoin` cannot cache the returned value, so it can trigger an extra lookup if `HaveCoin` uses `Exists` and the caller later needs the actual value.\r\n\r\nAre there any flamegraphs or benchmarks, to see how this affects performance?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3773430088",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3773551201,
      "node_id": "IC_kwDOABII587g69Jh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3773551201",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T15:43:13Z",
      "updated_at": "2026-01-20T15:44:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are there any flamegraphs or benchmarks, to see how this affects performance?\r\n\r\nI'm not sure what to measure exactly because the current code was already delegating to `GetCoin` in most places.\r\nThe pruned IBD and `-reindex-chainstate` and `AssumeUTXO` loading benchmarks I started haven't finished yet - but I don't expect *any* change there.\r\nIf you can describe a scenario that you would find helpful, please let me know.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3773551201",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3786631676,
      "node_id": "IC_kwDOABII587hs2n8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3786631676",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-22T20:50:56Z",
      "updated_at": "2026-01-22T20:50:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are there any flamegraphs or benchmarks, to see how this affects performance?\r\n\r\nAdded assumeutxo load, reindex-chainstate and pruned IBD measurements to the PR description",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3786631676",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3795502194,
      "node_id": "IC_kwDOABII587iOsRy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795502194",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T20:56:43Z",
      "updated_at": "2026-01-24T20:57:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I'm not sure what to measure exactly because the current code was already delegating to GetCoin in most places.\r\n\r\nI'm not sure about this. `CCoinsViewCache::HaveCoin` seems to be the implementation that is called in all non-test places outside of `coins.cpp`, and only delegates to `GetCoin` if there's a cache miss. In `CCoinsViewCache::HaveCoin` we avoid copying `Coin`:\r\n\r\n```C++\r\nbool CCoinsViewCache::HaveCoin(const COutPoint &outpoint) const {\r\n    CCoinsMap::const_iterator it = FetchCoin(outpoint);\r\n    return (it != cacheCoins.end() && !it->second.coin.IsSpent());\r\n}\r\n```\r\n\r\nvs `CCoinsViewCache::GetCoin` where we return a copy of `Coin`:\r\n\r\n```C++\r\nstd::optional<Coin> CCoinsViewCache::GetCoin(const COutPoint& outpoint) const\r\n{\r\n    if (auto it{FetchCoin(outpoint)}; it != cacheCoins.end() && !it->second.coin.IsSpent()) return it->second.coin;\r\n    return std::nullopt;\r\n}\r\n```",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3795502194",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3795574265,
      "node_id": "IC_kwDOABII587iO935",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795574265",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T21:38:02Z",
      "updated_at": "2026-01-24T23:03:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "> we usually need the full value we probed for, and HaveCoin cannot cache the returned value, so it can trigger an extra lookup if HaveCoin uses Exists and the caller later needs the actual value.\r\n\r\nI see 4 uses of `HaveCoin`\r\n1. In `ConnectBlock`, we ensure we do not already have outputs of a block for BIP30 checks.\r\n2. In `ApplyTxInUndo`, we ensure we do not already have the coin we are about to roll back to unspent.\r\n3. In `MemPoolAccept::PreChecks`, where we check that we have all inputs of a tx we are accepting to the mempool.\r\n4. In `TxVerify`, where we call `HaveInputs`.\r\n\r\nFor 1 and 2, we are checking for the non-existence of the coin so we won't need the full value. In this case not caching the value makes sense.\r\nFor 3, it is explicitly relying on the fact that the value is cached. The backend is thrown away after all input prevouts are added to the top level cache.\r\nFor 4, it is a peformance improvement that the value is cached.\r\n\r\nI think 1 and 2 would benefit from `CCoinsViewCache::HaveCoin` delegating to the base's `HaveCoin` and not going through `FetchCoin`.\r\nFor 3 this seems like an abuse of the `CCoinsView` API. But, calling `GetCoin` instead there would result in unnecessary copying of the `Coin`. I'm not sure what the best solution is here.\r\nFor 4 the current behavior makes sense.\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3795574265",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3796835980,
      "node_id": "IC_kwDOABII587iTx6M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3796835980",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-25T15:28:29Z",
      "updated_at": "2026-01-25T16:28:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "> only delegates to GetCoin if there's a cache miss. In CCoinsViewCache::HaveCoin we avoid copying Coin\r\n\r\nDisassembly with separate translation units indicates `GetCoin()` does a new + memcpy of the Coin and the caller immediately deletes it, even when only checking `.has_value()`. `HaveCoin()` does indeed avoid it, but the extra copy only happens on the unexpectedly-present coin path, since if it's expected, we usually want to cache it. If we want to avoid the extra copy, we can use `AccessCoin`, but we would duplicate the spentness check.\r\n\r\n> In this case not caching the value makes sense.\r\n\r\nBut there's nothing to cache since these will return an empty optional. For BIP30 and `ApplyTxInUndo` the missing-coin path dominates, so `GetCoin()` short-circuits on `Read()` failure without deserialization, so I/O is the same as `Exists()`, no coin-copy happens (and when it does we crash or reorg anyway). But given that validation until bip30-end takes less than 3 minutes on my benchmarking server (see https://github.com/bitcoin/bitcoin/pull/33817), I'd say it's irrelevant either way.\r\n\r\n> For 3 this seems like an abuse of the CCoinsView API. But, calling GetCoin instead there would result in unnecessary copying of the Coin. I'm not sure what the best solution is here.\r\n\r\nThis is a good point, the disassembly indicates there's no devirtualization and no inlining in `CCoinsViewCache::HaveInputs` and `MemPoolAccept::PreChecks`, so the copy is real - though a lot faster than disk access, so it's not actually measurable.\r\nWe can use `AccessCoin` here and with explicit `IsSpent` call instead which would avoid the call (according to the assembly):\r\n```C++\r\nif (AccessCoin(tx.vin[i].prevout).IsSpent()) {\r\n```\r\nand\r\n```C++\r\nif (m_view.AccessCoin(txin.prevout).IsSpent()) {\r\n```\r\n\r\n----\r\n\r\nI have added a new benchmark as a first commit to check the performance of on-disk `HaveInputs` to make sure the performance is retained.\r\n\r\nBenchmark baseline:\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              998.95 |        1,001,046.69 |    0.8% |      1.09 | `HaveInputsOnDisk`\r\n\r\nBenchmark with `!GetCoin()` instead of `HaveCoin`:\r\n\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              985.57 |        1,014,640.63 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\nReplace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\r\n\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              983.17 |        1,017,118.55 |    0.3% |      1.10 | `HaveInputsOnDisk`\r\n\r\n(ran it 5 times for each commit and copied the fastest (with smallest noise). The small difference is reproducible, but not very important as long as it's not measurably slower)\r\n\r\n<details>\r\n<summary>Benchmarking script and results on Linux</summary>\r\n\r\n```bash\r\nfor commit in 3544b98927050956f68cb183bf2686f5c65e5ebb 8c568500442144fbcd457eccda5a1956aa98ca81; do \\                                        \r\n    git fetch origin $commit >/dev/null 2>&1 && git checkout $commit >/dev/null 2>&1 && echo \"\" && git log -1 --pretty='%h %s' && \\\r\n    rm -rf build >/dev/null 2>&1 && cmake -B build -DBUILD_BENCH=ON -DCMAKE_BUILD_TYPE=Release >/dev/null 2>&1 && \\\r\n    cmake --build build -j$(nproc) >/dev/null 2>&1 && \\\r\n    for _ in $(seq 5); do \\\r\n      sleep 5; \\\r\n      ./build/bin/bench_bitcoin -filter='HaveInputsOnDisk' -min-time=1000; \\\r\n    done; \\\r\ndone\r\n```\r\nresulting in\r\n> 3544b98927 bench: add on-disk `HaveInputs` benchmark\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,137.20 |          467,902.92 |    0.0% |       16,874.42 |        7,673.54 |  2.199 |       2,895.01 |    0.8% |      1.09 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,153.41 |          464,380.56 |    0.0% |       16,873.94 |        7,729.93 |  2.183 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,148.36 |          465,471.81 |    0.1% |       16,873.92 |        7,709.74 |  2.189 |       2,894.98 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,150.10 |          465,095.33 |    0.1% |       16,873.85 |        7,718.44 |  2.186 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,135.95 |          468,175.11 |    0.0% |       16,874.21 |        7,669.12 |  2.200 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n> 8c56850044 coins: replace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,120.50 |          471,586.34 |    0.0% |       16,874.75 |        7,611.58 |  2.217 |       2,897.27 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,178.86 |          458,955.50 |    0.5% |       16,875.34 |        7,821.05 |  2.158 |       2,897.29 |    1.0% |      1.08 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,153.54 |          464,352.06 |    0.0% |       16,875.12 |        7,731.71 |  2.183 |       2,897.26 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,137.40 |          467,857.52 |    0.0% |       16,875.16 |        7,673.32 |  2.199 |       2,897.26 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,135.08 |          468,365.96 |    0.0% |       16,875.23 |        7,663.44 |  2.202 |       2,897.27 |    0.8% |      1.11 | `HaveInputsOnDisk`\r\n\r\n</details>",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3796835980",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22274900599,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAUvsAJ3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22274900599",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8c568500442144fbcd457eccda5a1956aa98ca81",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/8c568500442144fbcd457eccda5a1956aa98ca81",
      "created_at": "2026-01-25T15:28:30Z"
    },
    {
      "event": "commented",
      "id": 3815084392,
      "node_id": "IC_kwDOABII587jZZFo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3815084392",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-29T02:37:26Z",
      "updated_at": "2026-01-29T02:37:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "> If we want to avoid the extra copy, we can use AccessCoin, but we would duplicate the spentness check.\r\n\r\nThis tells us that `HaveCoin` is the right level of abstraction then, and is a useful method, no?\r\n\r\n> In this case not caching the value makes sense.\r\n>>But there's nothing to cache since these will return an empty optional\r\n\r\nSame as above.\r\n\r\n> We can use AccessCoin here and with explicit IsSpent call instead which would avoid the call (according to the assembly)\r\n\r\nI think everywhere we use AccessCoin we assert the unspentness. This would now break that pattern and use AccessCoin to check existence via spentness. I think HaveCoin conveys intent better here.\r\n\r\nCan we instead just remove HaveCoin on the db then, and the default implementation would just forward to `!!GetCoin` for it?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3815084392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "renamed",
      "id": 22443808251,
      "node_id": "RTE_lADOABII587j2bERzwAAAAU5wVX7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443808251",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T13:34:35Z",
      "rename": {
        "from": "coins: replace remaining `HaveCoin` calls with `GetCoin`",
        "to": "coins: remove redundant and confusing `CCoinsViewDB::HaveCoin`"
      }
    },
    {
      "event": "commented",
      "id": 3831067474,
      "node_id": "IC_kwDOABII587kWXNS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3831067474",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T13:38:06Z",
      "updated_at": "2026-02-01T13:38:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks @andrewtoth, I didn't like the suggestion at first since we keep polluting the interface, but after applying your suggestion I'm fine with the results, it's simpler and better separated from the other similar PRs.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3831067474",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "mentioned",
      "id": 22443845821,
      "node_id": "MEE_lADOABII587j2bERzwAAAAU5wei9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443845821",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T13:38:07Z"
    },
    {
      "event": "subscribed",
      "id": 22443845861,
      "node_id": "SE_lADOABII587j2bERzwAAAAU5wejl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443845861",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T13:38:07Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22443860285,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAU5wiE9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443860285",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "67068eea16002e533d62481ffe1fc705ef80353e",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/67068eea16002e533d62481ffe1fc705ef80353e",
      "created_at": "2026-02-01T13:39:28Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22443882119,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAU5wnaH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443882119",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "3d25cbf3c805752220de79acd281064725254613",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/3d25cbf3c805752220de79acd281064725254613",
      "created_at": "2026-02-01T13:42:14Z"
    },
    {
      "event": "labeled",
      "id": 22443884792,
      "node_id": "LE_lADOABII587j2bERzwAAAAU5woD4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443884792",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T13:42:42Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22443886528,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAU5wofA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22443886528",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "4166ee8f0175a440f461320165ce8cea9207c22e",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/4166ee8f0175a440f461320165ce8cea9207c22e",
      "created_at": "2026-02-01T13:43:00Z"
    },
    {
      "event": "unlabeled",
      "id": 22444328375,
      "node_id": "UNLE_lADOABII587j2bERzwAAAAU5yUW3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22444328375",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-01T14:43:42Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3736369272,
      "node_id": "PRR_kwDOABII587etHh4",
      "url": null,
      "actor": null,
      "commit_id": "4166ee8f0175a440f461320165ce8cea9207c22e",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-01T18:24:44Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#pullrequestreview-3736369272",
      "submitted_at": "2026-02-01T18:24:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22449412556,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAU6FtnM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22449412556",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/23dd085872bc0f01309260e00cce239a9512b45e",
      "created_at": "2026-02-01T22:19:55Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc4YmE4NTU4NzMyZTM5NWJlYWY0ODlmNTY0ODg4MWVmMGRjYTAwMDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/78ba8558732e395beaf489f5648881ef0dca0008",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/78ba8558732e395beaf489f5648881ef0dca0008",
      "tree": {
        "sha": "54b25540168fc949fba31c6b4a83125e00a35a49",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54b25540168fc949fba31c6b4a83125e00a35a49"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 54b25540168fc949fba31c6b4a83125e00a35a49\nparent 5f66fca633c88700c4a71c5d5b307c8cc5575913\nauthor Lrinc <pap.lorinc@gmail.com> 1769349649 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1770141388 +0100\n\nbench: add on-disk `HaveInputs` benchmark\n\n`CCoinsViewCache::HaveInputs()` is used by `Consensus::CheckTxInputs()` and currently exercises the `HaveCoin()` path in the UTXO cache.\nPerformance could be affected due to `Coin` copying and different cache warming behavior.\n\nAdd a benchmark to track `HaveInputs()` throughput before and after the `HaveCoin()` changes in this series to make sure the performance is retained.\nThe benchmark populates an on-disk `CCoinsViewDB` with dummy unspent coins for all block inputs and then calls `HaveInputs()` for each non-coinbase transaction using a fresh `CCoinsViewCache` (to avoid cross-iteration caching).\nIt calls `HaveInputs()` twice to exercise the cache-hit path as well.\n\nBenchmark baseline:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|            1,004.58 |          995,437.07 |    0.7% |      1.10 | `HaveInputsOnDisk`\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmCNswACgkQZp//D/pH\nenb8wg//QLkQiVEZnaE5+jrm4UBXc4pLLzo0OjKkAILUgsSFLZoYkH/kUtI1K7Lu\nJmUJM/ZHlbotfJ6zRfrxwu/VxT+LuvGRVPBdWwFwvgF8Jczk96cbG6o64jXZ40o/\ny8KUU3K6z/A4DqZMTcXLUFH7KN6uJzCUF8dCqv1MlzT+S9TOHijYODWnx83fTApd\nuKL1JIql+Rc150sB+iVg5/Mlgs34YkhrztAkfGfmI1yLZQ1UVXOacqWqPYK8AMHi\n5pXCRj2PV1tMV2Us2SvL9IR4la4X6n35bKwg5EQvsoRAYbeqPUIFdnF1cDZMSHf3\nMP8QA5SXxGqRsl32FXdHb0+h341VenWdC/fuMK4OqVmEEbr48rgTawmufTaJXNxX\n764nQ9F6iEOF1je8kQkw0LDN8SBX4FAXoH3/n7CoPL6s2TQjeVSp7f1f2VBMQpKx\nukakr7zr34OBpgxmlie5dHK3znI8LINKZxnbHunOb91sigx1TD4PXXJuO13fpocJ\nXA6yNvLSgiUeQxbyjsyKX1RWaK1L+oxswXT+yiDRsrJNnOHG965St27auzV67A7a\nSdGyQv/sxJ14Q2jmKZf+Siwy2XCaP5UYkPxsqPh2ZbiPtyRXZsnncDE0GuccZLi9\nw+FVlfEV1dAUHUtJTHgoBjxvhy8stzzWV928CgQf5zoV4OU0/Qw=\n=W1yS\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f66fca633c88700c4a71c5d5b307c8cc5575913",
          "sha": "5f66fca633c88700c4a71c5d5b307c8cc5575913",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5f66fca633c88700c4a71c5d5b307c8cc5575913"
        }
      ],
      "message": "bench: add on-disk `HaveInputs` benchmark\n\n`CCoinsViewCache::HaveInputs()` is used by `Consensus::CheckTxInputs()` and currently exercises the `HaveCoin()` path in the UTXO cache.\nPerformance could be affected due to `Coin` copying and different cache warming behavior.\n\nAdd a benchmark to track `HaveInputs()` throughput before and after the `HaveCoin()` changes in this series to make sure the performance is retained.\nThe benchmark populates an on-disk `CCoinsViewDB` with dummy unspent coins for all block inputs and then calls `HaveInputs()` for each non-coinbase transaction using a fresh `CCoinsViewCache` (to avoid cross-iteration caching).\nIt calls `HaveInputs()` twice to exercise the cache-hit path as well.\n\nBenchmark baseline:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|            1,004.58 |          995,437.07 |    0.7% |      1.10 | `HaveInputsOnDisk`",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-03T17:56:28Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T14:00:49Z"
      },
      "sha": "78ba8558732e395beaf489f5648881ef0dca0008"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDViZDU3Yjg4ODJmZDk5OGVhMjM4ZDJjMDBhNDkxNjk0MWRlN2ZkYjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5bd57b8882fd998ea238d2c00a4916941de7fdb3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5bd57b8882fd998ea238d2c00a4916941de7fdb3",
      "tree": {
        "sha": "5ce626956edc1e63f0d819f61914c02891536b02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5ce626956edc1e63f0d819f61914c02891536b02"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5ce626956edc1e63f0d819f61914c02891536b02\nparent 78ba8558732e395beaf489f5648881ef0dca0008\nauthor Lrinc <pap.lorinc@gmail.com> 1768430604 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1770141388 +0100\n\ntest: add `HaveInputs` call-path unit tests\n\nAdd unit tests covering `CCoinsViewCache::HaveInputs()`.\n\nThe tests document that `HaveInputs()` consults the cache first and that a cache miss pulls from the backing view via `GetCoin()`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmCNswACgkQZp//D/pH\nenYbVRAAzlo1vO+hbGZ9Aj7x5Av/aOFOTU7yL+KJKCU9aWFeOKPNkniMtQfm38W4\ncSBlPnNzpD8DQls4qC3nxKVvmKLELcKXfreqUwXS1ea5GFL3k5UgOAp6bbyrdC7o\nSCnQO66arUW9WK9KKBBafgEWiEuehZpPUyumCc7kYTOXm3YuRW+/CSAaoRJEFY4C\nBEOqUWJa5JFzyQYXpMfadVEIBzLmO2NjW2GXGu54Sc/yA/1E5v0WdIzkj8JQ74KM\n4RMuhpxhHvZhA0cK18hKATWvHLezexC3je9abFKSZnag7sWvmwFODlYbLGSQMlYw\nrTmlkC8KS1Nu6MBzAd2SF3KzTr70WxuJmfHdoTxKx/NoIZKG1tLZShmdl4RrAV9i\n7UPU5Q65kXLr7Qkqw4mphqg4N6Vm3xcbB7f0zGVRU9elqhbNODLyQ0ikWSXpZPE3\nodzKdx0r10ak+/IZerdjBmkCQmt4ecK89tp8bIvHnq/ij05/jiITwRSxOISTPmOf\ncjUfMDWga7yew0HEeO+mZ+nKJTqGFPPW+Pt30y7ByW+s43YagHorIFTWc4jYylAm\n1CQA18MZ5Y0na8ZUCgn5+fkY8qONkkFV0++lUEXyr74UbUtAIM5Zm2ESZjDdqXvj\ny9U5k9JTYtEw+ZKqTBSEOr+bOTMTYkAHoxetis/cPR017P3iGn0=\n=Yvbp\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/78ba8558732e395beaf489f5648881ef0dca0008",
          "sha": "78ba8558732e395beaf489f5648881ef0dca0008",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/78ba8558732e395beaf489f5648881ef0dca0008"
        }
      ],
      "message": "test: add `HaveInputs` call-path unit tests\n\nAdd unit tests covering `CCoinsViewCache::HaveInputs()`.\n\nThe tests document that `HaveInputs()` consults the cache first and that a cache miss pulls from the backing view via `GetCoin()`.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-03T17:56:28Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-14T22:43:24Z"
      },
      "sha": "5bd57b8882fd998ea238d2c00a4916941de7fdb3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU4NTZhZGJlMWVjNDM5YmJlOTRlODRjMGIzN2FkNzIwOTFmYWQ0Y2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5856adbe1ec439bbe94e84c0b37ad72091fad4ce",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5856adbe1ec439bbe94e84c0b37ad72091fad4ce",
      "tree": {
        "sha": "1c2c0ca9be2c14e53a6e7502768006f32c7e3ab2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1c2c0ca9be2c14e53a6e7502768006f32c7e3ab2"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1c2c0ca9be2c14e53a6e7502768006f32c7e3ab2\nparent 5bd57b8882fd998ea238d2c00a4916941de7fdb3\nauthor Lrinc <pap.lorinc@gmail.com> 1768430928 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1770141388 +0100\n\ndbwrapper: have `Read` and `Exists` reuse `ReadRaw`\n\n`ExistsImpl` was removed since it duplicates `CDBWrapper::ReadImpl` (except that it copies the resulting string on success, but that will be needed for caching anyway).\n`CDBWrapper::Exists()` and `::ReadRaw()` both issue a LevelDB `::Get`.\nIntroduce a small helper returning the raw value bytes (as `std::string`) for a given key.\nMove `Exists` closer to the read methods.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmCNswACgkQZp//D/pH\nenZH6Q//fYjDlMxStHm64+SbypnDEiYLKaliTp/9AAqlVdjkLeY1nb//H3CGMtOp\nvizIEpMAB36Hnfe+pfRMhBrCOjBZdO3FTYa8D86RAoliStJM4zkLKiPBvTF5/xWD\nXstvhkDKZr5V/KNSS++8mSU11fcAZ9te/QMBNFS7Wy6H5LUemULyr5te5rL4rlGB\nvn1MoYKl/I3YpgqcReW3WSEP7eBQaWXa42GopJ1IDd5gsHp2NPf7ArRvSwRGc/ht\nAsNY2p844XS3WUwbvHVkc6CNLV8X0Qf1sPDf7g/+i8GMvHJhNs3kKOrIygNO5WZ3\nNsZug1If16sRXFTIxMjnIU/FtyK1/pmNXjz3SOyqbWxFEWBAtSyBz9HtksZrmz3R\nDm95wZCySxnLYHaArbdmKaoRBZeBRhitS8xWCMpDlD4pHc8YDQMiz6sjhw/oE/Tq\n1qpPeKROJrVjggiHnkTc3rlsHZKce4QNJc6WIwWIwEg42vyhSe6Ug4jJWXymhaVj\nOvMSnxeERe3n1pFiScee/l+dgxhYNCeAAysZjh4lKha+/clEt0UNmHOj1LyyRDRy\nywZ0Wr7qDWNRF+QEUw8ibCvNn5nKggGM8wqx2umAwF2rrl8MMrFLw2UAo2RF3Odb\nDP9MP949ywvLAPmNO7oh2Paro0E6wIC23vX0eXNUAQ5h2co9Ik0=\n=D3N0\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5bd57b8882fd998ea238d2c00a4916941de7fdb3",
          "sha": "5bd57b8882fd998ea238d2c00a4916941de7fdb3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5bd57b8882fd998ea238d2c00a4916941de7fdb3"
        }
      ],
      "message": "dbwrapper: have `Read` and `Exists` reuse `ReadRaw`\n\n`ExistsImpl` was removed since it duplicates `CDBWrapper::ReadImpl` (except that it copies the resulting string on success, but that will be needed for caching anyway).\n`CDBWrapper::Exists()` and `::ReadRaw()` both issue a LevelDB `::Get`.\nIntroduce a small helper returning the raw value bytes (as `std::string`) for a given key.\nMove `Exists` closer to the read methods.",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-03T17:56:28Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-14T22:48:48Z"
      },
      "sha": "5856adbe1ec439bbe94e84c0b37ad72091fad4ce"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5ZmExNWFhYWQwNmFiZjdhZjJkMjRlNzZlZWI4ZjQxN2NkNjZhMzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "tree": {
        "sha": "f402d620d8897214985b59d9c4d6bab40e4bc0bb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f402d620d8897214985b59d9c4d6bab40e4bc0bb"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f402d620d8897214985b59d9c4d6bab40e4bc0bb\nparent 5856adbe1ec439bbe94e84c0b37ad72091fad4ce\nauthor Lrinc <pap.lorinc@gmail.com> 1769950968 +0100\ncommitter Lrinc <pap.lorinc@gmail.com> 1770141388 +0100\n\ncoins: simplify `HaveCoin` usages\n\nDirect `CCoinsViewDB::HaveCoin` calls aren't called in production anyway, so let's just revert to delegating to `::GetCoin`.\n\nBenchmark at this commit:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              995.62 |        1,004,398.82 |    0.9% |      1.10 | `HaveInputsOnDisk`\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmmCNswACgkQZp//D/pH\nenbykg//foqIz9ARO3ebIK7JGfC2vKAUTcP89OeGTFj7mIj89Fm6D0m/bPN/mDxk\n6B73+qZIBGjfwmY7i99qIagJBAQMJCyB2V1L3XCVqkSlQV05WxU8gG3Ic2U2e0Kt\nhY1XF/9sBNbQASLFjczmnKXeRBqwlcTRQZgaTnKAzPNxFaEYKgSYkcClsQxoCIhF\nEPyMu+UtqI70g7L67M9hYydWEMbeIX9XhQ0eMV8fwsV7xmr29LdQ0U/qlZaKoixp\n/7OGF1KGKHrLQEgECND0q3GqdCdFvjTUHX7DyUW2jPDVG0MEvINjMIpTYtvs+W3H\nuv1snrzRPq2z21DF0LjNce5nrzX40E8tjeKej5wXS6Th46YOpXo/8lAz7650xcwJ\nelSLuRRQOm4w25YO43iZFr1EwZrxWiu/bzEvvA20DL8ZSt0xKfHO6AGI38IS2LYK\nJUrm6KOdyszsWbXA+rjBCgLDK/KlW6ncuOb2Lwjrwakr5YswTG4gphVIxtxvz5Jk\nk8s4d8TYUeuximVocyHg87QKAkmX4nGUdQYTKNfhPoRCcPu3iYXL8P0okbWQXthf\nb8CWDhiwEKSpWQzid3g3Bmeh05E4uomMdPXNijve/cwrnu/8t3N9flIefFzBH7bv\n5de4XJsnmeNwq4+WfofLo00bRU4hV71hTOMX8O1rAWPj78yAvuE=\n=hq9x\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5856adbe1ec439bbe94e84c0b37ad72091fad4ce",
          "sha": "5856adbe1ec439bbe94e84c0b37ad72091fad4ce",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5856adbe1ec439bbe94e84c0b37ad72091fad4ce"
        }
      ],
      "message": "coins: simplify `HaveCoin` usages\n\nDirect `CCoinsViewDB::HaveCoin` calls aren't called in production anyway, so let's just revert to delegating to `::GetCoin`.\n\nBenchmark at this commit:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              995.62 |        1,004,398.82 |    0.9% |      1.10 | `HaveInputsOnDisk`",
      "committer": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-03T17:56:28Z"
      },
      "author": {
        "name": "Lrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-02-01T13:02:48Z"
      },
      "sha": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22504855541,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAU9ZNf1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22504855541",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "created_at": "2026-02-03T17:56:52Z"
    },
    {
      "event": "labeled",
      "id": 22506254385,
      "node_id": "LE_lADOABII587j2bERzwAAAAU9ejAx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22506254385",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-03T18:55:14Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3843080702,
      "node_id": "IC_kwDOABII587lEMH-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3843080702",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-03T18:55:22Z",
      "updated_at": "2026-02-03T18:55:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/21641577498/job/62382439018</sub>\n<sub>LLM reason ( experimental): Lint check failed: direct use of std::filesystem was flagged by the std_filesystem lint rule.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3843080702",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751741957",
      "pull_request_review_id": 3736369272,
      "id": 2751741957,
      "node_id": "PRRC_kwDOABII586kBEAF",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We should use `std::filesystem::temp_directory_path()` instead of current path, and then we don't have to cleanup.",
      "created_at": "2026-02-01T18:08:26Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751741957",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751741957"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751755475",
      "pull_request_review_id": 3736369272,
      "id": 2751755475,
      "node_id": "PRRC_kwDOABII586kBHTT",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};\n+    CCoinsViewDB db{{.path = path, .cache_bytes = 1_MiB, .memory_only = false, .wipe_data = true}, {}};\n+\n+    CBlock block;\n+    DataStream{benchmark::data::block413567} >> TX_WITH_WITNESS(block);\n+\n+    CCoinsViewCache cache{&db};\n+    cache.SetBestBlock(uint256::ONE);\n+    for (auto& tx : block.vtx | std::views::drop(1)) {\n+        for (auto& txin : tx->vin) {\n+            cache.AddCoin(txin.prevout, {{COIN, CScript()}, /*nHeightIn=*/1, /*fCoinBaseIn=*/false}, /*possible_overwrite=*/false);\n+        }\n+    }\n+    cache.Flush();\n+\n+    bench.batch(block.vtx.size() - 1).unit(\"tx\").run([&] {\n+        CCoinsViewCache view{&db}; // Recreate to avoid caching\n+        for (auto& tx : block.vtx | std::views::drop(1)) {\n+            if (view.GetCacheSize() % 10 == 0) (void)view.HaveInputs(*tx); // Exercise the cache-hit path as well.",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Why only every 10th iteration? Why not just do it every time?",
      "created_at": "2026-02-01T18:13:05Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751755475",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751755475"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751764873",
      "pull_request_review_id": 3736369272,
      "id": 2751764873,
      "node_id": "PRRC_kwDOABII586kBJmJ",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 31,
      "commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "There's nothing to move for a `COutPoint`. Some code does that erroneously, but we should not.",
      "created_at": "2026-02-01T18:16:31Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751764873",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751764873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751766997",
      "pull_request_review_id": 3736369272,
      "id": 2751766997,
      "node_id": "PRRC_kwDOABII586kBKHV",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}\n+\n+        std::optional<Coin> GetCoin(const COutPoint& out) const override\n+        {\n+            ++getcoin_calls;\n+            BOOST_CHECK(out == expected);",
      "path": "src/test/coins_tests.cpp",
      "position": 49,
      "original_position": 36,
      "commit_id": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: `BOOST_CHECK_EQUAL(out, expected);`",
      "created_at": "2026-02-01T18:17:26Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751766997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751766997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1087,
      "original_line": 1087,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751767358",
      "pull_request_review_id": 3736369272,
      "id": 2751767358,
      "node_id": "PRRC_kwDOABII586kBKM-",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}\n+\n+        std::optional<Coin> GetCoin(const COutPoint& out) const override\n+        {\n+            ++getcoin_calls;\n+            BOOST_CHECK(out == expected);\n+            return CCoinsViewBacked::GetCoin(out);\n+        }\n+\n+        bool HaveCoin(const COutPoint& out) const override\n+        {\n+            ++havecoin_calls;\n+            BOOST_CHECK(out == expected);",
      "path": "src/test/coins_tests.cpp",
      "position": 56,
      "original_position": 43,
      "commit_id": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Same as above.",
      "created_at": "2026-02-01T18:17:36Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751767358",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751767358"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1094,
      "original_line": 1094,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751783265",
      "pull_request_review_id": 3736369272,
      "id": 2751783265,
      "node_id": "PRRC_kwDOABII586kBOFh",
      "diff_hunk": "@@ -167,12 +167,13 @@ const Coin& CCoinsViewCache::AccessCoin(const COutPoint &outpoint) const {\n     }\n }\n \n-bool CCoinsViewCache::HaveCoin(const COutPoint &outpoint) const {\n-    CCoinsMap::const_iterator it = FetchCoin(outpoint);\n-    return (it != cacheCoins.end() && !it->second.coin.IsSpent());\n+bool CCoinsViewCache::HaveCoin(const COutPoint& outpoint) const\n+{\n+    return !AccessCoin(outpoint).IsSpent();",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "4166ee8f0175a440f461320165ce8cea9207c22e",
      "in_reply_to_id": null,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm not sure why we are touching this.\nThis does an extra `IsSpent()` check now on an empty coin, instead of just short circuiting at `it != cacheCoins.end()`.",
      "created_at": "2026-02-01T18:24:13Z",
      "updated_at": "2026-02-01T18:24:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2751783265",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2751783265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 172,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752025202",
      "pull_request_review_id": 3736717096,
      "id": 2752025202,
      "node_id": "PRRC_kwDOABII586kCJJy",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751741957,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Wouldn't that store the blocks in memory in [tmpfs](https://en.wikipedia.org/wiki/Tmpfs)?\r\nThough in reality after the first read it will likely be in cache already...",
      "created_at": "2026-02-01T21:59:38Z",
      "updated_at": "2026-02-01T21:59:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752025202",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752025202"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752025560",
      "pull_request_review_id": 3736717344,
      "id": 2752025560,
      "node_id": "PRRC_kwDOABII586kCJPY",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};\n+    CCoinsViewDB db{{.path = path, .cache_bytes = 1_MiB, .memory_only = false, .wipe_data = true}, {}};\n+\n+    CBlock block;\n+    DataStream{benchmark::data::block413567} >> TX_WITH_WITNESS(block);\n+\n+    CCoinsViewCache cache{&db};\n+    cache.SetBestBlock(uint256::ONE);\n+    for (auto& tx : block.vtx | std::views::drop(1)) {\n+        for (auto& txin : tx->vin) {\n+            cache.AddCoin(txin.prevout, {{COIN, CScript()}, /*nHeightIn=*/1, /*fCoinBaseIn=*/false}, /*possible_overwrite=*/false);\n+        }\n+    }\n+    cache.Flush();\n+\n+    bench.batch(block.vtx.size() - 1).unit(\"tx\").run([&] {\n+        CCoinsViewCache view{&db}; // Recreate to avoid caching\n+        for (auto& tx : block.vtx | std::views::drop(1)) {\n+            if (view.GetCacheSize() % 10 == 0) (void)view.HaveInputs(*tx); // Exercise the cache-hit path as well.",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751755475,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Isn't it more realistic if some of the data comes from cache and some from disk?",
      "created_at": "2026-02-01T22:00:11Z",
      "updated_at": "2026-02-01T22:00:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752025560",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752025560"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752035102",
      "pull_request_review_id": 3736725300,
      "id": 2752035102,
      "node_id": "PRRC_kwDOABII586kCLke",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}\n+\n+        std::optional<Coin> GetCoin(const COutPoint& out) const override\n+        {\n+            ++getcoin_calls;\n+            BOOST_CHECK(out == expected);",
      "path": "src/test/coins_tests.cpp",
      "position": 49,
      "original_position": 36,
      "commit_id": "69fa15aaad06abf7af2d24e76eeb8f417cd66a37",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": 2751766997,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I thought of that, but didn't want to add a new `std::ostream&` for `COutPoint`:\r\n```patch\r\ndiff --git a/src/test/coins_tests.cpp b/src/test/coins_tests.cpp\r\n--- a/src/test/coins_tests.cpp\t(revision 4166ee8f0175a440f461320165ce8cea9207c22e)\r\n+++ b/src/test/coins_tests.cpp\t(date 1769983694317)\r\n@@ -105,6 +105,11 @@\r\n \r\n } // namespace\r\n \r\n+std::ostream& operator<<(std::ostream& os, const COutPoint& outpoint)\r\n+{\r\n+    return os << outpoint.ToString();\r\n+}\r\n+\r\n static const unsigned int NUM_SIMULATION_ITERATIONS = 40000;\r\n \r\n struct CacheTest : BasicTestingSetup {\r\n@@ -1084,14 +1089,14 @@\r\n         std::optional<Coin> GetCoin(const COutPoint& out) const override\r\n         {\r\n             ++getcoin_calls;\r\n-            BOOST_CHECK(out == expected);\r\n+            BOOST_CHECK_EQUAL(out, expected);\r\n             return CCoinsViewBacked::GetCoin(out);\r\n         }\r\n \r\n         bool HaveCoin(const COutPoint& out) const override\r\n         {\r\n             ++havecoin_calls;\r\n-            BOOST_CHECK(out == expected);\r\n+            BOOST_CHECK_EQUAL(out, expected);\r\n             return CCoinsViewBacked::HaveCoin(out);\r\n         }\r\n     };\r\n```",
      "created_at": "2026-02-01T22:10:05Z",
      "updated_at": "2026-02-01T22:10:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752035102",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752035102"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1087,
      "original_line": 1087,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752035193",
      "pull_request_review_id": 3736725362,
      "id": 2752035193,
      "node_id": "PRRC_kwDOABII586kCLl5",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751741957,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "No, it will be on disk. In `/tmp` on Linux.",
      "created_at": "2026-02-01T22:10:12Z",
      "updated_at": "2026-02-01T22:10:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752035193",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752035193"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752037691",
      "pull_request_review_id": 3736728232,
      "id": 2752037691,
      "node_id": "PRRC_kwDOABII586kCMM7",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751741957,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "yes, isn't that using tmpfs?\r\n> Many Unix [distributions](https://en.wikipedia.org/wiki/Distribution_(software)) enable and use tmpfs by default for the [/tmp](https://en.wikipedia.org/wiki//tmp) branch of the file system or for [shared memory](https://en.wikipedia.org/wiki/Shared_memory_(interprocess_communication)).\r\n\r\nand\r\n> tmpfs (short for temporary file system) is a [temporary file](https://en.wikipedia.org/wiki/Temporary_file) storage paradigm implemented in many [Unix-like](https://en.wikipedia.org/wiki/Unix-like) operating systems. It is intended to appear as a mounted [file system](https://en.wikipedia.org/wiki/File_system), but data is stored in [volatile memory](https://en.wikipedia.org/wiki/Volatile_memory) rather than on a persistent storage device.",
      "created_at": "2026-02-01T22:13:02Z",
      "updated_at": "2026-02-01T22:13:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752037691",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752037691"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752040726",
      "pull_request_review_id": 3736731178,
      "id": 2752040726,
      "node_id": "PRRC_kwDOABII586kCM8W",
      "diff_hunk": "@@ -167,12 +167,13 @@ const Coin& CCoinsViewCache::AccessCoin(const COutPoint &outpoint) const {\n     }\n }\n \n-bool CCoinsViewCache::HaveCoin(const COutPoint &outpoint) const {\n-    CCoinsMap::const_iterator it = FetchCoin(outpoint);\n-    return (it != cacheCoins.end() && !it->second.coin.IsSpent());\n+bool CCoinsViewCache::HaveCoin(const COutPoint& outpoint) const\n+{\n+    return !AccessCoin(outpoint).IsSpent();",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "4166ee8f0175a440f461320165ce8cea9207c22e",
      "in_reply_to_id": 2751783265,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The simplification deduplicates the other `FetchCoin` + iterator, why wouldn't we reuse code here?\r\nAnd `IsSpent()` call on `coinEmpty` is just a null check, do you think that would matter anywhere?",
      "created_at": "2026-02-01T22:16:56Z",
      "updated_at": "2026-02-01T22:21:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752040726",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752040726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 172,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752043095",
      "pull_request_review_id": 3736733231,
      "id": 2752043095,
      "node_id": "PRRC_kwDOABII586kCNhX",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 31,
      "commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": 2751764873,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Because it's trivially copyable and we're in a test? Ok, made it `const COutPoint& out` like we have in `GetCoin`: https://github.com/bitcoin/bitcoin/compare/4166ee8f0175a440f461320165ce8cea9207c22e..23dd085872bc0f01309260e00cce239a9512b45e",
      "created_at": "2026-02-01T22:19:55Z",
      "updated_at": "2026-02-01T22:20:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752043095",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752043095"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752062444",
      "pull_request_review_id": 3736760002,
      "id": 2752062444,
      "node_id": "PRRC_kwDOABII586kCSPs",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 31,
      "commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": 2751764873,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Because there's nothing to move, so using std::move with it doesn't make sense.",
      "created_at": "2026-02-01T22:41:04Z",
      "updated_at": "2026-02-01T22:41:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752062444",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752062444"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752063322",
      "pull_request_review_id": 3736760619,
      "id": 2752063322,
      "node_id": "PRRC_kwDOABII586kCSda",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};\n+    CCoinsViewDB db{{.path = path, .cache_bytes = 1_MiB, .memory_only = false, .wipe_data = true}, {}};\n+\n+    CBlock block;\n+    DataStream{benchmark::data::block413567} >> TX_WITH_WITNESS(block);\n+\n+    CCoinsViewCache cache{&db};\n+    cache.SetBestBlock(uint256::ONE);\n+    for (auto& tx : block.vtx | std::views::drop(1)) {\n+        for (auto& txin : tx->vin) {\n+            cache.AddCoin(txin.prevout, {{COIN, CScript()}, /*nHeightIn=*/1, /*fCoinBaseIn=*/false}, /*possible_overwrite=*/false);\n+        }\n+    }\n+    cache.Flush();\n+\n+    bench.batch(block.vtx.size() - 1).unit(\"tx\").run([&] {\n+        CCoinsViewCache view{&db}; // Recreate to avoid caching\n+        for (auto& tx : block.vtx | std::views::drop(1)) {\n+            if (view.GetCacheSize() % 10 == 0) (void)view.HaveInputs(*tx); // Exercise the cache-hit path as well.",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751755475,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah, so if we call twice for every tx then half are coming from cache and half not?",
      "created_at": "2026-02-01T22:42:10Z",
      "updated_at": "2026-02-01T22:42:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752063322",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752063322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752073667",
      "pull_request_review_id": 3736771852,
      "id": 2752073667,
      "node_id": "PRRC_kwDOABII586kCU_D",
      "diff_hunk": "@@ -1059,6 +1061,86 @@ BOOST_FIXTURE_TEST_CASE(ccoins_flush_behavior, FlushTest)\n     }\n }\n \n+BOOST_AUTO_TEST_CASE(ccoins_haveinputs_uses_base_getcoin)\n+{\n+    const COutPoint prevout{Txid::FromUint256(m_rng.rand256()), 0};\n+\n+    CCoinsViewDB db{{.path = \"test\", .cache_bytes = 1_MiB, .memory_only = true}, {}};\n+    {\n+        CCoinsViewCache write_cache{&db};\n+        write_cache.SetBestBlock(m_rng.rand256());\n+        write_cache.AddCoin(prevout, MakeTestCoin(), /*possible_overwrite=*/false);\n+        write_cache.Flush();\n+    }\n+\n+    class CCoinsViewSpy final : public CCoinsViewBacked\n+    {\n+    public:\n+        const COutPoint expected;\n+        mutable size_t havecoin_calls{0}, getcoin_calls{0};\n+\n+        explicit CCoinsViewSpy(CCoinsView* view, COutPoint out) : CCoinsViewBacked(view), expected{std::move(out)} {}",
      "path": "src/test/coins_tests.cpp",
      "position": 1,
      "original_position": 31,
      "commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "original_commit_id": "6f533a0f3c29446b42797c08a537de743bbb226f",
      "in_reply_to_id": 2751764873,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can you please expand on that? It's not a primitive type, but it is trivially copyable which should likely be similar in speed - is that what you mean?",
      "created_at": "2026-02-01T22:53:14Z",
      "updated_at": "2026-02-01T22:53:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752073667",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752073667"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1082,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752075584",
      "pull_request_review_id": 3736774645,
      "id": 2752075584,
      "node_id": "PRRC_kwDOABII586kCVdA",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};\n+    CCoinsViewDB db{{.path = path, .cache_bytes = 1_MiB, .memory_only = false, .wipe_data = true}, {}};\n+\n+    CBlock block;\n+    DataStream{benchmark::data::block413567} >> TX_WITH_WITNESS(block);\n+\n+    CCoinsViewCache cache{&db};\n+    cache.SetBestBlock(uint256::ONE);\n+    for (auto& tx : block.vtx | std::views::drop(1)) {\n+        for (auto& txin : tx->vin) {\n+            cache.AddCoin(txin.prevout, {{COIN, CScript()}, /*nHeightIn=*/1, /*fCoinBaseIn=*/false}, /*possible_overwrite=*/false);\n+        }\n+    }\n+    cache.Flush();\n+\n+    bench.batch(block.vtx.size() - 1).unit(\"tx\").run([&] {\n+        CCoinsViewCache view{&db}; // Recreate to avoid caching\n+        for (auto& tx : block.vtx | std::views::drop(1)) {\n+            if (view.GetCacheSize() % 10 == 0) (void)view.HaveInputs(*tx); // Exercise the cache-hit path as well.",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751755475,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Not sure what you mean, if you feel strongly about doing both in every step, I don't mind, just let me know if you think that's more representative",
      "created_at": "2026-02-01T22:55:17Z",
      "updated_at": "2026-02-01T22:55:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2752075584",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2752075584"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760303170",
      "pull_request_review_id": 3746722565,
      "id": 2760303170,
      "node_id": "PRRC_kwDOABII586khuJC",
      "diff_hunk": "@@ -167,12 +167,13 @@ const Coin& CCoinsViewCache::AccessCoin(const COutPoint &outpoint) const {\n     }\n }\n \n-bool CCoinsViewCache::HaveCoin(const COutPoint &outpoint) const {\n-    CCoinsMap::const_iterator it = FetchCoin(outpoint);\n-    return (it != cacheCoins.end() && !it->second.coin.IsSpent());\n+bool CCoinsViewCache::HaveCoin(const COutPoint& outpoint) const\n+{\n+    return !AccessCoin(outpoint).IsSpent();",
      "path": "src/coins.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "4166ee8f0175a440f461320165ce8cea9207c22e",
      "in_reply_to_id": 2751783265,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Reverted, kept the formatting change.",
      "created_at": "2026-02-03T17:56:51Z",
      "updated_at": "2026-02-03T17:56:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2760303170",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760303170"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 172,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760303712",
      "pull_request_review_id": 3746723144,
      "id": 2760303712,
      "node_id": "PRRC_kwDOABII586khuRg",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};\n+    CCoinsViewDB db{{.path = path, .cache_bytes = 1_MiB, .memory_only = false, .wipe_data = true}, {}};\n+\n+    CBlock block;\n+    DataStream{benchmark::data::block413567} >> TX_WITH_WITNESS(block);\n+\n+    CCoinsViewCache cache{&db};\n+    cache.SetBestBlock(uint256::ONE);\n+    for (auto& tx : block.vtx | std::views::drop(1)) {\n+        for (auto& txin : tx->vin) {\n+            cache.AddCoin(txin.prevout, {{COIN, CScript()}, /*nHeightIn=*/1, /*fCoinBaseIn=*/false}, /*possible_overwrite=*/false);\n+        }\n+    }\n+    cache.Flush();\n+\n+    bench.batch(block.vtx.size() - 1).unit(\"tx\").run([&] {\n+        CCoinsViewCache view{&db}; // Recreate to avoid caching\n+        for (auto& tx : block.vtx | std::views::drop(1)) {\n+            if (view.GetCacheSize() % 10 == 0) (void)view.HaveInputs(*tx); // Exercise the cache-hit path as well.",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751755475,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed it to:\r\n```C++\r\n            assert(view.HaveInputs(*tx));\r\n            assert(view.HaveInputs(*tx)); // Exercise the cache-hit path as well.\r\n```",
      "created_at": "2026-02-03T17:57:00Z",
      "updated_at": "2026-02-03T17:57:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2760303712",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760303712"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 40,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760304222",
      "pull_request_review_id": 3746723630,
      "id": 2760304222,
      "node_id": "PRRC_kwDOABII586khuZe",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2026-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or https://opensource.org/license/mit/.\n+\n+#include <bench/bench.h>\n+#include <bench/data/block413567.raw.h>\n+#include <coins.h>\n+#include <consensus/amount.h>\n+#include <primitives/block.h>\n+#include <script/script.h>\n+#include <streams.h>\n+#include <txdb.h>\n+#include <util/fs.h>\n+#include <util/time.h>\n+\n+#include <cassert>\n+#include <ranges>\n+#include <system_error>\n+\n+static void HaveInputsOnDisk(benchmark::Bench& bench)\n+{\n+    const fs::path path{fs::current_path() / strprintf(\"bench-%s-%lld\", bench.name(), GetTime())};",
      "path": "src/bench/coins_haveinputs.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "23dd085872bc0f01309260e00cce239a9512b45e",
      "original_commit_id": "267af2c925618bf502adb6412ca34cba016f5cdd",
      "in_reply_to_id": 2751741957,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "On Mac this will create something like: `/var/folders/5t/04gq0pqj5yv4t8cxw51q0s2m0000gn/T/bench-HaveInputsOnDisk-1770141170` - changed.",
      "created_at": "2026-02-03T17:57:07Z",
      "updated_at": "2026-02-03T17:57:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#discussion_r2760304222",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2760304222"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320",
    "id": 3181854676,
    "node_id": "PR_kwDOABII5869pz_U",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34320",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34320.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34320.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8c568500442144fbcd457eccda5a1956aa98ca81",
    "number": 34320,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: replace remaining `HaveCoin` calls with `GetCoin`",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Split out of https://github.com/bitcoin/bitcoin/pull/34132#discussion_r2692307054.\r\n\r\n### Problem\r\n\r\nWe have two ways to check a coin exists in the db.\r\nOne tries to deserialize, the other just returns whether any value is associated with the key.\r\nBut we usually need the full value we probed for, and `HaveCoin` cannot cache the returned value, so it can trigger an extra lookup if `HaveCoin` uses `Exists` and the caller later needs the actual value.\r\nWe're already delegating most `HaveCoin` calls to `GetCoin` anyway for the above reasons, so the current implementation of `HaveCoin` is redundant.\r\n\r\n### Fix\r\n\r\nReplace `HaveCoin` calls with `GetCoin`, reuse `ReadRaw` in `dbwrapper`, stop ignoring deserialization failures, and readjust tests to this simpler state.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\nSee https://github.com/bitcoin/bitcoin/blob/cd0959ce9b7c5b80ebd45b652d557630b4dc604b/src/dbwrapper.cpp#L304-L331 and https://github.com/bitcoin/bitcoin/blob/a9b7f5614c24fe6f386448604c325ec4fa6c98a5/src/dbwrapper.h#L206-L241\r\n\r\n</details>\r\n\r\n### Notes\r\n* It seems https://github.com/bitcoin/bitcoin/pull/26331 did not fix https://github.com/bitcoin/bitcoin/issues/26112.\r\n* After this PR deserialization failures will crash the app, see https://github.com/bitcoin/bitcoin/pull/33866 for similar cleanups. This is deliberate to fail early instead of trying to recover.\r\n\r\n### Reproducers\r\nThis isn't meant as an optimization but it's important to make sure there are no regressions.\r\n\r\n<details>\r\n<summary>assumeutxo load | 910000 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | xfs | SSD</summary>\r\n\r\n```bash\r\nCOMMITS=\"0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972\"; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/ShallowBitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; UTXO_SNAPSHOT_PATH=\"$BASE_DIR/utxo-910000.dat\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done; echo \"\") && \\\r\nfor DBCACHE in 4500; do \\\r\n  (echo \"assumeutxo load | 910000 blocks | dbcache ${DBCACHE} | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM | $(df -T $BASE_DIR | awk 'NR==2{print $2}') | $(lsblk -no ROTA $(df --output=source $BASE_DIR | tail -1) | grep -q 0 && echo SSD || echo HDD)\";) &&\\\r\n  hyperfine \\\r\n  --sort command \\\r\n  --runs 3 \\\r\n  --export-json \"$BASE_DIR/assumeutxo-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$DBCACHE-$CC-$(date +%s).json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall -9 bitcoind 2>/dev/null; rm -f ./build/bin/bitcoind; rm -rf $DATA_DIR/blocks $DATA_DIR/chainstate $DATA_DIR/chainstate_snapshot $DATA_DIR/debug.log; git clean -fxd; git reset --hard {COMMIT} && \\\r\n             cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo && ninja -C build bitcoind bitcoin-cli -j2 && \\\r\n             ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -printtoconsole=0; sleep 20 && \\\r\n             ./build/bin/bitcoind -datadir=$DATA_DIR -daemon -blocksonly -connect=0 -dbcache=$DBCACHE -printtoconsole=0; sleep 20\" \\\r\n   --conclude \"build/bin/bitcoin-cli -datadir=$DATA_DIR stop || true; killall bitcoind || true; sleep 10; \\\r\n               echo '{COMMIT} | dbcache=$DBCACHE | chainstate: $(find $DATA_DIR/chainstate_snapshot -type f 2>/dev/null | wc -l) files, $(du -sb $DATA_DIR/chainstate_snapshot 2>/dev/null | cut -f1) bytes' >> $DATA_DIR/debug.log; \\\r\n               cp $DATA_DIR/debug.log $LOG_DIR/debug-assumeutxo-{COMMIT}-dbcache-$DBCACHE-$(date +%s).log\" \\\r\n    \"COMPILER=$CC DBCACHE=$DBCACHE ./build/bin/bitcoin-cli -datadir=$DATA_DIR -rpcclienttimeout=0 loadtxoutset $UTXO_SNAPSHOT_PATH\"; \\\r\ndone\r\n\r\n0ffb20dee1 Merge bitcoin/bitcoin#34282: qa: Fix Windows logging bug\r\n9b4e0448b2 coins: replace remaining `HaveCoin` calls with `GetCoin()` and remove the former\r\n\r\nassumeutxo load | 910000 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | xfs | SSD\r\n\r\nBenchmark 1: COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n  Time (mean ± σ):     414.640 s ±  4.562 s    [User: 0.001 s, System: 0.001 s]\r\n  Range (min … max):   411.946 s … 419.907 s    3 runs\r\n \r\n  Warning: Statistical outliers were detected. Consider re-running this benchmark on a quiet system without any interferences from other programs. It might help to use the '--warmup' or '--prepare' options.\r\n \r\nBenchmark 2: COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n  Time (mean ± σ):     417.815 s ±  3.844 s    [User: 0.002 s, System: 0.001 s]\r\n  Range (min … max):   413.440 s … 420.653 s    3 runs\r\n \r\nRelative speed comparison\r\n        1.00          COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n        1.01 ±  0.01  COMPILER=gcc DBCACHE=4500 ./build/bin/bitcoin-cli -datadir=/mnt/my_storage/ShallowBitcoinData -rpcclienttimeout=0 loadtxoutset /mnt/my_storage/utxo-910000.dat (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n```\r\n\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>2026-01-20 | reindex-chainstate | 932239 blocks | dbcache 450 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | SSD</summary>\r\n\r\n```bash\r\nfor DBCACHE in 450 4500; do \\                                                                                                                                     \r\n  COMMITS=\"0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972\"; \\\r\n  STOP=932239; CC=gcc; CXX=g++; \\\r\n  BASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/BitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n  (echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done) && \\\r\n  (echo \"\" && echo \"$(date -I) | reindex-chainstate | ${STOP} blocks | dbcache ${DBCACHE} | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM | $(lsblk -no ROTA $(df --output=source $BASE_DIR | tail -1) | grep -q 0 && echo SSD || echo HDD)\"; echo \"\") &&\\\r\n  hyperfine \\\r\n    --sort command \\\r\n    --runs 1 \\\r\n    --export-json \"$BASE_DIR/rdx-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$STOP-$DBCACHE-$CC.json\" \\\r\n    --parameter-list COMMIT ${COMMITS// /,} \\\r\n    --prepare \"killall -9 bitcoind 2>/dev/null; rm -f ./build/bin/bitcoind; git clean -fxd; git reset --hard {COMMIT} && \\\r\n      cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -DENABLE_IPC=OFF && ninja -C build bitcoind -j1 && \\\r\n      ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=1000 -printtoconsole=0; sleep 20; rm -f $DATA_DIR/debug.log\" \\\r\n    --conclude \"killall bitcoind || true; sleep 5; grep -q 'height=0' $DATA_DIR/debug.log && grep -q 'Disabling script verification at block #1' $DATA_DIR/debug.log && grep -q 'height=$STOP' $DATA_DIR/debug.log && grep 'Bitcoin Core version' $DATA_DIR/debug.log | grep -q \"$(printf %.12s {COMMIT})\"; \\\r\n                cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n    \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=$DBCACHE -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0\";\r\ndone\r\n\r\n0ffb20dee1 Merge bitcoin/bitcoin#34282: qa: Fix Windows logging bug\r\n9b4e0448b2 coins: replace remaining `HaveCoin` calls with `GetCoin()` and remove the former\r\n\r\n2026-01-20 | reindex-chainstate | 932239 blocks | dbcache 450 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | SSD\r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=450 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n  Time (abs ≡):        21792.702 s               [User: 50404.736 s, System: 2993.346 s]\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=450 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n  Time (abs ≡):        21806.403 s               [User: 50228.797 s, System: 3049.315 s]\r\n \r\nRelative speed comparison\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=450 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=450 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n\r\n0ffb20dee1 Merge bitcoin/bitcoin#34282: qa: Fix Windows logging bug\r\n9b4e0448b2 coins: replace remaining `HaveCoin` calls with `GetCoin()` and remove the former\r\n\r\n2026-01-21 | reindex-chainstate | 932239 blocks | dbcache 4500 | i9-ssd | x86_64 | Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz | 16 cores | 62Gi RAM | SSD\r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n  Time (abs ≡):        17483.617 s               [User: 34266.506 s, System: 941.755 s]\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n  Time (abs ≡):        17375.956 s               [User: 34053.656 s, System: 953.146 s]\r\n \r\nRelative speed comparison\r\n        1.01          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=932239 -dbcache=4500 -reindex-chainstate -blocksonly -connect=0 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>2026-01-20 | pruned IBD | 932239 blocks | dbcache 450 | pruning 550 | i7-hdd | x86_64 | Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz | 8 cores | 62Gi RAM | ext4 | HDD</summary>\r\n\r\n```\r\nCOMMITS=\"0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972\"; \\                                                      \r\nSTOP=932239; DBCACHE=450; PRUNE=550; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; DATA_DIR=\"$BASE_DIR/ShallowBitcoinData\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\n(echo \"\"; for c in $COMMITS; do git fetch -q origin $c && git log -1 --pretty='%h %s' $c || exit 1; done) && \\\r\n(echo \"\" && echo \"$(date -I) | pruned IBD | ${STOP} blocks | dbcache ${DBCACHE} | pruning ${PRUNE} | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM | $(df -T $BASE_DIR | awk 'NR==2{print $2}') | $(lsblk -no ROTA $(df --output=source $BASE_DIR | tail -1) | grep -q 0 && echo SSD || echo HDD)\"; echo \"\") &&\\\r\nhyperfine \\\r\n  --sort command \\\r\n  --runs 2 \\\r\n  --export-json \"$BASE_DIR/ibd-$(sed -E 's/(\\w{8})\\w+ ?/\\1-/g;s/-$//'<<<\"$COMMITS\")-$STOP-$DBCACHE-$CC.json\" \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall -9 bitcoind 2>/dev/null; rm -rf $DATA_DIR/*; git clean -fxd; git reset --hard {COMMIT} && \\\r\n    cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release && ninja -C build bitcoind -j2 && \\\r\n    ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=1 -prune=$PRUNE -printtoconsole=0; sleep 20\" \\\r\n  --conclude \"killall bitcoind || true; sleep 5; grep -q 'height=0' $DATA_DIR/debug.log && grep -q 'Disabling script verification at block #1' $DATA_DIR/debug.log && grep -q 'height=$STOP' $DATA_DIR/debug.log && grep 'Bitcoin Core version' $DATA_DIR/debug.log | grep -q \"$(printf %.12s {COMMIT})\"; \\\r\n              cp $DATA_DIR/debug.log $LOG_DIR/debug-{COMMIT}-$(date +%s).log\" \\\r\n  \"COMPILER=$CC ./build/bin/bitcoind -datadir=$DATA_DIR -stopatheight=$STOP -dbcache=$DBCACHE -blocksonly -prune=$PRUNE -printtoconsole=0\"\r\n\r\n0ffb20dee1 Merge bitcoin/bitcoin#34282: qa: Fix Windows logging bug\r\n9b4e0448b2 coins: replace remaining `HaveCoin` calls with `GetCoin()` and remove the former\r\n\r\n2026-01-20 | pruned IBD | 932239 blocks | dbcache 450 | pruning 550 | i7-hdd | x86_64 | Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz | 8 cores | 62Gi RAM | ext4 | HDD\r\n\r\nBenchmark 1: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/ShallowBitcoinData -stopatheight=932239 -dbcache=450 -blocksonly -prune=550 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n  Time (mean ± σ):     46504.109 s ± 107.376 s    [User: 67620.317 s, System: 4548.654 s]\r\n  Range (min … max):   46428.183 s … 46580.036 s    2 runs\r\n \r\nBenchmark 2: COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/ShallowBitcoinData -stopatheight=932239 -dbcache=450 -blocksonly -prune=550 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n  Time (mean ± σ):     46099.327 s ± 273.054 s    [User: 67100.985 s, System: 4465.216 s]\r\n  Range (min … max):   45906.249 s … 46292.406 s    2 runs\r\n \r\nRelative speed comparison\r\n        1.01 ±  0.01  COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/ShallowBitcoinData -stopatheight=932239 -dbcache=450 -blocksonly -prune=550 -printtoconsole=0 (COMMIT = 0ffb20dee17858e0f13b23fce3dd0ec06cbeb9a2)\r\n        1.00          COMPILER=gcc ./build/bin/bitcoind -datadir=/mnt/my_storage/ShallowBitcoinData -stopatheight=932239 -dbcache=450 -blocksonly -prune=550 -printtoconsole=0 (COMMIT = 9b4e0448b2cd4b0b5a3db231472a2e3d16a97972)\r\n```\r\n\r\n</details>",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2026-01-16T16:17:29Z",
    "updated_at": "2026-01-30T03:43:46Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "abe639817cc3efdb7c74ad00fde8e3227969d2ba",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "l0rinc:l0rinc/remove-HaveCoin",
      "ref": "l0rinc/remove-HaveCoin",
      "sha": "8c568500442144fbcd457eccda5a1956aa98ca81",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 283192,
        "default_branch": "master",
        "open_issues_count": 40,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-29T22:44:27Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-28T13:37:57Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5f66fca633c88700c4a71c5d5b307c8cc5575913",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38811,
        "stargazers_count": 87819,
        "watchers_count": 87819,
        "size": 302770,
        "default_branch": "master",
        "open_issues_count": 746,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-29T23:11:12Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-30T03:46:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34320"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 200,
    "deletions": 145,
    "changed_files": 15,
    "commits": 6,
    "review_comments": 0,
    "comments": 8
  },
  "events": [
    {
      "event": "labeled",
      "id": 22099797162,
      "node_id": "LE_lADOABII587j2bERzwAAAAUlQCSq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22099797162",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-16T16:17:33Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3760801609,
      "node_id": "IC_kwDOABII587gKUdJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3760801609",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-16T16:17:39Z",
      "updated_at": "2026-01-30T03:43:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34320.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34165](https://github.com/bitcoin/bitcoin/pull/34165) (coins: don't mutate main cache when connecting block by andrewtoth)\n* [#34132](https://github.com/bitcoin/bitcoin/pull/34132) (refactor: inline `CCoinsViewErrorCatcher` into `CCoinsViewDB` by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32427](https://github.com/bitcoin/bitcoin/pull/32427) ((RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store by sedited)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (✨ experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- all_caches[0]->AddCoin(outp, std::move(coin), false) in src/test/coins_tests.cpp\n- all_caches[0]->AddCoin(outp, std::move(coin), false) in src/test/coins_tests.cpp\n\n\n\n<sup>2026-01-25 15:29:30</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3760801609",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3773430088,
      "node_id": "IC_kwDOABII587g6flI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3773430088",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T15:22:55Z",
      "updated_at": "2026-01-20T15:22:55Z",
      "author_association": "MEMBER",
      "body": "> One tries to deserialize, the other just returns whether any value is associated with the key.\r\n> But we usually need the full value we probed for, and `HaveCoin` cannot cache the returned value, so it can trigger an extra lookup if `HaveCoin` uses `Exists` and the caller later needs the actual value.\r\n\r\nAre there any flamegraphs or benchmarks, to see how this affects performance?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3773430088",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3773551201,
      "node_id": "IC_kwDOABII587g69Jh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3773551201",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T15:43:13Z",
      "updated_at": "2026-01-20T15:44:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are there any flamegraphs or benchmarks, to see how this affects performance?\r\n\r\nI'm not sure what to measure exactly because the current code was already delegating to `GetCoin` in most places.\r\nThe pruned IBD and `-reindex-chainstate` and `AssumeUTXO` loading benchmarks I started haven't finished yet - but I don't expect *any* change there.\r\nIf you can describe a scenario that you would find helpful, please let me know.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3773551201",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3786631676,
      "node_id": "IC_kwDOABII587hs2n8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3786631676",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-22T20:50:56Z",
      "updated_at": "2026-01-22T20:50:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Are there any flamegraphs or benchmarks, to see how this affects performance?\r\n\r\nAdded assumeutxo load, reindex-chainstate and pruned IBD measurements to the PR description",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3786631676",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3795502194,
      "node_id": "IC_kwDOABII587iOsRy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795502194",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T20:56:43Z",
      "updated_at": "2026-01-24T20:57:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I'm not sure what to measure exactly because the current code was already delegating to GetCoin in most places.\r\n\r\nI'm not sure about this. `CCoinsViewCache::HaveCoin` seems to be the implementation that is called in all non-test places outside of `coins.cpp`, and only delegates to `GetCoin` if there's a cache miss. In `CCoinsViewCache::HaveCoin` we avoid copying `Coin`:\r\n\r\n```C++\r\nbool CCoinsViewCache::HaveCoin(const COutPoint &outpoint) const {\r\n    CCoinsMap::const_iterator it = FetchCoin(outpoint);\r\n    return (it != cacheCoins.end() && !it->second.coin.IsSpent());\r\n}\r\n```\r\n\r\nvs `CCoinsViewCache::GetCoin` where we return a copy of `Coin`:\r\n\r\n```C++\r\nstd::optional<Coin> CCoinsViewCache::GetCoin(const COutPoint& outpoint) const\r\n{\r\n    if (auto it{FetchCoin(outpoint)}; it != cacheCoins.end() && !it->second.coin.IsSpent()) return it->second.coin;\r\n    return std::nullopt;\r\n}\r\n```",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3795502194",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "commented",
      "id": 3795574265,
      "node_id": "IC_kwDOABII587iO935",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795574265",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T21:38:02Z",
      "updated_at": "2026-01-24T23:03:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "> we usually need the full value we probed for, and HaveCoin cannot cache the returned value, so it can trigger an extra lookup if HaveCoin uses Exists and the caller later needs the actual value.\r\n\r\nI see 4 uses of `HaveCoin`\r\n1. In `ConnectBlock`, we ensure we do not already have outputs of a block for BIP30 checks.\r\n2. In `ApplyTxInUndo`, we ensure we do not already have the coin we are about to roll back to unspent.\r\n3. In `MemPoolAccept::PreChecks`, where we check that we have all inputs of a tx we are accepting to the mempool.\r\n4. In `TxVerify`, where we call `HaveInputs`.\r\n\r\nFor 1 and 2, we are checking for the non-existence of the coin so we won't need the full value. In this case not caching the value makes sense.\r\nFor 3, it is explicitly relying on the fact that the value is cached. The backend is thrown away after all input prevouts are added to the top level cache.\r\nFor 4, it is a peformance improvement that the value is cached.\r\n\r\nI think 1 and 2 would benefit from `CCoinsViewCache::HaveCoin` delegating to the base's `HaveCoin` and not going through `FetchCoin`.\r\nFor 3 this seems like an abuse of the `CCoinsView` API. But, calling `GetCoin` instead there would result in unnecessary copying of the `Coin`. I'm not sure what the best solution is here.\r\nFor 4 the current behavior makes sense.\r\n",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3795574265",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM1NDRiOTg5MjcwNTA5NTZmNjhjYjE4M2JmMjY4NmY1YzY1ZTVlYmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3544b98927050956f68cb183bf2686f5c65e5ebb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3544b98927050956f68cb183bf2686f5c65e5ebb",
      "tree": {
        "sha": "bb2f47fca90668d516e6244eb4211e9ccf24ac83",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bb2f47fca90668d516e6244eb4211e9ccf24ac83"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bb2f47fca90668d516e6244eb4211e9ccf24ac83\nparent 5f66fca633c88700c4a71c5d5b307c8cc5575913\nauthor Lőrinc <pap.lorinc@gmail.com> 1769349649 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354355 +0100\n\nbench: add on-disk `HaveInputs` benchmark\n\n`CCoinsViewCache::HaveInputs()` is used by `Consensus::CheckTxInputs()` and currently exercises the `HaveCoin()` path in the UTXO cache.\nThis will change in a follow-up commit and could affect performance due to `Coin` copying and different cache warming behavior.\n\nAdd a benchmark to track `HaveInputs()` throughput before and after the `HaveCoin()` removals in this series to make sure the performance is retained.\nThe benchmark populates an on-disk `CCoinsViewDB` with dummy unspent coins for all block inputs and then calls `HaveInputs()` for each non-coinbase transaction using a fresh `CCoinsViewCache` (to avoid cross-iteration caching).\nIt also occasionally calls `HaveInputs()` twice to exercise the cache-hit path.\n\nBenchmark baseline:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              998.95 |        1,001,046.69 |    0.8% |      1.09 | `HaveInputsOnDisk`\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2NHMACgkQZp//D/pH\nenaYbg//fSRAr36x6eIdTazspP+SU/bLY6G29UdatlrmznxhdJ7D5HSblLUfx7Wd\nKThqMY+ZFZycxaU1qkdHZUO/5pyenvdtkAtfeXLFVrD5xnNy/zG1oC651wUEPshR\nUGDk0fMm0/mba7/abuOswtC5Wx2yRXOm0c/3qQyVBbuJUjm6iYB85qh9EoYrYzmJ\nIdvTSTHFjj9RPmCn1z95Uhb2tJnWftYyDi1aPx3cJYTR+tZofdzJQVLC4rQa6ij1\nTZyHjizhb00MtRN5VdxasRTpP+S3RTzzJRnez5ArqpQM9ZkU9FBFoGTH88XYxdZ5\nTR7A0aUA/JBwWMfAcC1b+2srJaWA1pOX7+qqtwXJbiI/Rmk0PEMyd/ksIVltDY71\nIU3Tp17aLt8ZaS8+ASZCmM3b5wcRNgp8ZnVHNmbzWjZdvOH9gcyytrBTZBthSuzQ\nZ2lFmz2d+IJqcQHHQkypqRbhIwgBuS82XsKh0YFvfwBHlA3GR+aCzbyCnuGX4NgV\nzGO+KG92eZ1Qrbf6kmV7YgSBKcoZ+0g792AcEAjby0nlnjbaC7rAB4/bBBOEAqM6\nuGm3ZUHaRrEwQbyW+Zkpy7OJEexNUM9dWEA9X+3gVlB75XVh5a+aQ5DP+gAGbm91\nKQOV9umAtO7ZO5RnMlTKeD0GTxHuaPYgCPHYoj6HhbW2whuKxOc=\n=/RlJ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5f66fca633c88700c4a71c5d5b307c8cc5575913",
          "sha": "5f66fca633c88700c4a71c5d5b307c8cc5575913",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5f66fca633c88700c4a71c5d5b307c8cc5575913"
        }
      ],
      "message": "bench: add on-disk `HaveInputs` benchmark\n\n`CCoinsViewCache::HaveInputs()` is used by `Consensus::CheckTxInputs()` and currently exercises the `HaveCoin()` path in the UTXO cache.\nThis will change in a follow-up commit and could affect performance due to `Coin` copying and different cache warming behavior.\n\nAdd a benchmark to track `HaveInputs()` throughput before and after the `HaveCoin()` removals in this series to make sure the performance is retained.\nThe benchmark populates an on-disk `CCoinsViewDB` with dummy unspent coins for all block inputs and then calls `HaveInputs()` for each non-coinbase transaction using a fresh `CCoinsViewCache` (to avoid cross-iteration caching).\nIt also occasionally calls `HaveInputs()` twice to exercise the cache-hit path.\n\nBenchmark baseline:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              998.95 |        1,001,046.69 |    0.8% |      1.09 | `HaveInputsOnDisk`",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:19:15Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T14:00:49Z"
      },
      "sha": "3544b98927050956f68cb183bf2686f5c65e5ebb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQzZWNlYTFmYTg3MzNmZWZkZjQxN2E5YTZjZTE0MGE2N2FiNWE3OWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/43ecea1fa8733fefdf417a9a6ce140a67ab5a79f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/43ecea1fa8733fefdf417a9a6ce140a67ab5a79f",
      "tree": {
        "sha": "2d787d1139a1cb48ec959f772c8961a4c01dcfe6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2d787d1139a1cb48ec959f772c8961a4c01dcfe6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2d787d1139a1cb48ec959f772c8961a4c01dcfe6\nparent 3544b98927050956f68cb183bf2686f5c65e5ebb\nauthor Lőrinc <pap.lorinc@gmail.com> 1768430604 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354355 +0100\n\ntest: add `HaveInputs` call-path unit tests\n\nAdd unit tests covering `CCoinsViewCache::HaveInputs()`.\n\nThe tests document that `HaveInputs()` consults the cache first and that a cache miss pulls from the backing view via `GetCoin()`.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2NHMACgkQZp//D/pH\nenb6GA//cC2NMrcmT/FWUmPxTLoHDjoDH6qSyQk1a6Pji7MGnjmTuKxOQJ8Lukaj\nEjwLTkOpIdmV8sUbVjRB3LKSoOaShNfQQSloY6vCxCTNNLlc5QlUxsJKwuOUcxoA\nuZkwFazIHh2H9afwB5wi3/EUQXXqrCdGJfdLt2XSJ5LDT+8Kp1WWNrhLSb93nhvg\ntqvQWLlMfACZ2vRAdnbct71JlhAy6EguRs89F2trQG3GnDt44S3aaEnjoKNq/oDm\nm6io1JSAMcuCiZkL1wB/saAh6NEvjznImHrIHwAoVoDDMb/k51XHhZVN9GQuya1v\n0nd1eozymHcWkGB+57BlIOE883xO+bCtVPmxztTkqOln4syEvF6VdOpsFI0i1aFo\n4k+Iu1RUdt8TvFkX4aySYKLDYnuKNnQkqkljZ/z1smnu1GjlPnBLqj5wZHPNR+YA\njdsKaEQwP54h9WosqKR0ymD94gBjZhIUUAYqhEIuqZZBEjSAQZeHLONipSgUwTqS\n3Tcs7HB0b8dSxS2ZgJZSHSLkhZY/gHSn6AyIKsJsC+OGvIgnB06AYCMnB2PmqKM7\nypYk3Yf9RpZ6592I+MUMzXIXhTA+9rrk6TeRvJ/pWUZj7vCPEcLTD+P/CtOSl07S\ncobzOurdRME2wma8Y/2kVobGglnVwylXCDGYG0yxiBug/pJe9rI=\n=F18d\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3544b98927050956f68cb183bf2686f5c65e5ebb",
          "sha": "3544b98927050956f68cb183bf2686f5c65e5ebb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3544b98927050956f68cb183bf2686f5c65e5ebb"
        }
      ],
      "message": "test: add `HaveInputs` call-path unit tests\n\nAdd unit tests covering `CCoinsViewCache::HaveInputs()`.\n\nThe tests document that `HaveInputs()` consults the cache first and that a cache miss pulls from the backing view via `GetCoin()`.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:19:15Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-14T22:43:24Z"
      },
      "sha": "43ecea1fa8733fefdf417a9a6ce140a67ab5a79f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE2NDU2NmNiN2I0ZmJmZjY0Y2M3YTcxZTg3ZjE5MWFlOWNkYmNkMWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e",
      "tree": {
        "sha": "7702f990eff2c79a331493947398e67e5f1b639e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7702f990eff2c79a331493947398e67e5f1b639e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7702f990eff2c79a331493947398e67e5f1b639e\nparent 43ecea1fa8733fefdf417a9a6ce140a67ab5a79f\nauthor Lőrinc <pap.lorinc@gmail.com> 1768430848 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354355 +0100\n\ndbwrapper: let `Read` throw on deserialization failure\n\nWhen `CDBWrapper::Read()` fails deserialization we silently return `false`, which makes decode failures indistinguishable from missing keys.\n\nDrop the catch so deserialization errors fail fast.\nThis is in line with other recent changes where we're not trying to recover from database failures - and to make this explicit, see: https://github.com/bitcoin/bitcoin/pull/33866\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2NHMACgkQZp//D/pH\nena3AA/8DkwC0Z1Ipn7jl8Eoc6uw34BO+Tv022/xJwH95M9N435T3aD07lVNfRUG\nUQJcfLd0KLFK0jBJgo9nujIKVNK6ALIrW23tWacIgUrGDR5T2c/NtCXjRQi3io/Y\n0zSrfOmOwLFYC/Xwk+1nLFmXPeh2cDm1CIIkRkROPoAQte9qcBkZXgoDz7brLJfr\nM405QdVrf7GWgTQ0KXVQfEf7ru1+IQeB/0mxEJg7F2C22103Krb5IMV63CWOWCkY\ntmMcxFVNSbPNZu/s7FV/34Mw1ruASbBIjNuhKUFFZmC0AHx4j3puTQFsQoJISyGj\nWoQNLTG/JtMxF3FwXK7tjM9FiJ24KnOzluTQTVa2UDzwzgy1Kbc/XGGoWtdR8dIV\nDUzENLbSH4etBSVJW8nB7WZmFQRV6ZOWinKMYEoxyRZ8D4d/N5K6QOqNoE8J2sNU\n0aHzBh+4ckhtiBOH0hWzQcwAh8QxNjFSU+5xAPXu9HtXJ4EZdpoZCV9m2zylb5mu\nyRxuqJM2h0f5pun5mnOipbGBQ66yjmONBah/av7oH/QnKQh9BLlaDGnI9DrXXFWb\nfJIyUy8TztoP5/geZOKk05Pj44qFbXOxzds/UXbXoBcnn+zX7ZTjGPiObKtN8kJd\nUcxdnCaAq4kmXV421CKC2uMB9/taOAqo47fS3971mhj4FyYFLVg=\n=iEEj\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/43ecea1fa8733fefdf417a9a6ce140a67ab5a79f",
          "sha": "43ecea1fa8733fefdf417a9a6ce140a67ab5a79f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/43ecea1fa8733fefdf417a9a6ce140a67ab5a79f"
        }
      ],
      "message": "dbwrapper: let `Read` throw on deserialization failure\n\nWhen `CDBWrapper::Read()` fails deserialization we silently return `false`, which makes decode failures indistinguishable from missing keys.\n\nDrop the catch so deserialization errors fail fast.\nThis is in line with other recent changes where we're not trying to recover from database failures - and to make this explicit, see: https://github.com/bitcoin/bitcoin/pull/33866",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:19:15Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-14T22:47:28Z"
      },
      "sha": "164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJkZWQ0MTM0ZTAyZWRlNzFiMDgxYzUxZWQxZmU4ZTJlZGMyOTA5MDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bded4134e02ede71b081c51ed1fe8e2edc290909",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bded4134e02ede71b081c51ed1fe8e2edc290909",
      "tree": {
        "sha": "6933b178d8f472e69d09422fd61694c371eefeea",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6933b178d8f472e69d09422fd61694c371eefeea"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6933b178d8f472e69d09422fd61694c371eefeea\nparent 164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e\nauthor Lőrinc <pap.lorinc@gmail.com> 1768430928 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354355 +0100\n\ndbwrapper: have `Read` and `Exists` reuse `ReadRaw`\n\n`CDBWrapper::Exists()` and `::ReadRaw()` both issue a LevelDB `::Get`.\nIntroduce a small helper returning the raw value bytes (as `std::string`) for a given key.\nMove `Exists` closer to the read methods.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2NHMACgkQZp//D/pH\nenaUKA/+O/JnyUIFIZNaKntXZoQtDS/476U2uG6WEAo0bySQ2/yjD1YazboZaMAO\n/T6X3vpzQiN4uAFQZBlVSwM1ajoSnOKdGwkGniCcH6/VI4iaYTp5RUAx5KM1douT\nofMABW3x0kP/x6rtSBW0NbDJRC06G3kM1PHHf/ksOeI8tIv7dc8uIFTlmICNwPK5\nm5rBd4Cixri4VGuTccLcoWYh6wW3fUSSBimz9mGsKu7irOMz/31TcEnS0ojdVpKO\nPm9s3IeZlv2GMN7SDYHP7q7TyYQgnIa4d05Ic1EysCdMLcu14puRTYkHUShkBuGy\n3fBFzpuSIapWBsq1yO8dvv9MmaQU5daLgWXAMnk99u0Ed1jYSlpUB0KV2GND9+8r\nvjN+IN40VRFgnFaYdvBFRhGE0A6qMSTYq9eO8/EwxxTwDv6nzp1aQjYQvYygd9do\nXoEDSV9HtVtyvGs4x2R2F4RWV4pY/GTS4pausEZiFxe6SI+WlJ03QbG16ucQBqkH\np+tLYsu8DRrGWg/vUM3/7CvX54tGAHDR60vIJ1slcdlKKnT6Z3AaTC+iBUKDupoN\nyB7ZHUml6lRjT9El0IAMf6lkTmLbumySP3BqwM0eUIUiTriezntn1h+mOcVy699O\niBRYjFKuWYqhV9KqCJ/tg+e8wmsebR0Wgyabe6/3ORxuoGXFYCU=\n=HM95\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e",
          "sha": "164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/164566cb7b4fbff64cc7a71e87f191ae9cdbcd1e"
        }
      ],
      "message": "dbwrapper: have `Read` and `Exists` reuse `ReadRaw`\n\n`CDBWrapper::Exists()` and `::ReadRaw()` both issue a LevelDB `::Get`.\nIntroduce a small helper returning the raw value bytes (as `std::string`) for a given key.\nMove `Exists` closer to the read methods.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:19:15Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-14T22:48:48Z"
      },
      "sha": "bded4134e02ede71b081c51ed1fe8e2edc290909"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZiNGYxNmFjOWUxY2RhMDZkNGUzOGY2M2EyMGY2MThlZGY4MjRhNzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6b4f16ac9e1cda06d4e38f63a20f618edf824a76",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6b4f16ac9e1cda06d4e38f63a20f618edf824a76",
      "tree": {
        "sha": "713e265f9af179128fe128c282143ba725880fc9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/713e265f9af179128fe128c282143ba725880fc9"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 713e265f9af179128fe128c282143ba725880fc9\nparent bded4134e02ede71b081c51ed1fe8e2edc290909\nauthor Lőrinc <pap.lorinc@gmail.com> 1768493494 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354356 +0100\n\ntest: use `GetCoin` in coins cache tests\n\nSimplify existence checks in coins-related tests.\nSeparated this from the production code changes since the usages here are just for convenience, not correctness.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2NHQACgkQZp//D/pH\nenZmXRAApmj16HRFjggyFw9LRPaNvJYqLx0vk6RhyTZUBzHCPZzeInEpqmCu28K5\nKGtqZNgKwAc5lua8P1wEJKnAqY05KVa2D5/qrXLM2DwPhTtFHCckZ1RM1/cYBGdJ\nxHvtn1LRDzB8E9puIB573yl99I/Y0SaPR2nKj54PINiD0LqCm+oB8Qu/0gCm7V9x\nPZbWPUrxZYon5qfxub81VebZYmsIXaoehMeaJK12K4yw64vP7r67NruVOFsgRlMP\nT80pKSVb11Q+3MoknA6eJL/f2G7M6uio0wrjEUcQ47bRhbfZRTmVB92TJd0Fg05f\n3pWH08ZVAMYQlX5IoAZtePy4tHTNpI8n+3DWv2nQgwiNgHcZI+LwWwFT6B1HufYt\nyz95o+G+UhQOuvUIcyiEE2A/UBkrn0exgEaln3XWeMSJRTUNXBLfLPUbsryPbxJZ\nR0/KElYwul55qr4kjznmZvgfZl5aBLxsvnVJwKsV5XGrsdTBIZ4qPMov1qTvaZDE\n624Fk0EMuxYgOD1uYTck+0XQikeoz5MfQ3ssPt7AmBa/NH5Cq3sKHBg9huOadzrI\ngOdf8qEuY30/HXxSSjMHZa29WFldbAMh5cISk5caA5ohyaIt0G2FlxrrMSE0aw1A\nFQwn0ewpEB8bxi2TPYs3cY2/2cioutlNJpZEC2Sm2xANUD1fS7I=\n=iaHm\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bded4134e02ede71b081c51ed1fe8e2edc290909",
          "sha": "bded4134e02ede71b081c51ed1fe8e2edc290909",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bded4134e02ede71b081c51ed1fe8e2edc290909"
        }
      ],
      "message": "test: use `GetCoin` in coins cache tests\n\nSimplify existence checks in coins-related tests.\nSeparated this from the production code changes since the usages here are just for convenience, not correctness.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:19:16Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-15T16:11:34Z"
      },
      "sha": "6b4f16ac9e1cda06d4e38f63a20f618edf824a76"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhjNTY4NTAwNDQyMTQ0ZmJjZDQ1N2VjY2RhNWExOTU2YWE5OGNhODE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8c568500442144fbcd457eccda5a1956aa98ca81",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8c568500442144fbcd457eccda5a1956aa98ca81",
      "tree": {
        "sha": "3ad2a3559453d0b74b053974a7ea9b0c1dbc7525",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3ad2a3559453d0b74b053974a7ea9b0c1dbc7525"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3ad2a3559453d0b74b053974a7ea9b0c1dbc7525\nparent 6b4f16ac9e1cda06d4e38f63a20f618edf824a76\nauthor Lőrinc <pap.lorinc@gmail.com> 1768494018 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1769354862 +0100\n\ncoins: replace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\n\n`HaveCoin` duplicated `GetCoin()` semantics and added another confusing UTXO API surface.\nThe remaining call sites were BIP30 checks in `ConnectBlock`, `ApplyTxInUndo`, mempool `PreChecks`, and `HaveInputs` in `CheckTxInputs`.\nFor BIP30 and undo, `GetCoin()` short-circuits on not-found path, without deserialization, and the rare present-coin case already fails.\nFor mempool `PreChecks` and `HaveInputs`, `GetCoin()` still uses `FetchCoin`, so cache-warming behavior is preserved and the coin isn't needlessly copied.\n\nBenchmark at this commit:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              983.17 |        1,017,118.55 |    0.3% |      1.10 | `HaveInputsOnDisk`\n\nCo-authored-by: andrewtoth <andrewstoth@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAml2Nm4ACgkQZp//D/pH\nenYtog/+MiIKf1C5yUi3nqpn33iH9sIrPw0o11sh47KZ2U2tJIoCOyViuK4qQmgO\ntjUOutizHtBUL6G9mhB2W3Suofha431mBKOyKGdl0zhkrvDzDO/KvcgoKdj8SDWE\n6ThBSy7fdivcclLD/ULPu6fTnuXa65h6PPTTfm/fk+rqRbsNBvs5Hrw5frSyQE5I\necJQZ5ElThkZHPQKjD7YW4vEmU1TCa7pba42DpS76ssMOeopMXt5idCaRLzk8my0\nKx9hcnF3/o0XfhOD+qVAS6SecSGn7rD9mKZ9gFJ8E4o8UcZLqg2MTHzg83VhW3bU\nrDM9Z2urc4VQKo6vP72Fb3+2TPFO67v78wto6uCBT+lFwR6vkj8eUFdVzbJ9TIyV\n76EyPNJFf58q3Rf+L0GPhLEDrkxtjgMLCqOvAFbLpsOiKYl0eEf3LQe6qutnX1eL\nLB/QXlrfGvUuPBRbwQ78P2U4B4aXveq1PhDUNoNb7VVoRNvrP+EJbj17PwNwlSbP\nIRCVDrIV3d0dsYktv/JLKAND3h3FmeKidrr4v960pXu0/l+zx1Jv3BNYo8Z9WBJA\n4t8RORe6AzYm/BGTlvnXji5JY11xfmPRjofHqHu/ss5YA5FIQowsgTHzR9inEb9I\nGIBJTwML03+5dkXV5inLko//27mPioSHPCtQ6xCn7olZ4r14Q00=\n=X5Wu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6b4f16ac9e1cda06d4e38f63a20f618edf824a76",
          "sha": "6b4f16ac9e1cda06d4e38f63a20f618edf824a76",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6b4f16ac9e1cda06d4e38f63a20f618edf824a76"
        }
      ],
      "message": "coins: replace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\n\n`HaveCoin` duplicated `GetCoin()` semantics and added another confusing UTXO API surface.\nThe remaining call sites were BIP30 checks in `ConnectBlock`, `ApplyTxInUndo`, mempool `PreChecks`, and `HaveInputs` in `CheckTxInputs`.\nFor BIP30 and undo, `GetCoin()` short-circuits on not-found path, without deserialization, and the rare present-coin case already fails.\nFor mempool `PreChecks` and `HaveInputs`, `GetCoin()` still uses `FetchCoin`, so cache-warming behavior is preserved and the coin isn't needlessly copied.\n\nBenchmark at this commit:\n|               ns/tx |                tx/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|              983.17 |        1,017,118.55 |    0.3% |      1.10 | `HaveInputsOnDisk`\n\nCo-authored-by: andrewtoth <andrewstoth@gmail.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-25T15:27:42Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2026-01-15T16:20:18Z"
      },
      "sha": "8c568500442144fbcd457eccda5a1956aa98ca81"
    },
    {
      "event": "commented",
      "id": 3796835980,
      "node_id": "IC_kwDOABII587iTx6M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3796835980",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-25T15:28:29Z",
      "updated_at": "2026-01-25T16:28:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "> only delegates to GetCoin if there's a cache miss. In CCoinsViewCache::HaveCoin we avoid copying Coin\r\n\r\nDisassembly with separate translation units indicates `GetCoin()` does a new + memcpy of the Coin and the caller immediately deletes it, even when only checking `.has_value()`. `HaveCoin()` does indeed avoid it, but the extra copy only happens on the unexpectedly-present coin path, since if it's expected, we usually want to cache it. If we want to avoid the extra copy, we can use `AccessCoin`, but we would duplicate the spentness check.\r\n\r\n> In this case not caching the value makes sense.\r\n\r\nBut there's nothing to cache since these will return an empty optional. For BIP30 and `ApplyTxInUndo` the missing-coin path dominates, so `GetCoin()` short-circuits on `Read()` failure without deserialization, so I/O is the same as `Exists()`, no coin-copy happens (and when it does we crash or reorg anyway). But given that validation until bip30-end takes less than 3 minutes on my benchmarking server (see https://github.com/bitcoin/bitcoin/pull/33817), I'd say it's irrelevant either way.\r\n\r\n> For 3 this seems like an abuse of the CCoinsView API. But, calling GetCoin instead there would result in unnecessary copying of the Coin. I'm not sure what the best solution is here.\r\n\r\nThis is a good point, the disassembly indicates there's no devirtualization and no inlining in `CCoinsViewCache::HaveInputs` and `MemPoolAccept::PreChecks`, so the copy is real - though a lot faster than disk access, so it's not actually measurable.\r\nWe can use `AccessCoin` here and with explicit `IsSpent` call instead which would avoid the call (according to the assembly):\r\n```C++\r\nif (AccessCoin(tx.vin[i].prevout).IsSpent()) {\r\n```\r\nand\r\n```C++\r\nif (m_view.AccessCoin(txin.prevout).IsSpent()) {\r\n```\r\n\r\n----\r\n\r\nI have added a new benchmark as a first commit to check the performance of on-disk `HaveInputs` to make sure the performance is retained.\r\n\r\nBenchmark baseline:\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              998.95 |        1,001,046.69 |    0.8% |      1.09 | `HaveInputsOnDisk`\r\n\r\nBenchmark with `!GetCoin()` instead of `HaveCoin`:\r\n\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              985.57 |        1,014,640.63 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\nReplace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\r\n\r\n|               ns/tx |                tx/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              983.17 |        1,017,118.55 |    0.3% |      1.10 | `HaveInputsOnDisk`\r\n\r\n(ran it 5 times for each commit and copied the fastest (with smallest noise). The small difference is reproducible, but not very important as long as it's not measurably slower)\r\n\r\n<details>\r\n<summary>Benchmarking script and results on Linux</summary>\r\n\r\n```bash\r\nfor commit in 3544b98927050956f68cb183bf2686f5c65e5ebb 8c568500442144fbcd457eccda5a1956aa98ca81; do \\                                        \r\n    git fetch origin $commit >/dev/null 2>&1 && git checkout $commit >/dev/null 2>&1 && echo \"\" && git log -1 --pretty='%h %s' && \\\r\n    rm -rf build >/dev/null 2>&1 && cmake -B build -DBUILD_BENCH=ON -DCMAKE_BUILD_TYPE=Release >/dev/null 2>&1 && \\\r\n    cmake --build build -j$(nproc) >/dev/null 2>&1 && \\\r\n    for _ in $(seq 5); do \\\r\n      sleep 5; \\\r\n      ./build/bin/bench_bitcoin -filter='HaveInputsOnDisk' -min-time=1000; \\\r\n    done; \\\r\ndone\r\n```\r\nresulting in\r\n> 3544b98927 bench: add on-disk `HaveInputs` benchmark\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,137.20 |          467,902.92 |    0.0% |       16,874.42 |        7,673.54 |  2.199 |       2,895.01 |    0.8% |      1.09 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,153.41 |          464,380.56 |    0.0% |       16,873.94 |        7,729.93 |  2.183 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,148.36 |          465,471.81 |    0.1% |       16,873.92 |        7,709.74 |  2.189 |       2,894.98 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,150.10 |          465,095.33 |    0.1% |       16,873.85 |        7,718.44 |  2.186 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,135.95 |          468,175.11 |    0.0% |       16,874.21 |        7,669.12 |  2.200 |       2,894.99 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n> 8c56850044 coins: replace remaining `HaveCoin` calls with `GetCoin()`/`AccessCoin` and remove the former\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,120.50 |          471,586.34 |    0.0% |       16,874.75 |        7,611.58 |  2.217 |       2,897.27 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,178.86 |          458,955.50 |    0.5% |       16,875.34 |        7,821.05 |  2.158 |       2,897.29 |    1.0% |      1.08 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,153.54 |          464,352.06 |    0.0% |       16,875.12 |        7,731.71 |  2.183 |       2,897.26 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,137.40 |          467,857.52 |    0.0% |       16,875.16 |        7,673.32 |  2.199 |       2,897.26 |    0.8% |      1.10 | `HaveInputsOnDisk`\r\n\r\n|               ns/tx |                tx/s |    err% |          ins/tx |          cyc/tx |    IPC |         bra/tx |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|            2,135.08 |          468,365.96 |    0.0% |       16,875.23 |        7,663.44 |  2.202 |       2,897.27 |    0.8% |      1.11 | `HaveInputsOnDisk`\r\n\r\n</details>",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3796835980",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22274900599,
      "node_id": "HRFPE_lADOABII587j2bERzwAAAAUvsAJ3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22274900599",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8c568500442144fbcd457eccda5a1956aa98ca81",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/8c568500442144fbcd457eccda5a1956aa98ca81",
      "created_at": "2026-01-25T15:28:30Z"
    },
    {
      "event": "commented",
      "id": 3815084392,
      "node_id": "IC_kwDOABII587jZZFo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3815084392",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-29T02:37:26Z",
      "updated_at": "2026-01-29T02:37:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "> If we want to avoid the extra copy, we can use AccessCoin, but we would duplicate the spentness check.\r\n\r\nThis tells us that `HaveCoin` is the right level of abstraction then, and is a useful method, no?\r\n\r\n> In this case not caching the value makes sense.\r\n>>But there's nothing to cache since these will return an empty optional\r\n\r\nSame as above.\r\n\r\n> We can use AccessCoin here and with explicit IsSpent call instead which would avoid the call (according to the assembly)\r\n\r\nI think everywhere we use AccessCoin we assert the unspentness. This would now break that pattern and use AccessCoin to check existence via spentness. I think HaveCoin conveys intent better here.\r\n\r\nCan we instead just remove HaveCoin on the db then, and the default implementation would just forward to `!!GetCoin` for it?",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34320#issuecomment-3815084392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34320"
    }
  ],
  "comments": []
}
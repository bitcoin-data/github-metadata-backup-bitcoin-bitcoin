{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497",
    "id": 2519262912,
    "node_id": "PR_kwDOABII586WKObA",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32497",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32497.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32497.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/3dd815f048c80c9a35f01972e0537eb42531aec7",
    "number": 32497,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "merkle: pre‑reserve leaves to prevent reallocs with odd vtx count",
    "user": {
      "login": "l0rinc",
      "id": 1841944,
      "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/l0rinc",
      "html_url": "https://github.com/l0rinc",
      "followers_url": "https://api.github.com/users/l0rinc/followers",
      "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
      "organizations_url": "https://api.github.com/users/l0rinc/orgs",
      "repos_url": "https://api.github.com/users/l0rinc/repos",
      "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/l0rinc/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "#### Summary\r\n\r\n`ComputeMerkleRoot` [duplicates the last hash](https://github.com/bitcoin/bitcoin/blob/39b6c139bd6be33699af781f1d71f6fed303d468/src/consensus/merkle.cpp#L54-L56) when the input size is odd. If the caller provides a `std::vector` whose capacity equals its size, that extra `push_back` forces a reallocation, doubling its capacity (causing peak memory usage of 3x the necessary size).\r\n\r\nThis affects roughly half of the created blocks (those with odd transaction counts), causing unnecessary memory fragmentation during every block validation.\r\n\r\n#### Fix\r\n\r\n* Pre-reserves vector capacity to account for the odd-count duplication using `(size + 1) & ~1ULL`.\r\n    * This syntax produces [optimal assembly](https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2553107836) across x86/ARM and 32/64-bit platforms for GCC & Clang.\r\n* Eliminates default construction of `uint256` objects that are immediately overwritten by switching from `resize` to `reserve` + `push_back`.\r\n\r\n#### Memory Impact\r\n\r\n[Memory profiling](https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3563724551) shows **50% reduction in peak allocation** (576KB → 288KB) and elimination of reallocation overhead.\r\n\r\n#### Validation\r\n\r\nThe benchmark was updated to use an odd leaf count to demonstrate the real-world scenario where the reallocation occurs.\r\n\r\nA full `-reindex-chainstate` up to block **896 408** ran without triggering the asserts.\r\n\r\n<details>\r\n<summary>Validation asserts</summary>\r\n\r\nTemporary asserts (not included in this PR) confirm that `push_back` never reallocates and that the coinbase witness hash remains null:\r\n```cpp\r\nif (hashes.size() & 1) {\r\n    assert(hashes.size() < hashes.capacity()); // TODO remove\r\n    hashes.push_back(hashes.back());\r\n}\r\n\r\nleaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even\r\nleaves.emplace_back();\r\nassert(leaves.back().IsNull()); // TODO remove\r\n```\r\n\r\n</details>\r\n\r\n#### Benchmark Performance\r\n\r\nWhile the main purpose is to improve predictability, the reduced memory operations also improve hashing throughput slightly.\r\n",
    "labels": [],
    "created_at": "2025-05-14T13:01:42Z",
    "updated_at": "2026-01-20T23:47:27Z",
    "closed_at": "2026-01-20T23:47:26Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2026-01-20T23:47:26Z",
    "merged_by": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "merge_commit_sha": "8c07800b193e94740a20f40d3e7c6626a59dd21f",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "l0rinc:l0rinc/pre‑reserve-merkle-leaves-to-max",
      "ref": "l0rinc/pre‑reserve-merkle-leaves-to-max",
      "sha": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 674169038,
        "node_id": "R_kgDOKC8Azg",
        "name": "bitcoin",
        "full_name": "l0rinc/bitcoin",
        "owner": {
          "login": "l0rinc",
          "id": 1841944,
          "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/l0rinc",
          "html_url": "https://github.com/l0rinc",
          "followers_url": "https://api.github.com/users/l0rinc/followers",
          "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
          "organizations_url": "https://api.github.com/users/l0rinc/orgs",
          "repos_url": "https://api.github.com/users/l0rinc/repos",
          "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/l0rinc/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/l0rinc/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/l0rinc/bitcoin",
        "archive_url": "https://api.github.com/repos/l0rinc/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/l0rinc/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/l0rinc/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/l0rinc/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/l0rinc/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/l0rinc/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/l0rinc/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/l0rinc/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/l0rinc/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/l0rinc/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/l0rinc/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/l0rinc/bitcoin/events",
        "forks_url": "https://api.github.com/repos/l0rinc/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/l0rinc/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/l0rinc/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/l0rinc/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/l0rinc/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/l0rinc/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/l0rinc/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/l0rinc/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/l0rinc/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/l0rinc/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/l0rinc/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/l0rinc/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/l0rinc/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/l0rinc/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/l0rinc/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:l0rinc/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/l0rinc/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/l0rinc/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/l0rinc/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/l0rinc/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/l0rinc/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/l0rinc/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/l0rinc/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/l0rinc/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/l0rinc/bitcoin/hooks",
        "svn_url": "https://github.com/l0rinc/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 282251,
        "default_branch": "master",
        "open_issues_count": 34,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-20T14:35:49Z",
        "created_at": "2023-08-03T09:49:12Z",
        "updated_at": "2026-01-17T21:35:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "d861c3820528fad2e17a45549bec70b6ba434dcc",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38744,
        "stargazers_count": 87726,
        "watchers_count": 87726,
        "size": 302068,
        "default_branch": "master",
        "open_issues_count": 748,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-20T23:47:24Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-20T23:47:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 38,
    "deletions": 25,
    "changed_files": 5,
    "commits": 3,
    "review_comments": 77,
    "comments": 15
  },
  "events": [
    {
      "event": "commented",
      "id": 2880167395,
      "node_id": "IC_kwDOABII586rq93j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2880167395",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-14T13:01:47Z",
      "updated_at": "2026-01-20T23:37:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32497.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [optout21](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3099889680), [hodlinator](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3624328843), [vasild](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3664290763), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3667031029), [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3677843063), [achow101](https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3775448354) |\n| Concept NACK | [darosior](https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3528552716) |\n| Concept ACK | [luke-jr](https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2853787748) |\n| Stale ACK | [yuvicc](https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3011987044) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-2880167395",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "reviewed",
      "id": 2853787748,
      "node_id": "PRR_kwDOABII586qGVhk",
      "url": null,
      "actor": null,
      "commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-20T11:34:01Z",
      "author_association": "MEMBER",
      "body": "utACK main commit. Not sure why the benchmark is being changed.",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2853787748",
      "submitted_at": "2025-05-20T11:34:01Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 2854173281,
      "node_id": "PRR_kwDOABII586qHzph",
      "url": null,
      "actor": null,
      "commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-05-20T13:28:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the review!",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2854173281",
      "submitted_at": "2025-05-20T13:28:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 2926329777,
      "node_id": "PRR_kwDOABII586ubD-x",
      "url": null,
      "actor": null,
      "commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-13T20:34:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nMemory allocation/deallocation is slow and expensive. ",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2926329777",
      "submitted_at": "2025-06-13T20:34:19Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "commented",
      "id": 2971637588,
      "node_id": "IC_kwDOABII586xH5dU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2971637588",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-13T20:42:19Z",
      "updated_at": "2025-06-13T20:42:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "I have thought on changing the benchmark tests as we would want to test the worst case scenario right? or else we could have both case for testing? ",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-2971637588",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "reviewed",
      "id": 2926489759,
      "node_id": "PRR_kwDOABII586ubrCf",
      "url": null,
      "actor": null,
      "commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-13T21:35:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "# Benchmark Testing\r\n\r\nmaster@5757de4ddd37f9321ee6b338b40888fd3561fc00\r\n\r\n- With 9000\r\n```\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               52.62 |       19,005,746.07 |    0.2% |      0.01 | `MerkleRoot`\r\n|               52.64 |       18,998,504.40 |    0.3% |      0.01 | `MerkleRoot`\r\n|               52.63 |       18,999,727.67 |    0.2% |      0.01 | `MerkleRoot`\r\n```\r\n\r\n- With 9001\r\n```\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               53.50 |       18,693,063.88 |    0.3% |      0.01 | `MerkleRoot`\r\n|               53.53 |       18,681,211.49 |    0.5% |      0.01 | `MerkleRoot`\r\n|               53.49 |       18,694,053.87 |    0.5% |      0.01 | `MerkleRoot`\r\n```\r\n\r\n--------------------------------------------------------------------\r\n\r\nCommit 39b6c139bd6be33699af781f1d71f6fed303d468\r\n\r\n- With 9000\r\n```\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               52.51 |       19,043,628.95 |    0.2% |      0.01 | `MerkleRoot`\r\n|               52.52 |       19,040,989.96 |    0.2% |      0.01 | `MerkleRoot`\r\n|               52.53 |       19,036,358.39 |    0.2% |      0.01 | `MerkleRoot`\r\n```\r\n\r\n- With 9001\r\n```\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               53.40 |       18,713,525.67 |    0.3% |      0.01 | `MerkleRoot`\r\n|               53.44 |       19,314,655.73 |    0.3% |      0.01 | `MerkleRoot`\r\n|               53.41 |       18,883,462.75 |    0.3% |      0.01 | `MerkleRoot`\r\n```",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2926489759",
      "submitted_at": "2025-06-13T21:35:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18154933868,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAQ6Hk5s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18154933868",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/4cc5942895673591de4edceb6dd0c7188c302a72",
      "created_at": "2025-06-15T09:56:25Z"
    },
    {
      "event": "commented",
      "id": 2973633245,
      "node_id": "IC_kwDOABII586xPgrd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2973633245",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-15T10:06:53Z",
      "updated_at": "2025-06-15T10:08:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "Updated the benchmark to showcase the before/after state better (resembles production code changes), by splitting out the vector copies to the unmetered lambda and having an odd number of elements.\r\nChanged the previous `leaves.reserve((block.vtx.size() + 1) & ~1ULL)` rounding to `leaves.reserve(block.vtx.size() + (block.vtx.size() & 1))`.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-2973633245",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "review_requested",
      "id": 18154970596,
      "node_id": "RRE_lADOABII5862klqrzwAAAAQ6Ht3k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18154970596",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-15T10:06:57Z",
      "requested_reviewer": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 18154970671,
      "node_id": "RRE_lADOABII5862klqrzwAAAAQ6Ht4v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18154970671",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-15T10:06:58Z",
      "requested_reviewer": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2930083029,
      "node_id": "PRR_kwDOABII586upYTV",
      "url": null,
      "actor": null,
      "commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-19T16:00:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 4cc5942895673591de4edceb6dd0c7188c302a72\r\n\r\n# Testing\r\n\r\n## Before Master@9a7eece5a4\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               53.75 |       18,605,160.70 |    0.7% |      0.01 | `MerkleRoot`\r\n|               53.64 |       18,643,002.35 |    0.1% |      0.01 | `MerkleRoot`\r\n|               53.91 |       18,548,704.52 |    0.4% |      0.01 | `MerkleRoot`\r\n\r\n## After commit@4cc5942895673591de4edceb6dd0c7188c302a72\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               57.67 |       17,340,305.39 |    0.0% |      0.52 | `MerkleRoot`\r\n|               57.69 |       17,332,534.96 |    0.0% |      0.52 | `MerkleRoot`\r\n|               58.14 |       17,199,057.10 |    0.0% |      0.52 | `MerkleRoot`",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2930083029",
      "submitted_at": "2025-06-15T17:26:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 2945160215,
      "node_id": "PRR_kwDOABII586vi5QX",
      "url": null,
      "actor": null,
      "commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-20T09:22:45Z",
      "author_association": "MEMBER",
      "body": "not sure how meaningful this is, but it looks like there are a bunch of unrelated style changes that don't seem to have a benefit?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2945160215",
      "submitted_at": "2025-06-20T09:22:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18245408459,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAQ_gtbL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18245408459",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a1f2a4c3eed7ca6129781451e0edc49debbb0594",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a1f2a4c3eed7ca6129781451e0edc49debbb0594",
      "created_at": "2025-06-20T11:19:32Z"
    },
    {
      "event": "reviewed",
      "id": 2945559978,
      "node_id": "PRR_kwDOABII586vka2q",
      "url": null,
      "actor": null,
      "commit_id": "a1f2a4c3eed7ca6129781451e0edc49debbb0594",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-06-25T21:34:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "The changes revert the original benchmark's behavior of including the leaf vector in the benchmark (more explicitly and reserved like the production code).\r\nI've also changed the `emplace_back` calls for the hashes to `push_bash` and reverted the original loop conditions to minimize the diff in critical code sections.\r\n\r\nNote to yuvicc: previous benchmark version was measuring something else than master (only the merkle call without the vector copy), so we can't directly compare the results.\r\n\r\n~The new results don't show any significant speed increase, only the memory allocation is more predictable - which isn't captured by the benchmark anymore.~",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2945559978",
      "submitted_at": "2025-06-20T11:24:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "review_requested",
      "id": 18312609733,
      "node_id": "RRE_lADOABII5862klqrzwAAAARDhD_F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18312609733",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-25T09:22:33Z",
      "requested_reviewer": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 18312610132,
      "node_id": "RRE_lADOABII5862klqrzwAAAARDhEFU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18312610132",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-25T09:22:34Z",
      "requested_reviewer": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18324692942,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAREPJ_O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18324692942",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a73dd45e95f5e909d0950ba7c76225589df74854",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a73dd45e95f5e909d0950ba7c76225589df74854",
      "created_at": "2025-06-25T21:30:38Z"
    },
    {
      "event": "commented",
      "id": 3006209711,
      "node_id": "IC_kwDOABII586zLx6v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3006209711",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-25T21:33:42Z",
      "updated_at": "2025-06-25T21:33:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "I've rebased the changed and adjusted the benchmark to be more similar to the other production usages in the first commit, rounded to even in the second (optimization) commit, so that we can realistically measure the speed difference before and after:\r\n\r\n% build/bin/bench_bitcoin -filter='MerkleRoot' --min-time=1000\r\n\r\nBefore 7f620cffebee593e48434cf182cc2fd64a6d76be:\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               45.50 |       21,975,688.66 |    0.0% |      1.10 | `MerkleRoot`\r\n|               45.53 |       21,962,546.91 |    0.1% |      1.10 | `MerkleRoot`\r\n|               45.53 |       21,965,162.52 |    0.0% |      1.10 | `MerkleRoot`\r\n\r\nAfter a73dd45e95f5e909d0950ba7c76225589df74854:\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               45.04 |       22,200,976.95 |    0.1% |      1.10 | `MerkleRoot`\r\n|               44.97 |       22,235,208.25 |    0.1% |      1.10 | `MerkleRoot`\r\n|               45.01 |       22,217,033.81 |    0.1% |      1.10 | `MerkleRoot`",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3006209711",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18324753508,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAREPYxk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18324753508",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "be8f3053a7ad526823f32f1a70847b9c06c4c54b",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/be8f3053a7ad526823f32f1a70847b9c06c4c54b",
      "created_at": "2025-06-25T21:36:01Z"
    },
    {
      "event": "commented",
      "id": 3011987044,
      "node_id": "IC_kwDOABII586zh0Zk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3011987044",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-27T07:22:24Z",
      "updated_at": "2025-06-27T07:22:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "lgtm re-ACK be8f3053a7ad526823f32f1a70847b9c06c4c54b\r\n\r\nBefore e87430ed5fad6f9d90c1e7d256b9b8276b936c24\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               53.83 |       18,577,129.91 |    0.1% |      1.10 | `MerkleRoot`\r\n|               53.62 |       18,648,858.81 |    0.1% |      1.10 | `MerkleRoot`\r\n|               53.70 |       18,621,594.40 |    0.1% |      1.10 | `MerkleRoot`\r\n\r\nAfter be8f3053a7ad526823f32f1a70847b9c06c4c54b\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               53.02 |       18,860,232.62 |    0.2% |      1.10 | `MerkleRoot`\r\n|               52.88 |       18,910,755.68 |    0.0% |      1.10 | `MerkleRoot`\r\n|               52.89 |       18,906,671.63 |    0.1% |      1.10 | `MerkleRoot`",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3011987044",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18909367246,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARnFgvO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18909367246",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "6d1950d76bb643b2e3aa2899e052bbe507b97ef1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/6d1950d76bb643b2e3aa2899e052bbe507b97ef1",
      "created_at": "2025-07-30T23:55:09Z"
    },
    {
      "event": "commented",
      "id": 3138169095,
      "node_id": "IC_kwDOABII5867DKkH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3138169095",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T23:58:15Z",
      "updated_at": "2025-07-30T23:58:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased and added a new commit on top for deduplicating the integer rounding. Ready for review again.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3138169095",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18909421146,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARnFt5a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18909421146",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2d1a4e7208f2205c671a299de6b7ee358bb235a7",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/2d1a4e7208f2205c671a299de6b7ee358bb235a7",
      "created_at": "2025-07-30T23:58:47Z"
    },
    {
      "event": "labeled",
      "id": 18909422097,
      "node_id": "LE_lADOABII5862klqrzwAAAARnFuIR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18909422097",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T23:58:55Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3138171113,
      "node_id": "IC_kwDOABII5867DLDp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3138171113",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-30T23:58:57Z",
      "updated_at": "2025-07-30T23:58:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/47077763348</sub>\n<sub>LLM reason (✨ experimental): Lint check failed due to missing include guards in src/util/ints.h.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3138171113",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "unlabeled",
      "id": 18910163555,
      "node_id": "UNLE_lADOABII5862klqrzwAAAARnIjJj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18910163555",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-31T01:37:59Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3162698716,
      "node_id": "IC_kwDOABII5868gvPc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3162698716",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-07T06:36:53Z",
      "updated_at": "2025-08-07T06:36:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "LGTM!\r\nMinor comments:\r\n- Maybe add a note to the `ComputeMerkleRoot` declaration, that the `hashes` input is expected to have one extra capacity (in case size is odd). Minor, as this function is not used directly much.\r\n- Even more, it could debug-assert that capacity is even, but this may be a bit of a stretch.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3162698716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19041923436,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARu_LFs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19041923436",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "5d117d99f3080ef27e433dd9ee826b7d56a0dc19",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/5d117d99f3080ef27e433dd9ee826b7d56a0dc19",
      "created_at": "2025-08-07T19:02:47Z"
    },
    {
      "event": "commented",
      "id": 3165392837,
      "node_id": "IC_kwDOABII5868rA_F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3165392837",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-07T19:03:12Z",
      "updated_at": "2025-08-07T22:36:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "> it could debug-assert that capacity is even\r\n\r\n~Added, thanks for the hint~\r\n\r\nEdit: had to push a few variants, the fuzzing still seems to fail, so I removed the Assert/Assume from `ComputeMerkleRoot` (it's not a requirement anyway, it's just more performant)",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3165392837",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19042360120,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARvA1s4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19042360120",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "c162fdf83aca13bfd925c3873b7af8eda6f908f3",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/c162fdf83aca13bfd925c3873b7af8eda6f908f3",
      "created_at": "2025-08-07T19:31:43Z"
    },
    {
      "event": "labeled",
      "id": 19042361620,
      "node_id": "LE_lADOABII5862klqrzwAAAARvA2EU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19042361620",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-07T19:31:51Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3165481789,
      "node_id": "IC_kwDOABII5868rWs9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3165481789",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-07T19:31:53Z",
      "updated_at": "2025-08-07T19:31:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `multiprocess, i686, DEBUG`: https://github.com/bitcoin/bitcoin/runs/47624077326</sub>\n<sub>LLM reason (✨ experimental): The CI failure is caused by an assertion failure in consensus/merkle.cpp during the merkle root computation.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3165481789",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19043786054,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARvGR1G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19043786054",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9f1f74a388fdbb997e5b01b6ce444727cafb5274",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/9f1f74a388fdbb997e5b01b6ce444727cafb5274",
      "created_at": "2025-08-07T21:25:12Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19044622452,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAARvJeB0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19044622452",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/a7997d02ebe5b72e706712f43884644b705a1cd1",
      "created_at": "2025-08-07T22:35:53Z"
    },
    {
      "event": "unlabeled",
      "id": 19045352770,
      "node_id": "UNLE_lADOABII5862klqrzwAAAARvMQVC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19045352770",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-08T00:13:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3099889680,
      "node_id": "PRR_kwDOABII5864xJAQ",
      "url": null,
      "actor": null,
      "commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-05T08:57:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "reACK 3dd815f048c80c9a35f01972e0537eb42531aec7\r\nChange since last review: Ajdust a leftover assert in the test code.\r\n\r\n(prev:\r\nreACK 8af0a3a72c8af781bebed7289657c637220df893\r\nACK e3b02f1539e59a6a20a00b4161219b5aba6fefed\r\nReACK. Nicely simplified.\r\na7997d02ebe5b72e706712f43884644b705a1cd1  Good optimization, nice catch!)",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3099889680",
      "submitted_at": "2025-08-08T08:20:09Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3102373739,
      "node_id": "PRR_kwDOABII58646ndr",
      "url": null,
      "actor": null,
      "commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-09T01:34:54Z",
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3102373739",
      "submitted_at": "2025-08-09T01:34:54Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "labeled",
      "id": 19145212315,
      "node_id": "LE_lADOABII5862klqrzwAAAAR1JMGb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19145212315",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:37:48Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19145292452,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAR1Jfqk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19145292452",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "59e7320dba0606221c0e4d537743f7ef4708bc10",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/59e7320dba0606221c0e4d537743f7ef4708bc10",
      "created_at": "2025-08-13T20:43:24Z"
    },
    {
      "event": "commented",
      "id": 3185719555,
      "node_id": "IC_kwDOABII58694jkD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3185719555",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:44:13Z",
      "updated_at": "2025-08-13T20:44:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/33116 - the only conflict was adding `.ToUint256()` to the merkle hashes.\r\n\r\nBased on the suggestion of @achow101 (since I do agree that it's kinda' leaking abstractions and there's also a lot of duplication for collecting the merkle leaves), I have also deduplicated all call sites without needing to touch the consensusy Merkle calculation itself.\r\nWe can still do that in a follow-up, if needed, but this way we've made the code both simpler **and** more performant (which wasn't the case with either the original or the suggestion), and separated the leaves abstraction and kept the risky merkle root calculation intact.\r\nI have remeasured the before/after benchmarks, no change in performance since last push, but updated the commit messages anyway.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3185719555",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "mentioned",
      "id": 19145304518,
      "node_id": "MEE_lADOABII5862klqrzwAAAAR1JinG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19145304518",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:44:14Z"
    },
    {
      "event": "subscribed",
      "id": 19145304536,
      "node_id": "SE_lADOABII5862klqrzwAAAAR1JinY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19145304536",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T20:44:14Z"
    },
    {
      "event": "labeled",
      "id": 19146335600,
      "node_id": "LE_lADOABII5862klqrzwAAAAR1NeVw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19146335600",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T21:49:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3185943594,
      "node_id": "IC_kwDOABII58695aQq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3185943594",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T21:49:48Z",
      "updated_at": "2025-08-13T21:49:48Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `tidy`: https://github.com/bitcoin/bitcoin/runs/48036589106</sub>\n<sub>LLM reason (✨ experimental): The failure is caused by an error in clang-tidy related to the use of std::move on a const variable, indicating a code warning treated as an error.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3185943594",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19146352844,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAR1NijM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19146352844",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "created_at": "2025-08-13T21:51:09Z"
    },
    {
      "event": "unlabeled",
      "id": 19147014500,
      "node_id": "UNLE_lADOABII5862klqrzwAAAAR1QEFk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19147014500",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T22:54:15Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 19147263867,
      "node_id": "UNLE_lADOABII5862klqrzwAAAAR1RA97",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19147263867",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-13T23:21:22Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3528552716,
      "node_id": "IC_kwDOABII587SUXEM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3528552716",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-13T16:11:48Z",
      "updated_at": "2025-11-13T16:11:48Z",
      "author_association": "MEMBER",
      "body": "Sorry to be this guy again, but it seems to me unreasonable to touch such critical consensus code for such marginal benefits. Unless observable benefits can be shown, i lean toward Concept NACK.",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3528552716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "commented",
      "id": 3563724551,
      "node_id": "IC_kwDOABII587Uah8H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3563724551",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-21T16:14:21Z",
      "updated_at": "2025-11-21T16:14:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Unless observable benefits can be shown\r\n\r\nThe change itself is trivial, it's just a **+1** for the reserve before calling the Merkle calculation.\r\nI don't mind simplifying the change if you think that's easier to review (I could also just bump `leaves.reserve(block.vtx.size())` to `leaves.reserve(block.vtx.size() + 1)` without the refactors).\r\nOriginally it was similar to that, but based on [concerns](https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264185044) to decouple callers from needing to know the internals of Merkle calculations, I extracted the loops.\r\n\r\nI'm open to simplifying it back to just a reserve if you think that's easier to review, but I'd argue that the underlying incorrect memory reservation is a minor bug that should be fixed.\r\n\r\n---------\r\n\r\nWhile this change does result in small speedup, the primary purpose is to avoid having to reallocate 2x additional memory for a predictable calculation - less memory fragmentation, lower memory usage, more predictable behavior.\r\nLet's quantify the impact: running `massif` for the benchmark with an odd leaf count shows the memory peaks clearly:\r\n\r\n<details>\r\n<summary>massif measurement comparing the two commits for 200 second benchmark run</summary>\r\n\r\n```bash\r\nCOMMITS=\"f2334a0ae056a9e3cba218206d139b3688eeda96 de6a28396b8bf7a3fd1124418b4cd5beba1906d6\"; \\\r\nCC=gcc; CXX=g++; \\\r\nBASE_DIR=\"/mnt/my_storage\"; LOG_DIR=\"$BASE_DIR/logs\"; \\\r\nFILTER=\"MerkleRoot\"; MIN_TIME=200000; \\\r\nmkdir -p \"$LOG_DIR\"; \\\r\n(echo \"memory benchmark | filter=$FILTER | min-time=${MIN_TIME}ms | $(hostname) | $(uname -m) | $(lscpu | grep 'Model name' | head -1 | cut -d: -f2 | xargs) | $(nproc) cores | $(free -h | awk '/^Mem:/{print $2}') RAM\";) &&\\\r\n(for c in $COMMITS; do git log -1 --pretty='%h %s' $c || exit 1; done; echo \"\") && \\\r\nfor COMMIT in $COMMITS; do \\\r\n  SHORT_COMMIT=${COMMIT:0:8}; \\\r\n  echo \"Processing commit $SHORT_COMMIT...\"; \\\r\n  git fetch -q origin $COMMIT && git checkout -q $COMMIT && \\\r\n  git clean -fxd && git reset --hard && \\\r\n  cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_BENCH=ON -DENABLE_IPC=OFF && \\\r\n  ninja -C build bench_bitcoin -j2 && \\\r\n  valgrind --tool=massif --time-unit=ms \\\r\n    --massif-out-file=\"$LOG_DIR/massif-bench-$FILTER-$SHORT_COMMIT.out\" \\\r\n    build/bin/bench_bitcoin -filter=\"$FILTER\" --min-time=$MIN_TIME && \\\r\n  ms_print \"$LOG_DIR/massif-bench-$FILTER-$SHORT_COMMIT.out\" | tee \"$LOG_DIR/massif-bench-$FILTER-$SHORT_COMMIT.txt\" && \\\r\n  echo \"Completed $SHORT_COMMIT\"; \\\r\ndone && \\\r\necho \"\" && echo \"Results in: $LOG_DIR/massif-bench-$FILTER-*.{out,txt}\"\r\n````\r\n\r\n</details>\r\n\r\nWe can also clearly see the [difference](https://www.diffchecker.com/Lrp4SYcS) in the capture stack traces.\r\n**Before**, having  **1.3 MB peak memory** usage:\r\n```massif\r\n    MB\r\n1.332^        :                                                               \r\n     | #      :                                                               \r\n     | #      :                                                               \r\n     | #      :                                                               \r\n     | #      :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #    @ :                                                               \r\n     | #::::@::::::::::::::::::::::::::::::::::::::::::::::::::::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\r\n   0 +----------------------------------------------------------------------->s\r\n     0                                                                   226.2\r\n```\r\nshowing the reallocations clearly in the stacks:\r\n```\r\n97.87% (1,366,841B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\r\n->41.25% (576,064B) 0x969717: allocate (new_allocator.h:151)\r\n| ->41.25% (576,064B) 0x969717: allocate (allocator.h:203)\r\n|   ->41.25% (576,064B) 0x969717: allocate (alloc_traits.h:614)\r\n|     ->41.25% (576,064B) 0x969717: _M_allocate (stl_vector.h:387)\r\n|       ->41.25% (576,064B) 0x969717: _M_realloc_append<const uint256&> (vector.tcc:572)\r\n|         ->41.25% (576,064B) 0x969717: push_back (stl_vector.h:1427)\r\n|           ->41.25% (576,064B) 0x969717: ComputeMerkleRoot(std::vector<uint256, std::allocator<uint256> >, bool*) (merkle.cpp:55)\r\n|             ->41.25% (576,064B) 0x2235A7: operator() (merkle_root.cpp:31)\r\n|               ->41.25% (576,064B) 0x2235A7: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\r\n```\r\n\r\n-----\r\n\r\n**After**, having a **0.8 MB peak memory** usage\r\n```massif\r\n    KB\r\n801.4^ #                                                                      \r\n     | #                                                                      \r\n     | #                                                                      \r\n     | #                                                                      \r\n     | #                                                                      \r\n     | #                                                                      \r\n     | #                                                                      \r\n     | #                                                         :::::@:::::@:\r\n     | #:::@@@::@:::::::::::::::@::@:@:::@@:::::::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\r\n   0 +----------------------------------------------------------------------->s\r\n     0                                                                   227.5\r\n```\r\nand the stacks don't show reallocs anymore:\r\n```\r\n96.37% (790,809B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\r\n->35.10% (288,064B) 0x2234AF: allocate (new_allocator.h:151)\r\n| ->35.10% (288,064B) 0x2234AF: allocate (allocator.h:203)\r\n|   ->35.10% (288,064B) 0x2234AF: allocate (alloc_traits.h:614)\r\n|     ->35.10% (288,064B) 0x2234AF: _M_allocate (stl_vector.h:387)\r\n|       ->35.10% (288,064B) 0x2234AF: reserve (vector.tcc:79)\r\n|         ->35.10% (288,064B) 0x2234AF: ToMerkleLeaves<std::vector<uint256>, MerkleRoot(ankerl::nanobench::Bench&)::<lambda()>::<lambda(bool, const auto:46&)> > (merkle.h:19)\r\n|           ->35.10% (288,064B) 0x2234AF: operator() (merkle_root.cpp:25)\r\n|             ->35.10% (288,064B) 0x2234AF: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\r\n```",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3563724551",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "reviewed",
      "id": 3493993983,
      "node_id": "PRR_kwDOABII587QQh3_",
      "url": null,
      "actor": null,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-21T21:31:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK de6a28396b8bf7a3fd1124418b4cd5beba1906d6\n\n`ComputeMerkleRoot(std::vector<uint256> hashes, ...)` takes a vector by value, but luckily call sites already move into it, and since the underlying array/memory is transferred on move, the capacity \"transfers as well\" - neat!\n\n---\n\n> Sorry to be this guy again, but it seems to me unreasonable to touch such critical consensus code for such marginal benefits. Unless observable benefits can be shown, ...\n\nThanks for being that guy!\n\nGoing by https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3006209711 and https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3011987044 there seems to be a 2% speed increase for computing merkle roots.\n\nI cannot spot any issue with how this PR currently changes the consensus code. However, maybe we could reduce the scope of the change somewhat to make it more palatable. Here is my attempt:\nhttps://github.com/bitcoin/bitcoin/compare/master...hodlinator:bitcoin:refs/heads/pr/32497_minimal#diff-706988c23877f8a557484053887f932b2cafb3b5998b50497ce7ff8118ac85a3 (link directly to src/consensus/merkle.cpp)\n\nThis 2% speed increase in merkle root computation is probably not at all measurable for a full IBD though. So if there is no variant of this optimization that inspires confidence, I can understand the push-back.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3493993983",
      "submitted_at": "2025-11-21T21:31:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3496417072,
      "node_id": "PRR_kwDOABII587QZxcw",
      "url": null,
      "actor": null,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-22T13:00:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "Latest push:\n* rebases against latest master;\n* reverts code back to simply change `leaves.resize(block.vtx.size())` constructs before calling `ComputeMerkleRoot` to `.reserve((block.vtx.size() + 1) & ~1ULL)`;\n  ** added godbolt reproducer for each important combination of compiler and architecture\n* Separates the test changes to a separate commit explaining the motivation in the commit message\n* updated commit messages and PR descriptions.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3496417072",
      "submitted_at": "2025-11-22T13:00:29Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21115046758,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAATqjgtm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21115046758",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "created_at": "2025-11-22T13:00:32Z"
    },
    {
      "event": "reviewed",
      "id": 3514527691,
      "node_id": "PRR_kwDOABII587Re2_L",
      "url": null,
      "actor": null,
      "commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-27T10:37:46Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3514527691",
      "submitted_at": "2025-11-27T10:37:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3514534142,
      "node_id": "PRR_kwDOABII587Re4j-",
      "url": null,
      "actor": null,
      "commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-27T10:39:02Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3514534142",
      "submitted_at": "2025-11-27T10:39:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "comment_deleted",
      "id": 21221534434,
      "node_id": "CDE_lADOABII5862klqrzwAAAATw5uri",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21221534434",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-27T14:24:21Z"
    },
    {
      "event": "reviewed",
      "id": 3515742822,
      "node_id": "PRR_kwDOABII587Rjfpm",
      "url": null,
      "actor": null,
      "commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-27T15:01:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "Reviewed e3b02f1539e59a6a20a00b4161219b5aba6fefed\n\nThanks for reverting to a simpler version of this change!\n\n2 inline questions.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3515742822",
      "submitted_at": "2025-11-27T15:01:57Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21222956884,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAATw_J9U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21222956884",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "created_at": "2025-11-27T15:12:33Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21274376641,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAT0DTnB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21274376641",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/8af0a3a72c8af781bebed7289657c637220df893",
      "created_at": "2025-12-01T12:10:32Z"
    },
    {
      "event": "reviewed",
      "id": 3526806887,
      "node_id": "PRR_kwDOABII587SNs1n",
      "url": null,
      "actor": null,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-01T20:26:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 8af0a3a72c8af781bebed7289657c637220df893\n\nWhile the benefit of this change to consensus code is low, it's been simplified back to a more easily reviewable version.\n\nThe benchmark now has two parts, one that detects mutation issues and one which does not, corresponding to the non-witness & witness merkle root computations performed by Bitcoin Core on mainnet.\n\n### One extra level of paranoia?\n\nI think this change really is simple enough to approve as-is. It's maybe not the same risk-level as changing standard library major versions, but adjacent to it. If people still object, one idea to improve confidence could be to splice in a new commit before the last one - it could add `BlockMerkleRootNew()` and `BlockWitnessMerkleRootNew()` alongside the old ones, and have a fuzz test which compares results between new & old versions. Then the last commit could merge new & old together, keeping the old name but using the new implementations, and removing the fuzz test again.\n\n### Benchmarks\n\n<details><summary>Expand</summary>\n\n```shell\n₿ cmake --build build -t bench_bitcoin && build/bin/bench_bitcoin -filter=\"MerkleRoot\" -min-time=10000\n```\n\n#### 5fd62ede95900a6ea603c2b9f14c58ff4c32a4e2 \"bench: make `MerkleRoot` benchmark more representative\"\n\n```\n|             ns/leaf |              leaf/s |    err% |        ins/leaf |        cyc/leaf |    IPC |       bra/leaf |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|              115.53 |        8,655,444.89 |    0.0% |        1,216.23 |          425.94 |  2.855 |           2.14 |    0.3% |     11.03 | `MerkleRoot`\n|              116.84 |        8,558,882.10 |    0.0% |        1,231.24 |          430.78 |  2.858 |           3.14 |    0.2% |     10.99 | `MerkleRootWithMutation`\n```\n\n#### 8af0a3a72c8af781bebed7289657c637220df893 \"validation: pre-reserve leaves to prevent reallocs with odd vtx count\"\n\n```\n|             ns/leaf |              leaf/s |    err% |        ins/leaf |        cyc/leaf |    IPC |       bra/leaf |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|              113.25 |        8,830,206.60 |    0.0% |        1,223.17 |          417.50 |  2.930 |           2.63 |    0.2% |     10.99 | `MerkleRoot`\n|              114.67 |        8,720,906.94 |    0.0% |        1,238.18 |          422.72 |  2.929 |           3.63 |    0.2% |     11.01 | `MerkleRootWithMutation`\n```\n\n#### Modified 8af0a3a72c8af781bebed7289657c637220df893 which just does `leaves.reserve(hashes.size())`\n\n```\n|             ns/leaf |              leaf/s |    err% |        ins/leaf |        cyc/leaf |    IPC |       bra/leaf |   miss% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\n|              114.81 |        8,709,871.88 |    0.0% |        1,230.23 |          423.26 |  2.907 |           3.64 |    0.2% |     11.01 | `MerkleRoot`\n|              116.21 |        8,605,021.23 |    0.0% |        1,245.23 |          428.41 |  2.907 |           4.64 |    0.2% |     11.00 | `MerkleRootWithMutation`\n```\n\nThis last one shows that even just switching from `resize()` to `reserve()`, without always reserving an even number, does result in a measurable speedup by itself. Explains why I didn't see as big differences in my previous testing (https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2576533841) since all those variants used `reserve()`.\n\n</details>",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3526806887",
      "submitted_at": "2025-12-01T20:26:01Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "review_requested",
      "id": 21286896359,
      "node_id": "RRE_lADOABII5862klqrzwAAAAT0zELn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21286896359",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-01T20:26:07Z",
      "requested_reviewer": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3556795783,
      "node_id": "PRR_kwDOABII587UAGWH",
      "url": null,
      "actor": null,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-09T13:15:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK 8af0a3a72c8af781bebed7289657c637220df893",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3556795783",
      "submitted_at": "2025-12-09T13:15:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYwYTIxODMxMDg3NDEwNjg3YzRjYTMxYWMwMGU0NGYzODBiODU5YmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0a21831087410687c4ca31ac00e44f380b859be",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f0a21831087410687c4ca31ac00e44f380b859be",
      "tree": {
        "sha": "e54a106e81a2b6467af2b14d147fd7c12ce183a0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e54a106e81a2b6467af2b14d147fd7c12ce183a0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e54a106e81a2b6467af2b14d147fd7c12ce183a0\nparent b26762bdcb941096ccc6f53c3fb5a7786ad735e7\nauthor Lőrinc <pap.lorinc@gmail.com> 1763814604 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1765460868 +0100\n\ntest: adjust `ComputeMerkleRoot` tests\n\nUpdate the integer fuzz test to move the vector into `ComputeMerkleRoot`, matching production usage patterns and avoiding unnecessary copies.\n\nUpdate `merkle_test_BlockWitness` to use an odd number of transactions to ensure the test covers the scenario where leaf duplication occurs. Also switch to `GetWitnessHash` to match `BlockWitnessMerkleRoot` semantics.\nThe manual vector setup retains the exact-size `resize` to explicitly verify the behavior against the calculated root.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmk6y4QACgkQZp//D/pH\nenawSBAAvlUh59D7ar2Y4io5yWINSW3VNw/OamXE1OmqwOzWRf7El5JhtsTuVQV0\nCvJeZtJ1FKBUi8BRNZ3Bt7LS+/BfIoIIRoRh3M2ZR/WpE0gz8nvDAuNyqYNn5xK+\nDOBoZFkQI/bsJ6gYrtdXf2z3JjDIP9MEg0OWDSkydaIcgjXCEHiybAgPrw+pTJ19\nktXEO8DZFDZ+AtVkCejECs7mzm0VaLuk/mPsJH6O44Tnas0ZAZL7mn5Mc/W+XGqN\nijmpR8mClQwqHnR42Ua8PGbAmfMRisbrRNO4uX48mNbRvVNTO/OGZJLnPb91rl+M\nhwJSLOmUQ1ygXMDw5ETB+X7QBt1vPDSOfNcfpNfNBG14aCt4YyST7AEJYIRyBpso\ntRCCTFKrNYktDlqQdp4lQfc7LPZwqkezh34MStXEGpslKr+Tc2B7aWV2DcJh2qbP\nWXDCP9E7FNMjwVOAOVmH8Yrl3Nq+HWoKWPRkxI8kzsXpWmCZHHj6CruPm1+V+3ro\nBBpOXLvE6rKBHHdwkXD/CCALl6p9i1sZK5HVxjfzXRBpxLNeSP39CT9FFUtt7J3K\nwghUv+6Ue5O1NrGZMGlLlfJMDh73v4elxZgECJoUWfZCZvBiaCdhNYrMNbe2udmi\nkhKTn6+l4vBlkCeFF1+I8u1nUhQXsZ/0DYlxhZ0xaMsRyYOXKGE=\n=hiqs\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b26762bdcb941096ccc6f53c3fb5a7786ad735e7",
          "sha": "b26762bdcb941096ccc6f53c3fb5a7786ad735e7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b26762bdcb941096ccc6f53c3fb5a7786ad735e7"
        }
      ],
      "message": "test: adjust `ComputeMerkleRoot` tests\n\nUpdate the integer fuzz test to move the vector into `ComputeMerkleRoot`, matching production usage patterns and avoiding unnecessary copies.\n\nUpdate `merkle_test_BlockWitness` to use an odd number of transactions to ensure the test covers the scenario where leaf duplication occurs. Also switch to `GetWitnessHash` to match `BlockWitnessMerkleRoot` semantics.\nThe manual vector setup retains the exact-size `resize` to explicitly verify the behavior against the calculated root.",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-11T13:47:48Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-11-22T12:30:04Z"
      },
      "sha": "f0a21831087410687c4ca31ac00e44f380b859be"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21504817231,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAUByXhP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21504817231",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "created_at": "2025-12-11T13:48:07Z"
    },
    {
      "event": "reviewed",
      "id": 3567608553,
      "node_id": "PRR_kwDOABII587UpWLp",
      "url": null,
      "actor": null,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-11T14:05:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK 9f39a8309cb0a23df03937b0b225aff8ce9e1ec6\r\n\r\nResolved conflict with #33805 and fixed code nit https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602163619.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3567608553",
      "submitted_at": "2025-12-11T14:05:44Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "review_requested",
      "id": 21505210891,
      "node_id": "RRE_lADOABII5862klqrzwAAAAUBz3oL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21505210891",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T14:05:51Z",
      "requested_reviewer": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "labeled",
      "id": 21506702298,
      "node_id": "LE_lADOABII5862klqrzwAAAAUB5jva",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21506702298",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T15:06:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "closed",
      "id": 21511160809,
      "node_id": "CE_lADOABII5862klqrzwAAAAUCKkPp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21511160809",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T18:33:06Z"
    },
    {
      "event": "reopened",
      "id": 21511162143,
      "node_id": "REE_lADOABII5862klqrzwAAAAUCKkkf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21511162143",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T18:33:11Z"
    },
    {
      "event": "unlabeled",
      "id": 21514347109,
      "node_id": "UNLE_lADOABII5862klqrzwAAAAUCWuJl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21514347109",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T21:38:42Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3570749656,
      "node_id": "PRR_kwDOABII587U1VDY",
      "url": null,
      "actor": null,
      "commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-12T08:00:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3570749656",
      "submitted_at": "2025-12-12T08:00:53Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3606019558,
      "node_id": "PRR_kwDOABII587W733m",
      "url": null,
      "actor": null,
      "commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-22T23:01:48Z",
      "author_association": "MEMBER",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3606019558",
      "submitted_at": "2025-12-22T23:01:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdmZDQ3ZTBlNTYwODdjZDNiNWZkNzZhNTMyYmRjM2FjMzMxZTgzMmU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7fd47e0e56087cd3b5fd76a532bdc3ac331e832e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7fd47e0e56087cd3b5fd76a532bdc3ac331e832e",
      "tree": {
        "sha": "15f301ec61307299c7265c5c550ee89ee1ec9e05",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/15f301ec61307299c7265c5c550ee89ee1ec9e05"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 15f301ec61307299c7265c5c550ee89ee1ec9e05\nparent f0a21831087410687c4ca31ac00e44f380b859be\nauthor Lőrinc <pap.lorinc@gmail.com> 1747225928 +0200\ncommitter Lőrinc <pap.lorinc@gmail.com> 1766475897 +0200\n\nbench: make `MerkleRoot` benchmark more representative\n\nTwo versions are run now, one with the mutation calculations, the other without.\nTo avoid unwanted compiler optimizations, we assert the expected hash, which should inhibit aggressive optimization.\n\nTo make the benchmark more similar to production `ComputeMerkleRoot` call sites, the input leaves-copying is made explicit before each run.\n\n> ./build/bin/bench_bitcoin -filter='MerkleRoot.*' -min-time=1000\n\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|               44.18 |       22,634,858.70 |    0.0% |      1.10 | `MerkleRoot`\n|               44.66 |       22,390,601.03 |    0.0% |      1.10 | `MerkleRootWithMutation`\n\nMassif memory measurements show the excessive memory reservations:\n\n    MB\n1.332^        :\n     | #      :\n     | #      :\n     | #      :\n     | #      :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #::::@::::::::::::::::::::::::::::::::::::::::::::::::::::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n   0 +----------------------------------------------------------------------->s\n     0                                                                   226.2\n\nshowing the reallocations clearly in the stacks:\n97.87% (1,366,841B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\n->41.25% (576,064B) 0x969717: allocate (new_allocator.h:151)\n| ->41.25% (576,064B) 0x969717: allocate (allocator.h:203)\n|   ->41.25% (576,064B) 0x969717: allocate (alloc_traits.h:614)\n|     ->41.25% (576,064B) 0x969717: _M_allocate (stl_vector.h:387)\n|       ->41.25% (576,064B) 0x969717: _M_realloc_append<const uint256&> (vector.tcc:572)\n|         ->41.25% (576,064B) 0x969717: push_back (stl_vector.h:1427)\n|           ->41.25% (576,064B) 0x969717: ComputeMerkleRoot(std::vector<uint256, std::allocator<uint256> >, bool*) (merkle.cpp:55)\n|             ->41.25% (576,064B) 0x2235A7: operator() (merkle_root.cpp:31)\n|               ->41.25% (576,064B) 0x2235A7: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\n\nCo-authored-by: Hodlinator <172445034+hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlKSHkACgkQZp//D/pH\nenb3xg/8Dpqp/7qVJc0fuZk6tS5BXcP5tY+JsnK+EIkob/BwDzc1CxOqgDTqw/TE\n8KG4nA2iQ7CIxH50+q0cxSPkWolNzjV/Yn03kuYQ1druicPrIqtSwpojffYWgXOH\noHO3+ahbTo5uNWBvmOendBtdMtIJuI6yQjAXU+cJQrDGRc9sneTjV933G/fB6DQl\nIkILLzjIAnR7ROUuMtYEEdVrVyOPmfGT8onAK94WIYH7R070hvp1fvvkeZ5tif9I\nzhtEtsUl7IuFhlfNZqwBI0gwvYZcCGg6dX7qMeEREKUDdA1yUoqPoWhnl3dtrCUr\nRLWfj6w+gIs3fOTUgo0/HOfFwjyONPACDZavxwd4/ho9OMNAVL1sMOTjQeiiENu3\ndtoMVDIHMgQ1u24rT7iRGFn0IgcM/kEvq5TzvdXzKHPaOipv8KNZrAsOQIr+wlot\nLCB9RjLp+9SGLtwgH7Uup/wYNtEppj0FER3PvM0lcUNB6Wp/rOENce3I21nGvUcV\nKN5QGV5XeNs/xWq5vufE/3KQG5fTbmsHE1KzAWPEbUHQyunlgHEdjQKDwb/JNNy5\n/PynzLtlzCdGSW1hcnUWLiMCVda+orr9KPnwd9Ot6dteodiH7BReeODS9M2pxqdM\nwfuwqFWrxmVNwWteQKIz4Nw61/M+BnaK1l1izZPwjhd1HdZNi4A=\n=mob2\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0a21831087410687c4ca31ac00e44f380b859be",
          "sha": "f0a21831087410687c4ca31ac00e44f380b859be",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f0a21831087410687c4ca31ac00e44f380b859be"
        }
      ],
      "message": "bench: make `MerkleRoot` benchmark more representative\n\nTwo versions are run now, one with the mutation calculations, the other without.\nTo avoid unwanted compiler optimizations, we assert the expected hash, which should inhibit aggressive optimization.\n\nTo make the benchmark more similar to production `ComputeMerkleRoot` call sites, the input leaves-copying is made explicit before each run.\n\n> ./build/bin/bench_bitcoin -filter='MerkleRoot.*' -min-time=1000\n\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|               44.18 |       22,634,858.70 |    0.0% |      1.10 | `MerkleRoot`\n|               44.66 |       22,390,601.03 |    0.0% |      1.10 | `MerkleRootWithMutation`\n\nMassif memory measurements show the excessive memory reservations:\n\n    MB\n1.332^        :\n     | #      :\n     | #      :\n     | #      :\n     | #      :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #    @ :\n     | #::::@::::::::::::::::::::::::::::::::::::::::::::::::::::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n     | #: ::@::::: :::::::: :: ::: :::::: : : :: ::: ::: : : : ::::@:::::@::::\n   0 +----------------------------------------------------------------------->s\n     0                                                                   226.2\n\nshowing the reallocations clearly in the stacks:\n97.87% (1,366,841B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\n->41.25% (576,064B) 0x969717: allocate (new_allocator.h:151)\n| ->41.25% (576,064B) 0x969717: allocate (allocator.h:203)\n|   ->41.25% (576,064B) 0x969717: allocate (alloc_traits.h:614)\n|     ->41.25% (576,064B) 0x969717: _M_allocate (stl_vector.h:387)\n|       ->41.25% (576,064B) 0x969717: _M_realloc_append<const uint256&> (vector.tcc:572)\n|         ->41.25% (576,064B) 0x969717: push_back (stl_vector.h:1427)\n|           ->41.25% (576,064B) 0x969717: ComputeMerkleRoot(std::vector<uint256, std::allocator<uint256> >, bool*) (merkle.cpp:55)\n|             ->41.25% (576,064B) 0x2235A7: operator() (merkle_root.cpp:31)\n|               ->41.25% (576,064B) 0x2235A7: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\n\nCo-authored-by: Hodlinator <172445034+hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-23T07:44:57Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-05-14T12:32:08Z"
      },
      "sha": "7fd47e0e56087cd3b5fd76a532bdc3ac331e832e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNkZDgxNWYwNDhjODBjOWEzNWYwMTk3MmUwNTM3ZWI0MjUzMWFlYzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3dd815f048c80c9a35f01972e0537eb42531aec7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3dd815f048c80c9a35f01972e0537eb42531aec7",
      "tree": {
        "sha": "d11bec8cb9b4e44775e079d9647c5ffeab07c0eb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d11bec8cb9b4e44775e079d9647c5ffeab07c0eb"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d11bec8cb9b4e44775e079d9647c5ffeab07c0eb\nparent 7fd47e0e56087cd3b5fd76a532bdc3ac331e832e\nauthor Lőrinc <pap.lorinc@gmail.com> 1763814789 +0100\ncommitter Lőrinc <pap.lorinc@gmail.com> 1766475899 +0200\n\nvalidation: pre-reserve leaves to prevent reallocs with odd vtx count\n\n`ComputeMerkleRoot` duplicates the last hash when the input size is odd. If the caller provides a `std::vector` whose capacity equals its size, that extra `push_back` forces a reallocation, doubling its capacity (allocating 3x the necessary memory).\n\nThis affects roughly half of the created blocks (those with odd transaction counts), causing unnecessary memory fragmentation during every block validation.\n\nFix this by pre-reserving the vector capacity to account for the odd-count duplication. The expression `(size + 1) & ~1ULL` adds 1 to the size and clears the last bit, effectively rounding up to the next even number. This syntax produces optimal assembly across x86/ARM and 32/64-bit platforms for gcc/clang, see https://godbolt.org/z/xzscoq7nv.\n\nAlso switch from `resize` to `reserve` + `push_back` to eliminate the default construction of `uint256` objects that are immediately overwritten.\n\n> ./build/bin/bench_bitcoin -filter='MerkleRoot.*' -min-time=1000\n\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|               43.73 |       22,867,350.51 |    0.0% |      1.10 | `MerkleRoot`\n|               44.17 |       22,640,349.14 |    0.0% |      1.10 | `MerkleRootWithMutation`\n\nMassif memory measurements after show 0.8 MB peak memory usage\n\n    KB\n801.4^ #\n     | #\n     | #\n     | #\n     | #\n     | #\n     | #\n     | #                                                         :::::@:::::@:\n     | #:::@@@::@:::::::::::::::@::@:@:::@@:::::::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n   0 +----------------------------------------------------------------------->s\n     0                                                                   227.5\n\nand the stacks don't show reallocs anymore:\n96.37% (790,809B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\n->35.10% (288,064B) 0x2234AF: allocate (new_allocator.h:151)\n| ->35.10% (288,064B) 0x2234AF: allocate (allocator.h:203)\n|   ->35.10% (288,064B) 0x2234AF: allocate (alloc_traits.h:614)\n|     ->35.10% (288,064B) 0x2234AF: _M_allocate (stl_vector.h:387)\n|       ->35.10% (288,064B) 0x2234AF: reserve (vector.tcc:79)\n|         ->35.10% (288,064B) 0x2234AF: ToMerkleLeaves<std::vector<uint256>, MerkleRoot(ankerl::nanobench::Bench&)::<lambda()>::<lambda(bool, const auto:46&)> > (merkle.h:19)\n|           ->35.10% (288,064B) 0x2234AF: operator() (merkle_root.cpp:25)\n|             ->35.10% (288,064B) 0x2234AF: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\n\nCo-authored-by: optout21 <13562139+optout21@users.noreply.github.com>\nCo-authored-by: Hodlinator <172445034+hodlinator@users.noreply.github.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqXy8dDLWkKQdUrTAZp//D/pHenYFAmlKSHsACgkQZp//D/pH\nenaBpQ/+MwobgYiByXo2Dyn6YsrJKY93GeXH+tYtdFc78a+/ZqTqb3nLqfxW3R+B\nV2vk669WOMJwz4anqCqDErHVhXZ6TQWsQVRXi8yPrO5fabwNDmntAa8qFlO6cpL3\n1X6YX7Jbx7mDei9bGeQeLffdCA0L3uN4xz2Ke3/jnevMDixm2SIckquGfDRu3WoW\nB9VQbYcZ+xL3sNhQRLkiG6KNGzUjjHw9McCGgjHbO8V34kqHGVX4P5lc4UsxCROe\nUvL0ufJqigW4KYWOZA6XGkqeH6p/OP5wdxcscc+41OSwtwjYIYMyCJw/yfyFvGFS\n+nT7YiJrCsLYGDyjs/fMAr/I6+4ofeiTLq+FP1u7YArojwqpYjN7BxxyejtBWfIW\naigNsI7ohoGWKL0xKHX0TP7QqQYbgXrG9t2VX3WkEIZJubiGmCM4QKCLLtS0vSmR\nd4djqn6C6SDCprsEj5W1P/tGi/Zr3p/vgzw0kxoaIT5l1jpVjWXhlBpyeDZnlf5y\nSlKyZmuxB03oxo4nLD4d1ddGB04Nod9Cwy3/g4wXFHVIEQHACwWlRzMnfwO2KNdi\nwLYA/FuWmT7Fs+OHqXjIEqffyeuWoElTGYNF7e1nmE5W3zp2iV9IKtvGBeV8IFvf\n2sUXIALtp+NOkhv9UYpRMYjLvtStYBKZ5/uXjddl2uPOjcvgdVo=\n=Mr2N\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7fd47e0e56087cd3b5fd76a532bdc3ac331e832e",
          "sha": "7fd47e0e56087cd3b5fd76a532bdc3ac331e832e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7fd47e0e56087cd3b5fd76a532bdc3ac331e832e"
        }
      ],
      "message": "validation: pre-reserve leaves to prevent reallocs with odd vtx count\n\n`ComputeMerkleRoot` duplicates the last hash when the input size is odd. If the caller provides a `std::vector` whose capacity equals its size, that extra `push_back` forces a reallocation, doubling its capacity (allocating 3x the necessary memory).\n\nThis affects roughly half of the created blocks (those with odd transaction counts), causing unnecessary memory fragmentation during every block validation.\n\nFix this by pre-reserving the vector capacity to account for the odd-count duplication. The expression `(size + 1) & ~1ULL` adds 1 to the size and clears the last bit, effectively rounding up to the next even number. This syntax produces optimal assembly across x86/ARM and 32/64-bit platforms for gcc/clang, see https://godbolt.org/z/xzscoq7nv.\n\nAlso switch from `resize` to `reserve` + `push_back` to eliminate the default construction of `uint256` objects that are immediately overwritten.\n\n> ./build/bin/bench_bitcoin -filter='MerkleRoot.*' -min-time=1000\n\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\n|--------------------:|--------------------:|--------:|----------:|:----------\n|               43.73 |       22,867,350.51 |    0.0% |      1.10 | `MerkleRoot`\n|               44.17 |       22,640,349.14 |    0.0% |      1.10 | `MerkleRootWithMutation`\n\nMassif memory measurements after show 0.8 MB peak memory usage\n\n    KB\n801.4^ #\n     | #\n     | #\n     | #\n     | #\n     | #\n     | #\n     | #                                                         :::::@:::::@:\n     | #:::@@@::@:::::::::::::::@::@:@:::@@:::::::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n     | #:::@ @: @:::::::::::::::@::@:@:::@ :::: ::::@::::::@:::::@::::@:::::@:\n   0 +----------------------------------------------------------------------->s\n     0                                                                   227.5\n\nand the stacks don't show reallocs anymore:\n96.37% (790,809B) (heap allocation functions) malloc/new/new[], --alloc-fns, etc.\n->35.10% (288,064B) 0x2234AF: allocate (new_allocator.h:151)\n| ->35.10% (288,064B) 0x2234AF: allocate (allocator.h:203)\n|   ->35.10% (288,064B) 0x2234AF: allocate (alloc_traits.h:614)\n|     ->35.10% (288,064B) 0x2234AF: _M_allocate (stl_vector.h:387)\n|       ->35.10% (288,064B) 0x2234AF: reserve (vector.tcc:79)\n|         ->35.10% (288,064B) 0x2234AF: ToMerkleLeaves<std::vector<uint256>, MerkleRoot(ankerl::nanobench::Bench&)::<lambda()>::<lambda(bool, const auto:46&)> > (merkle.h:19)\n|           ->35.10% (288,064B) 0x2234AF: operator() (merkle_root.cpp:25)\n|             ->35.10% (288,064B) 0x2234AF: ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<MerkleRoot(ankerl::nanobench::Bench&)::{lambda()\n\nCo-authored-by: optout21 <13562139+optout21@users.noreply.github.com>\nCo-authored-by: Hodlinator <172445034+hodlinator@users.noreply.github.com>",
      "committer": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-12-23T07:44:59Z"
      },
      "author": {
        "name": "Lőrinc",
        "email": "pap.lorinc@gmail.com",
        "date": "2025-11-22T12:33:09Z"
      },
      "sha": "3dd815f048c80c9a35f01972e0537eb42531aec7"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21720165628,
      "node_id": "HRFPE_lADOABII5862klqrzwAAAAUOn2z8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21720165628",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/3dd815f048c80c9a35f01972e0537eb42531aec7",
      "created_at": "2025-12-23T07:45:48Z"
    },
    {
      "event": "reviewed",
      "id": 3624328843,
      "node_id": "PRR_kwDOABII587YBt6L",
      "url": null,
      "actor": null,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-03T12:52:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK 3dd815f048c80c9a35f01972e0537eb42531aec7\r\n\r\nChanges since previous ACK (https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3567608553):\r\n* Remove confusing assert in benchmark (https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2641466404).\r\n* Updated benchmark timing results in commit messsages.",
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3624328843",
      "submitted_at": "2026-01-03T12:52:18Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "review_requested",
      "id": 21835939330,
      "node_id": "RRE_lADOABII5862klqrzwAAAAUVhf4C",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21835939330",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-03T12:52:24Z",
      "requested_reviewer": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 22055384329,
      "node_id": "RRE_lADOABII5862klqrzwAAAAUimnUJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22055384329",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T22:40:57Z",
      "requested_reviewer": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 3664290763,
      "node_id": "PRR_kwDOABII587aaKPL",
      "url": null,
      "actor": null,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-15T07:43:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 3dd815f048c80c9a35f01972e0537eb42531aec7",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3664290763",
      "submitted_at": "2026-01-15T07:43:16Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3667031029,
      "node_id": "PRR_kwDOABII587aknP1",
      "url": null,
      "actor": null,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-15T19:44:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 3dd815f048c80c9a35f01972e0537eb42531aec7 with minor nits.\r\n\r\nOn my machine, the Massif data clearly shows the improvement.\r\n\r\nBenchmark Results\r\n  \r\n| Version | Benchmark | ns/leaf | leaf/s |\r\n| ------------- | ------------- |  ------------- |  ------------- |\r\n| After (optimized)| MerkleRoot |46.50 | 21.5M |\r\n| After (optimized) | MerkleRootWithMutation | 45.97 | 21.8M |\r\n| Before (master) | MerkleRoot | 47.19 | 21.2M |\r\n\r\n  Massif Memory Results\r\n  \r\n| Metric | Before (master) | After (optimized) | Change |\r\n| ------------- | ------------- |  ------------- |  ------------- |\r\n| Peak memory | 1.34 MB | 802 KB | -40% |\r\n| Reallocation overhead | 576 KB (41%) | 0 | Eliminated |\r\n\r\n1. Memory reduction: 1.34 MB → 0.80 MB\r\n2. Reallocation eliminated: The _M_realloc_insert stack trace is gone entirely\r\n3. No performance regression: ~47 ns/leaf before and after\r\n",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3667031029",
      "submitted_at": "2026-01-15T19:44:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "reviewed",
      "id": 3677843063,
      "node_id": "PRR_kwDOABII587bN253",
      "url": null,
      "actor": null,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-19T13:43:51Z",
      "author_association": "MEMBER",
      "body": "Code review ACK 3dd815f048",
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-3677843063",
      "submitted_at": "2026-01-19T13:43:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
    },
    {
      "event": "commented",
      "id": 3775448354,
      "node_id": "IC_kwDOABII587hCMUi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3775448354",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T23:37:17Z",
      "updated_at": "2026-01-20T23:37:17Z",
      "author_association": "MEMBER",
      "body": "ACK 3dd815f048c80c9a35f01972e0537eb42531aec7",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3775448354",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32497"
    },
    {
      "event": "merged",
      "id": 22174948805,
      "node_id": "ME_lADOABII5862klqrzwAAAAUput3F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22174948805",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8c07800b193e94740a20f40d3e7c6626a59dd21f",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8c07800b193e94740a20f40d3e7c6626a59dd21f",
      "created_at": "2026-01-20T23:47:26Z"
    },
    {
      "event": "closed",
      "id": 22174948881,
      "node_id": "CE_lADOABII5862klqrzwAAAAUput4R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22174948881",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-20T23:47:26Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097711372",
      "pull_request_review_id": 2853787748,
      "id": 2097711372,
      "node_id": "PRRC_kwDOABII5859CIkM",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This assumes `size_t` is `unsigned long long` I think? Can we avoid that easily?",
      "created_at": "2025-05-20T11:25:51Z",
      "updated_at": "2025-05-20T11:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097711372",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097711372"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097724115",
      "pull_request_review_id": 2853787748,
      "id": 2097724115,
      "node_id": "PRRC_kwDOABII5859CLrT",
      "diff_hunk": "@@ -11,16 +11,15 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    std::vector<uint256> leaves(9000); // even number of leaves",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "899e4662374e73e3b5a3fb5b22fba8e94d64a49f",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Wouldn't it be better to benchmark the less-performant input?",
      "created_at": "2025-05-20T11:33:07Z",
      "updated_at": "2025-05-20T11:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097724115",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097724115"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097725346",
      "pull_request_review_id": 2853787748,
      "id": 2097725346,
      "node_id": "PRRC_kwDOABII5859CL-i",
      "diff_hunk": "@@ -11,16 +11,15 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    std::vector<uint256> leaves(9000); // even number of leaves\n     for (auto& item : leaves) {\n         item = rng.rand256();\n     }\n     bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+        bool mutation{false};\n+        const uint256 hash{ComputeMerkleRoot(std::vector(leaves), &mutation)};\n+        assert(mutation == false && hash == uint256{\"18ff9b2bef46a834b2625871b2839fec3b67fc1243920c424858324fbde1a8de\"});",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "899e4662374e73e3b5a3fb5b22fba8e94d64a49f",
      "in_reply_to_id": null,
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How does this avoid optimisations?",
      "created_at": "2025-05-20T11:33:49Z",
      "updated_at": "2025-05-20T11:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097725346",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097725346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097962172",
      "pull_request_review_id": 2854173281,
      "id": 2097962172,
      "node_id": "PRRC_kwDOABII5859DFy8",
      "diff_hunk": "@@ -11,16 +11,15 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    std::vector<uint256> leaves(9000); // even number of leaves\n     for (auto& item : leaves) {\n         item = rng.rand256();\n     }\n     bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+        bool mutation{false};\n+        const uint256 hash{ComputeMerkleRoot(std::vector(leaves), &mutation)};\n+        assert(mutation == false && hash == uint256{\"18ff9b2bef46a834b2625871b2839fec3b67fc1243920c424858324fbde1a8de\"});",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "899e4662374e73e3b5a3fb5b22fba8e94d64a49f",
      "in_reply_to_id": 2097725346,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "the `ComputeMerkleRoot` calculation has to be performed to be able to validate this assert - it's can't eliminate the call.",
      "created_at": "2025-05-20T13:21:31Z",
      "updated_at": "2025-05-20T13:28:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097962172",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097962172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097969142",
      "pull_request_review_id": 2854173281,
      "id": 2097969142,
      "node_id": "PRRC_kwDOABII5859DHf2",
      "diff_hunk": "@@ -11,16 +11,15 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    std::vector<uint256> leaves(9000); // even number of leaves",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "899e4662374e73e3b5a3fb5b22fba8e94d64a49f",
      "in_reply_to_id": 2097724115,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "After this change all call-sites are pre-sized to even number of leaves, so this reflects the usage better.\r\nI could also round to `9002` to mimic the new `leaves.reserve((9001 + 1) & ~1ULL)` behavior, if you thinks that's more representative.",
      "created_at": "2025-05-20T13:24:35Z",
      "updated_at": "2025-05-20T13:28:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097969142",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097969142"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097976720",
      "pull_request_review_id": 2854173281,
      "id": 2097976720,
      "node_id": "PRRC_kwDOABII5859DJWQ",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we could either do `size_t{1}` or `leaves.reserve(block.vtx.size() + (block.vtx.size() & 1))`, I think, if you think this could be problematic on 32 bit systems.",
      "created_at": "2025-05-20T13:27:20Z",
      "updated_at": "2025-05-20T13:29:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2097976720",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2097976720"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2147507046",
      "pull_request_review_id": 2929061513,
      "id": 2147507046,
      "node_id": "PRRC_kwDOABII586AAFtm",
      "diff_hunk": "@@ -11,16 +11,15 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+    std::vector<uint256> leaves(9000); // even number of leaves",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 8,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "899e4662374e73e3b5a3fb5b22fba8e94d64a49f",
      "in_reply_to_id": 2097724115,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "added back `9001`",
      "created_at": "2025-06-15T09:35:50Z",
      "updated_at": "2025-06-15T10:07:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2147507046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2147507046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 15,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2147507192",
      "pull_request_review_id": 2929061513,
      "id": 2147507192,
      "node_id": "PRRC_kwDOABII586AAFv4",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I ended up with `block.vtx.size() + (block.vtx.size() & 1)` - if the value ends with a 1, it's an odd number and we increment it to make it even",
      "created_at": "2025-06-15T09:36:33Z",
      "updated_at": "2025-06-15T10:07:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2147507192",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2147507192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158435570",
      "pull_request_review_id": 2945160215,
      "id": 2158435570,
      "node_id": "PRRC_kwDOABII586Apxzy",
      "diff_hunk": "@@ -11,16 +11,27 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    constexpr size_t block_vtx_size{9001}; // Must be odd to test the special case of the last hash being duplicated.\n     std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n-        item = rng.rand256();\n+    leaves.resize(block_vtx_size);\n+    for (auto& h : leaves) h = rng.rand256();",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "064f33bbe2b646a43f37807785c59e1031029131",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "why is this changed. touching a line to only remove the {} after the for loop seems odd and I had the impression that the dev notes preferred to use {}",
      "created_at": "2025-06-20T09:11:12Z",
      "updated_at": "2025-06-20T09:22:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158435570",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158435570"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": 17,
      "start_side": "LEFT",
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158441331",
      "pull_request_review_id": 2945160215,
      "id": 2158441331,
      "node_id": "PRRC_kwDOABII586ApzNz",
      "diff_hunk": "@@ -11,16 +11,27 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    constexpr size_t block_vtx_size{9001}; // Must be odd to test the special case of the last hash being duplicated.\n     std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n-        item = rng.rand256();\n+    leaves.resize(block_vtx_size);\n+    for (auto& h : leaves) h = rng.rand256();\n+\n+    constexpr size_t iterations{1000};\n+    std::vector<std::vector<uint256>> cases(iterations);",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "064f33bbe2b646a43f37807785c59e1031029131",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "not sure about pre-allocating. All real code paths allocate in-line for each iteration, so the benchmark should follow that. This would also avoid eating 100+mb for a microbenchmark?",
      "created_at": "2025-06-20T09:14:12Z",
      "updated_at": "2025-06-20T09:22:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158441331",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158441331"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158453448",
      "pull_request_review_id": 2945160215,
      "id": 2158453448,
      "node_id": "PRRC_kwDOABII586Ap2LI",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    for (const auto& tx : block.vtx) {\n+        leaves.emplace_back(tx->GetHash());",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "why is this changed? I don't think a byte array can meaningfully be moved (of course it compiles, but moving a byte is no different than copying it)",
      "created_at": "2025-06-20T09:19:21Z",
      "updated_at": "2025-06-20T09:22:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158453448",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158453448"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158456828",
      "pull_request_review_id": 2945160215,
      "id": 2158456828,
      "node_id": "PRRC_kwDOABII586Ap2_8",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    for (const auto& tx : block.vtx) {\n+        leaves.emplace_back(tx->GetHash());\n     }\n     return ComputeMerkleRoot(std::move(leaves), mutated);\n }\n \n uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    leaves[0].SetNull(); // The witness hash of the coinbase is 0.\n-    for (size_t s = 1; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetWitnessHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    leaves.emplace_back(); // The witness hash of the coinbase is 0.\n+    for (size_t i{1}; i < block.vtx.size(); ++i) {",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 23,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "why is this changed? I don't think it is worth to touch a line just to change the name of the variable from one single char to another single char.",
      "created_at": "2025-06-20T09:20:41Z",
      "updated_at": "2025-06-20T09:22:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158456828",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158456828"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 81,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158650714",
      "pull_request_review_id": 2945559978,
      "id": 2158650714,
      "node_id": "PRRC_kwDOABII586AqmVa",
      "diff_hunk": "@@ -11,16 +11,27 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    constexpr size_t block_vtx_size{9001}; // Must be odd to test the special case of the last hash being duplicated.\n     std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n-        item = rng.rand256();\n+    leaves.resize(block_vtx_size);\n+    for (auto& h : leaves) h = rng.rand256();\n+\n+    constexpr size_t iterations{1000};\n+    std::vector<std::vector<uint256>> cases(iterations);",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "064f33bbe2b646a43f37807785c59e1031029131",
      "in_reply_to_id": 2158441331,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I wanted to explicitly only measure the `ComputeMerkleRoot` call here without collecting hashes into a vector.\r\nBut if you think that part should de included, I don't mind, but in that case we won't measure the behavior change in `ComputeMerkleRoot` anymore.\r\nHowever, I think the proper allocation makes sense regardless -  e.g. for 2001 entries now we'll allocate 2002 entries instead of 4002 like before.",
      "created_at": "2025-06-20T10:42:10Z",
      "updated_at": "2025-06-20T11:24:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158650714",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158650714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 22,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723337",
      "pull_request_review_id": 2945559978,
      "id": 2158723337,
      "node_id": "PRRC_kwDOABII586Aq4EJ",
      "diff_hunk": "@@ -11,16 +11,27 @@\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    constexpr size_t block_vtx_size{9001}; // Must be odd to test the special case of the last hash being duplicated.\n     std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n-        item = rng.rand256();\n+    leaves.resize(block_vtx_size);\n+    for (auto& h : leaves) h = rng.rand256();",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 13,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "064f33bbe2b646a43f37807785c59e1031029131",
      "in_reply_to_id": 2158435570,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm fine with both, reverted.",
      "created_at": "2025-06-20T11:19:33Z",
      "updated_at": "2025-06-20T11:24:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158723337",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723337"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": 17,
      "start_side": "LEFT",
      "line": null,
      "original_line": 19,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723447",
      "pull_request_review_id": 2945559978,
      "id": 2158723447,
      "node_id": "PRRC_kwDOABII586Aq4F3",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    for (const auto& tx : block.vtx) {\n+        leaves.emplace_back(tx->GetHash());",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 9,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "in_reply_to_id": 2158453448,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "After I have used `leaves.emplace_back(); // The witness hash of the coinbase is 0` in `BlockWitnessMerkleRoot` it seemed more consistent to me to use `emplace_back` in `BlockMerkleRoot` as well - as you said it should do the same.\r\nI'm fine with both, I've changed them inside the loop to `push_back`.",
      "created_at": "2025-06-20T11:19:36Z",
      "updated_at": "2025-06-20T11:24:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158723447",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723518",
      "pull_request_review_id": 2945559978,
      "id": 2158723518,
      "node_id": "PRRC_kwDOABII586Aq4G-",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    for (const auto& tx : block.vtx) {\n+        leaves.emplace_back(tx->GetHash());\n     }\n     return ComputeMerkleRoot(std::move(leaves), mutated);\n }\n \n uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    leaves[0].SetNull(); // The witness hash of the coinbase is 0.\n-    for (size_t s = 1; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetWitnessHash();\n+    leaves.reserve(block.vtx.size() + (block.vtx.size() & 1)); // capacity rounded up to even\n+    leaves.emplace_back(); // The witness hash of the coinbase is 0.\n+    for (size_t i{1}; i < block.vtx.size(); ++i) {",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 23,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "4cc5942895673591de4edceb6dd0c7188c302a72",
      "in_reply_to_id": 2158456828,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "There was no other loops with the same variable after the change anymore, so it doesn't need to be a non-standard loop variable name (wasn't sure what `s` meant in this context) - but  since it's important to you I've reverted them.",
      "created_at": "2025-06-20T11:19:39Z",
      "updated_at": "2025-06-20T11:24:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158723518",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2158723518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 81,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264185044",
      "pull_request_review_id": 3102373739,
      "id": 2264185044,
      "node_id": "PRRC_kwDOABII586G9LjU",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This reserve seems to be for `ComputeMerkleRoot`. However, I think it would be better to have `ComputeMerkleRoot` do any reservations necessary rather than relying on the caller to do so.",
      "created_at": "2025-08-09T01:34:54Z",
      "updated_at": "2025-08-09T01:34:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264185044",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264185044"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264209340",
      "pull_request_review_id": 3102399396,
      "id": 2264209340,
      "node_id": "PRRC_kwDOABII586G9Re8",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`ComputeMerkleRoot` already received a list of values, usually sized to fit their current size exactly (i.e. `capacity()` == `size()`). We can of course increase the capacity inside - it's what:\r\n```C++\r\nif (hashes.size() & 1) {\r\n    hashes.push_back(hashes.back());\r\n}\r\n```\r\ndoes already, but if we want to avoid reallocations, we have to predict the size of the vector before we start populating it.\r\n\r\n-----\r\n\r\nWe could add some kind of lambda as a parameter and an expected size maybe, something like:\r\n```C++\r\ntemplate <typename Gen>\r\nuint256 GenerateMerkleRoot(std::size_t count, Gen&& gen, bool* mutated = nullptr)\r\n{\r\n    std::vector<uint256> leaves;\r\n    leaves.reserve(RoundUpToEven(count));\r\n    for (std::size_t i{0}; i < count; ++i) {\r\n        leaves.push_back(gen(i));\r\n    }\r\n    return ComputeMerkleRoot(std::move(leaves), mutated);\r\n}\r\n```\r\nand the production code callers would look like:\r\n```C++\r\nstatic uint256 ComputeModifiedMerkleRoot(const CMutableTransaction& cb, const CBlock& block)\r\n{\r\n    return GenerateMerkleRoot(block.vtx.size(), [&](auto i) { return i == 0 ? cb.GetHash() : block.vtx[i]->GetHash(); });\r\n}\r\n\r\nuint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\r\n{\r\n    return GenerateMerkleRoot(block.vtx.size(), [&](auto i) { return block.vtx[i]->GetHash(); }, mutated);\r\n}\r\nuint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\r\n{\r\n    return GenerateMerkleRoot(block.vtx.size(), [&](auto i) { return i == 0 ? uint256{} : uint256(block.vtx[i]->GetWitnessHash()); }, mutated);\r\n}\r\n```\r\n\r\nWould that be simpler in your opinion?\r\n\r\n<details>\r\n<summary>Patch</summary>\r\n\r\n```patch\r\ndiff --git a/src/consensus/merkle.cpp b/src/consensus/merkle.cpp\r\nindex 8c56d979a5..a0e358b005 100644\r\n--- a/src/consensus/merkle.cpp\r\n+++ b/src/consensus/merkle.cpp\r\n@@ -5,7 +5,6 @@\r\n #include <consensus/merkle.h>\r\n #include <hash.h>\r\n #include <util/check.h>\r\n-#include <util/ints.h>\r\n \r\n /*     WARNING! If you're reading this because you're learning about crypto\r\n        and/or designing a new system that will use merkle trees, keep in mind\r\n@@ -63,26 +62,14 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\r\n     return hashes[0];\r\n }\r\n \r\n-\r\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\r\n {\r\n-    std::vector<uint256> leaves;\r\n-    leaves.reserve(RoundUpToEven(block.vtx.size()));\r\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\r\n-        leaves.push_back(block.vtx[s]->GetHash());\r\n-    }\r\n-    return ComputeMerkleRoot(std::move(leaves), mutated);\r\n+    return GenerateMerkleRoot(block.vtx.size(), [&](auto i) { return block.vtx[i]->GetHash(); }, mutated);\r\n }\r\n \r\n uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\r\n {\r\n-    std::vector<uint256> leaves;\r\n-    leaves.reserve(RoundUpToEven(block.vtx.size()));\r\n-    leaves.emplace_back(); // The witness hash of the coinbase is 0.\r\n-    for (size_t s = 1; s < block.vtx.size(); s++) {\r\n-        leaves.push_back(block.vtx[s]->GetWitnessHash());\r\n-    }\r\n-    return ComputeMerkleRoot(std::move(leaves), mutated);\r\n+    return GenerateMerkleRoot(block.vtx.size(), [&](auto i) { return i == 0 ? uint256{} : uint256(block.vtx[i]->GetWitnessHash()); }, mutated);\r\n }\r\n \r\n /* This implements a constant-space merkle root/path calculator, limited to 2^32 leaves. */\r\ndiff --git a/src/consensus/merkle.h b/src/consensus/merkle.h\r\nindex c722cbe446..8b5c14157a 100644\r\n--- a/src/consensus/merkle.h\r\n+++ b/src/consensus/merkle.h\r\n@@ -9,9 +9,21 @@\r\n \r\n #include <primitives/block.h>\r\n #include <uint256.h>\r\n+#include <util/ints.h>\r\n \r\n uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated = nullptr);\r\n \r\n+template <typename Gen>\r\n+uint256 GenerateMerkleRoot(std::size_t count, Gen&& gen, bool* mutated = nullptr)\r\n+{\r\n+    std::vector<uint256> leaves;\r\n+    leaves.reserve(RoundUpToEven(count));\r\n+    for (std::size_t i{0}; i < count; ++i) {\r\n+        leaves.push_back(gen(i));\r\n+    }\r\n+    return ComputeMerkleRoot(std::move(leaves), mutated);\r\n+}\r\n+\r\n /*\r\n  * Compute the Merkle root of the transactions in a block.\r\n  * *mutated is set to true if a duplicated subtree was found.\r\ndiff --git a/src/signet.cpp b/src/signet.cpp\r\nindex 3104b7f2d7..5aea084f15 100644\r\n--- a/src/signet.cpp\r\n+++ b/src/signet.cpp\r\n@@ -58,13 +58,8 @@ static bool FetchAndClearCommitmentSection(const std::span<const uint8_t> header\r\n \r\n static uint256 ComputeModifiedMerkleRoot(const CMutableTransaction& cb, const CBlock& block)\r\n {\r\n-    std::vector<uint256> leaves;\r\n-    leaves.reserve(RoundUpToEven(block.vtx.size()));\r\n-    leaves.push_back(cb.GetHash());\r\n-    for (size_t s = 1; s < block.vtx.size(); ++s) {\r\n-        leaves.push_back(block.vtx[s]->GetHash());\r\n-    }\r\n-    return ComputeMerkleRoot(std::move(leaves));\r\n+    return GenerateMerkleRoot(block.vtx.size(),\r\n+        [&](auto i) { return i ? block.vtx[i]->GetHash() : cb.GetHash(); });\r\n }\r\n \r\n std::optional<SignetTxs> SignetTxs::Create(const CBlock& block, const CScript& challenge)\r\n```\r\n\r\n</details>",
      "created_at": "2025-08-09T02:32:50Z",
      "updated_at": "2025-08-09T02:34:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264209340",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264209340"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264546311",
      "pull_request_review_id": 3102794795,
      "id": 2264546311,
      "node_id": "PRRC_kwDOABII586G-jwH",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Would that be simpler in your opinion?\r\n\r\nNo.\r\n\r\n> but if we want to avoid reallocations, we have to predict the size of the vector before we start populating it.\r\n\r\nWe can also avoid inserting into the vector in the first place, e.g. this diff gives me about the same speedup without needing to change anything with allocations:\r\n\r\n```diff\r\ndiff --git a/src/consensus/merkle.cpp b/src/consensus/merkle.cpp\r\nindex 7dd24e1868f..46056bfa3e0 100644\r\n--- a/src/consensus/merkle.cpp\r\n+++ b/src/consensus/merkle.cpp\r\n@@ -44,6 +44,7 @@\r\n \r\n \r\n uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\r\n+    std::array<uint256, 2> odd_hash;\r\n     bool mutation = false;\r\n     while (hashes.size() > 1) {\r\n         if (mutated) {\r\n@@ -51,11 +52,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\r\n                 if (hashes[pos] == hashes[pos + 1]) mutation = true;\r\n             }\r\n         }\r\n-        if (hashes.size() & 1) {\r\n+        bool need_dup = hashes.capacity() == hashes.size() && (hashes.size() & 1);\r\n+        if (need_dup) {\r\n+            odd_hash[0] = hashes.back();\r\n+            odd_hash[1] = hashes.back();\r\n+        } else if (hashes.size() & 1) {\r\n             hashes.push_back(hashes.back());\r\n         }\r\n         SHA256D64(hashes[0].begin(), hashes[0].begin(), hashes.size() / 2);\r\n         hashes.resize(hashes.size() / 2);\r\n+        if (need_dup) {\r\n+            SHA256D64(odd_hash[0].begin(), odd_hash[0].begin(), 1);\r\n+            assert(hashes.capacity() > hashes.size());\r\n+            hashes.push_back(odd_hash[0]);\r\n+        }\r\n     }\r\n     if (mutated) *mutated = mutation;\r\n     if (hashes.size() == 0) return uint256();\r\n```",
      "created_at": "2025-08-09T06:15:40Z",
      "updated_at": "2025-08-09T06:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264546311",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264546311"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264548534",
      "pull_request_review_id": 3102796645,
      "id": 2264548534,
      "node_id": "PRRC_kwDOABII586G-kS2",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Clever, we can of course calculate the extra value independently, but isn't it a lot simpler to just precalculate the final size before insertions and keep `ComputeMerkleRoot` unchanged?",
      "created_at": "2025-08-09T06:21:35Z",
      "updated_at": "2025-08-09T06:21:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264548534",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264548534"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264562128",
      "pull_request_review_id": 3102810494,
      "id": 2264562128,
      "node_id": "PRRC_kwDOABII586G-nnQ",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think it's simpler if the caller does not have to be aware that they should allocate a larger vector to be passed in.",
      "created_at": "2025-08-09T06:58:35Z",
      "updated_at": "2025-08-09T06:58:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264562128",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264562128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264825655",
      "pull_request_review_id": 3103110903,
      "id": 2264825655,
      "node_id": "PRRC_kwDOABII586G_n83",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The lambda solution is even simpler in that case, the caller doesn't even have to allocate or iterate at all.",
      "created_at": "2025-08-09T15:41:12Z",
      "updated_at": "2025-08-09T15:41:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2264825655",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2264825655"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2274585659",
      "pull_request_review_id": 3117633551,
      "id": 2274585659,
      "node_id": "PRRC_kwDOABII586Hk2w7",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Addressed it in a different way in latest push, let me know if this solves your concern or if it's orthogonal.",
      "created_at": "2025-08-13T20:44:55Z",
      "updated_at": "2025-08-13T20:44:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2274585659",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2274585659"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550683488",
      "pull_request_review_id": 3493993983,
      "id": 2550683488,
      "node_id": "PRRC_kwDOABII586YCFdg",
      "diff_hunk": "@@ -236,12 +236,10 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n \n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n-    std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n-\n-    uint256 merkleRootofHashes = ComputeMerkleRoot(hashes);\n+    auto leaves{ToMerkleLeaves(block.vtx, [&](bool first, const auto& tx) {\n+        return first ? uint256{} : tx->GetWitnessHash().ToUint256();",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Why are we changing from `GetHash()` to `GetWitnessHash()` here?\n\nFor txs without witness data they return the same value, which master seems to implicitly validate.",
      "created_at": "2025-11-21T18:54:09Z",
      "updated_at": "2025-11-21T21:31:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2550683488",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550683488"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550702253",
      "pull_request_review_id": 3493993983,
      "id": 2550702253,
      "node_id": "PRRC_kwDOABII586YCKCt",
      "diff_hunk": "@@ -62,25 +62,19 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n     return hashes[0];\n }\n \n-\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n-    std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash().ToUint256();\n-    }\n+    auto leaves{ToMerkleLeaves(block.vtx, [&](auto _, const auto& tx) {",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If we keep the lambda, `_` is more the Python way of declaring unused variables, while C/C++ usually omits the identifier entirely:\r\n```suggestion\r\n    auto leaves{ToMerkleLeaves(block.vtx, [](bool, const auto& tx) {\r\n```\r\nor\r\n```suggestion\r\n    auto leaves{ToMerkleLeaves(block.vtx, [](auto /*first*/, const auto& tx) {\r\n```\r\nNotice I also removed the capture-`&` when it is not needed, which makes the lambda more pure (less cognitive load). (Also prefer `bool` over `auto` since it doesn't cost a single char, but that's more subjective).\r\n\r\n<details><summary>Full diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/merkle_root.cpp b/src/bench/merkle_root.cpp\r\nindex bd8524c805..55baed6e02 100644\r\n--- a/src/bench/merkle_root.cpp\r\n+++ b/src/bench/merkle_root.cpp\r\n@@ -22,7 +22,7 @@ static void MerkleRoot(benchmark::Bench& bench)\r\n \r\n     constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\r\n     bench.batch(hashes.size()).unit(\"leaf\").run([&] {\r\n-        auto leaves{ToMerkleLeaves(hashes, [&](bool, const auto& h) { return h; })};\r\n+        auto leaves{ToMerkleLeaves(hashes, [](bool, const auto& h) { return h; })};\r\n         const uint256 root{ComputeMerkleRoot(std::move(leaves))};\r\n         assert(root == expected_root);\r\n     });\r\ndiff --git a/src/consensus/merkle.cpp b/src/consensus/merkle.cpp\r\nindex 4f637110dd..41eb1f6e5a 100644\r\n--- a/src/consensus/merkle.cpp\r\n+++ b/src/consensus/merkle.cpp\r\n@@ -64,7 +64,7 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\r\n \r\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\r\n {\r\n-    auto leaves{ToMerkleLeaves(block.vtx, [&](auto _, const auto& tx) {\r\n+    auto leaves{ToMerkleLeaves(block.vtx, [](bool, const auto& tx) {\r\n         return tx->GetHash().ToUint256();\r\n     })};\r\n     return ComputeMerkleRoot(std::move(leaves), mutated);\r\n@@ -72,7 +72,7 @@ uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\r\n \r\n uint256 BlockWitnessMerkleRoot(const CBlock& block, bool* mutated)\r\n {\r\n-    auto leaves{ToMerkleLeaves(block.vtx, [&](auto first, const auto& tx) {\r\n+    auto leaves{ToMerkleLeaves(block.vtx, [](bool first, const auto& tx) {\r\n         return first ? uint256{} : tx->GetWitnessHash().ToUint256();\r\n     })};\r\n     return ComputeMerkleRoot(std::move(leaves), mutated);\r\ndiff --git a/src/signet.cpp b/src/signet.cpp\r\nindex 9c564d66d7..ed42b554f3 100644\r\n--- a/src/signet.cpp\r\n+++ b/src/signet.cpp\r\n@@ -57,7 +57,7 @@ static bool FetchAndClearCommitmentSection(const std::span<const uint8_t> header\r\n \r\n static uint256 ComputeModifiedMerkleRoot(const CMutableTransaction& cb, const CBlock& block)\r\n {\r\n-    auto leaves{ToMerkleLeaves(block.vtx, [&](auto first, const auto& tx) {\r\n+    auto leaves{ToMerkleLeaves(block.vtx, [&](bool first, const auto& tx) {\r\n         return (first ? cb.GetHash() : tx->GetHash()).ToUint256();\r\n     })};\r\n     return ComputeMerkleRoot(std::move(leaves));\r\ndiff --git a/src/test/fuzz/merkle.cpp b/src/test/fuzz/merkle.cpp\r\nindex 4ac83ffb81..b4136008e2 100644\r\n--- a/src/test/fuzz/merkle.cpp\r\n+++ b/src/test/fuzz/merkle.cpp\r\n@@ -44,7 +44,7 @@ FUZZ_TARGET(merkle)\r\n     }\r\n \r\n     const std::size_t num_txs{block->vtx.size()};\r\n-    auto tx_hashes{ToMerkleLeaves(block->vtx, [&](bool, const auto& tx) {\r\n+    auto tx_hashes{ToMerkleLeaves(block->vtx, [](bool, const auto& tx) {\r\n         return tx->GetHash().ToUint256();\r\n     })};\r\n \r\ndiff --git a/src/test/merkle_tests.cpp b/src/test/merkle_tests.cpp\r\nindex c31368c9ec..c8f8079d22 100644\r\n--- a/src/test/merkle_tests.cpp\r\n+++ b/src/test/merkle_tests.cpp\r\n@@ -236,7 +236,7 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\r\n \r\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\r\n \r\n-    auto leaves{ToMerkleLeaves(block.vtx, [&](bool first, const auto& tx) {\r\n+    auto leaves{ToMerkleLeaves(block.vtx, [](bool first, const auto& tx) {\r\n         return first ? uint256{} : tx->GetWitnessHash().ToUint256();\r\n     })};\r\n     uint256 merkleRootofHashes{ComputeMerkleRoot(std::move(leaves))};\r\n```\r\n\r\n</details>",
      "created_at": "2025-11-21T19:02:09Z",
      "updated_at": "2025-11-21T21:31:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2550702253",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550702253"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 67,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550791531",
      "pull_request_review_id": 3493993983,
      "id": 2550791531,
      "node_id": "PRRC_kwDOABII586YCf1r",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "How about `(txs.size() + 1) & ~(decltype(txs.size()){1})`? Accessing `txs.size()` one time less at runtime. :)",
      "created_at": "2025-11-21T19:44:20Z",
      "updated_at": "2025-11-21T21:31:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2550791531",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2550791531"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2552816773",
      "pull_request_review_id": 3496417072,
      "id": 2552816773,
      "node_id": "PRRC_kwDOABII586YKOSF",
      "diff_hunk": "@@ -236,12 +236,10 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n \n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n-    std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n-\n-    uint256 merkleRootofHashes = ComputeMerkleRoot(hashes);\n+    auto leaves{ToMerkleLeaves(block.vtx, [&](bool first, const auto& tx) {\n+        return first ? uint256{} : tx->GetWitnessHash().ToUint256();",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "in_reply_to_id": 2550683488,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We're comparing it against the results of `BlockWitnessMerkleRoot` which returns `GetWitnessHash`.\r\nhttps://github.com/bitcoin/bitcoin/pull/16865 didn't specify why they're comparing `GetHash` against `GetWitnessHash` here, I deduced it's a coincidence. I don't mind keeping `GetHash` if you think it was deliberate.",
      "created_at": "2025-11-22T09:58:18Z",
      "updated_at": "2025-11-22T13:00:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2552816773",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2552816773"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 240,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553107836",
      "pull_request_review_id": 3496417072,
      "id": 2553107836,
      "node_id": "PRRC_kwDOABII586YLVV8",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Accessing txs.size() one time less at runtime\r\n\r\nThe compiler should be able to deduce that it's the same (see assembly below): https://en.wikipedia.org/wiki/Common_subexpression_elimination\r\n\r\n-----\r\n\r\nI have considered a few alternatives:\r\n```C++\r\nBOOST_AUTO_TEST_CASE(merkle_test_even_sizing)\r\n{\r\n    for (size_t size = 0; size <= 1'000'000; ++size) {\r\n        size_t reference = size + (size & 1U);\r\n\r\n        BOOST_CHECK_EQUAL(reference, (size + 1) & ~size_t{1});\r\n        BOOST_CHECK_EQUAL(reference, (size + 1) & ~1ULL);\r\n        BOOST_CHECK_EQUAL(reference, (size + 1) & -2);\r\n        BOOST_CHECK_EQUAL(reference, (size + 1) >> 1 << 1);\r\n    }\r\n}\r\n```\r\n\r\n\r\nSo I'm reverting to my my original `out.reserve((in.size() + 1) & ~1ULL); `, it seems to have the simplest C++ code and the best assembly for gcc/clang and 32/64 bits and arm/x86, see: https://godbolt.org/z/xzscoq7nv\r\n\r\n| Architecture | Bits | GCC Assembly | Clang Assembly | Notes |\r\n| :--- | :--- | :--- | :--- | :--- |\r\n| **x86** | 32 | `and eax, -2` | `and edi, 2147483646` | Clang uses `0x7FFFFFFE` (max positive signed 32-bit aligned). |\r\n| **x86-64** | 64 | `and rax, -2` | `and rbp, rax` | GCC uses immediate -2; Clang uses a register mask here. |\r\n| **ARMv7** | 32 | `bic r0, r0, #1` | `bic r6, r0, #1` | Both use \"Bit Clear\" instruction. |\r\n| **AArch64** | 64 | `and x0, x0, -2` | `and x24, x8, #0x7ffffffffffffffe` | Both use bitwise AND with ~1. |\r\n\r\n<details>\r\n<summary>Relevant assembly parts highlighted</summary>\r\n\r\n> GCC\r\n<img width=\"1244\" height=\"852\" alt=\"image\" src=\"https://github.com/user-attachments/assets/68b46e71-056f-473b-aeec-b62320bdd18c\" />\r\n<img width=\"1636\" height=\"850\" alt=\"image\" src=\"https://github.com/user-attachments/assets/d3e16097-b199-4c58-bec0-c3c6ad170e25\" />\r\n<img width=\"1626\" height=\"846\" alt=\"image\" src=\"https://github.com/user-attachments/assets/be33513f-18e9-42f9-9e60-9e757e4e6f36\" />\r\n<img width=\"1636\" height=\"838\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f9b7cb11-329e-44a4-a0b2-97b8480bffe5\" />\r\n\r\n> Clang\r\n<img width=\"1638\" height=\"702\" alt=\"image\" src=\"https://github.com/user-attachments/assets/94a2a6aa-5b40-4a79-a37f-2b3511b2ee7c\" />\r\n<img width=\"1492\" height=\"556\" alt=\"image\" src=\"https://github.com/user-attachments/assets/55fe1520-12c9-4d85-81d7-5c2f6df5c15d\" />\r\n<img width=\"1588\" height=\"984\" alt=\"image\" src=\"https://github.com/user-attachments/assets/d96ea47e-3629-449a-b402-2bd2c89a8bc1\" />\r\n<img width=\"1620\" height=\"974\" alt=\"image\" src=\"https://github.com/user-attachments/assets/cddb7d4c-3232-4718-ba02-a259d5847ea0\" />\r\n\r\n</details>",
      "created_at": "2025-11-22T12:10:21Z",
      "updated_at": "2025-11-22T13:00:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2553107836",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553107836"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553128138",
      "pull_request_review_id": 3496740181,
      "id": 2553128138,
      "node_id": "PRRC_kwDOABII586YLaTK",
      "diff_hunk": "@@ -62,25 +62,19 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n     return hashes[0];\n }\n \n-\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n-    std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash().ToUint256();\n-    }\n+    auto leaves{ToMerkleLeaves(block.vtx, [&](auto _, const auto& tx) {",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 12,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "in_reply_to_id": 2550702253,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, ended up reverting `ToMerkleLeaves` completely to simplify the review",
      "created_at": "2025-11-22T13:02:07Z",
      "updated_at": "2025-11-22T13:02:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2553128138",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553128138"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 67,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553128897",
      "pull_request_review_id": 3496740786,
      "id": 2553128897,
      "node_id": "PRRC_kwDOABII586YLafB",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Reverted to the original implementation, it's the least-invasive change with simplest diff",
      "created_at": "2025-11-22T13:04:17Z",
      "updated_at": "2025-11-22T13:04:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2553128897",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2553128897"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2567999346",
      "pull_request_review_id": 3514527691,
      "id": 2567999346,
      "node_id": "PRRC_kwDOABII586ZEI9y",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\n+        std::vector<uint256> leaves;\n+        leaves.reserve(hashes.size());\n+        for (size_t s = 0; s < hashes.size(); s++) {",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "original_commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "in_reply_to_id": null,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: consistent coding style\r\n```diff\r\n-        for (size_t s = 0; s < hashes.size(); s++) {\r\n+        for (auto s{0}; s < hashes.size(); ++s) {\r\n```",
      "created_at": "2025-11-27T10:37:46Z",
      "updated_at": "2025-11-27T10:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2567999346",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2567999346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568004847",
      "pull_request_review_id": 3514534142,
      "id": 2568004847,
      "node_id": "PRRC_kwDOABII586ZEKTv",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\n+        std::vector<uint256> leaves;\n+        leaves.reserve(hashes.size());\n+        for (size_t s = 0; s < hashes.size(); s++) {\n+            leaves.push_back(hashes[s]);\n+        }",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 31,
      "commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "original_commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "in_reply_to_id": null,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Retracted, vector size is different. Nevermind, sorry.\r\n~~nit: Could this copy be done simpler? (i.e. `leaves = hashes`, or `leaves{hashes}`)~~",
      "created_at": "2025-11-27T10:39:02Z",
      "updated_at": "2025-11-27T10:48:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568004847",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568004847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": 26,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 29,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568112479",
      "pull_request_review_id": 3514658649,
      "id": 2568112479,
      "node_id": "PRRC_kwDOABII586ZEklf",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\n+        std::vector<uint256> leaves;\n+        leaves.reserve(hashes.size());\n+        for (size_t s = 0; s < hashes.size(); s++) {",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "original_commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "in_reply_to_id": 2567999346,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I deliberately avoided changing any of that in this commit: https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2158456828",
      "created_at": "2025-11-27T11:06:48Z",
      "updated_at": "2025-11-27T11:06:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568112479",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568112479"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568419746",
      "pull_request_review_id": 3515030717,
      "id": 2568419746,
      "node_id": "PRRC_kwDOABII586ZFvmi",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\n+        std::vector<uint256> leaves;\n+        leaves.reserve(hashes.size());\n+        for (size_t s = 0; s < hashes.size(); s++) {",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "original_commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "in_reply_to_id": 2567999346,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hmm, I see this as new code added by this commit, not present in the original.",
      "created_at": "2025-11-27T12:24:52Z",
      "updated_at": "2025-11-27T12:24:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568419746",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568419746"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568873272",
      "pull_request_review_id": 3515598674,
      "id": 2568873272,
      "node_id": "PRRC_kwDOABII586ZHeU4",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\n+        std::vector<uint256> leaves;\n+        leaves.reserve(hashes.size());\n+        for (size_t s = 0; s < hashes.size(); s++) {",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "14a4dca89adaab6f1ad42af6716f9065f1abe2e1",
      "original_commit_id": "45dc62f0edf71d52ae6b024dec6b11746e3c4076",
      "in_reply_to_id": 2567999346,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "You're right, it needs more explanation:\r\nI could change this to use a more modern style, but it would be different from the code that it's trying to measure, namely:\r\nhttps://github.com/bitcoin/bitcoin/blob/9c24cda72edb2085edfa75296d6b42fab34433d9/src/consensus/merkle.cpp#L81\r\nIt's a very tiny difference, but I usually prefer the benchmark being representative of the code so that it's grep-friendly (in case we modify one and search for similar code)",
      "created_at": "2025-11-27T14:08:37Z",
      "updated_at": "2025-11-27T14:08:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568873272",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568873272"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568982833",
      "pull_request_review_id": 3515742822,
      "id": 2568982833,
      "node_id": "PRRC_kwDOABII586ZH5Ex",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "in 45dc62f0edf71d52ae6b024dec6b11746e3c4076 \"refactor: make `MerkleRoot` benchmark more representative\": Sending in the `&mutation` parameter makes the function perform more work (somewhat quadratically?). Are we sure we want to drop that?",
      "created_at": "2025-11-27T14:31:08Z",
      "updated_at": "2025-11-27T15:01:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568982833",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2568982833"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569010822",
      "pull_request_review_id": 3515742822,
      "id": 2569010822,
      "node_id": "PRRC_kwDOABII586ZH_6G",
      "diff_hunk": "@@ -227,7 +227,8 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n {\n     CBlock block;\n \n-    block.vtx.resize(2);\n+    size_t vtx_count{3};\n+    block.vtx.resize(vtx_count);",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": null,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit in 6c2d181bdc09024c5de5e29d9e913fcc2dba5071 \"test: adjust `ComputeMerkleRoot` tests\": Why extract `vtx_count` when it's only used once?",
      "created_at": "2025-11-27T14:36:59Z",
      "updated_at": "2025-11-27T15:01:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569010822",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569010822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": 230,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569096555",
      "pull_request_review_id": 3515742822,
      "id": 2569096555,
      "node_id": "PRRC_kwDOABII586ZIU1r",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`(size + 1) & -2` eh? :)\r\n\r\nI'm happy with `(size + 1) & ~1ULL`. It should narrow down to 4-byte int on 32-bit.\r\n\r\nDiffed `ull_literal` vs `decltype_trick` for x86-64 and ARM32 (Edit: on GCC) and they are the same. :+1: ",
      "created_at": "2025-11-27T14:54:45Z",
      "updated_at": "2025-11-27T16:00:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569096555",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569096555"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569155777",
      "pull_request_review_id": 3515951011,
      "id": 2569155777,
      "node_id": "PRRC_kwDOABII586ZIjTB",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "My reasoning was that I want the benchmark to reflect the actual usage, see: https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-2973633245\r\n\r\nIt wouldn't be fair to see the `ComputeMerkleRoot` performance without the leaf constructions (and get an unrealistic speedup). What do you think?",
      "created_at": "2025-11-27T15:06:20Z",
      "updated_at": "2025-11-27T15:06:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569155777",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569155777"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569177747",
      "pull_request_review_id": 3515975840,
      "id": 2569177747,
      "node_id": "PRRC_kwDOABII586ZIoqT",
      "diff_hunk": "@@ -227,7 +227,8 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n {\n     CBlock block;\n \n-    block.vtx.resize(2);\n+    size_t vtx_count{3};\n+    block.vtx.resize(vtx_count);",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 6,
      "commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2569010822,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good point, I can use it in a [few more places](https://github.com/bitcoin/bitcoin/compare/e3b02f1539e59a6a20a00b4161219b5aba6fefed..14a4dca89adaab6f1ad42af6716f9065f1abe2e1), pushed.",
      "created_at": "2025-11-27T15:10:49Z",
      "updated_at": "2025-11-27T15:13:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569177747",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569177747"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": 230,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 231,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569184143",
      "pull_request_review_id": 3515975840,
      "id": 2569184143,
      "node_id": "PRRC_kwDOABII586ZIqOP",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash();\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 1,
      "original_position": 7,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "39b6c139bd6be33699af781f1d71f6fed303d468",
      "in_reply_to_id": 2097711372,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks for checking, I think it's the best solution regarding C++ simplicity and CPU support.",
      "created_at": "2025-11-27T15:12:14Z",
      "updated_at": "2025-11-27T15:13:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569184143",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569184143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 69,
      "original_line": 69,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569912274",
      "pull_request_review_id": 3516836197,
      "id": 2569912274,
      "node_id": "PRRC_kwDOABII586ZLb_S",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm ~fine with~ (edit: all for) including the leaf construction, but that's not my concern in this case.\r\n\r\n`mutation`/`mutated` is used here:\r\nhttps://github.com/bitcoin/bitcoin/blob/14a4dca89adaab6f1ad42af6716f9065f1abe2e1/src/validation.cpp#L3944-L3961\r\n\r\nWhich leads to this being run on every iteration through the outer `while`:\r\nhttps://github.com/bitcoin/bitcoin/blob/14a4dca89adaab6f1ad42af6716f9065f1abe2e1/src/consensus/merkle.cpp#L46-L53",
      "created_at": "2025-11-27T20:25:16Z",
      "updated_at": "2025-12-01T09:12:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569912274",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569912274"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569947721",
      "pull_request_review_id": 3516892685,
      "id": 2569947721,
      "node_id": "PRRC_kwDOABII586ZLkpJ",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`ComputeMerkleRoot` is usually called without mutation checks:\nhttps://github.com/bitcoin/bitcoin/blob/fa283d28e261416f0785450ab687af199103776a/src/validation.cpp#L3929-L3932\n\nMost existing mutation checks are noops, see: https://github.com/bitcoin/bitcoin/pull/33805.\nThe benchmark was modeling pre-segwit `BlockMerkleRoot` before, and now it's closer to the behavior of `BlockWitnessMerkleRoot`.\n\nI haven't measured it explicitly, but the latter should be more representative of modern usage - please let me know if you think I misunderstood something.",
      "created_at": "2025-11-27T20:54:43Z",
      "updated_at": "2025-11-27T20:54:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569947721",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2569947721"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576533841",
      "pull_request_review_id": 3524303653,
      "id": 2576533841,
      "node_id": "PRRC_kwDOABII586ZkslR",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> `ComputeMerkleRoot` is usually called without mutation checks\r\n\r\nThat is true for witness-version of the roots but we still perform the checks for the non-witness root. Every time net_processing receives a regular block message (unless we are loading blocks), we check whether the block is mutated:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/fa283d28e261416f0785450ab687af199103776a/src/net_processing.cpp#L4647\r\n\r\n`IsBlockMutated()` always calls `CheckMerkleRoot()` which always calls `BlockMerkleRoot()` (once for each block) with the `bool` param that ends up going into `ComputeMerkleRoot()`.\r\n\r\n---\r\n\r\n<details><summary>Diff adding 3 variants of the benchmark on top of PR</summary>\r\n\r\n```diff\r\ndiff --git a/src/bench/merkle_root.cpp b/src/bench/merkle_root.cpp\r\nindex 310fc56739..c0e63a09e7 100644\r\n--- a/src/bench/merkle_root.cpp\r\n+++ b/src/bench/merkle_root.cpp\r\n@@ -33,4 +33,80 @@ static void MerkleRoot(benchmark::Bench& bench)\r\n     });\r\n }\r\n \r\n+static void MerkleRootMutation(benchmark::Bench& bench)\r\n+{\r\n+    FastRandomContext rng{/*fDeterministic=*/true};\r\n+\r\n+    std::vector<uint256> hashes;\r\n+    hashes.resize(9001);\r\n+    for (auto& item : hashes) {\r\n+        item = rng.rand256();\r\n+    }\r\n+\r\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\r\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\r\n+        std::vector<uint256> leaves;\r\n+        bool mutation = false;\r\n+        leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even\r\n+        for (size_t s = 0; s < hashes.size(); s++) {\r\n+            leaves.push_back(hashes[s]);\r\n+        }\r\n+\r\n+        const uint256 root{ComputeMerkleRoot(std::move(leaves), &mutation)};\r\n+        assert(mutation == (root.GetUint64(0) & 1));\r\n+        assert(root == expected_root);\r\n+    });\r\n+}\r\n+\r\n+static void MerkleRootMutationSimpleReserve(benchmark::Bench& bench)\r\n+{\r\n+    FastRandomContext rng{/*fDeterministic=*/true};\r\n+\r\n+    std::vector<uint256> hashes;\r\n+    hashes.resize(9001);\r\n+    for (auto& item : hashes) {\r\n+        item = rng.rand256();\r\n+    }\r\n+\r\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\r\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\r\n+        std::vector<uint256> leaves;\r\n+        bool mutation = false;\r\n+        leaves.reserve(hashes.size());\r\n+        for (size_t s = 0; s < hashes.size(); s++) {\r\n+            leaves.push_back(hashes[s]);\r\n+        }\r\n+\r\n+        const uint256 root{ComputeMerkleRoot(std::move(leaves), &mutation)};\r\n+        assert(mutation == (root.GetUint64(0) & 1));\r\n+        assert(root == expected_root);\r\n+    });\r\n+}\r\n+\r\n+static void MerkleRootSimpleReserve(benchmark::Bench& bench)\r\n+{\r\n+    FastRandomContext rng{/*fDeterministic=*/true};\r\n+\r\n+    std::vector<uint256> hashes;\r\n+    hashes.resize(9001);\r\n+    for (auto& item : hashes) {\r\n+        item = rng.rand256();\r\n+    }\r\n+\r\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\r\n+    bench.batch(hashes.size()).unit(\"leaf\").run([&] {\r\n+        std::vector<uint256> leaves;\r\n+        leaves.reserve(hashes.size());\r\n+        for (size_t s = 0; s < hashes.size(); s++) {\r\n+            leaves.push_back(hashes[s]);\r\n+        }\r\n+\r\n+        const uint256 root{ComputeMerkleRoot(std::move(leaves))};\r\n+        assert(root == expected_root);\r\n+    });\r\n+}\r\n+\r\n BENCHMARK(MerkleRoot, benchmark::PriorityLevel::HIGH);\r\n+BENCHMARK(MerkleRootMutation, benchmark::PriorityLevel::HIGH);\r\n+BENCHMARK(MerkleRootMutationSimpleReserve, benchmark::PriorityLevel::HIGH);\r\n+BENCHMARK(MerkleRootSimpleReserve, benchmark::PriorityLevel::HIGH);\r\n```\r\n\r\n</details>\r\n\r\n```shell\r\n₿ cmake --build build -t bench_bitcoin && build/bin/bench_bitcoin -filter=\"MerkleRoot.*\" -min-time=10000\r\n[1/4] Generating bitcoin-build-info.h\r\n\r\n|             ns/leaf |              leaf/s |    err% |        ins/leaf |        cyc/leaf |    IPC |       bra/leaf |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|              113.30 |        8,826,041.95 |    0.1% |        1,223.17 |          417.61 |  2.929 |           2.63 |    0.2% |     10.91 | `MerkleRoot`\r\n|              114.78 |        8,712,680.79 |    0.0% |        1,239.18 |          423.01 |  2.929 |           3.63 |    0.2% |     10.98 | `MerkleRootMutation`\r\n|              115.98 |        8,622,472.65 |    0.0% |        1,247.23 |          427.47 |  2.918 |           4.64 |    0.2% |     11.02 | `MerkleRootMutationSimpleReserve`\r\n|              114.91 |        8,702,442.98 |    0.1% |        1,230.23 |          423.52 |  2.905 |           3.64 |    0.2% |     11.02 | `MerkleRootSimpleReserve`\r\n```\r\nRelative improvement when not using the `mutated` parameter:\r\nMerkleRootSimpleReserve -> MerkleRoot (current PR): 113.30 -> 114.91 => 1.40%\r\nRelative improvement when bringing back the `mutated` parameter:\r\nMerkleRootMutationSimpleReserve (close to master) -> MerkleRootMutation: 115.98 -> 114.78 => 1.03%\r\n\r\nConclusion:\r\n\r\nThe somewhat quadratic aspect of calculating the `mutated` parameter of `ComputeMerkleRoot()` makes the improvement from reserving the correct size stand out less. The impact of keeping the `mutated` part had less impact than I feared though. I see 3 alternatives:\r\n1. Keep current PR code - But add clear note and justification to commit message & PR description of why we are no longer benchmarking the `mutated` param.\r\n2. Change back to no longer dropping the `mutated` param aspect of the benchmark.\r\n3. Maintain 2 benchmarks, one which exercises `mutated` and one which does not.\r\n\r\nMy preference is 2). It accepts a lower relative improvement from reserving the correct amount, but I don't see a clear justification for dropping `mutated` from benchmarking (as it is used in net_processing as described above). The signal of 1.03% is still clear. (Though some distance away from 2.4% currently stated in the PR description).",
      "created_at": "2025-12-01T10:35:02Z",
      "updated_at": "2025-12-01T10:35:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2576533841",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576533841"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576550988",
      "pull_request_review_id": 3524322513,
      "id": 2576550988,
      "node_id": "PRRC_kwDOABII586ZkwxM",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I can also just revert the benchmark completely, this is mostly a correctness (reserve the actual amount, not one less) and memory fix (don't allocate 3x peak memory), I don't expect it to speed up execution a lot, but I do expect it to fragment the memory less, see https://github.com/bitcoin/bitcoin/pull/32497#issuecomment-3563724551",
      "created_at": "2025-12-01T10:40:47Z",
      "updated_at": "2025-12-01T10:42:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2576550988",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576550988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576589632",
      "pull_request_review_id": 3524364752,
      "id": 2576589632,
      "node_id": "PRRC_kwDOABII586Zk6NA",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I prefer doing the reserve-adjustment in the benchmark as well and doing the reserve inside of the benchmarked section (edited https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2569912274 earlier today).\r\n\r\nMakes sense that it could have a higher impact on memory fragmentation than execution speed.",
      "created_at": "2025-12-01T10:52:44Z",
      "updated_at": "2025-12-01T10:52:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2576589632",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576589632"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576823462",
      "pull_request_review_id": 3524660484,
      "id": 2576823462,
      "node_id": "PRRC_kwDOABII586ZlzSm",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I have added a composite benchmark to measure both, added originally with resize + overwrite (as the code it measures), and in the last commit changes them to even reserve.\r\n\r\nRemeasured it as follows:\r\n```bash\r\nfor commit in 5c77b621591a800095c0afd738e4b96c47400701 8bbc90a9811ee279265ad114376eff7e852bee10; do \\\r\n    git fetch origin $commit >/dev/null 2>&1 && git checkout $commit >/dev/null 2>&1 && echo \"\" && git log -1 --pretty='%h %s' && \\\r\n    rm -rf build >/dev/null 2>&1 && cmake -B build -DBUILD_BENCH=ON -DENABLE_IPC=OFF -DCMAKE_BUILD_TYPE=RelWithDebInfo >/dev/null 2>&1 && \\\r\n    cmake --build build -j$(nproc) >/dev/null 2>&1 && \\\r\n    for _ in $(seq 5); do \\\r\n      sleep 5; \\\r\n      sudo taskpolicy -t 5 -l 5 nice -n -20 ./build/bin/bench_bitcoin -filter='MerkleRoot.*' -min-time=1000; \\\r\n    done; \\\r\ndone\r\n```\r\n\r\n<details>\r\n<summary>Benchmark results</summary>\r\n\r\n```bash\r\n5c77b62159 refactor: make `MerkleRoot` benchmark more representative\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               44.26 |       22,592,347.11 |    0.0% |      1.10 | `MerkleRoot`\r\n|               44.74 |       22,352,771.64 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               44.26 |       22,593,951.64 |    0.1% |      1.10 | `MerkleRoot`\r\n|               44.73 |       22,356,324.04 |    0.0% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               44.36 |       22,544,297.38 |    0.1% |      1.10 | `MerkleRoot`\r\n|               44.94 |       22,251,479.03 |    0.2% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               44.31 |       22,566,269.08 |    0.0% |      1.10 | `MerkleRoot`\r\n|               44.82 |       22,312,541.43 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               44.32 |       22,563,549.17 |    0.0% |      1.10 | `MerkleRoot`\r\n|               44.84 |       22,300,473.36 |    0.0% |      1.10 | `MerkleRootWithMutation`\r\n\r\n8bbc90a981 merkle: pre-reserve leaves to prevent reallocs with odd vtx count\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               43.67 |       22,897,985.36 |    0.0% |      1.10 | `MerkleRoot`\r\n|               44.18 |       22,636,422.13 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               43.66 |       22,905,129.22 |    0.0% |      1.11 | `MerkleRoot`\r\n|               44.21 |       22,618,981.30 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               43.75 |       22,856,741.62 |    0.1% |      1.11 | `MerkleRoot`\r\n|               44.32 |       22,560,920.73 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               43.76 |       22,850,068.43 |    0.1% |      1.10 | `MerkleRoot`\r\n|               44.57 |       22,437,748.76 |    0.2% |      1.10 | `MerkleRootWithMutation`\r\n\r\n|             ns/leaf |              leaf/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|               43.79 |       22,838,665.64 |    0.1% |      1.10 | `MerkleRoot`\r\n|               44.29 |       22,579,859.06 |    0.1% |      1.10 | `MerkleRootWithMutation`\r\n```\r\n\r\n</details>\r\n\r\nWhich shows a ~1% speedup for both cases:\r\n<img width=\"983\" height=\"575\" alt=\"Screenshot 2025-12-01 at PM 12 59 10\" src=\"https://github.com/user-attachments/assets/3ae4b176-88ff-4eeb-a4dd-f62131c43d7a\" />\r\n\r\nBut since isn't necessarily the point, I also added the previous memory measurements to the commit messages for clarity.\r\n\r\nLet me know what you think.",
      "created_at": "2025-12-01T12:10:34Z",
      "updated_at": "2025-12-01T12:11:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2576823462",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2576823462"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2578500589",
      "pull_request_review_id": 3526806887,
      "id": 2578500589,
      "node_id": "PRRC_kwDOABII586ZsMvt",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "hodlinator",
        "id": 172445034,
        "node_id": "U_kgDOCkdNag",
        "avatar_url": "https://avatars.githubusercontent.com/u/172445034?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hodlinator",
        "html_url": "https://github.com/hodlinator",
        "followers_url": "https://api.github.com/users/hodlinator/followers",
        "following_url": "https://api.github.com/users/hodlinator/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hodlinator/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hodlinator/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hodlinator/subscriptions",
        "organizations_url": "https://api.github.com/users/hodlinator/orgs",
        "repos_url": "https://api.github.com/users/hodlinator/repos",
        "events_url": "https://api.github.com/users/hodlinator/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hodlinator/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Looks good!\r\n\r\nnit: With your version of having 2 benchmarks within the same function, `-filter='MerkleRoot.*'` in the commit message can be simplified to `-filter='MerkleRoot'`.",
      "created_at": "2025-12-01T20:17:41Z",
      "updated_at": "2025-12-01T20:26:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2578500589",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2578500589"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2580278793",
      "pull_request_review_id": 3529005062,
      "id": 2580278793,
      "node_id": "PRRC_kwDOABII586Zy-4J",
      "diff_hunk": "@@ -7,20 +7,29 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes;\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);",
      "path": "src/bench/merkle_root.cpp",
      "position": 28,
      "original_position": 22,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "e3b02f1539e59a6a20a00b4161219b5aba6fefed",
      "in_reply_to_id": 2568982833,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> can be simplified to -filter='MerkleRoot'.\r\n\r\nYeah, thanks, I know, I explicitly extended it since it produces two results now.",
      "created_at": "2025-12-02T09:06:18Z",
      "updated_at": "2025-12-02T09:06:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2580278793",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2580278793"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 22,
      "original_line": 22,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602163619",
      "pull_request_review_id": 3556795783,
      "id": 2602163619,
      "node_id": "PRRC_kwDOABII586bGd2j",
      "diff_hunk": "@@ -237,12 +238,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for(size_t pos{1}; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "style: space after `for` and `++i` is preferred over `i++` (from `doc/developer-notes.md`).\r\n```suggestion\r\n    for (size_t pos{1}; pos < vtx_count; ++pos) {\r\n```\r\n(the loop a few lines above also uses `pos++`)",
      "created_at": "2025-12-09T11:04:46Z",
      "updated_at": "2025-12-09T13:15:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602163619",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602163619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602218332",
      "pull_request_review_id": 3556795783,
      "id": 2602218332,
      "node_id": "PRRC_kwDOABII586bGrNc",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/bench/merkle_root.cpp",
      "position": 36,
      "original_position": 30,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This reminds me of the [Obfuscated C Code Contest](https://github.com/ioccc-src/winner/blob/master/2024/burton/prog.c). I consider the dumb version easier to read:\r\n\r\n```cpp\r\nx % 2 == 0 ? x : x + 1\r\n```\r\nRemember that other people could get confused easier than you.\r\n\r\nAssembly for `(x + 1) & ~1ULL`:\r\n```asm\r\nt[0x304574] <+4>:  leaq   0x1(%rdi), %rax\r\nt[0x304578] <+8>:  andq   $-0x2, %rax\r\n```\r\nAssembly for `x % 2 == 0 ? x : x + 1`:\r\n```asm\r\nt[0x304574] <+4>:  movl   %edi, %eax\r\nt[0x304576] <+6>:  andl   $0x1, %eax\r\nt[0x304579] <+9>:  addq   %rdi, %rax\r\n```\r\n\r\nIf you really like the `~!@~*!&` version, maybe put it in an inline function `RoundUpToEven(n)`?",
      "created_at": "2025-12-09T11:20:15Z",
      "updated_at": "2025-12-09T13:15:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602218332",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602218332"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602386270",
      "pull_request_review_id": 3556795783,
      "id": 2602386270,
      "node_id": "PRRC_kwDOABII586bHUNe",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);",
      "path": "src/bench/merkle_root.cpp",
      "position": 22,
      "original_position": 16,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In the commit message of 8af0a3a72c8af781bebed7289657c637220df893 `validation: pre-reserve leaves to prevent reallocs with odd vtx count`:\r\n\r\n> ... doubling its capacity (allocating 3x the necessary memory)\r\n\r\nWhy 3x?",
      "created_at": "2025-12-09T12:13:04Z",
      "updated_at": "2025-12-09T13:15:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602386270",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602386270"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 18,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602597216",
      "pull_request_review_id": 3556795783,
      "id": 2602597216,
      "node_id": "PRRC_kwDOABII586bIHtg",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> I think it's simpler if the caller does not have to be aware that they should allocate a larger vector to be passed in.\r\n\r\n+1\r\n\r\nI do not understand why the patch above works :-/ but I like that it is contained inside `ComputeMerkleRoot()`.",
      "created_at": "2025-12-09T13:11:39Z",
      "updated_at": "2025-12-09T13:15:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602597216",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602597216"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602727939",
      "pull_request_review_id": 3557530221,
      "id": 2602727939,
      "node_id": "PRRC_kwDOABII586bInoD",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);",
      "path": "src/bench/merkle_root.cpp",
      "position": 22,
      "original_position": 16,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602386270,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> Why 3x?\r\n\r\nThe existing and the new doubled have to coexist for a while",
      "created_at": "2025-12-09T13:41:18Z",
      "updated_at": "2025-12-09T13:41:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602727939",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602727939"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 18,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602728138",
      "pull_request_review_id": 3557530444,
      "id": 2602728138,
      "node_id": "PRRC_kwDOABII586bInrK",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/bench/merkle_root.cpp",
      "position": 36,
      "original_position": 30,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602218332,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> maybe put it in an inline function RoundUpToEven(n)\r\n\r\nI did that before, reviewers found it complicated.",
      "created_at": "2025-12-09T13:41:21Z",
      "updated_at": "2025-12-09T13:43:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602728138",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602728138"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602728371",
      "pull_request_review_id": 3557530739,
      "id": 2602728371,
      "node_id": "PRRC_kwDOABII586bInuz",
      "diff_hunk": "@@ -237,12 +238,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for(size_t pos{1}; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602163619,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This is deliberate to mimic the source since reviewers mentioned it explicitly: https://github.com/bitcoin/bitcoin/pull/32497#pullrequestreview-2945160215",
      "created_at": "2025-12-09T13:41:25Z",
      "updated_at": "2025-12-09T13:41:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602728371",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602728371"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602734915",
      "pull_request_review_id": 3557538712,
      "id": 2602734915,
      "node_id": "PRRC_kwDOABII586bIpVD",
      "diff_hunk": "@@ -80,7 +81,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n+    std::vector<uint256> v256{u256, u256_min, u256_max};\n+    v256.reserve(RoundUpToEven(v256.size()));",
      "path": "src/test/fuzz/integer.cpp",
      "position": 1,
      "original_position": 22,
      "commit_id": "de6a28396b8bf7a3fd1124418b4cd5beba1906d6",
      "original_commit_id": "a7997d02ebe5b72e706712f43884644b705a1cd1",
      "in_reply_to_id": 2264185044,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Given that reviewers found changing a `resize` to a `reserve` too risky for this part of the code, I doubt this would pass review.",
      "created_at": "2025-12-09T13:42:59Z",
      "updated_at": "2025-12-09T13:42:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2602734915",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602734915"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 85,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605278174",
      "pull_request_review_id": 3560817863,
      "id": 2605278174,
      "node_id": "PRRC_kwDOABII586bSWPe",
      "diff_hunk": "@@ -237,12 +238,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for(size_t pos{1}; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602163619,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This `for(...` without a space is a new code.",
      "created_at": "2025-12-10T05:42:50Z",
      "updated_at": "2025-12-10T05:42:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2605278174",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2605278174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2610471488",
      "pull_request_review_id": 3567299060,
      "id": 2610471488,
      "node_id": "PRRC_kwDOABII586bmKJA",
      "diff_hunk": "@@ -237,12 +238,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for(size_t pos{1}; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602163619,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, I copied that from the source to simplify grepping for code (since I couldn't adjust the source instead). If you insist, I can decouple the two if I need to touch again",
      "created_at": "2025-12-11T12:51:28Z",
      "updated_at": "2025-12-11T13:45:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2610471488",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2610471488"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2610659650",
      "pull_request_review_id": 3567534087,
      "id": 2610659650,
      "node_id": "PRRC_kwDOABII586bm4FC",
      "diff_hunk": "@@ -237,12 +238,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for(size_t pos{1}; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 1,
      "original_position": 20,
      "commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "original_commit_id": "8af0a3a72c8af781bebed7289657c637220df893",
      "in_reply_to_id": 2602163619,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Rebased, fixed this, thanks!",
      "created_at": "2025-12-11T13:48:19Z",
      "updated_at": "2025-12-11T13:48:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2610659650",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2610659650"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 242,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641466404",
      "pull_request_review_id": 3606019558,
      "id": 2641466404,
      "node_id": "PRRC_kwDOABII586dcZQk",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even\n+            for (size_t s = 0; s < hashes.size(); s++) {\n+                leaves.push_back(hashes[s]);\n+            }\n+\n+            bool mutated{false};\n+            const uint256 root{ComputeMerkleRoot(std::move(leaves), mutate ? &mutated : nullptr)};\n+            assert(!mutate || mutated == (root.GetUint64(0) & 1));",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 37,
      "commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "original_commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In 1a768c0d4c273b4660e5310b26c23a56641e2648 \"bench: make `MerkleRoot` benchmark more representative\"\r\n\r\nI'm having a hard time understanding why `root.GetUint64(0) & 1` is an indicator that the merkle root was mutated.",
      "created_at": "2025-12-22T22:54:33Z",
      "updated_at": "2025-12-22T23:01:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2641466404",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2641466404"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 34,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2642284304",
      "pull_request_review_id": 3606978228,
      "id": 2642284304,
      "node_id": "PRRC_kwDOABII586dfg8Q",
      "diff_hunk": "@@ -7,21 +7,34 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even\n+            for (size_t s = 0; s < hashes.size(); s++) {\n+                leaves.push_back(hashes[s]);\n+            }\n+\n+            bool mutated{false};\n+            const uint256 root{ComputeMerkleRoot(std::move(leaves), mutate ? &mutated : nullptr)};\n+            assert(!mutate || mutated == (root.GetUint64(0) & 1));",
      "path": "src/bench/merkle_root.cpp",
      "position": 1,
      "original_position": 37,
      "commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "original_commit_id": "9f39a8309cb0a23df03937b0b225aff8ce9e1ec6",
      "in_reply_to_id": 2641466404,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah, it was a leftover anti-optimization trick since we're in a loop now (meant to confuse the compiler, not the reader). But you're right, it seems to work correctly without it: removed the assert and updated the measurements in the commit messages: https://github.com/bitcoin/bitcoin/compare/9f39a8309cb0a23df03937b0b225aff8ce9e1ec6..3dd815f048c80c9a35f01972e0537eb42531aec7",
      "created_at": "2025-12-23T07:46:33Z",
      "updated_at": "2025-12-23T07:46:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2642284304",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2642284304"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 34,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695518401",
      "pull_request_review_id": 3667031029,
      "id": 2695518401,
      "node_id": "PRRC_kwDOABII586gqljB",
      "diff_hunk": "@@ -242,12 +243,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior",
      "path": "src/test/merkle_tests.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: \"Old behavior\" is not clear to me - leaf duplication for odd counts is the normal merkle tree algorithm, not legacy behavior, isn't it ?.\r\n\r\n```suggestion\r\n    hashes.resize(vtx_count); // Odd count exercises leaf duplication in ComputeMerkleRoot\r\n```",
      "created_at": "2026-01-15T18:33:50Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695518401",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695518401"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695522910",
      "pull_request_review_id": 3667031029,
      "id": 2695522910,
      "node_id": "PRRC_kwDOABII586gqmpe",
      "diff_hunk": "@@ -232,8 +232,9 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n {\n     CBlock block;\n \n-    block.vtx.resize(2);\n-    for (std::size_t pos = 0; pos < block.vtx.size(); pos++) {\n+    constexpr size_t vtx_count{3};\n+    block.vtx.resize(vtx_count);\n+    for (std::size_t pos = 0; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: `size_t` and brace initialization to match the rest of the file.\r\n\r\n```suggestion\r\n    for (size_t pos{0}; pos < vtx_count; pos++) {\r\n```",
      "created_at": "2026-01-15T18:35:14Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695522910",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695522910"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695532484",
      "pull_request_review_id": 3667031029,
      "id": 2695532484,
      "node_id": "PRRC_kwDOABII586gqo_E",
      "diff_hunk": "@@ -80,8 +80,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n-    (void)ComputeMerkleRoot(v256);\n+    std::vector v256{u256, u256_min, u256_max};",
      "path": "src/test/fuzz/integer.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit:\r\n```suggestion\r\n    std::vector<uint256> v256{u256, u256_min, u256_max};\r\n```",
      "created_at": "2026-01-15T18:38:41Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695532484",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695532484"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695541414",
      "pull_request_review_id": 3667031029,
      "id": 2695541414,
      "node_id": "PRRC_kwDOABII586gqrKm",
      "diff_hunk": "@@ -242,12 +243,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for (size_t pos{1}; pos < vtx_count; ++pos) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: The old code explicitly had `hashes[0].SetNull()`. Now `hashes[0]` relies on implicit zero-initialization from `resize()`. A brief comment would clarify intent:\r\n```suggestion\r\n    // hashes[0] is zero (coinbase witness hash) from resize()\r\n    for (size_t pos{1}; pos < vtx_count; ++pos) {\r\n```",
      "created_at": "2026-01-15T18:41:45Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695541414",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695541414"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 247,
      "original_line": 247,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695593220",
      "pull_request_review_id": 3667031029,
      "id": 2695593220,
      "node_id": "PRRC_kwDOABII586gq30E",
      "diff_hunk": "@@ -7,21 +7,33 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even\n+            for (size_t s = 0; s < hashes.size(); s++) {\n+                leaves.push_back(hashes[s]);\n+            }",
      "path": "src/bench/merkle_root.cpp",
      "position": 33,
      "original_position": 33,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Loop can be simplified.\r\n```suggestion\r\n            for (const auto& hash : hashes) {\r\n                leaves.push_back(hash);\r\n            }\r\n```",
      "created_at": "2026-01-15T19:00:04Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695593220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695593220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": 28,
      "original_start_line": 28,
      "start_side": "RIGHT",
      "line": 30,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695598822",
      "pull_request_review_id": 3667031029,
      "id": 2695598822,
      "node_id": "PRRC_kwDOABII586gq5Lm",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even\n     for (size_t s = 0; s < block.vtx.size(); s++) {",
      "path": "src/consensus/merkle.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: Loop can be also simplified here.\r\n```suggestion\r\n    for (const auto& tx : block.vtx) {\r\n        leaves.push_back(tx->GetHash().ToUint256());\r\n    }\r\n```",
      "created_at": "2026-01-15T19:02:12Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695598822",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695598822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 70,
      "original_line": 70,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695607201",
      "pull_request_review_id": 3667031029,
      "id": 2695607201,
      "node_id": "PRRC_kwDOABII586gq7Oh",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even\n     for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash().ToUint256();\n+        leaves.push_back(block.vtx[s]->GetHash().ToUint256());\n     }\n     return ComputeMerkleRoot(std::move(leaves), mutated);\n }\n \n uint256 BlockWitnessMerkleRoot(const CBlock& block)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    leaves[0].SetNull(); // The witness hash of the coinbase is 0.\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The pattern `(size + 1) & ~1ULL` with identical comment appears 4 times across 3 files:\r\n  - merkle.cpp:69\r\n  - merkle.cpp:79\r\n  - signet.cpp:61\r\n  - merkle_root.cpp:27\r\n\r\n  A small helper would reduce duplication and can be arguably more readable: \"add 1 if odd\":\r\n  ```cpp\r\n  constexpr size_t RoundUpToEven(size_t n) { return n + (n & 1); }\r\n  ```\r\n  \r\n  Also: `(size + 1) & ~1ULL` works but assumes 64-bit arithmetic. `assumptions.h` explicitly supports 32-bit `size_t`.\r\n",
      "created_at": "2026-01-15T19:05:20Z",
      "updated_at": "2026-01-15T19:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695607201",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695607201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 79,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695869046",
      "pull_request_review_id": 3667467697,
      "id": 2695869046,
      "node_id": "PRRC_kwDOABII586gr7J2",
      "diff_hunk": "@@ -232,8 +232,9 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n {\n     CBlock block;\n \n-    block.vtx.resize(2);\n-    for (std::size_t pos = 0; pos < block.vtx.size(); pos++) {\n+    constexpr size_t vtx_count{3};\n+    block.vtx.resize(vtx_count);\n+    for (std::size_t pos = 0; pos < vtx_count; pos++) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695522910,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was deliberately left to match the production code, see https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568112479 ",
      "created_at": "2026-01-15T20:35:01Z",
      "updated_at": "2026-01-15T20:35:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695869046",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695869046"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695869755",
      "pull_request_review_id": 3667468448,
      "id": 2695869755,
      "node_id": "PRRC_kwDOABII586gr7U7",
      "diff_hunk": "@@ -80,8 +80,8 @@ FUZZ_TARGET(integer, .init = initialize_integer)\n     }\n     constexpr uint256 u256_min{\"0000000000000000000000000000000000000000000000000000000000000000\"};\n     constexpr uint256 u256_max{\"ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\"};\n-    const std::vector<uint256> v256{u256, u256_min, u256_max};\n-    (void)ComputeMerkleRoot(v256);\n+    std::vector v256{u256, u256_min, u256_max};",
      "path": "src/test/fuzz/integer.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695532484,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was deliberately removed since it's redundant",
      "created_at": "2026-01-15T20:35:18Z",
      "updated_at": "2026-01-15T20:35:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695869755",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695869755"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871314",
      "pull_request_review_id": 3667470142,
      "id": 2695871314,
      "node_id": "PRRC_kwDOABII586gr7tS",
      "diff_hunk": "@@ -242,12 +243,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior\n+    for (size_t pos{1}; pos < vtx_count; ++pos) {",
      "path": "src/test/merkle_tests.cpp",
      "position": 20,
      "original_position": 20,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695541414,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I can do that in a follow-up if you think it's necessarry",
      "created_at": "2026-01-15T20:35:55Z",
      "updated_at": "2026-01-15T20:35:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695871314",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871314"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 247,
      "original_line": 247,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871536",
      "pull_request_review_id": 3667470393,
      "id": 2695871536,
      "node_id": "PRRC_kwDOABII586gr7ww",
      "diff_hunk": "@@ -7,21 +7,33 @@\n #include <random.h>\n #include <uint256.h>\n \n+#include <cassert>\n #include <vector>\n \n static void MerkleRoot(benchmark::Bench& bench)\n {\n-    FastRandomContext rng(true);\n-    std::vector<uint256> leaves;\n-    leaves.resize(9001);\n-    for (auto& item : leaves) {\n+    FastRandomContext rng{/*fDeterministic=*/true};\n+\n+    std::vector<uint256> hashes{};\n+    hashes.resize(9001);\n+    for (auto& item : hashes) {\n         item = rng.rand256();\n     }\n-    bench.batch(leaves.size()).unit(\"leaf\").run([&] {\n-        bool mutation = false;\n-        uint256 hash = ComputeMerkleRoot(std::vector<uint256>(leaves), &mutation);\n-        leaves[mutation] = hash;\n-    });\n+\n+    constexpr uint256 expected_root{\"d8d4dfd014a533bc3941b8663fa6e7f3a8707af124f713164d75b0c3179ecb08\"};\n+    for (bool mutate : {false, true}) {\n+        bench.name(mutate ? \"MerkleRootWithMutation\" : \"MerkleRoot\").batch(hashes.size()).unit(\"leaf\").run([&] {\n+            std::vector<uint256> leaves;\n+            leaves.reserve((hashes.size() + 1) & ~1ULL); // capacity rounded up to even\n+            for (size_t s = 0; s < hashes.size(); s++) {\n+                leaves.push_back(hashes[s]);\n+            }",
      "path": "src/bench/merkle_root.cpp",
      "position": 33,
      "original_position": 33,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695593220,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was deliberately left to match the production code, see https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568112479 ",
      "created_at": "2026-01-15T20:36:01Z",
      "updated_at": "2026-01-15T20:36:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695871536",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": 28,
      "original_start_line": 28,
      "start_side": "RIGHT",
      "line": 30,
      "original_line": 30,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871680",
      "pull_request_review_id": 3667470593,
      "id": 2695871680,
      "node_id": "PRRC_kwDOABII586gr7zA",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even\n     for (size_t s = 0; s < block.vtx.size(); s++) {",
      "path": "src/consensus/merkle.cpp",
      "position": 6,
      "original_position": 6,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695598822,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was deliberately left to match the production code, see https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2568112479 ",
      "created_at": "2026-01-15T20:36:05Z",
      "updated_at": "2026-01-15T20:36:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695871680",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695871680"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 70,
      "original_line": 70,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695872518",
      "pull_request_review_id": 3667471555,
      "id": 2695872518,
      "node_id": "PRRC_kwDOABII586gr8AG",
      "diff_hunk": "@@ -66,20 +66,20 @@ uint256 ComputeMerkleRoot(std::vector<uint256> hashes, bool* mutated) {\n uint256 BlockMerkleRoot(const CBlock& block, bool* mutated)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even\n     for (size_t s = 0; s < block.vtx.size(); s++) {\n-        leaves[s] = block.vtx[s]->GetHash().ToUint256();\n+        leaves.push_back(block.vtx[s]->GetHash().ToUint256());\n     }\n     return ComputeMerkleRoot(std::move(leaves), mutated);\n }\n \n uint256 BlockWitnessMerkleRoot(const CBlock& block)\n {\n     std::vector<uint256> leaves;\n-    leaves.resize(block.vtx.size());\n-    leaves[0].SetNull(); // The witness hash of the coinbase is 0.\n+    leaves.reserve((block.vtx.size() + 1) & ~1ULL); // capacity rounded up to even",
      "path": "src/consensus/merkle.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695607201,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It's what I did originally, but reviewers found it too complicated",
      "created_at": "2026-01-15T20:36:25Z",
      "updated_at": "2026-01-15T20:36:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695872518",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695872518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 79,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695878367",
      "pull_request_review_id": 3667479412,
      "id": 2695878367,
      "node_id": "PRRC_kwDOABII586gr9bf",
      "diff_hunk": "@@ -242,12 +243,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior",
      "path": "src/test/merkle_tests.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695518401,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "old behavior = not properly sized.\r\nYou're also referring to it as \"old\": https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695541414\r\nI don't mind adjusting this in a followup",
      "created_at": "2026-01-15T20:37:38Z",
      "updated_at": "2026-01-15T20:37:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2695878367",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695878367"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2704551925",
      "pull_request_review_id": 3677843063,
      "id": 2704551925,
      "node_id": "PRRC_kwDOABII586hNC_1",
      "diff_hunk": "@@ -242,12 +243,12 @@ BOOST_AUTO_TEST_CASE(merkle_test_BlockWitness)\n     uint256 blockWitness = BlockWitnessMerkleRoot(block);\n \n     std::vector<uint256> hashes;\n-    hashes.resize(block.vtx.size());\n-    hashes[0].SetNull();\n-    hashes[1] = block.vtx[1]->GetHash().ToUint256();\n+    hashes.resize(vtx_count); // Note: leaving odd count to exercise old behavior",
      "path": "src/test/merkle_tests.cpp",
      "position": 19,
      "original_position": 19,
      "commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "original_commit_id": "3dd815f048c80c9a35f01972e0537eb42531aec7",
      "in_reply_to_id": 2695518401,
      "user": {
        "login": "danielabrozzoni",
        "id": 25042473,
        "node_id": "MDQ6VXNlcjI1MDQyNDcz",
        "avatar_url": "https://avatars.githubusercontent.com/u/25042473?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/danielabrozzoni",
        "html_url": "https://github.com/danielabrozzoni",
        "followers_url": "https://api.github.com/users/danielabrozzoni/followers",
        "following_url": "https://api.github.com/users/danielabrozzoni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/danielabrozzoni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/danielabrozzoni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/danielabrozzoni/subscriptions",
        "organizations_url": "https://api.github.com/users/danielabrozzoni/orgs",
        "repos_url": "https://api.github.com/users/danielabrozzoni/repos",
        "events_url": "https://api.github.com/users/danielabrozzoni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/danielabrozzoni/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I would like to see this addressed in a followup as well. I think \"old behavior\" is clear in the context of this PR, but once this is merged, someone opening the file months from now without that context will not understand what it refers to.\r\n\r\nI think this can be improved by simply adding a link to the PR and/or briefly explaining that the old behavior refers to a reallocation of the hashes vector",
      "created_at": "2026-01-19T12:23:02Z",
      "updated_at": "2026-01-19T13:43:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32497#discussion_r2704551925",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2704551925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32497"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 246,
      "original_line": 246,
      "side": "RIGHT"
    }
  ]
}
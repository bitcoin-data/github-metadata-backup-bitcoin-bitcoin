{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21620",
    "id": 610107690,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjEwMTA3Njkw",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/21620",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/21620.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/21620.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21620/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21620/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/8257e9ab7592a7fe459089f021053c7740004817",
    "number": 21620,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "ChainstateManager locking improvements",
    "user": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hopefully this'll make everyone happy, and clarify some chainstate locking issues going forward.\r\n\r\n### Background \r\n\r\nThere is some amount of confusion due to my choice to conflate use of `cs_main` between\r\n- its original purpose: guarding legacy data structures related to CChainState-related data (i.e. pre-`ChainstateManager` coverage of `chainActive`), and\r\n- its new purpose: guarding *pointers* to the constituent CChainState instances managed by ChainstateManager, e.g. `m_ibd_chainstate`, `m_active_chainstate`.\r\n\r\nI initially thought that reusing cs_main would be a simplification, but it turned out to just be mostly confusing.\r\n\r\nAs a quick refresher, ChainstateManager manages two constituent CChainState instances (`m_ibd_chainstate`, `m_snapshot_chainstate`) and reveals a pointer to the one that is in active use (`m_active_chainstate`) per the assumeutxo semantics. As [@jnewbery has pointed out](https://github.com/bitcoin/bitcoin/pull/19806#issuecomment-768946522), the active pointer doesn't need to be guarded by a mutex, but can be marked `atomic` to avoid explicit locking.\r\n\r\nThroughout the course of [deglobalizing chainstate use](https://github.com/bitcoin/bitcoin/pull/20158), @dongcarl has had to embed `cs_main` acquisitions in the active chainstate accessor functions (e.g. ::ChainstateActive()) to avoid the risk of unserialized access to the `ChainstateManager::m_active_chainstate` state. This is suboptimal because callers are almost always already holding cs_main anyway, so we just end up recursively acquiring the lock in many cases. And fundamentally, cs_main use isn't necessary for that once we decouple chainstate *pointer* management from cs_main.\r\n\r\n### These changes\r\n\r\n- make `ChainstateManager::m_active_chainstate` atomic to avoid requiring explicit locking (per @jnewbery's suggestion),\r\n- introduce `ChainstateManager::m_cs_chainstates` to relieve cs_main of guarding the internal chainstates managed by ChainstateManager,\r\n- remove the `cs_main` acquisitions in `::ChainstateActive()` and `ChainstateManager::ActiveChainstate()`, which are no longer necessary, and\r\n- annotate `CChainState::m_chain` as guarded by cs_main, which was an implicit requirement that I'm just making explicit here.",
    "labels": [
      {
        "id": 118379652,
        "node_id": "MDU6TGFiZWwxMTgzNzk2NTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Validation",
        "name": "Validation",
        "color": "6060aa",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "active_lock_reason": "resolved",
    "created_at": "2021-04-06T19:12:27Z",
    "updated_at": "2022-08-16T17:26:36Z",
    "closed_at": "2021-08-05T19:29:04Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merge_commit_sha": "7013a54070306e1ed220e60aa05ae971547cf43f",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "jamesob:2021-04-cs-lock-improvements",
      "ref": "2021-04-cs-lock-improvements",
      "sha": "8257e9ab7592a7fe459089f021053c7740004817",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 42077031,
        "node_id": "MDEwOlJlcG9zaXRvcnk0MjA3NzAzMQ==",
        "name": "bitcoin",
        "full_name": "jamesob/bitcoin",
        "owner": {
          "login": "jamesob",
          "id": 73197,
          "node_id": "MDQ6VXNlcjczMTk3",
          "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/jamesob",
          "html_url": "https://github.com/jamesob",
          "followers_url": "https://api.github.com/users/jamesob/followers",
          "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
          "organizations_url": "https://api.github.com/users/jamesob/orgs",
          "repos_url": "https://api.github.com/users/jamesob/repos",
          "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/jamesob/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/jamesob/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/jamesob/bitcoin",
        "archive_url": "https://api.github.com/repos/jamesob/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/jamesob/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/jamesob/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/jamesob/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/jamesob/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/jamesob/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/jamesob/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/jamesob/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/jamesob/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/jamesob/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/jamesob/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/jamesob/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/jamesob/bitcoin/events",
        "forks_url": "https://api.github.com/repos/jamesob/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/jamesob/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/jamesob/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/jamesob/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/jamesob/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/jamesob/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/jamesob/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/jamesob/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/jamesob/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/jamesob/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/jamesob/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/jamesob/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/jamesob/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/jamesob/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/jamesob/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/jamesob/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:jamesob/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/jamesob/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/jamesob/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/jamesob/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/jamesob/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/jamesob/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/jamesob/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/jamesob/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/jamesob/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/jamesob/bitcoin/hooks",
        "svn_url": "https://github.com/jamesob/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 2,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 252891,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-05-31T19:20:56Z",
        "created_at": "2015-09-07T22:18:03Z",
        "updated_at": "2023-05-05T06:31:51Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "9be7fe4849310884294669b019dd8300f69bc334",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 34348,
        "stargazers_count": 69854,
        "watchers_count": 69854,
        "size": 234261,
        "default_branch": "master",
        "open_issues_count": 631,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-06-09T09:57:38Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-06-09T09:00:41Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/21620"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 66,
    "deletions": 64,
    "changed_files": 3,
    "commits": 7,
    "review_comments": 0,
    "comments": 14
  },
  "events": [
    {
      "event": "mentioned",
      "id": 4558621371,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDU1ODYyMTM3MQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558621371",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T19:12:27Z"
    },
    {
      "event": "subscribed",
      "id": 4558621378,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ1NTg2MjEzNzg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558621378",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T19:12:27Z"
    },
    {
      "event": "mentioned",
      "id": 4558621386,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDU1ODYyMTM4Ng==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558621386",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T19:12:27Z"
    },
    {
      "event": "subscribed",
      "id": 4558621389,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ1NTg2MjEzODk=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558621389",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T19:12:27Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNjFkZDc5YzI3Y2I1NzYwYWQ2OGZkYWNmMzQ2Y2MyNmI4ZjU4OGMz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/361dd79c27cb5760ad68fdacf346cc26b8f588c3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/361dd79c27cb5760ad68fdacf346cc26b8f588c3",
      "tree": {
        "sha": "0bc74eaf9e8bb6e3b0491ad4fcda1019e9a2ccd4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0bc74eaf9e8bb6e3b0491ad4fcda1019e9a2ccd4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0bc74eaf9e8bb6e3b0491ad4fcda1019e9a2ccd4\nparent 9be7fe4849310884294669b019dd8300f69bc334\nauthor James O'Beirne <james.obeirne@pm.me> 1617723586 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737746 -0400\n\nvalidation: unannotate g_chainman from needing cs_main\n\nIn preparation for removing `cs_main` requirements for\nChainstateActive()/ActiveChainstate(), relax lock requirements for\ng_chainman.\n\nI have verified that all usages of `g_chainman` that are concurrency-sensitive\nare usages of its members (e.g. `m_blockman`), which are already annotated. The\nreferences to `g_chainman.m_active_chainstate` will be protected by use of\n`std::atomic` in later commits.\n\nHere are all non-`BlockManager`-related usages:\n\n```\n% rg --pcre2 --trim 'g_chainman(?!.m_blockman)'\n\nsrc/net_processing.cpp\n1271:assert(std::addressof(g_chainman) == std::addressof(m_chainman));\n\nsrc/validation.h\n994:extern ChainstateManager g_chainman;\n\nsrc/init.cpp\n1423:node.chainman = &g_chainman;\n\ndoc/release-notes/release-notes-0.21.0.md\n577:- #19927 Reduce direct `g_chainman` usage (dongcarl)\n\nsrc/validation.cpp\n105:ChainstateManager g_chainman;\n109:assert(g_chainman.m_active_chainstate);\n110:return *g_chainman.m_active_chainstate;\n174:assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n\nsrc/node/interfaces.cpp\n479:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n489:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n502:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n514:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n516:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n525:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n527:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n\nsrc/test/util/setup_common.cpp\n143:m_node.chainman = &::g_chainman;\n\nsrc/qt/test/apptests.cpp\n89:UnloadBlockIndex(/* mempool */ nullptr, g_chainman);\n90:g_chainman.Reset();\n```\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBIACgkQepNdrbLE\nTwVqrw//ReUMUyE/ljiDlfqGT8Lat7S17auKREZk7gB4GMyvN5WfZycHepf1x6Jn\nDMGLyOfsxG3fUmgwlzCQg/ir+fFnysA2PYJUebcFhWqx5HuZFoTADSonaHHa3DHX\nMSfOIrd8TRrMuo1LnKzyq0oc9aaoX6UMtOGO9YcddVTP9v2OoVTlT6q9D7HZjv6p\nZzQCD+OoCpuXSUPVfl17xJQykF3JNcvIyu+rUBt45/hUkeV65R4AeFbh9IVxYFXH\nIbYUsrcFI1wJSymGbnyK+KXsDv+2MhKADSsTLe7G8w8+QsvTII1+Zqghk4F+12yo\nU/faM8CdFIWNjJ7lSMli67HtIYYL7SsVZ1H/cY37TjdfPmOiZ8VOZL+NrJ2OkLws\nIIBX9VUxbdk5P+MP48Ndq+vvy2pysPwnQuWj8HFXLOcNFT8yllErZ+Ce2QcYBY9x\nqYVXMZvB1DrHoik52RAqCoRWXvmeJlzrJGl03D+x9wyBlpVthYx/bNfgaMPVFMKy\nNta88gDKyQRv/7Pkl15dKKC6TJV2anQY86tb5dremVAzHPzryY3CNFgduyW37DTB\nRBko6PJBWLFToUBN8x7g4knIiXQHBRwqMJJSZpnj6EVExT05vow2ab1Mt6WmszKO\nHJ5/vIOAMGMaoSzUyjlwnoBkJrYoIQucnSwVRVP+x3FpRLNktIQ=\n=5CTk\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9be7fe4849310884294669b019dd8300f69bc334",
          "sha": "9be7fe4849310884294669b019dd8300f69bc334",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9be7fe4849310884294669b019dd8300f69bc334"
        }
      ],
      "message": "validation: unannotate g_chainman from needing cs_main\n\nIn preparation for removing `cs_main` requirements for\nChainstateActive()/ActiveChainstate(), relax lock requirements for\ng_chainman.\n\nI have verified that all usages of `g_chainman` that are concurrency-sensitive\nare usages of its members (e.g. `m_blockman`), which are already annotated. The\nreferences to `g_chainman.m_active_chainstate` will be protected by use of\n`std::atomic` in later commits.\n\nHere are all non-`BlockManager`-related usages:\n\n```\n% rg --pcre2 --trim 'g_chainman(?!.m_blockman)'\n\nsrc/net_processing.cpp\n1271:assert(std::addressof(g_chainman) == std::addressof(m_chainman));\n\nsrc/validation.h\n994:extern ChainstateManager g_chainman;\n\nsrc/init.cpp\n1423:node.chainman = &g_chainman;\n\ndoc/release-notes/release-notes-0.21.0.md\n577:- #19927 Reduce direct `g_chainman` usage (dongcarl)\n\nsrc/validation.cpp\n105:ChainstateManager g_chainman;\n109:assert(g_chainman.m_active_chainstate);\n110:return *g_chainman.m_active_chainstate;\n174:assert(std::addressof(g_chainman.BlockIndex()) == std::addressof(m_block_index));\n\nsrc/node/interfaces.cpp\n479:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n489:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n502:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n514:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n516:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n525:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n527:assert(std::addressof(g_chainman) == std::addressof(*m_node.chainman));\n\nsrc/test/util/setup_common.cpp\n143:m_node.chainman = &::g_chainman;\n\nsrc/qt/test/apptests.cpp\n89:UnloadBlockIndex(/* mempool */ nullptr, g_chainman);\n90:g_chainman.Reset();\n```",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:46Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T15:39:46Z"
      },
      "sha": "361dd79c27cb5760ad68fdacf346cc26b8f588c3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZDk0OTYyOWM1ODM4ZjMxZTJhMDM4NmM5MmVlYmRjZjJiY2E0YjIw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3d949629c5838f31e2a0386c92eebdcf2bca4b20",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3d949629c5838f31e2a0386c92eebdcf2bca4b20",
      "tree": {
        "sha": "f7854aecb734c871ee576e67bca9a582a4874d89",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f7854aecb734c871ee576e67bca9a582a4874d89"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f7854aecb734c871ee576e67bca9a582a4874d89\nparent 361dd79c27cb5760ad68fdacf346cc26b8f588c3\nauthor James O'Beirne <james.obeirne@pm.me> 1617724988 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737749 -0400\n\nvalidation: make ChainstateManager.m_active_chainstate atomic\n\nThis will allow us to not have to worry about repurposing cs_main as\na mutex for setting this state, and will subsequently allow us to\nremove additional `cs_main` acquisitions and annotations in subsequent\ncommits.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBUACgkQepNdrbLE\nTwWzYhAAota0LP9SBtkWRdOP1D2uP4TEG74/A8si3pB68KGTRL3VYl3WTeFf72rA\n14AVo3g1PoqCqgBXCX0BcN5yRbdPxKv7Iq6Kl0PvSCWfli6Szc3TL0bLC2XIxFW2\nzLT32Wo4nD1+UAkOy2svbX5Rg1FNmh1r97jjSqYmyjrHhC4vHC5oiV22xdKyOTJ4\nctd5Z+e13e9+Odr9EB1PUHG9D+HNSTtvA3nOP8JTrIXWULrdSqwIpmwRSXCDuSzC\nngH9dYPNXUJU31R8tuVnbtwxcBGWOTcw/KRUB43UaigTOAbL2ujXrN+6skAfquaj\nlEd65QbfY5LkEfbzSg/SjTfe+eMxhGRw8y9RqiNKlDkYKQQPgoHRyU6wRsH7h36D\ncYuek9qOtpEHQH4MHiZNFnkXkfaLgVjlxpvc3vd+KouL8fzhT/+7zQKbrTqtExJd\n1uyLnbD9+R0XipDSUhR6+xxMg9qE/GmU1E8LDWP9TC2PxT9zQI/bmIRt47O5gcmM\niOtAm/MrqIPPtRL5E1H3Gy68/NxzKK+WmYSRHAStozI/GazTyEAriESSMyNFu0hV\nVzLGhmzL5+6FpoZiXEWIfUU9F27PWzQNfzXTZY1VGfXPdHnsYNbUNq/a0p/0qhuj\nRBzKNdIoRKIVqxwt4fUXW3g4vfGvh78hhGIFjSiM82q6UO8TKx8=\n=TfTW\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/361dd79c27cb5760ad68fdacf346cc26b8f588c3",
          "sha": "361dd79c27cb5760ad68fdacf346cc26b8f588c3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/361dd79c27cb5760ad68fdacf346cc26b8f588c3"
        }
      ],
      "message": "validation: make ChainstateManager.m_active_chainstate atomic\n\nThis will allow us to not have to worry about repurposing cs_main as\na mutex for setting this state, and will subsequently allow us to\nremove additional `cs_main` acquisitions and annotations in subsequent\ncommits.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:49Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T16:03:08Z"
      },
      "sha": "3d949629c5838f31e2a0386c92eebdcf2bca4b20"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzowOWM5MjRkM2JlYjU2YTZiNjRkODg1NWIxODE4YjZlNzNjNDBlYzBk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09c924d3beb56a6b64d8855b1818b6e73c40ec0d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/09c924d3beb56a6b64d8855b1818b6e73c40ec0d",
      "tree": {
        "sha": "7ea53e3fd58e813da07c89a7a820dad6203a8547",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7ea53e3fd58e813da07c89a7a820dad6203a8547"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7ea53e3fd58e813da07c89a7a820dad6203a8547\nparent 3d949629c5838f31e2a0386c92eebdcf2bca4b20\nauthor James O'Beirne <james.obeirne@pm.me> 1617725083 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737751 -0400\n\nvalidation: remove cs_main requirement from m_active_chainstate\n\nAtomicity of this data no longer requires explicit locking.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBcACgkQepNdrbLE\nTwXiaRAAjk8LXElpG11iIrfEBYOrXPVshMQV7S8GfV2uEzq1zIp7VVBTOmaMhQ0E\n4HjoSfJDTtUjEGS4EE9sBnWtitqUqoVo3vApbE2y3hgjbYP0CwT1tycT5LpLwc8A\n4qsWOT1MCAnoxyLA5TyKzDdGnhIZISCJlrb5dB0T832cOkuXQSQnbymD0Hlsh6F4\nNiNvCHk/hU8fRxgrPQFpIKZODw8PytDDb06Qvf47wmesQqBKJNMTat4HgKwJWFUr\nGpSQIgzrNbg5Vz1tR2wu+0VA65rMQAg3Zjp7xg9esdLDwmMLuoxkBeP6W8yJ2u5Y\nQIURXfnNhYU+Plw6/cO7nLyeyqUUc6U73dGHv0YyKiIQSZs0smjDDemlT/trvxBL\nKPBcfEOL+q2uueRty2na0gxTR9qAY7ah76bNG5oAbBJkTgSGtagAGjKuNpaf/+kf\nQbtYL5COQu/1vaZeDEqkaNlT9e4yQ8fJM/ghX7HyvZQ7SwxIjpNVcd2rg2aY7vKz\nxyEcWkOJYuD4k6hNlZDSpGFI9DVDpsj45KsGYpEaMJ7VWWdN8E3h5A2NNdpQSn/S\nKUiOaEIibdN3N2xO4RnQND9UcIAI/C5uI4vfxiQh8kbnrduj0a/rPPQBGuLHmsPY\nbiV1aAV3bOgbN18//xq/LysmVAgKMwWIXdGuhBeaUGxNfNTed6U=\n=pD6U\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3d949629c5838f31e2a0386c92eebdcf2bca4b20",
          "sha": "3d949629c5838f31e2a0386c92eebdcf2bca4b20",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3d949629c5838f31e2a0386c92eebdcf2bca4b20"
        }
      ],
      "message": "validation: remove cs_main requirement from m_active_chainstate\n\nAtomicity of this data no longer requires explicit locking.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:51Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T16:04:43Z"
      },
      "sha": "09c924d3beb56a6b64d8855b1818b6e73c40ec0d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1Yjg1ODdmMGJmNTA3NmQ2NjUxZWM2N2Q0YTk0MTAzNGI1Mjg3NDI5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b8587f0bf5076d6651ec67d4a941034b5287429",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5b8587f0bf5076d6651ec67d4a941034b5287429",
      "tree": {
        "sha": "b74f7d4fa35f349b0e1fabeacb427dc4717c9869",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b74f7d4fa35f349b0e1fabeacb427dc4717c9869"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree b74f7d4fa35f349b0e1fabeacb427dc4717c9869\nparent 09c924d3beb56a6b64d8855b1818b6e73c40ec0d\nauthor James O'Beirne <james.obeirne@pm.me> 1617734009 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737752 -0400\n\nvalidation: introduce ChainstateManager.m_cs_chainstates\n\nTo avoid (confusingly) repurposing cs_main to manage internal\nChainstateManager chainstate references, introduce a specific lock for this\npurpose.\n\nIt's a RecursiveMutex (and not a Mutex) to facilitate acquiring the lock\nin MaybeRebalanceCaches, since we'd otherwise have to give the lock public\nclass visibility (to allow callers to lock it).\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBgACgkQepNdrbLE\nTwXuvg/+P23wto0xJhzQvmTAXz1Qs6BzL8kDA1kbG/L3+K6oGyoEdY/4xckhuupA\nb/4wfxV0IjNQbvQiVHnHF8KG7TLFY9McfeZvS2kpSHUThFkM2K1owM0eh04+peYf\nMpSXg+q066J8wltQ9VVV4rzv7y4AlmIa9GZb5lOIT81WvxfJb6OHxJJZ6oP+jGHZ\nVa9oG47M4zU/77IEriMY65cmFdEE8+PUclf59hlkOo0dJDlmU/3r9KXhaslVwDSe\nU/PdKJpaWNXkzKwdEbBSDVSvYSHkeL8jS+IKlx1u5Wb/qvFa1grNP0eMqXKB040A\nxpYaQJW+IWIpoVKmBgN1s5+oE1LpfareVzkuzCmDFpMvnLXEDkftOkvrmzJCmMd6\nbDvHGf2FIT6Cv3GFizSCDlzWnPmKusNhncvjruPuIkYqAE7efNrIyLTUj8Di9RUc\nhW8TjoiucbcXAPnGWW712/GKZUUdjdQhqtKa5z5i4XOCehxCvE1vgYnJb43JS21M\nQgzceCMReqGubBFSvj14TNNJd/qH50Omg54dKM3Ehz5Gf/HDKsOK1Vsu6D6+LIzw\npnC79cSn6lgmrQlqKnciOxtbNkol+H8gofJGSCXcqLe/pIX9S6NCNiKktPs4olTs\nXT5/wRK4yKSJxgzWCnJptCjcJTfZF9K49wO3VCH5Mr6Yo16S+RI=\n=tTta\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09c924d3beb56a6b64d8855b1818b6e73c40ec0d",
          "sha": "09c924d3beb56a6b64d8855b1818b6e73c40ec0d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/09c924d3beb56a6b64d8855b1818b6e73c40ec0d"
        }
      ],
      "message": "validation: introduce ChainstateManager.m_cs_chainstates\n\nTo avoid (confusingly) repurposing cs_main to manage internal\nChainstateManager chainstate references, introduce a specific lock for this\npurpose.\n\nIt's a RecursiveMutex (and not a Mutex) to facilitate acquiring the lock\nin MaybeRebalanceCaches, since we'd otherwise have to give the lock public\nclass visibility (to allow callers to lock it).",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:52Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T18:33:29Z"
      },
      "sha": "5b8587f0bf5076d6651ec67d4a941034b5287429"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ODQ4MGUyOTNiNjBjZmJhMjBhZTY5YzVkYWRhNDg3NDM5YWEzOTUy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98480e293b60cfba20ae69c5dada487439aa3952",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/98480e293b60cfba20ae69c5dada487439aa3952",
      "tree": {
        "sha": "fa4ce0f5dd812e985eb74ca55cb1fd6f2aaa1579",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fa4ce0f5dd812e985eb74ca55cb1fd6f2aaa1579"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree fa4ce0f5dd812e985eb74ca55cb1fd6f2aaa1579\nparent 5b8587f0bf5076d6651ec67d4a941034b5287429\nauthor James O'Beirne <james.obeirne@pm.me> 1617734191 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737754 -0400\n\ndoc: fix outdated ChainstateManager doc\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBoACgkQepNdrbLE\nTwUQnA/+NrCsrUWx9mEZaOLXVwT6HRDVT9/efqH9X3+O4AnKN5bM6+m2BwZ0zyze\n83x/O2SYEH5ngs4yQ0+LJW/tzKuYvgjljSs1ucSoACBC6x54B5uCyDB4+Ul5bmF1\nD8MupXGHs+hJj6OZuHHcItRIOoVU0C0ssO1BKu0+6d/I5ymGqP8gyqgD9JPegGZG\n3K+edKXexFLe+vtIRYx0fdYULMLJIzjAvQGPprpOQe2MYBx5TmaBBvxSyDJZRb3o\nlKpoTY9UqdAudq/vc3sozY6vcCjg0Sml1yDXURJ8qBhx24oNLf30GddfDSEtZD/p\nzlwCXKCr5eXyRytwiAQCwO9EZo7gIEWG/bhvBZEmfZ2tozcHKoJ5AswO0oYm9XsZ\neo33tTOEQWG6Aw2l9iWR7XIndwJgtwAbfztqoFoqCN3CnN02UxOECuJHyRxj39Xh\nPmSorW/b+u86rwLD0aLB6dDoxH1nUORP18POzvpqLWlsuNFftBpw1zOQU1mBaS+G\nQl/n3R9xM1R2InKEBYifrEi1o68G4SbAhcSXOGgElP16G26TsM9FtTZVGrht80Yc\nZEhYz+Q917HcRhUgpmFYgEO4AR/qKqaLsvxGPCxuLHhsjBC8JQNjshMwk+Cu4lYd\n75SRd3sb/vCjbkriU2CJt2umLUOQlNp7eJtxPZ3Ka2rnQD6IIgU=\n=eAlw\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5b8587f0bf5076d6651ec67d4a941034b5287429",
          "sha": "5b8587f0bf5076d6651ec67d4a941034b5287429",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5b8587f0bf5076d6651ec67d4a941034b5287429"
        }
      ],
      "message": "doc: fix outdated ChainstateManager doc",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:54Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T18:36:31Z"
      },
      "sha": "98480e293b60cfba20ae69c5dada487439aa3952"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZWYxMDMyOGZjODM1YTM4YzNiYWMwYjQzYTRjNDQyZmQwMTA3MGUx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7ef10328fc835a38c3bac0b43a4c442fd01070e1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7ef10328fc835a38c3bac0b43a4c442fd01070e1",
      "tree": {
        "sha": "36fc41a09cde71822d2463d218b1767f5896a57d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/36fc41a09cde71822d2463d218b1767f5896a57d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 36fc41a09cde71822d2463d218b1767f5896a57d\nparent 98480e293b60cfba20ae69c5dada487439aa3952\nauthor James O'Beirne <james.obeirne@pm.me> 1617734329 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737755 -0400\n\ndoc: note about InitializeChainstate() cs_main use\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuBsACgkQepNdrbLE\nTwV7NA//RxwiLzzS3OUdq6Tx5jUC1imrcA9fSUAB6Ea4NazO2FlHScaZgcXRxqxP\n0W6Ay5ajVbUYmzRlYH9uW4y+WcLG35Ku4I6dlzCPW0n/k2/7WksPdmUILqkIkv4b\n7L+nHhLhP3BLtagcLkybdN1Kj0KhqyJ4PS3TYIbZvVx8n1kViuaQAEwGtpU53k2q\nufNfasMOYFf1ojct6GoPhC0m2+TCQ/jTTDABWfIhHUmVf3jS3ylFIckuL3RQFBAZ\nqcSHpfYbJZpyvoEdlSt5bZ3JCg/rCiKVZL2d/KmfNRZhmOBPiSJudApzXjIVhm7l\nL2mDCZTlh2k011I9CF/2dFGlmtx80Vuhwx0fTFNfpyq0gaE4SKXTlxgIrIgF9DNM\njHYlhIqNySjx4G6ZmjMU883aNGFfBXjD1aZL83B6CSJNnMCBybqukoTKxnh9DNlv\nbjzRHAcV0Cayu8Dsyb3Qrgtru+9t4DYDWlcGLqDv11hiSrlI+lIZKVOpw3ct45rm\nOjcVHPtssHIzKowfrug31n/24bEl7DLi58aGqCKmnPsoQkEI5O264fAx66Rwu5MP\nhc4wY+zWm2qQaJUpRyWxkJ9tpcFJ77VayuROV/f0CkQZvSog+gMog2V+ARsYgU7p\nh3rk28Bb1Bn1m5rS57aCtKehe3G9/mZZjcmqDxjAPY8HnSH+6s0=\n=oyBo\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98480e293b60cfba20ae69c5dada487439aa3952",
          "sha": "98480e293b60cfba20ae69c5dada487439aa3952",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/98480e293b60cfba20ae69c5dada487439aa3952"
        }
      ],
      "message": "doc: note about InitializeChainstate() cs_main use",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:55Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T18:38:49Z"
      },
      "sha": "7ef10328fc835a38c3bac0b43a4c442fd01070e1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4MjU3ZTlhYjc1OTJhN2ZlNDU5MDg5ZjAyMTA1M2M3NzQwMDA0ODE3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8257e9ab7592a7fe459089f021053c7740004817",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8257e9ab7592a7fe459089f021053c7740004817",
      "tree": {
        "sha": "3f3645bf55b2d900ec7bd8dcfd6893cd6f80eb67",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3f3645bf55b2d900ec7bd8dcfd6893cd6f80eb67"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3f3645bf55b2d900ec7bd8dcfd6893cd6f80eb67\nparent 7ef10328fc835a38c3bac0b43a4c442fd01070e1\nauthor James O'Beirne <james.obeirne@pm.me> 1617735157 -0400\ncommitter James O'Beirne <james.obeirne@pm.me> 1617737757 -0400\n\nvalidation: annotate m_chain with cs_main\n\nWhich in turn requires `PruneIndexBlockCandidates()` to be annotated;\nluckily no locking changes are needed there.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEGNRVI1NPYuZCSIrGepNdrbLETwUFAmBsuB0ACgkQepNdrbLE\nTwXz2BAAmcu42+g/LWREkrtzPIAEDoC+fwIpE8nlvvQMaUteK8FS86tSTYVEONAC\nAG0jOuemXsmu9Y+WSEMyiDCBr+Fs1/dSnmsEpRHubjVZxdZqtCGgHvI7LllMmRq2\nOSAnP12XPDXqxJ+eBU9mSBwvSXZbufQvNGhobhPrypEFwMn9QthGZHMv004eUAgU\n3zXhUwnFaGsSBjgfqFYnh81nkhBy/p/0LgF0WNMA9l84CChkxiZe4tr/efVU/Gas\n2qqZcA7viPvTs3thgBfzIFk1xbyNON0cXyrlfk1zogTwO9u4cVph71bBMt+y7cGN\nTzZzGAHuxqmNzKEh+8/AtiJpWfSYaHKHMj13ep43foc1CljKdPM1Kpe0JWvXq0m0\n13E5FChcRD1UXst7rdzNHIif0QtaMt0anrnYXynWdMZ0R45m9pzzrCSrcRJE0lbB\nbwbx8TKqC3lQKnBf1lLjM1ntH+qR1WpryVjDAHIVOfTy3FEEiFuHPO9XGEsBZ1X7\nrC4WrBLhEMrfUiXtTr/hMog9oEbpGt7DFFhmyoMRQyCIPHeaU/mLp0HtWTsae9f0\njbK3KkfTA4mxqRMXGCCFVUOw716up/rljgUEWeQUAIjiTFAg6hloR/AuvEr9XGPD\nSpIxuyLsj6HBTShDyQ+VUjSmU1/+GorIFF5fe7dQyHGPOLQ/IHA=\n=F4xZ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7ef10328fc835a38c3bac0b43a4c442fd01070e1",
          "sha": "7ef10328fc835a38c3bac0b43a4c442fd01070e1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7ef10328fc835a38c3bac0b43a4c442fd01070e1"
        }
      ],
      "message": "validation: annotate m_chain with cs_main\n\nWhich in turn requires `PruneIndexBlockCandidates()` to be annotated;\nluckily no locking changes are needed there.",
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T19:35:57Z"
      },
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@pm.me",
        "date": "2021-04-06T18:52:37Z"
      },
      "sha": "8257e9ab7592a7fe459089f021053c7740004817"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 4558718801,
      "node_id": "MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50NDU1ODcxODgwMQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558718801",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T19:36:34Z"
    },
    {
      "event": "labeled",
      "id": 4558844648,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ1NTg4NDQ2NDg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4558844648",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T20:07:28Z",
      "label": {
        "name": "Validation",
        "color": "6060aa"
      }
    },
    {
      "event": "commented",
      "id": 814412610,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDQxMjYxMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814412610",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T20:19:11Z",
      "updated_at": "2021-04-06T20:20:02Z",
      "author_association": "MEMBER",
      "body": "It's great for this to be removing the recursive locks in 09c924d3beb56a6b64d8855b1818b6e73c40ec0d and 5b8587f0bf5076d6651ec67d4a941034b5287429. Also annotating CChainState::m_chain in 8257e9ab7592a7fe459089f021053c7740004817 makes a lot of sense.\r\n\r\nThe thing I don't understand is what bug is prevented by making `m_active_chainstate` `std::atomic<CChainState*>` instead of `CChainState*`? What bugs are prevented by adding `LOCK(m_cs_chainstates);` or having `m_cs_chainstates` exist at all?\r\n\r\nNot putting EXCLUSIVE_LOCKS_REQUIRED(cs_main) on ChainstateManager methods seems like Six Flags saying congratulations, we're waiving the $100 fee to get into the park, we're just going to charge you $100 the first time you get onto any ride. It seems like this could only be appealing if you wanted to go to a `CChainState` theme park without trying any rides (accessing any data inside).\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-814412610",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 814504792,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDUwNDc5Mg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814504792",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-06T23:51:22Z",
      "updated_at": "2021-05-12T16:32:23Z",
      "author_association": "MEMBER",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21789 (refactor: Remove ::Params() global from CChainState by MarcoFalke)\n* #21584 (Fix assumeutxo crash due to invalid base_blockhash by MarcoFalke)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-814504792",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 814548722,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDU0ODcyMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/814548722",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T02:08:46Z",
      "updated_at": "2021-04-07T02:08:46Z",
      "author_association": "MEMBER",
      "body": "Thanks for the quick look @ryanofsky. \r\n\r\n> The thing I don't understand is what bug is prevented by making m_active_chainstate std::atomic<CChainState*> instead of CChainState*? What bugs are prevented by adding LOCK(m_cs_chainstates); or having m_cs_chainstates exist at all?\r\n\r\nStrictly speaking, I don't think there's a difference in bugs between this approach and just repurposing `cs_main` to guard this stuff. But there are a number of usability/maybe-performance arguments. I think the major arguments are:\r\n- `cs_main` is a lock that's used for many different things, and eventually (I think?) we want to break it up into more granular, specified locks - though I could be wrong about that,\r\n- it's kind of nice not having to worry callers about *any* locks if indeed this `std::atomic` approach works in the way that I claim it does, because....\r\n- otherwise, if we apply a `GUARDED_BY(::cs_main)` to `m_active_chainstate`, we'll need to do [awkward stuff like temporarily holding `cs_main`](https://github.com/bitcoin/bitcoin/pull/17737/files#diff-b1e19192258d83199d8adaa5ac31f067af98f63554bfdd679bd8e8073815e69dR713-R722) to acquire the active chainstate before we call `ActivateBestChain()`, since you can't go into ABC holding cs_main.\r\n\r\nI think your Six Flags analogy is both entertaining and true (in a strict sense), but if everyone generally agrees that we eventually need to break up `cs_main` to avoid unnecessary lock contention, then I think these changes are a step in that direction.\r\n\r\nBut otherwise I'm happy to separate out the commits that you mention and just annotate everything with `cs_main` if it makes more sense for that lock to live on in its spirit of \"I lock every damn thing related to chainstate,\" which may be easier to reason about than having three or four more granular locks running around.\r\n\r\nBut it does seem appealing to decouple, say, block storage locking from chain locking so that we can do things like prune while continuing validation. And longer term I suspect that each chainstate instance will want its own little cs_main so that we can do various chainstate operations in parallel should something like utreexo come around.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-814548722",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "mentioned",
      "id": 4559818789,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDU1OTgxODc4OQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4559818789",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T02:08:46Z"
    },
    {
      "event": "subscribed",
      "id": 4559818796,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ1NTk4MTg3OTY=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4559818796",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-07T02:08:46Z"
    },
    {
      "event": "commented",
      "id": 816222195,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxNjIyMjE5NQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/816222195",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-08T21:28:45Z",
      "updated_at": "2021-04-08T21:28:45Z",
      "author_association": "MEMBER",
      "body": "Will review in more detail, and I'm all for lock granularity if locks are independent. But if we're just turning one lock into two dependent locks where you acquire one lock, release it, then always acquire the other lock, it seems pointlessly complex. It increases the number of states things can be in and makes thread safety annotations less likely to catch race conditions. If there is theoretically a place where having these two locks could be better for performance, I would be curious to know where it is. The ActivateBestChain example just seems like a case of weird code organization that should be cleaned up, not a case where two locks make more sense for code as it is executed.\r\n\r\nI think the clearest thing would be for this low level code not to have any synchronization: no locks or atomics, just plain annotations stating locking assumptions so higher level code can call it correctly. I've suggested this before https://github.com/bitcoin/bitcoin/pull/19806#pullrequestreview-584279133, and it can be done separately from this PR. This PR does make other improvements, and I'm happy with all the changes, and planning to review it.\r\n\r\n\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-816222195",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "referenced",
      "id": 4585342781,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ1ODUzNDI3ODE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4585342781",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2bf55979663d5e6ecad645e0a8adef8683260301",
      "commit_url": "https://api.github.com/repos/dongcarl/bitcoin/commits/2bf55979663d5e6ecad645e0a8adef8683260301",
      "created_at": "2021-04-13T01:46:43Z"
    },
    {
      "event": "commented",
      "id": 818372304,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxODM3MjMwNA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818372304",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T01:51:21Z",
      "updated_at": "2021-04-13T01:51:21Z",
      "author_association": "MEMBER",
      "body": "I haven't read everything yet, and plan on doing it soon. Q for you: Does this mean that even if we hold `::cs_main`, we won't be sure that the `m_active_chainstate` won't change from under us?",
      "user": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-818372304",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "referenced",
      "id": 4585466015,
      "node_id": "MDE1OlJlZmVyZW5jZWRFdmVudDQ1ODU0NjYwMTU=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4585466015",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4d7947f31c920d1a3a1bcbdf730509351075d182",
      "commit_url": "https://api.github.com/repos/dongcarl/bitcoin/commits/4d7947f31c920d1a3a1bcbdf730509351075d182",
      "created_at": "2021-04-13T02:40:58Z"
    },
    {
      "event": "commented",
      "id": 818814730,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxODgxNDczMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818814730",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:12:03Z",
      "updated_at": "2021-04-13T15:12:03Z",
      "author_association": "MEMBER",
      "body": "Good points @ryanofsky @dongcarl. After digesting this a little, I actually think that both this approach *and* our current approach have bugs.\r\n\r\nConsider the case where `ActivateSnapshot()` is called [at this moment during `ProcessNewBlock()`](https://github.com/jamesob/bitcoin/blob/c47a00d3de4ac3e62d3eee215f6180d4f3170dfb/src/validation.cpp#L3840). Neither a `cs_main` hold nor the `atomic` approach here for guarding the contents of `m_active_chainstate` will prevent a different active chainstate from being used in the contents of PNB above this line, creating a situation where we've called `AcceptBlock()` on a different chainstate than the one we've called `ActivateBestChain()` on.\r\n\r\nThe narrow solution in this case is maybe obviously to grab a single chainstate at the top of the function (instead of `calling` `ActiveChainstate()` for each usage), but I'm trying to think about what the right arrangement of locks and annotations would be to prevent this situation in general.",
      "user": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-818814730",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "mentioned",
      "id": 4588693107,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDU4ODY5MzEwNw==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4588693107",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:12:03Z"
    },
    {
      "event": "subscribed",
      "id": 4588693112,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ1ODg2OTMxMTI=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4588693112",
      "actor": {
        "login": "dongcarl",
        "id": 3445290,
        "node_id": "MDQ6VXNlcjM0NDUyOTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dongcarl",
        "html_url": "https://github.com/dongcarl",
        "followers_url": "https://api.github.com/users/dongcarl/followers",
        "following_url": "https://api.github.com/users/dongcarl/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dongcarl/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dongcarl/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
        "organizations_url": "https://api.github.com/users/dongcarl/orgs",
        "repos_url": "https://api.github.com/users/dongcarl/repos",
        "events_url": "https://api.github.com/users/dongcarl/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dongcarl/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:12:03Z"
    },
    {
      "event": "mentioned",
      "id": 4588693115,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDU4ODY5MzExNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4588693115",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:12:03Z"
    },
    {
      "event": "subscribed",
      "id": 4588693118,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ1ODg2OTMxMTg=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4588693118",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:12:03Z"
    },
    {
      "event": "commented",
      "id": 818836912,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxODgzNjkxMg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/818836912",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-13T15:40:50Z",
      "updated_at": "2021-04-13T15:40:50Z",
      "author_association": "MEMBER",
      "body": "> The narrow solution in this case is maybe obviously to grab a single chainstate at the top of the function (instead of `calling` `ActiveChainstate()` for each usage)\r\n\r\nYes, please. This was on my unimplemented review suggestion followup list. https://github.com/bitcoin/bitcoin/pull/20749#discussion_r560979259 https://github.com/bitcoin/bitcoin/pull/20749#pullrequestreview-578845627 https://github.com/bitcoin/bitcoin/pull/21025#pullrequestreview-581735705 \"Best would be to have a CChainState* chain_state local variable that is initialized while cs_main is held above, and then used here.\"\r\n\r\n> but I'm trying to think about what the right arrangement of locks and annotations would be to prevent this situation in general.\r\n\r\nIt seems to me replacing synchronization with annotations in ChainstateManager (removing the locks and atomic and adding EXCLUSIVE_LOCKS_REQUIRED(cs_main) as suggested) would ensure callers use it correctly, or at least have to think about using it correctly.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-818836912",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 819675825,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTY3NTgyNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819675825",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-14T17:05:07Z",
      "updated_at": "2021-04-14T17:05:07Z",
      "author_association": "MEMBER",
      "body": "Offline thread:\r\n\r\n\\<james>: I think we need cs_active_chainstate or something that functions like PNB either acquire or are annotated with to prevent the active chainstate from being swapped out during their usage\r\n\r\n\\<russ>: I'm not trying to claim adding lock annotations will prevent all Chainstatemanger callers from being buggy and wrongly assuming chainstate doesn't change when they didn't lock it. I don't think there is anything Chainstatemanager can do to prevent that unless it's going to go into the kernel and freeze all running threads. My claim is just that bugs are less likely if locking cs_main locks the chainstate and callers are forced to lock cs_main and thinking about locking when they use ChainstateManager\r\n\r\n\\<james>: The kind of sad thing is that that swap-out only happens once during runtime (i.e. when ActivateSnapshot() is called) and really we could avoid a lot of this mess if we restricted snapshots to being loaded at init time\r\n\r\n\\<russ>: I don't see what's that complicated about this. If you don't want the active chainstate to change, then you should lock cs_main. If you don't care whether the active chainstate changes then you can take a reference to the chainstate and not lock cs_main.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-819675825",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 819680129,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTY4MDEyOQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819680129",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-14T17:11:11Z",
      "updated_at": "2021-04-14T17:11:11Z",
      "author_association": "MEMBER",
      "body": "If there is a case where it's neccessary for code to release cs_main but prevent the active chain from changing would suggest a condition variable:\r\n\r\n```c++\r\nbool m_lock_chainstate = false;\r\nstd::condition_variable m_lock_chainstate_cv;\r\n```\r\n\r\nThen in the code that wants to update the chainstate:\r\n\r\n```c++\r\nlock_chainstate_cv.wait(cs_main, []{return !lock_chainstate;});\r\n```\r\n\r\nAnd the code that wants to lock the chainstate without holding cs_main:\r\n\r\n```c++\r\nm_lock_chainstate = true;\r\nm_lock_chainstate_cv.notify_all();\r\n\r\n...\r\n\r\nm_lock_chainstate = false;\r\nm_lock_chainstate_cv.notify_all()\r\n```",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-819680129",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 819685974,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTY4NTk3NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/819685974",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-14T17:20:42Z",
      "updated_at": "2021-04-14T17:22:32Z",
      "author_association": "MEMBER",
      "body": "Actually I guess that could be equivalent to your [active_chainstate](https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-819675825) mutex if it using manual locking instead of a scoped lock. So maybe I'll arrive at the same conclusion as you from a different angle. It just seems like there are a lot of solutions here, and there shouldn't be any conflict between a good solution and one that uses compiler thread safety annotations",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-819685974",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 820330794,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgyMDMzMDc5NA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820330794",
      "actor": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-15T10:53:42Z",
      "updated_at": "2021-04-15T10:53:42Z",
      "author_association": "MEMBER",
      "body": "I haven't looked at the code here yet, but I want to respond to a couple of the points raised in the discussion here:\r\n\r\n> Not putting EXCLUSIVE_LOCKS_REQUIRED(cs_main) on ChainstateManager methods seems like Six Flags saying congratulations, we're waiving the $100 fee to get into the park, we're just going to charge you $100 the first time you get onto any ride. It seems like this could only be appealing if you wanted to go to a CChainState theme park without trying any rides (accessing any data inside).\r\n\r\n> I think the clearest thing would be for this low level code not to have any synchronization: no locks or atomics, just plain annotations stating locking assumptions so higher level code can call it correctly.\r\n\r\nMost of the client code (eg in net_processing, rpc, etc) shouldn't need to lock chainman in most cases. Usually it's just trying to read a single piece of data (whether we're in IBD, what the current height is, fetch a CBlockIndex pointer to the tip, etc). The higher level code shouldn't have to concern itself with locks in those cases, and in fact those operations can be made lock-free by using atomics to cache the data (as `IsInitialBlockDownload()` used to do, but now sadly requires cs_main in most cases). Removing cs_main locks from the rpc methods and the GUI's `node/interface` methods would ensure that RPC/GUI is never blocking validation from doing useful work. Reducing cs_main usage in net_processing would open the possibility to parallelizing IBD (either with multiple net_processing threads or a separate validation thread).\r\n\r\nThere are also cases where the client code _does_ want to carry out multiple operations atomically on chainman. For those cases, I think it makes sense to expose `cs_main` to the caller and enforce it with annotations.",
      "user": {
        "login": "jnewbery",
        "id": 1063656,
        "node_id": "MDQ6VXNlcjEwNjM2NTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jnewbery",
        "html_url": "https://github.com/jnewbery",
        "followers_url": "https://api.github.com/users/jnewbery/followers",
        "following_url": "https://api.github.com/users/jnewbery/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jnewbery/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jnewbery/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
        "organizations_url": "https://api.github.com/users/jnewbery/orgs",
        "repos_url": "https://api.github.com/users/jnewbery/repos",
        "events_url": "https://api.github.com/users/jnewbery/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jnewbery/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-820330794",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 820373026,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgyMDM3MzAyNg==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/820373026",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-04-15T12:09:14Z",
      "updated_at": "2021-04-15T12:09:14Z",
      "author_association": "MEMBER",
      "body": "> Most of the client code (eg in net_processing, rpc, etc) shouldn't need to lock chainman in most cases. Usually it's just trying to read a single piece of data (whether we're in IBD, what the current height is, fetch a CBlockIndex pointer to the tip, etc). \r\n\r\nYes, I think we are on the same page. When you just need one piece of data, this is what atomics are for and it makes sense to switch a variable from `T` to `atomic<T>` or `T*` to `atomic<T*>` so you can read it without locking. And for an API:\r\n\r\n```c++\r\nT GetData() EXCLUSIVE_LOCKS_REQUIRED(cs_main);\r\nT GetCachedData();\r\n```\r\n\r\nis nice. But you can make individual variables atomic or not without affecting anything else more broadly. I do think it makes sense to delay switching a variable from `T` to `atomic<T>` until you have at least one piece of code that's reading it without a lock.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-820373026",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "commented",
      "id": 831141850,
      "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTE0MTg1MA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/831141850",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-03T09:32:25Z",
      "updated_at": "2021-05-03T09:32:25Z",
      "author_association": "MEMBER",
      "body": "<!--4a62be1de6b64f3ed646cdc7932c8cf5-->\n @sipa has been requested to review this pull request as specified in the REVIEWERS file.",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-831141850",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "mentioned",
      "id": 4677163505,
      "node_id": "MDE0Ok1lbnRpb25lZEV2ZW50NDY3NzE2MzUwNQ==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4677163505",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-03T09:32:25Z"
    },
    {
      "event": "subscribed",
      "id": 4677163511,
      "node_id": "MDE1OlN1YnNjcmliZWRFdmVudDQ2NzcxNjM1MTE=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4677163511",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-03T09:32:25Z"
    },
    {
      "event": "labeled",
      "id": 4738654120,
      "node_id": "MDEyOkxhYmVsZWRFdmVudDQ3Mzg2NTQxMjA=",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/4738654120",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-12T20:46:00Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 840085400,
      "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDA4NTQwMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/840085400",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-05-12T20:46:01Z",
      "updated_at": "2021-05-12T20:46:01Z",
      "author_association": "MEMBER",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a \"draft\".</sub>",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/21620#issuecomment-840085400",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/21620"
    },
    {
      "event": "closed",
      "id": 5119373430,
      "node_id": "MDExOkNsb3NlZEV2ZW50NTExOTM3MzQzMA==",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/5119373430",
      "actor": {
        "login": "jamesob",
        "id": 73197,
        "node_id": "MDQ6VXNlcjczMTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jamesob",
        "html_url": "https://github.com/jamesob",
        "followers_url": "https://api.github.com/users/jamesob/followers",
        "following_url": "https://api.github.com/users/jamesob/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jamesob/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jamesob/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
        "organizations_url": "https://api.github.com/users/jamesob/orgs",
        "repos_url": "https://api.github.com/users/jamesob/repos",
        "events_url": "https://api.github.com/users/jamesob/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jamesob/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2021-08-05T19:29:04Z"
    },
    {
      "event": "locked",
      "id": 7199162531,
      "node_id": "LOE_lADOABII584yxHJuzwAAAAGtGoCj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/7199162531",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2022-08-16T17:26:36Z",
      "lock_reason": "resolved"
    }
  ],
  "comments": []
}
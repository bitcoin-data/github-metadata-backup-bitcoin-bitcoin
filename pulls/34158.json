{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158",
    "id": 3132300728,
    "node_id": "PR_kwDOABII5866sx24",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34158",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34158.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34158.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/ddc4faafd2150aed08a5956638a8781ede234e4e",
    "number": 34158,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "torcontrol: Remove libevent usage",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This is part of the effort to remove the libevent dependency from our code base: https://github.com/bitcoin/bitcoin/issues/31194\r\n\r\nThe current approach tries to reuse existing code and follows roughly similar design decisions. It replaces the libevent-based async I/O with blocking I/O utilizing the existing `Sock` and `CThreadInterrupt`. The controller runs in a dedicated thread.\r\n\r\nThere are some optional code modernizations thrown in made along the way (namings, constexpr etc.). These are not strictly necessary but make the end result with the new code more consistent.",
    "labels": [],
    "created_at": "2025-12-27T14:20:31Z",
    "updated_at": "2026-02-21T04:55:24Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "22611059f25457cf7ed0062aa53dff29a1a25ac2",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "fjahr:2025-12-torcontrol-take-3",
      "ref": "2025-12-torcontrol-take-3",
      "sha": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 196253948,
        "node_id": "MDEwOlJlcG9zaXRvcnkxOTYyNTM5NDg=",
        "name": "bitcoin",
        "full_name": "fjahr/bitcoin",
        "owner": {
          "login": "fjahr",
          "id": 1322187,
          "node_id": "MDQ6VXNlcjEzMjIxODc=",
          "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/fjahr",
          "html_url": "https://github.com/fjahr",
          "followers_url": "https://api.github.com/users/fjahr/followers",
          "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
          "organizations_url": "https://api.github.com/users/fjahr/orgs",
          "repos_url": "https://api.github.com/users/fjahr/repos",
          "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/fjahr/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/fjahr/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/fjahr/bitcoin",
        "archive_url": "https://api.github.com/repos/fjahr/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/fjahr/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/fjahr/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/fjahr/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/fjahr/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/fjahr/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/fjahr/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/fjahr/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/fjahr/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/fjahr/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/fjahr/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/fjahr/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/fjahr/bitcoin/events",
        "forks_url": "https://api.github.com/repos/fjahr/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/fjahr/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/fjahr/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/fjahr/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/fjahr/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/fjahr/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/fjahr/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/fjahr/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/fjahr/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/fjahr/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/fjahr/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/fjahr/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/fjahr/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/fjahr/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/fjahr/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/fjahr/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:fjahr/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/fjahr/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/fjahr/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/fjahr/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/fjahr/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/fjahr/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/fjahr/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/fjahr/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/fjahr/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/fjahr/bitcoin/hooks",
        "svn_url": "https://github.com/fjahr/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 4,
        "watchers_count": 4,
        "size": 289987,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-20T23:20:18Z",
        "created_at": "2019-07-10T18:11:06Z",
        "updated_at": "2024-07-23T22:14:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "01651324f4e540f6b96cff31e89752c3f9417293",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38921,
        "stargazers_count": 88202,
        "watchers_count": 88202,
        "size": 305479,
        "default_branch": "master",
        "open_issues_count": 719,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-21T00:46:15Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-21T04:47:47Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 489,
    "deletions": 295,
    "changed_files": 5,
    "commits": 7,
    "review_comments": 28,
    "comments": 15
  },
  "events": [
    {
      "event": "commented",
      "id": 3694007666,
      "node_id": "IC_kwDOABII587cLhVy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694007666",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T14:20:37Z",
      "updated_at": "2026-02-21T04:55:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34158.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3764802405) |\n| Concept ACK | [sedited](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694015450), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694074809), [janb84](https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3614742906), [waketraindev](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694830686) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34486](https://github.com/bitcoin/bitcoin/pull/34486) (net: Reduce local network activity when networkactive=0 by willcl-ark)\n* [#33414](https://github.com/bitcoin/bitcoin/pull/33414) (tor: enable PoW defenses for automatically created hidden services by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT) in src/torcontrol.cpp\n- socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) in test/functional/feature_torcontrol.py\n\n\n\n<sup>2026-01-30 13:30:16</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694007666",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3694015450,
      "node_id": "IC_kwDOABII587cLjPa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694015450",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T14:35:33Z",
      "updated_at": "2025-12-27T14:35:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694015450",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3694017377,
      "node_id": "IC_kwDOABII587cLjth",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694017377",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T14:38:52Z",
      "updated_at": "2025-12-27T14:38:52Z",
      "author_association": "MEMBER",
      "body": "concept ACK\r\nQuick review on github - where are you using LineReader?",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694017377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21766045572,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAURW3-E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21766045572",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "a830323f413e804372b4cb4d5ba9f08651fc60d1",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/a830323f413e804372b4cb4d5ba9f08651fc60d1",
      "created_at": "2025-12-27T15:31:49Z"
    },
    {
      "event": "labeled",
      "id": 21766047154,
      "node_id": "LE_lADOABII587gZmTvzwAAAAURW4Wy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21766047154",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T15:32:19Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3694045997,
      "node_id": "IC_kwDOABII587cLqst",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694045997",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T15:32:27Z",
      "updated_at": "2025-12-27T15:32:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS-cross to arm64`: https://github.com/bitcoin/bitcoin/actions/runs/20540187798/job/59003472023</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation error in fuzz tests: undefined type ConnectionCB and invalid TorControlConnection initialization (nullptr) in torcontrol.cpp.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694045997",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3694047661,
      "node_id": "IC_kwDOABII587cLrGt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694047661",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T15:35:22Z",
      "updated_at": "2025-12-28T14:08:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "> where are you using LineReader?\r\n\r\nHeh, I did quite a bit of moving around after I got things working and seems like I picked from the branch where i didn't use it instead of the one where I did at the end. Pushed the right code for it now, using it in `ProcessBuffer`.\r\n\r\nWill work on fixing the fuzz test which I completely missed ðŸ™ƒ That's what's failing the CI.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694047661",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3694074809,
      "node_id": "IC_kwDOABII587cLxu5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694074809",
      "actor": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-27T16:24:13Z",
      "updated_at": "2025-12-27T16:24:13Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694074809",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21770050854,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAURmJ0m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21770050854",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/872feec3eb26727385af2f17dd9d32bd03bf9225",
      "created_at": "2025-12-28T14:08:00Z"
    },
    {
      "event": "unlabeled",
      "id": 21770335146,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAURnPOq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21770335146",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T15:24:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3694830686,
      "node_id": "IC_kwDOABII587cOqRe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3694830686",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T15:33:23Z",
      "updated_at": "2025-12-31T18:33:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nThere's some uncovered new code in the coverage report, https://corecheck.dev/bitcoin/bitcoin/pulls/34158\r\nAnd some Sonarcloud warnings to check out.\r\n\r\n\r\n",
      "user": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694830686",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "reviewed",
      "id": 3614742906,
      "node_id": "PRR_kwDOABII587XdJl6",
      "url": null,
      "actor": null,
      "commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-28T16:19:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK 8d6f1b02f5868d918bb72059eac3afb881ccafe3\r\n\r\nPR removes LibEvent usages from TorControl and cleans/modernizes the code a bit where touched.\r\n\r\ncode review, build and test. I do not have sufficient exp. to say something about the fuzz improvement commit. Small NIT found while doing the code review.",
      "user": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3614742906",
      "submitted_at": "2025-12-28T16:19:55Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21771696849,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAURsbrR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771696849",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "67f9f1423678fae4ed2c4c0b806c5ef1da5f6dd7",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/67f9f1423678fae4ed2c4c0b806c5ef1da5f6dd7",
      "created_at": "2025-12-28T21:57:41Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21771710084,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAURse6E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771710084",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "496664894a5032240adb117376747cb1f4972527",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/496664894a5032240adb117376747cb1f4972527",
      "created_at": "2025-12-28T22:01:15Z"
    },
    {
      "event": "labeled",
      "id": 21771713530,
      "node_id": "LE_lADOABII587gZmTvzwAAAAURsfv6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771713530",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T22:02:06Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3695083890,
      "node_id": "IC_kwDOABII587cPoFy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3695083890",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T22:02:16Z",
      "updated_at": "2025-12-28T22:02:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/20560088214/job/59049502835</sub>\n<sub>LLM reason (âœ¨ experimental): Python linting failed: an f-string had no placeholders (ruff warning F541) in test/functional/feature_torcontrol.py.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3695083890",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3695092837,
      "node_id": "IC_kwDOABII587cPqRl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3695092837",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T22:16:13Z",
      "updated_at": "2025-12-28T22:16:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "Addressed feedback.\r\n\r\n> There's some uncovered new code in the coverage report, https://corecheck.dev/bitcoin/bitcoin/pulls/34158\r\n\r\nThe old code was largely uncovered as well but I have looked into it and added a simple functional test that provides some basic end-to-end coverage. I thought about unit tests too but I am not sure they provide much value aside from the functional and fuzz tests. But happy to be convinced otherwise if there are ideas for what they should cover.\r\n\r\n> And some Sonarcloud warnings to check out.\r\n\r\nI don't know what that is and the screenshot doesn't allow me to see which lines are meant by the comment. Happy to look into them if you can transfer the comments matching to the correct lines here somehow.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3695092837",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "commented",
      "id": 3695125830,
      "node_id": "IC_kwDOABII587cPyVG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3695125830",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T23:14:40Z",
      "updated_at": "2025-12-31T18:32:55Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I don't know what that is and the screenshot doesn't allow me to see which lines are meant by the comment. Happy to look into them if you can transfer the comments matching to the correct lines here somehow.\r\n\r\nYou can see the warnings on https://corecheck.dev/bitcoin/bitcoin/pulls/34158 scroll down the page, above benchmarks, below uncovered included code\r\n\r\n\r\n",
      "user": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3695125830",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "unlabeled",
      "id": 21771959623,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAURtb1H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21771959623",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-28T23:17:55Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21811026054,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUUCdiG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21811026054",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "122ff0a23b1105db187418c5f909ba0ac89e0c21",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/122ff0a23b1105db187418c5f909ba0ac89e0c21",
      "created_at": "2025-12-31T17:05:56Z"
    },
    {
      "event": "commented",
      "id": 3702527710,
      "node_id": "IC_kwDOABII587csBbe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3702527710",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-31T17:06:21Z",
      "updated_at": "2025-12-31T17:06:21Z",
      "author_association": "CONTRIBUTOR",
      "body": "> You can see the warnings on https://corecheck.dev/bitcoin/bitcoin/pulls/34158 scroll down the page, above benchmarks, below uncovered included code\r\n\r\nTIL, thanks. I addressed the ones that made sense to me.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3702527710",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "labeled",
      "id": 21811764158,
      "node_id": "LE_lADOABII587gZmTvzwAAAAUUFRu-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21811764158",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-31T18:18:35Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3702650819,
      "node_id": "IC_kwDOABII587csffD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3702650819",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-31T18:18:42Z",
      "updated_at": "2025-12-31T18:18:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS-cross to arm64`: https://github.com/bitcoin/bitcoin/actions/runs/20623563561/job/59230100443</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed due to use of std::jthread not available in the target standard library (missing C++20 jthread support).</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3702650819",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21813459493,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUULvol",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21813459493",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/3de90a1159e606585aad32c876b6769d29f46ac1",
      "created_at": "2025-12-31T21:04:42Z"
    },
    {
      "event": "unlabeled",
      "id": 21814079947,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAUUOHHL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21814079947",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-31T22:20:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3661580911,
      "node_id": "PRR_kwDOABII587aP0pv",
      "url": null,
      "actor": null,
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-16T15:08:23Z",
      "author_association": "MEMBER",
      "body": "ACK 3de90a1159e606585aad32c876b6769d29f46ac1\r\n\r\nReviewed each commit, built and ran tests on arm64/macos.\r\n\r\nRan on mainnet with `-onlynet=onion` and observed tor connections in and out. Monitored bitcoind logs with `-debug=tor` and tor daemon logs for errors.\r\n\r\nI also used wireshark to capture torcontrol packets on port 9051 to compare this branch against release 30.2 and observed identical behavior ðŸ‘ \r\n\r\nChecked the exponential retry backoff by killing the tor daemon process while bitcoind was running. Restarted tor after a few minutes and bitcoind continued as expected.\r\n\r\nThis is a very nice simplification of torcontrol and also demonstrates how we can replace libevent in `bitcoin-cli` as well ;-).\r\n\r\n\r\n<details><summary>Show Signature</summary>\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nACK 3de90a1159e606585aad32c876b6769d29f46ac1\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIzBAEBCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAmlpS64ACgkQ5+KYS2KJ\r\nyTrIVhAAg03Hk1Hu/lEhqpcr1M1aTaxsyNUha2MOtj8L9JMkxYaylX2LlHDzDACq\r\ng23L43GAECJtaMfSWH500Id9JqtWiNhn2tUhXLi9UEVDsbFsVf0usxDyF3kx2fec\r\nCalOFldTrIV8gFOhmS650lyxt0HfyePQ8yTZBH9jeXLrWoyjOU77cjYGzPC3/wUW\r\ngsVqLFFY5FOVzB789abu0ufsv3J6LrwAqwwxhsJpJ7IKhfrR0orX5IOMD4r0JMD6\r\n7lkU+4es68yyHUHnlZxnlhzZMMjaqxgA9/dglNivdP3glUqiEQ+dGVFtjZ0bepff\r\ngHjtm90wbFn59b+kPsTsiFVrYcBe6VBASljjx9QVxgPF8YW3rY64BIXjtOTNIduV\r\nenaiZgLDqkj8hq6mNSSjcbsnk2uDh+dHUTYNLnOaTjzilRXqiwf1SxFqnSnxDQ6f\r\nBESyS36JvznTXCctkaqMQ5KTFcjAOigLx+sPgaWrM0P0iioSvWaAXK1HICfWCCIZ\r\nRG1LS4b4fIIgdIhDjBgL+Mnfz7SoR3U0vvF1XUr6sN5wJVIpDhkzSOB5I9cIMS13\r\nNdbZ9idWLT4JW5sjXg3KZgVV6qADN3fVRvA0xww5B6halGD04qmO+R35nAifkm9h\r\nCYBuURa2xrSWsVTApWwQAM8O901vZicDq09jJqOflkgHzx6soRQ=\r\n=0WeV\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\npinheadmz's public key is [on openpgp.org](https://keys.openpgp.org/vks/v1/by-fingerprint/E61773CD6E01040E2F1BD78CE7E2984B6289C93A)\r\n</details>\r\n\r\n\r\n```\r\nBitcoin Core client v30.99.0-3de90a1159e6 - server 70016/Satoshi:30.99.0/ - services wl2\r\n\r\n<->   type   net   serv  v  mping   ping send recv  txn  blk  hb addrp addrl  age id address                                                             version\r\n in        onion    wl2  2   1325   1325   46   46                   1          0  2 127.0.0.1:59473                                                     70016/Satoshi:30.0.0/\r\nout   full onion  nwcl2  2    931    931    4    0         0      1000          1  0 wffaznxih3nah5tbjpiifbn5v3fzmr5tqzcinacr3cjtnags45owvaqd.onion:8333 70016/Satoshi:30.0.0/\r\nout   full onion  nbwl2  2    934    934    4    0         0      1001          0  1 uathi7edrzgqsby7dikuqe7ehwpwjem2cy4mpsbahrsrtchjdymufxyd.onion:8333 70016/Satoshi:29.0.0/\r\nout   full onion    nwl  1   2810   2810   11    0                1000          0  3 t423yolpdj5udh2yyemopmjtenmmwtfx3rxcdtneda5g2rw6isnjo7id.onion:8333 70016/Satoshi:25.0.0/\r\n                               ms     ms  sec  sec  min  min                  min\r\n\r\n        onion   total   block\r\nin          1       1\r\nout         3       3       0\r\ntotal       4       4\r\n\r\nLocal addresses\r\nzai7kzajktbkqom3edw45zyxnn6e5z5t45d2m7dhmhilgpkz2l3frmad.onion     port   8333    score      4\r\n```\r\n",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3661580911",
      "submitted_at": "2026-01-15T20:24:14Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "review_requested",
      "id": 22078990383,
      "node_id": "RRE_lADOABII587gZmTvzwAAAAUkAqgv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22078990383",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T20:24:19Z",
      "requested_reviewer": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 22078990857,
      "node_id": "RRE_lADOABII587gZmTvzwAAAAUkAqoJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22078990857",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T20:24:20Z",
      "requested_reviewer": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 22078991359,
      "node_id": "RRE_lADOABII587gZmTvzwAAAAUkAqv_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22078991359",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-15T20:24:22Z",
      "requested_reviewer": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22114500481,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUmIH-B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22114500481",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "d3ce6442238a38378c4ff242c68bccfe500aab1f",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/d3ce6442238a38378c4ff242c68bccfe500aab1f",
      "created_at": "2026-01-17T14:25:28Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22114609479,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUmIilH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22114609479",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "280898134f962c9e24d8025d4d58396b7293f6cb",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/280898134f962c9e24d8025d4d58396b7293f6cb",
      "created_at": "2026-01-17T14:36:01Z"
    },
    {
      "event": "labeled",
      "id": 22114615631,
      "node_id": "LE_lADOABII587gZmTvzwAAAAUmIkFP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22114615631",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-17T14:36:42Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3673130608,
      "node_id": "PRR_kwDOABII587a74Zw",
      "url": null,
      "actor": null,
      "commit_id": "d3ce6442238a38378c4ff242c68bccfe500aab1f",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-17T14:50:51Z",
      "author_association": "CONTRIBUTOR",
      "body": "Addressed feedback from @pinheadmz , thanks for the review!\r\n\r\nEDIT: And also, I had actually lost sight of bitcoin-cli, I will look at that next to see what, if any, could be reusable from here to apply there.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3673130608",
      "submitted_at": "2026-01-17T14:40:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "unsubscribed",
      "id": 22115010098,
      "node_id": "UE_lADOABII587gZmTvzwAAAAUmKEYy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22115010098",
      "actor": {
        "login": "waketraindev",
        "id": 175499942,
        "node_id": "U_kgDOCnXqpg",
        "avatar_url": "https://avatars.githubusercontent.com/u/175499942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/waketraindev",
        "html_url": "https://github.com/waketraindev",
        "followers_url": "https://api.github.com/users/waketraindev/followers",
        "following_url": "https://api.github.com/users/waketraindev/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/waketraindev/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/waketraindev/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/waketraindev/subscriptions",
        "organizations_url": "https://api.github.com/users/waketraindev/orgs",
        "repos_url": "https://api.github.com/users/waketraindev/repos",
        "events_url": "https://api.github.com/users/waketraindev/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/waketraindev/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-17T15:14:22Z"
    },
    {
      "event": "unlabeled",
      "id": 22115358154,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAUmLZXK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22115358154",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-17T15:53:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 22193217113,
      "node_id": "LE_lADOABII587gZmTvzwAAAAUq0Z5Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22193217113",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-21T16:38:56Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22193861909,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUq23UV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22193861909",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0e86458ddc45799b2fa6c057634b9ecdd6da781b",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/0e86458ddc45799b2fa6c057634b9ecdd6da781b",
      "created_at": "2026-01-21T17:02:38Z"
    },
    {
      "event": "commented",
      "id": 3779720814,
      "node_id": "IC_kwDOABII587hSfZu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3779720814",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-21T17:02:52Z",
      "updated_at": "2026-01-21T17:02:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/34353",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3779720814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "labeled",
      "id": 22196826196,
      "node_id": "LE_lADOABII587gZmTvzwAAAAUrCLBU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22196826196",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-21T19:03:09Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 22196909457,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAUrCfWR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22196909457",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-21T19:07:25Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3781445377,
      "node_id": "IC_kwDOABII587hZEcB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3781445377",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-21T22:30:20Z",
      "updated_at": "2026-01-23T21:19:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "CI failure seems unrelated but I am waiting for https://github.com/bitcoin/bitcoin/pull/34242 anyway, hoping that makes it in soon.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3781445377",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "referenced",
      "id": 22241518089,
      "node_id": "REFE_lADOABII587gZmTvzwAAAAUtsqIJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22241518089",
      "actor": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0871e104a26d0e0a9da3c01d96c44ea50937806b",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0871e104a26d0e0a9da3c01d96c44ea50937806b",
      "created_at": "2026-01-23T12:25:49Z"
    },
    {
      "event": "labeled",
      "id": 22242973913,
      "node_id": "LE_lADOABII587gZmTvzwAAAAUtyNjZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22242973913",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-23T13:37:59Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22253062897,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUuYsrx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22253062897",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "created_at": "2026-01-23T21:17:56Z"
    },
    {
      "event": "commented",
      "id": 3792499175,
      "node_id": "IC_kwDOABII587iDPHn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3792499175",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-23T21:19:35Z",
      "updated_at": "2026-01-23T21:19:35Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased since https://github.com/bitcoin/bitcoin/pull/34242 was merged.",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3792499175",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34158"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22253159707,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAUuZEUb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22253159707",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "created_at": "2026-01-23T21:23:13Z"
    },
    {
      "event": "unlabeled",
      "id": 22254474720,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAUueFXg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22254474720",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-23T22:42:52Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3711715882,
      "node_id": "PRR_kwDOABII587dPEoq",
      "url": null,
      "actor": null,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-27T15:59:45Z",
      "author_association": "MEMBER",
      "body": "re-ACK 1545c062a5973d7ec1aaf77d6224c5ad8a1686b2\r\n\r\nChanges since last review are rebasing on master to include `LineReader` (#34242 ), as well as switching `std::bind` to `std::bind_front` (#34353) and addressing nits from review.\r\n\r\nI dug a bit deeper into the socket code this time around as well and left some questions. Tested successfully again on mainnet and tried various edge cases like stopping and restarting the tor daemon while Bitcoin is running and switching the torcontrol port.\r\n\r\nThis can be added in a follow-up PR but once torcontrol is rid of libevent, we can also add the option to connect via UNIX sockets, like #27375\r\n\r\n\r\n\r\n\r\n\r\n<details><summary>Show Signature</summary>\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nACK 1545c062a5973d7ec1aaf77d6224c5ad8a1686b2\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIzBAEBCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAml43+sACgkQ5+KYS2KJ\r\nyTpOvQ/6A+msBLJZ307NW7aUWuAKMptOPPd0MlPWMtRIgZOEoepMlI4pwHW4mXMn\r\nyP6c4ixGhrbt7iwdLVQA/+bU06x+CUC5GZMgImJu6IdsrSBxlUCz/aCOphEGixom\r\nbsfF7EeULgX7ZOTgt4OMhgYX3riD5SmKbyAt18KjPqBcPAUkGTu1JprmB6O44yuX\r\nrp6jcrhfQ7RP6yY1n+9Pje6Oy9/x0oQCU476bosMpJLguyod68aI3oaDB70fO4j7\r\nrPI3HHhzQzkQ0vQ3KifgZwZje+OCKlm8JxJVMRDIwISWwZW0V3M3ouYK+xgffiTG\r\nBzcYyEXb13VDQlzWMGaqNE7hmTTa5rOqWUrZXv03QtluHcBXzaa50rHOj2eM491F\r\nmL2v6wV8lAepsWOowURvs1AsIcL6t3yjb3gmRh9wR4Ny3S+rzxo3TJEc0usS6vYy\r\nRSVtlz2RDWFf52PbchkfSIJ2c1dg4r5QlWi2lJaITebWh0IF2l+wMHFqBkf/jWmP\r\nX7q3ZV+RESiVVxHrmoTiDzEgIW09YxKftXeGNs7IHIbKQg7X4x3gZgsk5pGbvqsv\r\nqX7NxVLWPvzPThRvx/ckPHnZV2/Ee/RhjgIvKLtg30SphUfqjwr+dilF1QxyhUZc\r\noLYKNkARab3U+6s8PIk4YPsr/4zsU/fn+COllKejImnlHuh2GgI=\r\n=kxiy\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\npinheadmz's public key is [on openpgp.org](https://keys.openpgp.org/vks/v1/by-fingerprint/E61773CD6E01040E2F1BD78CE7E2984B6289C93A)\r\n</details>\r\n",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3711715882",
      "submitted_at": "2026-01-27T15:59:45Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBmYTk0MTZlMTY3Zjk0ZTAyMmFkMjg0OTQ4NjJmOTEzNWYyNzYzYWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0fa9416e167f94e022ad28494862f9135f2763af",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0fa9416e167f94e022ad28494862f9135f2763af",
      "tree": {
        "sha": "f9025635c7645fe8d6a6ab862a1baef9bd169837",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f9025635c7645fe8d6a6ab862a1baef9bd169837"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f9025635c7645fe8d6a6ab862a1baef9bd169837\nparent f7e0c3d3d370a4e5b4060fefcb9e8d83e2533bbc\nauthor Fabian Jahr <fjahr@protonmail.com> 1766795562 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779289 +0100\n\nrefactor: Use constexpr in torcontrol where possible\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sFkVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNyNIQAJDJCscod2RLxPo/y4xxFbS+vjgv\nJOlleBtzKsmcenJUzc2le9u8px97tjlDNBoeJ4jtXF9B+z2kNwxa3glgkixVRG/A\nJW+1UtRo2XxckMHLfM9XtyTJMhkvHuZgTWTlRJTHQQ/BXiUstGZVYgZ70egcDSqC\n3tGpR2NYBCFIIN0rjWQ2GmvpW3RX26K4YZbuJpAWWDoan6ksLUMRKfEY1kW2qzal\nRwM54OR455AREqrFyixkT5hg9PyPvqW+FOI2mKjfiSqjq4K4VaZ0kLNpUDmDW48H\nt97L50WZEAmcuXWgM8iEdW4zEcypOx0tby97Yp5tVUSbLR9KkKwphhmSD1VbKIal\nzyiSROYCsQld5jWSo5nzKH/7D39AUn/q91T7Dpb3ybcx7r5kuEY6/rOEHy3IQ9D8\nAHjjQXYtmMLPoxqicibrdvpvK7FYelJtioIZcN0j21JvLcSXdgA5eg9pH8AzElXL\nNqdJXHJVube4oA6dx4SxWfqBdrmsGcpPiIuah6kTm4SkYlOugTF/zlkId4+DPf++\n4wjgIL8+AI87tlDicRES16//rGStJk2HwsDZTvv8dHZyV/GDRKAQJxU958QOOZ35\nGGDA/IlLuFjvCUOWtr97xsGEa6lg5IX6Hu7nHAKIUWT2HCI1FSdhZRqGgKo3cZiZ\nljeY5BzIQ3bFfuma\n=e3fz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f7e0c3d3d370a4e5b4060fefcb9e8d83e2533bbc",
          "sha": "f7e0c3d3d370a4e5b4060fefcb9e8d83e2533bbc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f7e0c3d3d370a4e5b4060fefcb9e8d83e2533bbc"
        }
      ],
      "message": "refactor: Use constexpr in torcontrol where possible",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:29Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-27T00:32:42Z"
      },
      "sha": "0fa9416e167f94e022ad28494862f9135f2763af"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdhM2RkZjBlY2NkNjc5NjJhMTEyZjBiOTA4M2ExYjJiOGU4MTcyODk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a3ddf0eccd67962a112f0b9083a1b2b8e817289",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7a3ddf0eccd67962a112f0b9083a1b2b8e817289",
      "tree": {
        "sha": "e397a3b391d55db3499ac8db404e984a1e2fc8b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e397a3b391d55db3499ac8db404e984a1e2fc8b9"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree e397a3b391d55db3499ac8db404e984a1e2fc8b9\nparent 0fa9416e167f94e022ad28494862f9135f2763af\nauthor Fabian Jahr <fjahr@protonmail.com> 1766796365 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779289 +0100\n\nrefactor: Modernize member variable names in torcontrol\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sFkVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNCXYP/32hC//Fqei4nLbFaM0Q8Ch6IrJ9\noc7t0cvNUWP01WrgItCVdNVij6PKX7++QaRPflqCim5p/tFGAV9Mw+a57+a4W7J6\nLylYn5l3VrRGNPeNZ5sDAEBIPNkTsjNSIX+OcSIz9qIV6G2PQv1peLnDZyXq9Z1t\n1eFAQWLBzdKtoXST3uD3tZHZg7OzJ1zzr3nADmKhm/ox06jlYPpchrf8Tbtdmu9H\nqw5qOu4sDebGaeKRv6XYZ3bKNdoGkf7VpWGZP9UJx3ULZwYE9gFgt0wKlf0+cJXu\nJO3oq9CcM6hCBpdeqxXxBG3QL2cE866JrPBd6O0Y0qSn+l9colmjuLUo/4uNZhSV\nPJyuSQWUzCsb+bhINe1vESCasGohezXpNAvpHgqZs1dMtifa4SdvfRf72WyhpNxT\nep2kFuwOQNpV9k8SCsf7UuqjaX9OHPkVycbHVygiloZdnG2plhUQX0HIaFHwN7+N\nfC2mimGQrP4jQNWyfSH17HKa8C7L9z9i9/3kfxrUeRAv1Fo3Btz7+fVI0+ark/tk\nxBa8xpVf3J2I4MbrJMpe28xm3wscNUlDcHlGV9VJkqTLuEpO+vOTjXPP7eS4rGEd\n8Oz/c6KMsnWgR8LyD+VpAzZrLsMFEs7xZysv+le/j5MhqLzP3zMQpt9WCNKJp9Zy\nohSNCiVFpQnfk1PQ\n=wMqb\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0fa9416e167f94e022ad28494862f9135f2763af",
          "sha": "0fa9416e167f94e022ad28494862f9135f2763af",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0fa9416e167f94e022ad28494862f9135f2763af"
        }
      ],
      "message": "refactor: Modernize member variable names in torcontrol",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:29Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-27T00:46:05Z"
      },
      "sha": "7a3ddf0eccd67962a112f0b9083a1b2b8e817289"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUyYmMyZDQ5MzJiZjcwZjg5YzAzYzYxNzM3OGM3ZWRlZTZjZTIzMDU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e2bc2d4932bf70f89c03c617378c7edee6ce2305",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e2bc2d4932bf70f89c03c617378c7edee6ce2305",
      "tree": {
        "sha": "55bab1e13d6c2dca1fd8eb8b62de9f0825a6fc21",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/55bab1e13d6c2dca1fd8eb8b62de9f0825a6fc21"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 55bab1e13d6c2dca1fd8eb8b62de9f0825a6fc21\nparent 7a3ddf0eccd67962a112f0b9083a1b2b8e817289\nauthor Fabian Jahr <fjahr@protonmail.com> 1766844804 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779289 +0100\n\nrefactor: Get rid of unnecessary newlines in logs\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sFkVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNdsIP/1gK/M+0mmu3ta/oaT9vVP7Nqshw\n5NARECurolUgcafiN9NwlBqYsvt9Tl6De2e7er4vAP2ff6lEPUzpxcTCrE6fGrpb\n9cNG5Tsj5XfjeL/MpxaENNN3r7D/iIij9b85gvnPMLA/61XeSmdVSVITHjF/Uu6g\nybbpaZas0wwGt9RHe7zSHu5oGipjEB7u8yZYwnKhkZi4/IdYX3W/tICwmEMZWpJI\ncUvMkPBKJ4q905jvu9IWKX6O5rGJE/3PHlfmUHLo9qaU0CX8hl5Rf8Gi3yhhjJT9\nkFEARPNN5LXgFHZl6KsJSJVgwJ2ItnEeEgiAh9HBy9yrbjGKB93VPLdyTYuzW6ng\ngPSkEF2A1dWxQ/zJb6N9CGgR4Kq4lf5mpnDpczTI/L4TIS7m9OdzuQjkKY3SkeAf\nrV+2aKOLSLwXUT10KOqGD11MZh9XoXHysODSwpAKikj24ndsW/OjUfSjLCF7DmRB\nj0JuG5UxkI6Lw3mWTzuy3F6VhmtMq4imuxAHlVjuYxVHIVO7ZnxZ6syI2vFfHu9J\nni+i1QZ4fo0MiefAVtgBiOrq3EpHgNHAbrhTYrI0L9EB72RRuVOcaYl3YNSaGJbP\nL3dJqW8H4Bmd57wnYFKJdeGSDACpS2l1ZbudB5HaUSYIxG9s1LyYqeX04PzozXiA\n0/IVkJifumTLTsuK\n=cwLn\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7a3ddf0eccd67962a112f0b9083a1b2b8e817289",
          "sha": "7a3ddf0eccd67962a112f0b9083a1b2b8e817289",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7a3ddf0eccd67962a112f0b9083a1b2b8e817289"
        }
      ],
      "message": "refactor: Get rid of unnecessary newlines in logs",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:29Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-27T14:13:24Z"
      },
      "sha": "e2bc2d4932bf70f89c03c617378c7edee6ce2305"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE4N2UzN2YzNzc2MDIzNDJhODhmNzJkM2Q5NzM3OTFjOTc0Zjc1OTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a87e37f377602342a88f72d3d973791c974f7596",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a87e37f377602342a88f72d3d973791c974f7596",
      "tree": {
        "sha": "cc33fb9075fe3fec6f28274139436c2cde9d1e83",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc33fb9075fe3fec6f28274139436c2cde9d1e83"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cc33fb9075fe3fec6f28274139436c2cde9d1e83\nparent e2bc2d4932bf70f89c03c617378c7edee6ce2305\nauthor Fabian Jahr <fjahr@protonmail.com> 1766795344 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779289 +0100\n\ntorcontrol: Remove libevent usage\n\nReplace libevent-based approach with using the Sock class and CThreadInterrupt.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sF0VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNCaAQAIlV9nOzF9SfJYtu+zsOMPpyilo2\n8Lozd36EYs5Loya2dvLGGMkgb30Cbsi9SVeqmRyBBWbqb8aix05xJk3V8m0QHhRQ\nSk758ObHvblSgvj7lOJDr2wl1Li5AVP66GwrUmNkRWy+dAs1/XJN7STYS31eLcV2\nfogCzbjdUSdFCj2bGKcuZ+mH+7O/gWTydoEjQS1sTKnCTOG2JOOAjQyt7WbSlXWx\nuChqGY3A8hdCJACTDn3p7miLg/tgVf+G7nt0WfONfofd7nc68k/s7LcfGvsRt50P\nciB4Ddz6Whj7WcyJcOWihhmGWJ6Aax7othUhbvWLnR6fVSrJaqhUqFbs8s20Twjj\ncRwQpjqfcUMs83m8x+tZJu8GcGgpQOoT1s3z4U1YX1jiVIzLzfu6/AJmNHV8Rwq9\nDtEl7p2rCGN1lJUaALgmr2Us3lZC3PCCnmMccK6phP+APl+xrc1/dPOyN3xyPtii\n9YXk7d/0SBvhxlj2XW8JKtIhP30DqdZXHLaMkNACHWxzPwJ+Kz1i4WeIw41zIcmX\nIVseFjkwbtJ/JQ0EXqKYRncTRO17Ad8m721yhi6ryAdx3tjayKxJIY0AG+AnUyJ6\n8F15smeGAHH50yexU5bE0LfShatdNGb52Hiqvp8dO6SlLxWaeIOsqhWBhF6eL55D\nYofzkwL7EHKglK18\n=dDhZ\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e2bc2d4932bf70f89c03c617378c7edee6ce2305",
          "sha": "e2bc2d4932bf70f89c03c617378c7edee6ce2305",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e2bc2d4932bf70f89c03c617378c7edee6ce2305"
        }
      ],
      "message": "torcontrol: Remove libevent usage\n\nReplace libevent-based approach with using the Sock class and CThreadInterrupt.",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:29Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-27T00:29:04Z"
      },
      "sha": "a87e37f377602342a88f72d3d973791c974f7596"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM4OWU5NWZjNDNjNWQwMDJlOTM3ZmNiODZmMzgyMGEzNjJmZGRmODU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/389e95fc43c5d002e937fcb86f3820a362fddf85",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/389e95fc43c5d002e937fcb86f3820a362fddf85",
      "tree": {
        "sha": "3101ce39b82a70cc8ab48e9736cf75ef48083f7b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3101ce39b82a70cc8ab48e9736cf75ef48083f7b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3101ce39b82a70cc8ab48e9736cf75ef48083f7b\nparent a87e37f377602342a88f72d3d973791c974f7596\nauthor Fabian Jahr <fjahr@protonmail.com> 1766930871 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779293 +0100\n\nfuzz: Improve torcontrol fuzz test\n\nGets rid of the Dummy class and adds coverage of get_socks_cb.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sF0VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNXGoQAIaBaMQHAo3yk7f0CNVPHwx4Lhid\nBzFLRqJBhS4yZFLMXBPpivUDxpvv+91SjO/zE5EjfkK9ToUolUlLxIya4ttI8Bpj\nmCLrP0VuClw/RDy/U9xgQWYc9bGaGMajbDqJD6nV3v3uW7QvlvES1ATROaPtEGba\n+YKndQRBqBlaDwAUV95JRASyDpogoeDarGS83c6HmCMQXqbxo+yD+qr6I6lEVTlT\nGTGPF1K2wO8jjpD6DuQs8cRY/O13HIYXqY4V+4VxRTaCF0ghXX46j2pH5sdilHHT\nkbS7m6wc6BXj929evc5YYVJBs4VnHz+VKaGj2PUXRKVP3woBKToCRWiGxY8h0+c+\nk2yLJKrMfZeTT2/hg3k16jmtIVa4Pt7SeV1ly4/A28cNltOTyd7xXvy9N7fFXIvl\nGz0uDyRs7rNMGv4J0spQ22Fu1tGHcUVHmmYoqpGkL/Pvb3EoxFFX5KKMh0dMuUPa\niQN0CaZRwgBpUMPZKi8oxXlaKkbjGzOSY4uSj8VH2vkYrRsmxBfpZDJrqhSMAZ94\n0OXiXBucCwdPouQsh8YZR8ZABhXUCB5vvPTb4rrfBgZ5P0H4WtGebCK0kKl804vG\n1uk4gVPcUk9ST02KEPwfsg3I52xNzdisJlCwtvstUNIUJrQo48i9NgZZoO79sRgY\n8ZTE0Fp3lB4inc+4\n=+Dxz\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a87e37f377602342a88f72d3d973791c974f7596",
          "sha": "a87e37f377602342a88f72d3d973791c974f7596",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a87e37f377602342a88f72d3d973791c974f7596"
        }
      ],
      "message": "fuzz: Improve torcontrol fuzz test\n\nGets rid of the Dummy class and adds coverage of get_socks_cb.",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:33Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-28T14:07:51Z"
      },
      "sha": "389e95fc43c5d002e937fcb86f3820a362fddf85"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIzN2UxMDMzNzQ4YjBmN2Q1Mjc1NTIwZmI3MzQwZGYwM2Q2ZTNlZGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b37e1033748b0f7d5275520fb7340df03d6e3edf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b37e1033748b0f7d5275520fb7340df03d6e3edf",
      "tree": {
        "sha": "bf4a4aaa9fff653cd5e9750437cb97a1d1464451",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/bf4a4aaa9fff653cd5e9750437cb97a1d1464451"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree bf4a4aaa9fff653cd5e9750437cb97a1d1464451\nparent 389e95fc43c5d002e937fcb86f3820a362fddf85\nauthor Fabian Jahr <fjahr@protonmail.com> 1766958986 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779293 +0100\n\ntest: Add simple functional test for torcontrol\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sF0VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNniwQAILBmPndHAGeDGoCyPTw5C4sfXTv\nixM3c0QVKI6RRThbGq9RbLU6ehViL6GPKbAf/AHVJpFsJKzwVkIGzOYxqA0f+ldo\n+mozk/zwoDXuRnOppkiUBnVX8E+QUm46atj0A+JYpBANCQTXpA4rmg/WYmameVay\nHbWtbUYcPx0N+2DckAOese2pZyBI6Zr5PEm/kRuWYzQUp0Lw3J11ohOHb8wjmghc\nPKo580qS7g8oxekuKg3o+FhAAIRaT/ms1YZQ5laL94nJh3Cv/c/9UQrSXrlPIqGQ\nq8W7YbBzDaXc8tM71tFsplFchmood9o8t3eJ1j7FHxd6iqqzPW2QUEhlIZOj/klb\nREE1CncI8ysv+CaUbNrDv0ccb48WULg/wcOXMiVzKK+lR0jZLsywpyCiH0EPUbto\nALi/j/Rnxwp7Xzcq8ZxTZS/GZaDQnUEo+gZ8KL/I0OQgHkpipWHIZtNilx39Rspb\nYOwogmUJiPJ7v1a3GXGp/NnO49FPzzlk2UU1X2qpgg7Tn6icfa3MSG9sLT/uqNIG\ndsri702I3kqC1BQ+EK1b6v+hSapj1NZw2OvvZ8wvIA+syNliyOymu5uxuAxReGtA\nGNYBKjWaw0ijSpjRKL29hbZxm0vrJAAOIfPUcan2S+oHJS5bjSReOEstK26oOfRD\nGuNWzIamILGn9wzC\n=ixG5\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/389e95fc43c5d002e937fcb86f3820a362fddf85",
          "sha": "389e95fc43c5d002e937fcb86f3820a362fddf85",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/389e95fc43c5d002e937fcb86f3820a362fddf85"
        }
      ],
      "message": "test: Add simple functional test for torcontrol",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:33Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2025-12-28T21:56:26Z"
      },
      "sha": "b37e1033748b0f7d5275520fb7340df03d6e3edf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRkYzRmYWFmZDIxNTBhZWQwOGE1OTU2NjM4YTg3ODFlZGUyMzRlNGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ddc4faafd2150aed08a5956638a8781ede234e4e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ddc4faafd2150aed08a5956638a8781ede234e4e",
      "tree": {
        "sha": "42d3aee618d6bd0535d9b60c1fb455db71f4782e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/42d3aee618d6bd0535d9b60c1fb455db71f4782e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 42d3aee618d6bd0535d9b60c1fb455db71f4782e\nparent b37e1033748b0f7d5275520fb7340df03d6e3edf\nauthor Fabian Jahr <fjahr@protonmail.com> 1768659739 +0100\ncommitter Fabian Jahr <fjahr@protonmail.com> 1769779293 +0100\n\ntest: Add test for partial message handling in torcontrol\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAml8sF0VHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNvW8P/3aa2E6PffHX8dw+oj33G9u25r6N\nZAIXpqaxfU94LSxFZ4NTZoanwoCFFiw200aLpCSqKutAiAJZUrxwtOUZzwydF/ML\n2S0Ep5mztEroJB65rYWX/gY7IZ/GlBJGf0qJ9f82oZxIF2xrHTyAzJ6CKQ3fWZH5\n2tOuK7wVgk1uwDb68kSxyJOSMRkoQaAil/obGjC1FQ/Vv36+ul/WV3Dw9defVey9\nVz9FVN9G8bu2HhwOdREWtdjR6C7yXoJw3fwuNf3bMUH16Fhn6ay9zIGb6sEgoOhI\nL1PtIAXEBhHQpnLTJCYb1GP6xpcYAtE4eaTzXF+4hbhXsPTlrvUddKPlfIy5OFRK\nLg8ACzmoUMPDYseRSJY7oUxe24iDxttdxltLoQVRCvGrBsmz+mcBxnlolzYVJrW3\nop3+h45VulLAUGwXor8N+zv79Lx5dztY112DWIm4zrUzEtaVAfK8+hjJI0tTAzV1\ne9vJuRNxEHRC05f55VBZArCiTbRb2E8ROevIIyVMYolD49fnnTNxeM+hhM5/CrvJ\nJZq7E3ptHikVWAi57Go2PFkxqxGg2eMO2rTZWldhnsduj2QDZJ4K27Fsq5rIOf5/\nfXilKdA1uIDFl1jMbmjyHgUrfnaCHJ9kCBPhuGsM736tw3GzCCnzNhYk6Sznp/ym\nfqu3OSzV/pq6K4t9\n=XjC9\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b37e1033748b0f7d5275520fb7340df03d6e3edf",
          "sha": "b37e1033748b0f7d5275520fb7340df03d6e3edf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b37e1033748b0f7d5275520fb7340df03d6e3edf"
        }
      ],
      "message": "test: Add test for partial message handling in torcontrol",
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-30T13:21:33Z"
      },
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2026-01-17T14:22:19Z"
      },
      "sha": "ddc4faafd2150aed08a5956638a8781ede234e4e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22407522273,
      "node_id": "HRFPE_lADOABII587gZmTvzwAAAAU3l6fh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22407522273",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "commit_url": "https://api.github.com/repos/fjahr/bitcoin/commits/ddc4faafd2150aed08a5956638a8781ede234e4e",
      "created_at": "2026-01-30T13:29:38Z"
    },
    {
      "event": "unlabeled",
      "id": 22409336447,
      "node_id": "UNLE_lADOABII587gZmTvzwAAAAU3s1Z_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22409336447",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-30T14:37:44Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3764802405,
      "node_id": "PRR_kwDOABII587gZlNl",
      "url": null,
      "actor": null,
      "commit_id": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-06T19:34:19Z",
      "author_association": "MEMBER",
      "body": "re-ACK ddc4faafd2150aed08a5956638a8781ede234e4e\r\n\r\nChanges since last review were all addressing my review feedback, mostly just nits. Small change to `chrono::duration` for `m_reconnect_timeout` and a bigger change using `ConnectDirectly()` which is a very nice clean up.\r\n\r\nTested again on macos/arm64 on main net. The 1.5x backoff reconnection time worked as expected when tor was killed. Inbound and outbound tor connections worked as expected.\r\n\r\n\r\n<details><summary>Show Signature</summary>\r\n\r\n```\r\n-----BEGIN PGP SIGNED MESSAGE-----\r\nHash: SHA256\r\n\r\nACK ddc4faafd2150aed08a5956638a8781ede234e4e\r\n-----BEGIN PGP SIGNATURE-----\r\n\r\niQIzBAEBCAAdFiEE5hdzzW4BBA4vG9eM5+KYS2KJyToFAmmGPz4ACgkQ5+KYS2KJ\r\nyTqwdw//WxV6osT65TFiXT3UElMY8eLXK/j5koJNJw/ZgJLNEDjnq69vIhRcY9Yq\r\n5I8NqMtQRA4EU/7yLl55RWExjNwXgFIGlP/oVu5/VKmL5+10e8fjztAuCjA6WW8F\r\nLIDP/X4Ol3K+uFypcYEyDWRVz129sdLN4B4QC85+18sU7BfZ0nGWfv5FLivhMq2z\r\n454Z49kf/rV17vBZRXeVU62En0h2sW0vGqiNG00hcviarlKRF5WXN0DQtkmS0oHK\r\nkfMwoFYe6xtcd1g66YZCRuOWadk00wI/v5+nyitUZdq0b5mhj0GcsQ+t5GbNocOo\r\nQEQktK2w32joyeJIkmvCHL0+Fmv3uiAFPyHlbQkoRQWCWmQIRJYti3wiNVKXEZ18\r\nAKWgY5cNiYlNp2DqE5wDI9PV603p7yvcQxvI2J1bzlW2gyInhRIYbhuclZxY8LHC\r\niEZ88rrPtH1CN4Sh1xrZUbCpzt3mH9cOLMzKp7UJtgNWVtpKhe9gczUzl1uVKe6h\r\nFfsRZrZeBwr4G+8HNuQIcbzavG2b+vPIP6kQ3TjUTyMEf/1GpEU6MeumfuSNh0lO\r\nzZ0PSwC7li7V57gOytChrV7SNHESneM3j9BwAQFInF3GEk4K9AmQpZuik4z4nbnt\r\nIuUzz7hp5IX7COEcFfWUxZdEQwYKktiq3RuwrEXHsVAPaUm+HTE=\r\n=6wBj\r\n-----END PGP SIGNATURE-----\r\n```\r\n\r\npinheadmz's public key is [on openpgp.org](https://keys.openpgp.org/vks/v1/by-fingerprint/E61773CD6E01040E2F1BD78CE7E2984B6289C93A)\r\n</details>\r\n",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3764802405",
      "submitted_at": "2026-02-06T19:34:19Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "reviewed",
      "id": 3769780789,
      "node_id": "PRR_kwDOABII587gsko1",
      "url": null,
      "actor": null,
      "commit_id": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-08T21:30:34Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3769780789",
      "submitted_at": "2026-02-08T21:30:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
    },
    {
      "event": "review_requested",
      "id": 22627746166,
      "node_id": "RRE_lADOABII587gZmTvzwAAAAVEuAF2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22627746166",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-08T21:30:38Z",
      "requested_reviewer": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2649787904",
      "pull_request_review_id": 3614742906,
      "id": 2649787904,
      "node_id": "PRRC_kwDOABII586d8I4A",
      "diff_hunk": "@@ -166,41 +99,151 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    if (m_sock) {\n+        m_sock.reset();\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 188,
      "commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "original_commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "in_reply_to_id": null,
      "user": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n        m_sock.reset();\r\n```\r\n\r\nNIT: I think you can remove the redundant check.  calling `reset()` on  a `std::unique_ptr` is safe even if the pointer is already null ",
      "created_at": "2025-12-28T16:08:49Z",
      "updated_at": "2025-12-28T16:19:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2649787904",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2649787904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 135,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 137,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2649952768",
      "pull_request_review_id": 3614849785,
      "id": 2649952768,
      "node_id": "PRRC_kwDOABII586d8xIA",
      "diff_hunk": "@@ -166,41 +99,151 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    if (m_sock) {\n+        m_sock.reset();\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 188,
      "commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "original_commit_id": "872feec3eb26727385af2f17dd9d32bd03bf9225",
      "in_reply_to_id": 2649787904,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "done",
      "created_at": "2025-12-28T21:57:47Z",
      "updated_at": "2025-12-28T21:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2649952768",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2649952768"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 135,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 137,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2691120938",
      "pull_request_review_id": 3661580911,
      "id": 2691120938,
      "node_id": "PRRC_kwDOABII586gZz8q",
      "diff_hunk": "@@ -501,12 +501,12 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n  *                  CookieString | ClientNonce | ServerNonce)\n  *\n  */\n-static std::vector<uint8_t> ComputeResponse(const std::string &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &clientNonce, const std::vector<uint8_t> &serverNonce)\n+static std::vector<uint8_t> ComputeResponse(const std::string &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &client_nonce, const std::vector<uint8_t> &serverNonce)",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 123,
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "original_commit_id": "3a1f8c094798d09f41cd79c71c34afe2ea967394",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "3a1f8c094798d09f41cd79c71c34afe2ea967394\r\n\r\nwhy change `client_nonce` but not `serverNonce`? I'm guessing because there is a `m_client_nonce` at the call site,  but the member property isn't being explicitly handled here.",
      "created_at": "2026-01-14T16:16:26Z",
      "updated_at": "2026-01-15T20:24:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2691120938",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2691120938"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695723941",
      "pull_request_review_id": 3661580911,
      "id": 2695723941,
      "node_id": "PRRC_kwDOABII586grXul",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 223,
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "c675b6f059dea662d9faa90df261de7bfbca13a1\r\n\r\nWe won't ever get multiple lines in the receive buffer?",
      "created_at": "2026-01-15T19:45:20Z",
      "updated_at": "2026-01-15T20:24:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2695723941",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695723941"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695742143",
      "pull_request_review_id": 3661580911,
      "id": 2695742143,
      "node_id": "PRRC_kwDOABII586grcK_",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "c675b6f059dea662d9faa90df261de7bfbca13a1\r\n\r\nI'm still learning how torcontrol protocol works all together, but without complete context it seems to me that all this could be simplified:\r\n\r\n```cpp\r\nutil::LineReader reader(m_recv_buffer, MAX_LINE_LENGTH);\r\n```\r\n\r\nYou shouldn't have to find `'\\n'`, that's LineReader's job ...?\r\n\r\ntorcontrol unit and functional tests still pass like this.",
      "created_at": "2026-01-15T19:51:43Z",
      "updated_at": "2026-01-15T20:24:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2695742143",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2695742143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2700305547",
      "pull_request_review_id": 3673130608,
      "id": 2700305547,
      "node_id": "PRRC_kwDOABII586g82SL",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The idea here is that we may receive an incomplete line in the stream just because of packets arriving that way and if we would ask the `LineReader` for it we would receive it but couldn't do anything with it. That's why I am looking for the last `\\n` and then only process the buffer up until that point. But this is something that could be done by `LineReader`, too. So maybe there could be a bool param and then `LineReader` would only return the lines that end with `\\n` but I didn't really spend time making up my mind if that is so much better. It looks cleaner here but this functionality would only have one user, so I don't know... Either way I will wait until LineReader is merged and then I might try to add the functionality there if you think it's better that way.\r\n\r\nThere should be a test for this though, currently the tests all send the data nice and complete.",
      "created_at": "2026-01-16T23:17:24Z",
      "updated_at": "2026-01-17T14:40:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2700305547",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2700305547"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2701191739",
      "pull_request_review_id": 3673130608,
      "id": 2701191739,
      "node_id": "PRRC_kwDOABII586hAOo7",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 223,
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695723941,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Right, that's a good catch. If the processing is too slow this could fail unnecessarily and LineReader should catch this already fine, so I am removing this.",
      "created_at": "2026-01-17T14:37:03Z",
      "updated_at": "2026-01-17T14:40:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2701191739",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2701191739"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2701193079",
      "pull_request_review_id": 3673130608,
      "id": 2701193079,
      "node_id": "PRRC_kwDOABII586hAO93",
      "diff_hunk": "@@ -501,12 +501,12 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n  *                  CookieString | ClientNonce | ServerNonce)\n  *\n  */\n-static std::vector<uint8_t> ComputeResponse(const std::string &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &clientNonce, const std::vector<uint8_t> &serverNonce)\n+static std::vector<uint8_t> ComputeResponse(const std::string &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &client_nonce, const std::vector<uint8_t> &serverNonce)",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 123,
      "commit_id": "3de90a1159e606585aad32c876b6769d29f46ac1",
      "original_commit_id": "3a1f8c094798d09f41cd79c71c34afe2ea967394",
      "in_reply_to_id": 2691120938,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yeah, I was initially focussing on the member variables in order to not let this get out of hand but the param here was touched too by accident. Doesn't seem too bad to change the `serverNonce` too as well as the other local variables in this function, so taking care of all of them now.",
      "created_at": "2026-01-17T14:39:32Z",
      "updated_at": "2026-01-17T14:40:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2701193079",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2701193079"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 504,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2702478518",
      "pull_request_review_id": 3675528880,
      "id": 2702478518,
      "node_id": "PRRC_kwDOABII586hFIy2",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Oh right, of course, incomplete lines. I think this applies to HTTP as well, and should probably be a change in #34242 like, if LineReader reaches the end of the buffer before finding a `\\n` it should return null. Right now it treats end of buffer the same as end of line, but I think thats not actually what we want.",
      "created_at": "2026-01-18T14:50:14Z",
      "updated_at": "2026-01-18T14:50:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2702478518",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2702478518"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2704763440",
      "pull_request_review_id": 3678084220,
      "id": 2704763440,
      "node_id": "PRRC_kwDOABII586hN2ow",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I only glossed over the usage of `LineReader` in the rest of the http PR so far but yeah, that makes sense to me. And that would make my code here simpler :)",
      "created_at": "2026-01-19T13:23:49Z",
      "updated_at": "2026-01-19T13:23:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2704763440",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2704763440"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2709500964",
      "pull_request_review_id": 3683586241,
      "id": 2709500964,
      "node_id": "PRRC_kwDOABII586hf7Qk",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm about to push an update to #34242 that solves this. The patch below fails the partial-send test in `feature_torcontrol.py` with your current `LineReader` but passes when I rebase on the updated version:\r\n\r\n```diff\r\ndiff --git a/src/torcontrol.cpp b/src/torcontrol.cpp\r\nindex 94f925b8f4..bae7ac44a5 100644\r\n--- a/src/torcontrol.cpp\r\n+++ b/src/torcontrol.cpp\r\n@@ -188,12 +188,8 @@ bool TorControlConnection::ReceiveAndProcess()\r\n \r\n bool TorControlConnection::ProcessBuffer()\r\n {\r\n-    // TODO: Maybe could give this as an option to LineReader instead\r\n-    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\r\n-    if (last_newline == m_recv_buffer.rend()) return true;\r\n-    size_t complete = last_newline.base() - m_recv_buffer.begin();\r\n-    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);\r\n-\r\n+    util::LineReader reader(m_recv_buffer, MAX_LINE_LENGTH);\r\n+    auto start = reader.it;\r\n     while (auto line = reader.ReadLine()) {\r\n         // Skip short lines\r\n         if (line->size() < 4) continue;\r\n@@ -220,7 +216,7 @@ bool TorControlConnection::ProcessBuffer()\r\n         }\r\n     }\r\n \r\n-    m_recv_buffer.erase(m_recv_buffer.begin(), m_recv_buffer.begin() + complete);\r\n+    m_recv_buffer.erase(m_recv_buffer.begin(), m_recv_buffer.begin() + std::distance(start, reader.it));\r\n     return true;\r\n }\r\n \r\n```",
      "created_at": "2026-01-20T18:03:44Z",
      "updated_at": "2026-01-20T18:03:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2709500964",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2709500964"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2712593803",
      "pull_request_review_id": 3687270889,
      "id": 2712593803,
      "node_id": "PRRC_kwDOABII586hruWL",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Cool, thank you! I will wait until the latest conversations have been resolved before rebasing, hoping everything in #34242 is clear and it can be merged soon :)",
      "created_at": "2026-01-21T13:32:04Z",
      "updated_at": "2026-01-21T13:32:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2712593803",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2712593803"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2722890926",
      "pull_request_review_id": 3699734875,
      "id": 2722890926,
      "node_id": "PRRC_kwDOABII586iTASu",
      "diff_hunk": "@@ -166,41 +99,149 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n+        return false;\n+    }\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }\n+    if (event & Sock::ERR) {\n         return false;\n-    evbuffer_add(buf, cmd.data(), cmd.size());\n-    evbuffer_add(buf, \"\\r\\n\", 2);\n-    reply_handlers.push_back(reply_handler);\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n+{\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n+        return false;\n+    }\n+\n+    m_recv_buffer.insert(m_recv_buffer.end(), buf, buf + nread);\n+    return ProcessBuffer();\n+}\n+\n+bool TorControlConnection::ProcessBuffer()\n+{\n+    if (m_recv_buffer.size() > MAX_LINE_LENGTH) {\n+        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n+        return false;\n+    }\n+\n+    // TODO: Maybe could give this as an option to LineReader instead\n+    auto last_newline = std::find(m_recv_buffer.rbegin(), m_recv_buffer.rend(), std::byte{'\\n'});\n+    if (last_newline == m_recv_buffer.rend()) return true;\n+    size_t complete = last_newline.base() - m_recv_buffer.begin();\n+    util::LineReader reader({m_recv_buffer.data(), complete}, MAX_LINE_LENGTH);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 229,
      "commit_id": "ea470fa5dba786c8b1f91e810df77db295ea89a5",
      "original_commit_id": "c675b6f059dea662d9faa90df261de7bfbca13a1",
      "in_reply_to_id": 2695742143,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Taken now!",
      "created_at": "2026-01-23T21:23:22Z",
      "updated_at": "2026-01-23T21:23:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2722890926",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2722890926"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": 196,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732438824",
      "pull_request_review_id": 3711715882,
      "id": 2732438824,
      "node_id": "PRRC_kwDOABII586i3bUo",
      "diff_hunk": "@@ -107,32 +121,37 @@ class TorControlConnection\n class TorController\n {\n public:\n-    TorController(struct event_base* base, const std::string& tor_control_center, const CService& target);\n-    TorController() : conn{nullptr} {\n+    TorController(const std::string& tor_control_center, const CService& target);\n+    TorController() : m_conn(m_interrupt) {\n         // Used for testing only.\n     }\n     ~TorController();\n \n     /** Get name of file to store private key in */\n     fs::path GetPrivateKeyFile();\n \n-    /** Reconnect, after getting disconnected */\n-    void Reconnect();\n+    /** Interrupt the controller thread */\n+    void Interrupt();\n+\n+    /** Wait for the controller thread to exit */\n+    void Join();\n private:\n-    struct event_base* base;\n+    CThreadInterrupt m_interrupt;\n+    std::thread m_thread;\n     const std::string m_tor_control_center;\n-    TorControlConnection conn;\n-    std::string private_key;\n-    std::string service_id;\n-    bool reconnect;\n-    struct event *reconnect_ev = nullptr;\n-    float reconnect_timeout;\n-    CService service;\n+    TorControlConnection m_conn;\n+    std::string m_private_key;\n+    std::string m_service_id;\n+    bool m_reconnect;\n+    float m_reconnect_timeout;",
      "path": "src/torcontrol.h",
      "position": 1,
      "original_position": 134,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "4004ce5fd0bf249e2912ac7535218bef93907834\r\n\r\nI thought it was funny at first to store a number of seconds for a timeout in a `float`, but I see it's multiplied by `1.5` as an exponential backoff.",
      "created_at": "2026-01-27T14:59:32Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732438824",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732438824"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 146,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732469308",
      "pull_request_review_id": 3711715882,
      "id": 2732469308,
      "node_id": "PRRC_kwDOABII586i3iw8",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n+        return false;\n+    }\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n+{\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n+        return false;\n+    }\n+    if (event & Sock::ERR) {\n+        return false;\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 211,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "dea33b173e227656a2368e21bc8b24a51a881700\r\n\r\nYou don't wanna disconnect if there's a socket error?",
      "created_at": "2026-01-27T15:06:46Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732469308",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732469308"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": 133,
      "original_start_line": 156,
      "start_side": "RIGHT",
      "line": 137,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732499361",
      "pull_request_review_id": 3711715882,
      "id": 2732499361,
      "node_id": "PRRC_kwDOABII586i3qGh",
      "diff_hunk": "@@ -80,23 +79,38 @@ class TorControlConnection\n      */\n     bool Command(const std::string &cmd, const ReplyHandlerCB& reply_handler);\n \n+    /**\n+     * Check if the connection is established.\n+     */\n+    bool IsConnected() const;\n+\n+    /**\n+     * Wait for data to be available on the socket.\n+     * @param[in] timeout Maximum time to wait\n+     * @return true if data is available or timeout occurred, false on error\n+     */\n+    bool WaitForData(std::chrono::milliseconds timeout) const;\n+\n+    /**\n+     * Read available data from socket and process complete replies.\n+     * Dispatches to registered reply handlers.\n+     * @return true on success, false on connection error",
      "path": "src/torcontrol.h",
      "position": 1,
      "original_position": 62,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "dea33b173e227656a2368e21bc8b24a51a881700\r\n\r\nAlso returns false at \"at end of stream\" which I don't think is totally correct since that will log `\"Error processing data from Tor control port\"` from `ThreadControl()`.",
      "created_at": "2026-01-27T15:13:57Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732499361",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732499361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732510520",
      "pull_request_review_id": 3711715882,
      "id": 2732510520,
      "node_id": "PRRC_kwDOABII586i3s04",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n+        return false;\n+    }\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n+{\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n+        return false;\n+    }\n+    if (event & Sock::ERR) {\n+        return false;\n+    }\n+\n+    return true;\n+}\n+\n+bool TorControlConnection::ReceiveAndProcess()\n {\n-    if (!b_conn)\n+    if (!m_sock) return false;\n+\n+    std::byte buf[4096];\n+    ssize_t nread = m_sock->Recv(buf, sizeof(buf), MSG_DONTWAIT);\n+\n+    if (nread < 0) {\n+        int err = WSAGetLastError();\n+        if (err == WSAEWOULDBLOCK || err == WSAEINTR || err == WSAEINPROGRESS) {\n+            // No data available currently\n+            return true;\n+        }\n+        LogWarning(\"tor: Error reading from socket: %s\", NetworkErrorString(err));\n+        return false;\n+    }\n+\n+    if (nread == 0) {\n+        LogDebug(BCLog::TOR, \"End of stream\");\n         return false;\n-    struct evbuffer *buf = bufferevent_get_output(b_conn);\n-    if (!buf)\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 239,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "dea33b173e227656a2368e21bc8b24a51a881700\r\n\r\nrelated to comment in torcontrol.h, I'm not sure `return false` is the right thing to do at end of stream.",
      "created_at": "2026-01-27T15:16:18Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732510520",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732510520"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": 159,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 162,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732594377",
      "pull_request_review_id": 3711715882,
      "id": 2732594377,
      "node_id": "PRRC_kwDOABII586i4BTJ",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n+        return false;\n+    }\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 168,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "dea33b173e227656a2368e21bc8b24a51a881700\r\n\r\nThis would be already set if you used `CreateSock()` above.\r\n\r\nBut as long as we're setting socket options here I wonder if we should also add `SO_REUSEADDR` (don't wait to rebind to the socket if there is a restart) ",
      "created_at": "2026-01-27T15:33:35Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732594377",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732594377"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732617857",
      "pull_request_review_id": 3711715882,
      "id": 2732617857,
      "node_id": "PRRC_kwDOABII586i4HCB",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 144,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": null,
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "dea33b173e227656a2368e21bc8b24a51a881700\r\n\r\nWhy not use `CreateSock()` here?",
      "created_at": "2026-01-27T15:38:57Z",
      "updated_at": "2026-01-27T15:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732617857",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2732617857"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095076",
      "pull_request_review_id": 3729334156,
      "id": 2747095076,
      "node_id": "PRRC_kwDOABII586jvVgk",
      "diff_hunk": "@@ -107,32 +121,37 @@ class TorControlConnection\n class TorController\n {\n public:\n-    TorController(struct event_base* base, const std::string& tor_control_center, const CService& target);\n-    TorController() : conn{nullptr} {\n+    TorController(const std::string& tor_control_center, const CService& target);\n+    TorController() : m_conn(m_interrupt) {\n         // Used for testing only.\n     }\n     ~TorController();\n \n     /** Get name of file to store private key in */\n     fs::path GetPrivateKeyFile();\n \n-    /** Reconnect, after getting disconnected */\n-    void Reconnect();\n+    /** Interrupt the controller thread */\n+    void Interrupt();\n+\n+    /** Wait for the controller thread to exit */\n+    void Join();\n private:\n-    struct event_base* base;\n+    CThreadInterrupt m_interrupt;\n+    std::thread m_thread;\n     const std::string m_tor_control_center;\n-    TorControlConnection conn;\n-    std::string private_key;\n-    std::string service_id;\n-    bool reconnect;\n-    struct event *reconnect_ev = nullptr;\n-    float reconnect_timeout;\n-    CService service;\n+    TorControlConnection m_conn;\n+    std::string m_private_key;\n+    std::string m_service_id;\n+    bool m_reconnect;\n+    float m_reconnect_timeout;",
      "path": "src/torcontrol.h",
      "position": 1,
      "original_position": 134,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": 2732438824,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Hm, yeah, I didn't really think much about it. I thought about this and seems to me like using `std::chrono` here is the nicer way of doing this, so I made that change.",
      "created_at": "2026-01-30T16:39:06Z",
      "updated_at": "2026-01-30T16:39:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2747095076",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095076"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 146,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095176",
      "pull_request_review_id": 3729334278,
      "id": 2747095176,
      "node_id": "PRRC_kwDOABII586jvViI",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n+        return false;\n+    }\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {\n+        LogWarning(\"tor: Failed to set non-blocking mode: %s\", NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n         return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n     return true;\n }\n \n void TorControlConnection::Disconnect()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n-    b_conn = nullptr;\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Command(const std::string &cmd, const ReplyHandlerCB& reply_handler)\n+bool TorControlConnection::IsConnected() const\n+{\n+    if (!m_sock) return false;\n+    std::string errmsg;\n+    return m_sock->IsConnected(errmsg);\n+}\n+\n+bool TorControlConnection::WaitForData(std::chrono::milliseconds timeout) const\n+{\n+    if (!m_sock) return false;\n+\n+    Sock::Event event{0};\n+    if (!m_sock->Wait(timeout, Sock::RECV, &event)) {\n+        return false;\n+    }\n+    if (event & Sock::ERR) {\n+        return false;\n+    }",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 211,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": 2732469308,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We should disconnect [here](https://github.com/bitcoin/bitcoin/pull/34158/files#diff-743d5795e8eb460796e51f92bfd5de9cc71fd41d1ef68c8bfabade46898d72e6R407) if `WaitForData` returns false. However, when looking at it again, I think there might be some potential race if the socket is still connected somehow and calling `Disconnect` here shouldn't hurt, so I added that.",
      "created_at": "2026-01-30T16:39:08Z",
      "updated_at": "2026-01-30T16:39:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2747095176",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": 133,
      "original_start_line": 156,
      "start_side": "RIGHT",
      "line": 137,
      "original_line": 158,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095357",
      "pull_request_review_id": 3729334455,
      "id": 2747095357,
      "node_id": "PRRC_kwDOABII586jvVk9",
      "diff_hunk": "@@ -80,23 +79,38 @@ class TorControlConnection\n      */\n     bool Command(const std::string &cmd, const ReplyHandlerCB& reply_handler);\n \n+    /**\n+     * Check if the connection is established.\n+     */\n+    bool IsConnected() const;\n+\n+    /**\n+     * Wait for data to be available on the socket.\n+     * @param[in] timeout Maximum time to wait\n+     * @return true if data is available or timeout occurred, false on error\n+     */\n+    bool WaitForData(std::chrono::milliseconds timeout) const;\n+\n+    /**\n+     * Read available data from socket and process complete replies.\n+     * Dispatches to registered reply handlers.\n+     * @return true on success, false on connection error",
      "path": "src/torcontrol.h",
      "position": 1,
      "original_position": 62,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": 2732499361,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "(responding also to https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732510520, marking the other one as resolved)\r\n\r\nYeah, the docs weren't matching my real intent here. My thinking was that true simply means we are still connected and false that we are not anymore. Logging on the reason that we are not can be handled internally. I made this more consistent so at least it should be consistent now.\r\n\r\nI you insist that returning a bool isn't the right choice here I could use some enum as the return value (OK, ERR, END) to make the code more expressive. Would be fine for me, too.",
      "created_at": "2026-01-30T16:39:11Z",
      "updated_at": "2026-01-30T16:39:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2747095357",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095357"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095787",
      "pull_request_review_id": 3729334973,
      "id": 2747095787,
      "node_id": "PRRC_kwDOABII586jvVrr",
      "diff_hunk": "@@ -166,41 +99,141 @@ bool TorControlConnection::Connect(const std::string& tor_control_center, const\n         return false;\n     }\n \n-    // Create a new socket, set up callbacks and enable notification bits\n-    b_conn = bufferevent_socket_new(base, -1, BEV_OPT_CLOSE_ON_FREE);\n-    if (!b_conn) {\n+    // Create a new socket\n+    SOCKET s = socket(control_service->GetSAFamily(), SOCK_STREAM, IPPROTO_TCP);\n+    if (s == INVALID_SOCKET) {\n+        LogWarning(\"tor: Failed to create socket: %s\", NetworkErrorString(WSAGetLastError()));\n         return false;\n     }\n-    bufferevent_setcb(b_conn, TorControlConnection::readcb, nullptr, TorControlConnection::eventcb, this);\n-    bufferevent_enable(b_conn, EV_READ|EV_WRITE);\n-    this->connected = _connected;\n-    this->disconnected = _disconnected;\n-\n-    // Finally, connect to tor_control_center\n-    if (bufferevent_socket_connect(b_conn, reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) < 0) {\n-        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+\n+    m_sock = std::make_unique<Sock>(s);\n+\n+    // Connect to Tor control port\n+    if (m_sock->Connect(reinterpret_cast<struct sockaddr*>(&control_address), control_address_len) == SOCKET_ERROR) {\n+        LogWarning(\"tor: Error connecting to address %s: %s\", tor_control_center, NetworkErrorString(WSAGetLastError()));\n+        m_sock.reset();\n+        return false;\n+    }\n+\n+    // Set non-blocking mode on socket\n+    if (!m_sock->SetNonBlocking()) {",
      "path": "src/torcontrol.cpp",
      "position": 1,
      "original_position": 168,
      "commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "original_commit_id": "1545c062a5973d7ec1aaf77d6224c5ad8a1686b2",
      "in_reply_to_id": 2732594377,
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "(responding also to https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2732617857, marking the other as resolved)\r\n\r\nI looked through that code and it seemed actually that `ConnectDirectly()` was an even better fit, so I am using that for now, let me know what you think.",
      "created_at": "2026-01-30T16:39:19Z",
      "updated_at": "2026-01-30T16:39:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2747095787",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2747095787"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779303604",
      "pull_request_review_id": 3769780789,
      "id": 2779303604,
      "node_id": "PRRC_kwDOABII586lqM60",
      "diff_hunk": "@@ -61,146 +56,163 @@ static const std::string TOR_SAFE_SERVERKEY = \"Tor safe cookie authentication se\n /** For computing clientHash in SAFECOOKIE */\n static const std::string TOR_SAFE_CLIENTKEY = \"Tor safe cookie authentication controller-to-server hash\";\n /** Exponential backoff configuration - initial timeout in seconds */\n-constexpr float RECONNECT_TIMEOUT_START = 1.0;\n+constexpr std::chrono::duration<double> RECONNECT_TIMEOUT_START{1.0};\n /** Exponential backoff configuration - growth factor */\n-constexpr float RECONNECT_TIMEOUT_EXP = 1.5;\n+constexpr double RECONNECT_TIMEOUT_EXP = 1.5;\n /** Maximum reconnect timeout in seconds to prevent excessive delays */\n-constexpr float RECONNECT_TIMEOUT_MAX = 600.0;\n+constexpr std::chrono::duration<double> RECONNECT_TIMEOUT_MAX{600.0};\n /** Maximum length for lines received on TorControlConnection.\n  * tor-control-spec.txt mentions that there is explicitly no limit defined to line length,\n  * this is belt-and-suspenders sanity limit to prevent memory exhaustion.\n  */\n constexpr int MAX_LINE_LENGTH = 100000;\n+/** Timeout for socket operations */\n+constexpr auto SOCKET_SEND_TIMEOUT = 10s;\n \n /****** Low-level TorControlConnection ********/\n \n-TorControlConnection::TorControlConnection(struct event_base* _base)\n-    : base(_base)\n+TorControlConnection::TorControlConnection(CThreadInterrupt& interrupt)\n+    : m_interrupt(interrupt)\n {\n }\n \n TorControlConnection::~TorControlConnection()\n {\n-    if (b_conn)\n-        bufferevent_free(b_conn);\n+    Disconnect();\n }\n \n-void TorControlConnection::readcb(struct bufferevent *bev, void *ctx)\n+bool TorControlConnection::Connect(const std::string& tor_control_center)\n {\n-    TorControlConnection *self = static_cast<TorControlConnection*>(ctx);\n-    struct evbuffer *input = bufferevent_get_input(bev);\n-    size_t n_read_out = 0;\n-    char *line;\n-    assert(input);\n-    //  If there is not a whole line to read, evbuffer_readln returns nullptr\n-    while((line = evbuffer_readln(input, &n_read_out, EVBUFFER_EOL_CRLF)) != nullptr)\n-    {\n-        std::string s(line, n_read_out);\n-        free(line);\n-        if (s.size() < 4) // Short line\n-            continue;\n-        // <status>(-|+| )<data><CRLF>\n-        self->m_message.code = ToIntegral<int>(s.substr(0, 3)).value_or(0);\n-        self->m_message.lines.push_back(s.substr(4));\n-        char ch = s[3]; // '-','+' or ' '\n-        if (ch == ' ') {\n-            // Final line, dispatch reply and clean up\n-            if (self->m_message.code >= 600) {\n-                // (currently unused)\n-                // Dispatch async notifications to async handler\n-                // Synchronous and asynchronous messages are never interleaved\n-            } else {\n-                if (!self->reply_handlers.empty()) {\n-                    // Invoke reply handler with message\n-                    self->reply_handlers.front()(*self, self->m_message);\n-                    self->reply_handlers.pop_front();\n-                } else {\n-                    LogDebug(BCLog::TOR, \"Received unexpected sync reply %i\", self->m_message.code);\n-                }\n-            }\n-            self->m_message.Clear();\n-        }\n+    if (m_sock) {\n+        Disconnect();\n+    }\n+\n+    std::optional<CService> control_service = Lookup(tor_control_center, 9051, fNameLookup);\n+    if (!control_service.has_value()) {\n+        LogWarning(\"tor: Failed to look up control center %s\", tor_control_center);\n+        return false;\n     }\n-    //  Check for size of buffer - protect against memory exhaustion with very long lines\n-    //  Do this after evbuffer_readln to make sure all full lines have been\n-    //  removed from the buffer. Everything left is an incomplete line.\n-    if (evbuffer_get_length(input) > MAX_LINE_LENGTH) {\n-        LogWarning(\"tor: Disconnecting because MAX_LINE_LENGTH exceeded\");\n-        self->Disconnect();\n+\n+    m_sock = ConnectDirectly(control_service.value(), /*manual_connection=*/true);\n+    if (!m_sock) {\n+        LogWarning(\"tor: Error connecting to address %s\", tor_control_center);\n+        return false;\n     }\n+\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n+\n+    LogDebug(BCLog::TOR, \"Successfully connected to Tor control port\");\n+    return true;\n }\n \n-void TorControlConnection::eventcb(struct bufferevent *bev, short what, void *ctx)\n+void TorControlConnection::Disconnect()\n {\n-    TorControlConnection *self = static_cast<TorControlConnection*>(ctx);\n-    if (what & BEV_EVENT_CONNECTED) {\n-        LogDebug(BCLog::TOR, \"Successfully connected!\");\n-        self->connected(*self);\n-    } else if (what & (BEV_EVENT_EOF|BEV_EVENT_ERROR)) {\n-        if (what & BEV_EVENT_ERROR) {\n-            LogDebug(BCLog::TOR, \"Error connecting to Tor control socket\");\n-        } else {\n-            LogDebug(BCLog::TOR, \"End of stream\");\n-        }\n-        self->Disconnect();\n-        self->disconnected(*self);\n-    }\n+    m_sock.reset();\n+    m_recv_buffer.clear();\n+    m_message.Clear();\n+    m_reply_handlers.clear();\n }\n \n-bool TorControlConnection::Connect(const std::string& tor_control_center, const ConnectionCB& _connected, const ConnectionCB& _disconnected)\n+bool TorControlConnection::IsConnected() const\n {\n-    if (b_conn) {\n-        Disconnect();\n-    }\n+    if (!m_sock) return false;\n+    std::string errmsg;",
      "path": "src/torcontrol.cpp",
      "position": 152,
      "original_position": 152,
      "commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "original_commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nit: How about logging this to debug or trace?",
      "created_at": "2026-02-08T13:57:45Z",
      "updated_at": "2026-02-08T21:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2779303604",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779303604"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 121,
      "original_line": 121,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779598313",
      "pull_request_review_id": 3769780789,
      "id": 2779598313,
      "node_id": "PRRC_kwDOABII586lrU3p",
      "diff_hunk": "@@ -640,86 +703,42 @@ void TorController::disconnected_cb(TorControlConnection& _conn)\n     if (!m_reconnect)\n         return;\n \n-    LogDebug(BCLog::TOR, \"Not connected to Tor control port %s, retrying in %.2f s\",\n-             m_tor_control_center, m_reconnect_timeout);\n-\n-    // Single-shot timer for reconnect. Use exponential backoff with a maximum.\n-    struct timeval time = MillisToTimeval(int64_t(m_reconnect_timeout * 1000.0));\n-    if (reconnect_ev)\n-        event_add(reconnect_ev, &time);\n-\n-    m_reconnect_timeout = std::min(m_reconnect_timeout * RECONNECT_TIMEOUT_EXP, RECONNECT_TIMEOUT_MAX);\n-}\n-\n-void TorController::Reconnect()\n-{\n-    /* Try to reconnect and reestablish if we get booted - for example, Tor\n-     * may be restarting.\n-     */\n-    if (!m_conn.Connect(m_tor_control_center, std::bind_front(&TorController::connected_cb, this),\n-         std::bind_front(&TorController::disconnected_cb, this) )) {\n-        LogWarning(\"tor: Re-initiating connection to Tor control port %s failed\", m_tor_control_center);\n-    }\n+    LogDebug(BCLog::TOR, \"Not connected to Tor control port %s, will retry\", m_tor_control_center);",
      "path": "src/torcontrol.cpp",
      "position": 419,
      "original_position": 419,
      "commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "original_commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Would  a warn-level log line somewhere in the retry logic be useful?",
      "created_at": "2026-02-08T17:57:38Z",
      "updated_at": "2026-02-08T21:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2779598313",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779598313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 706,
      "original_line": 706,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779840641",
      "pull_request_review_id": 3769780789,
      "id": 2779840641,
      "node_id": "PRRC_kwDOABII586lsQCB",
      "diff_hunk": "@@ -640,86 +703,42 @@ void TorController::disconnected_cb(TorControlConnection& _conn)\n     if (!m_reconnect)\n         return;\n \n-    LogDebug(BCLog::TOR, \"Not connected to Tor control port %s, retrying in %.2f s\",\n-             m_tor_control_center, m_reconnect_timeout);\n-\n-    // Single-shot timer for reconnect. Use exponential backoff with a maximum.\n-    struct timeval time = MillisToTimeval(int64_t(m_reconnect_timeout * 1000.0));\n-    if (reconnect_ev)\n-        event_add(reconnect_ev, &time);\n-\n-    m_reconnect_timeout = std::min(m_reconnect_timeout * RECONNECT_TIMEOUT_EXP, RECONNECT_TIMEOUT_MAX);\n-}\n-\n-void TorController::Reconnect()\n-{\n-    /* Try to reconnect and reestablish if we get booted - for example, Tor\n-     * may be restarting.\n-     */\n-    if (!m_conn.Connect(m_tor_control_center, std::bind_front(&TorController::connected_cb, this),\n-         std::bind_front(&TorController::disconnected_cb, this) )) {\n-        LogWarning(\"tor: Re-initiating connection to Tor control port %s failed\", m_tor_control_center);\n-    }\n+    LogDebug(BCLog::TOR, \"Not connected to Tor control port %s, will retry\", m_tor_control_center);\n+    _conn.Disconnect();\n }\n \n fs::path TorController::GetPrivateKeyFile()\n {\n     return gArgs.GetDataDirNet() / \"onion_v3_private_key\";\n }\n \n-void TorController::reconnect_cb(evutil_socket_t fd, short what, void *arg)\n-{\n-    TorController *self = static_cast<TorController*>(arg);\n-    self->Reconnect();\n-}\n-\n /****** Thread ********/\n-static struct event_base *gBase;\n-static std::thread torControlThread;\n \n-static void TorControlThread(CService onion_service_target)\n-{\n-    TorController ctrl(gBase, gArgs.GetArg(\"-torcontrol\", DEFAULT_TOR_CONTROL), onion_service_target);\n-\n-    event_base_dispatch(gBase);\n-}\n+/**\n+ * TODO: TBD if introducing a global is the preferred approach here since we\n+ * usually try to avoid them. We could let init manage the lifecycle or make\n+ * this a part of NodeContext maybe instead.\n+ */\n+static std::unique_ptr<TorController> g_tor_controller;",
      "path": "src/torcontrol.cpp",
      "position": 449,
      "original_position": 449,
      "commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "original_commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Seems like moving this to node context is a simple change and gets rid of some boilerplate that is only covered by functional tests:\r\n\r\n<details>\r\n<summary>Click to expand diff</summary>\r\n\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex 841fdec5b2..07de0c63d3 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -273 +273,3 @@ void Interrupt(NodeContext& node)\r\n-    InterruptTorControl();\r\n+    if (node.tor_controller) {\r\n+        node.tor_controller->Interrupt();\r\n+    }\r\n@@ -316 +318,4 @@ void Shutdown(NodeContext& node)\r\n-    StopTorControl();\r\n+    if (node.tor_controller) {\r\n+        node.tor_controller->Join();\r\n+        node.tor_controller.reset();\r\n+    }\r\n@@ -2141 +2146 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\r\n-        StartTorControl(onion_service_target);\r\n+        node.tor_controller = std::make_unique<TorController>(gArgs.GetArg(\"-torcontrol\", DEFAULT_TOR_CONTROL), onion_service_target);\r\ndiff --git a/src/node/context.cpp b/src/node/context.cpp\r\nindex d7d01b494e..164361601f 100644\r\n--- a/src/node/context.cpp\r\n+++ b/src/node/context.cpp\r\n@@ -19,0 +20 @@\r\n+#include <torcontrol.h>\r\ndiff --git a/src/node/context.h b/src/node/context.h\r\nindex 3a7488fd25..abe1bc8da2 100644\r\n--- a/src/node/context.h\r\n+++ b/src/node/context.h\r\n@@ -27,0 +28 @@ class PeerManager;\r\n+class TorController;\r\n@@ -92,0 +94 @@ struct NodeContext {\r\n+    std::unique_ptr<TorController> tor_controller;\r\ndiff --git a/src/torcontrol.cpp b/src/torcontrol.cpp\r\nindex be17a57488..1dbc037df0 100644\r\n--- a/src/torcontrol.cpp\r\n+++ b/src/torcontrol.cpp\r\n@@ -715,29 +714,0 @@ fs::path TorController::GetPrivateKeyFile()\r\n-/****** Thread ********/\r\n-\r\n-/**\r\n- * TODO: TBD if introducing a global is the preferred approach here since we\r\n- * usually try to avoid them. We could let init manage the lifecycle or make\r\n- * this a part of NodeContext maybe instead.\r\n- */\r\n-static std::unique_ptr<TorController> g_tor_controller;\r\n-\r\n-void StartTorControl(CService onion_service_target)\r\n-{\r\n-    assert(!g_tor_controller);\r\n-    g_tor_controller = std::make_unique<TorController>(gArgs.GetArg(\"-torcontrol\", DEFAULT_TOR_CONTROL), onion_service_target);\r\n-}\r\n-\r\n-void InterruptTorControl()\r\n-{\r\n-    if (!g_tor_controller) return;\r\n-    LogInfo(\"tor: Thread interrupt\");\r\n-    g_tor_controller->Interrupt();\r\n-}\r\n-\r\n-void StopTorControl()\r\n-{\r\n-    if (!g_tor_controller) return;\r\n-    g_tor_controller->Join();\r\n-    g_tor_controller.reset();\r\n-}\r\n-\r\ndiff --git a/src/torcontrol.h b/src/torcontrol.h\r\nindex 94561e3f40..ae4902fee0 100644\r\n--- a/src/torcontrol.h\r\n+++ b/src/torcontrol.h\r\n@@ -29,4 +28,0 @@ static const bool DEFAULT_LISTEN_ONION = true;\r\n-void StartTorControl(CService onion_service_target);\r\n-void InterruptTorControl();\r\n-void StopTorControl();\r\n-\r\n\r\n```\r\n</details>",
      "created_at": "2026-02-08T20:58:47Z",
      "updated_at": "2026-02-08T21:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2779840641",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779840641"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 722,
      "original_line": 722,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779862140",
      "pull_request_review_id": 3769780789,
      "id": 2779862140,
      "node_id": "PRRC_kwDOABII586lsVR8",
      "diff_hunk": "@@ -501,7 +564,7 @@ void TorController::auth_cb(TorControlConnection& _conn, const TorControlReply&\n  *                  CookieString | ClientNonce | ServerNonce)\n  *\n  */\n-static std::vector<uint8_t> ComputeResponse(const std::string &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &client_nonce, const std::vector<uint8_t> &server_nonce)\n+static std::vector<uint8_t> ComputeResponse(const std::string_view &key, const std::vector<uint8_t> &cookie,  const std::vector<uint8_t> &client_nonce, const std::vector<uint8_t> &server_nonce)",
      "path": "src/torcontrol.cpp",
      "position": 391,
      "original_position": 391,
      "commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "original_commit_id": "a87e37f377602342a88f72d3d973791c974f7596",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Nit: Can pass `key` by value and in the spirit of this line's change the vectors could be spans?",
      "created_at": "2026-02-08T21:11:53Z",
      "updated_at": "2026-02-08T21:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2779862140",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779862140"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 567,
      "original_line": 567,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779894159",
      "pull_request_review_id": 3769780789,
      "id": 2779894159,
      "node_id": "PRRC_kwDOABII586lsdGP",
      "diff_hunk": "@@ -58,23 +39,23 @@ FUZZ_TARGET(torcontrol, .init = initialize_torcontrol)\n                 tor_control_reply.code = fuzzed_data_provider.ConsumeIntegral<int>();\n             });\n         tor_control_reply.lines = ConsumeRandomLengthStringVector(fuzzed_data_provider);\n-        if (tor_control_reply.lines.empty()) {\n-            break;\n-        }\n-        DummyTorControlConnection dummy_tor_control_connection;\n+\n         CallOneOf(\n             fuzzed_data_provider,\n             [&] {\n-                tor_controller.add_onion_cb(dummy_tor_control_connection, tor_control_reply);\n+                tor_controller.add_onion_cb(conn, tor_control_reply);\n+            },\n+            [&] {\n+                tor_controller.auth_cb(conn, tor_control_reply);\n             },\n             [&] {\n-                tor_controller.auth_cb(dummy_tor_control_connection, tor_control_reply);\n+                tor_controller.authchallenge_cb(conn, tor_control_reply);",
      "path": "src/test/fuzz/torcontrol.cpp",
      "position": 59,
      "original_position": 59,
      "commit_id": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "original_commit_id": "ddc4faafd2150aed08a5956638a8781ede234e4e",
      "in_reply_to_id": null,
      "user": {
        "login": "sedited",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sedited",
        "html_url": "https://github.com/sedited",
        "followers_url": "https://api.github.com/users/sedited/followers",
        "following_url": "https://api.github.com/users/sedited/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sedited/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sedited/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sedited/subscriptions",
        "organizations_url": "https://api.github.com/users/sedited/orgs",
        "repos_url": "https://api.github.com/users/sedited/repos",
        "events_url": "https://api.github.com/users/sedited/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sedited/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I'm getting a fuzzer failure that I'm guessing may be caused by a change in this function:\n\n<details>\n<summary>Click to expand logs</summary>\n\n```\n#740\tNEW    cov: 661 ft: 1014 corp: 25/78b lim: 4 exec/s: 0 rss: 110Mb L: 4/4 MS: 5 ChangeBit-CMP-ChangeByte-ChangeBinInt-ShuffleBytes- DE: \"\\373\\000\\000\\000\"-\n/usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/stl_vector.h:1148:9: runtime error: reference binding to null pointer of type 'const value_type' (aka 'const std::basic_string<char>')\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/stl_vector.h:1148:9 \nAddressSanitizer:DEADLYSIGNAL\n=================================================================\n==21501==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000008 (pc 0x64b69d0d8101 bp 0x7ffe53d6ec10 sp 0x7ffe53d6eb40 T0)\n==21501==The signal is caused by a READ memory access.\n==21501==Hint: address points to the zero page.\n    #0 0x64b69d0d8101 in std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>>::size() const /usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/basic_string.h:1072:16\n    #1 0x64b69d0d8101 in SplitTorReplyLine(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>> const&) /home/drgrid/bitcoin/src/torcontrol.cpp:230:20\n    #2 0x64b69d0e3b7b in TorController::authchallenge_cb(TorControlConnection&, TorControlReply const&) /home/drgrid/bitcoin/src/torcontrol.cpp:582:48\n    #3 0x64b69b8d6321 in torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_5::operator()() const /home/drgrid/bitcoin/src/test/fuzz/torcontrol.cpp:52:32\n    #4 0x64b69b8d6321 in unsigned long CallOneOf<torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_3, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_4, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_5, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_6, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_7>(FuzzedDataProvider&, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_3, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_4, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_5, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_6, torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>)::$_7) /home/drgrid/bitcoin/src/test/fuzz/util.h:42:27\n    #5 0x64b69b8d6321 in torcontrol_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>) /home/drgrid/bitcoin/src/test/fuzz/torcontrol.cpp:43:9\n    #6 0x64b69bb79cd5 in std::function<void (std::span<unsigned char const, 18446744073709551615ul>)>::operator()(std::span<unsigned char const, 18446744073709551615ul>) const /usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\n    #7 0x64b69bb79cd5 in test_one_input(std::span<unsigned char const, 18446744073709551615ul>) /home/drgrid/bitcoin/src/test/fuzz/fuzz.cpp:88:5\n    #8 0x64b69bb79cd5 in LLVMFuzzerTestOneInput /home/drgrid/bitcoin/src/test/fuzz/fuzz.cpp:216:5\n    #9 0x64b69b115c14 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1badc14) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #10 0x64b69b115309 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1bad309) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #11 0x64b69b116af5 in fuzzer::Fuzzer::MutateAndTestOne() (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1baeaf5) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #12 0x64b69b117655 in fuzzer::Fuzzer::Loop(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1baf655) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #13 0x64b69b10492f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1b9c92f) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #14 0x64b69b12efb6 in main (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1bc6fb6) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n    #15 0x70df0082a1c9 in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n    #16 0x70df0082a28a in __libc_start_main csu/../csu/libc-start.c:360:3\n    #17 0x64b69b0f9914 in _start (/home/drgrid/bitcoin/build_fuzz/bin/fuzz+0x1b91914) (BuildId: e39b175d556cbbeafdd76014c930896f3d6c8f6e)\n\nAddressSanitizer can not provide additional info.\nSUMMARY: AddressSanitizer: SEGV /home/drgrid/bitcoin/src/torcontrol.cpp:230:20 in SplitTorReplyLine(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>> const&)\n==21501==ABORTING\nMS: 1 ChangeASCIIInt-; base unit: 66ab8fe3159190c0fece3131125619ef7349a19d\n0x84,0x33,0xdb,0x67,\n\\2043\\333g\nartifact_prefix='./'; Test unit written to ./crash-01d7dad05a5562f6797a2b566c99fb79187bc471\nBase64: hDPbZw==\n\n```\n</details>\n\nI am able to reproduce the crash locally with:\n```\ncat crash-01d7dad05a5562f6797a2b566c99fb79187bc471 | base64                                                                         \nhDPbZw==\n```\n\n",
      "created_at": "2026-02-08T21:29:22Z",
      "updated_at": "2026-02-08T21:30:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34158#discussion_r2779894159",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779894159"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34158"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    }
  ]
}
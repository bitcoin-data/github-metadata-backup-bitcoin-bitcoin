{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409",
    "id": 1958283427,
    "node_id": "PR_kwDOABII5850uQij",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30409",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30409.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30409.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/2804848395805a7af8ce2c0b6aa263ba1239f926",
    "number": 30409,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange, drop CRPCSignals & g_best_block",
    "user": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This continues the work in #30200 so that a future Stratum v2 Template Provider (see #29432) can avoid accessing node internals. It needs to know when a new block arrives in order to push new templates to connected clients.\r\n\r\n`waitTipChanged()` uses a new kernel notification `notifications().m_tip_block_mutex`, which this PR also introduces (a previous version used `g_best_block`).\r\n\r\nIn order to ensure the new method works as intended, the `waitfornewblock`, `waitforblock` and `waitforblockheight` RPC methods are refactored to use it. This allows removing `RPCNotifyBlockChange`.\r\n\r\nThere's a commit to add (direct) tests for the methods that are about to be refactored:\r\n- `waitfornewblock` was already implicitly tested by `feature_shutdown.py`.\r\n- `waitforblockheight` by `feature_coinstatsindex.py` and `example_test.py`\r\n\r\nThis PR renames `getTipHash()` to `getTip()` and returns a `BlockRef` (renamed from `BlockKey`) so that callers can use either the height or hash.\r\n\r\nThe later commits make trivial improvements to the `waitfor*` RPC calls (not needed for this PR).\r\n\r\nThe `waitTipChanged()` method could probably also be used for the longpoll functionality in `getblocktemplate`, but I'm a bit reluctant to touch that.\r\n\r\n`RPCServer::OnStarted` no longer does anything and `RPCServer::OnStopped` merely prints a log statement. They were added in #5711 as a refactor. This PR drops them entirely.\r\n\r\nFinally `g_best_block` is also dropped.",
    "labels": [],
    "created_at": "2024-07-08T17:11:21Z",
    "updated_at": "2024-08-28T04:35:32Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "57e5fe8cc7bc6c69ad6306b868da5d3f52bcb87e",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "Sjors:2024/07/wait-tip-changed",
      "ref": "2024/07/wait-tip-changed",
      "sha": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 92390696,
        "node_id": "MDEwOlJlcG9zaXRvcnk5MjM5MDY5Ng==",
        "name": "bitcoin",
        "full_name": "Sjors/bitcoin",
        "owner": {
          "login": "Sjors",
          "id": 10217,
          "node_id": "MDQ6VXNlcjEwMjE3",
          "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/Sjors",
          "html_url": "https://github.com/Sjors",
          "followers_url": "https://api.github.com/users/Sjors/followers",
          "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
          "organizations_url": "https://api.github.com/users/Sjors/orgs",
          "repos_url": "https://api.github.com/users/Sjors/repos",
          "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/Sjors/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/Sjors/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/Sjors/bitcoin",
        "archive_url": "https://api.github.com/repos/Sjors/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/Sjors/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/Sjors/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/Sjors/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/Sjors/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/Sjors/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/Sjors/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/Sjors/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/Sjors/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/Sjors/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/Sjors/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/Sjors/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/Sjors/bitcoin/events",
        "forks_url": "https://api.github.com/repos/Sjors/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/Sjors/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/Sjors/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/Sjors/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/Sjors/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/Sjors/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/Sjors/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/Sjors/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/Sjors/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/Sjors/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/Sjors/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/Sjors/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/Sjors/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/Sjors/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/Sjors/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/Sjors/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:Sjors/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/Sjors/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/Sjors/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/Sjors/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/Sjors/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/Sjors/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/Sjors/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/Sjors/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/Sjors/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/Sjors/bitcoin/hooks",
        "svn_url": "https://github.com/Sjors/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 245882,
        "default_branch": "sv2",
        "open_issues_count": 15,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": false,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-26T17:26:54Z",
        "created_at": "2017-05-25T10:05:54Z",
        "updated_at": "2024-08-13T18:57:28Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "6d546336e800f7b8990fececab6bc08413f28690",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35808,
        "stargazers_count": 77740,
        "watchers_count": 77740,
        "size": 266532,
        "default_branch": "master",
        "open_issues_count": 666,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-27T20:48:00Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-08-28T03:20:09Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 204,
    "deletions": 164,
    "changed_files": 23,
    "commits": 12,
    "review_comments": 46,
    "comments": 11
  },
  "events": [
    {
      "event": "commented",
      "id": 2214741306,
      "node_id": "IC_kwDOABII586EAkU6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2214741306",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-08T17:11:23Z",
      "updated_at": "2024-08-28T04:35:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30409).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245698982) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30713](https://github.com/bitcoin/bitcoin/pull/30713) (rpc: add `revelant_blocks` to `scanblocks status` by tdb3)\n* [#30635](https://github.com/bitcoin/bitcoin/pull/30635) (rpc: add optional blockhash to waitfornewblock by Sjors)\n* [#30546](https://github.com/bitcoin/bitcoin/pull/30546) (util: Use consteval checked format string in FatalErrorf by maflcko)\n* [#30509](https://github.com/bitcoin/bitcoin/pull/30509) (multiprocess: Add -ipcbind option to bitcoin-node by ryanofsky)\n* [#30440](https://github.com/bitcoin/bitcoin/pull/30440) (Have createNewBlock() return a BlockTemplate interface by Sjors)\n* [#30437](https://github.com/bitcoin/bitcoin/pull/30437) (multiprocess: add bitcoin-mine test program by ryanofsky)\n* [#29553](https://github.com/bitcoin/bitcoin/pull/29553) (assumeutxo: Add dumptxoutset height param, remove shell scripts by fjahr)\n* [#29432](https://github.com/bitcoin/bitcoin/pull/29432) (Stratum v2 Template Provider (take 3) by Sjors)\n* [#26593](https://github.com/bitcoin/bitcoin/pull/26593) (tracing: Only prepare tracepoint arguments when actually tracing by 0xB10C)\n* [#24230](https://github.com/bitcoin/bitcoin/pull/24230) (indexes: Stop using node internal types and locking cs_main, improve sync logic by ryanofsky)\n* [#19461](https://github.com/bitcoin/bitcoin/pull/19461) (multiprocess: Add bitcoin-gui -ipcconnect option by ryanofsky)\n* [#19460](https://github.com/bitcoin/bitcoin/pull/19460) (multiprocess: Add bitcoin-wallet -ipcconnect option by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2214741306",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "labeled",
      "id": 13429199017,
      "node_id": "LE_lADOABII586O0lCbzwAAAAMgcVCp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13429199017",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-08T20:08:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13434478291,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMgwd7T",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13434478291",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T06:47:46Z"
    },
    {
      "event": "renamed",
      "id": 13435375497,
      "node_id": "RTE_lADOABII586O0lCbzwAAAAMgz4-J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13435375497",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T07:54:36Z",
      "rename": {
        "from": "Introduce waitTipChanged() mining interface and replace RPCNotifyBlockChange",
        "to": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange and drop CRPCSignals"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13435377512,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMgz5do",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13435377512",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T07:54:44Z"
    },
    {
      "event": "commented",
      "id": 2216910420,
      "node_id": "IC_kwDOABII586EI15U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2216910420",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:17:59Z",
      "updated_at": "2024-07-09T08:19:05Z",
      "author_association": "MEMBER",
      "body": "Some of the functional tests that use the refactored RPC calls still fail under TSAN, so keeping this draft until that's resolved.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2216910420",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13436202713,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMg3C7Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13436202713",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:51:18Z"
    },
    {
      "event": "commented",
      "id": 2217017610,
      "node_id": "IC_kwDOABII586EJQEK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2217017610",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:56:22Z",
      "updated_at": "2024-07-09T09:01:08Z",
      "author_association": "MEMBER",
      "body": "Fixed the deadlock. I ran into the same issue before when working on #29432: `UpdateTip` requires holding `cs_main`. It then takes `g_best_block_mutex` in order to announces the new block. So then lines after `g_best_block_cv.wait_until` should release `g_best_block_mutex` before trying to lock `cs_main`.\r\n\r\nThat's not a problem here; I just had to break out of the while loop instead of returning from it.\r\n\r\nBack in the other PR this led to a deadlock if we simultaneously submitted a block and received it via p2p from the pool, which can happen in Stratum v2, see https://github.com/bitcoin/bitcoin/pull/29432#issuecomment-1948355393",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2217017610",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "ready_for_review",
      "id": 13436288936,
      "node_id": "RFRE_lADOABII586O0lCbzwAAAAMg3X-o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13436288936",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T08:56:50Z"
    },
    {
      "event": "unlabeled",
      "id": 13437400179,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAMg7nRz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13437400179",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-09T10:09:40Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13470614601,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMi6URJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13470614601",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T11:55:30Z"
    },
    {
      "event": "reviewed",
      "id": 2171768079,
      "node_id": "PRR_kwDOABII586Bco0P",
      "url": null,
      "actor": null,
      "commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2171768079",
      "submitted_at": "2024-07-11T12:35:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "referenced",
      "id": 13525713995,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMmMgRL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13525713995",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "4e1a4342f3b2a857e3211587cd14e36704197483",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/4e1a4342f3b2a857e3211587cd14e36704197483",
      "created_at": "2024-07-16T18:51:15Z"
    },
    {
      "event": "referenced",
      "id": 13538820465,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMm-gFx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13538820465",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e1ae38f4bbcdb1b3fa5e1eab1abfa9cf2232798c",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/e1ae38f4bbcdb1b3fa5e1eab1abfa9cf2232798c",
      "created_at": "2024-07-17T15:38:57Z"
    },
    {
      "event": "referenced",
      "id": 13539015189,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMm_PoV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539015189",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "e1fa475a5becca0083f59d7cafac9bc67c2f4f1c",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/e1fa475a5becca0083f59d7cafac9bc67c2f4f1c",
      "created_at": "2024-07-17T15:53:00Z"
    },
    {
      "event": "referenced",
      "id": 13539417192,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnAxxo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539417192",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5126ac430f3bc94b727044dc2497acebb73a9f3f",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/5126ac430f3bc94b727044dc2497acebb73a9f3f",
      "created_at": "2024-07-17T16:24:13Z"
    },
    {
      "event": "referenced",
      "id": 13539417260,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnAxys",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539417260",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "bdd68d5bca483071ca0729e6f0d2d71706ad21e7",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/bdd68d5bca483071ca0729e6f0d2d71706ad21e7",
      "created_at": "2024-07-17T16:24:14Z"
    },
    {
      "event": "referenced",
      "id": 13539756843,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMnCEsr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13539756843",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "173580b1237e5bd7d63564aea555ca8914715f75",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/173580b1237e5bd7d63564aea555ca8914715f75",
      "created_at": "2024-07-17T16:56:26Z"
    },
    {
      "event": "referenced",
      "id": 13555095824,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMn8lkQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13555095824",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7967d78d737472c25b6420a1f26c8df25ac21a67",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/7967d78d737472c25b6420a1f26c8df25ac21a67",
      "created_at": "2024-07-18T12:45:55Z"
    },
    {
      "event": "referenced",
      "id": 13555701087,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMn-5Vf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13555701087",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "79336c95faa1af966042f06ad9bc86a5333f18f3",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/79336c95faa1af966042f06ad9bc86a5333f18f3",
      "created_at": "2024-07-18T13:17:31Z"
    },
    {
      "event": "labeled",
      "id": 13559817468,
      "node_id": "LE_lADOABII586O0lCbzwAAAAMoOmT8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13559817468",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:57:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13559846043,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAMoOtSb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13559846043",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:59:48Z"
    },
    {
      "event": "commented",
      "id": 2237085603,
      "node_id": "IC_kwDOABII586FVzej",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2237085603",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T16:59:51Z",
      "updated_at": "2024-07-18T16:59:51Z",
      "author_association": "MEMBER",
      "body": "Rebased after #30356 (`#include` order).",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2237085603",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "unlabeled",
      "id": 13561659992,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAMoVoJY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13561659992",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-18T19:10:27Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 13562870527,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPr_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870527",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "8a814d5f9319cb357498e2c0a8669659a3cc4823",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/8a814d5f9319cb357498e2c0a8669659a3cc4823",
      "created_at": "2024-07-18T20:40:46Z"
    },
    {
      "event": "referenced",
      "id": 13562870564,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPsk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870564",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "fba04d7756c77ed9371c5dc90d3bebc9aa767f4b",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/fba04d7756c77ed9371c5dc90d3bebc9aa767f4b",
      "created_at": "2024-07-18T20:40:46Z"
    },
    {
      "event": "referenced",
      "id": 13562870801,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPwR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870801",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0b76ed6480bf498074423d5904b04ef9a2f5e624",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/0b76ed6480bf498074423d5904b04ef9a2f5e624",
      "created_at": "2024-07-18T20:40:47Z"
    },
    {
      "event": "referenced",
      "id": 13562870882,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMoaPxi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13562870882",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "b01bf642b7b663a7f4aa43e14085fca084b1248d",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/b01bf642b7b663a7f4aa43e14085fca084b1248d",
      "created_at": "2024-07-18T20:40:48Z"
    },
    {
      "event": "referenced",
      "id": 13571852146,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMo8gdy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13571852146",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "01bc77e8504e3059d780c00544466f3a04f01779",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/01bc77e8504e3059d780c00544466f3a04f01779",
      "created_at": "2024-07-19T09:46:04Z"
    },
    {
      "event": "referenced",
      "id": 13636881864,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k3I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636881864",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0fb50734c39919768ea68b86ca5aac9e363b77a4",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/0fb50734c39919768ea68b86ca5aac9e363b77a4",
      "created_at": "2024-07-24T22:12:22Z"
    },
    {
      "event": "referenced",
      "id": 13636881892,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k3k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636881892",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "ec5f45b9186184cac9c64ed08b8b8cc596e301a3",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/ec5f45b9186184cac9c64ed08b8b8cc596e301a3",
      "created_at": "2024-07-24T22:12:22Z"
    },
    {
      "event": "referenced",
      "id": 13636882043,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k57",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636882043",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "257cc06e875845322caf9fb3738c202b2ce18284",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/257cc06e875845322caf9fb3738c202b2ce18284",
      "created_at": "2024-07-24T22:12:23Z"
    },
    {
      "event": "referenced",
      "id": 13636882079,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAMs0k6f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13636882079",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "35b80d22602ca7346c21fe52509b1aabc31041c8",
      "commit_url": "https://api.github.com/repos/ryanofsky/bitcoin/commits/35b80d22602ca7346c21fe52509b1aabc31041c8",
      "created_at": "2024-07-24T22:12:23Z"
    },
    {
      "event": "reviewed",
      "id": 2199367930,
      "node_id": "PRR_kwDOABII586DF7D6",
      "url": null,
      "actor": null,
      "commit_id": "e367258c9b37f0494bdc9d36a6a48adb62f9c94f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review e367258c9b37f0494bdc9d36a6a48adb62f9c94f. This is a nice change, but I didn't ack because I think it would be a regression to not signal g_best_block_cv on shutdown. I posted other suggestions to consider too but they are not critical.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2199367930",
      "submitted_at": "2024-07-25T14:47:13Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13846147350,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5S3EW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13846147350",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T10:46:04Z"
    },
    {
      "event": "commented",
      "id": 2283641349,
      "node_id": "IC_kwDOABII586IHZoF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2283641349",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T10:47:33Z",
      "updated_at": "2024-08-12T10:47:33Z",
      "author_association": "MEMBER",
      "body": "Rebased and restored signalling `g_best_block_cv` on shutdown.\r\n\r\nI created `interfaces/types.h`, moved `BlockKey` there and renamed it to `BlockRef`. I then renamed `getTipHash()` to `getTip()` instead of adding `getTipHeight()`. `waitTipChanged` also returns a `BlockKey`.\r\n\r\nAddressed inline comments, except that I still need to look into the tests.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2283641349",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "commented",
      "id": 2283747278,
      "node_id": "IC_kwDOABII586IHzfO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2283747278",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T11:43:21Z",
      "updated_at": "2024-08-12T11:43:21Z",
      "author_association": "MEMBER",
      "body": "As for race conditions with RPC calls that rely on `waitForBlock()`: \r\n\r\n* `waitforblock [hash]`: the while loop breaks if `block.hash == hash`, which together with the early return inside `waitTipChanged` should prevent any blockage\r\n* `waitforblockheight`: similar to `waitforblock`, the while loop checks `block.height >= height`  \r\n* `waitfornewblock`: I opened a draft PR to add an optional `blockhash` argument #30635",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2283747278",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849171089,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5eZSR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849171089",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:34:00Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849201317,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5egql",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849201317",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:35:35Z"
    },
    {
      "event": "commented",
      "id": 2284019673,
      "node_id": "IC_kwDOABII586II1_Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2284019673",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:37:37Z",
      "updated_at": "2024-08-12T13:37:37Z",
      "author_association": "MEMBER",
      "body": "I simplified the `waitforblock` and `waitfornewblock` tests.\r\n\r\nThey're not very thorough at the moment, because `reconsiderblock` is either atomic or too fast. A better way to test the asynchronous behaviour would be to spin up a second node, and feed it blocks through `add_p2p_connection`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2284019673",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13849606085,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM5gDfF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849606085",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:22Z"
    },
    {
      "event": "commented",
      "id": 2284064523,
      "node_id": "IC_kwDOABII586IJA8L",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2284064523",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:27Z",
      "updated_at": "2024-08-12T13:57:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/28654787886</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2284064523",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "labeled",
      "id": 13849607248,
      "node_id": "LE_lADOABII586O0lCbzwAAAAM5gDxQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13849607248",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T13:57:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2233198217,
      "node_id": "PRR_kwDOABII586FG-aJ",
      "url": null,
      "actor": null,
      "commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review dcf984b055a367facf7704eb8055619d6fe64a55. I think there might be an infinite loop bug if waitfornewblock is called with timeout of 0, and it looks like there are some other quirks. Left a few suggestions below.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2233198217",
      "submitted_at": "2024-08-12T16:02:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "unlabeled",
      "id": 13851639694,
      "node_id": "UNLE_lADOABII586O0lCbzwAAAAM5nz-O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13851639694",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-12T16:11:00Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13860840000,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM6K6JA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13860840000",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-13T09:52:49Z"
    },
    {
      "event": "commented",
      "id": 2285847403,
      "node_id": "IC_kwDOABII586IP0Nr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2285847403",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-13T09:53:38Z",
      "updated_at": "2024-08-13T09:53:38Z",
      "author_association": "MEMBER",
      "body": "Re https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713879417\r\n\r\n> it looks like this will wait 1000ms+1000ms instead of 1000ms+500ms\r\n\r\nIndeed it seems to pick the wrong wait time after the first inner loop. If fixed that and the overflow, though in a slightly different way than the AI overlord suggested.\r\n\r\nI also added a `g_best_block == uint256()` check because it starts 0 until the first `UpdateTip()`.  \r\n\r\nChanged current_tip argument to `uint256` instead of `BlockRef`.\r\n\r\nI also added a commit to recommend `-rpcclienttimeout=0` for these three calls.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2285847403",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "referenced",
      "id": 13863885729,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6Whuh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13863885729",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "2cff4416949931f384e8096b83366eaf3246ed65",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/2cff4416949931f384e8096b83366eaf3246ed65",
      "created_at": "2024-08-13T13:48:11Z"
    },
    {
      "event": "referenced",
      "id": 13866738365,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6haK9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13866738365",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "0fc045978ea671fc2b9b48c4bc3f20a206372b40",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/0fc045978ea671fc2b9b48c4bc3f20a206372b40",
      "created_at": "2024-08-13T17:16:33Z"
    },
    {
      "event": "referenced",
      "id": 13866827551,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6hv8f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13866827551",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "1758b5d2b4665b6229fa5e90eefa8850b15c39ca",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/1758b5d2b4665b6229fa5e90eefa8850b15c39ca",
      "created_at": "2024-08-13T17:24:30Z"
    },
    {
      "event": "referenced",
      "id": 13867417207,
      "node_id": "REFE_lADOABII586O0lCbzwAAAAM6j_53",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13867417207",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "27630ec52409b4088bb5c57631fd5f8dddabe531",
      "commit_url": "https://api.github.com/repos/Sjors/bitcoin/commits/27630ec52409b4088bb5c57631fd5f8dddabe531",
      "created_at": "2024-08-13T18:17:35Z"
    },
    {
      "event": "reviewed",
      "id": 2242860642,
      "node_id": "PRR_kwDOABII586Fr1Zi",
      "url": null,
      "actor": null,
      "commit_id": "9ba60b3a2c22dcd1c9e7b4880f0adb678e4e8d63",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK 9ba60b3a2c22dcd1c9e7b4880f0adb678e4e8d63. Just fixed a few bugs to make waiting more reliable since last review and changed test logging. I like the new change to check for overflows generally in waitTipChanged, instead of just checking specifically for the max timeout value. That was better than the suggestion.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2242860642",
      "submitted_at": "2024-08-16T15:28:41Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13926000264,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM-DeaI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13926000264",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T07:27:31Z"
    },
    {
      "event": "reviewed",
      "id": 2245487748,
      "node_id": "PRR_kwDOABII586F12yE",
      "url": null,
      "actor": null,
      "commit_id": "d880419cb65fd9d446057ea05384dad55da0f292",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK d880419cb65fd9d446057ea05384dad55da0f292. Only changes since list review are documentation improvements and a small code simplification.\r\n\r\nOverall this PR makes nice improvements to the waitfor* RPCs and simplifies the code getting rid of boost signals and a global variable.\r\n",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245487748",
      "submitted_at": "2024-08-19T13:08:42Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13931210441,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAAM-XWbJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13931210441",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T14:15:43Z"
    },
    {
      "event": "reviewed",
      "id": 2245698982,
      "node_id": "PRR_kwDOABII586F2qWm",
      "url": null,
      "actor": null,
      "commit_id": "e8176694bb5508b2b488a8c79a6001d2fa625302",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review ACK e8176694bb5508b2b488a8c79a6001d2fa625302, just reduced a variable scope since last review.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2245698982",
      "submitted_at": "2024-08-19T14:27:51Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "reviewed",
      "id": 2254595107,
      "node_id": "PRR_kwDOABII586GYmQj",
      "url": null,
      "actor": null,
      "commit_id": "e8176694bb5508b2b488a8c79a6001d2fa625302",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2254595107",
      "submitted_at": "2024-08-22T13:58:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDllYjAxNWU4ZmNlNDA4ZWZlYTQ3ZWFhMDRiZjA2NmQ1ZDc5YjAyODM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9eb015e8fce408efea47eaa04bf066d5d79b0283",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9eb015e8fce408efea47eaa04bf066d5d79b0283",
      "tree": {
        "sha": "8125baa65385aaf5e0ab4739dd90c4ab2e80c724",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8125baa65385aaf5e0ab4739dd90c4ab2e80c724"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8125baa65385aaf5e0ab4739dd90c4ab2e80c724\nparent 6d546336e800f7b8990fececab6bc08413f28690\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723453739 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724664923 +0200\n\nrefactor: rename BlockKey to BlockRef\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMTFsACgkQV/+b28ww\nEAn5Qg/+NqvqdOg3YZVXvAaejY5CVwwczOBU035PRf3eODtPmmcy76RLo2Vbdcr+\n/gsDIdZzURR2uw8lcgQs3XCSUNp1zIoPRVKQih8EAKhTNbwMQzCC6IGPSpr5Jcda\noWj+VD1z2BatSNTcM7YXoEHqTDQFgXy5qbbLxOXnSY1ivV1ry7FzyMnXWMk8MC8w\n31Vap3xnH56QnZKVah+sKyJEKdMWo+OyG5Euv9NqmwLlvf4av+1ion5orkNbzDXU\nEwUWf2/kwz8llfyaFKaSG/yKJMvp7uGKg7j1Z8PAPd91PrEYq7OkHnYUjxBWj33M\n+jtnKYzS6E0coqJWlLK63P6n4g/iVVdWei46+o9KyDdL8Z4t8RRQP+Cx9ezaxq4n\nNysmgF3DtO8QXmT9u15ypIo1bLxr4Hsqex0q0Yn+71fnTNweXe8Nc0ewkp87gnis\nEH/S5PFrl/At1/USLgMQ57R/W7m3n5ruKEpMG8TnXauid58PiOAgoQsTbZ9O39MM\noj6JjFs8+sLkK8yPhVIdWL1T2knZcfDeT0YgUoXXA32QW4E6C4OSrU1QPhyvP7LC\nE1/NTIrLEUexr8CtbaEIb7LsWi1QDBXbehd8CyREo332GRW4s7jOtX+44RaP4MSU\nhSDLekehrVHp2g2CtVfr8E+LiCs8Xmy2ENFe5glGUCBldSFoW+Y=\n=/OnM\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6d546336e800f7b8990fececab6bc08413f28690",
          "sha": "6d546336e800f7b8990fececab6bc08413f28690",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6d546336e800f7b8990fececab6bc08413f28690"
        }
      ],
      "message": "refactor: rename BlockKey to BlockRef",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T09:35:23Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-12T09:08:59Z"
      },
      "sha": "9eb015e8fce408efea47eaa04bf066d5d79b0283"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5YTBlZTUyZmUzM2M3ZmU4ZGNmNWU3MjM1MTBkYmMzYjkxNTIxOGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c",
      "tree": {
        "sha": "268fc62f05df6d567bc877bd49af237cc5f1076f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/268fc62f05df6d567bc877bd49af237cc5f1076f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 268fc62f05df6d567bc877bd49af237cc5f1076f\nparent 9eb015e8fce408efea47eaa04bf066d5d79b0283\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720458491 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724664923 +0200\n\nRename getTipHash() to getTip() and return BlockRef\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMTFsACgkQV/+b28ww\nEAkEYg/+I/Xo3AYxed07P3+AqaeYc03sV6OZpLheFpKVCPffm7hAKE47J2ODyhhO\nGx0Ecw6+vPnh17+cbcFk46HEYpnTVS/mDnjk4ka8Ngbs7H9ZpcESDGsMJ/aqVwyt\nwbi/mkHynxZC8WyBdW5LlLdw2uFgPCEjgz0h0ZLojcmOi8dHv+TJmBzeFInKsHHB\nCDZUyDSL3EWU1dY3lQ4iAVho0PxrxONIdUiFycBbE20+CyHs89NzvgmVWd5Yybj7\nToeFjLg/wmBqDZcObSNLezD3NPK4MbIa1NHTCXEu9HlfZx4lOOr8w62SqkRqRnQu\n2HoSBDtXO7FVfuadfhXhBRFDXykNTdKG5tot1YBayXAFjFzvnONCqNBVCcBV5B5W\nPDGtr4q22VFOHY4jKHk+z2CxZu4P3rblk/R2ggSA/jDp38q73V+xY74CVZHvm7gE\nSvXzgM4OJDeBrDRsIt0/nSdXgTG6QIvQm8zIRElYsFYyQTRKYPfo23wbbPojs3hG\ncpLfMepFoBsrQJ1pixglLQSIB/mOGpLtT1w4rxsrSXUHLiO1j9JUJFPiHBbrM4XY\nx/4nhDHOlDkdQ94o8dyyehyYJ4SMZnA1LYHbzfvcCBYW/FyqmIKUtCXloCb2FfuJ\nLhgonierq5D/xr2xgXoVjZlpRpZW/BRP4uNbpcmaSxm2MGMxi04=\n=765x\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9eb015e8fce408efea47eaa04bf066d5d79b0283",
          "sha": "9eb015e8fce408efea47eaa04bf066d5d79b0283",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9eb015e8fce408efea47eaa04bf066d5d79b0283"
        }
      ],
      "message": "Rename getTipHash() to getTip() and return BlockRef",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T09:35:23Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T17:08:11Z"
      },
      "sha": "b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14010839011,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDHG_j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14010839011",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:39:09Z"
    },
    {
      "event": "commented",
      "id": 2309786222,
      "node_id": "IC_kwDOABII586JrIpu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2309786222",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:39:12Z",
      "updated_at": "2024-08-26T09:39:12Z",
      "author_association": "MEMBER",
      "body": "I incorporated https://github.com/TheCharlatan/bitcoin/commit/3c665065f132fd80ea3b1733785b98e45c8b371e so the `waitTipChanged()` implementation uses the kernel signal instead of `g_best_block`. Also rebased.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2309786222",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14010935562,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDHekK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14010935562",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T09:46:55Z"
    },
    {
      "event": "reviewed",
      "id": 2260994997,
      "node_id": "PRR_kwDOABII586GxAu1",
      "url": null,
      "actor": null,
      "commit_id": "93176016322687f3ad9ade8f32c1ff1392ee6470",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Code review 93176016322687f3ad9ade8f32c1ff1392ee6470, but I'm concerned code is failing to signal m_tip_block_cv on shutdown so it could make shutdown slower. Suggested a fix below. It also seems like it would be easy to eliminate g_best_block completely, so suggested a way to do that too.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#pullrequestreview-2260994997",
      "submitted_at": "2024-08-26T15:46:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGViNTZlOWE4MTlhMmFiODE5M2Y5NjIxOGJkY2QwMjlmNDczYWUyMjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb56e9a819a2ab8193f96218bdcd029f473ae222",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/eb56e9a819a2ab8193f96218bdcd029f473ae222",
      "tree": {
        "sha": "a6e554520c4c0cdfac310d2624e913887c2435c8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a6e554520c4c0cdfac310d2624e913887c2435c8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a6e554520c4c0cdfac310d2624e913887c2435c8\nparent b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724688968 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693097 +0200\n\nnode: Track last block that received a blockTip notification\n\nAlso signal m_tip_block_cv when StopRPC is called, for\nconsistency with g_best_block_cv. This is handled in\nStopRPC instead of OnRPCStopped() because the latter\nis deleted in a later commit.\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMunQACgkQV/+b28ww\nEAlscBAAs/27DR4NNYJHHYd7DQzdeZ7n+7cfHMjdcH6d1Tt8iC/zIQXz3CLkNWKT\ns++f2Rk+r9NQyRUsCBRrEBOlBvorFhNtWl++ZZqc6q8tsKOHirEvg7Y7cQM2etnv\n5MeB1FceABRO40JUL4kRBxsW7IUYKdlU1pznXfARWYYSCij7pXL+FpzhZ9fxEMwm\ntUHFlT5UDGsZW/jWP1NL2VBHFOuly28A+J1ZQi2o/Tjrkavvth4Qb9aB27/pU2M0\n+ngI+PK+UnMlgnxrXrihpfS8ddXE/FmbKLua8XSL+lTX6aHK4l5KT+k8gHRtAGNe\nASrrnO4lEP7JbHujPwprOJVSbjTAKtIy4jRL3hfIOU/N17d5LYi/9a4ZH3zk39dn\n2S7ohlwGsk6QfiwTxv5qhobmxHha42LV2SUCMgHAF3WF18BOAoQ5fVhlvxvt/i5e\nkasz++rXRKtMI9pIMiV9FHf6qp/XKtgQyeJuGFNKPckX5LIloqGgViCHbYCB5YRN\njyRQzYja1jxS1giOkfLqoD7kZERUcN/hyyxfRL79pI5CmO1+eHafVyhip3C34+JO\nbGrbAiGdJMZcKarcTnpzk6NJlDKcYrY2wtktfkMx1RxVCs/PPq4TisNXN1p1eRQT\nfe+4fFQqLDjXsKulXZvgIZ9UraQ+2XRNmom0F3dHeq0s7hrDYrw=\n=fcxf\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c",
          "sha": "b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9a0ee52fe33c7fe8dcf5e723510dbc3b915218c"
        }
      ],
      "message": "node: Track last block that received a blockTip notification\n\nAlso signal m_tip_block_cv when StopRPC is called, for\nconsistency with g_best_block_cv. This is handled in\nStopRPC instead of OnRPCStopped() because the latter\nis deleted in a later commit.\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\nCo-authored-by: Ryan Ofsky <ryan@ofsky.org>",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:24:57Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T16:16:08Z"
      },
      "sha": "eb56e9a819a2ab8193f96218bdcd029f473ae222"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZmMDU2MzYwZDIwOTIxMjE2OWJhOGEzMGMyZjM5YTUzMDU3YjEyNjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ff056360d209212169ba8a30c2f39a53057b1261",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ff056360d209212169ba8a30c2f39a53057b1261",
      "tree": {
        "sha": "41e04e2799405044f2ec615b2e3a1a3030806054",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/41e04e2799405044f2ec615b2e3a1a3030806054"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 41e04e2799405044f2ec615b2e3a1a3030806054\nparent eb56e9a819a2ab8193f96218bdcd029f473ae222\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724664624 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693120 +0200\n\nAdd waitTipChanged to Mining interface\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoAACgkQV/+b28ww\nEAlKmA/9GzpEqm4xsTGIPMOvngGnmxwt8V3jb8vlC7Ih/zSec9VloDPrPVXz9mwK\nSQDQxaQoYKjwtasXb2ng9KcJEmQ6re1YoRELwtw4Hy4DvrPWg1l1b/7FWhEyfBVg\nuqtROPnUukSCAlpCuUVBnP7D+f8evUv03KklQv0ikbWchhpX238GJbdorTsG7cPy\nw1KXHPMaa0MVGBBk4LqdjqErflwqIq4p+0s+UR5wsMHJo2MZvreZF2PTBJzhJu6O\nIodr/efbBf/dwNJoemI11IqklxKzehj87NRWxMovnrd6yGcf3Y6Ikbp2sRl4VyCY\nlWG8UXig6vKWLOxTacp8nr5+Nwew4nEARiOxH0AjR1hQPpgrzuYj7mEwmAsIdWRG\nwbGpQkZx4s5m8QxfXFbUfaxbanSdnq1e4Rfss32bcQe4/N8XYRdVk81SRhX5ZMce\n/udsGgJMhxChyvuDRtMph6d+0PZ5AoiJwDhmT9jvJXbgnnrVlQgXBC/tFjHWnVmE\n2JWbAnVvtAZOMGrxl7QjgikN4xN/Xm7tdBGtg/FqHeYknnuzIxYPDsgj6IgW9a+m\n7QSzaohVrUxMSaHlRQIM1yyTlDfENpsFCTUl0RrhUC1Bf5i4fIA0BgTpz/b7rnvK\necswhAiZCnMI9+LEGCiLNywiTubJ4wYB3IJkqMZZbIkfR0DDkHw=\n=8maG\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eb56e9a819a2ab8193f96218bdcd029f473ae222",
          "sha": "eb56e9a819a2ab8193f96218bdcd029f473ae222",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eb56e9a819a2ab8193f96218bdcd029f473ae222"
        }
      ],
      "message": "Add waitTipChanged to Mining interface\n\nCo-authored-by: TheCharlatan <seb.kung@gmail.com>",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:20Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T09:30:24Z"
      },
      "sha": "ff056360d209212169ba8a30c2f39a53057b1261"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI1N2Y1NmM5NzBjNzdiMGM5ZWM5M2VkNDIzOTcwODM2Nzg2ZDlhMzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/257f56c970c77b0c9ec93ed423970836786d9a36",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/257f56c970c77b0c9ec93ed423970836786d9a36",
      "tree": {
        "sha": "f14e82348d5458e07b66cf4042d36eec9b767914",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f14e82348d5458e07b66cf4042d36eec9b767914"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f14e82348d5458e07b66cf4042d36eec9b767914\nparent ff056360d209212169ba8a30c2f39a53057b1261\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456321 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693121 +0200\n\nrpc: add test for waitforblock and waitfornewblock\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoEACgkQV/+b28ww\nEAmHiQ/7BAHb9XNeYyUnhEK1k3Tp4ieIKDz6/mHp0+IlEr0SyXAkVH8lOpYCI25n\n3mprsHdZsX3wwtxpR/DCXP9igxqaizlcq1uIY26+WpKUmy30M/R6XSarnDsQonDD\nzEerGHVxcOl5a2ixNfnvb+1ITBbxepDOL70pi/bXHiq/1rEWQH/7+jnmAmHbz2VU\nUYqmEGxT7E044VJnXJbmB6GEhjFxx/Co7DXaPhNqPgZIcMDYo2xGEpcaB/n6A7ea\nZTcMvahxNjG0s4LVXsbxsSABU7i++SMPZw+83I/Cb45U6cPSdNRRAw5l36dZSJc1\n3TKY38mMuNdT6+rbJZn4+ZIi+51LyIhwLGdNrNqbDNSOfVRV+L016Ok5W5U42TAW\nw6pok6NElKSqKti0o8MmIs2DFdcJmixi2HDPU+ih5fGz9mmXcUcSQtEDd3yj/7gc\nB1pdnTCKVMKI06GmIG2pcti1hXjqZ6g+T/b/MkyExzN+A6KBzZOwc+su1PqAqQ4K\ny9CzA7VxmFuB36rhwPNiaTpb9qdY3rJ/wRwcLXTDnVcXJjjbHjGcN08TfgYtQRyu\nZySTJ/ZaEjqNW4r9CHInSN0W56/x4SHYuVJVbUbdOOI0PZ/odk8yYH/da9s/WJnC\nc/dc4edrKMb4v6+FN2JaonWCefEkiVhaJkR8tNKYl76XPiY3/yk=\n=3Tq2\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ff056360d209212169ba8a30c2f39a53057b1261",
          "sha": "ff056360d209212169ba8a30c2f39a53057b1261",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ff056360d209212169ba8a30c2f39a53057b1261"
        }
      ],
      "message": "rpc: add test for waitforblock and waitfornewblock",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:21Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:32:01Z"
      },
      "sha": "257f56c970c77b0c9ec93ed423970836786d9a36"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFlMDVjNjBlZDk2MjMyYTNhMzUyNjgzZDkyN2VlZTQwNWI5OTZlYzA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae05c60ed96232a3a352683d927eee405b996ec0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ae05c60ed96232a3a352683d927eee405b996ec0",
      "tree": {
        "sha": "3fdb71a1f121b6aa1e5f92b4477207bcae019fd7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3fdb71a1f121b6aa1e5f92b4477207bcae019fd7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3fdb71a1f121b6aa1e5f92b4477207bcae019fd7\nparent 257f56c970c77b0c9ec93ed423970836786d9a36\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456659 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693121 +0200\n\nrpc: fix waitfornewblock description\n\nThe waitforblock RPC method takes a hash argument and waits for that specific block.  The waitfornewblock waits for any new block. This commit fixes the documentation.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoEACgkQV/+b28ww\nEAlH4BAAgfe7hyaolkX9HysDwCwx7T4VAXUm+yb5KmdxfkShcAYSoSgq3ZTAYonc\nhb4a38R4PGFvmXssXkgI+vcpLG/zMaO/fYgQW6eolTGg9cP5W3UtXd47ea3ivgxv\nNfO8FCVzMHbb1Mu0Rv1iA4MfPHXeKDQ8VRy4/lm+qnBuV+hvKFch1+Q5neymQX73\nB8Gc7qZ8p4O3nHHGy+r5prICng1uK5qGBaCP5XF62sm71lcMzY0fz3N2yqaJ1Ts6\nXa5d5wQheNTAG/sjhyf3PiwV6YkJ6tN1WDCRdtO6eeexxB7SDhw6Sh25ttTvX/An\nlMhV4kTB4LXkacOGeTsj/vo6hcHBQ0wjrlHQJDEKXG0Nfn7ZBOrXsG4yXis/K7jH\nBZtujN4WuDcNm9IXqebfQVWqleELFKVZ5weh2xr7o1po4ihVNJKqvLcN0dz1ypb3\naP2eE4L1gGXShqa8Lz/08/JVtvoYsSprJ/DoWLo4eI3zSt9niSBr2X/7lfVkgdBm\ntXqzqQPxzz5RKoSI33By6YoaXhcxxgTdUbnZvzF8yT/cPJE30wiEB4B+CbFacRsY\nWrJGEvBJWwXzO6QwuqVDQUQ2d65nOFzyU0VcuF+vQE8vtEA9UDTneMGPqjFLFek1\nCj0yy+pjj5y+UvyRP0KS3QREelqmUc/GJ/RRCou/WoA+uy1Vy5w=\n=HED1\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/257f56c970c77b0c9ec93ed423970836786d9a36",
          "sha": "257f56c970c77b0c9ec93ed423970836786d9a36",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/257f56c970c77b0c9ec93ed423970836786d9a36"
        }
      ],
      "message": "rpc: fix waitfornewblock description\n\nThe waitforblock RPC method takes a hash argument and waits for that specific block.  The waitfornewblock waits for any new block. This commit fixes the documentation.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:21Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:37:39Z"
      },
      "sha": "ae05c60ed96232a3a352683d927eee405b996ec0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGZkZWI5YjJiMjRlMjEyMmI3MmNmYjkwZDk4Y2Y4NjVjMTJiODhhMDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdeb9b2b24e2122b72cfb90d98cf865c12b88a08",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/fdeb9b2b24e2122b72cfb90d98cf865c12b88a08",
      "tree": {
        "sha": "5080e25e706d63940806fa16d5cbfe7e78c7fc07",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5080e25e706d63940806fa16d5cbfe7e78c7fc07"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5080e25e706d63940806fa16d5cbfe7e78c7fc07\nparent ae05c60ed96232a3a352683d927eee405b996ec0\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723542686 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693121 +0200\n\nrpc: recommend -rpcclienttimeout=0 for waitfor*\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoEACgkQV/+b28ww\nEAnknw/+OKRtKtSELAzcenzHks6Nw+HTH1kDZhCoIweqSp7Mf5imJdWzc/6uEq29\nJxmm1WpmQDV6F9EpEll8xjrZOZ/bRqnORLdtsrYeSvmBZNG90JS9echX0QaDwXaE\nGX/XtlmFHGiT/Jig2xe5hwNJZhJQ05nTQZL8wpfXuLc1uAZi3Zo18GcTrB07L4mK\n4e4fCot4Bj7eOheuPeS4Msq5nON3I9iG4QRD7WXOzxl0dSapcLQyd/RJruNHEqOs\nu+jaomOBq7pbF8y2p4HV6FZYEG2qKi3jbK5TcobTqu1vR53X2mzKCn3goIA1vvEO\nMe3THoBsRxXe4uk0ogXMubka3KATfsadOWKgTPk2P/C4nZQbBEnF00uwup1PkaIO\nt7M1SvWRM5JYFT3OaO1HEZZS9Ht1ZMNI4J5D8FVNbkkx3yAK9zG/PlY8wghEMZv8\nHibAiB/nlyqhj027+5TkKBfQVLLFzq6J5QG2zXz5hTrBTOO1bZmdqlCoiskLceCR\nU0yGqREeYuB0UrLbVKhOlXdBJsD36QJDFxc3ObXopyPVLRFccjLOmY+7oUBNGI0f\nAwPJjVqScscPgkNEhKdA2B9ag+01IBvLDUf9ZYs08gxSqgMCcFfWk91r+5WDJDT2\nSD1GipxJ5N3+JHLbJDTcVfTBFsW4E4l8evR9HNVU/DnarEu62ZI=\n=3xkR\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae05c60ed96232a3a352683d927eee405b996ec0",
          "sha": "ae05c60ed96232a3a352683d927eee405b996ec0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ae05c60ed96232a3a352683d927eee405b996ec0"
        }
      ],
      "message": "rpc: recommend -rpcclienttimeout=0 for waitfor*",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:21Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-13T09:51:26Z"
      },
      "sha": "fdeb9b2b24e2122b72cfb90d98cf865c12b88a08"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg2YjgyNTQyOWQ5YjYyNDQ0OWFkYTdlYzAyOWEwNjMwZTg2NDY1NDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86b825429d9b624449ada7ec029a0630e8646540",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/86b825429d9b624449ada7ec029a0630e8646540",
      "tree": {
        "sha": "c0ab8f61a3676870e5291c8cb6a13af4a0a91998",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0ab8f61a3676870e5291c8cb6a13af4a0a91998"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0ab8f61a3676870e5291c8cb6a13af4a0a91998\nparent fdeb9b2b24e2122b72cfb90d98cf865c12b88a08\nauthor Sjors Provoost <sjors@sprovoost.nl> 1720456771 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693121 +0200\n\nrpc: check for negative timeout arg in waitfor*\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoEACgkQV/+b28ww\nEAleYBAAraeyenL5tExLq+AopRaDczunxAYRIrTFX9lMXP2LDgaUg382AeMnk21o\nNh2qd8z50s0Tj6w+LC+0PPru4xJGB4YsYOu+yVyDE5ByIBXDYrbTvXlJ7lWYW4Ux\nwReT8GJgB8CYTk5pzNirRyQewtvwPSFAeI6UXjRi7dubIcXc99hXH1/Dm/mCVDz7\nX9U0tMa4dtXripJ4hZ9ejUPidHbzFnovsxok00Frh75z2CGVzhA8nYGZZVM0pzxs\ntMPzCrYKQiHa+yyTat7Gh0LjPVFdE3tWXXuTwDRjr5uM/pTfFUYtMT+4z5h3kl3O\nTNEY3LoCxpgINf4yk7Q2Ltr7NqIIqIQb6a6lhkWHWEd9aITUgMHqg2YvQGaxuFnw\nJQSzQ2Bv5YMJJleJUU97pbHrlCrIpPUXIEaDl9aI0BYml0pY/xeT3QP1mo6pM0qb\nMBmnaph8A6qn/kPpKi3ysCYYzqGdJQqNZvqUzWccI6crYfczNd3MmLGnUzCOUzM+\npL+/2kdh/YgMbRKb6Xhw689KJaNDEFfYJCGeC5xu8aAhJ+36hGvOkGulxJMrhPDi\nW/3uhrNakQi8FDiuFXKtrWpE92h9ZmJ8jLFmmB9zD1XqoUd0p4ZI6Cfm32EHSJE3\nsUmkFbpa0KpLg0gJ/kAayj/1+Y7vp8sQldD+I47ecPeM3pIfknI=\n=0XUY\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fdeb9b2b24e2122b72cfb90d98cf865c12b88a08",
          "sha": "fdeb9b2b24e2122b72cfb90d98cf865c12b88a08",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/fdeb9b2b24e2122b72cfb90d98cf865c12b88a08"
        }
      ],
      "message": "rpc: check for negative timeout arg in waitfor*",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:21Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-07-08T16:39:31Z"
      },
      "sha": "86b825429d9b624449ada7ec029a0630e8646540"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIxZDMxZjA2YzJiMGFiYjFhMzA1NGM3N2U0MjE4ZDQ2ZDhhM2ZiZDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1",
      "tree": {
        "sha": "671b1319d8c343eaa60e992ca3afc9c83322d36d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/671b1319d8c343eaa60e992ca3afc9c83322d36d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 671b1319d8c343eaa60e992ca3afc9c83322d36d\nparent 86b825429d9b624449ada7ec029a0630e8646540\nauthor Sjors Provoost <sjors@sprovoost.nl> 1723459009 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693121 +0200\n\nReplace RPCNotifyBlockChange with waitTipChanged()\n\nThis refactoring commit uses the newly introduced waitTipChanged mining interface method to replace the RPCNotifyBlockChange mechanism.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoEACgkQV/+b28ww\nEAn0UQ/+IL8mNYU7skLNw9X3UYet/wuV2o8r4W3zQMj8CFXFanidS+jRY/eM18ES\nNUD1yoMtRTgruweC9BA+7bLfgVEB0nxxgnfx1lFGfH2YBVnu4XFGY/BiffxBOTYR\n6bAYKbEcAPlazFC9tx2JOEx2q0tOJS7OH0BptMIrK5I9VgY+axIjZmIy2b9Pxb6v\nkyYGIc+a3JQnh2kpYO1drjxVDt4eTidbHPC2Zq4A5UT34ZRfC6ZO/JP19T+SQUYK\n/O0dl0wWRTVyfTP6o6m2m18Ogho/i4Ue96XOE+AU4jBKvAbXpqhCcfAWp7zz0bBS\nOTn8qkkvoC12jSbSv7SeeSoKkRkNKkMwm6ppqs+q1hW6epzaEY3Lvba/+MIe7Gaa\nTSP3LnMqSX53lrB3SE67QAsEnR/FafJTDp8F++zt6wE2socIYXzmoUU1fiZrrmsr\ntFiwX+7TA49tMPOvMBV9aUqpbXeELeFiPB3zu1jiOIyPlgSF0pHb9mlIHweHIcHd\ncuXCLW+tRDS4Ig6m4D0sKRRy8f3y6EMWpSm/nkkTs1DO1cKZEovLI9T6hi/C3JLu\nKw+choM90EjeMWzRwXiJNfx7w5aPFvUj8gaBxEtMaEa0t8uXnkCwXmbECz/JcfEz\nUlwUdqpSVPw+ZvbE/iiNUBzGGcMC7Qv5arhjJ2sCs/HK1qWykLM=\n=+xg+\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86b825429d9b624449ada7ec029a0630e8646540",
          "sha": "86b825429d9b624449ada7ec029a0630e8646540",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/86b825429d9b624449ada7ec029a0630e8646540"
        }
      ],
      "message": "Replace RPCNotifyBlockChange with waitTipChanged()\n\nThis refactoring commit uses the newly introduced waitTipChanged mining interface method to replace the RPCNotifyBlockChange mechanism.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:21Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-12T10:36:49Z"
      },
      "sha": "b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUxYmNmNTA3YzQwMmIzZDhiYzU1NzI5N2E2ZGUxNzc2ZDk4YjE5MDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51bcf507c402b3d8bc557297a6de1776d98b1901",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/51bcf507c402b3d8bc557297a6de1776d98b1901",
      "tree": {
        "sha": "aff9b74a7e00a16454d2211e1557cf0db351d47c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/aff9b74a7e00a16454d2211e1557cf0db351d47c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree aff9b74a7e00a16454d2211e1557cf0db351d47c\nparent b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1\nauthor Sjors Provoost <sjors@sprovoost.nl> 1724689555 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693122 +0200\n\nRemove unused CRPCSignals\n\nThey are no longer used for anything since RPCNotifyBlockChange was replaced with waitTipChanged() from the mining interface.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoIACgkQV/+b28ww\nEAn78Q//Te5YrDUlZbQ4TIlGLn/8CWyiorSWMFJDCHmNjxKJBs1OVmC+B1zqDUo9\nbAtGA1n37OIkUlE+GDbDFE3cY/g/cNMvcSe+Zo1HiPqEXBY8/GGVW71m4jzvaPKz\nBHhS2FDDQHwvkBZl0GXXn4cm3a+/ghYlmfn8SjuohOqGwiZMuGLqFOVyh5dNYYZA\njJL9ACew0GlJfhNFFczxRlPDWnIcKVWc7CbxuLTkklMnOJZY5NHOQjpo3NDpD2lw\nPntLSktUkSRECiEnmLwskVGzi6jZve76u3orlp/D1sFyeh9XdddsXjFURPM1afLv\n6iTSwyInczHKkf0GD95zM0tkoCrlI1YT87xtalfHQ172qfpfrd1VqLA01QdBLOhd\nULNKHBnlJcWpEUoP1ZFfTvw89K9xz3ghdzG4g3eoVebh//XCTqPoUI+iStgYkrwZ\nQBcT2XPliCmXukVMwwa1ec4mmnfX/6nsIPRvLEmxZSgCCwNoWfDa6YosL3Ev8Qpp\ncgno8J9nSIe2GEsGIazAVEENAoOwqZQDpm4zOm5fVn3axLdXEea0cdPZNEUfql4s\nogyyJ9JJ94Xqr8BpUEzx5wgt7iMEAUwLTI0ep5Ofu+uZ/imO4UPznTe1C6sqqMRs\nzR/R2cVULoH6Jpz1ZWnm07OkJdbJyt8faMTcdSV+nUm4T7vKIDU=\n=vK1c\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1",
          "sha": "b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b1d31f06c2b0abb1a3054c77e4218d46d8a3fbd1"
        }
      ],
      "message": "Remove unused CRPCSignals\n\nThey are no longer used for anything since RPCNotifyBlockChange was replaced with waitTipChanged() from the mining interface.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:22Z"
      },
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T16:25:55Z"
      },
      "sha": "51bcf507c402b3d8bc557297a6de1776d98b1901"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk2ODZmZTQxMDAwZTQ3NmVhYWVkMGJkNTRkMmJmNTIzZDc2MDg0MzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9686fe41000e476eaaed0bd54d2bf523d7608432",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9686fe41000e476eaaed0bd54d2bf523d7608432",
      "tree": {
        "sha": "866ae9b98d89feb89b160c46b95e49cb588c74fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/866ae9b98d89feb89b160c46b95e49cb588c74fd"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 866ae9b98d89feb89b160c46b95e49cb588c74fd\nparent 51bcf507c402b3d8bc557297a6de1776d98b1901\nauthor Ryan Ofsky <ryan@ofsky.org> 1724690116 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693122 +0200\n\nrpc: use waitTipChanged for longpoll\n\nThis removes the last remaining use of g_best_block by the RPC.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoIACgkQV/+b28ww\nEAnfag/7BSERQzlaPSBDSTFcIgIxZC++dh6kua9TnQGA17d7lQbwolwhlYKGTohS\nHty0WeOcwWL2rnan6WA4ZyVyrHXvMBz5V8BnTVdi0G331sVvQ97uqVhNoCRLkKYB\nC+9J6HRsKaklntdRGztki+ibD8rczqvScqdrF1pWd5DIwChpFmRezbo8zWLZJanp\nrKbRGAIGV9JV1FQSYYK9d+jhQ9k9bwlCM1UBHN5ms5I3UqajEGqGw3Tez+CYEvnB\nqbG6ASsHLPuMu/LIceOq/0wFcMET2UOcFHp0ujxOJ7SiW48MKvqAn2IFcI3hYe2h\nBZydgFqc7wbxv1s6ZVa/VQhWrrJ5RjKSt27cKaPfEZnUPtrfa9cze2A+OTiaQ5uu\ndMgp8m2FdL/CQwOnrclce6nLxpniwacdsDBJlRgKKF0OtjIntfCMSfidyZix9Uxl\nSYUcD27bC0SU2sRnT0+Pwjd3Ka4cARHa+uat4xXptpOwvz2GMTNH7eHlfvL9aQjW\nj7tqXxAtNj8GYXml1qajxBqnUq4+Qe005xdVU4/Bri868qeoeHmBuMaV8rESYrsU\nGRiMA+slYaPaK4sljlb8JJyAZK8/3KqWK4SnJq8YaYsfsvN6mAHTMjbU3TObMXBO\nhGuAU4UHzMGATIqf+UZ24X9lehAtqUkyqCi79owX9xvDaRZx52o=\n=xENP\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/51bcf507c402b3d8bc557297a6de1776d98b1901",
          "sha": "51bcf507c402b3d8bc557297a6de1776d98b1901",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/51bcf507c402b3d8bc557297a6de1776d98b1901"
        }
      ],
      "message": "rpc: use waitTipChanged for longpoll\n\nThis removes the last remaining use of g_best_block by the RPC.",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:22Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-08-26T16:35:16Z"
      },
      "sha": "9686fe41000e476eaaed0bd54d2bf523d7608432"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI4MDQ4NDgzOTU4MDVhN2FmOGNlMmMwYjZhYTI2M2JhMTIzOWY5MjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2804848395805a7af8ce2c0b6aa263ba1239f926",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2804848395805a7af8ce2c0b6aa263ba1239f926",
      "tree": {
        "sha": "7538ef42b6ee69381e0d9cf3248b6fb3050e50aa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7538ef42b6ee69381e0d9cf3248b6fb3050e50aa"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 7538ef42b6ee69381e0d9cf3248b6fb3050e50aa\nparent 9686fe41000e476eaaed0bd54d2bf523d7608432\nauthor Ryan Ofsky <ryan@ofsky.org> 1724689687 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1724693122 +0200\n\nRemove unused g_best_block\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAmbMuoIACgkQV/+b28ww\nEAn5fhAAwIFQlRgBMsdADSnGN05aMTkgNSzsm9rldQEdEFNX3WWxZgj98Z648pO1\nO17mIfJKSCeNNePUppDDizDsqZQqCmFHifo9wvGoPil2X0BHIPg6Fu6IGCUlm2jJ\nmUfNgVR3ExQfoWHTZtXsu59F1VRuQei6Vv152mrF6py2xCkXCoXIEjQDIt83mcK5\nEQOiCKtGVXc5P9hosMccLcv1POKvPiMireobKYy9qNj3HHtsLfh4eTsSzwqgiJzI\nYAb8Rxa1jxZ6r+XYXp2ZqK/t1cLQC/4jCIXJgtOollG2AO4gxXSxfSs6eP6UpnYH\noQirPjUrwEnl6JMtHHmyvG7qX7YkC73Bf6AlCduUZEz8wEYzPYkVQTF8+JqzYKIt\n/8uFPGlKmJsS/HcA73iGbqY7T1pjIeEjCbJFs3W5Dl9mex36gSqBFsH2FRG4gfcX\nd2ChkXMCm9EXx+OoglezpddSO2aQCBzzL8kV1sdd8m+PCoQh+3CTkydqUMyC9KGq\nAVMRESCeUiuqrCLqjLlzucF8qDRJ06l+e7Y7lGswpojM+CGS/iB69CHE36L+9zv0\nfc3A1pxQK1o34kzG/y6QnRK0fmvMiRSramfCsNL7vbTLj5mKuUbn7vhuLGFEZMfu\nvGvLTtg9ofhw/ZK9xsV4gRp9HKGEOJTNo5TTVQ73tLnpjZtovKA=\n=XVJu\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9686fe41000e476eaaed0bd54d2bf523d7608432",
          "sha": "9686fe41000e476eaaed0bd54d2bf523d7608432",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9686fe41000e476eaaed0bd54d2bf523d7608432"
        }
      ],
      "message": "Remove unused g_best_block",
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2024-08-26T17:25:22Z"
      },
      "author": {
        "name": "Ryan Ofsky",
        "email": "ryan@ofsky.org",
        "date": "2024-08-26T16:28:07Z"
      },
      "sha": "2804848395805a7af8ce2c0b6aa263ba1239f926"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14016648290,
      "node_id": "HRFPE_lADOABII586O0lCbzwAAAANDdRRi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14016648290",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:26:56Z"
    },
    {
      "event": "commented",
      "id": 2310705314,
      "node_id": "IC_kwDOABII586JupCi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2310705314",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:26:57Z",
      "updated_at": "2024-08-26T17:26:57Z",
      "author_association": "MEMBER",
      "body": "Alright then, dropping `g_best_block` as well!\r\n\r\nSome tests failed with `EnsureAnyNodeContext(context).notifications`, so I fixed that (relative to the above patches). In `init.cpp` the RPC server starts at step 4a, but the notifications are added at step 7. This case is hit by several functional tests that shut the node down early.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#issuecomment-2310705314",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30409"
    },
    {
      "event": "renamed",
      "id": 14016653544,
      "node_id": "RTE_lADOABII586O0lCbzwAAAANDdSjo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14016653544",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-26T17:27:22Z",
      "rename": {
        "from": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange and drop CRPCSignals",
        "to": "Introduce waitTipChanged() mining interface, replace RPCNotifyBlockChange, drop CRPCSignals & g_best_block"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1673937990",
      "pull_request_review_id": 2171768079,
      "id": 1673937990,
      "node_id": "PRRC_kwDOABII585jxkRG",
      "diff_hunk": "@@ -860,6 +860,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "in_reply_to_id": null,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I changed this in the last push, previously it would always wait for one second each interrupt \"round\" even if the requested `timeout` was shorter.",
      "created_at": "2024-07-11T12:35:15Z",
      "updated_at": "2024-07-11T12:36:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1673937990",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1673937990"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 879,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691480674",
      "pull_request_review_id": 2199367930,
      "id": 1691480674,
      "node_id": "PRRC_kwDOABII585k0fJi",
      "diff_hunk": "@@ -39,6 +40,15 @@ class Mining\n     //! Returns the hash for the tip of this chain\n     virtual std::optional<uint256> getTipHash() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 19,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nNot important, but it could be good to return [`BlockKey`](https://github.com/bitcoin/bitcoin/blob/5d280130446d57d653c749005a2e363265d87686/src/interfaces/chain.h#L44-L48) struct here instead of std::pair. Could also be good to provide a more consistent interface instead of separate getTipHash() and getTipHeight() functions:\r\n\r\n```c++\r\nvirtual BlockKey getTip() = 0;\r\nvirtual BlockKey waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;\r\n```\r\n\r\nIf you do use `BlockKey` here would suggest moving it from `interfaces/chain.h` to `interfaces/types.h`. Also I think I a name like `BlockId` or `BlockRef` would be better than `BlockKey` in this context, given other implications ofthe word \"key\". But feel free to move/rename/reuse BlockKey from chain.h here, or not.",
      "created_at": "2024-07-25T13:49:46Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691480674",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691480674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691492745",
      "pull_request_review_id": 2199367930,
      "id": 1691492745,
      "node_id": "PRRC_kwDOABII585k0iGJ",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nI think caller should be required to pass in the previous hash to avoid race conditions. Otherwise, the caller could initiate a `waitTipChanged` call waiting for the tip to change, and then it could change before this line is executed, and then the `previous_hash` variable will contain the new tip hash, and the function won't return until the tip changes a second time. This problem wouldn't happen if the caller were required to pass in the block hash that they think is the current one.",
      "created_at": "2024-07-25T13:57:02Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691492745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691492745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691499856",
      "pull_request_review_id": 2199367930,
      "id": 1691499856,
      "node_id": "PRRC_kwDOABII585k0j1Q",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));\n+                g_best_block_cv.wait_until(lock, check_time);\n+                if (g_best_block != previous_hash) break;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (4554b3b1adf678e17d479d72738f4f2089971c4a)\r\n\r\nIf you adopt suggestion above for caller to pass in the previous_hash value, you will want to delete this line and add `g_best_block == previous_hash &&` to the while loop condition so this function does not block if the hash is already different when it is called.",
      "created_at": "2024-07-25T14:01:37Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691499856",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691499856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691546813",
      "pull_request_review_id": 2199367930,
      "id": 1691546813,
      "node_id": "PRRC_kwDOABII585k0vS9",
      "diff_hunk": "@@ -505,6 +513,56 @@ def _test_stopatheight(self):\n         self.start_node(0)\n         assert_equal(self.nodes[0].getblockcount(), HEIGHT + 7)\n \n+    def _test_waitfornewblock(self):\n+        self.log.info(\"Test waitfornewblock\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PInterface())\n+\n+        current_height = node.getblock(node.getbestblockhash())['height']\n+        current_hash = node.getblock(node.getbestblockhash())['hash']\n+\n+        # Create a fork somewhere below our current height, invalidate and\n+        # then reconsider the longest chain.\n+        #\n+        fork_height = current_height - 100 # choose something vaguely near our tip\n+        fork_hash = node.getblockhash(fork_height)\n+        fork_block = node.getblock(fork_hash)\n+\n+        b1 = self.solve_and_send_block(peer, int(fork_hash, 16), fork_height+1, fork_block['time'] + 1)\n+        b2 = self.solve_and_send_block(peer, b1.sha256, fork_height+2, b1.nTime + 1)\n+\n+        node.invalidateblock(b2.hash)\n+        node.reconsiderblock(b2.hash)\n+\n+        assert_equal(\n+            node.waitfornewblock(timeout=2)['hash'],\n+            current_hash)",
      "path": "test/functional/rpc_blockchain.py",
      "position": null,
      "original_position": 49,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "a18cb7adf192bae481c879fe865f1c159b2b8622",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: add test for waitforblock and waitfornewblock\" (a18cb7adf192bae481c879fe865f1c159b2b8622)\r\n\r\nI don't think I understand what this test is checking for. Maybe there could be a comment that describes what the test setup is doing what a failed result might look like. It seems like it is just creating a small fork and then invalidating the fork tip, so it shouldn't affect the most work tip or current chain. I would expect to see wait_until call after the invalidateblock call which verifies it has the intended effect. Also the 2 millisecond timeout seems small so if this is supposed to wait for something it doesn't seem like it waiting very long.\r\n\r\nSame comments also apply to the  _test_waitforblock test below, and maybe it would be good to dedupe the test setup shared by these functions, moving it into a helper method they both could call.",
      "created_at": "2024-07-25T14:25:46Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691546813",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691546813"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 537,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 539,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691555861",
      "pull_request_review_id": 2199367930,
      "id": 1691555861,
      "node_id": "PRRC_kwDOABII585k0xgV",
      "diff_hunk": "@@ -255,7 +255,7 @@ void RPCNotifyBlockChange(const CBlockIndex* pindex)\n static RPCHelpMan waitfornewblock()\n {\n     return RPCHelpMan{\"waitfornewblock\",\n-                \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+                \"\\nWaits for any new block and returns useful info about it.\\n\"",
      "path": "src/rpc/blockchain.cpp",
      "position": 50,
      "original_position": 5,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "e2a1347db07933d1c6e40ab45f2ca4c56c691fed",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"rpc: fix waitfornewblock description\" (e2a1347db07933d1c6e40ab45f2ca4c56c691fed)\r\n\r\nThis is a good documentation fix, but as described previously this waitfornewblock interface is inherently racy. Ideally it would accept an `current_block` option or argument, and return as soon as the tip is not not pointing to that block. This could be something to add in a followup PR, though, because it is not directly relevant to this one.\r\n",
      "created_at": "2024-07-25T14:30:54Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691555861",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691555861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691559189",
      "pull_request_review_id": 2199367930,
      "id": 1691559189,
      "node_id": "PRRC_kwDOABII585k0yUV",
      "diff_hunk": "@@ -427,17 +427,12 @@ static void registerSignalHandler(int signal, void(*handler)(int))\n }\n #endif\n \n-static boost::signals2::connection rpc_notify_block_change_connection;\n static void OnRPCStarted()\n {\n-    rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));\n }\n \n static void OnRPCStopped()\n {\n-    rpc_notify_block_change_connection.disconnect();\n-    RPCNotifyBlockChange(nullptr);\n-    g_best_block_cv.notify_all();",
      "path": "src/init.cpp",
      "position": 23,
      "original_position": 14,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (9d3b07526110a842c9592425b89785e688a8f46c)\r\n\r\ng_best_block_cv still exists, so I don't think you should delete this line\r\n\r\nCan move it to the place this function is called when this function is deleted in the next commit.",
      "created_at": "2024-07-25T14:32:51Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691559189",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691559189"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 440,
      "original_line": 440,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691564281",
      "pull_request_review_id": 2199367930,
      "id": 1691564281,
      "node_id": "PRRC_kwDOABII585k0zj5",
      "diff_hunk": "@@ -324,14 +314,19 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n     CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    block.hash = CHECK_NONFATAL(miner.getTipHash()).value();\n+    block.height = CHECK_NONFATAL(miner.getTipHeight()).value();\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        auto res = timeout ? miner.waitTipChanged(std::chrono::milliseconds(timeout)) : miner.waitTipChanged();",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (9d3b07526110a842c9592425b89785e688a8f46c)\r\n\r\nShould pass `block.hash` as `waitTipChanged` argument here to avoid race condition (see earlier suggestion)",
      "created_at": "2024-07-25T14:35:43Z",
      "updated_at": "2024-07-25T14:47:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1691564281",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1691564281"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527845",
      "pull_request_review_id": 2232637802,
      "id": 1713527845,
      "node_id": "PRRC_kwDOABII585mIlwl",
      "diff_hunk": "@@ -39,6 +40,15 @@ class Mining\n     //! Returns the hash for the tip of this chain\n     virtual std::optional<uint256> getTipHash() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 19,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691480674,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`getTip()` and `waitTipChanged()` now both return `BlockRef`.",
      "created_at": "2024-08-12T10:47:41Z",
      "updated_at": "2024-08-12T10:47:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527845",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527845"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527921",
      "pull_request_review_id": 2232637936,
      "id": 1713527921,
      "node_id": "PRRC_kwDOABII585mIlxx",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691492745,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. I also simplified the `waitfornewblock` (etc) RPC call to just call getTip() and then pass that into `waitTipChanged`. That gets rid of `struct CUpdatedBlock`.",
      "created_at": "2024-08-12T10:47:45Z",
      "updated_at": "2024-08-12T10:47:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527921",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527921"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 866,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527986",
      "pull_request_review_id": 2232638042,
      "id": 1713527986,
      "node_id": "PRRC_kwDOABII585mIlyy",
      "diff_hunk": "@@ -861,6 +861,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));\n+                g_best_block_cv.wait_until(lock, check_time);\n+                if (g_best_block != previous_hash) break;",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 14,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "4554b3b1adf678e17d479d72738f4f2089971c4a",
      "in_reply_to_id": 1691499856,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-12T10:47:48Z",
      "updated_at": "2024-08-12T10:47:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713527986",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713527986"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 874,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528130",
      "pull_request_review_id": 2232638308,
      "id": 1713528130,
      "node_id": "PRRC_kwDOABII585mIl1C",
      "diff_hunk": "@@ -505,6 +513,56 @@ def _test_stopatheight(self):\n         self.start_node(0)\n         assert_equal(self.nodes[0].getblockcount(), HEIGHT + 7)\n \n+    def _test_waitfornewblock(self):\n+        self.log.info(\"Test waitfornewblock\")\n+        node = self.nodes[0]\n+        peer = node.add_p2p_connection(P2PInterface())\n+\n+        current_height = node.getblock(node.getbestblockhash())['height']\n+        current_hash = node.getblock(node.getbestblockhash())['hash']\n+\n+        # Create a fork somewhere below our current height, invalidate and\n+        # then reconsider the longest chain.\n+        #\n+        fork_height = current_height - 100 # choose something vaguely near our tip\n+        fork_hash = node.getblockhash(fork_height)\n+        fork_block = node.getblock(fork_hash)\n+\n+        b1 = self.solve_and_send_block(peer, int(fork_hash, 16), fork_height+1, fork_block['time'] + 1)\n+        b2 = self.solve_and_send_block(peer, b1.sha256, fork_height+2, b1.nTime + 1)\n+\n+        node.invalidateblock(b2.hash)\n+        node.reconsiderblock(b2.hash)\n+\n+        assert_equal(\n+            node.waitfornewblock(timeout=2)['hash'],\n+            current_hash)",
      "path": "test/functional/rpc_blockchain.py",
      "position": null,
      "original_position": 49,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "a18cb7adf192bae481c879fe865f1c159b2b8622",
      "in_reply_to_id": 1691546813,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't fully understand the original test either. Will look into it later.",
      "created_at": "2024-08-12T10:47:57Z",
      "updated_at": "2024-08-12T10:47:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528130",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528130"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 537,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 539,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528797",
      "pull_request_review_id": 2232639285,
      "id": 1713528797,
      "node_id": "PRRC_kwDOABII585mIl_d",
      "diff_hunk": "@@ -255,7 +255,7 @@ void RPCNotifyBlockChange(const CBlockIndex* pindex)\n static RPCHelpMan waitfornewblock()\n {\n     return RPCHelpMan{\"waitfornewblock\",\n-                \"\\nWaits for a specific new block and returns useful info about it.\\n\"\n+                \"\\nWaits for any new block and returns useful info about it.\\n\"",
      "path": "src/rpc/blockchain.cpp",
      "position": 50,
      "original_position": 5,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "e2a1347db07933d1c6e40ab45f2ca4c56c691fed",
      "in_reply_to_id": 1691555861,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I made a note to either add that argument in this PR or make a followup. ",
      "created_at": "2024-08-12T10:48:28Z",
      "updated_at": "2024-08-12T10:48:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528797",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 241,
      "original_line": 241,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528958",
      "pull_request_review_id": 2232639529,
      "id": 1713528958,
      "node_id": "PRRC_kwDOABII585mImB-",
      "diff_hunk": "@@ -427,17 +427,12 @@ static void registerSignalHandler(int signal, void(*handler)(int))\n }\n #endif\n \n-static boost::signals2::connection rpc_notify_block_change_connection;\n static void OnRPCStarted()\n {\n-    rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));\n }\n \n static void OnRPCStopped()\n {\n-    rpc_notify_block_change_connection.disconnect();\n-    RPCNotifyBlockChange(nullptr);\n-    g_best_block_cv.notify_all();",
      "path": "src/init.cpp",
      "position": 23,
      "original_position": 14,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": 1691559189,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I moved it to `StopRPC()`.",
      "created_at": "2024-08-12T10:48:36Z",
      "updated_at": "2024-08-12T10:48:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713528958",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713528958"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 440,
      "original_line": 440,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713529075",
      "pull_request_review_id": 2232639723,
      "id": 1713529075,
      "node_id": "PRRC_kwDOABII585mImDz",
      "diff_hunk": "@@ -324,14 +314,19 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n     CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    block.hash = CHECK_NONFATAL(miner.getTipHash()).value();\n+    block.height = CHECK_NONFATAL(miner.getTipHeight()).value();\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        auto res = timeout ? miner.waitTipChanged(std::chrono::milliseconds(timeout)) : miner.waitTipChanged();",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 92,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "9d3b07526110a842c9592425b89785e688a8f46c",
      "in_reply_to_id": 1691564281,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-12T10:48:42Z",
      "updated_at": "2024-08-12T10:48:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713529075",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713529075"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713879417",
      "pull_request_review_id": 2233198217,
      "id": 1713879417,
      "node_id": "PRRC_kwDOABII585mJ7l5",
      "diff_hunk": "@@ -860,6 +860,25 @@ class MinerImpl : public Mining\n         return tip->GetBlockHash();\n     }\n \n+    std::pair<uint256, int> waitTipChanged(MillisecondsDouble timeout) override\n+    {\n+        uint256 previous_hash{WITH_LOCK(::cs_main, return chainman().ActiveChain().Tip()->GetBlockHash();)};\n+\n+        auto deadline = std::chrono::steady_clock::now() + timeout;\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while (!chainman().m_interrupt && std::chrono::steady_clock::now() < deadline) {\n+                auto check_time = std::chrono::steady_clock::now() + std::min(timeout, MillisecondsDouble(1000));",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 12,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "482a5fd48d494f44f48209956c77ec1bdb5663f5",
      "in_reply_to_id": 1673937990,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (3435d7dd430559abffc964c163a2ae73febd99d1)\r\n\r\n> I changed this in the last push, previously it would always wait for one second each interrupt \"round\" even if the requested `timeout` was shorter.\r\n\r\nThis doesn't seem right. If timeout is 1500ms and the block never changes, it looks like this will wait 1000ms+1000ms instead of 1000ms+500ms. I'm also concerned about the `deadline = now() + timeout` assignment above because it seems like that will be an overflowed value when timeout is `MillisecondsDouble::max()` so the while loop condition might be invalid. I fed this to chatgpt and it suggested the following which seems a bit cleaner & safer:\r\n\r\n\r\n```c++\r\nauto deadline = (timeout != std::chrono::duration::max()) \r\n    ? std::make_optional(std::chrono::steady_clock::now() + timeout)\r\n    : std::nullopt;\r\n\r\nWAIT_LOCK(g_best_block_mutex, lock);\r\nwhile (g_best_block == current_tip.hash && !chainman().m_interrupt) {\r\n    auto now = std::chrono::steady_clock::now();\r\n    auto check_time = now + MillisecondsDouble(1000);\r\n    if (deadline) {\r\n        if (now >= *deadline) {\r\n            break;\r\n        }\r\n        check_time = std::min(*deadline, check_time);\r\n    }\r\n    g_best_block_cv.wait_until(lock, check_time);\r\n}\r\n\r\n```\r\n",
      "created_at": "2024-08-12T14:24:12Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713879417",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713879417"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 879,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713960772",
      "pull_request_review_id": 2233198217,
      "id": 1713960772,
      "node_id": "PRRC_kwDOABII585mKPdE",
      "diff_hunk": "@@ -36,8 +38,18 @@ class Mining\n     //! Returns whether IBD is still in progress.\n     virtual bool isInitialBlockDownload() = 0;\n \n-    //! Returns the hash for the tip of this chain\n-    virtual std::optional<uint256> getTipHash() = 0;\n+    //! Returns the hash and height for the tip of this chain\n+    virtual std::optional<BlockRef> getTip() = 0;\n+\n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual BlockRef waitTipChanged(BlockRef current_tip, MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 28,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (3435d7dd430559abffc964c163a2ae73febd99d1)\r\n\r\nI think it would be slightly better for `current_tip` to just be a block hash, rather than hash and height, because the height value is unused, and a accepting height might create misleading impression that this method could be called to wait for a height to be reached.",
      "created_at": "2024-08-12T15:08:04Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713960772",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713960772"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713965000",
      "pull_request_review_id": 2233198217,
      "id": 1713965000,
      "node_id": "PRRC_kwDOABII585mKQfI",
      "diff_hunk": "@@ -277,16 +259,16 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);\n     }",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nIt seems like the implementation of the this loop always waits for the timeout to be reached, and doesn't exit early if the tip did change. So if timeout is 0 it will just infinite loop.\r\n\r\nI think if it can be simplified to just:\r\n\r\n```c++\r\n    if (IsRPCRunning()) {\r\n        block = timeout \r\n            ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout))\r\n            : miner.waitTipChanged(block);\r\n    }\r\n```\r\n\r\nAnd you could get rid of the deadline variable.\r\n\r\n\r\n",
      "created_at": "2024-08-12T15:10:47Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713965000",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713965000"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 268,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 270,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713997278",
      "pull_request_review_id": 2233198217,
      "id": 1713997278,
      "node_id": "PRRC_kwDOABII585mKYXe",
      "diff_hunk": "@@ -324,14 +306,14 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nPassing timeout parameter doesn't seem right, because it could wait too long. For example if timeout is 10 seconds, and tip changed after 8 seconds but did not match expected block hash, the next wait call will wait 10 seconds instead of 2 seconds.\r\n\r\nMight be better to replace with:\r\n\r\n```c++\r\nwhile (IsRPCRunning()) {\r\n    auto now = timeout ? std::chrono::steady_clock::now() : std::chrono::steady_clock::time_point::min();\r\n    if (block.hash == hash || now > deadline) break;\r\n    block = timeout ? miner.waitTipChanged(block, deadline - now) : miner.waitTipChanged(block);\r\n}\r\n```",
      "created_at": "2024-08-12T15:31:09Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1713997278",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1713997278"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714002168",
      "pull_request_review_id": 2233198217,
      "id": 1714002168,
      "node_id": "PRRC_kwDOABII585mKZj4",
      "diff_hunk": "@@ -372,15 +354,16 @@ static RPCHelpMan waitforblockheight()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.height >= height) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (d919a230563bd2efee1fccb83194b43f436781ef)\r\n\r\nSeems like this has same problem as waitforblock where waitTipChanged could wait too long because it is called with wrong timeout value. Might be better as:\r\n\r\n```c++\r\nwhile (IsRPCRunning()) {\r\n    auto now = timeout ? std::chrono::steady_clock::now() : std::chrono::steady_clock::time_point::min();\r\n    if (block.height >= height || now > deadline) break;\r\n    block = timeout ? miner.waitTipChanged(block, deadline - now) : miner.waitTipChanged(block);\r\n}\r\n```",
      "created_at": "2024-08-12T15:34:07Z",
      "updated_at": "2024-08-12T16:02:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1714002168",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714002168"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 364,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714902269",
      "pull_request_review_id": 2234901100,
      "id": 1714902269,
      "node_id": "PRRC_kwDOABII585mN1T9",
      "diff_hunk": "@@ -277,16 +259,16 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);\n     }",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 69,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1713965000,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, this should not have been a while loop. I reproduced the infinite loop here.",
      "created_at": "2024-08-13T08:39:25Z",
      "updated_at": "2024-08-13T08:39:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1714902269",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1714902269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 268,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 270,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013521",
      "pull_request_review_id": 2235089228,
      "id": 1715013521,
      "node_id": "PRRC_kwDOABII585mOQeR",
      "diff_hunk": "@@ -372,15 +354,16 @@ static RPCHelpMan waitforblockheight()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&height]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height >= height || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.height >= height) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 116,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1714002168,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed (in the same way as `waitforblock`)",
      "created_at": "2024-08-13T09:52:54Z",
      "updated_at": "2024-08-13T09:52:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013521",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 364,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013631",
      "pull_request_review_id": 2235089426,
      "id": 1715013631,
      "node_id": "PRRC_kwDOABII585mOQf_",
      "diff_hunk": "@@ -324,14 +306,14 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while(IsRPCRunning() && (timeout == 0 || std::chrono::steady_clock::now() < deadline)) {\n+        if (block.hash == hash) break;\n+        block = timeout ? miner.waitTipChanged(block, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block);",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 93,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d919a230563bd2efee1fccb83194b43f436781ef",
      "in_reply_to_id": 1713997278,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed, though in a slightly different way.",
      "created_at": "2024-08-13T09:52:59Z",
      "updated_at": "2024-08-13T09:52:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013631",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013711",
      "pull_request_review_id": 2235089541,
      "id": 1715013711,
      "node_id": "PRRC_kwDOABII585mOQhP",
      "diff_hunk": "@@ -36,8 +38,18 @@ class Mining\n     //! Returns whether IBD is still in progress.\n     virtual bool isInitialBlockDownload() = 0;\n \n-    //! Returns the hash for the tip of this chain\n-    virtual std::optional<uint256> getTipHash() = 0;\n+    //! Returns the hash and height for the tip of this chain\n+    virtual std::optional<BlockRef> getTip() = 0;\n+\n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout\n+     */\n+    virtual BlockRef waitTipChanged(BlockRef current_tip, MillisecondsDouble timeout = MillisecondsDouble::max()) = 0;",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 28,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "dcf984b055a367facf7704eb8055619d6fe64a55",
      "in_reply_to_id": 1713960772,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-13T09:53:02Z",
      "updated_at": "2024-08-13T09:53:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1715013711",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1715013711"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719929110",
      "pull_request_review_id": 2242860642,
      "id": 1719929110,
      "node_id": "PRRC_kwDOABII585mhAkW",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 15,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nNot sure \"in case of race condition\" actually explains this. Would suggest changing this to:\r\n\r\n- `current_tip` - block hash compared against the current chain tip. Function waits for the chain tip to change if this matches, otherwise it returns right away.",
      "created_at": "2024-08-16T14:32:47Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719929110",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719929110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719939574",
      "pull_request_review_id": 2242860642,
      "id": 1719939574,
      "node_id": "PRRC_kwDOABII585mhDH2",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 18,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nThink it would  be simpler to say \"returns hash and height of the current chain tip after this call.\"\r\n\r\nIt seems potentially misleading to refer to a \"previous\" tip here because that sounds like this could sometimes return an old block hash. And it's a little confusing to refer to a \"new \"tip in the case where this function just returns immediately and there no interruption or wait or timeout.",
      "created_at": "2024-08-16T14:39:18Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719939574",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719939574"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 49,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719963458",
      "pull_request_review_id": 2242860642,
      "id": 1719963458,
      "node_id": "PRRC_kwDOABII585mhI9C",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);\n+                // Obtaining the height here using chainman().ActiveChain().Tip()->nHeight\n+                // would result in a deadlock, because UpdateTip requires holding cs_main.",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 21,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nI think this comment is only warning about a small part of a bigger danger. It's not just unsafe to obtain the height here but unsafe to acquire cs_main anywhere in this code block, even after the while loop.\r\n\r\nWould suggest dropping this comment and instead adding a simpler comment above LOCK(::cs_main) that says \r\n\"Must release g_best_block_mutex before locking cs_main, to avoid deadlocks.\"\r\n\r\nA comment like that seems more likely to prevent deadlocks generally in this function.",
      "created_at": "2024-08-16T14:57:42Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719963458",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719963458"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 889,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 890,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719972779",
      "pull_request_review_id": 2242860642,
      "id": 1719972779,
      "node_id": "PRRC_kwDOABII585mhLOr",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d)\r\n\r\nNot important but I think it would be clearer to condense these 3 lines to just:\r\n\r\n```c++\r\ng_best_block_cv.wait_until(lock, std::min(deadline, now + tick));\r\n```\r\n\r\nI don't think it helps to introduce 2 extra variables and subtract `now` then add `now` back.",
      "created_at": "2024-08-16T15:06:01Z",
      "updated_at": "2024-08-16T15:28:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1719972779",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1719972779"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 886,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317181",
      "pull_request_review_id": 2244781268,
      "id": 1721317181,
      "node_id": "PRRC_kwDOABII585mmTc9",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 15,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719929110,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Taken (mostly).",
      "created_at": "2024-08-19T07:18:39Z",
      "updated_at": "2024-08-19T07:18:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721317181",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317181"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 47,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317268",
      "pull_request_review_id": 2244781413,
      "id": 1721317268,
      "node_id": "PRRC_kwDOABII585mmTeU",
      "diff_hunk": "@@ -40,6 +41,16 @@ class Mining\n     //! Returns the hash and height for the tip of this chain\n     virtual std::optional<BlockRef> getTip() = 0;\n \n+    /**\n+     * Waits for the tip to change\n+     *\n+     * @param[in] current_tip the current tip, in case of a race condition\n+     * @param[in] timeout how long to wait for a new tip\n+     * @returns hash and height for the new tip or the previous tip if\n+     *          interrupted or after the timeout",
      "path": "src/interfaces/mining.h",
      "position": null,
      "original_position": 18,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719939574,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-19T07:18:44Z",
      "updated_at": "2024-08-19T07:18:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721317268",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721317268"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 49,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 50,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721324596",
      "pull_request_review_id": 2244793244,
      "id": 1721324596,
      "node_id": "PRRC_kwDOABII585mmVQ0",
      "diff_hunk": "@@ -870,6 +870,30 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(g_best_block_mutex, lock);\n+            while ((g_best_block == uint256() || g_best_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                const MillisecondsDouble remaining{deadline - now};\n+                const auto interval{std::min(remaining, tick)};\n+                g_best_block_cv.wait_until(lock, now + interval);",
      "path": "src/node/interfaces.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "d1c197fbbad86e3f966d9bf9abe4dd0aa76bc83d",
      "in_reply_to_id": 1719972779,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed that's nicer.",
      "created_at": "2024-08-19T07:25:38Z",
      "updated_at": "2024-08-19T07:25:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721324596",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721324596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 886,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721752519",
      "pull_request_review_id": 2245487748,
      "id": 1721752519,
      "node_id": "PRRC_kwDOABII585mn9vH",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        auto now{std::chrono::steady_clock::now()};",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "bf3377f4bf988f2477944ca54c4dee33b9b45b6e",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (bf3377f4bf988f2477944ca54c4dee33b9b45b6e)\r\n\r\n`now` variable is unused if timeout is zero, so this line could be moved inside the `if (timeout)` block below.",
      "created_at": "2024-08-19T13:01:01Z",
      "updated_at": "2024-08-19T13:08:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721752519",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721752519"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721865864",
      "pull_request_review_id": 2245675379,
      "id": 1721865864,
      "node_id": "PRRC_kwDOABII585moZaI",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        auto now{std::chrono::steady_clock::now()};",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "bf3377f4bf988f2477944ca54c4dee33b9b45b6e",
      "in_reply_to_id": 1721752519,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done here and in `waitforblockheight`.",
      "created_at": "2024-08-19T14:15:44Z",
      "updated_at": "2024-08-19T14:15:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721865864",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721865864"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 315,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721880533",
      "pull_request_review_id": 2245698982,
      "id": 1721880533,
      "node_id": "PRRC_kwDOABII585moc_V",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Replace RPCNotifyBlockChange with waitTipChanged()\" (b4d37fa70506129ba4a4d218bc49ce8ca9d8380c)\r\n\r\nNot important, but could simplify these two lines to `while (IsRPCRunning() && block.hash != hash)`\r\n\r\nSimilarly, could simplify to `while (IsRPCRunning() && block.height < height)` in waitforblockheight below.",
      "created_at": "2024-08-19T14:24:54Z",
      "updated_at": "2024-08-19T14:27:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721880533",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721880533"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721929753",
      "pull_request_review_id": 2245780008,
      "id": 1721929753,
      "node_id": "PRRC_kwDOABII585mopAZ",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1721880533,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks, will do if I have to retouch.",
      "created_at": "2024-08-19T14:56:20Z",
      "updated_at": "2024-08-19T14:56:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1721929753",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721929753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727105521",
      "pull_request_review_id": 2254595107,
      "id": 1727105521,
      "node_id": "PRRC_kwDOABII585m8Ynx",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit b4d37fa70506129ba4a4d218bc49ce8ca9d8380c\r\n\r\nI think there is a significant change in behaviour here between `waitTipChanged`, or rather `g_best_block`, and the rpc notification through `blockTip`. AFAICT the `blockTip` notification reports on completed operations in `ActivateBestChain` and `InvalidatedBlock`, while `g_best_block` is updated through the lower-level `ConnectTip` and `DisconnectTip`, which may respectively be called iteratively by `ActivateBestChain` and `InvalidateBlock`. So for operations involving multiple blocks this might yield different results here. I'm not sure if these RPCs should report on these more ephemeral state changes rather than the results of the respective operations.\r\n\r\nI have not actually tested this, so I might be mistaken here, in which case I think it would still be good to have a note in the commit message comparing the two methods.",
      "created_at": "2024-08-22T13:52:41Z",
      "updated_at": "2024-08-22T13:58:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727105521",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727105521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727346780",
      "pull_request_review_id": 2254946626,
      "id": 1727346780,
      "node_id": "PRRC_kwDOABII585m9Thc",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`g_best_block_cv.notify_all();` is called by `Chainstate::UpdateTip()`, which indeed is called by `ConnectTip` and `DisconnectTip()`. Still wrapping my head around what the previous approach was. I doubt these RPC's were used outside of tests, but it would make sense to document the different.",
      "created_at": "2024-08-22T15:27:24Z",
      "updated_at": "2024-08-22T15:27:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727346780",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727346780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727474250",
      "pull_request_review_id": 2255139063,
      "id": 1727474250,
      "node_id": "PRRC_kwDOABII585m9ypK",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "re: https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727105521\r\n\r\nThis is a good catch, but I\"m not sure there is a observable change of behavior in `ActivateBestChain` because cs_main is held the whole time `blockTip` / `uiInterface.NotifyBlockTip` / `RPCNotifyBlockChange` is called and while the old `latestblock` global (now replaced by `g_best_block`) was updated:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3552\r\n\r\nSo I don't think `waitTipChanged` will actually return during any intermediate tip changes, because it can't return until it locks `cs_main`, so it should just report the latest block as before.\r\n\r\nHowever, `InvalidBlock` seems like a different story because it is releasing cs_main between disconnecting blocks:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3701\r\n\r\nbut it would previously only notify about a tip change and update `latestblock` at the end:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/5ce2285b8739e12eebd1d53358038ec2277c662b/src/validation.cpp#L3783\r\n\r\nNow it will update `g_best_block` and release `cs_main` while it is disconnecting blocks. This seems like something worth documenting, but probably not likely to cause real problems.\r\n",
      "created_at": "2024-08-22T16:35:45Z",
      "updated_at": "2024-08-22T16:36:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727474250",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727474250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727777786",
      "pull_request_review_id": 2255602043,
      "id": 1727777786,
      "node_id": "PRRC_kwDOABII585m-8v6",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Couple of months ago I was thinking how to get rid of `g_best_block` and its friends entirely in the context of the kernel library. We already have two interfaces for notifying if something changed during validation, having a third one, that is also globally mutable and potentially dangerous if multiple chainstate managers are used is not ideal. I did not make progress then, but looking at it again now, I think this might be the opportunity to get rid of it.\r\n\r\nHow about duplicating the best block logic into the kernel notifications like I've done here https://github.com/TheCharlatan/bitcoin/commit/3c665065f132fd80ea3b1733785b98e45c8b371e (our locking conventions still puzzle me a bit, maybe there is a better way to do it)? This would avoid any change in behavior altogether and mostly make this a refactor. In a follow-up the remaining users of `g_best_block` could then be migrated and the global deleted.\r\n\r\nI think the current user of `g_best_block` (getblocktemplate() in mining.cpp), could be migrated to this interface as well. I don't really see the downside of not being notified on these interim states, since it is undesirable to build work on top of them.",
      "created_at": "2024-08-22T20:33:40Z",
      "updated_at": "2024-08-22T20:33:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1727777786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727777786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730914174",
      "pull_request_review_id": 2260145571,
      "id": 1730914174,
      "node_id": "PRRC_kwDOABII585nK6d-",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@TheCharlatan do you want to make a separate PR for the kernel notification changes, or should I just include them here?",
      "created_at": "2024-08-26T08:44:39Z",
      "updated_at": "2024-08-26T08:44:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730914174",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730914174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730917837",
      "pull_request_review_id": 2260151370,
      "id": 1730917837,
      "node_id": "PRRC_kwDOABII585nK7XN",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think it would be good to integrate them here, and I'll try and follow up with removing the `m_best_header` global from validation.",
      "created_at": "2024-08-26T08:47:24Z",
      "updated_at": "2024-08-26T08:47:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730917837",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730917837"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730997386",
      "pull_request_review_id": 2260278015,
      "id": 1730997386,
      "node_id": "PRRC_kwDOABII585nLOyK",
      "diff_hunk": "@@ -326,14 +306,21 @@ static RPCHelpMan waitforblock()\n         timeout = request.params[1].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning();});\n-        else\n-            cond_blockchange.wait(lock, [&hash]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.hash == hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};\n+    while (IsRPCRunning()) {\n+        if (block.hash == hash) break;",
      "path": "src/rpc/blockchain.cpp",
      "position": null,
      "original_position": 90,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1721880533,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2024-08-26T09:46:58Z",
      "updated_at": "2024-08-26T09:46:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1730997386",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730997386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": 314,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 316,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731432419",
      "pull_request_review_id": 2260994997,
      "id": 1731432419,
      "node_id": "PRRC_kwDOABII585nM4_j",
      "diff_hunk": "@@ -870,6 +871,27 @@ class MinerImpl : public Mining\n         return BlockRef{tip->GetBlockHash(), tip->nHeight};\n     }\n \n+    BlockRef waitTipChanged(uint256 current_tip, MillisecondsDouble timeout) override\n+    {\n+        // Interrupt check interval\n+        const MillisecondsDouble tick{1000};\n+        auto now{std::chrono::steady_clock::now()};\n+        auto deadline = now + timeout;\n+        // std::chrono does not check against overflow\n+        if (deadline < now) deadline = std::chrono::steady_clock::time_point::max();\n+        {\n+            WAIT_LOCK(notifications().m_tip_block_mutex, lock);\n+            while ((notifications().m_tip_block == uint256() || notifications().m_tip_block == current_tip) && !chainman().m_interrupt) {\n+                now = std::chrono::steady_clock::now();\n+                if (now >= deadline) break;\n+                notifications().m_tip_block_cv.wait_until(lock, std::min(deadline, now + tick));",
      "path": "src/node/interfaces.cpp",
      "position": 60,
      "original_position": 25,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "078fc60f198eb7a3bcccb557416fe1d4498f26e7",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"Add waitTipChanged to Mining interface\" (078fc60f198eb7a3bcccb557416fe1d4498f26e7)\r\n\r\nOne problem with switching from g_best_block_cv to m_tip_block_cv is that this m_tip_block_cv is not signaled when StopRPC is called, which could mean shutdown hangs for a second instead of being instantaneous. I believe this could be fixed in earlier commit 8400d49ffec47add2dc27267ae13ede5d2fabeea with:\r\n\r\n```diff\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -282,7 +282,7 @@ void Shutdown(NodeContext& node)\r\n \r\n     StopHTTPRPC();\r\n     StopREST();\r\n-    StopRPC();\r\n+    StopRPC(&node);\r\n     StopHTTPServer();\r\n     for (const auto& client : node.chain_clients) {\r\n         client->flush();\r\n--- a/src/node/interfaces.cpp\r\n+++ b/src/node/interfaces.cpp\r\n@@ -139,7 +139,7 @@ public:\r\n         // Stop RPC for clean shutdown if any of waitfor* commands is executed.\r\n         if (args().GetBoolArg(\"-server\", false)) {\r\n             InterruptRPC();\r\n-            StopRPC();\r\n+            StopRPC(m_context);\r\n         }\r\n     }\r\n     bool shutdownRequested() override { return ShutdownRequested(*Assert(m_context)); };\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -11,6 +11,7 @@\r\n #include <common/system.h>\r\n #include <logging.h>\r\n #include <node/context.h>\r\n+#include <node/kernel_notifications.h>\r\n #include <rpc/server_util.h>\r\n #include <rpc/util.h>\r\n #include <sync.h>\r\n@@ -293,16 +294,17 @@ void InterruptRPC()\r\n     });\r\n }\r\n \r\n-void StopRPC()\r\n+void StopRPC(const std::any& context)\r\n {\r\n     static std::once_flag g_rpc_stop_flag;\r\n     // This function could be called twice if the GUI has been started with -server=1.\r\n     assert(!g_rpc_running);\r\n-    std::call_once(g_rpc_stop_flag, []() {\r\n+    std::call_once(g_rpc_stop_flag, [&]() {\r\n         LogPrint(BCLog::RPC, \"Stopping RPC\\n\");\r\n         WITH_LOCK(g_deadline_timers_mutex, deadlineTimers.clear());\r\n         DeleteAuthCookie();\r\n         g_best_block_cv.notify_all();\r\n+        Assert(EnsureAnyNodeContext(context).notifications)->m_tip_block_cv.notify_all();\r\n         LogPrint(BCLog::RPC, \"RPC stopped.\\n\");\r\n     });\r\n }\r\n--- a/src/rpc/server.h\r\n+++ b/src/rpc/server.h\r\n@@ -9,6 +9,7 @@\r\n #include <rpc/request.h>\r\n #include <rpc/util.h>\r\n \r\n+#include <any>\r\n #include <functional>\r\n #include <map>\r\n #include <stdint.h>\r\n@@ -172,7 +173,7 @@ extern CRPCTable tableRPC;\r\n \r\n void StartRPC();\r\n void InterruptRPC();\r\n-void StopRPC();\r\n+void StopRPC(const std::any& context);\r\n UniValue JSONRPCExec(const JSONRPCRequest& jreq, bool catch_errors);\r\n \r\n #endif // BITCOIN_RPC_SERVER_H\r\n```",
      "created_at": "2024-08-26T15:35:34Z",
      "updated_at": "2024-08-26T15:46:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731432419",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731432419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 887,
      "original_line": 887,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731440200",
      "pull_request_review_id": 2260994997,
      "id": 1731440200,
      "node_id": "PRRC_kwDOABII585nM65I",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If we are going to add a new `m_tip_block` variable to replace `g_best_block` seems like it would be good to make replacement complete and eliminate `g_best_block`. I think following could work (compiles but untested):\r\n\r\n```diff\r\n--- a/src/rpc/mining.cpp\r\n+++ b/src/rpc/mining.cpp\r\n@@ -739,7 +739,6 @@ static RPCHelpMan getblocktemplate()\r\n     {\r\n         // Wait to respond until either the best block changes, OR a minute has passed and there are more transactions\r\n         uint256 hashWatchedChain;\r\n-        std::chrono::steady_clock::time_point checktxtime;\r\n         unsigned int nTransactionsUpdatedLastLP;\r\n \r\n         if (lpval.isStr())\r\n@@ -760,19 +759,14 @@ static RPCHelpMan getblocktemplate()\r\n         // Release lock while waiting\r\n         LEAVE_CRITICAL_SECTION(cs_main);\r\n         {\r\n-            checktxtime = std::chrono::steady_clock::now() + std::chrono::minutes(1);\r\n-\r\n-            WAIT_LOCK(g_best_block_mutex, lock);\r\n-            while (g_best_block == hashWatchedChain && IsRPCRunning())\r\n-            {\r\n-                if (g_best_block_cv.wait_until(lock, checktxtime) == std::cv_status::timeout)\r\n-                {\r\n-                    // Timeout: Check transactions for update\r\n-                    // without holding the mempool lock to avoid deadlocks\r\n-                    if (miner.getTransactionsUpdated() != nTransactionsUpdatedLastLP)\r\n-                        break;\r\n-                    checktxtime += std::chrono::seconds(10);\r\n-                }\r\n+            MillisecondsDouble checktxtime{std::chrono::minutes(1)};\r\n+            while (tip == hashWatchedChain && IsRPCRunning()) {\r\n+                tip = miner.waitTipChanged(hashWatchedChain, checktxtime).hash;\r\n+                // Timeout: Check transactions for update\r\n+                // without holding the mempool lock to avoid deadlocks\r\n+                if (miner.getTransactionsUpdated() != nTransactionsUpdatedLastLP)\r\n+                    break;\r\n+                checktxtime = std::chrono::seconds(10);\r\n             }\r\n         }\r\n         ENTER_CRITICAL_SECTION(cs_main);\r\n--- a/src/rpc/server.cpp\r\n+++ b/src/rpc/server.cpp\r\n@@ -303,7 +303,6 @@ void StopRPC(const std::any& context)\r\n         LogPrint(BCLog::RPC, \"Stopping RPC\\n\");\r\n         WITH_LOCK(g_deadline_timers_mutex, deadlineTimers.clear());\r\n         DeleteAuthCookie();\r\n-        g_best_block_cv.notify_all();\r\n         Assert(EnsureAnyNodeContext(context).notifications)->m_tip_block_cv.notify_all();\r\n         LogPrint(BCLog::RPC, \"RPC stopped.\\n\");\r\n     });\r\n--- a/src/test/validation_chainstate_tests.cpp\r\n+++ b/src/test/validation_chainstate_tests.cpp\r\n@@ -4,6 +4,7 @@\r\n //\r\n #include <chainparams.h>\r\n #include <consensus/validation.h>\r\n+#include <node/kernel_notifications.h>\r\n #include <random.h>\r\n #include <rpc/blockchain.h>\r\n #include <sync.h>\r\n@@ -69,14 +70,14 @@ BOOST_AUTO_TEST_CASE(validation_chainstate_resize_caches)\r\n BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n {\r\n     ChainstateManager& chainman = *Assert(m_node.chainman);\r\n-    uint256 curr_tip = ::g_best_block;\r\n+    uint256 curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     // Mine 10 more blocks, putting at us height 110 where a valid assumeutxo value can\r\n     // be found.\r\n     mineBlocks(10);\r\n \r\n     // After adding some blocks to the tip, best block should have changed.\r\n-    BOOST_CHECK(::g_best_block != curr_tip);\r\n+    BOOST_CHECK(m_node.notifications->m_tip_block != curr_tip);\r\n \r\n     // Grab block 1 from disk; we'll add it to the background chain later.\r\n     std::shared_ptr<CBlock> pblockone = std::make_shared<CBlock>();\r\n@@ -91,15 +92,15 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n     // Ensure our active chain is the snapshot chainstate.\r\n     BOOST_CHECK(WITH_LOCK(::cs_main, return chainman.IsSnapshotActive()));\r\n \r\n-    curr_tip = ::g_best_block;\r\n+    curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     // Mine a new block on top of the activated snapshot chainstate.\r\n     mineBlocks(1);  // Defined in TestChain100Setup.\r\n \r\n     // After adding some blocks to the snapshot tip, best block should have changed.\r\n-    BOOST_CHECK(::g_best_block != curr_tip);\r\n+    BOOST_CHECK(m_node.notifications->m_tip_block != curr_tip);\r\n \r\n-    curr_tip = ::g_best_block;\r\n+    curr_tip = m_node.notifications->m_tip_block;\r\n \r\n     BOOST_CHECK_EQUAL(chainman.GetAll().size(), 2);\r\n \r\n@@ -138,7 +139,7 @@ BOOST_FIXTURE_TEST_CASE(chainstate_update_tip, TestChain100Setup)\r\n     // g_best_block should be unchanged after adding a block to the background\r\n     // validation chain.\r\n     BOOST_CHECK(block_added);\r\n-    BOOST_CHECK_EQUAL(curr_tip, ::g_best_block);\r\n+    BOOST_CHECK_EQUAL(curr_tip, m_node.notifications->m_tip_block);\r\n }\r\n \r\n BOOST_AUTO_TEST_SUITE_END()\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -107,10 +107,6 @@ const std::vector<std::string> CHECKLEVEL_DOC {\r\n  * */\r\n static constexpr int PRUNE_LOCK_BUFFER{10};\r\n \r\n-GlobalMutex g_best_block_mutex;\r\n-std::condition_variable g_best_block_cv;\r\n-uint256 g_best_block;\r\n-\r\n const CBlockIndex* Chainstate::FindForkInGlobalIndex(const CBlockLocator& locator) const\r\n {\r\n     AssertLockHeld(cs_main);\r\n@@ -2987,12 +2983,6 @@ void Chainstate::UpdateTip(const CBlockIndex* pindexNew)\r\n         m_mempool->AddTransactionsUpdated(1);\r\n     }\r\n \r\n-    {\r\n-        LOCK(g_best_block_mutex);\r\n-        g_best_block = pindexNew->GetBlockHash();\r\n-        g_best_block_cv.notify_all();\r\n-    }\r\n-\r\n     std::vector<bilingual_str> warning_messages;\r\n     if (!m_chainman.IsInitialBlockDownload()) {\r\n         const CBlockIndex* pindex = pindexNew;\r\n--- a/src/validation.h\r\n+++ b/src/validation.h\r\n@@ -85,11 +85,6 @@ enum class SynchronizationState {\r\n     POST_INIT\r\n };\r\n \r\n-extern GlobalMutex g_best_block_mutex;\r\n-extern std::condition_variable g_best_block_cv;\r\n-/** Used to notify getblocktemplate RPC of new tips. */\r\n-extern uint256 g_best_block;\r\n-\r\n /** Documentation for argument 'checklevel'. */\r\n extern const std::vector<std::string> CHECKLEVEL_DOC;\r\n \r\n```\r\n",
      "created_at": "2024-08-26T15:41:24Z",
      "updated_at": "2024-08-26T15:46:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731440200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731440200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731519643",
      "pull_request_review_id": 2261136712,
      "id": 1731519643,
      "node_id": "PRRC_kwDOABII585nNOSb",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Nice! I split the changes to `rpc/mining.cpp` into its own commit, that looks correct.\r\n\r\nRunning and debugging some failing tests before pushing...",
      "created_at": "2024-08-26T16:49:25Z",
      "updated_at": "2024-08-26T16:51:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731519643",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731519643"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731725112",
      "pull_request_review_id": 2261470893,
      "id": 1731725112,
      "node_id": "PRRC_kwDOABII585nOAc4",
      "diff_hunk": "@@ -278,16 +260,14 @@ static RPCHelpMan waitfornewblock()\n         timeout = request.params[0].getInt<int>();\n     if (timeout < 0) throw JSONRPCError(RPC_MISC_ERROR, \"Negative timeout\");\n \n-    CUpdatedBlock block;\n-    {\n-        WAIT_LOCK(cs_blockchange, lock);\n-        block = latestblock;\n-        if(timeout)\n-            cond_blockchange.wait_for(lock, std::chrono::milliseconds(timeout), [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        else\n-            cond_blockchange.wait(lock, [&block]() EXCLUSIVE_LOCKS_REQUIRED(cs_blockchange) {return latestblock.height != block.height || latestblock.hash != block.hash || !IsRPCRunning(); });\n-        block = latestblock;\n+    NodeContext& node = EnsureAnyNodeContext(request.context);\n+    Mining& miner = EnsureMining(node);\n+\n+    auto block{CHECK_NONFATAL(miner.getTip()).value()};\n+    if (IsRPCRunning()) {\n+        block = timeout ? miner.waitTipChanged(block.hash, std::chrono::milliseconds(timeout)) : miner.waitTipChanged(block.hash);",
      "path": "src/rpc/blockchain.cpp",
      "position": 76,
      "original_position": 66,
      "commit_id": "2804848395805a7af8ce2c0b6aa263ba1239f926",
      "original_commit_id": "b4d37fa70506129ba4a4d218bc49ce8ca9d8380c",
      "in_reply_to_id": 1727105521,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Thanks ryanofsky, that is exactly what I had in mind for a potential followup - happy to have this in one go. I still need to think through the trade-offs for the block template rpc, but I think this might actually be better.",
      "created_at": "2024-08-26T19:35:55Z",
      "updated_at": "2024-08-26T19:35:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30409#discussion_r1731725112",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731725112"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30409"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 269,
      "original_line": 269,
      "side": "RIGHT"
    }
  ]
}
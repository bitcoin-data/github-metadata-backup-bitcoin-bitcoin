{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673",
    "id": 2024536912,
    "node_id": "PR_kwDOABII5854q_tQ",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30673",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30673.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30673.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/7d2b49926cc24522211ae185915072b2e37ca334",
    "number": 30673,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove logic for spent-and-FRESH cache entries and writing non-DIRTY entries",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Following up from https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1655477509, which suggested a revival of #18746.\r\n\r\n`GetCoin` will never return `true` for a spent entry, so we can safely assume that any entry we fetch will not be spent. This lets us remove the only non-test code path which adds a FRESH-but-not-DIRTY entry to the flagged linked list. This in turn ensures all entries being sent to `BatchWrite` are `DIRTY` entries.\r\n\r\nA corollary is that all spent coins must be DIRTY. The only time a coin can be spent and not DIRTY is when the `CCoinsViewCacheEntry` is created with an empty coin. The last commit makes this more clear by checking for freshness if inserted instead of if spent and not DIRTY.\r\n\r\nThis is a pure refactor removing dead code which handles a non-existent corner case of a FRESH-but-not-DIRTY entry in the `CCoinsViewCache` or a spent entry in `CCoinsViewDB`. There is a lot of test code which tries to exercise this corner case, which is also updated in this PR to behave like non-test code.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2024-08-18T21:31:11Z",
    "updated_at": "2024-09-01T16:11:45Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "6899cee1ed1e4096ef816c2c6e47012d9817ddfb",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:no-spent-and-fresh",
      "ref": "no-spent-and-fresh",
      "sha": "7d2b49926cc24522211ae185915072b2e37ca334",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 247323,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-08-31T19:43:55Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b52d54736168bed82775e3c9e66c6320c7b83626",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 35811,
        "stargazers_count": 77769,
        "watchers_count": 77769,
        "size": 267430,
        "default_branch": "master",
        "open_issues_count": 668,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-01T08:53:28Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-01T16:59:09Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 85,
    "deletions": 120,
    "changed_files": 7,
    "commits": 10,
    "review_comments": 54,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 2295400070,
      "node_id": "IC_kwDOABII586I0QaG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2295400070",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:31:13Z",
      "updated_at": "2024-09-01T02:28:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30673).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2245093564) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30750](https://github.com/bitcoin/bitcoin/pull/30750) (scripted-diff: LogPrint -> LogDebug by maflcko)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo/LogDebug over LogPrintf/LogPrint by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2295400070",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "labeled",
      "id": 13922977193,
      "node_id": "LE_lADOABII586TWhHVzwAAAAM938Wp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922977193",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:31:15Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13922990638,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM93_ou",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922990638",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:39:28Z"
    },
    {
      "event": "labeled",
      "id": 13922990762,
      "node_id": "LE_lADOABII586TWhHVzwAAAAM93_qq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922990762",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:39:32Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2295403510,
      "node_id": "IC_kwDOABII586I0RP2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2295403510",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:39:33Z",
      "updated_at": "2024-08-18T21:39:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/28917867890</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2295403510",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13923041141,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM94L91",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13923041141",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T22:08:53Z"
    },
    {
      "event": "unlabeled",
      "id": 13923182717,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAAM94uh9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13923182717",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T23:25:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13929814318,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM-SBku",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13929814318",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-19T12:38:28Z"
    },
    {
      "event": "reviewed",
      "id": 2245093564,
      "node_id": "PRR_kwDOABII586F0Wi8",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "The code became a lot simpler now - have a few suggestion I'd like us to consider, but I understand if you think it's out of scope.\r\n\r\nOnce we get to a state that is ACK-worthy, I'll enable hard assertions everywhere and run an IBD and check if it crashes anywhere.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2245093564",
      "submitted_at": "2024-08-19T12:54:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2246358443,
      "node_id": "PRR_kwDOABII586F5LWr",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2246358443",
      "submitted_at": "2024-08-19T20:01:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "commented",
      "id": 2299500214,
      "node_id": "IC_kwDOABII586JD5a2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2299500214",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-20T18:36:46Z",
      "updated_at": "2024-08-20T18:36:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Once we get to a state that is ACK-worthy, I'll enable hard assertions everywhere and run an IBD and check if it crashes anywhere.\r\n\r\nI think for a change like this, spending time fuzzing would be more valuable. I believe it already runs in debug mode for that so `Assume`s would trigger crashes.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2299500214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "reviewed",
      "id": 2260190262,
      "node_id": "PRR_kwDOABII586Gt8Q2",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Dug deeper and added more relevant questions - bear with me if they're outside the scope of this PR.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2260190262",
      "submitted_at": "2024-08-26T11:51:22Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "labeled",
      "id": 14049882521,
      "node_id": "LE_lADOABII586TWhHVzwAAAANFcDGZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14049882521",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-28T16:30:31Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJmMzgyZjVhNzJlZGFkMDU2YWI5NWI5ZWMxOGI1MWQwYzU4ZTg3NmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf382f5a72edad056ab95b9ec18b51d0c58e876f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bf382f5a72edad056ab95b9ec18b51d0c58e876f",
      "tree": {
        "sha": "d9bc05f635029e46b2708b171b6d1e1b632dfc5c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d9bc05f635029e46b2708b171b6d1e1b632dfc5c"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d9bc05f635029e46b2708b171b6d1e1b632dfc5c\nparent b52d54736168bed82775e3c9e66c6320c7b83626\nauthor Andrew Toth <andrewstoth@gmail.com> 1724014969 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725126952 -0400\n\ntest: never return true from GetCoins for spent entries\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTWSkACgkQYAB6/Ik4\nsBh0YRAAkWRABz9kFAnrqFmw86VVM2dQvg349U9JIHmsrS47Y+meMg7XQ3/eWUtf\nWU1DG4d5VLXZDWqjxKYy3UlXT2l9J5k1BL96IaXlJAaeRiyhScf9wHz2wuCEu+WI\nQWglhpdGLF3QdtLK3dMszIv3GIH8zZWB/xwQKs4ns0gTXNKLxFu0aoYQ+Omm86Yq\n9wTa8F7FO+eRaq9bUjbJ38ibCgLeMgfakylHgplcSr6uhDVMsVE8h1DfqWUdFs8W\nWx3Utib491V1n0QAStg4hSZvHpC3mlQAoI7hA1pqlQ/n5wi924ey4aQeqDSjC5Br\ngZu8rJFpVNHtRwl1xxKbbqJ0gMHB4GLdj7romKAw+mFWCNuhu4doGuRmFkUVpSNl\nfu7a08bgrK5KHPhlOv/35pgj/5zNb5XVfnbpJGjZWV0obydeDbiX1D1wpyY4M0SZ\neP5FhHZDM1C7E5RxRAb5ALscyseyx0hDn9NmltDRVB35Heamg4WVMkMNKpfSoNey\nJlePXA29DlUEeaoU1OU6xaQi8aq+p+xCD02eXN7Q3XcdN1zbB8objyxf8tKjHSZy\nFBKwikUehrIubNozbBlpAhETcSQHHDnDlJ4SR9NHnMPg8/D66kUuYz/Qut/eujns\nuH+6di/0m6AHB7mcKz9C2XD7RiwuAGDS5vTLb5wNbJSsIZqWwDA=\n=/iMR\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b52d54736168bed82775e3c9e66c6320c7b83626",
          "sha": "b52d54736168bed82775e3c9e66c6320c7b83626",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b52d54736168bed82775e3c9e66c6320c7b83626"
        }
      ],
      "message": "test: never return true from GetCoins for spent entries",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:55:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:02:49Z"
      },
      "sha": "bf382f5a72edad056ab95b9ec18b51d0c58e876f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJhYTlkZDI0MDg2NDU4MWU3ZGVjNjIyZTcwZTE0OTVlNjJhYzMyOTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/baa9dd240864581e7dec622e70e1495e62ac3299",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/baa9dd240864581e7dec622e70e1495e62ac3299",
      "tree": {
        "sha": "0d4d95b80f6c8803e0f0707075651621e96d66ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0d4d95b80f6c8803e0f0707075651621e96d66ee"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0d4d95b80f6c8803e0f0707075651621e96d66ee\nparent bf382f5a72edad056ab95b9ec18b51d0c58e876f\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015034 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725126953 -0400\n\ncoins: Assume coins returned from GetCoin cannot be spent\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTWSkACgkQYAB6/Ik4\nsBjZ7A/8DB1lXCgucfvDQ1ugtA9n/OaIsmVHfRvUyAKQntKX/sqeCcollAbOdQ5a\nGsNm/VhpiuY0hIqirHe4OLKM+kmdn6eEz0gnVr3LGf1TjZIViU8HnShaDpeKnwPy\nDHJ++yK++LNgpJ83veVi09BVCHhVdIx20iIXJTGfvEHCfF2vwK7CGQtUaFwDXoGN\ny26YIVYbPdqpRTGva1trDIa+WtEG1zOEHF8+4Bf3HMQAg4aa2B+NdXfMuxuuat4j\n/unh8A2eigrRzM0PLl4pUN2JZ+KhgmRPbw8H/fgkMpCj05uYoiTYU+e67zN6Diyy\n0cmxxAvkLJDaTiKGoRDdVFFlMK6Patw+HJBsknPOk+62Oep+7GUzHasnBz8MTwiw\nRkG3Ps9P8YkBODpFa+ggiHetGmi4oxOAdZLVvETZG5UGXNtSKGsDU4HgoavFrNuL\nGLfdxuvyM+52+XjzM/wg8/NI2vRUtppKAYGJWXmcrVG3vbfh7tKjpjU85AhQupI+\nO/i9i7T6S7r2cIg7SjN3dodNwvXksnzOxq4E3Jt664bg1GtLGgdHiYcG+I9tE4/i\ntJeUnxkGLKYuaRUNqBOnKo0swH9exUYenplC/UToTdslLvOaU+B9YeM+kzraHVXn\nKjnTU66bnPm2aQszuR/934ktX8TbiQCmCULJtUAcmpdvbJV3Xic=\n=eA8G\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf382f5a72edad056ab95b9ec18b51d0c58e876f",
          "sha": "bf382f5a72edad056ab95b9ec18b51d0c58e876f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bf382f5a72edad056ab95b9ec18b51d0c58e876f"
        }
      ],
      "message": "coins: Assume coins returned from GetCoin cannot be spent",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:55:53Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:03:54Z"
      },
      "sha": "baa9dd240864581e7dec622e70e1495e62ac3299"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDczZWE5NWExNDRmZGVlZWI0Y2ZiMTY3OThhZWVhZTZhNDlhOGI5YjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2",
      "tree": {
        "sha": "64bfcef9dbd426a424e151a4b341e8efb9e6efa6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/64bfcef9dbd426a424e151a4b341e8efb9e6efa6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 64bfcef9dbd426a424e151a4b341e8efb9e6efa6\nparent baa9dd240864581e7dec622e70e1495e62ac3299\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015231 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725126953 -0400\n\ncoins: throw errors for non-DIRTY or spent and FRESH coins in BatchWrite\n\nThere are no code paths which add a non-DIRTY entry to the cursor in\nBatchWrite, so we can safely make this a logic error and test for it.\n\nThere are no code paths which add a spent and FRESH coin to the cursor\nin BatchWrite, so we can safely make this a logic error and test for it.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTWSkACgkQYAB6/Ik4\nsBiVlxAAi1YeD3YBKYDllbO13OjFRacNzyr4Q8K1J9EXTQKYawaSsCzwA8buBvil\nL/EGZRVbVEy/VwQP2QrcT7mUv2HcOuEsVcrhyqrXIFANVI0uuJ85jWI5ZTTRfnhr\n6G6NOJ+Y51XxIUvzEnUhVcdULc2v11pBrlJPDq0L1YAfZL960aPXv+yZZ+Os4WQI\nNcLkDV0PzN5nGKB86JT2EDSyCjd7A0SKfaaV0c220Ekz425Nw8MMHLqNrzRD1Bwg\nVWzQcbz0nbDd184tXvYujI4+6NC1LoMpf5alvnFgcHfK1dJNyfDlLDm9/i7A3t5/\n1sqw2jpyzV0pLqPTHrxXYndROe2UBlhrxP0K/iTj2gQGJ+yQNuqS7q2hKGLuL55Q\nunecBTwIrIBqFLNc82ZgM+1CbczSLxN4s5fyHEfL6xseMYfHEuGYJI7kFSTprEmU\nlxJYEdIKTTMZhPMeFJ26eGrMqyMYG3HnqTJjh5WFX2tOpaeHdFlxKQ09zYvYL98E\nB2OS9E4kkBAuoVFSGw0r7fep2Y9AXRo3uP8BOSM1EUHTMW2aN3CpE31WEiVMnJQ/\nIQxkopXehQRnmB5BHf0wWjnIabonNlosDwDsbcMHW5R0KSmlxPXWa/fivfb9m7X6\nVVQxvrdxquREhNJ/9YUPdCYxgprvnVyDBBzmUOBlQrM0GraCh2c=\n=mWbl\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/baa9dd240864581e7dec622e70e1495e62ac3299",
          "sha": "baa9dd240864581e7dec622e70e1495e62ac3299",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/baa9dd240864581e7dec622e70e1495e62ac3299"
        }
      ],
      "message": "coins: throw errors for non-DIRTY or spent and FRESH coins in BatchWrite\n\nThere are no code paths which add a non-DIRTY entry to the cursor in\nBatchWrite, so we can safely make this a logic error and test for it.\n\nThere are no code paths which add a spent and FRESH coin to the cursor\nin BatchWrite, so we can safely make this a logic error and test for it.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:55:53Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:07:11Z"
      },
      "sha": "73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIwNzM3ZGYxMmVkNjkyMjYyNGQzZTc4YmJiMmJjODZlNjEwNTIyY2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b0737df12ed6922624d3e78bbb2bc86e610522cd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b0737df12ed6922624d3e78bbb2bc86e610522cd",
      "tree": {
        "sha": "8ebe1ee063e9dec8f2cae6cde90f7f6d80e198d7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8ebe1ee063e9dec8f2cae6cde90f7f6d80e198d7"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 8ebe1ee063e9dec8f2cae6cde90f7f6d80e198d7\nparent 73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015566 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725126953 -0400\n\ndoc: update comments to reflect possible code paths\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTWSkACgkQYAB6/Ik4\nsBh7Lw//WrU7iW96vuY5YKY70D/WzEvBZTSZyEgRNND5vPBANZo348QcAswalj9N\ndx2riACQOf+iW5PY4BpYKk8qKRkzzVwEFEAPM/CcJp2p1mW72RI8g0lSFLXEsPYj\nENoz0lou5Er22bODjGUE/rVk6ZWnZQ6chuixqBnlDpIV9A07Yuj8QGJYyRRTww62\ner7JFG2BMipEls0ZlKCqD+rUFQJY4W+ElxMDNMvYNHPQZttwVoZTDvtbrG6hMvmw\nG0ALmf0GQd0APl53h4tq8IuhlTTD5Q/Hz02I4lRJaqTj+IJQGO9j6nGQcBGoZxzJ\nphzmn+OBtIgyK4eRIwfkUc8RI2mu5XYNQSgn9UmAraZ7yETVMIUo1YGelj+7M1vA\nksuFy4RDkUKzRSK3sp4kDqna7no1706YJ382Chv/080OMhDSEifzVaPkZnKiFAYu\njWDKX5uxslDU1TxJQPHAUKbWQhmkUAE1fDcUHITQhZ6iuE9MGOECHKZp0/sHKhd1\n02sQQsCg2uRN4JO/L61hqCSZc9zGBp5WzwIDVswYFwwTRhp8NZPrNe+kZVdlH0Af\nq4SYbjyBshhjIkrGwZfLBZ7Z6CYEJEfSiATo7UyQghQfOX5bKk15ofCOIxbSoO9D\n7hBkv8UuI/xMrqhgY8fEeaL5FCaHWyVl8GgtUWYANcDu0JUPrS8=\n=UQQn\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2",
          "sha": "73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/73ea95a144fdeeeb4cfb16798aeeae6a49a8b9b2"
        }
      ],
      "message": "doc: update comments to reflect possible code paths",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T17:55:53Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:12:46Z"
      },
      "sha": "b0737df12ed6922624d3e78bbb2bc86e610522cd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRlYTI3ZWIwMjNiNmYyMGNmMjRiNDhmZTc1M2ZjN2U0ZTU3ZmM2NDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ea27eb023b6f20cf24b48fe753fc7e4e57fc647",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4ea27eb023b6f20cf24b48fe753fc7e4e57fc647",
      "tree": {
        "sha": "2c28ac2f6b611c1ee6e10aa69cb109513bd47a91",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2c28ac2f6b611c1ee6e10aa69cb109513bd47a91"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2c28ac2f6b611c1ee6e10aa69cb109513bd47a91\nparent b0737df12ed6922624d3e78bbb2bc86e610522cd\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015624 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725131694 -0400\n\ncoins: remove redundant IsDirty checks in BatchWrite\n\nIt is no longer possible to get non-DIRTY entries in BatchWrite\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTa64ACgkQYAB6/Ik4\nsBi8ww/+NyVWpIloJXm/RYyfnDz91ZZPhZ7IBWBXnsN6aNwa8D8Xp5+iZnFYgToX\nDwzRzo0r3vV81AuuelMTv2PQkIn+Rzc/VYyaGH0CxsM2cmPwEAg1gx1qSLaa6ne0\nregNbtLS7U8Woy699Mxv1NCRFMJdNuwPYSrRb/jTyjhOJfzfKL2WLi4Gypjov832\nBPLqPI5xyzMH7ORFW3zjD+DwnwzDBWvY9xGIRnPvnZPXa4GRPmIjDZySapm8qqJp\nt78+n4dO8H0kYFAtdmG/6NZT93FfDm+LHeKiWR7t6QFp1Ex2/kN0LxP9G702YY0k\nXfV84vsrBDLKFMT5HktS1SyPpty692Hwdw9ghxpGkAEX1YFaDSxgmNO/lBcVGrzs\nO54dwzi43tPvCqLVRlDjzoe1aRDrPdHRopZRH2CqSDRgAQB7C3ekTxOpdiA183i4\nSdHbDrvKOnEmFNa5RXE6SzFYVVQaLXVpP6+0ybaS1vSmg8y1AKPVX3YbMJZ8DsZl\nJ8VEn1+R2nIlNlw3ea+ngo/QFLTNG/iTqj8YwVslKFZVWAFBEbsA6gKgx05VY4+/\noAsKNUEFzP8qxluxgwwyV83pJOc4GMxEl4Fje4vh6xXSaxeQ2+MjjxNI500z4akD\nO35JI+UU4I1Co/letgc0kyv0hsOzML89xG6ZDzZl9v1qxPfyDpo=\n=/kwy\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b0737df12ed6922624d3e78bbb2bc86e610522cd",
          "sha": "b0737df12ed6922624d3e78bbb2bc86e610522cd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b0737df12ed6922624d3e78bbb2bc86e610522cd"
        }
      ],
      "message": "coins: remove redundant IsDirty checks in BatchWrite\n\nIt is no longer possible to get non-DIRTY entries in BatchWrite",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:14:54Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:13:44Z"
      },
      "sha": "4ea27eb023b6f20cf24b48fe753fc7e4e57fc647"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBhNTgwMjNjZDhmNDdkZDZmZmI2YjdkOTUwODAyMDJiODM0NzE3NjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0a58023cd8f47dd6ffb6b7d95080202b83471765",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0a58023cd8f47dd6ffb6b7d95080202b83471765",
      "tree": {
        "sha": "0c1f7c9234023486aa09f8f31462eab7cce695cb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0c1f7c9234023486aa09f8f31462eab7cce695cb"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 0c1f7c9234023486aa09f8f31462eab7cce695cb\nparent 4ea27eb023b6f20cf24b48fe753fc7e4e57fc647\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015712 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725131694 -0400\n\ncoins: remove IsFresh check in Uncache\n\nIt is not possible for an entry to be FRESH if not already DIRTY.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTa64ACgkQYAB6/Ik4\nsBgSXQ/+POp70De1DkHz7muQMiYFEy6b5dsfXG6ELMCh1YpqCqxn0x6zPpsH83lW\njP5TMexY0jdcX8jU5lx1MV63ELGJK6lGWDjh2x+yfSWRe+RJ4tXWNS+byJMGMCVP\nhWuK2+qyQmpAWCDQee7k0M8HV5TFxOm8edtfpHZznbVNQlRGc3sK1OaonT5RvKI+\ntsbt4D+47gMJgSobQRyjmDWKyaxhbqHhCo+kPN/LkW9+siEj1FFwVMf7k//jv3OG\nmekrqW2Eirs8aJD8av5c8QpnDmT8GIlT5mOkKW4KDkoJKnm52kca71fEh97tM+fa\nXVtfU941n82psT8eV4QfQEyrZ+w1x44Cnufl2saL00Wp16vjnLVe6WVUSxDXfyoG\nRDtXsEAifj5juqvlMwwFkhX+G4NwWUiaxVRD5GpqIcewTqBf0gUEg2BPA23d6E+l\nUEe6D4sun++jefN49oDoE/WBnXd+MTMN1WwbMxORQWO8GFuIYZdQ1gpR1zJ4VUKr\nsZbaH/1cb/pLAOn3r36yW2/UudWHTJcfpyh35+XA33nVJhy0QPZ/X0u/pWILIAKI\nxR63IuTC1BQ/t8PXTZ32W/PTUIGhEFn18It42WpYWULycaFg6CZsP0UU5FXtqmX5\n40l5Eao5uEU99Y4RCVrg5nsC8KaWDV4jLlBzVRXzTW0RMSRMkOo=\n=tGB3\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4ea27eb023b6f20cf24b48fe753fc7e4e57fc647",
          "sha": "4ea27eb023b6f20cf24b48fe753fc7e4e57fc647",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4ea27eb023b6f20cf24b48fe753fc7e4e57fc647"
        }
      ],
      "message": "coins: remove IsFresh check in Uncache\n\nIt is not possible for an entry to be FRESH if not already DIRTY.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:14:54Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:15:12Z"
      },
      "sha": "0a58023cd8f47dd6ffb6b7d95080202b83471765"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGM5NWIxZDJmODY2MWJmOTRiZTgyZmY3N2JhMGJkNjAyNDg0YzM4ZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c95b1d2f8661bf94be82ff77ba0bd602484c38e6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c95b1d2f8661bf94be82ff77ba0bd602484c38e6",
      "tree": {
        "sha": "a66b6e089aecc5e7e274752ec0f8ca4c1515cc55",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a66b6e089aecc5e7e274752ec0f8ca4c1515cc55"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a66b6e089aecc5e7e274752ec0f8ca4c1515cc55\nparent 0a58023cd8f47dd6ffb6b7d95080202b83471765\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015831 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725131694 -0400\n\ntest: don't check for FRESH but not DIRTY entries in SanityCheck\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTa64ACgkQYAB6/Ik4\nsBiu1xAAmd3Itd80IQXhIni1Ho/ddchQfy9o3j2IIm8xotb1rS1/stTd99UQXVIA\nip/LgvtdeICL2dLoASBLE9fVjtQHXsa9LW9XRY12Any1i6EZ/cIU6W6WjCnxRPo0\naEJsKWT3wor3Ij0kU90FO8eGWXj3oxSlNys9Z1erRQ8WQqnOKvNssUlAyzfZMOAm\nd4WZSTT/NIxpEZYBuVlnhBL6fNjLPEu6DiWQETiJKWqJDMAg6WRfObbCn88Dasve\naH5b6sxxP2rRZydyJdSQ1ffdY+ZZ5h1/TtziVLp6uNMEggtFt+qxlYOPfWtNU89e\nACJ/avQzOx1sdY2jNN/WcxoNW5fMPDQUrc36/njMq2puphdWYLh6Coo0CnjUHa8p\nwLRRf+nnvL755wJata8SV2NIaK06BHNYGPg/UGpNidwwG/NoCSGv5CP7/7hgEtAw\n6mxmEMKtAIiGaGrBZsNrXYRl0uPupdrZZ6mb1MZnRkviDwl39k4XlKXbnuQaCYQf\nwdRkNIq+p1L/oKjCElQ+Ejg2bGH4WL9YXuEaJcM5eKpgv7O4nlzZi4xUALHiSEb/\n3zozMbBgVYSvUtqlAm8HYTimmLDrw3pc2mO0tUE7YY7YlPG8mTDHduO6wPnTPpqI\nZNJ+e7BDYT4nJncTC8oIU5AUaMkOje0apCiVKFkZSQv7Ci+0Wr0=\n=VqWI\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0a58023cd8f47dd6ffb6b7d95080202b83471765",
          "sha": "0a58023cd8f47dd6ffb6b7d95080202b83471765",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0a58023cd8f47dd6ffb6b7d95080202b83471765"
        }
      ],
      "message": "test: don't check for FRESH but not DIRTY entries in SanityCheck",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:14:54Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:17:11Z"
      },
      "sha": "c95b1d2f8661bf94be82ff77ba0bd602484c38e6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092490846,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAANH-lhe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092490846",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:15:15Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNjOGM5MThlOTIxYmUxM2VkYzM0MzQ4ZjEzZGU5NGNjNDNhNjYyODg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cc8c918e921be13edc34348f13de94cc43a66288",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cc8c918e921be13edc34348f13de94cc43a66288",
      "tree": {
        "sha": "3a690d55fef4673c6db38ac7b138e311a78e8349",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3a690d55fef4673c6db38ac7b138e311a78e8349"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3a690d55fef4673c6db38ac7b138e311a78e8349\nparent c95b1d2f8661bf94be82ff77ba0bd602484c38e6\nauthor Andrew Toth <andrewstoth@gmail.com> 1725128378 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725133432 -0400\n\ncoins: assume entry is dirty in Next and Prev\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTcngACgkQYAB6/Ik4\nsBhMDw/+IUXLXrJlcCGb4lx3I0Rj4l5NyUNEPm4FP5I4lRdE/aTUroV5Cl5Przw2\nwOsGpmwGCgTMmPAzRVGXq0ckSG/Vg+lULVH9YqNKADLtcozgmUdAoIbrbbsfCyDD\n7PCSodt19/B5KNaIQzInRzO7S+27Ee+w2wVuL7gYYuGWWT+43wWqGZV2JIj1KUDB\nOobXvZ+btBYNT6OwsJ/h9Snuos6web8uyuyAw6nge2w3LbOwdTVFuPU0Yn79q5xl\niE4MfUe/5MhkTgCKk33Wrk1MKTtAqlwMASpcoqoHfUn3zqChzzvoPrh7OOwgdpwi\nce3XDN8mq7bv0Lr6vutcw407YbQx2kGnEg2aUmDdBxt+bO1j+tGmFEyAFQewqn4j\nwjvp673daL4imtoCes/kr/opI8ZPXDl19RbGGS1U73Z3nmRM0HylKcHnifUyAS2C\nSNB767GdMDv56eauThu6NfoYEtC5/vmwDgKbRwF4E4F8Z4VBRytJk0b8Uc6BYD8e\nJXNXOD/bVbegurfcNRF5aZ36xMhVan7hH2MyX2nw1zVsoPT09vcMGt+cM9biHFgf\n8Bc+bsPMdTtS2kksQ2mX0/IGIQmoOi/39yCQKPgACkFF7OQMIwJxpV/uZy0cCW/9\nC4Lbntd/JdAe3kwr29SRHnykZUk1+e3r7DyPrEbiPNHkbkMmYyE=\n=+icW\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c95b1d2f8661bf94be82ff77ba0bd602484c38e6",
          "sha": "c95b1d2f8661bf94be82ff77ba0bd602484c38e6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c95b1d2f8661bf94be82ff77ba0bd602484c38e6"
        }
      ],
      "message": "coins: assume entry is dirty in Next and Prev",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:43:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T18:19:38Z"
      },
      "sha": "cc8c918e921be13edc34348f13de94cc43a66288"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ2N2JkMjgyYWIyZTYxMzkyNDJhMzA4OWJjOWViNTlkOGExMzBiY2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d67bd282ab2e6139242a3089bc9eb59d8a130bcf",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d67bd282ab2e6139242a3089bc9eb59d8a130bcf",
      "tree": {
        "sha": "9ea8348af60028dbf70c934ea5cb9d5262587dbf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9ea8348af60028dbf70c934ea5cb9d5262587dbf"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 9ea8348af60028dbf70c934ea5cb9d5262587dbf\nparent cc8c918e921be13edc34348f13de94cc43a66288\nauthor Andrew Toth <andrewstoth@gmail.com> 1725128412 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725133432 -0400\n\ntest: simplify coins sanity check\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTcngACgkQYAB6/Ik4\nsBhMqw/7BB0f6BaLuKPqRbGn7vTZnIPc7RQ/0Ooi3Nrz0HkOcfTHr3mdhDJfKdrV\nIcEb0FA8GJSmPWlIR3lRb9z9KJNwUe+lHdcmcbJdA4PSokjnKkGQwhzavNvbL6v+\n1Lv/79f1peoa2FBeTjO4qqHkRBFMHaRIjzApek4FNSS0asXbM9e/UKjGBK8fzfFC\nrXgUoh0/glAcbxxqKvtHU54CHeP0GjU1cTpI/BnAgl9cLLuiByIdh8Hbcxt1+KbB\n3wAqX7VUY0PelProadcqYBb92j5uItmM/LmwprABcYJDgrEZFiDNc9GCsg3m79b2\nR1r8pmswE/8x7tqOLPzorqxni5LJZNM5EuHTkx4NMJh2S+oJW6W23Rp/6Gzmupy/\nRXLX2Re708d06fok4NlCWxpCCQvNYUqnh0g9hjH4YKsaj15ERhOUEzDlD8dmz8uX\n3ggHlWlt1MOi7+xLm1ahy2C004kJBozUKdPwpHFV3zwCuf4Is1wRUaYU1kwbRoev\ny5buUhaWHudsnnb6EQWOcj9kwc9Aj+3aFrEzFt1uqOacy5FKxO0Jq1xYit6pZEBI\n5WTp141Uace84MFMBc83qrcR7tNRBZOMRRbOd8qSHa+ATffip9M7vDtL3r29qA/K\nwz0Ibe31c9pxQbXqGhl/NwsgiafZYRxYMYk+EK7NfXdUpU8poUE=\n=LzXV\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cc8c918e921be13edc34348f13de94cc43a66288",
          "sha": "cc8c918e921be13edc34348f13de94cc43a66288",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cc8c918e921be13edc34348f13de94cc43a66288"
        }
      ],
      "message": "test: simplify coins sanity check",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:43:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T18:20:12Z"
      },
      "sha": "d67bd282ab2e6139242a3089bc9eb59d8a130bcf"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdkMmI0OTkyNmNjMjQ1MjIyMTFhZTE4NTkxNTA3MmIyZTM3Y2EzMzQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7d2b49926cc24522211ae185915072b2e37ca334",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7d2b49926cc24522211ae185915072b2e37ca334",
      "tree": {
        "sha": "53f59aa430cec2504bffa1240c3c86b1b2cf4b5e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/53f59aa430cec2504bffa1240c3c86b1b2cf4b5e"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 53f59aa430cec2504bffa1240c3c86b1b2cf4b5e\nparent d67bd282ab2e6139242a3089bc9eb59d8a130bcf\nauthor Andrew Toth <andrewstoth@gmail.com> 1725131481 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1725133432 -0400\n\ncoins: set all inserted spent coins to fresh\n\nA spent coins must be DIRTY, so remove\nreferences to spent but not DIRTY coins.\nThe only way a spent coin can be not DIRTY\nis when creating the CCoinsCacheEntry with\nan empty coin. This can be made more clear\nby setting fresh if inserted, instead of\nchecking if an unspent coin is not DIRTY.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmbTcngACgkQYAB6/Ik4\nsBgJzhAApndkDGzgCmwDAcGhhw2jMlt6K3L5Vhbnhqaz1vhnSncpAiYb0+kU7I8N\nx7Gp4Ba/2Q/JYyh7R+1tcePp2nbcuZpG0+0CUOsFAal6JG1o2HdsilOll4acnm+z\nN7SS7CIjZS2fQ4nKV9XQx1ZBUDGXcSlG4nCodCtMVHxbs8V1udxDmn7RXL+o7ECs\nRE9mY4biBfV3D5crFTUVF7Ve5jho9i+D1KFEFJV58NchYfHU8AFCzgiX/8m++auL\nLPp7UXTIIqISRxt0VQD+zAMjjSZ9K1QdR2ZactG29DNufw7VldN+WH/PAmQlZA2m\nnIDm3oa52bJki/L7qQ9MQQ6aQop1CemSRLHqclj23WsbQ1NxwtvxOWntoqkXSgw7\nILkULfwl551ja5F5QCwD/1E9dA3DIcM+fC7tXAbppIJmhPtmxMfmMlQW570YFEVL\nz1/4aUXrj3xb/hPgQ1bsdtqxlrREw68skpwtgGqylgosWX/1d1KH6gPGmHj9G2TI\nB/lpRU2a2J67OhA85XSWxtinELcxD8WAtYkkggMZ13GMdflu0yGOGHTR3rp0zx9w\nFnpQjzuuUTLl/+Btm/82qRKFkV3wLZA6Wdgm2cboQz0wzYdh/296rap6DQMmkU5h\nnZblGZGU/jsVow1Lqr930qOCQp8o9SOoZlm8ydK7VfuwUmG/IyQ=\n=fsKp\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d67bd282ab2e6139242a3089bc9eb59d8a130bcf",
          "sha": "d67bd282ab2e6139242a3089bc9eb59d8a130bcf",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d67bd282ab2e6139242a3089bc9eb59d8a130bcf"
        }
      ],
      "message": "coins: set all inserted spent coins to fresh\n\nA spent coins must be DIRTY, so remove\nreferences to spent but not DIRTY coins.\nThe only way a spent coin can be not DIRTY\nis when creating the CCoinsCacheEntry with\nan empty coin. This can be made more clear\nby setting fresh if inserted, instead of\nchecking if an unspent coin is not DIRTY.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:43:52Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:11:21Z"
      },
      "sha": "7d2b49926cc24522211ae185915072b2e37ca334"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092535262,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAANH-wXe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092535262",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:43:57Z"
    },
    {
      "event": "labeled",
      "id": 14092535377,
      "node_id": "LE_lADOABII586TWhHVzwAAAANH-wZR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092535377",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:44:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14092660872,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAANH_PCI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092660872",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T21:02:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14092663979,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAANH_Pyr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092663979",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T21:04:20Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2274390022,
      "node_id": "PRR_kwDOABII586HkHAG",
      "url": null,
      "actor": null,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "The unreliability of many of our tests worries me, would you be open to fixing them in a PR before this one?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2274390022",
      "submitted_at": "2024-09-01T16:11:45Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721510656",
      "pull_request_review_id": 2245093564,
      "id": 1721510656,
      "node_id": "PRRC_kwDOABII585mnCsA",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent\n+        Assume(!ret->second.coin.IsSpent());",
      "path": "src/coins.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "when do we throw and when do we `Assume` here?\r\n> \\* Assume is the identity function.\r\n> \\*\r\n> \\* - Should be used to run non-fatal checks. In debug builds it behaves like\r\n> \\*   Assert()/assert() to notify developers and testers about non-fatal errors.\r\n> \\*   In production it doesn't warn or log anything.\r\n> \\* - For fatal errors, use Assert().\r\n\r\nWouldn't this be a fatal error?\r\n\r\nAlternatively, if we want to separate the test runs from production runs, would it maybe make sense to call `SanityCheck` in test&debug mode every time we want to be absolutely sure the state is correct? I know it's expensive, but might be reassuring during testing - and similarly to Assume, would be skipped in prod.",
      "created_at": "2024-08-19T09:47:54Z",
      "updated_at": "2024-08-19T12:55:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721510656",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721510656"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721668812",
      "pull_request_review_id": 2245093564,
      "id": 1721668812,
      "node_id": "PRRC_kwDOABII585mnpTM",
      "diff_hunk": "@@ -325,14 +321,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So basically if we lay out the allowed combinations we'd get:\r\n```C++\r\nassert((!entry.IsDirty() & !entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 0\r\n        (entry.IsDirty() & !entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 1\r\n        (entry.IsDirty() &  entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 3\r\n        (entry.IsDirty() & !entry.IsFresh() &  entry.coin.IsSpent()));   // attr = 5\r\n```\r\nWhich could be simplified to\r\n```C++\r\nassert((entry.IsDirty() && !(entry.coin.IsSpent() && entry.IsFresh())) || !(entry.coin.IsSpent() || entry.IsFresh()));\r\n```\r\nwhich can be laid out as an if expression which would probably document the situation better than `!= 2 && != 4 && != 6 && != 7`:\r\n```C++\r\nif (entry.coin.IsSpent()) {\r\n    assert(entry.IsDirty() && !entry.IsFresh());\r\n} else {\r\n    assert(entry.IsDirty() || !entry.IsFresh());\r\n}\r\n```\r\n\r\n<details><summary>sanity_check_assertions test</summary>\r\n\r\n```C++\r\nBOOST_AUTO_TEST_CASE(sanity_check_assertions)\r\n{\r\n    for (int is_dirty = 0; is_dirty <= 1; ++is_dirty) {\r\n        for (int is_fresh = 0; is_fresh <= 1; ++is_fresh) {\r\n            for (int is_spent = 0; is_spent <= 1; ++is_spent) {\r\n                // Original check\r\n                unsigned attr = 0;\r\n                if (is_dirty) attr |= 1;\r\n                if (is_fresh) attr |= 2;\r\n                if (is_spent) attr |= 4;\r\n                bool original_result = (attr != 2 && attr != 4 && attr != 6 && attr != 7);\r\n\r\n                bool new_result = (!is_dirty & !is_fresh & !is_spent) |  // attr = 0\r\n                                  (is_dirty & !is_fresh & !is_spent) |   // attr = 1\r\n                                  (is_dirty & is_fresh & !is_spent) |    // attr = 3\r\n                                  (is_dirty & !is_fresh & is_spent);     // attr = 5\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n\r\n                new_result = ((is_dirty && !(is_spent && is_fresh)) || !(is_spent || is_fresh));\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n\r\n                if (is_dirty) {\r\n                    new_result = !(is_spent && is_fresh);\r\n                } else {\r\n                    new_result = !(is_spent || is_fresh);\r\n                }\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n</details> \r\n",
      "created_at": "2024-08-19T11:51:32Z",
      "updated_at": "2024-08-24T19:33:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721668812",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721668812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 321,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721727681",
      "pull_request_review_id": 2245093564,
      "id": 1721727681,
      "node_id": "PRRC_kwDOABII585mn3rB",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I was surprised to see that the method called `GetCoin` now:\r\n* overwrites the dummy coin parameter with the value found in the cache\r\n* returns a boolean indicating whether the coin exists in the cache and is not spent (the name doesn't have any hints about it being spent or not)\r\n\r\nI don't mind if you think it's outside the scope of the current change, but checking the usages it seems to me we can now simplify `GetCoin` to actually return the coin and let the callsite check for spent and it might simplify the usages as well:\r\n```C++\r\nstd::optional<Coin> CCoinsViewCache::GetCoin(const COutPoint& outpoint) const\r\n{\r\n    auto it = FetchCoin(outpoint);\r\n    if (it != cacheCoins.end()) {\r\n        return it->second.coin;\r\n    }\r\n    return std::nullopt;\r\n}\r\n```\r\n\r\n<details>\r\n<summary>... and in tests</summary>\r\n```C++\r\nstd::optional<Coin> GetCoin(const COutPoint& outpoint) const\r\n{\r\n    if (const auto [it, found] = m_data.find(outpoint); found) {\r\n        return it->second;\r\n    }\r\n    return std::nullopt;\r\n}\r\n```\r\n</details>\r\n\r\nWhich would simplify usages from e.g.\r\n```C++\r\nCoin coin_using_get_coin;\r\nconst bool exists_using_get_coin = coins_view_cache.GetCoin(random_out_point, coin_using_get_coin);\r\nif (exists_using_get_coin) {\r\n    assert(coin_using_get_coin == coin_using_access_coin);\r\n}\r\nassert((exists_using_access_coin && exists_using_have_coin_in_cache && exists_using_have_coin && exists_using_get_coin) ||\r\n       (!exists_using_access_coin && !exists_using_have_coin_in_cache && !exists_using_have_coin && !exists_using_get_coin));\r\n```\r\nto something like:\r\n```C++\r\nif (auto coin_optional = coins_view_cache.GetCoin(random_out_point); coin_optional && !coin_optional->IsSpent()) {\r\n    assert(*coin_optional == coin_using_access_coin);\r\n    assert(exists_using_access_coin && exists_using_have_coin_in_cache && exists_using_have_coin);\r\n} else {\r\n    assert(!exists_using_access_coin && !exists_using_have_coin_in_cache && !exists_using_have_coin);\r\n}\r\n```\r\n\r\nWhat do you think?",
      "created_at": "2024-08-19T12:41:42Z",
      "updated_at": "2024-08-19T13:19:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721727681",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721727681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721733726",
      "pull_request_review_id": 2245093564,
      "id": 1721733726,
      "node_id": "PRRC_kwDOABII585mn5Je",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        Assume(IsDirty());\r\n```\r\n\r\nnit: it's a cheap call, why not make it an assert instead? Note that after that change the comments will become redundant",
      "created_at": "2024-08-19T12:46:37Z",
      "updated_at": "2024-08-26T09:33:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721733726",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721733726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721738283",
      "pull_request_review_id": 2245093564,
      "id": 1721738283,
      "node_id": "PRRC_kwDOABII585mn6Qr",
      "diff_hunk": "@@ -53,14 +53,11 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {",
      "path": "src/test/coins_tests.cpp",
      "position": 17,
      "original_position": 5,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "946a035cdc298c3168b1164079892a85902c966f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "is this is always the case, consider adding an assertion\r\n```C++\r\nassert(it->second.IsDirty());\r\n```\r\n\r\n(we can remove them in the last commit, but would be useful for the intermediary commits at least)",
      "created_at": "2024-08-19T12:50:13Z",
      "updated_at": "2024-08-19T12:54:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721738283",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721738283"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 66,
      "original_line": 66,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721740165",
      "pull_request_review_id": 2245093564,
      "id": 1721740165,
      "node_id": "PRRC_kwDOABII585mn6uF",
      "diff_hunk": "@@ -275,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {",
      "path": "src/coins.cpp",
      "position": 100,
      "original_position": 4,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "286f841c8e6398766660902338a4d1db0069071f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "same, can we add a (temporary) assertion for the removed check?",
      "created_at": "2024-08-19T12:51:40Z",
      "updated_at": "2024-08-19T13:21:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721740165",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721740165"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721800990",
      "pull_request_review_id": 2245569284,
      "id": 1721800990,
      "node_id": "PRRC_kwDOABII585moJke",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This behavior is documented [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.h#L306-L310), so not sure why test code bothered to do this. Indeed, switching to `std::optional` would be cleaner, but I think a much bigger refactor. This is also suggested in the original PR [here](https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-842393167).",
      "created_at": "2024-08-19T13:35:15Z",
      "updated_at": "2024-08-19T13:35:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721800990",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721800990"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721809523",
      "pull_request_review_id": 2245583004,
      "id": 1721809523,
      "node_id": "PRRC_kwDOABII585moLpz",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> but I think a much bigger refactor\r\n\r\nMaybe, would it help if I did that in a different PR?",
      "created_at": "2024-08-19T13:40:25Z",
      "updated_at": "2024-08-19T13:40:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721809523",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721809523"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721817389",
      "pull_request_review_id": 2245596138,
      "id": 1721817389,
      "node_id": "PRRC_kwDOABII585moNkt",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, but it would conflict heavily with this one. Many of the tests would have to be removed as well.",
      "created_at": "2024-08-19T13:45:09Z",
      "updated_at": "2024-08-19T13:45:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721817389",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721817389"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721879299",
      "pull_request_review_id": 2245697067,
      "id": 1721879299,
      "node_id": "PRRC_kwDOABII585mocsD",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm fine with that, extracted to a branch for now, will push as a draft after your PR stabilizes ",
      "created_at": "2024-08-19T14:24:09Z",
      "updated_at": "2024-08-19T14:24:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721879299",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721879299"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722285129",
      "pull_request_review_id": 2246356092,
      "id": 1722285129,
      "node_id": "PRRC_kwDOABII585mp_xJ",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "you can resolve this comment, I see now that this should definitely be investigated in a separate PR (it's a big change).",
      "created_at": "2024-08-19T19:59:56Z",
      "updated_at": "2024-08-19T19:59:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722285129",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722285129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722286606",
      "pull_request_review_id": 2246358443,
      "id": 1722286606,
      "node_id": "PRRC_kwDOABII585mqAIO",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It doesn't sound like it's `GetCoin`'s responsibility, I think the call-sites should be checking for whether the coins are spent or not, not the cache accessor method",
      "created_at": "2024-08-19T20:01:26Z",
      "updated_at": "2024-08-19T21:20:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722286606",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722286606"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722535036",
      "pull_request_review_id": 2246751794,
      "id": 1722535036,
      "node_id": "PRRC_kwDOABII585mq8x8",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think you can resolve your own comment threads too ðŸ˜‰",
      "created_at": "2024-08-20T00:18:18Z",
      "updated_at": "2024-08-20T00:18:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722535036",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722535036"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722578637",
      "pull_request_review_id": 2246814506,
      "id": 1722578637,
      "node_id": "PRRC_kwDOABII585mrHbN",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It's specifically documented that this is the behavior. Why shouldn't we be able to rely on it?",
      "created_at": "2024-08-20T01:39:34Z",
      "updated_at": "2024-08-20T01:39:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722578637",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722578637"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722716550",
      "pull_request_review_id": 2247013328,
      "id": 1722716550,
      "node_id": "PRRC_kwDOABII585mrpGG",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 13,
      "original_position": 13,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't have write access to your PR:\r\nhttps://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews#resolving-conversations",
      "created_at": "2024-08-20T05:42:04Z",
      "updated_at": "2024-08-20T05:42:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722716550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722716550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722725094",
      "pull_request_review_id": 2247026258,
      "id": 1722725094,
      "node_id": "PRRC_kwDOABII585mrrLm",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If we need to document the behavior of a method, it suggests that weâ€™ve acknowledged it may not be intuitive for everyone, indicating that weâ€™ve conceded on finding a better design.\r\nI think there's a way we can avoid the comment: by separating the two concerns of getting a value from cache and checking if it's spent or not.\r\nOr if you insist, we can call it \"GetUnspent\" in which case we can also get rid of the comment and call-site asserts and keep the current behavior.\r\nWhat do you think?",
      "created_at": "2024-08-20T05:53:30Z",
      "updated_at": "2024-08-20T05:53:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722725094",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722725094"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723632249",
      "pull_request_review_id": 2248528707,
      "id": 1723632249,
      "node_id": "PRRC_kwDOABII585mvIp5",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "What you are suggesting is basically a concept NACK on this PR. If we aren't confident that we will never get a spent coin from GetCoin, then we need to keep the logic to handle spent and FRESH coins.",
      "created_at": "2024-08-20T16:40:22Z",
      "updated_at": "2024-08-20T16:40:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723632249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723632249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723636084",
      "pull_request_review_id": 2248534125,
      "id": 1723636084,
      "node_id": "PRRC_kwDOABII585mvJl0",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@paplorinc I feel your criticism here is about the naming/expectations/documentation of the existing code, rather than about this PR. Do you feel that addressing that first should be a blocker for this PR?",
      "created_at": "2024-08-20T16:43:09Z",
      "updated_at": "2024-08-20T16:43:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723636084",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723636084"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723665550",
      "pull_request_review_id": 2248581119,
      "id": 1723665550,
      "node_id": "PRRC_kwDOABII585mvQyO",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I won't block this since I'm fine with discussing/addressing any issues in later commits as well. \r\nI also don't yet understand the second order effects of these changes, so treat my comments as curious observations.\r\n\r\nSo my concern is that in this PR we're tying `coin.IsSpent()` with retrieving values from the cache.\r\nSo if my understanding is correct we should either:\r\n* be able to get a coin from the cache and ignore/assert whether it's spent or not - e.g. [`HaveCoin`](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L21) will now return false when the cache contains it but it's spent... and if that's not possible in certain situations I would assert instead of returning the boolean.\r\nSo in that case `GetCoin` would just get it from the cache and the call-site will decide whether it should assert for `IsSpent` or branch based on it, something like this: https://github.com/bitcoin/bitcoin/blob/9db8b30788eff2b8e9c9f629a6a03886a28a3281/src/test/fuzz/coins_view.cpp#L167\r\n* rename the method to reflect the new responsibility that it has\r\n\r\nThere's also a third possibility that I'm completely off on what this PR does - your patience is appreciated :)",
      "created_at": "2024-08-20T17:06:19Z",
      "updated_at": "2024-08-20T17:06:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723665550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723665550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727754817",
      "pull_request_review_id": 2255567815,
      "id": 1727754817,
      "node_id": "PRRC_kwDOABII585m-3JB",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "@l0rinc It seems to me like you are thinking this PR has some behavior change. Any coin retrieved from `GetCoin` will be unspent if `GetCoin` returns true. You can follow this logically from seeing the return value [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L65) and then the only base class is `CCoinsViewDB` which [does not save spent coins](https://github.com/bitcoin/bitcoin/blob/master/src/txdb.cpp#L120-L121) so cannot retrieve them in `GetCoin`.\r\n\r\nThis PR is recognizing that `FetchCoin` logically cannot get to [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L52) with a spent coin. [This](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L54) is a dead code path.",
      "created_at": "2024-08-22T20:13:28Z",
      "updated_at": "2024-08-22T20:19:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1727754817",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727754817"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727769365",
      "pull_request_review_id": 2255589561,
      "id": 1727769365,
      "node_id": "PRRC_kwDOABII585m-6sV",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yeah, I understand that.\r\n\r\nWhat I'm struggling with is the cache retrieval, and especially the invalidation logic, which seems to be scattered throughout the code and tightly coupled with the business logic.\r\n\r\nWould you be open to a screen-sharing session to discuss this? It would help me better understand the constraints and likely speed up my review process as well.",
      "created_at": "2024-08-22T20:26:40Z",
      "updated_at": "2024-08-22T20:26:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1727769365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727769365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730941804",
      "pull_request_review_id": 2260190262,
      "id": 1730941804,
      "node_id": "PRRC_kwDOABII585nLBNs",
      "diff_hunk": "@@ -114,17 +113,13 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\n     batch.Erase(DB_BEST_BLOCK);\n     batch.Write(DB_HEAD_BLOCKS, Vector(hashBlock, old_tip));\n \n-    for (auto it{cursor.Begin()}; it != cursor.End();) {\n-        if (it->second.IsDirty()) {\n-            CoinEntry entry(&it->first);\n-            if (it->second.coin.IsSpent())\n-                batch.Erase(entry);\n-            else\n-                batch.Write(entry, it->second.coin);\n-            changed++;\n-        }\n+    for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {",
      "path": "src/txdb.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "+1 for moving the mutation to the loop\r\nnit: for [consistency](https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md?plain=1#L76-L79) consider adding braces to the condition",
      "created_at": "2024-08-26T09:05:39Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1730941804",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730941804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 116,
      "original_line": 116,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730970736",
      "pull_request_review_id": 2260190262,
      "id": 1730970736,
      "node_id": "PRRC_kwDOABII585nLIRw",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);\n         return m_next;\n     }\n \n-    //! Only call Prev when this entry is DIRTY, FRESH, or both\n+    //! Only call Prev when this entry is DIRTY\n     inline CoinsCachePair* Prev() const noexcept {",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 34,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md?plain=1#L70",
      "created_at": "2024-08-26T09:27:39Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1730970736",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730970736"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 187,
      "original_line": 187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731011814",
      "pull_request_review_id": 2260190262,
      "id": 1731011814,
      "node_id": "PRRC_kwDOABII585nLSTm",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {\n         auto it = m_data.find(outpoint);\n         if (it == m_data.end()) {\n-            if ((outpoint.n % 5) == 3) {\n-                coin.Clear();\n-                return true;\n-            }\n             return false;\n         } else {\n             coin = it->second;",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 22,
      "original_position": 22,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The docs state:\r\n> When false is returned, coin's value is unspecified.\r\n\r\nEventually I hope we can untangle these two \"return values\" (coin & spentness), but temporarily maybe we can improve this guarantee (since I'm very much against unspecified mutations of non-local state) so that we only set the value of coin when it's unspent (similarly to how `Uncache` handles this case), e.g.:\r\n```C++\r\nbool GetCoin(const COutPoint& outpoint, Coin& coin) const final\r\n{\r\n    if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) {\r\n        coin = it->second;\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n```",
      "created_at": "2024-08-26T09:58:51Z",
      "updated_at": "2024-08-26T11:52:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731011814",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731011814"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731019220",
      "pull_request_review_id": 2260190262,
      "id": 1731019220,
      "node_id": "PRRC_kwDOABII585nLUHU",
      "diff_hunk": "@@ -883,8 +875,13 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     for (const CAmount parent_value : {ABSENT, SPENT, VALUE1})\n         for (const CAmount child_value : {ABSENT, SPENT, VALUE2})\n             for (const char parent_flags : parent_value == ABSENT ? ABSENT_FLAGS : FLAGS)\n-                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS)\n-                    CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n+                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS) {\n+                    if (child_flags == FRESH) {",
      "path": "src/test/coins_tests.cpp",
      "position": 89,
      "original_position": 79,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: are we repeating business logic here? Can we make it more black-box somehow?",
      "created_at": "2024-08-26T10:04:50Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731019220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731019220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 889,
      "original_line": 889,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731020615",
      "pull_request_review_id": 2260190262,
      "id": 1731020615,
      "node_id": "PRRC_kwDOABII585nLUdH",
      "diff_hunk": "@@ -341,7 +338,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());",
      "path": "src/coins.cpp",
      "position": 137,
      "original_position": 102,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "this will be redundant once we assert it in Prev and Next",
      "created_at": "2024-08-26T10:06:08Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731020615",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731020615"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 340,
      "original_line": 340,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731021714",
      "pull_request_review_id": 2260190262,
      "id": 1731021714,
      "node_id": "PRRC_kwDOABII585nLUuS",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": 101,
      "original_position": 75,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: can be modernized to (note: can likely be deduplicated with `GetCoin`):\r\n```suggestion\r\n    if (auto it = cacheCoins.find(hash); it != cacheCoins.end() && !it->second.IsDirty()) {\r\n```",
      "created_at": "2024-08-26T10:07:08Z",
      "updated_at": "2024-08-26T13:40:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731021714",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731021714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 275,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": 276,
      "original_line": 276,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731055682",
      "pull_request_review_id": 2260190262,
      "id": 1731055682,
      "node_id": "PRRC_kwDOABII585nLdBC",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I'm having a hard time with https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L97, where the coin is obviously spent and can also be non-dirty (according to `updatecoins_simulation_test`, `ccoins_flush_behavior` and others), which violates `attr != 4`.\r\n\r\nIf it's valid for coin to (temporarily?) have that state, shouldn't `SanityCheck` allow it?\r\n\r\nOr if this is the state when the parent-cache gets invalidated because of a re-org, could we maybe simplify the possible states by always Sync-ing when a reorg is detected and/or only deleting spent entries from parent after a certain block maturity?",
      "created_at": "2024-08-26T10:39:21Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731055682",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731055682"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731100729",
      "pull_request_review_id": 2260190262,
      "id": 1731100729,
      "node_id": "PRRC_kwDOABII585nLoA5",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "So my understanding is that if a coin is already spent it's basically \"less likely\" to be in the cache (0% without [reorgs](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L84-L96), right?), so we want to get rid of it ASAP to have more likely cache hits.\r\nGiven that the complete UTXO set doesn't fit into memory anymore, would it maybe make sense to have a more complex retainment heuristic for each cache layer, e.g. spentness, recency, dust amount, unspendables, time-locked, etc?",
      "created_at": "2024-08-26T11:24:13Z",
      "updated_at": "2024-08-26T15:07:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731100729",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731100729"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731101997",
      "pull_request_review_id": 2260190262,
      "id": 1731101997,
      "node_id": "PRRC_kwDOABII585nLoUt",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 50,
      "original_position": 24,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I find it inconsistent that we're throwing here only for testability - since we assume this cannot happen in reality.\r\nBasically, this is another \"return value\" of the method, so declaring it a `bool` was essentially a lie (especially since it always seems to just return `true`).\r\nCould we use the return value instead to signal failure (and since we think this is impossible, skip the error messages)?",
      "created_at": "2024-08-26T11:25:28Z",
      "updated_at": "2024-08-26T13:41:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731101997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731101997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 184,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731108975",
      "pull_request_review_id": 2260190262,
      "id": 1731108975,
      "node_id": "PRRC_kwDOABII585nLqBv",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;\n+            CCoinsCacheEntry& entry{itUs->second};\n+            if (cursor.WillErase(*it)) {\n+                // Since this entry will be erased,\n+                // we can move the coin into us instead of copying it\n+                entry.coin = std::move(it->second.coin);\n+            } else {\n+                entry.coin = it->second.coin;\n+            }\n+            cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n+            entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n+            // We can mark it FRESH in the parent if it was FRESH in the child\n+            // Otherwise it might have just been flushed from the parent's cache\n+            // and already exist in the grandparent\n+            if (it->second.IsFresh()) {\n+                entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n             }",
      "path": "src/coins.cpp",
      "position": 93,
      "original_position": 67,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Instead of calling `AddFlags` twice, in [other cases](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L100) we've compressed this into a single line:\r\n```suggestion\r\n            entry.AddFlags(CCoinsCacheEntry::DIRTY | (it->second.IsFresh() ? CCoinsCacheEntry::FRESH : 0), *itUs, m_sentinel);\r\n```",
      "created_at": "2024-08-26T11:31:50Z",
      "updated_at": "2024-08-26T11:54:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731108975",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731108975"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 204,
      "original_start_line": 206,
      "start_side": "RIGHT",
      "line": 210,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731110623",
      "pull_request_review_id": 2260190262,
      "id": 1731110623,
      "node_id": "PRRC_kwDOABII585nLqbf",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;",
      "path": "src/coins.cpp",
      "position": 77,
      "original_position": 51,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Now that this structure is simpler, we could modernize (and optimize) this `find` / `try_emplace` construct as:\r\n```C++\r\nauto [itUs, inserted] = cacheCoins.try_emplace(it->first);\r\nif (inserted) {\r\n```",
      "created_at": "2024-08-26T11:33:30Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731110623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731110623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 189,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": 194,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739894024",
      "pull_request_review_id": 2274110468,
      "id": 1739894024,
      "node_id": "PRRC_kwDOABII585ntK0I",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 50,
      "original_position": 24,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This can happen in our fuzz tests. I think a follow up to this change would be to remove direct access to the flags, and replace with methods `SetDirty` and `SetDirtyAndFresh`. Then we can get rid of fuzzing all kinds of flags and simplify this.",
      "created_at": "2024-08-31T18:15:39Z",
      "updated_at": "2024-08-31T18:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739894024",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739894024"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 184,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739895229",
      "pull_request_review_id": 2274112490,
      "id": 1739895229,
      "node_id": "PRRC_kwDOABII585ntLG9",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;",
      "path": "src/coins.cpp",
      "position": 77,
      "original_position": 51,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731110623,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, that would be a good follow up!",
      "created_at": "2024-08-31T18:17:35Z",
      "updated_at": "2024-08-31T18:17:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739895229",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739895229"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 189,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": 194,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908195",
      "pull_request_review_id": 2274130096,
      "id": 1739908195,
      "node_id": "PRRC_kwDOABII585ntORj",
      "diff_hunk": "@@ -325,14 +321,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": 1721668812,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:18:35Z",
      "updated_at": "2024-08-31T19:18:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908195",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 321,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908200",
      "pull_request_review_id": 2274130115,
      "id": 1739908200,
      "node_id": "PRRC_kwDOABII585ntORo",
      "diff_hunk": "@@ -53,14 +53,11 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {",
      "path": "src/test/coins_tests.cpp",
      "position": 17,
      "original_position": 5,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "946a035cdc298c3168b1164079892a85902c966f",
      "in_reply_to_id": 1721738283,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:18:42Z",
      "updated_at": "2024-08-31T19:18:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 66,
      "original_line": 66,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908500",
      "pull_request_review_id": 2274130348,
      "id": 1739908500,
      "node_id": "PRRC_kwDOABII585ntOWU",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731055682,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "A coin cannot be spent and not DIRTY. I made a new commit to address this in AddCoin. The only time it will be in this state is when a `CCoinsViewCacheEntry` is constructed with an empty coin, which then has the coin moved into it a few lines later.\r\n\r\nI think doing a follow up where we remove direct access to flags can remove a lot of code paths that we test for.",
      "created_at": "2024-08-31T19:20:55Z",
      "updated_at": "2024-08-31T19:20:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908500",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908500"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908616",
      "pull_request_review_id": 2274130449,
      "id": 1739908616,
      "node_id": "PRRC_kwDOABII585ntOYI",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;\n+            CCoinsCacheEntry& entry{itUs->second};\n+            if (cursor.WillErase(*it)) {\n+                // Since this entry will be erased,\n+                // we can move the coin into us instead of copying it\n+                entry.coin = std::move(it->second.coin);\n+            } else {\n+                entry.coin = it->second.coin;\n+            }\n+            cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n+            entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n+            // We can mark it FRESH in the parent if it was FRESH in the child\n+            // Otherwise it might have just been flushed from the parent's cache\n+            // and already exist in the grandparent\n+            if (it->second.IsFresh()) {\n+                entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n             }",
      "path": "src/coins.cpp",
      "position": 93,
      "original_position": 67,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731108975,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think I only touch this in whitespace, so I don't want to refactor this right now.",
      "created_at": "2024-08-31T19:21:46Z",
      "updated_at": "2024-08-31T19:21:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908616",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908616"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 204,
      "original_start_line": 206,
      "start_side": "RIGHT",
      "line": 210,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908771",
      "pull_request_review_id": 2274130608,
      "id": 1739908771,
      "node_id": "PRRC_kwDOABII585ntOaj",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> Given that the complete UTXO set doesn't fit into memory anymore, would it maybe make sense to have a more complex retainment heuristic for each cache layer,\r\n\r\nSince we now have a linked list of entries, we could have another sentinel that tracks coins that have their flags cleared. Then, when doing a flush we could just remove a chunk from the bottom of the linked list (entries added least recently).",
      "created_at": "2024-08-31T19:23:33Z",
      "updated_at": "2024-08-31T19:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908771",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908812",
      "pull_request_review_id": 2274130668,
      "id": 1739908812,
      "node_id": "PRRC_kwDOABII585ntObM",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": 1721733726,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:24:13Z",
      "updated_at": "2024-08-31T19:24:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908812",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739909068",
      "pull_request_review_id": 2274130842,
      "id": 1739909068,
      "node_id": "PRRC_kwDOABII585ntOfM",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent\n+        Assume(!ret->second.coin.IsSpent());",
      "path": "src/coins.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": 1721510656,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "It would be a fatal error when running in DEBUG mode, but is not compiled in for release.\r\n\r\n> when do we throw and when do we Assume here?\r\n\r\nI only added throws to `BatchWrite` because there are invalid states that can happen in our fuzz test harness which we want to handle properly. A follow up to remove setting the flags directly can help make that more clear and we wouldn't need to have the throws there anymore.",
      "created_at": "2024-08-31T19:26:00Z",
      "updated_at": "2024-08-31T19:26:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739909068",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739909068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740112856",
      "pull_request_review_id": 2274390022,
      "id": 1740112856,
      "node_id": "PRRC_kwDOABII585nuAPY",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": 1721733726,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't see it in `doc: update comments to reflect possible code paths` (b0737df12ed6922624d3e78bbb2bc86e610522cd)",
      "created_at": "2024-09-01T14:08:25Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740112856",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740112856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118331",
      "pull_request_review_id": 2274390022,
      "id": 1740118331,
      "node_id": "PRRC_kwDOABII585nuBk7",
      "diff_hunk": "@@ -79,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin",
      "path": "src/coins.cpp",
      "position": 14,
      "original_position": 14,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "can this still happen during a reorg? The comment here is really scary, do we really need so much context here? I'd prefer a test that fails when the code is wrong instead of a really long description...",
      "created_at": "2024-09-01T14:23:11Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740118331",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118331"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 88,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118813",
      "pull_request_review_id": 2274390022,
      "id": 1740118813,
      "node_id": "PRRC_kwDOABII585nuBsd",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "comment states exactly what the code already states - it's just noise, can be removed",
      "created_at": "2024-09-01T14:24:28Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740118813",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118813"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131338",
      "pull_request_review_id": 2274390022,
      "id": 1740131338,
      "node_id": "PRRC_kwDOABII585nuEwK",
      "diff_hunk": "@@ -81,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin\n         // is 'spent' when the block adding it is disconnected and then\n         // re-added when it is also added in a newly connected block).\n         //\n-        // If the coin doesn't exist in the current cache, or is spent but not\n-        // DIRTY, then it can be marked FRESH.\n-        fresh = !it->second.IsDirty();\n+        // If the coin doesn't exist in the current cache then it can be marked FRESH.\n+        fresh = inserted;",
      "path": "src/coins.cpp",
      "position": 35,
      "original_position": 35,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The freshness flag depend on `inserted`, `possible_overwrite` and `it->second.coin.IsSpent()`, assigned and validated in different places.\r\nCould we obviate the freshness flag calculation instead with something like:\r\n```C++\r\nbool fresh_flag = inserted && !possible_overwrite ? CCoinsCacheEntry::FRESH : 0;\r\n```\r\n\r\nEither here or in a follow-up we could simplify & modernize the method to something like:\r\n```C++\r\nvoid CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possible_overwrite) {\r\n    assert(!coin.IsSpent());\r\n    if (coin.out.scriptPubKey.IsUnspendable()) return;\r\n\r\n    auto [it, inserted] = cacheCoins.try_emplace(outpoint);\r\n    if (!inserted) {\r\n        if (!possible_overwrite && !it->second.coin.IsSpent()) throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\r\n        cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n    }\r\n    cachedCoinsUsage += coin.DynamicMemoryUsage();\r\n    it->second.coin = std::move(coin);\r\n\r\n    bool fresh_flag = inserted && !possible_overwrite ? CCoinsCacheEntry::FRESH : 0;\r\n    it->second.AddFlags(CCoinsCacheEntry::DIRTY | fresh_flag, *it, m_sentinel);\r\n\r\n    TRACE5(utxocache, add,\r\n           outpoint.hash.data(),\r\n           (uint32_t) outpoint.n,\r\n           (uint32_t) it->second.coin.nHeight,\r\n           (int64_t) it->second.coin.out.nValue,\r\n           (bool) it->second.coin.IsCoinBase());\r\n}\r\n```",
      "created_at": "2024-09-01T14:51:11Z",
      "updated_at": "2024-09-01T16:12:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740131338",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131338"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131622",
      "pull_request_review_id": 2274390022,
      "id": 1740131622,
      "node_id": "PRRC_kwDOABII585nuE0m",
      "diff_hunk": "@@ -184,34 +180,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {",
      "path": "src/coins.cpp",
      "position": 55,
      "original_position": 55,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "still think we should add an assertion here (temporarily at least)",
      "created_at": "2024-09-01T14:51:49Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740131622",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131622"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 195,
      "original_line": 195,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740132832",
      "pull_request_review_id": 2274390022,
      "id": 1740132832,
      "node_id": "PRRC_kwDOABII585nuFHg",
      "diff_hunk": "@@ -341,7 +338,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());",
      "path": "src/coins.cpp",
      "position": 137,
      "original_position": 102,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731020615,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We can remove this now",
      "created_at": "2024-09-01T14:54:05Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740132832",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740132832"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 340,
      "original_line": 340,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740133264",
      "pull_request_review_id": 2274390022,
      "id": 1740133264,
      "node_id": "PRRC_kwDOABII585nuFOQ",
      "diff_hunk": "@@ -184,15 +177,15 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY",
      "path": "src/coins.h",
      "position": 26,
      "original_position": 26,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "the comments are redundant now, the code already makes this clear",
      "created_at": "2024-09-01T14:54:46Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740133264",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740133264"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 180,
      "original_line": 180,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740133407",
      "pull_request_review_id": 2274390022,
      "id": 1740133407,
      "node_id": "PRRC_kwDOABII585nuFQf",
      "diff_hunk": "@@ -184,15 +177,15 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n-        Assume(m_flags);\n+        Assume(IsDirty());\n         return m_next;\n     }\n \n-    //! Only call Prev when this entry is DIRTY, FRESH, or both\n+    //! Only call Prev when this entry is DIRTY",
      "path": "src/coins.h",
      "position": 34,
      "original_position": 34,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "same",
      "created_at": "2024-09-01T14:55:00Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740133407",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740133407"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 186,
      "original_line": 186,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740141831",
      "pull_request_review_id": 2274390022,
      "id": 1740141831,
      "node_id": "PRRC_kwDOABII585nuHUH",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": 8,
      "original_position": 8,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That sounds like a really good idea that we should investigate after this PR!",
      "created_at": "2024-09-01T15:16:18Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740141831",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740141831"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740147320",
      "pull_request_review_id": 2274390022,
      "id": 1740147320,
      "node_id": "PRRC_kwDOABII585nuIp4",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */",
      "path": "src/test/coins_tests.cpp",
      "position": 34,
      "original_position": 34,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "unrelated: could `coins_cache_simulation_test`be moved into a fuzz test - or would it be too difficult to track all those states?.\r\nIf you think any of these recommendations can be done in a parallel PR, let me know and I'll do them myself before this is merged",
      "created_at": "2024-09-01T15:30:41Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740147320",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740147320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 787,
      "original_line": 787,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740154464",
      "pull_request_review_id": 2274390022,
      "id": 1740154464,
      "node_id": "PRRC_kwDOABII585nuKZg",
      "diff_hunk": "@@ -892,8 +885,13 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     for (const CAmount parent_value : {ABSENT, SPENT, VALUE1})\n         for (const CAmount child_value : {ABSENT, SPENT, VALUE2})\n             for (const char parent_flags : parent_value == ABSENT ? ABSENT_FLAGS : FLAGS)\n-                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS)\n-                    CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n+                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS) {",
      "path": "src/test/coins_tests.cpp",
      "position": 88,
      "original_position": 88,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I might be completely off here, but in case of e.g. `CheckWriteCoins(ABSENT, SPENT , FAIL  , NO_ENTRY   , DIRTY|FRESH, NO_ENTRY   );` we're calling `.IsDirty()` which returns false, but `m_next` and `m_prev` are set because `CheckWriteCoins` calls them with different flags.\r\n\r\nCan this happen during actual usage, i.e. shouldn't they only be part of the internal linked list when they're dirty?\r\n\r\nIt bothers me a lot how many of the simulated combinations don't always seem to reflect real usage - while comments warn us of situations that may not be covered with tests at all.\r\nWould it maybe make sense to fix the reliability of the tests before this PR?",
      "created_at": "2024-09-01T16:05:02Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740154464",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740154464"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 888,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155232",
      "pull_request_review_id": 2274390022,
      "id": 1740155232,
      "node_id": "PRRC_kwDOABII585nuKlg",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 50,
      "original_position": 24,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Can we consider fixing that before this PR? I wouldn't mind doing parts of that myself!",
      "created_at": "2024-09-01T16:09:36Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740155232",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155232"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 184,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155419",
      "pull_request_review_id": 2274390022,
      "id": 1740155419,
      "node_id": "PRRC_kwDOABII585nuKob",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731055682,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "That makes sense, as stated in other comments, I would be more comfortable doing that before this refactoring.",
      "created_at": "2024-09-01T16:10:27Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740155419",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    }
  ]
}
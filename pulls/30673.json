{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673",
    "id": 2024536912,
    "node_id": "PR_kwDOABII5854q_tQ",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30673",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30673.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30673.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/6956ee9cc76c7815e53fbdee01edc4379d8caafc",
    "number": 30673,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove logic for spent-and-FRESH cache entries and writing non-DIRTY entries",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Following up from https://github.com/bitcoin/bitcoin/pull/28280#discussion_r1655477509, which suggested a revival of #18746.\r\n\r\n`GetCoin` will never return `true` for a spent entry, so we can safely assume that any entry we fetch will not be spent. This lets us remove the only non-test code path which adds a FRESH-but-not-DIRTY entry to the flagged linked list. This in turn ensures all entries being sent to `BatchWrite` are `DIRTY` entries.\r\n\r\nA corollary is that all spent coins must be DIRTY. The only time a coin can be spent and not DIRTY is when the `CCoinsViewCacheEntry` is created with an empty coin. The last commit makes this more clear by checking for freshness if inserted instead of if spent and not DIRTY.\r\n\r\nThis is a pure refactor removing dead code which handles a non-existent corner case of a FRESH-but-not-DIRTY entry in the `CCoinsViewCache` or a spent entry in `CCoinsViewDB`. There is a lot of test code which tries to exercise this corner case, which is also updated in this PR to behave like non-test code.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2024-08-18T21:31:11Z",
    "updated_at": "2025-02-18T05:29:54Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "52f5d37d8cc08873b348d98847e6c4b60a69a4fb",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:no-spent-and-fresh",
      "ref": "no-spent-and-fresh",
      "sha": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 267967,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-01-09T15:08:46Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "beac62e541c8ddc5adf8ab9393120cdb4051f1e8",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36735,
        "stargazers_count": 82048,
        "watchers_count": 82048,
        "size": 275610,
        "default_branch": "master",
        "open_issues_count": 689,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-02-17T15:31:10Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-02-18T04:01:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 86,
    "deletions": 116,
    "changed_files": 7,
    "commits": 10,
    "review_comments": 102,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2295400070,
      "node_id": "IC_kwDOABII586I0QaG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2295400070",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:31:13Z",
      "updated_at": "2025-02-18T05:29:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/30673.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2245093564) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31703](https://github.com/bitcoin/bitcoin/pull/31703) (Use number of dirty cache entries in flush warnings/logs by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2295400070",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "labeled",
      "id": 13922977193,
      "node_id": "LE_lADOABII586TWhHVzwAAAAM938Wp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922977193",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:31:15Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13922990638,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM93_ou",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922990638",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b393b0d0286f5c1c1b37630cc67162437672c52f",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/b393b0d0286f5c1c1b37630cc67162437672c52f",
      "created_at": "2024-08-18T21:39:28Z"
    },
    {
      "event": "labeled",
      "id": 13922990762,
      "node_id": "LE_lADOABII586TWhHVzwAAAAM93_qq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13922990762",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:39:32Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2295403510,
      "node_id": "IC_kwDOABII586I0RP2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2295403510",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T21:39:33Z",
      "updated_at": "2024-08-18T21:39:33Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/28917867890</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2295403510",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13923041141,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM94L91",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13923041141",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/feaea74b049834f5388c477df3c985c202e491dd",
      "created_at": "2024-08-18T22:08:53Z"
    },
    {
      "event": "unlabeled",
      "id": 13923182717,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAAM94uh9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13923182717",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-18T23:25:05Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 13929814318,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAM-SBku",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13929814318",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "created_at": "2024-08-19T12:38:28Z"
    },
    {
      "event": "reviewed",
      "id": 2245093564,
      "node_id": "PRR_kwDOABII586F0Wi8",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "The code became a lot simpler now - have a few suggestion I'd like us to consider, but I understand if you think it's out of scope.\r\n\r\nOnce we get to a state that is ACK-worthy, I'll enable hard assertions everywhere and run an IBD and check if it crashes anywhere.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2245093564",
      "submitted_at": "2024-08-19T12:54:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2246358443,
      "node_id": "PRR_kwDOABII586F5LWr",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2246358443",
      "submitted_at": "2024-08-19T20:01:26Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "commented",
      "id": 2299500214,
      "node_id": "IC_kwDOABII586JD5a2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2299500214",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-20T18:36:46Z",
      "updated_at": "2024-08-20T18:36:46Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Once we get to a state that is ACK-worthy, I'll enable hard assertions everywhere and run an IBD and check if it crashes anywhere.\r\n\r\nI think for a change like this, spending time fuzzing would be more valuable. I believe it already runs in debug mode for that so `Assume`s would trigger crashes.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2299500214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "reviewed",
      "id": 2260190262,
      "node_id": "PRR_kwDOABII586Gt8Q2",
      "url": null,
      "actor": null,
      "commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Dug deeper and added more relevant questions - bear with me if they're outside the scope of this PR.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2260190262",
      "submitted_at": "2024-08-26T11:51:22Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "labeled",
      "id": 14049882521,
      "node_id": "LE_lADOABII586TWhHVzwAAAANFcDGZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14049882521",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-28T16:30:31Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092490846,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAANH-lhe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092490846",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "82b62638fdb35e774d8ec7062259d6409093f49e",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/82b62638fdb35e774d8ec7062259d6409093f49e",
      "created_at": "2024-08-31T19:15:15Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14092535262,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAANH-wXe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092535262",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/7d2b49926cc24522211ae185915072b2e37ca334",
      "created_at": "2024-08-31T19:43:57Z"
    },
    {
      "event": "labeled",
      "id": 14092535377,
      "node_id": "LE_lADOABII586TWhHVzwAAAANH-wZR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092535377",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T19:44:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14092660872,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAANH_PCI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092660872",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T21:02:17Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14092663979,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAANH_Pyr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14092663979",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-08-31T21:04:20Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2274390022,
      "node_id": "PRR_kwDOABII586HkHAG",
      "url": null,
      "actor": null,
      "commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "The unreliability of many of our tests worries me, would you be open to fixing them in a PR before this one?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2274390022",
      "submitted_at": "2024-09-01T16:11:45Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "labeled",
      "id": 14107542395,
      "node_id": "LE_lADOABII586TWhHVzwAAAANI4AN7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14107542395",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-02T22:43:25Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14107767996,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAANI43S8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14107767996",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/34a101d4babd0cd2df86b414da385c3bded84027",
      "created_at": "2024-09-02T23:47:24Z"
    },
    {
      "event": "unlabeled",
      "id": 14108001869,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAANI5wZN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14108001869",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-03T00:47:53Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 14172829103,
      "node_id": "REFE_lADOABII586TWhHVzwAAAANMxDWv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14172829103",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "de0d22eb6cd6315dd25946b7a793251f07c6e063",
      "commit_url": "https://api.github.com/repos/l0rinc/bitcoin/commits/de0d22eb6cd6315dd25946b7a793251f07c6e063",
      "created_at": "2024-09-07T23:25:35Z"
    },
    {
      "event": "reviewed",
      "id": 2287494664,
      "node_id": "PRR_kwDOABII586IWGYI",
      "url": null,
      "actor": null,
      "commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2287494664",
      "submitted_at": "2024-09-08T18:22:56Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2288599258,
      "node_id": "PRR_kwDOABII586IaUDa",
      "url": null,
      "actor": null,
      "commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2288599258",
      "submitted_at": "2024-09-08T20:31:18Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2300006986,
      "node_id": "PRR_kwDOABII586JF1JK",
      "url": null,
      "actor": null,
      "commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2300006986",
      "submitted_at": "2024-09-12T11:21:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2300144399,
      "node_id": "PRR_kwDOABII586JGWsP",
      "url": null,
      "actor": null,
      "commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2300144399",
      "submitted_at": "2024-09-12T12:23:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "convert_to_draft",
      "id": 14330467688,
      "node_id": "CTDE_lADOABII586TWhHVzwAAAANWKZVo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14330467688",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-19T21:03:19Z"
    },
    {
      "event": "referenced",
      "id": 14856265593,
      "node_id": "REFE_lADOABII586TWhHVzwAAAAN1gJ95",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14856265593",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "74fb19317aec6d5156e12da6be63e59e0cc99770",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/74fb19317aec6d5156e12da6be63e59e0cc99770",
      "created_at": "2024-10-24T17:53:23Z"
    },
    {
      "event": "labeled",
      "id": 14856582259,
      "node_id": "LE_lADOABII586TWhHVzwAAAAN1hXRz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14856582259",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-24T18:14:44Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "referenced",
      "id": 15531281414,
      "node_id": "REFE_lADOABII586TWhHVzwAAAAOdvIwG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15531281414",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "17372d788e6ca6f5a8452acf88d6b7db4221cb7e",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/17372d788e6ca6f5a8452acf88d6b7db4221cb7e",
      "created_at": "2024-12-04T19:09:13Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15532576650,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAOd0E-K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15532576650",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "20d5187782847bd3ad59c28baffeae86da7e4feb",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/20d5187782847bd3ad59c28baffeae86da7e4feb",
      "created_at": "2024-12-04T21:13:16Z"
    },
    {
      "event": "ready_for_review",
      "id": 15532607990,
      "node_id": "RFRE_lADOABII586TWhHVzwAAAAOd0Mn2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15532607990",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-04T21:16:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15533094347,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAOd2DXL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15533094347",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "5e715b73934144fac6d45a64e3e94e88835538b9",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/5e715b73934144fac6d45a64e3e94e88835538b9",
      "created_at": "2024-12-04T22:09:27Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15533636279,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAOd4Hq3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15533636279",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8ed0506472b9a96d2235308a29a1ba142275ddf7",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8ed0506472b9a96d2235308a29a1ba142275ddf7",
      "created_at": "2024-12-04T23:19:31Z"
    },
    {
      "event": "unlabeled",
      "id": 15534206078,
      "node_id": "UNLE_lADOABII586TWhHVzwAAAAOd6Sx-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15534206078",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-05T00:39:26Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2520686785,
      "node_id": "IC_kwDOABII586WPqDB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2520686785",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-05T15:50:09Z",
      "updated_at": "2024-12-05T15:50:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased after #30849 and #30906. We can now specify the errors that should be thrown for the tests. In follow up PR, we can remove `SetFresh` and combine with `SetDirty(bool isFresh)` and remove tests for the case of FRESH-but-not-DIRTY.",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#issuecomment-2520686785",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30673"
    },
    {
      "event": "reviewed",
      "id": 2484285325,
      "node_id": "PRR_kwDOABII586UEy-N",
      "url": null,
      "actor": null,
      "commit_id": "8ed0506472b9a96d2235308a29a1ba142275ddf7",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I went over the changes again after the rebase. I like that the change is made in small commits, but they're not telling me a story yet, I don't fully understand why some changes were split out and others done in the same commit.\r\nThese refactorings are really important to make coins logic accessible again to all.\r\nMany of my previous questions still apply and I would need to understand them before I can ack.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2484285325",
      "submitted_at": "2024-12-06T11:02:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUwNGJiMWI0ZDIyZTc0OTAxYWI2M2FlMzJjM2Y1MTBiZGY4MDIwNGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
      "tree": {
        "sha": "1df33ba4173857b7e972196068d3c5cc3c15c627",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1df33ba4173857b7e972196068d3c5cc3c15c627"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 1df33ba4173857b7e972196068d3c5cc3c15c627\nparent 17372d788e6ca6f5a8452acf88d6b7db4221cb7e\nauthor Andrew Toth <andrewstoth@gmail.com> 1724014969 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734060331 -0500\n\ntest: never return true from GetCoins for spent entries\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbqSsACgkQYAB6/Ik4\nsBgM+RAAhsqOpnz+E3hZMqOVPMBVfuQP5YAeUMdAHvuP+uaY2PU75V77XgAvqEM7\nnhuAtvza+Ja7su5BvEYq+7S6Qd/3hsL8XzCg0rI6JHUZigraTCzyAAsBFs304n0W\nZAue7kpcxn4HldNy/MZhRN7NfqVlubRh5EfjN4nmy7x9m1Stf5QAICwPWYMSboSi\nIlSViD6zOSDop4Kya1boBqAjuG7iEq4douqCsxd6Tl4ogaLHRkQGNkWrFVUT+u2X\n7WlGlmV2jdW015X+lsDky72cjVhrC7Aj/Gt39uIRBpR7znO2Sp78VcA3OMfxbgVg\ne/bvgWf9j8m2ExsZYL2+KnCbGA5AHbe+XU0zU/x2Au1FTZ5lUpFCPXcmBMVcHj8c\nnJ/GKXbFPl+fetY5dlXGrDtJotoK6SOSAzF0tFOtdGJlNjVDxHYnSTCnSMSBu9uJ\nq06F7s2bnQkeovWo+U71nSnlUHa3X7RkbFqKgbraQ5VO1rwLlcPCJVApMzfcUymj\nn+uCYAY8zRhEv4c4D8llNraLoVda/z4mpFM0jXivuhjROpc/oZrt0D2fKotHh5XI\nhu6Gd/P3Qt3canQqTdYZBWta5/dJtQW1hdDD1RgtoqJ/N48ILOrEQXGO7JuIb/N8\nmWoX8lcOvGXzVjTz2u6sMY3sMvdLEQwdbCR11Y0htPWYNqQGYxg=\n=ajiA\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/17372d788e6ca6f5a8452acf88d6b7db4221cb7e",
          "sha": "17372d788e6ca6f5a8452acf88d6b7db4221cb7e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/17372d788e6ca6f5a8452acf88d6b7db4221cb7e"
        }
      ],
      "message": "test: never return true from GetCoins for spent entries",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:25:31Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:02:49Z"
      },
      "sha": "e04bb1b4d22e74901ab63ae32c3f510bdf80204f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY1NWJhYzc5NTE4YmIwZTZhMmU0MGQ5MGE1M2ExM2E4N2IwNWZiZWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f55bac79518bb0e6a2e40d90a53a13a87b05fbeb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f55bac79518bb0e6a2e40d90a53a13a87b05fbeb",
      "tree": {
        "sha": "6a40e7638743cfeb99c45ce4b476874d652f64de",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6a40e7638743cfeb99c45ce4b476874d652f64de"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6a40e7638743cfeb99c45ce4b476874d652f64de\nparent e04bb1b4d22e74901ab63ae32c3f510bdf80204f\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015034 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734060545 -0500\n\ncoins: coins returned from GetCoin cannot be spent\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbqhwACgkQYAB6/Ik4\nsBhQvRAAikRj09r2N2vCmj+sUsec5GjQni/6ddZLnEcKizvlgTL0FvUzfhH4zoTK\noOqlzGIguF5iawPCGpp6ZXJVgiBMWZUwXkBcKnR0Jg3gbyBAG5ERzadfQnvbBibK\nZy5ebiWFKUJ5nRGS6HnJHdoZ/d/UHIrRwO73JbDIrDzKZJJylyGiiwNuSiazWTHk\nghXzLxuFqRcT5Ikq9zeTBG/HFPUmfb73YLuZDPDZWAZoTYlTefLIRlwXuwie4Qkg\nBzlpP5ZGA+qQomotTl5utNajzNam1FAszvBGGW76t9c/s4atPaosn9QP2FVrfpeb\n5s5SKeGDQ1+V9ZzNZAhF4yODULQeVLJ84XSsZwgRoY7BbEoInCMrJ60krlx5Lb+w\nSD9Woh1zvqtHyaukvqShmdVmCkPIdZPPUjPHmCu1j+5mBaaNRApYEeFPSNc6W45W\nQRtCQJzYZZQ6NjqryUoQauIJNXp3ohfTvyDk6oxTTWyvZSO4+6e2EdoQsQGzlwol\nLACYzourp3sHA7QIYvGCsR0Dj5pf4u59++4OPUELDGeu0rthzkeDVSjkiPqNtefO\nVjgB6HJHwDer01ljNwrjkWnMzDbg1qr4Xu/3CUnKENufbq135YlHKlWEQPovkZnd\nMBqAGvRZVWe4cVogrE5GMukn1jqJWNJC/7R0hlbwXA378AT+KLE=\n=Hgr/\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
          "sha": "e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e04bb1b4d22e74901ab63ae32c3f510bdf80204f"
        }
      ],
      "message": "coins: coins returned from GetCoin cannot be spent",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:29:05Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:03:54Z"
      },
      "sha": "f55bac79518bb0e6a2e40d90a53a13a87b05fbeb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg2MTA3ZjcxMjY1YmFjMjhhZmMzMTUyOWQzODIyNmQ5YjQ5YzU4NjI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86107f71265bac28afc31529d38226d9b49c5862",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/86107f71265bac28afc31529d38226d9b49c5862",
      "tree": {
        "sha": "a46bdfce833d8dac9d798c3a5c2c4eb177cce4ce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a46bdfce833d8dac9d798c3a5c2c4eb177cce4ce"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a46bdfce833d8dac9d798c3a5c2c4eb177cce4ce\nparent f55bac79518bb0e6a2e40d90a53a13a87b05fbeb\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015231 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734060572 -0500\n\ncoins: throw errors for non-DIRTY or spent and FRESH coins in BatchWrite\n\nThere are no code paths which add a non-DIRTY entry to the cursor in\nBatchWrite, so we can safely make this a logic error and test for it.\n\nThere are no code paths which add a spent and FRESH coin to the cursor\nin BatchWrite, so we can safely make this a logic error and test for it.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbqhwACgkQYAB6/Ik4\nsBjezBAAiMbIvEFOV8lAmK5FyozQue5Tf3KXnHEZ7zfkWpoMYw9MwRpnBNl56vTm\nCJeM0YTovh5uYvCxEuTXtz60DDr6KRIVAn0p3YBomJaz6p2XD4TBPet4raXK24FH\nywlz4cfD+VcX94n+jRJckxuCy9aPZOshnyG/v31WbmU6AkfbdU/FVR42nTFUPUvZ\n7dvDO/3FK3FBmu0RAs/6DDXBzMaEsNBjr94YNrVMT1F8mD4n/Q+kG7ZTNAKgnhQl\nIpk8fuTgCTHFUj7jza0lbKORHAiODbmms4+RONIz81g+Ln2zEaodbzFpf8ny5yZK\n/r3ZXUrCYhTjbkVYyNiimYv86zLoZkdk452TtIg07M7/s1MvjsMJd5jWy1tR0zp0\nzEyjAMWuqv17MdC6ibhTuxDXzGrP5i0QPXu4E/ZFaWX9ZXrtNvacQhSCGAXUHcmU\nn6dr454SRP4Dnw0w286BudjIYzY94wLu7YFDQYKu4m5bSXe+vsyNcopAupb4ZtOx\nlW/9Vxl7UOD7gIOeyLYgZyYF/Zrytdy/xGUYxyAtSRHQID8jIX6q+PBW8Px/lSCE\n4araJ9czzyarP82hqkeqLvQ4A0oTAN1HWM1qx4nbLZAk8XUbcfc+dJxEe333+M1s\ncjddSIkRFzIVRAYi6nsaDSEKchLTh8TRwf4jrztph5UC0xT7GLE=\n=CM/6\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f55bac79518bb0e6a2e40d90a53a13a87b05fbeb",
          "sha": "f55bac79518bb0e6a2e40d90a53a13a87b05fbeb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f55bac79518bb0e6a2e40d90a53a13a87b05fbeb"
        }
      ],
      "message": "coins: throw errors for non-DIRTY or spent and FRESH coins in BatchWrite\n\nThere are no code paths which add a non-DIRTY entry to the cursor in\nBatchWrite, so we can safely make this a logic error and test for it.\n\nThere are no code paths which add a spent and FRESH coin to the cursor\nin BatchWrite, so we can safely make this a logic error and test for it.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:29:32Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:07:11Z"
      },
      "sha": "86107f71265bac28afc31529d38226d9b49c5862"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY0NGZiYWVhNWEzYWI5NDYxYzhiZmMyNmE4Y2Y4NDFhY2FlYjk0ZjE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
      "tree": {
        "sha": "6f1bf37d6bad256d243c8d0c39e4cd3daee5449b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6f1bf37d6bad256d243c8d0c39e4cd3daee5449b"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 6f1bf37d6bad256d243c8d0c39e4cd3daee5449b\nparent 86107f71265bac28afc31529d38226d9b49c5862\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015566 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061644 -0500\n\ndoc: update comments to reflect possible code paths\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrk4ACgkQYAB6/Ik4\nsBiBZxAAoaQjEFYsAEMP808zRrfvF6gWEbRWi0t1utb8zDDoYL6yzg3oTiA8n14y\nVUzSlqKEIyGB4IUJ++vD8wENY6UqOVVTGMRO/rYr5lj5Q+iOs2hzWdIu0p1EDp3Z\nJ8AiTF1a67lLpcxdiI40DxFSSWkjfZaVYUCetvsr/hcSZ1O+/dovEhuaYlPqNP1O\niUCIIfq5by2CN4GPXeMDwD6hdvMgcuPvZXNUOXzuzKIIt4ysu+67tdS7S4jFizHB\nMmD74pv17SMOCnVGR4Bso5Q5vezhGJaYIZaCAu02zWCJO/5bB15Rl1mP3CR/e29r\nLpolW0wRFv4r8qKTSsqSHOTjjPTmOso41/0Oy4cBd5p9tN/ZxYdYCvSrKx/6YuBL\nPeYQBGz9htsaFIMKJjVoGEhKjPkSnXthAo7zywRkDzx1xli+p9PJMWO1FbaSrc9x\nYeX4trOtZc8kQ+gA925B/x0lNh7BZ9IY9dt/bQH7J2ltVo7pzud5GLJLLp53xEwH\npOyhiQzBdlT812NeQg8hy3J728dg6Kfi10zT6yJZrrfSYtjk7mS04i7LV+gNfkFB\nITa0TCJ+NtE5+zIab2zthS4ZGJwA79a9f9cHZXH7aa+iR0wPomvFZUx8MQrUgjdc\nTcoVEGfsmgjp1LpfPdbqdqJeEftgBpFvt6/Gthglxzp5CYebzao=\n=Nch1\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/86107f71265bac28afc31529d38226d9b49c5862",
          "sha": "86107f71265bac28afc31529d38226d9b49c5862",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/86107f71265bac28afc31529d38226d9b49c5862"
        }
      ],
      "message": "doc: update comments to reflect possible code paths",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:24Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:12:46Z"
      },
      "sha": "f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY5ZDUwZjlmNWFiNThlNmE1Nzk3N2VmZDA2NWExNjE5NTA4YjU2NTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f9d50f9f5ab58e6a57977efd065a1619508b5656",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f9d50f9f5ab58e6a57977efd065a1619508b5656",
      "tree": {
        "sha": "d360d9fc4d35cafce5dd4389de0663eac8ceea67",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d360d9fc4d35cafce5dd4389de0663eac8ceea67"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree d360d9fc4d35cafce5dd4389de0663eac8ceea67\nparent f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015624 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061646 -0500\n\ncoins: remove redundant IsDirty checks in BatchWrite\n\nIt is no longer possible to get non-DIRTY entries in BatchWrite\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrk4ACgkQYAB6/Ik4\nsBj46g//ZoywaBzHYiJMVJVc3Nt92Qh8iHsHSoCQJIqRwrt0ggrKOt3eMHRm1sOi\ncosmDxE2WWbyvYnPGcFHOFZj0xWrG0EY6JXk6eRsHAkuScYxHeiyUf94ViXRrHgS\nmQmIUc9FzydwR0g7HxPEjYZLiPDS8Q7YmoTF9xIt+2DEqym2Z2lKRJsM1SnpsUxw\noRStDqBKQ/W0ApOz30el7inaTKI4WXIDcnbNx4UPXnk54+WrHhmLACJOrhcjJ/k9\nG2SBnIg/UTbx3s1WqsBfRG6t9smHJTPGJD+X6ryqNBJwYjUykc33yO1XKQ8tQZkv\n8EHQvc6qX/3goQ7cSIjkodOxYYrFl4wbiq2lxH1dEUPusFNdFE/c4XH74KR5Mxbd\nTzwJJXidKJuEWMtWu3PAZVcE3KVcM0+cp7CDKS2i+L0Ew+XRfrACx1x/2Xrapfjv\nn1hSdVutpFVzwgwmWPDXs/PpfX/j7ziIQ4qdLOXjd3wEno6A3sEI7KixL3sr0o3x\np5XT9bl4o0dhs6j6oW5MwQjOCwwj4OzKOjBsWGkKr81NsDXywE5yhY+zvTSsGZxE\nvzapX/GQiXNfgLNZOqnG/rhMaO7KBHT1VZSN4sVI/+mD01GUIu68BLslVx1H9Y63\nf1RgkgILJn7YAGg+YPLHRSUpZD/4jUrSHzODZaqpKmlT4/Abra4=\n=E0Bq\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
          "sha": "f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1"
        }
      ],
      "message": "coins: remove redundant IsDirty checks in BatchWrite\n\nIt is no longer possible to get non-DIRTY entries in BatchWrite",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:26Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:13:44Z"
      },
      "sha": "f9d50f9f5ab58e6a57977efd065a1619508b5656"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg3ZGUzZTZjMzI3MWJlOTRjNzMzYzliZGI2YzAxYWQzYzZmODU3MjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/87de3e6c3271be94c733c9bdb6c01ad3c6f85720",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/87de3e6c3271be94c733c9bdb6c01ad3c6f85720",
      "tree": {
        "sha": "2bd8de83e19346054d5f35dff3a08ad9ca934686",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2bd8de83e19346054d5f35dff3a08ad9ca934686"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 2bd8de83e19346054d5f35dff3a08ad9ca934686\nparent f9d50f9f5ab58e6a57977efd065a1619508b5656\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015712 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061646 -0500\n\ncoins: remove IsFresh check in Uncache\n\nIt is not possible for an entry to be FRESH if not already DIRTY.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrk4ACgkQYAB6/Ik4\nsBgY0w//RoKjRMzs5+VsuXc6d7L9PuTZ6t+rnQJ4yui16rI+15Cjh7S0moD5Zuxn\nLQYVYg6oEuXP6gpPnJwa3XDRGzvxyywoViwzE96oS7MMJfuvTzJyUW4HqyeyIoRa\nMFQnL/gS3Zu13RvvlL1aLMDpwlXtedRC8nO86PHnsIguGwBvenru1Xg73XqlE//G\nvn9rd0qrTzX/YX9ohzl+bv+U1SqlhT0Pn4ctfBoi+dicUKkM6ppMNl0DJb8DbGF0\nEiqT5ztLX95A+B5K+xH6EPAyFADUKOaLjMkiSpTBN7wF0Xu/bLvfclbi6CfXVy4C\nVAnq3/5mgDMFnmL0n3+LZxNxy1Paer0zKEewEOOE+urb0yKPgeh4D+N0qHWOYFtn\nU2Rqf2NiQ1nofvVbbuL0+w+At2CvexyMomJlkkEB9aP6SWk3i41o6e+5RMdfBD7o\nquYhNEZVJzMbnGGC55d+wDKvWr9b0Vw+ga1wTsM8mgNeu0n6c9ZgM//dOqg5FiRB\n9OYTcO+gqFLDNCBvYuyGc0NTcWwWplH0B9ZXF/7GzM0nU8DvoEEhC7Vr3uRwAeIW\n5BoTja2V32N7aUtyOeNN+gNq5nekajCzLtM9USFvVMY53Id+7EC7NeiDbHx2iSxm\nfmCiv2xRU4Yi0I58iU66AMpvYKX0XvTol+erPQRRBkeKhnlu3tY=\n=zf2i\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f9d50f9f5ab58e6a57977efd065a1619508b5656",
          "sha": "f9d50f9f5ab58e6a57977efd065a1619508b5656",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f9d50f9f5ab58e6a57977efd065a1619508b5656"
        }
      ],
      "message": "coins: remove IsFresh check in Uncache\n\nIt is not possible for an entry to be FRESH if not already DIRTY.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:26Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:15:12Z"
      },
      "sha": "87de3e6c3271be94c733c9bdb6c01ad3c6f85720"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJjM2U2MmQ0NTI2ODA5ZTlkMmY1YTAxZmY0ZDA0OWZiNjc1NGNjZTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6",
      "tree": {
        "sha": "59208934effe135d8b15a29cac39ca8a043a1b2a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/59208934effe135d8b15a29cac39ca8a043a1b2a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 59208934effe135d8b15a29cac39ca8a043a1b2a\nparent 87de3e6c3271be94c733c9bdb6c01ad3c6f85720\nauthor Andrew Toth <andrewstoth@gmail.com> 1724015831 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061646 -0500\n\ntest: don't check for FRESH but not DIRTY entries in SanityCheck\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrk4ACgkQYAB6/Ik4\nsBinvRAAqrXc0Mlpr6w0RgJSt9xZ8yZf6FERmn41a6tVjC3wkb4BNMClECj8T315\nBkq7uGwIxOXBCtlK3RNxZaI7bFl3zPvWfb85m7UNOzA5OW0/jdWW07trZJQnOokb\nle4TqAjoxu18TKni7YR6TLHBv1aJJuunKlIZ4uqPsMzH53gxVds9Sj4aw09c7QD8\nQe3soiAES2MlZ1gZ5JSbfScUh3W8QuY6UFECBhUBCM4SKTTYQDHFpkcu8PhANh9P\nzKk9Gxpr5+iFRxSJByU9kcwf4Ho+g944TdPL+wBc6wrlr5z0NDryjf7Jkyb319jY\n9pcZzIs218K4No9GDcbePrCI0FXpQMlDlQuI21tSVwL3Lz94uG+8+wCk++WwCQ2A\ninctFkUwqlmM/jhHj/3rAB2doJnioPAvGufcTVpAQ2lrNgPE57l4mGYN9GeTRJyQ\ndvqnMyDuDEHGOHS/tuWt1Hxlq6b/zG0Oh/Yz9kvmKgcdsRoZHRVmxN9EgMaxqafK\ndPdSAzzEpRtpW/ZeDeZPBCq+jDJTlCtGBrQT3YizS37KriJpLIwPPaDBuomReDTf\nn2LKYPuFPq3I30Lk5q9/mcjrBoJYtoouL5ROm5aViGD3SmTQ4HdtuYYLfu3huvnW\nsXqjMsxG4HE4ugejuDGS8L5YTsXF6awhKjzQhFrhTOPWt5d4S7o=\n=O3D+\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/87de3e6c3271be94c733c9bdb6c01ad3c6f85720",
          "sha": "87de3e6c3271be94c733c9bdb6c01ad3c6f85720",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/87de3e6c3271be94c733c9bdb6c01ad3c6f85720"
        }
      ],
      "message": "test: don't check for FRESH but not DIRTY entries in SanityCheck",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:26Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-18T21:17:11Z"
      },
      "sha": "2c3e62d4526809e9d2f5a01ff4d049fb6754cce6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE0N2NkNTA1MDEwZjBjZDUzYjJhZDJiZDU3Y2I3MGUxNGQ2OGYzOTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/147cd505010f0cd53b2ad2bd57cb70e14d68f394",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/147cd505010f0cd53b2ad2bd57cb70e14d68f394",
      "tree": {
        "sha": "f13dafe3a504e4f839c6cc1452b0575ca2467ff5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f13dafe3a504e4f839c6cc1452b0575ca2467ff5"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree f13dafe3a504e4f839c6cc1452b0575ca2467ff5\nparent 2c3e62d4526809e9d2f5a01ff4d049fb6754cce6\nauthor Andrew Toth <andrewstoth@gmail.com> 1725128378 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061668 -0500\n\ncoins: assume entry is dirty in Next and Prev\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrmQACgkQYAB6/Ik4\nsBh9WQ//VHN9TmUKjPNHG39TrK0uzuUyH9xN6NsKbcSByx7o1WhE9LGqowmyzFp6\npuAiJm3yfTrdi8Oek9vE3/JuassKYAaZU05CYON7uazy4pznRHXe+XTdl+odyWzm\nBTFMA718Hn7JCcwXiUWaNu8i8BQnCy+980sTTrdgfYL3Ic+uHWJhqRPiLsl+eP4a\nnjgObJc9zWtYuG6tZ0zBHdW7f7kC/D3LF8MragM8BAIhJfZUx7IxwFRbr3todns4\nNV2etB6OkoUHK47YeFbolf6W2umot0+AUm/jNdkJDiMXG27zWO0YMyfI2IuAoxmJ\niEySD2QTkGZi9goN9Is7b7mpPsCPoSl0P/6EGo5uTRLb9bEzTQfgv1qhTUUuzk1v\n2pEGieWs+ggfTtcox5+xHwGBeHW6qZte7fU4ya7LyQU06AXaNlAPvR0IKdSh1qby\nWLQMLUMe/w6f1ymGoyw0rAg1Y7D2pbwjsaGSzXPOHqmoJ8aA0sZxyc19E5TmqxpA\nhzbJrAjACu/y/CPykIL2AdeQQfonZjn5lBayQSgbl929Aq1ik35XleMrJb043fiY\nu0wwXN6j1R6P4yYrJ4XX/15ue5hTMiyUsBsGvRLjU37P5s/WX+4MouTtD0g01es1\nnmeWzawjFqxnJCfD2wYb/OgBo3lShR6NuUGNFfaUFahrf3j6hN8=\n=fGoL\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6",
          "sha": "2c3e62d4526809e9d2f5a01ff4d049fb6754cce6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6"
        }
      ],
      "message": "coins: assume entry is dirty in Next and Prev",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:48Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T18:19:38Z"
      },
      "sha": "147cd505010f0cd53b2ad2bd57cb70e14d68f394"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDRjOWMzMGVkYTM3MDdmNDUxZmI3ZDVhNjUyMTU5ZDY2YmE5MGQ5ZDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c9c30eda3707f451fb7d5a652159d66ba90d9d7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4c9c30eda3707f451fb7d5a652159d66ba90d9d7",
      "tree": {
        "sha": "4fe334bf8659d7ce572f2c573404f288dfb28fb3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4fe334bf8659d7ce572f2c573404f288dfb28fb3"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4fe334bf8659d7ce572f2c573404f288dfb28fb3\nparent 147cd505010f0cd53b2ad2bd57cb70e14d68f394\nauthor Andrew Toth <andrewstoth@gmail.com> 1725128412 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061668 -0500\n\ntest: simplify coins sanity check\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrmQACgkQYAB6/Ik4\nsBieQw/9HpAM+0fQflKBKWmg2mPSNOtzKkamBlJ5HEvs4CiciTOUbteveQCZU3zT\nJsRtq4GruDoFiPR8XAJUCZqYKcTcWP7HYQj8maxHZGqJiNL4BmTjO+gNC8GNf4Km\nVOETTWoK2DIPxoSusy+aebnX9HUDXzjchMAoAh6aYd7Ku+9zdT/xyPaMgFQxSG75\nDHpCzQtIqC5aBg9qRjeWMPpNQauR12YXvOMzY2oe36H8q6M+ZDRtaz9uDgUnBdTd\noW2x/HCvS/syJZgv9H8cP73aJHRq6tQ5LxJRSJWABX80Qj0i1UdGXwA9SgO0aPAc\ng5zewfjwM8PpDrGMfHrJwQd18c5C/s8rGul8htfayxBpJkEvQD5zhIAYuu3OTdCC\nbnpcGh9Q9LVlyB1nAezV01HuxA/i/+VtCYMSO2FojxbQi93pLU4x9XzsYyX5TNTY\njx5+ono4BbUC1V+rlrBWsr16Qaq2ZhGTKQXKJPhbCJchtr+OulKWajFNjPLhqe3P\n02pOMvv8aGR9sZJC+amvj0WOj+0XhpYMN93DDbsYimrR0Y3X/59F2FrTquXSSwOE\n2MwWeb420nI1vHGYUWc0dOyg5746C2zqwjCqJ6H6daBuV/1fLwpHiSMVFllkQ/4H\nBdmdjSOzbYvzlvBWyIh8pWYkk5h9SA5OjVjb2PrdxpUvak5Jkxg=\n=EsNI\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/147cd505010f0cd53b2ad2bd57cb70e14d68f394",
          "sha": "147cd505010f0cd53b2ad2bd57cb70e14d68f394",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/147cd505010f0cd53b2ad2bd57cb70e14d68f394"
        }
      ],
      "message": "test: simplify coins sanity check",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:48Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T18:20:12Z"
      },
      "sha": "4c9c30eda3707f451fb7d5a652159d66ba90d9d7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5NTZlZTljYzc2Yzc4MTVlNTNmYmRlZTAxZWRjNDM3OWQ4Y2FhZmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "tree": {
        "sha": "09e59a981c2736c15c53b1f7ea22cffbf0fd702f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/09e59a981c2736c15c53b1f7ea22cffbf0fd702f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 09e59a981c2736c15c53b1f7ea22cffbf0fd702f\nparent 4c9c30eda3707f451fb7d5a652159d66ba90d9d7\nauthor Andrew Toth <andrewstoth@gmail.com> 1725131481 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1734061669 -0500\n\ncoins: set all inserted spent coins to fresh\n\nA spent coins must be DIRTY, so remove\nreferences to spent but not DIRTY coins.\nThe only way a spent coin can be not DIRTY\nis when creating the CCoinsCacheEntry with\nan empty coin. This can be made more clear\nby setting fresh if inserted, instead of\nchecking if an unspent coin is not DIRTY.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmdbrmUACgkQYAB6/Ik4\nsBi22w/5AZbYGerIxB1mFo9Wp6Ei51LF4LGLUIMaSSCCykz5TB0kCJI1yo/gYnlv\nkngKm7gzIjb5mobss9Q8eYgV8TFOhmBqbNBqGkR2eDg8/hNB8OHd/Bph5XjZv8yP\nazNbJMhfZYzkBBRU4LtBexXUfYCcA+b7iFva+4VuNuMn0mDXHsurijEWcUm6knuo\noJ2B53BkjfZjuo94xmWbmFZKT8Mi0wsFd3/lS9D4GctPJ6UBcQ39xr769Wpk39rx\nnIvuzjXCBIxvZy/DsghdXCXi5NiaSPQ2sdZTqM8DpJMwJ1Fm0Ayb1u/Pg36FIJOP\nfN9XYk6CObW9sY4yPOzLAnnyx3Ma34ejPIac5JjAm8fyBwLAfEU36FpSXIAD0y4g\nqnImdYmGD8FEQtBf32b5pSjLakBmhS7DqCKJGaSN0aoBydbSrktbJR/OwjV+gofl\nCvE+F8nj7UM8ZhIOgzKrZGHCw7KSix9ymIN8yEwDYGvcqPSs/41/xGpFd2u/b7oI\nzCF7mtPImPplYuHkgIXW+oaVOVWog5JyiY9O0fE4Wf1sVijfmXjt1WmmlXamVm0K\n5dGo9pkoAVilupcgIFDV15aHupceMqrQIHgj+upuufgKKQqalxYqY+XeIs02WrxT\nFfZ41TK/Ey1BPBgqkHMFpyXWYbt9LZYewk+Eg9+JM7ipkvYrTDk=\n=VyOH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4c9c30eda3707f451fb7d5a652159d66ba90d9d7",
          "sha": "4c9c30eda3707f451fb7d5a652159d66ba90d9d7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4c9c30eda3707f451fb7d5a652159d66ba90d9d7"
        }
      ],
      "message": "coins: set all inserted spent coins to fresh\n\nA spent coins must be DIRTY, so remove\nreferences to spent but not DIRTY coins.\nThe only way a spent coin can be not DIRTY\nis when creating the CCoinsCacheEntry with\nan empty coin. This can be made more clear\nby setting fresh if inserted, instead of\nchecking if an unspent coin is not DIRTY.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-12-13T03:47:49Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2024-08-31T19:11:21Z"
      },
      "sha": "6956ee9cc76c7815e53fbdee01edc4379d8caafc"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 15643157002,
      "node_id": "HRFPE_lADOABII586TWhHVzwAAAAOkZ6IK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15643157002",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "created_at": "2024-12-13T03:48:00Z"
    },
    {
      "event": "reviewed",
      "id": 2502435536,
      "node_id": "PRR_kwDOABII586VKCLQ",
      "url": null,
      "actor": null,
      "commit_id": "e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2502435536",
      "submitted_at": "2024-12-13T14:32:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2502438288,
      "node_id": "PRR_kwDOABII586VKC2Q",
      "url": null,
      "actor": null,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2502438288",
      "submitted_at": "2024-12-13T14:47:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    },
    {
      "event": "reviewed",
      "id": 2569611311,
      "node_id": "PRR_kwDOABII586ZKSgv",
      "url": null,
      "actor": null,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#pullrequestreview-2569611311",
      "submitted_at": "2025-01-23T11:28:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721510656",
      "pull_request_review_id": 2245093564,
      "id": 1721510656,
      "node_id": "PRRC_kwDOABII585mnCsA",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent\n+        Assume(!ret->second.coin.IsSpent());",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "when do we throw and when do we `Assume` here?\r\n> \\* Assume is the identity function.\r\n> \\*\r\n> \\* - Should be used to run non-fatal checks. In debug builds it behaves like\r\n> \\*   Assert()/assert() to notify developers and testers about non-fatal errors.\r\n> \\*   In production it doesn't warn or log anything.\r\n> \\* - For fatal errors, use Assert().\r\n\r\nWouldn't this be a fatal error?\r\n\r\nAlternatively, if we want to separate the test runs from production runs, would it maybe make sense to call `SanityCheck` in test&debug mode every time we want to be absolutely sure the state is correct? I know it's expensive, but might be reassuring during testing - and similarly to Assume, would be skipped in prod.",
      "created_at": "2024-08-19T09:47:54Z",
      "updated_at": "2024-08-19T12:55:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721510656",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721510656"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721668812",
      "pull_request_review_id": 2245093564,
      "id": 1721668812,
      "node_id": "PRRC_kwDOABII585mnpTM",
      "diff_hunk": "@@ -325,14 +321,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "So basically if we lay out the allowed combinations we'd get:\r\n```C++\r\nassert((!entry.IsDirty() & !entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 0\r\n        (entry.IsDirty() & !entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 1\r\n        (entry.IsDirty() &  entry.IsFresh() & !entry.coin.IsSpent())  |  // attr = 3\r\n        (entry.IsDirty() & !entry.IsFresh() &  entry.coin.IsSpent()));   // attr = 5\r\n```\r\nWhich could be simplified to\r\n```C++\r\nassert((entry.IsDirty() && !(entry.coin.IsSpent() && entry.IsFresh())) || !(entry.coin.IsSpent() || entry.IsFresh()));\r\n```\r\nwhich can be laid out as an if expression which would probably document the situation better than `!= 2 && != 4 && != 6 && != 7`:\r\n```C++\r\nif (entry.coin.IsSpent()) {\r\n    assert(entry.IsDirty() && !entry.IsFresh());\r\n} else {\r\n    assert(entry.IsDirty() || !entry.IsFresh());\r\n}\r\n```\r\n\r\n<details><summary>sanity_check_assertions test</summary>\r\n\r\n```C++\r\nBOOST_AUTO_TEST_CASE(sanity_check_assertions)\r\n{\r\n    for (int is_dirty = 0; is_dirty <= 1; ++is_dirty) {\r\n        for (int is_fresh = 0; is_fresh <= 1; ++is_fresh) {\r\n            for (int is_spent = 0; is_spent <= 1; ++is_spent) {\r\n                // Original check\r\n                unsigned attr = 0;\r\n                if (is_dirty) attr |= 1;\r\n                if (is_fresh) attr |= 2;\r\n                if (is_spent) attr |= 4;\r\n                bool original_result = (attr != 2 && attr != 4 && attr != 6 && attr != 7);\r\n\r\n                bool new_result = (!is_dirty & !is_fresh & !is_spent) |  // attr = 0\r\n                                  (is_dirty & !is_fresh & !is_spent) |   // attr = 1\r\n                                  (is_dirty & is_fresh & !is_spent) |    // attr = 3\r\n                                  (is_dirty & !is_fresh & is_spent);     // attr = 5\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n\r\n                new_result = ((is_dirty && !(is_spent && is_fresh)) || !(is_spent || is_fresh));\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n\r\n                if (is_dirty) {\r\n                    new_result = !(is_spent && is_fresh);\r\n                } else {\r\n                    new_result = !(is_spent || is_fresh);\r\n                }\r\n                BOOST_CHECK_EQUAL(original_result, new_result);\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n</details> \r\n",
      "created_at": "2024-08-19T11:51:32Z",
      "updated_at": "2024-08-24T19:33:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721668812",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721668812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 321,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721727681",
      "pull_request_review_id": 2245093564,
      "id": 1721727681,
      "node_id": "PRRC_kwDOABII585mn3rB",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I was surprised to see that the method called `GetCoin` now:\r\n* overwrites the dummy coin parameter with the value found in the cache\r\n* returns a boolean indicating whether the coin exists in the cache and is not spent (the name doesn't have any hints about it being spent or not)\r\n\r\nI don't mind if you think it's outside the scope of the current change, but checking the usages it seems to me we can now simplify `GetCoin` to actually return the coin and let the callsite check for spent and it might simplify the usages as well:\r\n```C++\r\nstd::optional<Coin> CCoinsViewCache::GetCoin(const COutPoint& outpoint) const\r\n{\r\n    auto it = FetchCoin(outpoint);\r\n    if (it != cacheCoins.end()) {\r\n        return it->second.coin;\r\n    }\r\n    return std::nullopt;\r\n}\r\n```\r\n\r\n<details>\r\n<summary>... and in tests</summary>\r\n```C++\r\nstd::optional<Coin> GetCoin(const COutPoint& outpoint) const\r\n{\r\n    if (const auto [it, found] = m_data.find(outpoint); found) {\r\n        return it->second;\r\n    }\r\n    return std::nullopt;\r\n}\r\n```\r\n</details>\r\n\r\nWhich would simplify usages from e.g.\r\n```C++\r\nCoin coin_using_get_coin;\r\nconst bool exists_using_get_coin = coins_view_cache.GetCoin(random_out_point, coin_using_get_coin);\r\nif (exists_using_get_coin) {\r\n    assert(coin_using_get_coin == coin_using_access_coin);\r\n}\r\nassert((exists_using_access_coin && exists_using_have_coin_in_cache && exists_using_have_coin && exists_using_get_coin) ||\r\n       (!exists_using_access_coin && !exists_using_have_coin_in_cache && !exists_using_have_coin && !exists_using_get_coin));\r\n```\r\nto something like:\r\n```C++\r\nif (auto coin_optional = coins_view_cache.GetCoin(random_out_point); coin_optional && !coin_optional->IsSpent()) {\r\n    assert(*coin_optional == coin_using_access_coin);\r\n    assert(exists_using_access_coin && exists_using_have_coin_in_cache && exists_using_have_coin);\r\n} else {\r\n    assert(!exists_using_access_coin && !exists_using_have_coin_in_cache && !exists_using_have_coin);\r\n}\r\n```\r\n\r\nWhat do you think?",
      "created_at": "2024-08-19T12:41:42Z",
      "updated_at": "2024-08-19T13:19:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721727681",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721727681"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721733726",
      "pull_request_review_id": 2245093564,
      "id": 1721733726,
      "node_id": "PRRC_kwDOABII585mn5Je",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n        Assume(IsDirty());\r\n```\r\n\r\nnit: it's a cheap call, why not make it an assert instead? Note that after that change the comments will become redundant",
      "created_at": "2024-08-19T12:46:37Z",
      "updated_at": "2024-08-26T09:33:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721733726",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721733726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721738283",
      "pull_request_review_id": 2245093564,
      "id": 1721738283,
      "node_id": "PRRC_kwDOABII585mn6Qr",
      "diff_hunk": "@@ -53,14 +53,11 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {",
      "path": "src/test/coins_tests.cpp",
      "position": 18,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "946a035cdc298c3168b1164079892a85902c966f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "is this is always the case, consider adding an assertion\r\n```C++\r\nassert(it->second.IsDirty());\r\n```\r\n\r\n(we can remove them in the last commit, but would be useful for the intermediary commits at least)",
      "created_at": "2024-08-19T12:50:13Z",
      "updated_at": "2024-08-19T12:54:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721738283",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721738283"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 64,
      "original_line": 64,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721800990",
      "pull_request_review_id": 2245569284,
      "id": 1721800990,
      "node_id": "PRRC_kwDOABII585moJke",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This behavior is documented [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.h#L306-L310), so not sure why test code bothered to do this. Indeed, switching to `std::optional` would be cleaner, but I think a much bigger refactor. This is also suggested in the original PR [here](https://github.com/bitcoin/bitcoin/pull/18746#issuecomment-842393167).",
      "created_at": "2024-08-19T13:35:15Z",
      "updated_at": "2024-08-19T13:35:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721800990",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721800990"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721809523",
      "pull_request_review_id": 2245583004,
      "id": 1721809523,
      "node_id": "PRRC_kwDOABII585moLpz",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> but I think a much bigger refactor\r\n\r\nMaybe, would it help if I did that in a different PR?",
      "created_at": "2024-08-19T13:40:25Z",
      "updated_at": "2024-08-19T13:40:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721809523",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721809523"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721817389",
      "pull_request_review_id": 2245596138,
      "id": 1721817389,
      "node_id": "PRRC_kwDOABII585moNkt",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, but it would conflict heavily with this one. Many of the tests would have to be removed as well.",
      "created_at": "2024-08-19T13:45:09Z",
      "updated_at": "2024-08-19T13:45:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721817389",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721817389"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721879299",
      "pull_request_review_id": 2245697067,
      "id": 1721879299,
      "node_id": "PRRC_kwDOABII585mocsD",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm fine with that, extracted to a branch for now, will push as a draft after your PR stabilizes ",
      "created_at": "2024-08-19T14:24:09Z",
      "updated_at": "2024-08-19T14:24:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1721879299",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1721879299"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722285129",
      "pull_request_review_id": 2246356092,
      "id": 1722285129,
      "node_id": "PRRC_kwDOABII585mp_xJ",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "you can resolve this comment, I see now that this should definitely be investigated in a separate PR (it's a big change).",
      "created_at": "2024-08-19T19:59:56Z",
      "updated_at": "2024-08-19T19:59:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722285129",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722285129"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722286606",
      "pull_request_review_id": 2246358443,
      "id": 1722286606,
      "node_id": "PRRC_kwDOABII585mqAIO",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It doesn't sound like it's `GetCoin`'s responsibility, I think the call-sites should be checking for whether the coins are spent or not, not the cache accessor method",
      "created_at": "2024-08-19T20:01:26Z",
      "updated_at": "2024-08-19T21:20:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722286606",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722286606"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722535036",
      "pull_request_review_id": 2246751794,
      "id": 1722535036,
      "node_id": "PRRC_kwDOABII585mq8x8",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think you can resolve your own comment threads too ðŸ˜‰",
      "created_at": "2024-08-20T00:18:18Z",
      "updated_at": "2024-08-20T00:18:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722535036",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722535036"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722578637",
      "pull_request_review_id": 2246814506,
      "id": 1722578637,
      "node_id": "PRRC_kwDOABII585mrHbN",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It's specifically documented that this is the behavior. Why shouldn't we be able to rely on it?",
      "created_at": "2024-08-20T01:39:34Z",
      "updated_at": "2024-08-20T01:39:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722578637",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722578637"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722716550",
      "pull_request_review_id": 2247013328,
      "id": 1722716550,
      "node_id": "PRRC_kwDOABII585mrpGG",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 12,
      "original_position": 13,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "963804c5f1f722dd14f07f8bccb90bd4825fbf9e",
      "in_reply_to_id": 1721727681,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't have write access to your PR:\r\nhttps://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews#resolving-conversations",
      "created_at": "2024-08-20T05:42:04Z",
      "updated_at": "2024-08-20T05:42:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722716550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722716550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 148,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722725094",
      "pull_request_review_id": 2247026258,
      "id": 1722725094,
      "node_id": "PRRC_kwDOABII585mrrLm",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If we need to document the behavior of a method, it suggests that weâ€™ve acknowledged it may not be intuitive for everyone, indicating that weâ€™ve conceded on finding a better design.\r\nI think there's a way we can avoid the comment: by separating the two concerns of getting a value from cache and checking if it's spent or not.\r\nOr if you insist, we can call it \"GetUnspent\" in which case we can also get rid of the comment and call-site asserts and keep the current behavior.\r\nWhat do you think?",
      "created_at": "2024-08-20T05:53:30Z",
      "updated_at": "2024-08-20T05:53:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1722725094",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1722725094"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723632249",
      "pull_request_review_id": 2248528707,
      "id": 1723632249,
      "node_id": "PRRC_kwDOABII585mvIp5",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What you are suggesting is basically a concept NACK on this PR. If we aren't confident that we will never get a spent coin from GetCoin, then we need to keep the logic to handle spent and FRESH coins.",
      "created_at": "2024-08-20T16:40:22Z",
      "updated_at": "2024-08-20T16:40:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723632249",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723632249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723636084",
      "pull_request_review_id": 2248534125,
      "id": 1723636084,
      "node_id": "PRRC_kwDOABII585mvJl0",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "@paplorinc I feel your criticism here is about the naming/expectations/documentation of the existing code, rather than about this PR. Do you feel that addressing that first should be a blocker for this PR?",
      "created_at": "2024-08-20T16:43:09Z",
      "updated_at": "2024-08-20T16:43:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723636084",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723636084"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723665550",
      "pull_request_review_id": 2248581119,
      "id": 1723665550,
      "node_id": "PRRC_kwDOABII585mvQyO",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I won't block this since I'm fine with discussing/addressing any issues in later commits as well. \r\nI also don't yet understand the second order effects of these changes, so treat my comments as curious observations.\r\n\r\nSo my concern is that in this PR we're tying `coin.IsSpent()` with retrieving values from the cache.\r\nSo if my understanding is correct we should either:\r\n* be able to get a coin from the cache and ignore/assert whether it's spent or not - e.g. [`HaveCoin`](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L21) will now return false when the cache contains it but it's spent... and if that's not possible in certain situations I would assert instead of returning the boolean.\r\nSo in that case `GetCoin` would just get it from the cache and the call-site will decide whether it should assert for `IsSpent` or branch based on it, something like this: https://github.com/bitcoin/bitcoin/blob/9db8b30788eff2b8e9c9f629a6a03886a28a3281/src/test/fuzz/coins_view.cpp#L167\r\n* rename the method to reflect the new responsibility that it has\r\n\r\nThere's also a third possibility that I'm completely off on what this PR does - your patience is appreciated :)",
      "created_at": "2024-08-20T17:06:19Z",
      "updated_at": "2024-08-20T17:06:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1723665550",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1723665550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727754817",
      "pull_request_review_id": 2255567815,
      "id": 1727754817,
      "node_id": "PRRC_kwDOABII585m-3JB",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "@l0rinc It seems to me like you are thinking this PR has some behavior change. Any coin retrieved from `GetCoin` will be unspent if `GetCoin` returns true. You can follow this logically from seeing the return value [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L65) and then the only base class is `CCoinsViewDB` which [does not save spent coins](https://github.com/bitcoin/bitcoin/blob/master/src/txdb.cpp#L120-L121) so cannot retrieve them in `GetCoin`.\r\n\r\nThis PR is recognizing that `FetchCoin` logically cannot get to [here](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L52) with a spent coin. [This](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L54) is a dead code path.",
      "created_at": "2024-08-22T20:13:28Z",
      "updated_at": "2024-08-22T20:19:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1727754817",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727754817"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727769365",
      "pull_request_review_id": 2255589561,
      "id": 1727769365,
      "node_id": "PRRC_kwDOABII585m-6sV",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yeah, I understand that.\r\n\r\nWhat I'm struggling with is the cache retrieval, and especially the invalidation logic, which seems to be scattered throughout the code and tightly coupled with the business logic.\r\n\r\nWould you be open to a screen-sharing session to discuss this? It would help me better understand the constraints and likely speed up my review process as well.",
      "created_at": "2024-08-22T20:26:40Z",
      "updated_at": "2024-08-22T20:26:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1727769365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1727769365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730970736",
      "pull_request_review_id": 2260190262,
      "id": 1730970736,
      "node_id": "PRRC_kwDOABII585nLIRw",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);\n         return m_next;\n     }\n \n-    //! Only call Prev when this entry is DIRTY, FRESH, or both\n+    //! Only call Prev when this entry is DIRTY\n     inline CoinsCachePair* Prev() const noexcept {",
      "path": "src/coins.h",
      "position": null,
      "original_position": 34,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md?plain=1#L70",
      "created_at": "2024-08-26T09:27:39Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1730970736",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1730970736"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731011814",
      "pull_request_review_id": 2260190262,
      "id": 1731011814,
      "node_id": "PRRC_kwDOABII585nLSTm",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {\n         auto it = m_data.find(outpoint);\n         if (it == m_data.end()) {\n-            if ((outpoint.n % 5) == 3) {\n-                coin.Clear();\n-                return true;\n-            }\n             return false;\n         } else {\n             coin = it->second;",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The docs state:\r\n> When false is returned, coin's value is unspecified.\r\n\r\nEventually I hope we can untangle these two \"return values\" (coin & spentness), but temporarily maybe we can improve this guarantee (since I'm very much against unspecified mutations of non-local state) so that we only set the value of coin when it's unspent (similarly to how `Uncache` handles this case), e.g.:\r\n```C++\r\nbool GetCoin(const COutPoint& outpoint, Coin& coin) const final\r\n{\r\n    if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) {\r\n        coin = it->second;\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n```",
      "created_at": "2024-08-26T09:58:51Z",
      "updated_at": "2024-08-26T11:52:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731011814",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731011814"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731019220",
      "pull_request_review_id": 2260190262,
      "id": 1731019220,
      "node_id": "PRRC_kwDOABII585nLUHU",
      "diff_hunk": "@@ -883,8 +875,13 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     for (const CAmount parent_value : {ABSENT, SPENT, VALUE1})\n         for (const CAmount child_value : {ABSENT, SPENT, VALUE2})\n             for (const char parent_flags : parent_value == ABSENT ? ABSENT_FLAGS : FLAGS)\n-                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS)\n-                    CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n+                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS) {\n+                    if (child_flags == FRESH) {",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 79,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: are we repeating business logic here? Can we make it more black-box somehow?",
      "created_at": "2024-08-26T10:04:50Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731019220",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731019220"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 889,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731020615",
      "pull_request_review_id": 2260190262,
      "id": 1731020615,
      "node_id": "PRRC_kwDOABII585nLUdH",
      "diff_hunk": "@@ -341,7 +338,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());",
      "path": "src/coins.cpp",
      "position": 133,
      "original_position": 102,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this will be redundant once we assert it in Prev and Next",
      "created_at": "2024-08-26T10:06:08Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731020615",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731020615"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731021714",
      "pull_request_review_id": 2260190262,
      "id": 1731021714,
      "node_id": "PRRC_kwDOABII585nLUuS",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 75,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: can be modernized to (note: can likely be deduplicated with `GetCoin`):\r\n```suggestion\r\n    if (auto it{cacheCoins.find(hash)}; it != cacheCoins.end() && !it->second.IsDirty()) {\r\n```",
      "created_at": "2024-08-26T10:07:08Z",
      "updated_at": "2024-12-06T15:04:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731021714",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731021714"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 271,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731055682",
      "pull_request_review_id": 2260190262,
      "id": 1731055682,
      "node_id": "PRRC_kwDOABII585nLdBC",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm having a hard time with https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L97, where the coin is obviously spent and can also be non-dirty (according to `updatecoins_simulation_test`, `ccoins_flush_behavior` and others), which violates `attr != 4`.\r\n\r\nIf it's valid for coin to (temporarily?) have that state, shouldn't `SanityCheck` allow it?\r\n\r\nOr if this is the state when the parent-cache gets invalidated because of a re-org, could we maybe simplify the possible states by always Sync-ing when a reorg is detected and/or only deleting spent entries from parent after a certain block maturity?",
      "created_at": "2024-08-26T10:39:21Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731055682",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731055682"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731100729",
      "pull_request_review_id": 2260190262,
      "id": 1731100729,
      "node_id": "PRRC_kwDOABII585nLoA5",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "So my understanding is that if a coin is already spent it's basically \"less likely\" to be in the cache (0% without [reorgs](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L84-L96), right?), so we want to get rid of it ASAP to have more likely cache hits.\r\nGiven that the complete UTXO set doesn't fit into memory anymore, would it maybe make sense to have a more complex retainment heuristic for each cache layer, e.g. spentness, recency, dust amount, unspendables, time-locked, etc?",
      "created_at": "2024-08-26T11:24:13Z",
      "updated_at": "2024-08-26T15:07:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731100729",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731100729"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731101997",
      "pull_request_review_id": 2260190262,
      "id": 1731101997,
      "node_id": "PRRC_kwDOABII585nLoUt",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 48,
      "original_position": 24,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I find it inconsistent that we're throwing here only for testability - since we assume this cannot happen in reality.\r\nBasically, this is another \"return value\" of the method, so declaring it a `bool` was essentially a lie (especially since it always seems to just return `true`).\r\nCould we use the return value instead to signal failure (and since we think this is impossible, skip the error messages)?",
      "created_at": "2024-08-26T11:25:28Z",
      "updated_at": "2024-08-26T13:41:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731101997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731101997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 180,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731108975",
      "pull_request_review_id": 2260190262,
      "id": 1731108975,
      "node_id": "PRRC_kwDOABII585nLqBv",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;\n+            CCoinsCacheEntry& entry{itUs->second};\n+            if (cursor.WillErase(*it)) {\n+                // Since this entry will be erased,\n+                // we can move the coin into us instead of copying it\n+                entry.coin = std::move(it->second.coin);\n+            } else {\n+                entry.coin = it->second.coin;\n+            }\n+            cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n+            entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n+            // We can mark it FRESH in the parent if it was FRESH in the child\n+            // Otherwise it might have just been flushed from the parent's cache\n+            // and already exist in the grandparent\n+            if (it->second.IsFresh()) {\n+                entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n             }",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Instead of calling `AddFlags` twice, in [other cases](https://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L100) we've compressed this into a single line:\r\n```suggestion\r\n            entry.AddFlags(CCoinsCacheEntry::DIRTY | (it->second.IsFresh() ? CCoinsCacheEntry::FRESH : 0), *itUs, m_sentinel);\r\n```",
      "created_at": "2024-08-26T11:31:50Z",
      "updated_at": "2024-08-26T11:54:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731108975",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731108975"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 206,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731110623",
      "pull_request_review_id": 2260190262,
      "id": 1731110623,
      "node_id": "PRRC_kwDOABII585nLqbf",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Now that this structure is simpler, we could modernize (and optimize) this `find` / `try_emplace` construct as:\r\n```C++\r\nauto [itUs, inserted] = cacheCoins.try_emplace(it->first);\r\nif (inserted) {\r\n```",
      "created_at": "2024-08-26T11:33:30Z",
      "updated_at": "2024-08-26T11:51:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1731110623",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1731110623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 190,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739894024",
      "pull_request_review_id": 2274110468,
      "id": 1739894024,
      "node_id": "PRRC_kwDOABII585ntK0I",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 48,
      "original_position": 24,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This can happen in our fuzz tests. I think a follow up to this change would be to remove direct access to the flags, and replace with methods `SetDirty` and `SetDirtyAndFresh`. Then we can get rid of fuzzing all kinds of flags and simplify this.",
      "created_at": "2024-08-31T18:15:39Z",
      "updated_at": "2024-08-31T18:15:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739894024",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739894024"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 180,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739895229",
      "pull_request_review_id": 2274112490,
      "id": 1739895229,
      "node_id": "PRRC_kwDOABII585ntLG9",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 51,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731110623,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, that would be a good follow up!",
      "created_at": "2024-08-31T18:17:35Z",
      "updated_at": "2024-08-31T18:17:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739895229",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739895229"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 191,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 190,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908195",
      "pull_request_review_id": 2274130096,
      "id": 1739908195,
      "node_id": "PRRC_kwDOABII585ntORj",
      "diff_hunk": "@@ -325,14 +321,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 86,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": 1721668812,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:18:35Z",
      "updated_at": "2024-08-31T19:18:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908195",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908195"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 321,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 326,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908200",
      "pull_request_review_id": 2274130115,
      "id": 1739908200,
      "node_id": "PRRC_kwDOABII585ntORo",
      "diff_hunk": "@@ -53,14 +53,11 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {",
      "path": "src/test/coins_tests.cpp",
      "position": 18,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "946a035cdc298c3168b1164079892a85902c966f",
      "in_reply_to_id": 1721738283,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:18:42Z",
      "updated_at": "2024-08-31T19:18:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 64,
      "original_line": 64,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908500",
      "pull_request_review_id": 2274130348,
      "id": 1739908500,
      "node_id": "PRRC_kwDOABII585ntOWU",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731055682,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "A coin cannot be spent and not DIRTY. I made a new commit to address this in AddCoin. The only time it will be in this state is when a `CCoinsViewCacheEntry` is constructed with an empty coin, which then has the coin moved into it a few lines later.\r\n\r\nI think doing a follow up where we remove direct access to flags can remove a lot of code paths that we test for.",
      "created_at": "2024-08-31T19:20:55Z",
      "updated_at": "2024-08-31T19:20:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908500",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908500"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908616",
      "pull_request_review_id": 2274130449,
      "id": 1739908616,
      "node_id": "PRRC_kwDOABII585ntOYI",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }\n         CCoinsMap::iterator itUs = cacheCoins.find(it->first);\n         if (itUs == cacheCoins.end()) {\n             // The parent cache does not have an entry, while the child cache does.\n-            // We can ignore it if it's both spent and FRESH in the child\n-            if (!(it->second.IsFresh() && it->second.coin.IsSpent())) {\n-                // Create the coin in the parent cache, move the data up\n-                // and mark it as dirty.\n-                itUs = cacheCoins.try_emplace(it->first).first;\n-                CCoinsCacheEntry& entry{itUs->second};\n-                if (cursor.WillErase(*it)) {\n-                    // Since this entry will be erased,\n-                    // we can move the coin into us instead of copying it\n-                    entry.coin = std::move(it->second.coin);\n-                } else {\n-                    entry.coin = it->second.coin;\n-                }\n-                cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n-                // We can mark it FRESH in the parent if it was FRESH in the child\n-                // Otherwise it might have just been flushed from the parent's cache\n-                // and already exist in the grandparent\n-                if (it->second.IsFresh()) {\n-                    entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n-                }\n+            // Create the coin in the parent cache, move the data up\n+            // and mark it as dirty.\n+            itUs = cacheCoins.try_emplace(it->first).first;\n+            CCoinsCacheEntry& entry{itUs->second};\n+            if (cursor.WillErase(*it)) {\n+                // Since this entry will be erased,\n+                // we can move the coin into us instead of copying it\n+                entry.coin = std::move(it->second.coin);\n+            } else {\n+                entry.coin = it->second.coin;\n+            }\n+            cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n+            entry.AddFlags(CCoinsCacheEntry::DIRTY, *itUs, m_sentinel);\n+            // We can mark it FRESH in the parent if it was FRESH in the child\n+            // Otherwise it might have just been flushed from the parent's cache\n+            // and already exist in the grandparent\n+            if (it->second.IsFresh()) {\n+                entry.AddFlags(CCoinsCacheEntry::FRESH, *itUs, m_sentinel);\n             }",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 67,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731108975,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think I only touch this in whitespace, so I don't want to refactor this right now.",
      "created_at": "2024-08-31T19:21:46Z",
      "updated_at": "2024-08-31T19:21:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908616",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908616"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 206,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 210,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908771",
      "pull_request_review_id": 2274130608,
      "id": 1739908771,
      "node_id": "PRRC_kwDOABII585ntOaj",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Given that the complete UTXO set doesn't fit into memory anymore, would it maybe make sense to have a more complex retainment heuristic for each cache layer,\r\n\r\nSince we now have a linked list of entries, we could have another sentinel that tracks coins that have their flags cleared. Then, when doing a flush we could just remove a chunk from the bottom of the linked list (entries added least recently).",
      "created_at": "2024-08-31T19:23:33Z",
      "updated_at": "2024-08-31T19:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908771",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908812",
      "pull_request_review_id": 2274130668,
      "id": 1739908812,
      "node_id": "PRRC_kwDOABII585ntObM",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": 1721733726,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-08-31T19:24:13Z",
      "updated_at": "2024-08-31T19:24:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739908812",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739908812"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739909068",
      "pull_request_review_id": 2274130842,
      "id": 1739909068,
      "node_id": "PRRC_kwDOABII585ntOfM",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent\n+        Assume(!ret->second.coin.IsSpent());",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": 1721510656,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It would be a fatal error when running in DEBUG mode, but is not compiled in for release.\r\n\r\n> when do we throw and when do we Assume here?\r\n\r\nI only added throws to `BatchWrite` because there are invalid states that can happen in our fuzz test harness which we want to handle properly. A follow up to remove setting the flags directly can help make that more clear and we wouldn't need to have the throws there anymore.",
      "created_at": "2024-08-31T19:26:00Z",
      "updated_at": "2024-08-31T19:26:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1739909068",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1739909068"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740112856",
      "pull_request_review_id": 2274390022,
      "id": 1740112856,
      "node_id": "PRRC_kwDOABII585nuAPY",
      "diff_hunk": "@@ -184,13 +177,13 @@ struct CCoinsCacheEntry\n     inline bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     inline bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     inline CoinsCachePair* Next() const noexcept {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 28,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ffabb2ddcd3c31e54b11a56c7e395af6b830e443",
      "in_reply_to_id": 1721733726,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't see it in `doc: update comments to reflect possible code paths` (b0737df12ed6922624d3e78bbb2bc86e610522cd)",
      "created_at": "2024-09-01T14:08:25Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740112856",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740112856"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 182,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118331",
      "pull_request_review_id": 2274390022,
      "id": 1740118331,
      "node_id": "PRRC_kwDOABII585nuBk7",
      "diff_hunk": "@@ -79,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin",
      "path": "src/coins.cpp",
      "position": 25,
      "original_position": 14,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "can this still happen during a reorg? The comment here is really scary, do we really need so much context here? I'd prefer a test that fails when the code is wrong instead of a really long description...",
      "created_at": "2024-09-01T14:23:11Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740118331",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118331"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 88,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118813",
      "pull_request_review_id": 2274390022,
      "id": 1740118813,
      "node_id": "PRRC_kwDOABII585nuBsd",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "comment states exactly what the code already states - it's just noise, can be removed",
      "created_at": "2024-09-01T14:24:28Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740118813",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740118813"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131338",
      "pull_request_review_id": 2274390022,
      "id": 1740131338,
      "node_id": "PRRC_kwDOABII585nuEwK",
      "diff_hunk": "@@ -81,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin\n         // is 'spent' when the block adding it is disconnected and then\n         // re-added when it is also added in a newly connected block).\n         //\n-        // If the coin doesn't exist in the current cache, or is spent but not\n-        // DIRTY, then it can be marked FRESH.\n-        fresh = !it->second.IsDirty();\n+        // If the coin doesn't exist in the current cache then it can be marked FRESH.\n+        fresh = inserted;",
      "path": "src/coins.cpp",
      "position": 33,
      "original_position": 35,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The freshness flag depend on `inserted`, `possible_overwrite` and `it->second.coin.IsSpent()`, assigned and validated in different places.\r\nCould we obviate the freshness flag calculation instead with something like:\r\n```C++\r\nbool fresh_flag = inserted && !possible_overwrite ? CCoinsCacheEntry::FRESH : 0;\r\n```\r\n\r\nEither here or in a follow-up we could simplify & modernize the method to something like:\r\n```C++\r\nvoid CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possible_overwrite) {\r\n    assert(!coin.IsSpent());\r\n    if (coin.out.scriptPubKey.IsUnspendable()) return;\r\n\r\n    auto [it, inserted] = cacheCoins.try_emplace(outpoint);\r\n    if (!inserted) {\r\n        if (!possible_overwrite && !it->second.coin.IsSpent()) throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\r\n        cachedCoinsUsage -= it->second.coin.DynamicMemoryUsage();\r\n    }\r\n    cachedCoinsUsage += coin.DynamicMemoryUsage();\r\n    it->second.coin = std::move(coin);\r\n\r\n    bool fresh_flag = inserted && !possible_overwrite ? CCoinsCacheEntry::FRESH : 0;\r\n    it->second.AddFlags(CCoinsCacheEntry::DIRTY | fresh_flag, *it, m_sentinel);\r\n\r\n    TRACE5(utxocache, add,\r\n           outpoint.hash.data(),\r\n           (uint32_t) outpoint.n,\r\n           (uint32_t) it->second.coin.nHeight,\r\n           (int64_t) it->second.coin.out.nValue,\r\n           (bool) it->second.coin.IsCoinBase());\r\n}\r\n```",
      "created_at": "2024-09-01T14:51:11Z",
      "updated_at": "2024-09-01T16:12:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740131338",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740131338"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740132832",
      "pull_request_review_id": 2274390022,
      "id": 1740132832,
      "node_id": "PRRC_kwDOABII585nuFHg",
      "diff_hunk": "@@ -341,7 +338,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());",
      "path": "src/coins.cpp",
      "position": 133,
      "original_position": 102,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731020615,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We can remove this now",
      "created_at": "2024-09-01T14:54:05Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740132832",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740132832"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740141831",
      "pull_request_review_id": 2274390022,
      "id": 1740141831,
      "node_id": "PRRC_kwDOABII585nuHUH",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "That sounds like a really good idea that we should investigate after this PR!",
      "created_at": "2024-09-01T15:16:18Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740141831",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740141831"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740147320",
      "pull_request_review_id": 2274390022,
      "id": 1740147320,
      "node_id": "PRRC_kwDOABII585nuIp4",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "unrelated: could `coins_cache_simulation_test`be moved into a fuzz test - or would it be too difficult to track all those states?.\r\nIf you think any of these recommendations can be done in a parallel PR, let me know and I'll do them myself before this is merged",
      "created_at": "2024-09-01T15:30:41Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740147320",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740147320"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 754,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740154464",
      "pull_request_review_id": 2274390022,
      "id": 1740154464,
      "node_id": "PRRC_kwDOABII585nuKZg",
      "diff_hunk": "@@ -892,8 +885,13 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     for (const CAmount parent_value : {ABSENT, SPENT, VALUE1})\n         for (const CAmount child_value : {ABSENT, SPENT, VALUE2})\n             for (const char parent_flags : parent_value == ABSENT ? ABSENT_FLAGS : FLAGS)\n-                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS)\n-                    CheckWriteCoins(parent_value, child_value, parent_value, parent_flags, child_flags, parent_flags);\n+                for (const char child_flags : child_value == ABSENT ? ABSENT_FLAGS : CLEAN_FLAGS) {",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I might be completely off here, but in case of e.g. `CheckWriteCoins(ABSENT, SPENT , FAIL  , NO_ENTRY   , DIRTY|FRESH, NO_ENTRY   );` we're calling `.IsDirty()` which returns false, but `m_next` and `m_prev` are set because `CheckWriteCoins` calls them with different flags.\r\n\r\nCan this happen during actual usage, i.e. shouldn't they only be part of the internal linked list when they're dirty?\r\n\r\nIt bothers me a lot how many of the simulated combinations don't always seem to reflect real usage - while comments warn us of situations that may not be covered with tests at all.\r\nWould it maybe make sense to fix the reliability of the tests before this PR?",
      "created_at": "2024-09-01T16:05:02Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740154464",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740154464"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 888,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155232",
      "pull_request_review_id": 2274390022,
      "id": 1740155232,
      "node_id": "PRRC_kwDOABII585nuKlg",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 48,
      "original_position": 24,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can we consider fixing that before this PR? I wouldn't mind doing parts of that myself!",
      "created_at": "2024-09-01T16:09:36Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740155232",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155232"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 180,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155419",
      "pull_request_review_id": 2274390022,
      "id": 1740155419,
      "node_id": "PRRC_kwDOABII585nuKob",
      "diff_hunk": "@@ -325,14 +322,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 85,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731055682,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "That makes sense, as stated in other comments, I would be more comfortable doing that before this refactoring.",
      "created_at": "2024-09-01T16:10:27Z",
      "updated_at": "2024-09-01T16:11:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1740155419",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1740155419"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1748087322",
      "pull_request_review_id": 2287494664,
      "id": 1748087322,
      "node_id": "PRRC_kwDOABII585oMbIa",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {\n         auto it = m_data.find(outpoint);\n         if (it == m_data.end()) {\n-            if ((outpoint.n % 5) == 3) {\n-                coin.Clear();",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": null,
      "original_position": 17,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I found this very confusing - a coin getter checking the cache, and if it's *not* found, it clears the coin that it was supposed to return?",
      "created_at": "2024-09-07T13:25:41Z",
      "updated_at": "2024-09-08T18:22:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1748087322",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1748087322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 155,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1748096184",
      "pull_request_review_id": 2287494664,
      "id": 1748096184,
      "node_id": "PRRC_kwDOABII585oMdS4",
      "diff_hunk": "@@ -151,14 +148,10 @@ class CoinsViewBottom final : public CCoinsView\n     {\n         auto it = m_data.find(outpoint);\n         if (it == m_data.end()) {\n-            if ((outpoint.n % 5) == 3) {\n-                coin.Clear();\n-                return true;\n-            }\n             return false;",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": null,
      "original_position": 20,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "since this always return false now for missing values, can https://github.com/bitcoin/bitcoin/pull/30673/files#diff-a8f78513bc27f9bf679eead54819a8e5be720401c6ae40858da226a66ca002e2R258 still happen?",
      "created_at": "2024-09-07T13:56:07Z",
      "updated_at": "2024-09-08T18:22:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1748096184",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1748096184"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749283536",
      "pull_request_review_id": 2288566584,
      "id": 1749283536,
      "node_id": "PRRC_kwDOABII585oQ_LQ",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 48,
      "original_position": 24,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Are you suggesting to refactor direct flags access with `SetDirty` and `SetDirtyAndFresh` first? If we do that first, we would still need a `SetFresh` setter since we still have a case here with setting FRESH-but-not-DIRTY. It's kind of a chicken-and-egg problem.",
      "created_at": "2024-09-08T16:19:12Z",
      "updated_at": "2024-09-08T16:19:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1749283536",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749283536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 180,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749317722",
      "pull_request_review_id": 2287494664,
      "id": 1749317722,
      "node_id": "PRRC_kwDOABII585oRHha",
      "diff_hunk": "@@ -184,34 +182,33 @@ void CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n \n bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashBlockIn) {\n     for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n-        // Ignore non-dirty entries (optimization).\n         if (!it->second.IsDirty()) {\n-            continue;\n+            throw std::logic_error(\"A non-DIRTY coin was returned from the cursor in BatchWrite\");\n+        }\n+        if (it->second.IsFresh() && it->second.coin.IsSpent()) {\n+            throw std::logic_error(\"A FRESH coin was not removed when it was spent\");\n         }",
      "path": "src/coins.cpp",
      "position": 48,
      "original_position": 24,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731101997,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I suggest we make our tests reflect reality before we do this change, since currently if we add asserts about the internal consistency of the code, the tests seem to constantly violate them.",
      "created_at": "2024-09-08T18:22:21Z",
      "updated_at": "2024-09-08T18:22:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1749317722",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749317722"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 180,
      "original_start_line": 186,
      "start_side": "RIGHT",
      "line": 184,
      "original_line": 184,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749350258",
      "pull_request_review_id": 2288599258,
      "id": 1749350258,
      "node_id": "PRRC_kwDOABII585oRPdy",
      "diff_hunk": "@@ -51,25 +51,19 @@ class CCoinsViewTest : public CCoinsView\n             return false;\n         }\n         coin = it->second;\n-        if (coin.IsSpent() && m_rng.randbool() == 0) {",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Did this change require any other test adjustment?",
      "created_at": "2024-09-08T20:31:18Z",
      "updated_at": "2024-09-08T20:31:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1749350258",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749350258"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749352045",
      "pull_request_review_id": 2288600068,
      "id": 1749352045,
      "node_id": "PRRC_kwDOABII585oRP5t",
      "diff_hunk": "@@ -51,25 +51,19 @@ class CCoinsViewTest : public CCoinsView\n             return false;\n         }\n         coin = it->second;\n-        if (coin.IsSpent() && m_rng.randbool() == 0) {",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1749350258,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "No, but without this the next commit would break.",
      "created_at": "2024-09-08T20:38:44Z",
      "updated_at": "2024-09-08T20:38:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1749352045",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749352045"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749355280",
      "pull_request_review_id": 2288601657,
      "id": 1749355280,
      "node_id": "PRRC_kwDOABII585oRQsQ",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1722286606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added https://github.com/bitcoin/bitcoin/pull/30849 to somewhat mitigate the `GetCoin` mutations in tests - hoping this will get us closer to excluding invalid tests states.",
      "created_at": "2024-09-08T20:52:37Z",
      "updated_at": "2024-09-08T20:52:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1749355280",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1749355280"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756663411",
      "pull_request_review_id": 2300006986,
      "id": 1756663411,
      "node_id": "PRRC_kwDOABII585otI5z",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY|FRESH, false);\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY      , true );\n-    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY|FRESH, false);\n+    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY      , false);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It seems to me that production code never actually calls `AddFlags` with a 0 value â€” we are always setting `DIRTY`, even when `FRESH` is set.\r\nTherefore, it would make sense to change `AddFlags` from using a custom `uint8_t flags` parameter (which is always `DIRTY` and sometimes `FRESH` in practice, and only called with a `0` in tests) to using a freshness parameter, such as `SetDirtyAndFresh(CoinsCachePair& self, CoinsCachePair& sentinel, bool is_fresh = false)`.\r\n\r\nThis change would allow us to remove a lot of invalid test cases like this one (i.e. where flag is 0 or non-dirty).\r\n\r\nAs you've also mentioned, this would also allow us to remove the internal flags entirely.\r\nInstead of exposing the flags, we could simplify the implementation like this:\r\n```C++\r\ninline bool IsDirty() const noexcept\r\n{\r\n    assert(!m_next == !m_prev);\r\n    return !!m_next;\r\n}\r\ninline bool IsFresh() const noexcept { return m_is_fresh; }\r\n```",
      "created_at": "2024-09-12T11:21:58Z",
      "updated_at": "2024-09-12T12:02:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756663411",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756663411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 790,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756754331",
      "pull_request_review_id": 2300144399,
      "id": 1756754331,
      "node_id": "PRRC_kwDOABII585otfGb",
      "diff_hunk": "@@ -341,7 +337,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());\n         // Count the number of entries actually in the list.\n         ++count_linked;",
      "path": "src/coins.cpp",
      "position": 135,
      "original_position": 139,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "to avoid an infinite loop when the linking is incorrect (e.g. next returns itself), we could `assert(count_linked++ < count_flagged)`; ",
      "created_at": "2024-09-12T12:23:34Z",
      "updated_at": "2024-09-12T12:23:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756754331",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756754331"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756759971",
      "pull_request_review_id": 2300152803,
      "id": 1756759971,
      "node_id": "PRRC_kwDOABII585otgej",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY|FRESH, false);\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY      , true );\n-    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY|FRESH, false);\n+    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY      , false);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1756663411,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, absolutely! But, this PR or something else would need to be merged first, or we would need to have a method `SetFresh` because there's still a case where we have FRESH but not DIRTY.\n\nI think we should keep the internal flags as a bitmap, since if we introduce new fields for each state it will increase the memory footprint of each `CoinsCachePair`.\n",
      "created_at": "2024-09-12T12:27:17Z",
      "updated_at": "2024-09-12T12:27:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756759971",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756759971"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 790,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756770827",
      "pull_request_review_id": 2300168870,
      "id": 1756770827,
      "node_id": "PRRC_kwDOABII585otjIL",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY|FRESH, false);\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY      , true );\n-    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY|FRESH, false);\n+    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY      , false);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1756663411,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> because there's still a case where we have FRESH but not DIRTY.\r\n\r\nI only see https://github.com/bitcoin/bitcoin/blob/34a101d4babd0cd2df86b414da385c3bded84027/src/coins.cpp#L204-L210 and https://github.com/bitcoin/bitcoin/blob/34a101d4babd0cd2df86b414da385c3bded84027/src/coins.cpp#L96 in production code - in both cases we're only setting `FRESH` together with `DIRTY`.\r\nDid I miss anything in production code?\r\n\r\n> I think we should keep the internal flags as a bitmap, since if we introduce new fields for each state it will increase the memory footprint of each CoinsCachePair.\r\n\r\nI would rather we simplify to boolean, and if we need more flags, change it to an `uint8_t` again - I don't like over-generalizing for hypothetical scenarios - unless we're sure about that future direction (which I understood isn't the case).",
      "created_at": "2024-09-12T12:34:06Z",
      "updated_at": "2024-09-12T12:34:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756770827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756770827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 790,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756868684",
      "pull_request_review_id": 2300319089,
      "id": 1756868684,
      "node_id": "PRRC_kwDOABII585ot7BM",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY|FRESH, false);\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY      , true );\n-    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY|FRESH, false);\n+    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY      , false);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1756663411,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This case will still have to be handled if this PR is not merged first:\r\nhttps://github.com/bitcoin/bitcoin/blob/master/src/coins.cpp#L52-L55\r\n\r\n> I would rather we simplify to boolean, and if we need more flags, change it to an uint8_t again\r\n\r\nWhat I meant was adding a new field for DIRTY and a new field for FRESH. Since bools must be at least 1 byte it could make the pair larger depending on alignment.",
      "created_at": "2024-09-12T13:28:53Z",
      "updated_at": "2024-09-12T13:28:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756868684",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756868684"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 790,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756990148",
      "pull_request_review_id": 2300504990,
      "id": 1756990148,
      "node_id": "PRRC_kwDOABII585ouYrE",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY|FRESH, false);\n     CheckAddCoin(ABSENT, VALUE3, VALUE3, NO_ENTRY   , DIRTY      , true );\n-    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY|FRESH, false);\n+    CheckAddCoin(SPENT , VALUE3, VALUE3, 0          , DIRTY      , false);",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 38,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1756663411,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "But we don't need `bool` for dirty anymore, only for freshness - so we can even get rid of the enum (moving it over to the test maybe). I'll experiment to see what the next smallest change is before this PR, we need to have tests that are more representative of what's actually possible.",
      "created_at": "2024-09-12T14:29:45Z",
      "updated_at": "2024-09-12T14:29:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1756990148",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1756990148"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 790,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1760050345",
      "pull_request_review_id": 2305363877,
      "id": 1760050345,
      "node_id": "PRRC_kwDOABII585o6Dyp",
      "diff_hunk": "@@ -49,10 +49,8 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n             cacheCoins.erase(ret);\n             return cacheCoins.end();\n         }\n-        if (ret->second.coin.IsSpent()) {\n-            // The parent only has an empty entry for this outpoint; we can consider our version as fresh.\n-            ret->second.AddFlags(CCoinsCacheEntry::FRESH, *ret, m_sentinel);\n-        }\n+        // GetCoin will never return true if the coin is spent\n+        Assume(!ret->second.coin.IsSpent());",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 9,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "feaea74b049834f5388c477df3c985c202e491dd",
      "in_reply_to_id": 1721510656,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Split out to https://github.com/bitcoin/bitcoin/pull/30906",
      "created_at": "2024-09-15T13:39:53Z",
      "updated_at": "2024-09-15T13:39:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1760050345",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1760050345"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1872997671",
      "pull_request_review_id": 2484285325,
      "id": 1872997671,
      "node_id": "PRRC_kwDOABII585vo60n",
      "diff_hunk": "@@ -148,8 +146,7 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "9badfdb67eda320b4b76608f70e8e89de817a117",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "shouldn't `HaveCoin` be synchronized with the behavior of `GetCoin`? This will return `true` now if we have entries that are in the db and spent:\r\n```suggestion\r\n    bool HaveCoin(const COutPoint& outpoint) const override\r\n    {\r\n        return GetCoin(outpoint).has_value();\r\n    }\r\n```",
      "created_at": "2024-12-06T10:21:45Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1872997671",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1872997671"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873001098",
      "pull_request_review_id": 2484285325,
      "id": 1873001098,
      "node_id": "PRRC_kwDOABII585vo7qK",
      "diff_hunk": "@@ -148,8 +146,7 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;\n         return std::nullopt;\n     }",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 17,
      "original_position": 17,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "9badfdb67eda320b4b76608f70e8e89de817a117",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Nit: we could unify this methods with `CCoinsViewTest#GetCoin` in the same commit `test: never return true from GetCoins for spent entries` (brace init & `override` instead of `final`):\r\n```suggestion\r\n    std::optional<Coin> GetCoin(const COutPoint& outpoint) const override\r\n    {\r\n        if (auto it{m_data.find(outpoint)}; it != m_data.end() && !it->second.IsSpent()) return it->second;\r\n        return std::nullopt;\r\n    }\r\n```",
      "created_at": "2024-12-06T10:24:26Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873001098",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873001098"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 147,
      "original_start_line": 147,
      "start_side": "RIGHT",
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873005218",
      "pull_request_review_id": 2484285325,
      "id": 1873005218,
      "node_id": "PRRC_kwDOABII585vo8qi",
      "diff_hunk": "@@ -49,12 +49,9 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     const auto [ret, inserted] = cacheCoins.try_emplace(outpoint);\n     if (inserted) {\n         if (auto coin{base->GetCoin(outpoint)}) {\n+            Assume(!coin.value().IsSpent());",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "2aaba5b70476c552d165c1cc0990163f45f8009c",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This line could make sense while we're trying to get rid of invalid tests, but I don't see the value of keeping it in the code for `GetCoin` (unlike with `AccessCoin` which doesn't explicitly check)",
      "created_at": "2024-12-06T10:27:39Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873005218",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873005218"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873009991",
      "pull_request_review_id": 2484285325,
      "id": 1873009991,
      "node_id": "PRRC_kwDOABII585vo91H",
      "diff_hunk": "@@ -853,10 +855,12 @@ BOOST_AUTO_TEST_CASE(ccoins_write)\n     for (const MaybeCoin& parent : {MISSING,\n                                     SPENT_CLEAN, SPENT_DIRTY, SPENT_FRESH, SPENT_DIRTY_FRESH,\n                                     VALUE1_CLEAN, VALUE1_DIRTY, VALUE1_FRESH, VALUE1_DIRTY_FRESH}) {\n-        for (const MaybeCoin& child : {MISSING,\n-                                       SPENT_CLEAN, SPENT_FRESH,\n-                                       VALUE2_CLEAN, VALUE2_FRESH}) {\n-            auto expected{CoinOrError{parent}}; // TODO test failure cases as well\n+        for (const MaybeCoin& child : {MISSING, SPENT_CLEAN, VALUE2_CLEAN}) {\n+            auto expected{CoinOrError{parent}};\n+            CheckWriteCoins(parent, child, expected);\n+        }\n+        for (const MaybeCoin& child : {SPENT_FRESH, VALUE2_FRESH}) {",
      "path": "src/test/coins_tests.cpp",
      "position": 109,
      "original_position": 66,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "beautiful <3",
      "created_at": "2024-12-06T10:31:49Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873009991",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873009991"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 860,
      "original_line": 860,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873012245",
      "pull_request_review_id": 2484285325,
      "id": 1873012245,
      "node_id": "PRRC_kwDOABII585vo-YV",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't understand why we're okay with these values.\r\nAren't we simulating situations that cannot happen in reality (and should be a tragedy if they do appear, instead of whitelisting them)?",
      "created_at": "2024-12-06T10:33:52Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873012245",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873012245"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 154,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873014853",
      "pull_request_review_id": 2484285325,
      "id": 1873014853,
      "node_id": "PRRC_kwDOABII585vo_BF",
      "diff_hunk": "@@ -188,14 +181,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 29,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "c78fe97db854d0844c5080715ebdcba272be37ce",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I still think we should `Assume` what the comment states instead - and get rid of the redundant comment:\r\n```suggestion\r\n        Assume(IsDirty());\r\n```\r\n\r\nEdit: this seems to be done in [`a88c641` (#30673)](https://github.com/bitcoin/bitcoin/pull/30673/commits/a88c641d407af47d738e089426e71b69056273b8), please merge the two to avoid modifying a comment that is deleted later",
      "created_at": "2024-12-06T10:36:15Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873014853",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873014853"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873026637",
      "pull_request_review_id": 2484285325,
      "id": 1873026637,
      "node_id": "PRRC_kwDOABII585vpB5N",
      "diff_hunk": "@@ -58,14 +58,12 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {\n-                // Same optimization used in CCoinsViewDB is to only write dirty entries.\n-                map_[it->first] = it->second.coin;\n-                if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n-                    // Randomly delete empty entries on write.\n-                    map_.erase(it->first);\n-                }\n+        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n+            assert(it->second.IsDirty());\n+            map_[it->first] = it->second.coin;\n+            if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n+                // Randomly delete empty entries on write.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "empty entries?",
      "created_at": "2024-12-06T10:43:09Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873026637",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873026637"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873034606",
      "pull_request_review_id": 2484285325,
      "id": 1873034606,
      "node_id": "PRRC_kwDOABII585vpD1u",
      "diff_hunk": "@@ -147,7 +145,7 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\n \n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\n     bool ret = m_db->WriteBatch(batch);\n-    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\n+    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs to coin database...\\n\", (unsigned int)count);",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We [shouldn't need](https://github.com/bitcoin/bitcoin/blob/master/src/policy/fees.cpp#L472) the C cast (or the trailing newline)\r\n```suggestion\r\n    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs to coin database...\", count);\r\n```",
      "created_at": "2024-12-06T10:47:49Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873034606",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873034606"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873049737",
      "pull_request_review_id": 2484285325,
      "id": 1873049737,
      "node_id": "PRRC_kwDOABII585vpHiJ",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 75,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731021714,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I still think it applies",
      "created_at": "2024-12-06T10:53:17Z",
      "updated_at": "2024-12-06T11:02:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873049737",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873049737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 271,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873434527",
      "pull_request_review_id": 2484999561,
      "id": 1873434527,
      "node_id": "PRRC_kwDOABII585vqlef",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": 1873012245,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think after this change is merged, we can remove `SetFresh` and then the fuzz harness will not be able to add a FRESH-but-not-DIRTY. Then we can remove these catches and actually break if the fuzzer reaches them.\r\n\r\nRight now the fuzz harness can still call `SetFresh` without calling `SetDirty`.",
      "created_at": "2024-12-06T14:33:20Z",
      "updated_at": "2024-12-06T14:33:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873434527",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873434527"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 154,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873435467",
      "pull_request_review_id": 2485001218,
      "id": 1873435467,
      "node_id": "PRRC_kwDOABII585vqltL",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": 1873012245,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The other 2 though I think you're right. They should not be possible to hit even in the fuzz harness now. Will remove and fuzz.",
      "created_at": "2024-12-06T14:34:06Z",
      "updated_at": "2024-12-06T14:34:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873435467",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873435467"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 154,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873463122",
      "pull_request_review_id": 2485045855,
      "id": 1873463122,
      "node_id": "PRRC_kwDOABII585vqsdS",
      "diff_hunk": "@@ -58,14 +58,12 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {\n-                // Same optimization used in CCoinsViewDB is to only write dirty entries.\n-                map_[it->first] = it->second.coin;\n-                if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n-                    // Randomly delete empty entries on write.\n-                    map_.erase(it->first);\n-                }\n+        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n+            assert(it->second.IsDirty());\n+            map_[it->first] = it->second.coin;\n+            if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n+                // Randomly delete empty entries on write.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": 1873026637,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Spent entries are empty. I guess we could unify the terminology here.",
      "created_at": "2024-12-06T14:51:59Z",
      "updated_at": "2024-12-06T14:51:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873463122",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873463122"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873464327",
      "pull_request_review_id": 2485048018,
      "id": 1873464327,
      "node_id": "PRRC_kwDOABII585vqswH",
      "diff_hunk": "@@ -147,7 +145,7 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\n \n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\n     bool ret = m_db->WriteBatch(batch);\n-    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\n+    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs to coin database...\\n\", (unsigned int)count);",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": 1873034606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't think we can get rid of newlines...",
      "created_at": "2024-12-06T14:52:54Z",
      "updated_at": "2024-12-06T14:52:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873464327",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873464327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873465194",
      "pull_request_review_id": 2485049573,
      "id": 1873465194,
      "node_id": "PRRC_kwDOABII585vqs9q",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 75,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731021714,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Just seems like noise. What is the benefit of this refactor?",
      "created_at": "2024-12-06T14:53:29Z",
      "updated_at": "2024-12-06T14:53:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873465194",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873465194"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 271,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873479412",
      "pull_request_review_id": 2485072881,
      "id": 1873479412,
      "node_id": "PRRC_kwDOABII585vqwb0",
      "diff_hunk": "@@ -147,7 +145,7 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\n \n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\n     bool ret = m_db->WriteBatch(batch);\n-    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\n+    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs to coin database...\\n\", (unsigned int)count);",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": 1873034606,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It was removed in https://github.com/bitcoin/bitcoin/pull/30929/files#diff-8c9b223f6f7e311ef2a0585813c17e4cc78119d39ef9956431164336e9158832R137 - setting it back demonstrates that it's not needed anymore (but tolerated):\r\n```patch\r\ndiff --git a/src/test/logging_tests.cpp b/src/test/logging_tests.cpp\r\n--- a/src/test/logging_tests.cpp\t(revision ac69069c050a3a3a34e2b9f27a458872c4704e42)\r\n+++ b/src/test/logging_tests.cpp\t(date 1733497035556)\r\n@@ -134,7 +134,7 @@\r\n BOOST_FIXTURE_TEST_CASE(logging_LogPrintMacros, LogSetup)\r\n {\r\n     LogTrace(BCLog::NET, \"foo6: %s\", \"bar6\"); // not logged\r\n-    LogDebug(BCLog::NET, \"foo7: %s\", \"bar7\");\r\n+    LogDebug(BCLog::NET, \"foo7: %s\\n\", \"bar7\");\r\n     LogInfo(\"foo8: %s\", \"bar8\");\r\n     LogWarning(\"foo9: %s\", \"bar9\");\r\n     LogError(\"foo10: %s\", \"bar10\");\r\n\r\n```",
      "created_at": "2024-12-06T15:03:26Z",
      "updated_at": "2024-12-06T15:03:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873479412",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873479412"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873482849",
      "pull_request_review_id": 2485078859,
      "id": 1873482849,
      "node_id": "PRRC_kwDOABII585vqxRh",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 75,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731021714,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is what we've used in many other parts of the code since we're narrowing the scope of the iterator - helps with understanding the rest of the code where the it isn't available this way. But if you strongly disagree, this isn't a blocker for me.",
      "created_at": "2024-12-06T15:06:12Z",
      "updated_at": "2024-12-06T15:06:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1873482849",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1873482849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 271,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882817873",
      "pull_request_review_id": 2500679820,
      "id": 1882817873,
      "node_id": "PRRC_kwDOABII585wOYVR",
      "diff_hunk": "@@ -341,7 +338,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());",
      "path": "src/coins.cpp",
      "position": 133,
      "original_position": 102,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731020615,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We only `Assume` in prev and next, here we assert.",
      "created_at": "2024-12-12T20:08:51Z",
      "updated_at": "2024-12-12T20:08:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1882817873",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882817873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882973569",
      "pull_request_review_id": 2500900256,
      "id": 1882973569,
      "node_id": "PRRC_kwDOABII585wO-WB",
      "diff_hunk": "@@ -79,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin",
      "path": "src/coins.cpp",
      "position": 25,
      "original_position": 14,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": 1740118331,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, it can happen during a reorg. But we know we can't have a spent coin that is not DIRTY, so the comments being updated here are making this not be redundant. When the coin is spent in `DisconnectBlock`, it is either erased if FRESH or set DIRTY. The only time we would get into this block if the coin is not DIRTY is if it was just inserted.",
      "created_at": "2024-12-12T22:27:40Z",
      "updated_at": "2024-12-12T22:27:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1882973569",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882973569"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 88,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882974854",
      "pull_request_review_id": 2500902012,
      "id": 1882974854,
      "node_id": "PRRC_kwDOABII585wO-qG",
      "diff_hunk": "@@ -81,20 +79,18 @@ void CCoinsViewCache::AddCoin(const COutPoint &outpoint, Coin&& coin, bool possi\n         if (!it->second.coin.IsSpent()) {\n             throw std::logic_error(\"Attempted to overwrite an unspent coin (when possible_overwrite is false)\");\n         }\n-        // If the coin exists in this cache as a spent coin and is DIRTY, then\n+        // If the coin exists in this cache as a spent coin, then\n         // its spentness hasn't been flushed to the parent cache. We're\n         // re-adding the coin to this cache now but we can't mark it as FRESH.\n-        // If we mark it FRESH and then spend it before the cache is flushed\n-        // we would remove it from this cache and would never flush spentness\n-        // to the parent cache.\n+        // A spent FRESH coin cannot exist in the cache because a FRESH coin\n+        // is simply erased when it is spent.\n         //\n         // Re-adding a spent coin can happen in the case of a re-org (the coin\n         // is 'spent' when the block adding it is disconnected and then\n         // re-added when it is also added in a newly connected block).\n         //\n-        // If the coin doesn't exist in the current cache, or is spent but not\n-        // DIRTY, then it can be marked FRESH.\n-        fresh = !it->second.IsDirty();\n+        // If the coin doesn't exist in the current cache then it can be marked FRESH.\n+        fresh = inserted;",
      "path": "src/coins.cpp",
      "position": 33,
      "original_position": 35,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": 1740131338,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Let's leave this for a follow-up.",
      "created_at": "2024-12-12T22:29:05Z",
      "updated_at": "2024-12-12T22:29:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1882974854",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1882974854"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883209545",
      "pull_request_review_id": 2501182949,
      "id": 1883209545,
      "node_id": "PRRC_kwDOABII585wP39J",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": 1873012245,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Looking again, these can still be called with the fuzz harness. Removing `SetFresh` in a follow-up would allow us to remove one of them, but the other 2 would not since the `random_coin` can be a spent coin.",
      "created_at": "2024-12-13T03:34:32Z",
      "updated_at": "2024-12-13T03:34:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883209545",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883209545"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 154,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883224346",
      "pull_request_review_id": 2501202729,
      "id": 1883224346,
      "node_id": "PRRC_kwDOABII585wP7ka",
      "diff_hunk": "@@ -793,7 +787,7 @@ BOOST_AUTO_TEST_CASE(ccoins_add)\n      */",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 34,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "7d2b49926cc24522211ae185915072b2e37ca334",
      "in_reply_to_id": 1740147320,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I'm not sure. It might just be redundant to our current fuzz harness. It's also valuable to have these tests run on every CI.",
      "created_at": "2024-12-13T03:49:02Z",
      "updated_at": "2024-12-13T03:49:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883224346",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883224346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 754,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883226858",
      "pull_request_review_id": 2501206534,
      "id": 1883226858,
      "node_id": "PRRC_kwDOABII585wP8Lq",
      "diff_hunk": "@@ -341,7 +337,7 @@ void CCoinsViewCache::SanityCheck() const\n         assert(it->second.Next()->second.Prev() == it);\n         assert(it->second.Prev()->second.Next() == it);\n         // Verify they are actually flagged.\n-        assert(it->second.IsDirty() || it->second.IsFresh());\n+        assert(it->second.IsDirty());\n         // Count the number of entries actually in the list.\n         ++count_linked;",
      "path": "src/coins.cpp",
      "position": 135,
      "original_position": 139,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "34a101d4babd0cd2df86b414da385c3bded84027",
      "in_reply_to_id": 1756754331,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is unrelated to this change. It will timeout if that happens, but I suppose a separate PR could be made to add that.",
      "created_at": "2024-12-13T03:50:01Z",
      "updated_at": "2024-12-13T03:50:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883226858",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883226858"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 335,
      "original_line": 335,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883228311",
      "pull_request_review_id": 2501208791,
      "id": 1883228311,
      "node_id": "PRRC_kwDOABII585wP8iX",
      "diff_hunk": "@@ -148,8 +146,7 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 18,
      "original_position": 18,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "9badfdb67eda320b4b76608f70e8e89de817a117",
      "in_reply_to_id": 1872997671,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-12-13T03:50:27Z",
      "updated_at": "2024-12-13T03:50:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883228311",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883228311"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 152,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883232400",
      "pull_request_review_id": 2501214658,
      "id": 1883232400,
      "node_id": "PRRC_kwDOABII585wP9iQ",
      "diff_hunk": "@@ -148,8 +146,7 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;\n         return std::nullopt;\n     }",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 17,
      "original_position": 17,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "9badfdb67eda320b4b76608f70e8e89de817a117",
      "in_reply_to_id": 1873001098,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We would then have to share code between fuzz and unit tests, right? I'm not sure it's worth it for this.",
      "created_at": "2024-12-13T03:51:32Z",
      "updated_at": "2024-12-13T03:51:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883232400",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883232400"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 147,
      "original_start_line": 147,
      "start_side": "RIGHT",
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883232889",
      "pull_request_review_id": 2501215507,
      "id": 1883232889,
      "node_id": "PRRC_kwDOABII585wP9p5",
      "diff_hunk": "@@ -49,12 +49,9 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n     const auto [ret, inserted] = cacheCoins.try_emplace(outpoint);\n     if (inserted) {\n         if (auto coin{base->GetCoin(outpoint)}) {\n+            Assume(!coin.value().IsSpent());",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "2aaba5b70476c552d165c1cc0990163f45f8009c",
      "in_reply_to_id": 1873005218,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Removed that line.",
      "created_at": "2024-12-13T03:51:43Z",
      "updated_at": "2024-12-13T03:51:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883232889",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883232889"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883233732",
      "pull_request_review_id": 2501216792,
      "id": 1883233732,
      "node_id": "PRRC_kwDOABII585wP93E",
      "diff_hunk": "@@ -188,14 +181,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": null,
      "original_position": 29,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "c78fe97db854d0844c5080715ebdcba272be37ce",
      "in_reply_to_id": 1873014853,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-12-13T03:52:01Z",
      "updated_at": "2024-12-13T03:52:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883233732",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883233732"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883234101",
      "pull_request_review_id": 2501217683,
      "id": 1883234101,
      "node_id": "PRRC_kwDOABII585wP981",
      "diff_hunk": "@@ -58,14 +58,12 @@ class CCoinsViewTest : public CCoinsView\n \n     bool BatchWrite(CoinsViewCacheCursor& cursor, const uint256& hashBlock) override\n     {\n-        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)){\n-            if (it->second.IsDirty()) {\n-                // Same optimization used in CCoinsViewDB is to only write dirty entries.\n-                map_[it->first] = it->second.coin;\n-                if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n-                    // Randomly delete empty entries on write.\n-                    map_.erase(it->first);\n-                }\n+        for (auto it{cursor.Begin()}; it != cursor.End(); it = cursor.NextAndMaybeErase(*it)) {\n+            assert(it->second.IsDirty());\n+            map_[it->first] = it->second.coin;\n+            if (it->second.coin.IsSpent() && m_rng.randrange(3) == 0) {\n+                // Randomly delete empty entries on write.",
      "path": "src/test/coins_tests.cpp",
      "position": null,
      "original_position": 16,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": 1873026637,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-12-13T03:52:08Z",
      "updated_at": "2024-12-13T03:52:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883234101",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883234101"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883234632",
      "pull_request_review_id": 2501218368,
      "id": 1883234632,
      "node_id": "PRRC_kwDOABII585wP-FI",
      "diff_hunk": "@@ -147,7 +145,7 @@ bool CCoinsViewDB::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &hashB\n \n     LogDebug(BCLog::COINDB, \"Writing final batch of %.2f MiB\\n\", batch.SizeEstimate() * (1.0 / 1048576.0));\n     bool ret = m_db->WriteBatch(batch);\n-    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs (out of %u) to coin database...\\n\", (unsigned int)changed, (unsigned int)count);\n+    LogDebug(BCLog::COINDB, \"Committed %u changed transaction outputs to coin database...\\n\", (unsigned int)count);",
      "path": "src/txdb.cpp",
      "position": null,
      "original_position": 46,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "ca95ebb8d6afd1e810cdc84585797a59d5f32325",
      "in_reply_to_id": 1873034606,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-12-13T03:52:15Z",
      "updated_at": "2024-12-13T03:52:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883234632",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883234632"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883235870",
      "pull_request_review_id": 2501220493,
      "id": 1883235870,
      "node_id": "PRRC_kwDOABII585wP-Ye",
      "diff_hunk": "@@ -278,7 +275,7 @@ bool CCoinsViewCache::Sync()\n void CCoinsViewCache::Uncache(const COutPoint& hash)\n {\n     CCoinsMap::iterator it = cacheCoins.find(hash);\n-    if (it != cacheCoins.end() && !it->second.IsDirty() && !it->second.IsFresh()) {\n+    if (it != cacheCoins.end() && !it->second.IsDirty()) {",
      "path": "src/coins.cpp",
      "position": null,
      "original_position": 75,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "1f2f8e516b86d4a73bac0bedad753da3e307bf8a",
      "in_reply_to_id": 1731021714,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2024-12-13T03:52:42Z",
      "updated_at": "2024-12-13T03:52:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1883235870",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1883235870"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": 277,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 271,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884020028",
      "pull_request_review_id": 2502428850,
      "id": 1884020028,
      "node_id": "PRRC_kwDOABII585wS908",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "57f33c20634fecd1cdd98c1783d6aad3841d433b",
      "in_reply_to_id": 1873012245,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> since the random_coin can be a spent coin\r\n\r\nBut can that happen in reality or are we testing something that's difficult to justify?\r\n\r\n> There are no code paths which add a non-DIRTY entry to the cursor in BatchWrite, so we can safely make this a logic error and test for it.",
      "created_at": "2024-12-13T14:29:15Z",
      "updated_at": "2024-12-13T14:36:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884020028",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884020028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 154,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884021447",
      "pull_request_review_id": 2502431101,
      "id": 1884021447,
      "node_id": "PRRC_kwDOABII585wS-LH",
      "diff_hunk": "@@ -148,8 +146,7 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;\n         return std::nullopt;\n     }",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 17,
      "original_position": 17,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "9badfdb67eda320b4b76608f70e8e89de817a117",
      "in_reply_to_id": 1873001098,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I meant at least stylistically (helps with finding problems if the same logic is written in the same way)",
      "created_at": "2024-12-13T14:30:17Z",
      "updated_at": "2024-12-13T14:30:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884021447",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884021447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 147,
      "original_start_line": 147,
      "start_side": "RIGHT",
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884024221",
      "pull_request_review_id": 2502435536,
      "id": 1884024221,
      "node_id": "PRRC_kwDOABII585wS-2d",
      "diff_hunk": "@@ -148,14 +146,13 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end() && !it->second.IsSpent()) return it->second;",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 15,
      "original_position": 15,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: style of this `GetCoin` is still a tiny bit different from the other one (i.e. brace init)\r\n```suggestion\r\n        if (auto it{m_data.find(outpoint)}; it != m_data.end() && !it->second.IsSpent()) return it->second;\r\n```",
      "created_at": "2024-12-13T14:32:15Z",
      "updated_at": "2024-12-13T14:33:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884024221",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884024221"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 149,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884025924",
      "pull_request_review_id": 2502438288,
      "id": 1884025924,
      "node_id": "PRRC_kwDOABII585wS_RE",
      "diff_hunk": "@@ -48,10 +48,8 @@ class CCoinsViewTest : public CCoinsView\n \n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const override\n     {\n-        if (auto it{map_.find(outpoint)}; it != map_.end()) {\n-            if (!it->second.IsSpent() || m_rng.randbool()) {\n-                return it->second; // TODO spent coins shouldn't be returned\n-            }\n+        if (auto it{map_.find(outpoint)}; it != map_.end() && !it->second.IsSpent()) {\n+            return it->second;\n         }",
      "path": "src/test/coins_tests.cpp",
      "position": 10,
      "original_position": 10,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "e04bb1b4d22e74901ab63ae32c3f510bdf80204f",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: can be single-line now to align with other `GetCoin` implementations:\r\n```suggestion\r\n        if (auto it{map_.find(outpoint)}; it != map_.end() && !it->second.IsSpent()) return it->second\r\n```",
      "created_at": "2024-12-13T14:33:29Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884025924",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884025924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": 51,
      "original_start_line": 51,
      "start_side": "RIGHT",
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884028918",
      "pull_request_review_id": 2502438288,
      "id": 1884028918,
      "node_id": "PRRC_kwDOABII585wS__2",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "f55bac79518bb0e6a2e40d90a53a13a87b05fbeb",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this [commit](https://github.com/bitcoin/bitcoin/pull/30673/commits/f55bac79518bb0e6a2e40d90a53a13a87b05fbeb) seems to be the same as the previous one, but for production code - can we merge the two commits for better context?",
      "created_at": "2024-12-13T14:35:29Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884028918",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884028918"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884033265",
      "pull_request_review_id": 2502438288,
      "id": 1884033265,
      "node_id": "PRRC_kwDOABII585wTBDx",
      "diff_hunk": "@@ -102,7 +102,6 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)",
      "path": "src/coins.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Doesn't [`f44fbae` (#30673)](https://github.com/bitcoin/bitcoin/pull/30673/commits/f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1) belong with the previous commit instead, giving it more context?",
      "created_at": "2024-12-13T14:38:41Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884033265",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884033265"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 105,
      "original_line": 105,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884033861",
      "pull_request_review_id": 2502438288,
      "id": 1884033861,
      "node_id": "PRRC_kwDOABII585wTBNF",
      "diff_hunk": "@@ -195,7 +188,7 @@ struct CCoinsCacheEntry\n         return m_next;\n     }\n \n-    //! Only call Prev when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY, FRESH, or both",
      "path": "src/coins.h",
      "position": null,
      "original_position": 26,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "f44fbaea5a3ab9461c8bfc26a8cf841acaeb94f1",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "typo?",
      "created_at": "2024-12-13T14:39:08Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884033861",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884033861"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 191,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884037027",
      "pull_request_review_id": 2502438288,
      "id": 1884037027,
      "node_id": "PRRC_kwDOABII585wTB-j",
      "diff_hunk": "@@ -315,14 +315,14 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);\n \n         // Recompute cachedCoinsUsage.\n         recomputed_usage += entry.coin.DynamicMemoryUsage();\n \n         // Count the number of entries we expect in the linked list.\n-        if (entry.IsDirty() || entry.IsFresh()) ++count_flagged;\n+        if (entry.IsDirty()) ++count_flagged;",
      "path": "src/coins.cpp",
      "position": 124,
      "original_position": 14,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "2c3e62d4526809e9d2f5a01ff4d049fb6754cce6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "same: this [commit](https://github.com/bitcoin/bitcoin/pull/30673/commits/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6) seems related to the previous commit, can we merge them?",
      "created_at": "2024-12-13T14:41:16Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884037027",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884037027"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 324,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884044561",
      "pull_request_review_id": 2502438288,
      "id": 1884044561,
      "node_id": "PRRC_kwDOABII585wTD0R",
      "diff_hunk": "@@ -311,12 +311,13 @@ void CCoinsViewCache::SanityCheck() const\n     size_t recomputed_usage = 0;\n     size_t count_flagged = 0;\n     for (const auto& [_, entry] : cacheCoins) {",
      "path": "src/coins.cpp",
      "position": 104,
      "original_position": 3,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "4c9c30eda3707f451fb7d5a652159d66ba90d9d7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It seems to me this can also be merged with the [related SanityCheck](https://github.com/bitcoin/bitcoin/pull/30673/commits/2c3e62d4526809e9d2f5a01ff4d049fb6754cce6) commit",
      "created_at": "2024-12-13T14:46:26Z",
      "updated_at": "2024-12-13T14:47:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1884044561",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1884044561"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 311,
      "original_line": 313,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1926826226",
      "pull_request_review_id": 2569611311,
      "id": 1926826226,
      "node_id": "PRRC_kwDOABII585y2Qjy",
      "diff_hunk": "@@ -151,7 +151,9 @@ FUZZ_TARGET(coins_view, .init = initialize_coins_view)\n                     coins_view_cache.BatchWrite(cursor, fuzzed_data_provider.ConsumeBool() ? ConsumeUInt256(fuzzed_data_provider) : coins_view_cache.GetBestBlock());\n                     expected_code_path = true;\n                 } catch (const std::logic_error& e) {\n-                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}) {\n+                    if (e.what() == std::string{\"FRESH flag misapplied to coin that exists in parent cache\"}\n+                        || e.what() == std::string{\"A FRESH coin was not removed when it was spent\"}\n+                        || e.what() == std::string{\"A non-DIRTY coin was returned from the cursor in BatchWrite\"}) {\n                         expected_code_path = true;\n                     }",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "original_commit_id": "6956ee9cc76c7815e53fbdee01edc4379d8caafc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We may want to add a `Flush` here as well: https://github.com/bitcoin/bitcoin/pull/28216/files#diff-1ef3b6a1936b50f3d5ec4a1786d9e2d63d1a3e1815b103e67f20601995f355b4R79",
      "created_at": "2025-01-23T11:28:45Z",
      "updated_at": "2025-01-23T11:28:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30673#discussion_r1926826226",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1926826226"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30673"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 158,
      "original_line": 158,
      "side": "RIGHT"
    }
  ]
}
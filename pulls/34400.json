{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400",
    "id": 3207254787,
    "node_id": "PR_kwDOABII586_KtMD",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34400",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34400.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34400.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/49ae44cefe695b8d107105f5ae444a57566ef9db",
    "number": 34400,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "wallet: parallel fast rescan (approx 5x speed up with 16 threads)",
    "user": {
      "login": "Eunovo",
      "id": 37949128,
      "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Eunovo",
      "html_url": "https://github.com/Eunovo",
      "followers_url": "https://api.github.com/users/Eunovo/followers",
      "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
      "organizations_url": "https://api.github.com/users/Eunovo/orgs",
      "repos_url": "https://api.github.com/users/Eunovo/repos",
      "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/Eunovo/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "This PR uses @furszy's ThreadPool from https://github.com/bitcoin/bitcoin/pull/33689 to implement parallel fast rescan. The ThreadPool commit has been cherry-picked into this PR for use.\r\n\r\nThis PR:\r\n- Adds a `ThreadPool` to the `WalletContext` to be shared by all the wallets\r\n- Adds `-walletpar` parameter to configure the number of threads to be used for parallel scanning \r\n- Updates the `wallet_fast_rescan.py` test to ensure it catches cases where the FastRescan filter wasn't properly updated. This is crucial to ensure that changes in the PR do not cause newly added output scripts to be missed.\r\n- Refactors `ScanForWalletTransactions` to make the implementation of parallel scanning easier.\r\n- Implements parallel scanning\r\n\r\nBenchmarks:\r\n**NOTE: to reproduce, please tune your system with `pyperf system tune`**\r\n\r\n_EDIT\r\nSet up your node to use block filters by setting `blockfilterindex=1` in your bitcoin.conf file and ensure your blockfilterindex is synced to tip before attempting to reproduce._\r\n\r\nUsing the following command on mainnet with a wallet with no scripts and hyperfine version `1.20.0`:\r\n```\r\nhyperfine --show-output --export-markdown results.md --export-json results.json  \\\r\n--sort command \\\r\n--runs 3 \\\r\n-L commit ef847e8,37d356b \\\r\n-L num_threads 1,2,4,8,16 \\\r\n--prepare 'git checkout {commit} && cmake --build build -j 20 && build/bin/bitcoind -blockfilterindex=1 -walletpar={num_threads} && sleep 10 && build/bin/bitcoin-cli loadwalllet <wallet-name>' \\\r\n--conclude 'build/bin/bitcoin-cli stop && sleep 10' \\\r\n'build/bin/bitcoin-cli rescanblockchain 500000 900000'\r\n```\r\nI obtained the following results:\r\n| Command | Mean [s] | Min [s] | Max [s] | Relative |\r\n|:---|---:|---:|---:|---:|\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = baseline, num_threads = ..)` | 536.996 Â± 0.722 | 536.257 | 537.701 | 4.64 Â± 0.01 |\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = parallel_scan, num_threads = 1)` | 540.210 Â± 2.696 | 537.172 | 542.320 | 4.67 Â± 0.03 |\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = parallel_scan, num_threads = 2)` | 358.190 Â± 0.515 | 357.675 | 358.706 | 3.10 Â± 0.01 |\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = parallel_scan, num_threads = 4)` | 230.217 Â± 2.321 | 228.814 | 232.896 | 1.99 Â± 0.02 |\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = parallel_scan, num_threads = 8)` | 151.144 Â± 1.748 | 149.506 | 152.984 | 1.31 Â± 0.02 |\r\n| `build/bin/bitcoin-cli rescanblockchain 500000 900000 (commit = parallel_scan, num_threads = 16)` | 115.642 Â± 0.305 | 115.390 | 115.982 | 1.00 |\r\n\r\nSystem information:\r\n```\r\nArchitecture:             x86_64\r\n  CPU op-mode(s):         32-bit, 64-bit\r\n  Address sizes:          46 bits physical, 48 bits virtual\r\n  Byte Order:             Little Endian\r\nCPU(s):                   20\r\n  On-line CPU(s) list:    0-19\r\nVendor ID:                GenuineIntel\r\n  Model name:             Intel(R) Core(TM) Ultra 7 265\r\n    CPU family:           6\r\n    Model:                198\r\n    Thread(s) per core:   1\r\n    Core(s) per socket:   1\r\n    Socket(s):            20\r\n    Stepping:             2\r\n    CPU(s) scaling MHz:   41%\r\n    CPU max MHz:          4800.0000\r\n    CPU min MHz:          800.0000\r\n    BogoMIPS:             4761.60\r\n```\r\n\r\nFurther benchmarks were performed using a [python script](https://github.com/Eunovo/rescan-benchmark) with custom chains designed with payments at specified intervals, and the following graph was produced:\r\n\r\n<img width=\"4760\" height=\"8950\" alt=\"benchmark_comparison\" src=\"https://github.com/user-attachments/assets/1ba8c64d-cfca-4360-af06-1f034a30e307\" />\r\n\r\nThis graph was produced from a laptop with the following CPU specifications:\r\n```\r\nArchitecture:                x86_64\r\n  CPU op-mode(s):            32-bit, 64-bit\r\n  Address sizes:             48 bits physical, 48 bits virtual\r\n  Byte Order:                Little Endian\r\nCPU(s):                      16\r\n  On-line CPU(s) list:       0-15\r\nVendor ID:                   AuthenticAMD\r\n  Model name:                AMD Ryzen 9 8945HS w/ Radeon 780M Graphics\r\n    CPU family:              25\r\n    Model:                   117\r\n    Thread(s) per core:      2\r\n    Core(s) per socket:      8\r\n    Socket(s):               1\r\n    Stepping:                2\r\n    Frequency boost:         enabled\r\n    CPU(s) scaling MHz:      63%\r\n    CPU max MHz:             5263.0000\r\n    CPU min MHz:             400.0000\r\n```\r\n\r\nAll materials for the custom benchmarks can be found [here](https://github.com/Eunovo/rescan-benchmark).\r\n\r\nAlthough not explicitly checked with Valgrind, hyperfine reported that memory usage stayed the same across all runs. I'm not sure to what degree hyperfine's memory usage report can be trusted, but the PR limits the amount of block hashes that can be held in memory for processing to `1000` (not configurable by the user).\r\n\r\n\r\nAll benchmarks were performed against https://github.com/bitcoin/bitcoin/pull/34400/commits/37d356bbbe3efed3c7c9e64fae1bac3f4d0ec6eb instead of master because `-walletpar` is implemented here, and the benchmark scripts would otherwise break, or more complicated scripts would be required to accommodate master.\r\n",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2026-01-24T19:46:16Z",
    "updated_at": "2026-02-08T20:40:36Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "53be617957988925f731f687b3af66f08880bf94",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "Eunovo:new-rescan",
      "ref": "new-rescan",
      "sha": "49ae44cefe695b8d107105f5ae444a57566ef9db",
      "user": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 755831492,
        "node_id": "R_kgDOLQ0SxA",
        "name": "bitcoin",
        "full_name": "Eunovo/bitcoin",
        "owner": {
          "login": "Eunovo",
          "id": 37949128,
          "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
          "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/Eunovo",
          "html_url": "https://github.com/Eunovo",
          "followers_url": "https://api.github.com/users/Eunovo/followers",
          "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
          "organizations_url": "https://api.github.com/users/Eunovo/orgs",
          "repos_url": "https://api.github.com/users/Eunovo/repos",
          "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/Eunovo/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/Eunovo/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/Eunovo/bitcoin",
        "archive_url": "https://api.github.com/repos/Eunovo/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/Eunovo/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/Eunovo/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/Eunovo/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/Eunovo/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/Eunovo/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/Eunovo/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/Eunovo/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/Eunovo/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/Eunovo/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/Eunovo/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/Eunovo/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/Eunovo/bitcoin/events",
        "forks_url": "https://api.github.com/repos/Eunovo/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/Eunovo/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/Eunovo/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/Eunovo/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/Eunovo/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/Eunovo/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/Eunovo/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/Eunovo/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/Eunovo/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/Eunovo/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/Eunovo/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/Eunovo/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/Eunovo/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/Eunovo/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/Eunovo/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/Eunovo/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:Eunovo/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/Eunovo/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/Eunovo/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/Eunovo/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/Eunovo/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/Eunovo/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/Eunovo/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/Eunovo/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/Eunovo/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/Eunovo/bitcoin/hooks",
        "svn_url": "https://github.com/Eunovo/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "forks_count": 1,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 263176,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-08T12:58:10Z",
        "created_at": "2024-02-11T07:44:19Z",
        "updated_at": "2025-05-02T08:08:35Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "6d625af2831b7c36d59f245a65df3f70f2110f69",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38869,
        "stargazers_count": 88017,
        "watchers_count": 88017,
        "size": 303308,
        "default_branch": "master",
        "open_issues_count": 734,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-08T09:37:54Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-08T20:43:03Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 968,
    "deletions": 275,
    "changed_files": 18,
    "commits": 6,
    "review_comments": 6,
    "comments": 4
  },
  "events": [
    {
      "event": "mentioned",
      "id": 22266720890,
      "node_id": "MEE_lADOABII587ll7H_zwAAAAUvMzJ6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22266720890",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T19:46:18Z"
    },
    {
      "event": "subscribed",
      "id": 22266720898,
      "node_id": "SE_lADOABII587ll7H_zwAAAAUvMzKC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22266720898",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T19:46:18Z"
    },
    {
      "event": "commented",
      "id": 3795411378,
      "node_id": "IC_kwDOABII587iOWGy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795411378",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T19:46:27Z",
      "updated_at": "2026-02-08T20:40:36Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34400.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33689](https://github.com/bitcoin/bitcoin/pull/33689) (http: replace WorkQueue and single threads handling for ThreadPool by furszy)\n* [#33008](https://github.com/bitcoin/bitcoin/pull/33008) (wallet: support bip388 policy with external signer by Sjors)\n* [#32489](https://github.com/bitcoin/bitcoin/pull/32489) (wallet: Add `exportwatchonlywallet` RPC to export a watchonly version of a wallet by achow101)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#issuecomment-3795411378",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400"
    },
    {
      "event": "labeled",
      "id": 22267279370,
      "node_id": "LE_lADOABII587ll7H_zwAAAAUvO7gK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22267279370",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T20:44:41Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3795490038,
      "node_id": "IC_kwDOABII587iOpT2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3795490038",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-24T20:44:47Z",
      "updated_at": "2026-01-24T20:44:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `test max 6 ancestor commits`: https://github.com/bitcoin/bitcoin/actions/runs/21320629356/job/61369934184</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed due to an unused private member (m_thread_pool) in wallet.h being treated as an error under -Werror.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#issuecomment-3795490038",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22269027866,
      "node_id": "HRFPE_lADOABII587ll7H_zwAAAAUvVmYa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22269027866",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ef847e8bcee3d7e09051eaa956ce8086556a97f0",
      "commit_url": "https://api.github.com/repos/Eunovo/bitcoin/commits/ef847e8bcee3d7e09051eaa956ce8086556a97f0",
      "created_at": "2026-01-25T00:16:03Z"
    },
    {
      "event": "unlabeled",
      "id": 22269401185,
      "node_id": "UNLE_lADOABII587ll7H_zwAAAAUvXBhh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22269401185",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-25T01:26:46Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "renamed",
      "id": 22319834908,
      "node_id": "RTE_lADOABII587ll7H_zwAAAAUyXacc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22319834908",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T14:38:15Z",
      "rename": {
        "from": "Parallel Fast Rescan (approx 5x speed up with 16 threads)",
        "to": "wallet: parallel fast rescan (approx 5x speed up with 16 threads)"
      }
    },
    {
      "event": "labeled",
      "id": 22319837173,
      "node_id": "LE_lADOABII587ll7H_zwAAAAUyXa_1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22319837173",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-27T14:38:19Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "commented",
      "id": 3815476183,
      "node_id": "IC_kwDOABII587ja4vX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3815476183",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-29T04:50:41Z",
      "updated_at": "2026-01-29T04:50:41Z",
      "author_association": "MEMBER",
      "body": "I would have expected rescanning to be I/O bound rather than CPU, in which case parallelization could make things worse (more random seeking). Have you benchmarked this on a non-SSD?",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#issuecomment-3815476183",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400"
    },
    {
      "event": "commented",
      "id": 3816289052,
      "node_id": "IC_kwDOABII587jd_Mc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3816289052",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-29T08:42:30Z",
      "updated_at": "2026-01-29T08:42:30Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I would have expected rescanning to be I/O bound rather than CPU, in which case parallelization could make things worse (more random seeking). Have you benchmarked this on a non-SSD?\r\n\r\nFast rescan checks block filters, which involves considerable hashing. This PR parallelises the checking of block filters, and my benchmarks show considerable improvements in rescan speeds with block filters. Slow rescan, which is I/O bound, remains the same. I expect the speedup to be transferable to non-SSD machines, but I haven't benchmarked this.",
      "user": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#issuecomment-3816289052",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34400"
    },
    {
      "event": "labeled",
      "id": 22539489369,
      "node_id": "LE_lADOABII587ll7H_zwAAAAU_dVBZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22539489369",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T20:20:35Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3769269576,
      "node_id": "PRR_kwDOABII587gqn1I",
      "url": null,
      "actor": null,
      "commit_id": "ef847e8bcee3d7e09051eaa956ce8086556a97f0",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-08T08:59:21Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#pullrequestreview-3769269576",
      "submitted_at": "2026-02-08T08:59:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFhMzUyZjhkOThhMzExOWRkNzRmZmJiOTIxNzk3NDcxNGE2NjE1ZmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa352f8d98a3119dd74ffbb9217974714a6615fb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aa352f8d98a3119dd74ffbb9217974714a6615fb",
      "tree": {
        "sha": "99c3132c638af2d7d576b9b7e19303639dde7fe2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/99c3132c638af2d7d576b9b7e19303639dde7fe2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6d625af2831b7c36d59f245a65df3f70f2110f69",
          "sha": "6d625af2831b7c36d59f245a65df3f70f2110f69",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6d625af2831b7c36d59f245a65df3f70f2110f69"
        }
      ],
      "message": "util: introduce general purpose thread pool",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T11:43:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-02-16T15:20:33Z"
      },
      "sha": "aa352f8d98a3119dd74ffbb9217974714a6615fb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFiYTRmMzZiYTVhZDgyYmI2NjJhMmY3ZDQ1ODE5MjEyMGE5YzYyN2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aba4f36ba5ad82bb662a2f7d458192120a9c627b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/aba4f36ba5ad82bb662a2f7d458192120a9c627b",
      "tree": {
        "sha": "49a63360bd35037777c3837889d8ea50a63538a8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/49a63360bd35037777c3837889d8ea50a63538a8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aa352f8d98a3119dd74ffbb9217974714a6615fb",
          "sha": "aa352f8d98a3119dd74ffbb9217974714a6615fb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aa352f8d98a3119dd74ffbb9217974714a6615fb"
        }
      ],
      "message": "wallet: setup wallet threadpool\n\nAll wallets will use the same ThreadPool owned by the WalletContext.\nThreadPool::Submit() is threadsafe so there's no need for the use of\nexternal synchronization primitives when submiting tasks.\nAll threads started by the ThreadPool will be destroyed with the\nThreadPool and WalletContext.",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T12:13:26Z"
      },
      "author": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2025-11-03T05:07:35Z"
      },
      "sha": "aba4f36ba5ad82bb662a2f7d458192120a9c627b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc5NzdjMzFjNjU2OTgwYjQ4MGIyOTNmMjFjZDY5MmZjNTRkZGZjYzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7977c31c656980b480b293f21cd692fc54ddfcc6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7977c31c656980b480b293f21cd692fc54ddfcc6",
      "tree": {
        "sha": "ce40c754d33c4db62e035557a87f592fb14fbe65",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ce40c754d33c4db62e035557a87f592fb14fbe65"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/aba4f36ba5ad82bb662a2f7d458192120a9c627b",
          "sha": "aba4f36ba5ad82bb662a2f7d458192120a9c627b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/aba4f36ba5ad82bb662a2f7d458192120a9c627b"
        }
      ],
      "message": "wallet: test fast rescan filter is updated after TopUp\n\nThe fixed non-range descriptor address ensured that the fast-rescan filter would match all Blocks even if the filter wasn't properly updated.\nThis commit moves the non-range descriptor tx to a different block, so that the filters must be updated after each TopUp for the test to pass.",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T12:13:58Z"
      },
      "author": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2025-11-05T13:05:47Z"
      },
      "sha": "7977c31c656980b480b293f21cd692fc54ddfcc6"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgzZjVjNzg5NDkxMWFiMTEyMTMxMWEyM2EwZTFkNmQ0NjJiMTczMDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83f5c7894911ab1121311a23a0e1d6d462b17300",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/83f5c7894911ab1121311a23a0e1d6d462b17300",
      "tree": {
        "sha": "0305ba404bce0be7b409ec0d6135160e037d8c60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0305ba404bce0be7b409ec0d6135160e037d8c60"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7977c31c656980b480b293f21cd692fc54ddfcc6",
          "sha": "7977c31c656980b480b293f21cd692fc54ddfcc6",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7977c31c656980b480b293f21cd692fc54ddfcc6"
        }
      ],
      "message": "wallet: move scanning logic to wallet/scan.cpp\n\nMove rescan logic to new class to prepare for more code that\nwill be added for parallel rescan in the future commits.\n\nCWallet::ScanForWalletTransactions impl is moved to scan.cpp\nto prevent circular dependency of the form\n\"wallet/wallet -> wallet/scan -> wallet/wallet\".",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T12:13:58Z"
      },
      "author": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2025-11-03T04:47:02Z"
      },
      "sha": "83f5c7894911ab1121311a23a0e1d6d462b17300"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY0ZDVhZTY2ZGNhZjVhNjA1OGE1YzU5YzExNWU2NDBjOWJkZDdiMDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07",
      "tree": {
        "sha": "d1e51fa43802c63d08cacdeea70feb026bc64fcf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d1e51fa43802c63d08cacdeea70feb026bc64fcf"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83f5c7894911ab1121311a23a0e1d6d462b17300",
          "sha": "83f5c7894911ab1121311a23a0e1d6d462b17300",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/83f5c7894911ab1121311a23a0e1d6d462b17300"
        }
      ],
      "message": "wallet: refactor ChainScanner::Scan\n\nSplit scanning logic into blockhash read,\nfilter execution and block scanning to\nprepare for future parallelisation commits.",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T12:13:58Z"
      },
      "author": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2025-11-04T16:12:12Z"
      },
      "sha": "f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ5YWU0NGNlZmU2OTViOGQxMDcxMDVmNWFlNDQ0YTU3NTY2ZWY5ZGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/49ae44cefe695b8d107105f5ae444a57566ef9db",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/49ae44cefe695b8d107105f5ae444a57566ef9db",
      "tree": {
        "sha": "045a3c3d4ee811ca7905e2bfe39ee77bd8a0a952",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/045a3c3d4ee811ca7905e2bfe39ee77bd8a0a952"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07",
          "sha": "f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f4d5ae66dcaf5a6058a5c59c115e640c9bdd7b07"
        }
      ],
      "message": "wallet: check blockfilters in parallel\n\nAny operation that requires cs_wallet like GetLastBlockHeight()\nand SyncTransaction must be done on the main thread because\ncs_wallet is a RecursiveMutex and ScanForWalletTransactions\nis also called from AttachChain() which already LOCKs cs_wallet.\n\nBlock hashes are read and pushed to m_blocks while block filters\nare being check for other blocks.\n\nWhen more block hashes cannot be read, the main thread will use\nThreadPool::ProcessTask() to join other workers and process queued\njobs, instead of wasting CPU styles constanly checking if a future\nis ready.\n\nBenchmarks show considerable improvement (approx 5x with 16 threads).",
      "committer": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2026-02-08T12:13:58Z"
      },
      "author": {
        "name": "Novo",
        "email": "eunovo9@gmail.com",
        "date": "2025-11-04T16:58:53Z"
      },
      "sha": "49ae44cefe695b8d107105f5ae444a57566ef9db"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22622481075,
      "node_id": "HRFPE_lADOABII587ll7H_zwAAAAVEZ6qz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22622481075",
      "actor": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "49ae44cefe695b8d107105f5ae444a57566ef9db",
      "commit_url": "https://api.github.com/repos/Eunovo/bitcoin/commits/49ae44cefe695b8d107105f5ae444a57566ef9db",
      "created_at": "2026-02-08T12:28:55Z"
    },
    {
      "event": "unlabeled",
      "id": 22622772133,
      "node_id": "UNLE_lADOABII587ll7H_zwAAAAVEbBul",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22622772133",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-08T13:09:34Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2778932090",
      "pull_request_review_id": 3769269576,
      "id": 2778932090,
      "node_id": "PRRC_kwDOABII586loyN6",
      "diff_hunk": "@@ -0,0 +1,352 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <interfaces/chain.h>\n+#include <logging.h>\n+#include <sync.h>\n+#include <wallet/scan.h>\n+#include <wallet/wallet.h>\n+\n+#include <algorithm>\n+#include <future>\n+\n+using interfaces::FoundBlock;\n+\n+namespace wallet {\n+\n+/**\n+ * Scan the block chain (starting in start_block) for transactions\n+ * from or to us. If fUpdate is true, found transactions that already\n+ * exist in the wallet will be updated. If max_height is not set, the\n+ * mempool will be scanned as well.\n+ *\n+ * @param[in] start_block Scan starting block. If block is not on the active\n+ *                        chain, the scan will return SUCCESS immediately.\n+ * @param[in] start_height Height of start_block\n+ * @param[in] max_height  Optional max scanning height. If unset there is\n+ *                        no maximum and scanning can continue to the tip\n+ *\n+ * @return ScanResult returning scan information and indicating success or\n+ *         failure. Return status will be set to SUCCESS if scan was\n+ *         successful. FAILURE if a complete rescan was not possible (due to\n+ *         pruning or corruption). USER_ABORT if the rescan was aborted before\n+ *         it could complete.\n+ *\n+ * @pre Caller needs to make sure start_block (and the optional stop_block) are on\n+ * the main chain after the addition of any new keys you want to detect\n+ * transactions for.\n+ */\n+ScanResult CWallet::ScanForWalletTransactions(const uint256& start_block, int start_height, std::optional<int> max_height, const WalletRescanReserver& reserver, bool fUpdate, bool save_progress)\n+{\n+    ChainScanner scanner{*this, reserver, start_block, start_height, max_height, fUpdate, save_progress};\n+    return scanner.Scan();\n+}\n+\n+namespace {\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // create initial filter with scripts from all ScriptPubKeyMans\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            assert(desc_spkm != nullptr);\n+            AddScriptPubKeys(desc_spkm);\n+            // save each range descriptor's end for possible future filter updates\n+            if (desc_spkm->IsHDEnabled()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), desc_spkm->GetEndRange());\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (const auto& [desc_spkm_id, last_range_end] : m_last_range_ends) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(m_wallet.GetScriptPubKeyMan(desc_spkm_id))};\n+            assert(desc_spkm != nullptr);\n+            int32_t current_range_end{desc_spkm->GetEndRange()};\n+            if (current_range_end > last_range_end) {\n+                AddScriptPubKeys(desc_spkm, last_range_end);\n+                m_last_range_ends.at(desc_spkm->GetID()) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each range descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<uint256, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    void AddScriptPubKeys(const DescriptorScriptPubKeyMan* desc_spkm, int32_t last_range_end = 0)\n+    {\n+        for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+            m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+        }\n+    }\n+};\n+} // namespace\n+\n+bool ChainScanner::ReadBlockHash(ScanResult& result) {\n+    bool block_still_active = false;\n+    bool next_block = false;\n+    int block_height = m_next_block_height;\n+    uint256 block_hash = m_next_block_hash;\n+    m_wallet.chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(m_next_block_hash)));\n+    m_blocks.emplace_back(block_hash, block_height);\n+    ++m_next_block_height;\n+    if (!block_still_active) {\n+        // Abort scan if current block is no longer active, to prevent\n+        // marking transactions as coming from the wrong block.\n+        result.last_failed_block = block_hash;\n+        result.status = ScanResult::FAILURE;\n+        return false;\n+    }\n+    if (m_max_height && block_height >= *m_max_height) return false;\n+    // If rescanning was triggered with cs_wallet permanently locked (AttachChain), additional blocks that were connected during the rescan\n+    // aren't processed here but will be processed with the pending blockConnected notifications after the lock is released.\n+    // If rescanning without a permanent cs_wallet lock, additional blocks that were added during the rescan will be re-processed if\n+    // the notification was processed and the last block height was updated.\n+    if (block_height >= WITH_LOCK(m_wallet.cs_wallet, return m_wallet.GetLastBlockHeight())) {\n+        return false;\n+    }\n+    if (!next_block) return false;\n+    return true;\n+}\n+\n+enum FilterRes {\n+    FILTER_NO_MATCH,\n+    FILTER_MATCH,\n+    FILTER_NO_FILTER\n+};\n+\n+std::optional<std::pair<size_t, size_t>> ChainScanner::FilterBlocks(const std::unique_ptr<FastWalletRescanFilter>& filter, ScanResult& result) {\n+    if (!filter) {\n+        // Slow scan: no filter, scan all blocks\n+        m_continue = ReadBlockHash(result);\n+        return std::make_pair<size_t, size_t>(0, m_blocks.size());\n+    }\n+    filter->UpdateIfNeeded();\n+    auto* thread_pool = m_wallet.m_thread_pool;\n+    // ThreadPool pointer should never be null here\n+    // during normal operation because it should\n+    // have been passed from the WalletContext to\n+    // the CWallet constructor\n+    assert(thread_pool != nullptr);\n+    std::optional<std::pair<size_t, size_t>> range;\n+    size_t workers_count = thread_pool->WorkersCount();\n+    size_t i = 0;\n+    size_t completed = 0;\n+    std::vector<std::future<FilterRes>> futures;\n+    futures.reserve(workers_count);\n+\n+    while ((m_continue && completed < m_max_blockqueue_size) || i < m_blocks.size() || !futures.empty()) {\n+        const bool result_ready = futures.size() > 0 && futures[0].wait_for(std::chrono::seconds::zero()) == std::future_status::ready;\n+        if (result_ready) {\n+            const auto& scan_res{futures[0].get()};\n+            completed++;\n+            futures.erase(futures.begin());\n+            if (scan_res == FILTER_NO_MATCH) {\n+                if (range.has_value()) {\n+                    break;\n+                }\n+                continue;\n+            }\n+            int current_block_index = completed - 1;\n+            if (scan_res == FilterRes::FILTER_MATCH) {\n+                LogDebug(BCLog::SCAN, \"Fast rescan: inspect block %d [%s] (filter matched)\\n\", m_blocks[current_block_index].second, m_blocks[current_block_index].first.ToString());\n+            } else { // FILTER_NO_FILTER\n+                LogDebug(BCLog::SCAN, \"Fast rescan: inspect block %d [%s] (WARNING: block filter not found!)\\n\", m_blocks[current_block_index].second, m_blocks[current_block_index].first.ToString());\n+            }\n+\n+            if (!range.has_value()) range = std::make_pair(current_block_index, current_block_index + 1);\n+            else range->second = current_block_index + 1;\n+        }\n+\n+        const size_t job_gap = workers_count - futures.size();\n+        if (job_gap > 0 && i < m_blocks.size()) {\n+            for (size_t j = 0; j < job_gap && i < m_blocks.size(); ++j, ++i) {\n+                auto block = m_blocks[i];\n+                futures.emplace_back(thread_pool->Submit([&filter, block = std::move(block)]() {\n+                    const auto matches_block{filter->MatchesBlock(block.first)};\n+                    if (matches_block.has_value()) {\n+                        if (*matches_block) {\n+                            return FilterRes::FILTER_MATCH;\n+                        } else {\n+                            return FilterRes::FILTER_NO_MATCH;\n+                        }\n+                    } else {\n+                        return FilterRes::FILTER_NO_FILTER;\n+                    }\n+                }));\n+            }\n+        }\n+\n+        // If m_max_blockqueue_size blocks have been filtered,\n+        // stop reading more blocks for now, to give the\n+        // main scanning loop a chance to update progress\n+        // and erase some blocks from the queue.\n+        if (m_continue && completed < m_max_blockqueue_size) m_continue = ReadBlockHash(result);\n+        else if (!futures.empty()) thread_pool->ProcessTask();",
      "path": "src/wallet/scan.cpp",
      "position": 203,
      "original_position": 203,
      "commit_id": "49ae44cefe695b8d107105f5ae444a57566ef9db",
      "original_commit_id": "ef847e8bcee3d7e09051eaa956ce8086556a97f0",
      "in_reply_to_id": null,
      "user": {
        "login": "bvbfan",
        "id": 8323581,
        "node_id": "MDQ6VXNlcjgzMjM1ODE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bvbfan",
        "html_url": "https://github.com/bvbfan",
        "followers_url": "https://api.github.com/users/bvbfan/followers",
        "following_url": "https://api.github.com/users/bvbfan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bvbfan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bvbfan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
        "organizations_url": "https://api.github.com/users/bvbfan/orgs",
        "repos_url": "https://api.github.com/users/bvbfan/repos",
        "events_url": "https://api.github.com/users/bvbfan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bvbfan/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This slows down the scanning no? All workers already process submit task in its own `WorkThread` just randomly trying to acquire mutex from scanning thread is non sense to me.",
      "created_at": "2026-02-08T08:59:21Z",
      "updated_at": "2026-02-08T08:59:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#discussion_r2778932090",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2778932090"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 203,
      "original_line": 203,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779171041",
      "pull_request_review_id": 3769661213,
      "id": 2779171041,
      "node_id": "PRRC_kwDOABII586lpsjh",
      "diff_hunk": "@@ -0,0 +1,352 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <interfaces/chain.h>\n+#include <logging.h>\n+#include <sync.h>\n+#include <wallet/scan.h>\n+#include <wallet/wallet.h>\n+\n+#include <algorithm>\n+#include <future>\n+\n+using interfaces::FoundBlock;\n+\n+namespace wallet {\n+\n+/**\n+ * Scan the block chain (starting in start_block) for transactions\n+ * from or to us. If fUpdate is true, found transactions that already\n+ * exist in the wallet will be updated. If max_height is not set, the\n+ * mempool will be scanned as well.\n+ *\n+ * @param[in] start_block Scan starting block. If block is not on the active\n+ *                        chain, the scan will return SUCCESS immediately.\n+ * @param[in] start_height Height of start_block\n+ * @param[in] max_height  Optional max scanning height. If unset there is\n+ *                        no maximum and scanning can continue to the tip\n+ *\n+ * @return ScanResult returning scan information and indicating success or\n+ *         failure. Return status will be set to SUCCESS if scan was\n+ *         successful. FAILURE if a complete rescan was not possible (due to\n+ *         pruning or corruption). USER_ABORT if the rescan was aborted before\n+ *         it could complete.\n+ *\n+ * @pre Caller needs to make sure start_block (and the optional stop_block) are on\n+ * the main chain after the addition of any new keys you want to detect\n+ * transactions for.\n+ */\n+ScanResult CWallet::ScanForWalletTransactions(const uint256& start_block, int start_height, std::optional<int> max_height, const WalletRescanReserver& reserver, bool fUpdate, bool save_progress)\n+{\n+    ChainScanner scanner{*this, reserver, start_block, start_height, max_height, fUpdate, save_progress};\n+    return scanner.Scan();\n+}\n+\n+namespace {\n+class FastWalletRescanFilter\n+{\n+public:\n+    FastWalletRescanFilter(const CWallet& wallet) : m_wallet(wallet)\n+    {\n+        // create initial filter with scripts from all ScriptPubKeyMans\n+        for (auto spkm : m_wallet.GetAllScriptPubKeyMans()) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(spkm)};\n+            assert(desc_spkm != nullptr);\n+            AddScriptPubKeys(desc_spkm);\n+            // save each range descriptor's end for possible future filter updates\n+            if (desc_spkm->IsHDEnabled()) {\n+                m_last_range_ends.emplace(desc_spkm->GetID(), desc_spkm->GetEndRange());\n+            }\n+        }\n+    }\n+\n+    void UpdateIfNeeded()\n+    {\n+        // repopulate filter with new scripts if top-up has happened since last iteration\n+        for (const auto& [desc_spkm_id, last_range_end] : m_last_range_ends) {\n+            auto desc_spkm{dynamic_cast<DescriptorScriptPubKeyMan*>(m_wallet.GetScriptPubKeyMan(desc_spkm_id))};\n+            assert(desc_spkm != nullptr);\n+            int32_t current_range_end{desc_spkm->GetEndRange()};\n+            if (current_range_end > last_range_end) {\n+                AddScriptPubKeys(desc_spkm, last_range_end);\n+                m_last_range_ends.at(desc_spkm->GetID()) = current_range_end;\n+            }\n+        }\n+    }\n+\n+    std::optional<bool> MatchesBlock(const uint256& block_hash) const\n+    {\n+        return m_wallet.chain().blockFilterMatchesAny(BlockFilterType::BASIC, block_hash, m_filter_set);\n+    }\n+\n+private:\n+    const CWallet& m_wallet;\n+    /** Map for keeping track of each range descriptor's last seen end range.\n+      * This information is used to detect whether new addresses were derived\n+      * (that is, if the current end range is larger than the saved end range)\n+      * after processing a block and hence a filter set update is needed to\n+      * take possible keypool top-ups into account.\n+      */\n+    std::map<uint256, int32_t> m_last_range_ends;\n+    GCSFilter::ElementSet m_filter_set;\n+\n+    void AddScriptPubKeys(const DescriptorScriptPubKeyMan* desc_spkm, int32_t last_range_end = 0)\n+    {\n+        for (const auto& script_pub_key : desc_spkm->GetScriptPubKeys(last_range_end)) {\n+            m_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+        }\n+    }\n+};\n+} // namespace\n+\n+bool ChainScanner::ReadBlockHash(ScanResult& result) {\n+    bool block_still_active = false;\n+    bool next_block = false;\n+    int block_height = m_next_block_height;\n+    uint256 block_hash = m_next_block_hash;\n+    m_wallet.chain().findBlock(block_hash, FoundBlock().inActiveChain(block_still_active).nextBlock(FoundBlock().inActiveChain(next_block).hash(m_next_block_hash)));\n+    m_blocks.emplace_back(block_hash, block_height);\n+    ++m_next_block_height;\n+    if (!block_still_active) {\n+        // Abort scan if current block is no longer active, to prevent\n+        // marking transactions as coming from the wrong block.\n+        result.last_failed_block = block_hash;\n+        result.status = ScanResult::FAILURE;\n+        return false;\n+    }\n+    if (m_max_height && block_height >= *m_max_height) return false;\n+    // If rescanning was triggered with cs_wallet permanently locked (AttachChain), additional blocks that were connected during the rescan\n+    // aren't processed here but will be processed with the pending blockConnected notifications after the lock is released.\n+    // If rescanning without a permanent cs_wallet lock, additional blocks that were added during the rescan will be re-processed if\n+    // the notification was processed and the last block height was updated.\n+    if (block_height >= WITH_LOCK(m_wallet.cs_wallet, return m_wallet.GetLastBlockHeight())) {\n+        return false;\n+    }\n+    if (!next_block) return false;\n+    return true;\n+}\n+\n+enum FilterRes {\n+    FILTER_NO_MATCH,\n+    FILTER_MATCH,\n+    FILTER_NO_FILTER\n+};\n+\n+std::optional<std::pair<size_t, size_t>> ChainScanner::FilterBlocks(const std::unique_ptr<FastWalletRescanFilter>& filter, ScanResult& result) {\n+    if (!filter) {\n+        // Slow scan: no filter, scan all blocks\n+        m_continue = ReadBlockHash(result);\n+        return std::make_pair<size_t, size_t>(0, m_blocks.size());\n+    }\n+    filter->UpdateIfNeeded();\n+    auto* thread_pool = m_wallet.m_thread_pool;\n+    // ThreadPool pointer should never be null here\n+    // during normal operation because it should\n+    // have been passed from the WalletContext to\n+    // the CWallet constructor\n+    assert(thread_pool != nullptr);\n+    std::optional<std::pair<size_t, size_t>> range;\n+    size_t workers_count = thread_pool->WorkersCount();\n+    size_t i = 0;\n+    size_t completed = 0;\n+    std::vector<std::future<FilterRes>> futures;\n+    futures.reserve(workers_count);\n+\n+    while ((m_continue && completed < m_max_blockqueue_size) || i < m_blocks.size() || !futures.empty()) {\n+        const bool result_ready = futures.size() > 0 && futures[0].wait_for(std::chrono::seconds::zero()) == std::future_status::ready;\n+        if (result_ready) {\n+            const auto& scan_res{futures[0].get()};\n+            completed++;\n+            futures.erase(futures.begin());\n+            if (scan_res == FILTER_NO_MATCH) {\n+                if (range.has_value()) {\n+                    break;\n+                }\n+                continue;\n+            }\n+            int current_block_index = completed - 1;\n+            if (scan_res == FilterRes::FILTER_MATCH) {\n+                LogDebug(BCLog::SCAN, \"Fast rescan: inspect block %d [%s] (filter matched)\\n\", m_blocks[current_block_index].second, m_blocks[current_block_index].first.ToString());\n+            } else { // FILTER_NO_FILTER\n+                LogDebug(BCLog::SCAN, \"Fast rescan: inspect block %d [%s] (WARNING: block filter not found!)\\n\", m_blocks[current_block_index].second, m_blocks[current_block_index].first.ToString());\n+            }\n+\n+            if (!range.has_value()) range = std::make_pair(current_block_index, current_block_index + 1);\n+            else range->second = current_block_index + 1;\n+        }\n+\n+        const size_t job_gap = workers_count - futures.size();\n+        if (job_gap > 0 && i < m_blocks.size()) {\n+            for (size_t j = 0; j < job_gap && i < m_blocks.size(); ++j, ++i) {\n+                auto block = m_blocks[i];\n+                futures.emplace_back(thread_pool->Submit([&filter, block = std::move(block)]() {\n+                    const auto matches_block{filter->MatchesBlock(block.first)};\n+                    if (matches_block.has_value()) {\n+                        if (*matches_block) {\n+                            return FilterRes::FILTER_MATCH;\n+                        } else {\n+                            return FilterRes::FILTER_NO_MATCH;\n+                        }\n+                    } else {\n+                        return FilterRes::FILTER_NO_FILTER;\n+                    }\n+                }));\n+            }\n+        }\n+\n+        // If m_max_blockqueue_size blocks have been filtered,\n+        // stop reading more blocks for now, to give the\n+        // main scanning loop a chance to update progress\n+        // and erase some blocks from the queue.\n+        if (m_continue && completed < m_max_blockqueue_size) m_continue = ReadBlockHash(result);\n+        else if (!futures.empty()) thread_pool->ProcessTask();",
      "path": "src/wallet/scan.cpp",
      "position": 203,
      "original_position": 203,
      "commit_id": "49ae44cefe695b8d107105f5ae444a57566ef9db",
      "original_commit_id": "ef847e8bcee3d7e09051eaa956ce8086556a97f0",
      "in_reply_to_id": 2778932090,
      "user": {
        "login": "Eunovo",
        "id": 37949128,
        "node_id": "MDQ6VXNlcjM3OTQ5MTI4",
        "avatar_url": "https://avatars.githubusercontent.com/u/37949128?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Eunovo",
        "html_url": "https://github.com/Eunovo",
        "followers_url": "https://api.github.com/users/Eunovo/followers",
        "following_url": "https://api.github.com/users/Eunovo/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Eunovo/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Eunovo/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Eunovo/subscriptions",
        "organizations_url": "https://api.github.com/users/Eunovo/orgs",
        "repos_url": "https://api.github.com/users/Eunovo/repos",
        "events_url": "https://api.github.com/users/Eunovo/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Eunovo/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Are you referring to the `ThreadPool::m_mutex`? This mutex is not held during task processing. It is only briefly held to access the work queue. Calling `ProcessTask()` from the main thread does not slow down scanning; it gives the main thread work to do instead of wasting cycles waiting for results. ",
      "created_at": "2026-02-08T11:40:53Z",
      "updated_at": "2026-02-08T11:40:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34400#discussion_r2779171041",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2779171041"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34400"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 203,
      "original_line": 203,
      "side": "RIGHT"
    }
  ]
}
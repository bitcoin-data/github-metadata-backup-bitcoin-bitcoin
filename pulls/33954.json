{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954",
    "id": 3048643652,
    "node_id": "PR_kwDOABII5861tpxE",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33954",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33954.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33954.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33954",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33954/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
    "number": 33954,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "test: add functional test for outbound connection management",
    "user": {
      "login": "mzumsande",
      "id": 48763452,
      "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mzumsande",
      "html_url": "https://github.com/mzumsande",
      "followers_url": "https://api.github.com/users/mzumsande/followers",
      "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
      "organizations_url": "https://api.github.com/users/mzumsande/orgs",
      "repos_url": "https://api.github.com/users/mzumsande/repos",
      "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/mzumsande/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "For #29415, vasild added the possibility to have outbound connections made \"naturally\" by the node using addrman entries, by redirecting them via a SOCKS5 proxy to python p2ps or other full nodes, so that the node under test behaves as if it is connected to normal non-local peers from arbitrary networks, while we have full control over the peers.\r\n\r\nI think this feature is really cool and want to suggest to integrate it more prominently into the test framework (\"`auto_outbound_mode`\") in the first commit because it allows to test the code in which the node decides to make connections - in contrast to the existing `add_outbound_p2p_connection` where the functional test intiates the connections.\r\n\r\nThe second commit uses it to add functional test coverage for the following features of outbound connection management:\r\n- extra full outbound connections due to a stale tip (#11560)\r\n- periodic block-relay-only connections (#19858)\r\n- full outbound connection management with respect to networks (#27213)\r\n\r\nThis should work well with the test from #29415 (which would keep its own `destinations_factory` but can call `_create_auto_outbound_listener` to avoid much of code duplication). \r\n\r\nOther possible uses for `auto_outbound_mode` I could think of are more detailed testing of anchors (`feature_anchors.py`), feeler connections, or any other p2p logic that uses the network of peers.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2025-11-26T19:01:42Z",
    "updated_at": "2026-01-09T10:44:44Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "6a2d24ce811aa65b946a0d3af6a05c5be5ee3851",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "mzumsande:202511_test_outbound_mgmt",
      "ref": "202511_test_outbound_mgmt",
      "sha": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 187673073,
        "node_id": "MDEwOlJlcG9zaXRvcnkxODc2NzMwNzM=",
        "name": "bitcoin",
        "full_name": "mzumsande/bitcoin",
        "owner": {
          "login": "mzumsande",
          "id": 48763452,
          "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
          "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/mzumsande",
          "html_url": "https://github.com/mzumsande",
          "followers_url": "https://api.github.com/users/mzumsande/followers",
          "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
          "organizations_url": "https://api.github.com/users/mzumsande/orgs",
          "repos_url": "https://api.github.com/users/mzumsande/repos",
          "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/mzumsande/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/mzumsande/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/mzumsande/bitcoin",
        "archive_url": "https://api.github.com/repos/mzumsande/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/mzumsande/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/mzumsande/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/mzumsande/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/mzumsande/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/mzumsande/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/mzumsande/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/mzumsande/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/mzumsande/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/mzumsande/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/mzumsande/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/mzumsande/bitcoin/events",
        "forks_url": "https://api.github.com/repos/mzumsande/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/mzumsande/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/mzumsande/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/mzumsande/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/mzumsande/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/mzumsande/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/mzumsande/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/mzumsande/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/mzumsande/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/mzumsande/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/mzumsande/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/mzumsande/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/mzumsande/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/mzumsande/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/mzumsande/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:mzumsande/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/mzumsande/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/mzumsande/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/mzumsande/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/mzumsande/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/mzumsande/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/mzumsande/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/mzumsande/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/mzumsande/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/mzumsande/bitcoin/hooks",
        "svn_url": "https://github.com/mzumsande/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 279321,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-02T00:17:52Z",
        "created_at": "2019-05-20T16:03:10Z",
        "updated_at": "2025-12-18T16:51:52Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "adbb4b320834516dc97fa33aaa853a45cbabca67",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38798,
        "stargazers_count": 87590,
        "watchers_count": 87590,
        "size": 301392,
        "default_branch": "master",
        "open_issues_count": 746,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-09T10:02:29Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-09T10:02:38Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 347,
    "deletions": 13,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 15,
    "comments": 3
  },
  "events": [
    {
      "event": "labeled",
      "id": 21203443022,
      "node_id": "LE_lADOABII587arB9szwAAAATv0t1O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21203443022",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-26T19:01:48Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 3582803305,
      "node_id": "IC_kwDOABII587VjT1p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3582803305",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-26T19:01:53Z",
      "updated_at": "2026-01-09T10:44:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33954.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/33954#pullrequestreview-3643055559) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- interfer -> interfere [misspelled verb in comment \"Disable stale-tip extra-outbound connections that could interfer\"]\n\n\n\n<sup>2025-12-11</sup>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#issuecomment-3582803305",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33954"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21203591994,
      "node_id": "HRFPE_lADOABII587arB9szwAAAATv1SM6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21203591994",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/1158564303b2e73d5254f258899b63007e3f52a1",
      "created_at": "2025-11-26T19:11:04Z"
    },
    {
      "event": "labeled",
      "id": 21203601372,
      "node_id": "LE_lADOABII587arB9szwAAAATv1Ufc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21203601372",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-26T19:11:39Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 21204328337,
      "node_id": "UNLE_lADOABII587arB9szwAAAATv4F-R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21204328337",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-26T19:58:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "ready_for_review",
      "id": 21204601375,
      "node_id": "RFRE_lADOABII587arB9szwAAAATv5Iof",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21204601375",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-26T20:14:32Z"
    },
    {
      "event": "commented",
      "id": 3584897920,
      "node_id": "IC_kwDOABII587VrTOA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3584897920",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-27T09:22:40Z",
      "updated_at": "2025-11-27T09:22:40Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, thanks!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#issuecomment-3584897920",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33954"
    },
    {
      "event": "convert_to_draft",
      "id": 21248487448,
      "node_id": "CTDE_lADOABII587arB9szwAAAATygjAY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21248487448",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-28T22:07:21Z"
    },
    {
      "event": "commented",
      "id": 3590615136,
      "node_id": "IC_kwDOABII587WBHBg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3590615136",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-28T22:08:20Z",
      "updated_at": "2025-11-28T22:08:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "there are still some intermittent timeouts, will put in draft until I've fixed them.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#issuecomment-3590615136",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33954"
    },
    {
      "event": "reviewed",
      "id": 3550549389,
      "node_id": "PRR_kwDOABII587ToRWN",
      "url": null,
      "actor": null,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-08T12:25:48Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#pullrequestreview-3550549389",
      "submitted_at": "2025-12-08T12:25:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21513680399,
      "node_id": "HRFPE_lADOABII587arB9szwAAAAUCULYP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21513680399",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b961ad4e7e3d8694237428cc53e32ba04be4ff56",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/b961ad4e7e3d8694237428cc53e32ba04be4ff56",
      "created_at": "2025-12-11T21:00:35Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU1MGJmMWVjNThlNmZkM2RjZTk0N2RmODI2OWNkZjE1YWZmMGI4NWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e50bf1ec58e6fd3dce947df8269cdf15aff0b85f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e50bf1ec58e6fd3dce947df8269cdf15aff0b85f",
      "tree": {
        "sha": "5ff23c4bec34ffc0bb3eedd23858d5be932a3950",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5ff23c4bec34ffc0bb3eedd23858d5be932a3950"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/adbb4b320834516dc97fa33aaa853a45cbabca67",
          "sha": "adbb4b320834516dc97fa33aaa853a45cbabca67",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/adbb4b320834516dc97fa33aaa853a45cbabca67"
        }
      ],
      "message": "test: use dynamic port allocation to avoid test conflicts\n\nUse port=0 for dynamic port allocation in test framework components\nto avoid \"address already in use\" errors from concurrent tests or\nports stuck in TIME_WAIT state from previous test runs.\n\nChanges:\n- socks5.py: Update conf.addr after bind() to reflect actual port\n- p2p.py: Retrieve actual port after create_server() when port=0\n- feature_proxy.py: Use port=0 for all SOCKS5 proxy servers\n- feature_anchors.py: Use port=0 for onion proxy server",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2026-01-01T23:25:24Z"
      },
      "author": {
        "name": "woltx",
        "email": "94266259+w0xlt@users.noreply.github.com",
        "date": "2025-12-31T07:30:17Z"
      },
      "sha": "e50bf1ec58e6fd3dce947df8269cdf15aff0b85f"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21822011425,
      "node_id": "HRFPE_lADOABII587arB9szwAAAAUUsXgh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21822011425",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8c6151044c9315e6af9c10dbbc9951fa89e430b0",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/8c6151044c9315e6af9c10dbbc9951fa89e430b0",
      "created_at": "2026-01-02T00:06:20Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21822033624,
      "node_id": "HRFPE_lADOABII587arB9szwAAAAUUsc7Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21822033624",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "53457d847cf2f7d2fe15eeaf7d4ab877bd4b4f69",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/53457d847cf2f7d2fe15eeaf7d4ab877bd4b4f69",
      "created_at": "2026-01-02T00:11:56Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDExNGU2YzViMmYwMTI5YzgwZTNkZDNiN2NhNmQxYWJiZDg5NjVlNzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72",
      "tree": {
        "sha": "072ba6edcfc9acaddc64bb3a139fb4c3ce1080e5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/072ba6edcfc9acaddc64bb3a139fb4c3ce1080e5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e50bf1ec58e6fd3dce947df8269cdf15aff0b85f",
          "sha": "e50bf1ec58e6fd3dce947df8269cdf15aff0b85f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e50bf1ec58e6fd3dce947df8269cdf15aff0b85f"
        }
      ],
      "message": "test: add auto_outbound_mode to test framework\n\nThis new option allows tests to make use of automatic outbound connections\n(made from addrman).\nA SOCKS5 proxy is used to redirect the connection, by default to a P2PInterface\n\nFor advanced customization, tests can provide auto_outbound_factory()\nto overwrite where each outbound connection made by the node should be\nredirected to (for example to another node)\n\nCo-authored-by: Vasil Dimov <vd@FreeBSD.org>",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2026-01-02T00:17:30Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-11-21T21:26:12Z"
      },
      "sha": "114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBjYjA4NTczZjM4YjdhYThhMTgxNDdlZWYxYTc3NWI2YzI0YmNiN2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "tree": {
        "sha": "0b8f200b6fc51d139888c16e78067fd8e0f7615f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0b8f200b6fc51d139888c16e78067fd8e0f7615f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72",
          "sha": "114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/114e6c5b2f0129c80e3dd3b7ca6d1abbd8965e72"
        }
      ],
      "message": "test: add functional test for outbound connection management\n\nThe test covers\n- Extra outbound connections when the tip is stale\n- Regularly scheduled extra block-relay-only connections\n- Management of full outbound connection slots with respect to network-specific peers",
      "committer": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2026-01-02T00:17:30Z"
      },
      "author": {
        "name": "Martin Zumsande",
        "email": "mzumsande@gmail.com",
        "date": "2025-11-21T21:26:22Z"
      },
      "sha": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21822055545,
      "node_id": "HRFPE_lADOABII587arB9szwAAAAUUsiR5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21822055545",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "commit_url": "https://api.github.com/repos/mzumsande/bitcoin/commits/0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "created_at": "2026-01-02T00:17:53Z"
    },
    {
      "event": "reviewed",
      "id": 3643055559,
      "node_id": "PRR_kwDOABII587ZJJ3H",
      "url": null,
      "actor": null,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-09T10:44:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 0cb08573f38b7aa8a18147eef1a775b6c24bcb7c\r\n\r\nI ran `test_runner.py` and `p2p_outbound_management.py` a bunch of times locally and did not observe timeouts.",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#pullrequestreview-3643055559",
      "submitted_at": "2026-01-09T10:44:15Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2597394343",
      "pull_request_review_id": 3550549389,
      "id": 2597394343,
      "node_id": "PRRC_kwDOABII586a0Ren",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 45,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Would it make sense to introduce `auto_listener_port(n)`?",
      "created_at": "2025-12-08T07:45:26Z",
      "updated_at": "2025-12-08T12:25:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2597394343",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2597394343"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2597405891",
      "pull_request_review_id": 3550549389,
      "id": 2597405891,
      "node_id": "PRRC_kwDOABII586a0UTD",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1\n+\n+        actual_to_addr = \"\"\n+        actual_to_port = 0\n+\n+        listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+        listener.peer_connect_send_version(services=P2P_SERVICES)\n+\n+        def on_listen_done(addr, port):\n+            nonlocal actual_to_addr\n+            nonlocal actual_to_port\n+            actual_to_addr = addr\n+            actual_to_port = port\n+\n+        self.network_thread.listen(\n+            addr=\"127.0.0.1\",\n+            port=ports_base + connection_index,\n+            p2p=listener,\n+            callback=on_listen_done)\n+\n+        # Wait until the callback has been called.\n+        self.wait_until(lambda: actual_to_port != 0)\n+\n+        return (actual_to_addr, actual_to_port)\n+\n+    def _setup_auto_outbound_mode(self):\n+        \"\"\"Setup SOCKS5 proxy with destinations factory for auto outbound mode.\"\"\"\n+        socks5_server_config = Socks5Configuration()\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 64,
      "original_position": 73,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This is somewhat of a misuse of `p2p_port()`. It works, but looking at it I wonder if it can be done better. Maybe introduce `proxy_port(n)`? At some point if we implement also SAM proxy (for hijacking I2P connections), then we might need e.g. `proxy_port(0)` for the SOCKS5 proxy and `proxy_port(1)` for the SAM proxy.",
      "created_at": "2025-12-08T07:48:13Z",
      "updated_at": "2025-12-08T12:25:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2597405891",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2597405891"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 437,
      "original_line": 437,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598416420",
      "pull_request_review_id": 3550549389,
      "id": 2598416420,
      "node_id": "PRRC_kwDOABII586a4LAk",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1\n+\n+        actual_to_addr = \"\"\n+        actual_to_port = 0\n+\n+        listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+        listener.peer_connect_send_version(services=P2P_SERVICES)\n+\n+        def on_listen_done(addr, port):\n+            nonlocal actual_to_addr\n+            nonlocal actual_to_port\n+            actual_to_addr = addr\n+            actual_to_port = port\n+\n+        self.network_thread.listen(\n+            addr=\"127.0.0.1\",\n+            port=ports_base + connection_index,\n+            p2p=listener,\n+            callback=on_listen_done)\n+\n+        # Wait until the callback has been called.\n+        self.wait_until(lambda: actual_to_port != 0)\n+\n+        return (actual_to_addr, actual_to_port)\n+\n+    def _setup_auto_outbound_mode(self):\n+        \"\"\"Setup SOCKS5 proxy with destinations factory for auto outbound mode.\"\"\"\n+        socks5_server_config = Socks5Configuration()\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        self.auto_outbound_destinations = []\n+        self.auto_outbound_destinations_lock = threading.Lock()\n+\n+        def destinations_factory(requested_to_addr, requested_to_port):\n+            with self.auto_outbound_destinations_lock:\n+                i = len(self.auto_outbound_destinations)\n+\n+                # Create listener with default P2PInterface\n+                listener = P2PInterface()\n+                actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener, i)\n+\n+                self.log.debug(f\"Instructing the SOCKS5 proxy to redirect connection i={i} to \"\n+                               f\"{format_addr_port(actual_to_addr, actual_to_port)} (a Python node)\")",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 92,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If this is changed to:\r\n\r\n```diff\r\n-                # Create listener with default P2PInterface\r\n-                listener = P2PInterface()\r\n-                actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener, i)\r\n+                if self.decide_auto_outbound_where_to:\r\n+                    actual_to_addr, actual_to_port, listener = self.decide_auto_outbound_where_to(i)\r\n+                else:\r\n+                    # Create listener with default P2PInterface\r\n+                    listener = P2PInterface()\r\n+                    actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener, i)\r\n \r\n                 self.log.debug(f\"Instructing the SOCKS5 proxy to redirect connection i={i} to \"\r\n-                               f\"{format_addr_port(actual_to_addr, actual_to_port)} (a Python node)\")\r\n+                               f\"{format_addr_port(actual_to_addr, actual_to_port)}\")\r\n```\r\n\r\nthen it is possible to override from the test:\r\n* the decision where to redirect and\r\n* the listener creation (in case something other than `P2PInterface` is needed, e.g. `P2PDataStore`)\r\n\r\nWith that change, the private broadcast test can take the following simplification (`28 insertions(+), 78 deletions(-)`):\r\n\r\n<details>\r\n<summary>[patch] make use of this in p2p_private_broadcast.py</summary>\r\n\r\n```diff\r\ndiff --git i/test/functional/p2p_private_broadcast.py w/test/functional/p2p_private_broadcast.py\r\nindex 4e97da666a..697d44c299 100755\r\n--- i/test/functional/p2p_private_broadcast.py\r\n+++ w/test/functional/p2p_private_broadcast.py\r\n@@ -162,95 +162,45 @@ ADDRMAN_ADDRESSES = [\r\n     \"[fc00::20]\",\r\n ]\r\n \r\n \r\n class P2PPrivateBroadcast(BitcoinTestFramework):\r\n     def set_test_params(self):\r\n-        self.disable_autoconnect = False\r\n+        self.auto_outbound_mode = True\r\n         self.num_nodes = 2\r\n \r\n     def setup_nodes(self):\r\n-        # Start a SOCKS5 proxy server.\r\n-        socks5_server_config = Socks5Configuration()\r\n-        # self.nodes[0] listens on p2p_port(0),\r\n-        # self.nodes[1] listens on p2p_port(1),\r\n-        # thus we tell the SOCKS5 server to listen on p2p_port(self.num_nodes) (self.num_nodes is 2)\r\n-        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\r\n-        socks5_server_config.unauth = True\r\n-        socks5_server_config.auth = True\r\n-\r\n-        self.socks5_server = Socks5Server(socks5_server_config)\r\n-        self.socks5_server.start()\r\n-\r\n-        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\r\n-        ports_base = tor_port(MAX_NODES) + 1\r\n-\r\n-        self.destinations = []\r\n-\r\n-        self.destinations_lock = threading.Lock()\r\n-\r\n-        def destinations_factory(requested_to_addr, requested_to_port):\r\n-            with self.destinations_lock:\r\n-                i = len(self.destinations)\r\n-                actual_to_addr = \"\"\r\n-                actual_to_port = 0\r\n-                listener = None\r\n-                if i == NUM_INITIAL_CONNECTIONS:\r\n-                    # Instruct the SOCKS5 server to redirect the first private\r\n-                    # broadcast connection from nodes[0] to nodes[1]\r\n-                    actual_to_addr = \"127.0.0.1\" # nodes[1] listen address\r\n-                    actual_to_port = tor_port(1) # nodes[1] listen port for Tor\r\n-                    self.log.debug(f\"Instructing the SOCKS5 proxy to redirect connection i={i} to \"\r\n-                                   f\"{format_addr_port(actual_to_addr, actual_to_port)} (nodes[1])\")\r\n-                else:\r\n-                    # Create a Python P2P listening node and instruct the SOCKS5 proxy to\r\n-                    # redirect the connection to it. The first outbound connection is used\r\n-                    # later to serve GETDATA, thus make it P2PDataStore().\r\n-                    listener = P2PDataStore() if i == 0 else P2PInterface()\r\n-                    listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\r\n-                    listener.peer_connect_send_version(services=P2P_SERVICES)\r\n-\r\n-                    def on_listen_done(addr, port):\r\n-                        nonlocal actual_to_addr\r\n-                        nonlocal actual_to_port\r\n-                        actual_to_addr = addr\r\n-                        actual_to_port = port\r\n-\r\n-                    self.network_thread.listen(\r\n-                        addr=\"127.0.0.1\",\r\n-                        port=ports_base + i,\r\n-                        p2p=listener,\r\n-                        callback=on_listen_done)\r\n-                    # Wait until the callback has been called.\r\n-                    self.wait_until(lambda: actual_to_port != 0)\r\n-                    self.log.debug(f\"Instructing the SOCKS5 proxy to redirect connection i={i} to \"\r\n-                                   f\"{format_addr_port(actual_to_addr, actual_to_port)} (a Python node)\")\r\n-\r\n-                self.destinations.append({\r\n-                    \"requested_to\": format_addr_port(requested_to_addr, requested_to_port),\r\n-                    \"node\": listener,\r\n-                })\r\n-                assert_equal(len(self.destinations), i + 1)\r\n-\r\n-                return {\r\n-                    \"actual_to_addr\": actual_to_addr,\r\n-                    \"actual_to_port\": actual_to_port,\r\n-                }\r\n-\r\n-        self.socks5_server.conf.destinations_factory = destinations_factory\r\n+\r\n+        def decide_auto_outbound_where_to(connection_index):\r\n+            actual_to_addr = \"\"\r\n+            actual_to_port = 0\r\n+            listener = None\r\n+            if connection_index == NUM_INITIAL_CONNECTIONS:\r\n+                # Instruct the SOCKS5 server to redirect the first private\r\n+                # broadcast connection from nodes[0] to nodes[1]\r\n+                actual_to_addr = \"127.0.0.1\" # nodes[1] listen address\r\n+                actual_to_port = tor_port(1) # nodes[1] listen port for Tor\r\n+            else:\r\n+                # Create a Python P2P listening node and instruct the SOCKS5 proxy to\r\n+                # redirect the connection to it. The first outbound connection is used\r\n+                # later to serve GETDATA, thus make it P2PDataStore().\r\n+                listener = P2PDataStore() if connection_index == 0 else P2PInterface()\r\n+                actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener, connection_index)\r\n+            return actual_to_addr, actual_to_port, listener\r\n+\r\n+        self.decide_auto_outbound_where_to = decide_auto_outbound_where_to\r\n \r\n         self.extra_args = [\r\n             [\r\n                 # Needed to be able to add CJDNS addresses to addrman (otherwise they are unroutable).\r\n                 \"-cjdnsreachable\",\r\n                 # Connecting, sending garbage, being disconnected messes up with this test's\r\n                 # check_broadcasts() which waits for a particular Python node to receive a connection.\r\n                 \"-v2transport=0\",\r\n                 \"-test=addrman\",\r\n                 \"-privatebroadcast\",\r\n-                f\"-proxy={socks5_server_config.addr[0]}:{socks5_server_config.addr[1]}\",\r\n                 # To increase coverage, make it think that the I2P network is reachable so that it\r\n                 # selects such addresses as well. Pick a proxy address where nobody is listening\r\n                 # and connection attempts fail quickly.\r\n                 \"-i2psam=127.0.0.1:1\",\r\n             ],\r\n             [\r\n@@ -268,14 +218,14 @@ class P2PPrivateBroadcast(BitcoinTestFramework):\r\n         i = skip_destinations - 1\r\n         while broadcasts_done < broadcasts_to_expect:\r\n             i += 1\r\n             self.log.debug(f\"{label}: waiting for outbound connection i={i}\")\r\n             # At this point the connection may not yet have been established (A),\r\n             # may be active (B), or may have already been closed (C).\r\n-            self.wait_until(lambda: len(self.destinations) > i)\r\n-            dest = self.destinations[i]\r\n+            self.wait_until(lambda: len(self.auto_outbound_destinations) > i)\r\n+            dest = self.auto_outbound_destinations[i]\r\n             peer = dest[\"node\"]\r\n             peer.wait_until(lambda: peer.message_count[\"version\"] == 1, check_connected=False)\r\n             # Now it is either (B) or (C).\r\n             if peer.last_message[\"version\"].nServices != 0:\r\n                 self.log.debug(f\"{label}: outbound connection i={i} to {dest['requested_to']} not a private broadcast, ignoring it (maybe feeler or extra block only)\")\r\n                 continue\r\n@@ -313,13 +263,13 @@ class P2PPrivateBroadcast(BitcoinTestFramework):\r\n         # Fill tx_originator's addrman.\r\n         for addr in ADDRMAN_ADDRESSES:\r\n             res = tx_originator.addpeeraddress(address=addr, port=8333, tried=False)\r\n             if not res[\"success\"]:\r\n                 self.log.debug(f\"Could not add {addr} to tx_originator's addrman (collision?)\")\r\n \r\n-        self.wait_until(lambda: len(self.destinations) == NUM_INITIAL_CONNECTIONS)\r\n+        self.wait_until(lambda: len(self.auto_outbound_destinations) == NUM_INITIAL_CONNECTIONS)\r\n \r\n         # The next opened connection by tx_originator should be \"private broadcast\"\r\n         # for sending the transaction. The SOCKS5 proxy should redirect it to tx_receiver.\r\n \r\n         txs = wallet.create_self_transfer_chain(chain_length=3)\r\n         self.log.info(f\"Created txid={txs[0]['txid']}: for basic test\")\r\n@@ -353,31 +303,31 @@ class P2PPrivateBroadcast(BitcoinTestFramework):\r\n         assert_equal(len(tx_originator.getrawmempool()), 0)\r\n \r\n         wtxid_int = int(txs[0][\"wtxid\"], 16)\r\n         inv = CInv(MSG_WTX, wtxid_int)\r\n \r\n         self.log.info(\"Sending INV and waiting for GETDATA from node\")\r\n-        tx_returner = self.destinations[0][\"node\"] # Will return the transaction back to the originator.\r\n+        tx_returner = self.auto_outbound_destinations[0][\"node\"] # Will return the transaction back to the originator.\r\n         tx_returner.tx_store[wtxid_int] = txs[0][\"tx\"]\r\n         assert \"getdata\" not in tx_returner.last_message\r\n         received_back_msg = f\"Received our privately broadcast transaction (txid={txs[0]['txid']}) from the network\"\r\n         with tx_originator.assert_debug_log(expected_msgs=[received_back_msg]):\r\n             tx_returner.send_without_ping(msg_inv([inv]))\r\n             tx_returner.wait_until(lambda: \"getdata\" in tx_returner.last_message)\r\n             self.wait_until(lambda: len(tx_originator.getrawmempool()) > 0)\r\n \r\n         self.log.info(\"Waiting for normal broadcast to another peer\")\r\n-        self.destinations[1][\"node\"].wait_for_inv([inv])\r\n+        self.auto_outbound_destinations[1][\"node\"].wait_for_inv([inv])\r\n \r\n         self.log.info(\"Sending a transaction that is already in the mempool\")\r\n-        skip_destinations = len(self.destinations)\r\n+        skip_destinations = len(self.auto_outbound_destinations)\r\n         tx_originator.sendrawtransaction(hexstring=txs[0][\"hex\"], maxfeerate=0)\r\n         self.check_broadcasts(\"Broadcast of mempool transaction\", txs[0], NUM_PRIVATE_BROADCAST_PER_TX, skip_destinations)\r\n \r\n         self.log.info(\"Sending a transaction with a dependency in the mempool\")\r\n-        skip_destinations = len(self.destinations)\r\n+        skip_destinations = len(self.auto_outbound_destinations)\r\n         tx_originator.sendrawtransaction(hexstring=txs[1][\"hex\"], maxfeerate=0.1)\r\n         self.check_broadcasts(\"Dependency in mempool\", txs[1], NUM_PRIVATE_BROADCAST_PER_TX, skip_destinations)\r\n \r\n         self.log.info(\"Sending a transaction with a dependency not in the mempool (should be rejected)\")\r\n         assert_equal(len(tx_originator.getrawmempool()), 1)\r\n         assert_raises_rpc_error(-25, \"bad-txns-inputs-missingorspent\",\r\n@@ -388,13 +338,13 @@ class P2PPrivateBroadcast(BitcoinTestFramework):\r\n         # Since txs[1] has not been received back by tx_originator,\r\n         # it should be re-broadcast after a while. Advance tx_originator's clock\r\n         # to trigger a re-broadcast. Should be more than the maximum returned by\r\n         # NextTxBroadcast() in net_processing.cpp.\r\n         self.log.info(\"Checking that rebroadcast works\")\r\n         delta = 20 * 60 # 20min\r\n-        skip_destinations = len(self.destinations)\r\n+        skip_destinations = len(self.auto_outbound_destinations)\r\n         rebroadcast_msg = f\"Reattempting broadcast of stale txid={txs[1]['txid']}\"\r\n         with tx_originator.busy_wait_for_debug_log(expected_msgs=[rebroadcast_msg.encode()]):\r\n             tx_originator.setmocktime(int(time.time()) + delta)\r\n             tx_originator.mockscheduler(delta)\r\n         self.check_broadcasts(\"Rebroadcast\", txs[1], 1, skip_destinations)\r\n         tx_originator.setmocktime(0) # Let the clock tick again (it will go backwards due to this).\r\n```\r\n</details>",
      "created_at": "2025-12-08T12:21:36Z",
      "updated_at": "2025-12-08T12:25:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2598416420",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2598416420"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": 452,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 457,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611907262",
      "pull_request_review_id": 3569102205,
      "id": 2611907262,
      "node_id": "PRRC_kwDOABII586broq-",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 45,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2597394343,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Haven't looked here in detail, but my preference would be to not call `+` or `+=` on an integral port returned by a helper function. This will lead to issues down the line, and it would be better to always call the helper that internally asserts and checks the port range. See https://github.com/bitcoin/bitcoin/pull/33260/files",
      "created_at": "2025-12-11T20:03:53Z",
      "updated_at": "2025-12-11T20:03:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2611907262",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611907262"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611923052",
      "pull_request_review_id": 3569122278,
      "id": 2611923052,
      "node_id": "PRRC_kwDOABII586brshs",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 45,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2597394343,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In trying to apply this I think I found a more general problem with port collisions:\r\nAs soon as more than one test uses this feature, there is the possibility of port collisions between two tests that run in parallel. So we would need to assign separate ranges. \r\nWe know that a node will only make up to 11 outbound connections at a given moment, but currently disconnections/new connections will just be added to `self.auto_outbound_destinations`, so something like\r\n```\r\ndef auto_listener_port(n):\r\n    return p2p_port(n) + PORT_RANGE * 3\r\n```\r\n\r\nwouldn't work either. Maybe we could use the fact that the node will never make more than 11 outbound connection at the same time and re-use ports of disconnected nodes for later nodes. I'll have to think more about this.",
      "created_at": "2025-12-11T20:10:10Z",
      "updated_at": "2025-12-11T21:07:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2611923052",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611923052"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611923854",
      "pull_request_review_id": 3569123080,
      "id": 2611923854,
      "node_id": "PRRC_kwDOABII586brsuO",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1\n+\n+        actual_to_addr = \"\"\n+        actual_to_port = 0\n+\n+        listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+        listener.peer_connect_send_version(services=P2P_SERVICES)\n+\n+        def on_listen_done(addr, port):\n+            nonlocal actual_to_addr\n+            nonlocal actual_to_port\n+            actual_to_addr = addr\n+            actual_to_port = port\n+\n+        self.network_thread.listen(\n+            addr=\"127.0.0.1\",\n+            port=ports_base + connection_index,\n+            p2p=listener,\n+            callback=on_listen_done)\n+\n+        # Wait until the callback has been called.\n+        self.wait_until(lambda: actual_to_port != 0)\n+\n+        return (actual_to_addr, actual_to_port)\n+\n+    def _setup_auto_outbound_mode(self):\n+        \"\"\"Setup SOCKS5 proxy with destinations factory for auto outbound mode.\"\"\"\n+        socks5_server_config = Socks5Configuration()\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        self.auto_outbound_destinations = []\n+        self.auto_outbound_destinations_lock = threading.Lock()\n+\n+        def destinations_factory(requested_to_addr, requested_to_port):\n+            with self.auto_outbound_destinations_lock:\n+                i = len(self.auto_outbound_destinations)\n+\n+                # Create listener with default P2PInterface\n+                listener = P2PInterface()\n+                actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener, i)\n+\n+                self.log.debug(f\"Instructing the SOCKS5 proxy to redirect connection i={i} to \"\n+                               f\"{format_addr_port(actual_to_addr, actual_to_port)} (a Python node)\")",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 92,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2598416420,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "done, used the name `auto_outbound_factory` ",
      "created_at": "2025-12-11T20:10:26Z",
      "updated_at": "2025-12-11T21:01:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2611923854",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2611923854"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": 452,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 457,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2613108267",
      "pull_request_review_id": 3570522147,
      "id": 2613108267,
      "node_id": "PRRC_kwDOABII586bwN4r",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 45,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2597394343,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "There are about 60k ports to choose from. There must be a way to pick in a collision free manner even without reuse...",
      "created_at": "2025-12-12T06:40:38Z",
      "updated_at": "2025-12-12T06:40:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2613108267",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2613108267"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656686924",
      "pull_request_review_id": 3622099494,
      "id": 2656686924,
      "node_id": "PRRC_kwDOABII586eWdNM",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 1,
      "original_position": 45,
      "commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2597394343,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I cherry-picked the commit from #34186, making it possible to use `port=0` and then let the OS deal with it - much better than assigning the port by the test itself.",
      "created_at": "2026-01-02T00:05:15Z",
      "updated_at": "2026-01-02T00:05:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2656686924",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2656686924"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 410,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675384643",
      "pull_request_review_id": 3643001967,
      "id": 2675384643,
      "node_id": "PRRC_kwDOABII586fdyFD",
      "diff_hunk": "@@ -395,6 +404,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener, connection_index):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        # Tor ports are the highest among p2p/rpc/tor, so this should be the first available port.\n+        ports_base = tor_port(MAX_NODES) + 1\n+\n+        actual_to_addr = \"\"\n+        actual_to_port = 0\n+\n+        listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+        listener.peer_connect_send_version(services=P2P_SERVICES)\n+\n+        def on_listen_done(addr, port):\n+            nonlocal actual_to_addr\n+            nonlocal actual_to_port\n+            actual_to_addr = addr\n+            actual_to_port = port\n+\n+        self.network_thread.listen(\n+            addr=\"127.0.0.1\",\n+            port=ports_base + connection_index,\n+            p2p=listener,\n+            callback=on_listen_done)\n+\n+        # Wait until the callback has been called.\n+        self.wait_until(lambda: actual_to_port != 0)\n+\n+        return (actual_to_addr, actual_to_port)\n+\n+    def _setup_auto_outbound_mode(self):\n+        \"\"\"Setup SOCKS5 proxy with destinations factory for auto outbound mode.\"\"\"\n+        socks5_server_config = Socks5Configuration()\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 64,
      "original_position": 73,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "1158564303b2e73d5254f258899b63007e3f52a1",
      "in_reply_to_id": 2597405891,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "With the changes from #34186 / `socks5.py` (now also included in this PR), this can be changed to:\r\n\r\n```py\r\nsocks5_server_config.addr = (\"127.0.0.1\", 0)\r\n```",
      "created_at": "2026-01-09T09:02:14Z",
      "updated_at": "2026-01-09T09:02:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675384643",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675384643"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 437,
      "original_line": 437,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675425492",
      "pull_request_review_id": 3643055559,
      "id": 2675425492,
      "node_id": "PRRC_kwDOABII586fd8DU",
      "diff_hunk": "@@ -396,6 +406,72 @@ def setup_nodes(self):\n                 assert_equal(chain_info[\"blocks\"], 200)\n                 assert_equal(chain_info[\"initialblockdownload\"], False)\n \n+    def _create_auto_outbound_listener(self, listener):\n+        \"\"\"Helper to create and setup a P2P listener for auto outbound mode\"\"\"\n+        actual_to_addr = \"\"\n+        actual_to_port = 0\n+\n+        listener.peer_connect_helper(dstaddr=\"0.0.0.0\", dstport=0, net=self.chain, timeout_factor=self.options.timeout_factor)\n+        listener.peer_connect_send_version(services=P2P_SERVICES)\n+\n+        def on_listen_done(addr, port):\n+            nonlocal actual_to_addr\n+            nonlocal actual_to_port\n+            actual_to_addr = addr\n+            actual_to_port = port\n+\n+        self.network_thread.listen(\n+            addr=\"127.0.0.1\",\n+            port=0, # Dynamic port allocation\n+            p2p=listener,\n+            callback=on_listen_done)\n+\n+        # Wait until the callback has been called.\n+        self.wait_until(lambda: actual_to_port != 0)\n+\n+        return (actual_to_addr, actual_to_port)\n+\n+    def _setup_auto_outbound_mode(self):\n+        \"\"\"Setup SOCKS5 proxy with destinations factory for auto outbound mode.\"\"\"\n+        socks5_server_config = Socks5Configuration()\n+        socks5_server_config.addr = (\"127.0.0.1\", p2p_port(self.num_nodes))\n+        socks5_server_config.unauth = True\n+        socks5_server_config.auth = True\n+\n+        self.socks5_server = Socks5Server(socks5_server_config)\n+        self.socks5_server.start()\n+\n+        self.auto_outbound_destinations = []\n+        self.auto_outbound_destinations_lock = threading.Lock()\n+\n+        def destinations_factory(requested_to_addr, requested_to_port):\n+            with self.auto_outbound_destinations_lock:\n+                i = len(self.auto_outbound_destinations)\n+\n+                if self.auto_outbound_factory:\n+                    actual_to_addr, actual_to_port, listener = self.auto_outbound_factory(i)\n+                else:\n+                    # Create listener with default P2PInterface\n+                    listener = P2PInterface()\n+                    actual_to_addr, actual_to_port = self._create_auto_outbound_listener(listener)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 83,
      "original_position": 83,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Maybe get `auto_outbound_factory()` and `_create_auto_outbound_listener()` to have the same interface? That is, change `_create_auto_outbound_listener()` to also return the listener? Then this will be more consistent:\r\n\r\n```py\r\n                if self.auto_outbound_factory:\r\n                    actual_to_addr, actual_to_port, listener = self.auto_outbound_factory(i)\r\n                else:\r\n                    actual_to_addr, actual_to_port, listener = self._create_auto_outbound_listener(listener)\r\n```\r\nand then we can have one function (pointer) that either points to the default one or to the user-provided one and here just:\r\n```py\r\nactual_to_addr, actual_to_port, listener = self.auto_outbound_factory(i)\r\n```\r\nwithout an `if` condition. That would mean to also rename `_create_auto_outbound_listener()` to `auto_outbound_factory()` and remove the line `self.auto_outbound_factory = None` from `BitcoinTestFramework::__init__()`.\r\n\r\nFeel free to ignore if you do not see this as an improvement.",
      "created_at": "2026-01-09T09:16:24Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675425492",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675425492"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": 451,
      "original_start_line": 451,
      "start_side": "RIGHT",
      "line": 456,
      "original_line": 456,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675441115",
      "pull_request_review_id": 3643055559,
      "id": 2675441115,
      "node_id": "PRRC_kwDOABII586fd_3b",
      "diff_hunk": "@@ -447,6 +523,13 @@ def bin_dir_from_version(version):\n             extra_confs = [[]] * num_nodes\n         if extra_args is None:\n             extra_args = [[]] * num_nodes\n+        # Add auto outbound mode proxy configuration\n+        if self.auto_outbound_mode:\n+            socks5_config = self._setup_auto_outbound_mode()\n+            for i in range(num_nodes):\n+                extra_args[i] = extra_args[i] + [\n+                    f\"-proxy={socks5_config.addr[0]}:{socks5_config.addr[1]}\"",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 114,
      "original_position": 114,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Maybe this needs `format_addr_port()` as well, in case the address happens to be IPv6 and needs to be enclosed in `[]`?",
      "created_at": "2026-01-09T09:21:27Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675441115",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675441115"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 531,
      "original_line": 531,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675530659",
      "pull_request_review_id": 3643055559,
      "id": 2675530659,
      "node_id": "PRRC_kwDOABII586feVuj",
      "diff_hunk": "@@ -0,0 +1,242 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2025-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test management of automatic connections:\n+- Extra outbound connections when the tip is stale\n+- Regularly scheduled extra block-relay-only connections\n+- Management of full outbound connection slots with respect to network-specific peers\n+\"\"\"\n+\n+import random\n+import time\n+\n+from test_framework.blocktools import (\n+    create_block,\n+    create_coinbase,\n+)\n+from test_framework.messages import (\n+    CBlock,\n+    CBlockHeader,\n+    from_hex,\n+    msg_block,\n+    msg_headers,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class P2POutboundManagement(BitcoinTestFramework):\n+\n+    # makes sure stale tip check / extra peer eviction is run\n+    SCHEDULE_EXTRA_PEER_CHECK = 46\n+    # chosen large enough that EXTRA_NETWORK_PEER_INTERVAL and EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL\n+    # which are on exponential 5min timers, will hit with very high probability\n+    MOCKTIME_BUMP = 5000\n+\n+    def set_test_params(self):\n+        self.auto_outbound_mode = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-test=addrman\", \"-cjdnsreachable\"]]\n+\n+    def all_sync_send_with_ping(self, peers):\n+        \"\"\"Send a ping to all connected peers and wait for pongs.\"\"\"\n+        for p in peers:\n+            node = p[\"node\"]\n+            if node.is_connected:\n+                node.sync_with_ping()\n+\n+    def has_regular_outbounds(self, node):\n+        \"\"\"Check if we have 8 full outbound and 2 block-relay-only connections.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        block_relay = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(full_outbound) == 8 and len(block_relay) == 2\n+\n+    def has_extra_block_relay_peer(self, node):\n+        \"\"\"Check if we have more than 2 block-relay-only peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(block_relay_peers) > 2\n+\n+    def has_extra_full_outbound_peer(self, node):\n+        \"\"\"Check if we have more than 8 full outbound peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        return len(full_outbound) > 8\n+\n+    def disconnect_last_block_relay_peer(self):\n+        \"\"\"Find and disconnect the most recently connected block-relay-only peer.\n+           Done manually instead of waiting for the node to disconnect automatically to\n+           avoid rare interactions with the scheduling of the next extra block-relay-only peer\"\"\"\n+        node = self.nodes[0]",
      "path": "test/functional/p2p_outbound_management.py",
      "position": 75,
      "original_position": 75,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The other helper functions\r\n`has_regular_outbounds()`,\r\n`has_extra_block_relay_peer()` and\r\n`has_extra_full_outbound_peer()`\r\ntake a `node` argument. Maybe add such argument also to `disconnect_last_block_relay_peer()` for consistency?\r\n\r\nPS1 same for `wait_for_network_specific_peer()`\r\nPS2 all of those end up using `self.nodes[0]`, so another option is to drop the `node` argument from all.",
      "created_at": "2026-01-09T09:49:14Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675530659",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675530659"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": 71,
      "original_start_line": 71,
      "start_side": "RIGHT",
      "line": 75,
      "original_line": 75,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675544603",
      "pull_request_review_id": 3643055559,
      "id": 2675544603,
      "node_id": "PRRC_kwDOABII586feZIb",
      "diff_hunk": "@@ -0,0 +1,242 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2025-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test management of automatic connections:\n+- Extra outbound connections when the tip is stale\n+- Regularly scheduled extra block-relay-only connections\n+- Management of full outbound connection slots with respect to network-specific peers\n+\"\"\"\n+\n+import random\n+import time\n+\n+from test_framework.blocktools import (\n+    create_block,\n+    create_coinbase,\n+)\n+from test_framework.messages import (\n+    CBlock,\n+    CBlockHeader,\n+    from_hex,\n+    msg_block,\n+    msg_headers,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class P2POutboundManagement(BitcoinTestFramework):\n+\n+    # makes sure stale tip check / extra peer eviction is run\n+    SCHEDULE_EXTRA_PEER_CHECK = 46\n+    # chosen large enough that EXTRA_NETWORK_PEER_INTERVAL and EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL\n+    # which are on exponential 5min timers, will hit with very high probability\n+    MOCKTIME_BUMP = 5000\n+\n+    def set_test_params(self):\n+        self.auto_outbound_mode = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-test=addrman\", \"-cjdnsreachable\"]]\n+\n+    def all_sync_send_with_ping(self, peers):\n+        \"\"\"Send a ping to all connected peers and wait for pongs.\"\"\"\n+        for p in peers:\n+            node = p[\"node\"]\n+            if node.is_connected:\n+                node.sync_with_ping()\n+\n+    def has_regular_outbounds(self, node):\n+        \"\"\"Check if we have 8 full outbound and 2 block-relay-only connections.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        block_relay = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(full_outbound) == 8 and len(block_relay) == 2\n+\n+    def has_extra_block_relay_peer(self, node):\n+        \"\"\"Check if we have more than 2 block-relay-only peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(block_relay_peers) > 2\n+\n+    def has_extra_full_outbound_peer(self, node):\n+        \"\"\"Check if we have more than 8 full outbound peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        return len(full_outbound) > 8\n+\n+    def disconnect_last_block_relay_peer(self):\n+        \"\"\"Find and disconnect the most recently connected block-relay-only peer.\n+           Done manually instead of waiting for the node to disconnect automatically to\n+           avoid rare interactions with the scheduling of the next extra block-relay-only peer\"\"\"\n+        node = self.nodes[0]\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        assert block_relay_peers\n+        # Disconnect the peer with the highest id\n+        last_peer = max(block_relay_peers, key=lambda p: p['id'])\n+        node.disconnectnode(nodeid=last_peer['id'])\n+\n+    def wait_for_network_specific_peer(self):\n+        \"\"\"Advance time, wait for a network-specific full outbound peer, and trigger eviction.\n+\n+        Extra block-relay-only connections are prioritized over network-specific ones, but defensively:\n+        if an already connected tor or cjdns address is picked, there is no retry. This can cause either\n+        type of peer to arrive first.\n+        \"\"\"\n+        node = self.nodes[0]\n+\n+        self.log.info(\"Advance time\")\n+        self.cur_time += self.MOCKTIME_BUMP\n+        node.setmocktime(self.cur_time)\n+        self.generate(node, 1)  # Disable stale-tip extra-outbound connections that could interfer",
      "path": "test/functional/p2p_outbound_management.py",
      "position": 95,
      "original_position": 95,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n        self.generate(node, 1)  # Disable stale-tip extra-outbound connections that could interfere\r\n```",
      "created_at": "2026-01-09T09:53:22Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675544603",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675544603"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 95,
      "original_line": 95,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675557061",
      "pull_request_review_id": 3643055559,
      "id": 2675557061,
      "node_id": "PRRC_kwDOABII586fecLF",
      "diff_hunk": "@@ -0,0 +1,242 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2025-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test management of automatic connections:\n+- Extra outbound connections when the tip is stale\n+- Regularly scheduled extra block-relay-only connections\n+- Management of full outbound connection slots with respect to network-specific peers\n+\"\"\"\n+\n+import random\n+import time\n+\n+from test_framework.blocktools import (\n+    create_block,\n+    create_coinbase,\n+)\n+from test_framework.messages import (\n+    CBlock,\n+    CBlockHeader,\n+    from_hex,\n+    msg_block,\n+    msg_headers,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class P2POutboundManagement(BitcoinTestFramework):\n+\n+    # makes sure stale tip check / extra peer eviction is run\n+    SCHEDULE_EXTRA_PEER_CHECK = 46\n+    # chosen large enough that EXTRA_NETWORK_PEER_INTERVAL and EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL\n+    # which are on exponential 5min timers, will hit with very high probability\n+    MOCKTIME_BUMP = 5000\n+\n+    def set_test_params(self):\n+        self.auto_outbound_mode = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-test=addrman\", \"-cjdnsreachable\"]]\n+\n+    def all_sync_send_with_ping(self, peers):\n+        \"\"\"Send a ping to all connected peers and wait for pongs.\"\"\"\n+        for p in peers:\n+            node = p[\"node\"]\n+            if node.is_connected:\n+                node.sync_with_ping()\n+\n+    def has_regular_outbounds(self, node):\n+        \"\"\"Check if we have 8 full outbound and 2 block-relay-only connections.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        block_relay = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(full_outbound) == 8 and len(block_relay) == 2\n+\n+    def has_extra_block_relay_peer(self, node):\n+        \"\"\"Check if we have more than 2 block-relay-only peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(block_relay_peers) > 2\n+\n+    def has_extra_full_outbound_peer(self, node):\n+        \"\"\"Check if we have more than 8 full outbound peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        return len(full_outbound) > 8\n+\n+    def disconnect_last_block_relay_peer(self):\n+        \"\"\"Find and disconnect the most recently connected block-relay-only peer.\n+           Done manually instead of waiting for the node to disconnect automatically to\n+           avoid rare interactions with the scheduling of the next extra block-relay-only peer\"\"\"\n+        node = self.nodes[0]\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        assert block_relay_peers\n+        # Disconnect the peer with the highest id\n+        last_peer = max(block_relay_peers, key=lambda p: p['id'])\n+        node.disconnectnode(nodeid=last_peer['id'])\n+\n+    def wait_for_network_specific_peer(self):\n+        \"\"\"Advance time, wait for a network-specific full outbound peer, and trigger eviction.\n+\n+        Extra block-relay-only connections are prioritized over network-specific ones, but defensively:\n+        if an already connected tor or cjdns address is picked, there is no retry. This can cause either\n+        type of peer to arrive first.\n+        \"\"\"\n+        node = self.nodes[0]\n+\n+        self.log.info(\"Advance time\")\n+        self.cur_time += self.MOCKTIME_BUMP\n+        node.setmocktime(self.cur_time)\n+        self.generate(node, 1)  # Disable stale-tip extra-outbound connections that could interfer",
      "path": "test/functional/p2p_outbound_management.py",
      "position": 95,
      "original_position": 95,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Is there an unlikely scenario that a stale-tip extra-outbound connection is initiated after advancing the mocktime and before `self.generate(node, 1)`? And eventually causing the interference that this is trying to disable?",
      "created_at": "2026-01-09T09:57:17Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675557061",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675557061"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": 92,
      "original_start_line": 92,
      "start_side": "RIGHT",
      "line": 95,
      "original_line": 95,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675662381",
      "pull_request_review_id": 3643055559,
      "id": 2675662381,
      "node_id": "PRRC_kwDOABII586fe14t",
      "diff_hunk": "@@ -0,0 +1,242 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2025-present The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"\n+Test management of automatic connections:\n+- Extra outbound connections when the tip is stale\n+- Regularly scheduled extra block-relay-only connections\n+- Management of full outbound connection slots with respect to network-specific peers\n+\"\"\"\n+\n+import random\n+import time\n+\n+from test_framework.blocktools import (\n+    create_block,\n+    create_coinbase,\n+)\n+from test_framework.messages import (\n+    CBlock,\n+    CBlockHeader,\n+    from_hex,\n+    msg_block,\n+    msg_headers,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+\n+class P2POutboundManagement(BitcoinTestFramework):\n+\n+    # makes sure stale tip check / extra peer eviction is run\n+    SCHEDULE_EXTRA_PEER_CHECK = 46\n+    # chosen large enough that EXTRA_NETWORK_PEER_INTERVAL and EXTRA_BLOCK_RELAY_ONLY_PEER_INTERVAL\n+    # which are on exponential 5min timers, will hit with very high probability\n+    MOCKTIME_BUMP = 5000\n+\n+    def set_test_params(self):\n+        self.auto_outbound_mode = True\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-test=addrman\", \"-cjdnsreachable\"]]\n+\n+    def all_sync_send_with_ping(self, peers):\n+        \"\"\"Send a ping to all connected peers and wait for pongs.\"\"\"\n+        for p in peers:\n+            node = p[\"node\"]\n+            if node.is_connected:\n+                node.sync_with_ping()\n+\n+    def has_regular_outbounds(self, node):\n+        \"\"\"Check if we have 8 full outbound and 2 block-relay-only connections.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        block_relay = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(full_outbound) == 8 and len(block_relay) == 2\n+\n+    def has_extra_block_relay_peer(self, node):\n+        \"\"\"Check if we have more than 2 block-relay-only peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        return len(block_relay_peers) > 2\n+\n+    def has_extra_full_outbound_peer(self, node):\n+        \"\"\"Check if we have more than 8 full outbound peers.\"\"\"\n+        peer_info = node.getpeerinfo()\n+        full_outbound = [p for p in peer_info if p['connection_type'] == 'outbound-full-relay']\n+        return len(full_outbound) > 8\n+\n+    def disconnect_last_block_relay_peer(self):\n+        \"\"\"Find and disconnect the most recently connected block-relay-only peer.\n+           Done manually instead of waiting for the node to disconnect automatically to\n+           avoid rare interactions with the scheduling of the next extra block-relay-only peer\"\"\"\n+        node = self.nodes[0]\n+        peer_info = node.getpeerinfo()\n+        block_relay_peers = [p for p in peer_info if p['connection_type'] == 'block-relay-only']\n+        assert block_relay_peers\n+        # Disconnect the peer with the highest id\n+        last_peer = max(block_relay_peers, key=lambda p: p['id'])\n+        node.disconnectnode(nodeid=last_peer['id'])\n+\n+    def wait_for_network_specific_peer(self):\n+        \"\"\"Advance time, wait for a network-specific full outbound peer, and trigger eviction.\n+\n+        Extra block-relay-only connections are prioritized over network-specific ones, but defensively:\n+        if an already connected tor or cjdns address is picked, there is no retry. This can cause either\n+        type of peer to arrive first.\n+        \"\"\"",
      "path": "test/functional/p2p_outbound_management.py",
      "position": 89,
      "original_position": 89,
      "commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "original_commit_id": "0cb08573f38b7aa8a18147eef1a775b6c24bcb7c",
      "in_reply_to_id": null,
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Is it possible that the node already has at least one connection to all reachable networks when this function starts? Would that result in timeouts due to `has_extra_full_outbound_peer(node)` never returning `True`?",
      "created_at": "2026-01-09T10:30:35Z",
      "updated_at": "2026-01-09T10:44:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33954#discussion_r2675662381",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2675662381"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33954"
        }
      },
      "start_line": 83,
      "original_start_line": 83,
      "start_side": "RIGHT",
      "line": 89,
      "original_line": 89,
      "side": "RIGHT"
    }
  ]
}
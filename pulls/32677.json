{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677",
    "id": 2564943013,
    "node_id": "PR_kwDOABII586Y4eyl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32677",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32677.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32677.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/bff80f59bd8f4d7176f70eab6ad7086ca869a120",
    "number": 32677,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "test: headers sync timeout",
    "user": {
      "login": "stringintech",
      "id": 157148846,
      "node_id": "U_kgDOCV3mrg",
      "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stringintech",
      "html_url": "https://github.com/stringintech",
      "followers_url": "https://api.github.com/users/stringintech/followers",
      "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
      "organizations_url": "https://api.github.com/users/stringintech/orgs",
      "repos_url": "https://api.github.com/users/stringintech/repos",
      "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/stringintech/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "When reviewing PR #32051 and considering which functional tests might need to be adapted/extended accordingly, I noticed there appears to be limited functional test coverage for header sync timeouts and thought it might be helpful to add one.\r\n\r\nThis test attempts to cover two scenarios:\r\n\r\n1. **Normal peer timeout behavior:** When a peer fails to respond to initial getheaders requests within the timeout period, it should be disconnected and the node should attempt to sync headers from the next available peer.\r\n\r\n2. **Noban peer behavior:** When a peer with noban privileges times out, it should remain connected while the node still attempts to sync headers from other peers.\r\n",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2025-06-03T18:50:04Z",
    "updated_at": "2025-06-21T04:58:13Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "78729ce1372c152fbe6dde4ce56f69ebcee2ca20",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "stringintech:2025/06/test-header-sync-timeout",
      "ref": "2025/06/test-header-sync-timeout",
      "sha": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 933192994,
        "node_id": "R_kgDON59lIg",
        "name": "bitcoin",
        "full_name": "stringintech/bitcoin",
        "owner": {
          "login": "stringintech",
          "id": 157148846,
          "node_id": "U_kgDOCV3mrg",
          "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/stringintech",
          "html_url": "https://github.com/stringintech",
          "followers_url": "https://api.github.com/users/stringintech/followers",
          "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
          "organizations_url": "https://api.github.com/users/stringintech/orgs",
          "repos_url": "https://api.github.com/users/stringintech/repos",
          "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/stringintech/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/stringintech/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/stringintech/bitcoin",
        "archive_url": "https://api.github.com/repos/stringintech/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/stringintech/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/stringintech/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/stringintech/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/stringintech/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/stringintech/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/stringintech/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/stringintech/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/stringintech/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/stringintech/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/stringintech/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/stringintech/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/stringintech/bitcoin/events",
        "forks_url": "https://api.github.com/repos/stringintech/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/stringintech/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/stringintech/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/stringintech/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/stringintech/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/stringintech/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/stringintech/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/stringintech/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/stringintech/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/stringintech/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/stringintech/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/stringintech/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/stringintech/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/stringintech/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/stringintech/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/stringintech/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:stringintech/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/stringintech/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/stringintech/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/stringintech/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/stringintech/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/stringintech/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/stringintech/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/stringintech/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/stringintech/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/stringintech/bitcoin/hooks",
        "svn_url": "https://github.com/stringintech/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 241103,
        "default_branch": "master",
        "open_issues_count": 9,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-21T04:58:48Z",
        "created_at": "2025-02-15T11:29:00Z",
        "updated_at": "2025-06-03T18:20:27Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "1473f69924bc9a68ec1416e30aad5ac068e551b0",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37404,
        "stargazers_count": 84254,
        "watchers_count": 84254,
        "size": 284330,
        "default_branch": "master",
        "open_issues_count": 754,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-20T23:30:50Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-06-21T04:50:43Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 151,
    "deletions": 23,
    "changed_files": 1,
    "commits": 1,
    "review_comments": 9,
    "comments": 5
  },
  "events": [
    {
      "event": "commented",
      "id": 2936730011,
      "node_id": "IC_kwDOABII586vCvGb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2936730011",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-03T18:50:07Z",
      "updated_at": "2025-06-17T14:37:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32677.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [yuvicc](https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2948079431), [mzumsande](https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2908751605), [Prabhat1308](https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2935249487) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2936730011",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677"
    },
    {
      "event": "labeled",
      "id": 17965592262,
      "node_id": "LE_lADOABII5865rEj7zwAAAAQu1S7G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17965592262",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-03T18:50:17Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 17966561471,
      "node_id": "HRFPE_lADOABII5865rEj7zwAAAAQu4_i_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17966561471",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "commit_url": "https://api.github.com/repos/stringintech/bitcoin/commits/16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "created_at": "2025-06-03T19:42:46Z"
    },
    {
      "event": "labeled",
      "id": 17966564112,
      "node_id": "LE_lADOABII5865rEj7zwAAAAQu5AMQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17966564112",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-03T19:42:53Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 17968327779,
      "node_id": "UNLE_lADOABII5865rEj7zwAAAAQu_uxj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17968327779",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-03T21:40:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2948079431,
      "node_id": "IC_kwDOABII586vuB9H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2948079431",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-06T04:53:16Z",
      "updated_at": "2025-06-06T04:53:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nGreat observation and thanks for adding. I was thinking if we could add this timeout test in [`p2p_initial_headers_sync.py`](https://github.com/bitcoin/bitcoin/blob/master/test/functional/p2p_initial_headers_sync.py) instead of creating another one. ",
      "user": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2948079431",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677"
    },
    {
      "event": "unsubscribed",
      "id": 18016728023,
      "node_id": "UE_lADOABII5865rEj7zwAAAAQx4XPX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18016728023",
      "actor": {
        "login": "deehochberg",
        "id": 185879065,
        "node_id": "U_kgDOCxRKGQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/185879065?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/deehochberg",
        "html_url": "https://github.com/deehochberg",
        "followers_url": "https://api.github.com/users/deehochberg/followers",
        "following_url": "https://api.github.com/users/deehochberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/deehochberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/deehochberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/deehochberg/subscriptions",
        "organizations_url": "https://api.github.com/users/deehochberg/orgs",
        "repos_url": "https://api.github.com/users/deehochberg/repos",
        "events_url": "https://api.github.com/users/deehochberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/deehochberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-06T05:32:39Z"
    },
    {
      "event": "commented",
      "id": 2952919063,
      "node_id": "IC_kwDOABII586wAfgX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2952919063",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-07T19:28:54Z",
      "updated_at": "2025-06-07T19:29:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I was thinking if we could add this timeout test in [`p2p_initial_headers_sync.py`](https://github.com/bitcoin/bitcoin/blob/master/test/functional/p2p_initial_headers_sync.py) instead of creating another one.\r\n\r\n@yuvicc Actually, I did not consider that. However, now that I am thinking about it, the two sub-tests in the new test file share some context that is not used by the test file you mentioned. So, I think it is cleaner to keep them separate, especially if it will be extended to test the addnode peers as well (like [here](https://github.com/stringintech/bitcoin/commit/02f4bec94db6db81b2885646312219ddabf82270#diff-8ba81fc6003c09eec6425cd72ae7384e982dde0a7a5ca12a9a9349a41879df95)). But I will be thinking more about it while waiting for other feedback.",
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2952919063",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677"
    },
    {
      "event": "mentioned",
      "id": 18038571695,
      "node_id": "MEE_lADOABII5865rEj7zwAAAAQzLsKv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18038571695",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-07T19:28:54Z"
    },
    {
      "event": "subscribed",
      "id": 18038571699,
      "node_id": "SE_lADOABII5865rEj7zwAAAAQzLsKz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18038571699",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-07T19:28:54Z"
    },
    {
      "event": "reviewed",
      "id": 2908751605,
      "node_id": "PRR_kwDOABII586tYAb1",
      "url": null,
      "actor": null,
      "commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK.\r\nDidn't read the above, but I also thought it might be better to add the additional tests to `p2p_initial_headers_sync.py` - after all, this is not a particularly long test.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2908751605",
      "submitted_at": "2025-06-09T02:07:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJmZjgwZjU5YmQ4ZjRkNzE3NmY3MGVhYjZhZDcwODZjYTg2OWExMjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "tree": {
        "sha": "e87a0284dc4858f72543f3f64c2dc5ca534ef1b9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e87a0284dc4858f72543f3f64c2dc5ca534ef1b9"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e872a566f251c73908de8b6d243c94a6679c2eac",
          "sha": "e872a566f251c73908de8b6d243c94a6679c2eac",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e872a566f251c73908de8b6d243c94a6679c2eac"
        }
      ],
      "message": "test: headers sync timeout",
      "committer": {
        "name": "stringintech",
        "email": "stringintech@gmail.com",
        "date": "2025-06-11T21:29:45Z"
      },
      "author": {
        "name": "stringintech",
        "email": "stringintech@gmail.com",
        "date": "2025-06-11T21:07:09Z"
      },
      "sha": "bff80f59bd8f4d7176f70eab6ad7086ca869a120"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18102191824,
      "node_id": "HRFPE_lADOABII5865rEj7zwAAAAQ2-YbQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18102191824",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "commit_url": "https://api.github.com/repos/stringintech/bitcoin/commits/bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "created_at": "2025-06-11T21:31:19Z"
    },
    {
      "event": "commented",
      "id": 2964373635,
      "node_id": "IC_kwDOABII586wsMCD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2964373635",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T21:45:54Z",
      "updated_at": "2025-06-11T21:45:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "16a62fa to bff80f5 - Addressed feedback by @mzumsande and @yuvicc; Thanks!",
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2964373635",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677"
    },
    {
      "event": "mentioned",
      "id": 18102356379,
      "node_id": "MEE_lADOABII5865rEj7zwAAAAQ2_Amb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18102356379",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T21:45:55Z"
    },
    {
      "event": "subscribed",
      "id": 18102356400,
      "node_id": "SE_lADOABII5865rEj7zwAAAAQ2_Amw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18102356400",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T21:45:55Z"
    },
    {
      "event": "mentioned",
      "id": 18102356419,
      "node_id": "MEE_lADOABII5865rEj7zwAAAAQ2_AnD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18102356419",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T21:45:56Z"
    },
    {
      "event": "subscribed",
      "id": 18102356434,
      "node_id": "SE_lADOABII5865rEj7zwAAAAQ2_AnS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18102356434",
      "actor": {
        "login": "yuvicc",
        "id": 92994932,
        "node_id": "U_kgDOBYr9dA",
        "avatar_url": "https://avatars.githubusercontent.com/u/92994932?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yuvicc",
        "html_url": "https://github.com/yuvicc",
        "followers_url": "https://api.github.com/users/yuvicc/followers",
        "following_url": "https://api.github.com/users/yuvicc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/yuvicc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/yuvicc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/yuvicc/subscriptions",
        "organizations_url": "https://api.github.com/users/yuvicc/orgs",
        "repos_url": "https://api.github.com/users/yuvicc/repos",
        "events_url": "https://api.github.com/users/yuvicc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/yuvicc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-11T21:45:56Z"
    },
    {
      "event": "reviewed",
      "id": 2935249487,
      "node_id": "PRR_kwDOABII586u9FpP",
      "url": null,
      "actor": null,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK . left a nit",
      "user": {
        "login": "Prabhat1308",
        "id": 94048855,
        "node_id": "U_kgDOBZsSVw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94048855?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Prabhat1308",
        "html_url": "https://github.com/Prabhat1308",
        "followers_url": "https://api.github.com/users/Prabhat1308/followers",
        "following_url": "https://api.github.com/users/Prabhat1308/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Prabhat1308/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Prabhat1308/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Prabhat1308/subscriptions",
        "organizations_url": "https://api.github.com/users/Prabhat1308/orgs",
        "repos_url": "https://api.github.com/users/Prabhat1308/repos",
        "events_url": "https://api.github.com/users/Prabhat1308/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Prabhat1308/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2935249487",
      "submitted_at": "2025-06-17T14:37:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
    },
    {
      "event": "reviewed",
      "id": 2937247646,
      "node_id": "PRR_kwDOABII586vEtee",
      "url": null,
      "actor": null,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2937247646",
      "submitted_at": "2025-06-17T22:30:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
    },
    {
      "event": "convert_to_draft",
      "id": 18206940873,
      "node_id": "CTDE_lADOABII5865rEj7zwAAAAQ9N97J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18206940873",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T09:47:19Z"
    },
    {
      "event": "commented",
      "id": 2983506139,
      "node_id": "IC_kwDOABII586x1LDb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2983506139",
      "actor": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T09:48:09Z",
      "updated_at": "2025-06-18T09:48:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "Drafted to address the issue explained [here](https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2153287651) and the new comments.",
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2983506139",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32677"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2134912428",
      "pull_request_review_id": 2908751605,
      "id": 2134912428,
      "node_id": "PRRC_kwDOABII585_QC2s",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 83,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this seems unnecessary, `add_outbound_p2p_connection` already has a built-in wait for the `verack`.",
      "created_at": "2025-06-09T01:43:52Z",
      "updated_at": "2025-06-09T02:07:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2134912428",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2134912428"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2134916035",
      "pull_request_review_id": 2908751605,
      "id": 2134916035,
      "node_id": "PRRC_kwDOABII585_QDvD",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():\n+            # This peer has to be outbound otherwise the stalling peer is\n+            # protected from disconnection\n+            self.peer2 = self.node.add_outbound_p2p_connection(\n+                P2PInterface(), p2p_idx=1,\n+                connection_type=\"outbound-full-relay\")\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+    def trigger_timeout(self):\n+        self.log.info(\"Trigger the headers download timeout by advancing \"\n+                      \"mock time\")\n+        best_header_time = self.node.getblockchaininfo()['time']",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 94,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This doesn't return the timestamp of the best header, but the time of the tip (which is still at genesis, after all headers up to minchainwork have been downloaded but no blocks connected). As far as I know (didn't check) we don't expose `m_chainman.m_best_header->Time()` via RPC, so to test the dynamic part in a functional test we would have to check the actual timestamps of the headers we sent the node, instead of using getblockchaininfo. ",
      "created_at": "2025-06-09T01:51:06Z",
      "updated_at": "2025-06-09T02:09:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2134916035",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2134916035"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 94,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141160283",
      "pull_request_review_id": 2918813952,
      "id": 2141160283,
      "node_id": "PRRC_kwDOABII585_n4Nb",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():\n+            # This peer has to be outbound otherwise the stalling peer is\n+            # protected from disconnection\n+            self.peer2 = self.node.add_outbound_p2p_connection(\n+                P2PInterface(), p2p_idx=1,\n+                connection_type=\"outbound-full-relay\")\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+    def trigger_timeout(self):\n+        self.log.info(\"Trigger the headers download timeout by advancing \"\n+                      \"mock time\")\n+        best_header_time = self.node.getblockchaininfo()['time']",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 94,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": 2134916035,
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I used `getblockchaininfo()['time']` because we hadn't sent the node any headers yet, so I relied on the assumption that the best header should still be at genesis with the genesis block time (which I should have commented better).\r\nBut I agree with your suggestion as it is more direct and I have applied it - I appreciate your further feedback on it.",
      "created_at": "2025-06-11T21:39:47Z",
      "updated_at": "2025-06-11T21:39:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2141160283",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141160283"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 94,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2152014769",
      "pull_request_review_id": 2935249487,
      "id": 2152014769,
      "node_id": "PRRC_kwDOABII586ARSOx",
      "diff_hunk": "@@ -1,18 +1,27 @@\n #!/usr/bin/env python3\n-# Copyright (c) 2022 The Bitcoin Core developers\n+# Copyright (c) 2022-2025 The Bitcoin Core developers",
      "path": "test/functional/p2p_initial_headers_sync.py",
      "position": 3,
      "original_position": 3,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "in_reply_to_id": null,
      "user": {
        "login": "Prabhat1308",
        "id": 94048855,
        "node_id": "U_kgDOBZsSVw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94048855?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Prabhat1308",
        "html_url": "https://github.com/Prabhat1308",
        "followers_url": "https://api.github.com/users/Prabhat1308/followers",
        "following_url": "https://api.github.com/users/Prabhat1308/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Prabhat1308/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Prabhat1308/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Prabhat1308/subscriptions",
        "organizations_url": "https://api.github.com/users/Prabhat1308/orgs",
        "repos_url": "https://api.github.com/users/Prabhat1308/repos",
        "events_url": "https://api.github.com/users/Prabhat1308/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Prabhat1308/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Would be better to do 2022-Present",
      "created_at": "2025-06-17T11:22:45Z",
      "updated_at": "2025-06-17T14:37:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2152014769",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2152014769"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2,
      "original_line": 2,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153275109",
      "pull_request_review_id": 2937247646,
      "id": 2153275109,
      "node_id": "PRRC_kwDOABII586AWF7l",
      "diff_hunk": "@@ -66,35 +92,137 @@ def run_test(self):\n \n         self.log.info(\"Check that peer1 receives a getheaders in response\")\n         peer1.wait_for_getheaders(block_hash=best_block_hash)\n-        peer1.send_without_ping(msg_headers()) # Send empty response, see above\n-\n-        self.log.info(\"Check that exactly 1 of {peer2, peer3} received a getheaders in response\")\n-        count = 0\n-        peer_receiving_getheaders = None\n-        for p in [peer2, peer3]:\n-            with p2p_lock:\n-                if \"getheaders\" in p.last_message:\n-                    count += 1\n-                    peer_receiving_getheaders = p\n-                    p.send_without_ping(msg_headers()) # Send empty response, see above\n+        # Send empty response, see above\n+        peer1.send_without_ping(msg_headers())\n \n-        assert_equal(count, 1)\n+        self.log.info(",
      "path": "test/functional/p2p_initial_headers_sync.py",
      "position": 99,
      "original_position": 99,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think it would be good to drop the formatting changes to code you don't change for easier review. Some linters such as flake8 will suggest a 80 character limit, but that is not usually followed here - there will be longer lines in almost every functional test (it's fine to respect in the added code if you want).",
      "created_at": "2025-06-17T22:30:42Z",
      "updated_at": "2025-06-17T22:30:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2153275109",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153275109"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 98,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153287651",
      "pull_request_review_id": 2937265151,
      "id": 2153287651,
      "node_id": "PRRC_kwDOABII586AWI_j",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():\n+            # This peer has to be outbound otherwise the stalling peer is\n+            # protected from disconnection\n+            self.peer2 = self.node.add_outbound_p2p_connection(\n+                P2PInterface(), p2p_idx=1,\n+                connection_type=\"outbound-full-relay\")\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+    def trigger_timeout(self):\n+        self.log.info(\"Trigger the headers download timeout by advancing \"\n+                      \"mock time\")\n+        best_header_time = self.node.getblockchaininfo()['time']",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 94,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": 2134916035,
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "@mzumsande I just reviewed the code again and found an issue with how I implemented your suggestion. The problem is that `self.send_new_block(peer1)` gets called _**after**_ the headers sync timeout for peer1 has already been calculated. During peer setup, the timeout calculation uses the genesis block time as the best header time, not the new block's header time that gets set later. So I need to make additional changes to fix this timing issue.",
      "created_at": "2025-06-17T22:44:56Z",
      "updated_at": "2025-06-18T09:55:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2153287651",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153287651"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 94,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2154894242",
      "pull_request_review_id": 2939695340,
      "id": 2154894242,
      "node_id": "PRRC_kwDOABII586AcROi",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():\n+            # This peer has to be outbound otherwise the stalling peer is\n+            # protected from disconnection\n+            self.peer2 = self.node.add_outbound_p2p_connection(\n+                P2PInterface(), p2p_idx=1,\n+                connection_type=\"outbound-full-relay\")\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+    def trigger_timeout(self):\n+        self.log.info(\"Trigger the headers download timeout by advancing \"\n+                      \"mock time\")\n+        best_header_time = self.node.getblockchaininfo()['time']",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 94,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": 2134916035,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I looked at this again, and I think the original approach is fine - I think I was confused by something in my original comment, sorry!\r\nJust adding a comment that the genesis block time is the best header time in this case (because we didn't receive any headers from peers) should be sufficient - no need to send a block.\r\n\r\nIt could be good though to run the timeout tests at the beginning of `p2p_initial_headers_sync`, before the `test_initial_headers_sync` subtest (which does send headers).",
      "created_at": "2025-06-18T15:19:45Z",
      "updated_at": "2025-06-18T15:44:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2154894242",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2154894242"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 94,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159867263",
      "pull_request_review_id": 2947567868,
      "id": 2159867263,
      "node_id": "PRRC_kwDOABII586AvPV_",
      "diff_hunk": "@@ -0,0 +1,111 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test peer timeout during initial headers sync.\n+Tests normal peer disconnection vs noban peer behavior.\"\"\"\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PInterface,\n+)\n+from test_framework.util import assert_equal\n+import time\n+\n+HEADERS_SYNC_BASE_TIMEOUT_SEC = 900  # 15 minutes\n+HEADERS_PER_HEADER_TIMEOUT_US = 1000  # 1 millisecond\n+POW_TARGET_SPACING_SEC = 600  # 10 minutes\n+\n+\n+class HeadersSyncTimeoutTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.setup_clean_chain = True\n+        self.num_nodes = 1\n+        self.peer1 = None\n+        self.peer2 = None\n+\n+    def run_test(self):\n+        self.node = self.nodes[0]\n+\n+        self.test_normal_peer_timeout()\n+        self.test_noban_peer_timeout()\n+\n+    def test_normal_peer_timeout(self):\n+        self.log.info(\"Test peer disconnection on header timeout\")\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers, disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that stalling peer1 is disconnected\")\n+        self.peer1.wait_for_disconnect()\n+        assert_equal(self.node.num_test_p2p_connections(), 1)\n+\n+        self.log.info(\"Check that peer2 receives a getheader request\")\n+        self.peer2.wait_for_getheaders()\n+\n+    def test_noban_peer_timeout(self):\n+        self.log.info(\"Test noban peer on header timeout\")\n+        self.restart_node(0, extra_args=['-whitelist=noban@127.0.0.1'])\n+        self.node.setmocktime(int(time.time()))\n+        self.setup_peers()\n+\n+        with self.node.assert_debug_log(\n+                [\"Timeout downloading headers from noban peer, \"\n+                 \"not disconnecting peer=0\"]):\n+            self.trigger_timeout()\n+\n+        self.log.info(\"Check that noban peer1 is not disconnected\")\n+        self.peer1.sync_with_ping()\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+        self.log.info(\"Check that exactly 1 of {peer1, peer2} receives a \"\n+                      \"getheaders\")\n+        count = 0\n+        for p in [self.peer1, self.peer2]:\n+            with p2p_lock:\n+                if \"getheaders\" in p.last_message:\n+                    count += 1\n+        assert_equal(count, 1)\n+\n+    def setup_peers(self):\n+        self.log.info(\"Add peer1 and check it receives an initial \"\n+                      \"getheaders request\")\n+        with self.node.assert_debug_log(\n+                expected_msgs=[\"initial getheaders (0) to peer=0\"]):\n+            self.peer1 = self.node.add_p2p_connection(P2PInterface())\n+        self.peer1.wait_for_getheaders()\n+\n+        self.log.info(\"Add outbound peer2\")\n+        with self.node.wait_for_new_peer():\n+            # This peer has to be outbound otherwise the stalling peer is\n+            # protected from disconnection\n+            self.peer2 = self.node.add_outbound_p2p_connection(\n+                P2PInterface(), p2p_idx=1,\n+                connection_type=\"outbound-full-relay\")\n+        assert_equal(self.node.num_test_p2p_connections(), 2)\n+\n+    def trigger_timeout(self):\n+        self.log.info(\"Trigger the headers download timeout by advancing \"\n+                      \"mock time\")\n+        best_header_time = self.node.getblockchaininfo()['time']",
      "path": "test/functional/p2p_initial_headers_sync_timeout.py",
      "position": null,
      "original_position": 94,
      "commit_id": "bff80f59bd8f4d7176f70eab6ad7086ca869a120",
      "original_commit_id": "16a62fa881b1610d71402ef6b27bcdf2288a3297",
      "in_reply_to_id": 2134916035,
      "user": {
        "login": "stringintech",
        "id": 157148846,
        "node_id": "U_kgDOCV3mrg",
        "avatar_url": "https://avatars.githubusercontent.com/u/157148846?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stringintech",
        "html_url": "https://github.com/stringintech",
        "followers_url": "https://api.github.com/users/stringintech/followers",
        "following_url": "https://api.github.com/users/stringintech/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stringintech/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stringintech/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stringintech/subscriptions",
        "organizations_url": "https://api.github.com/users/stringintech/orgs",
        "repos_url": "https://api.github.com/users/stringintech/repos",
        "events_url": "https://api.github.com/users/stringintech/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stringintech/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks for looking into this further. I fixed the timing issue I mentioned earlier, but while reviewing it, I started to question how much value sending a new header/block actually adds to the test. Iâ€™ll revert it to use the genesis block time as the best header time and add the comment.\r\n\r\nBut does changing the order of the subtests actually matter, given that the `test_initial_headers_sync` subtest sends no actual headers?",
      "created_at": "2025-06-21T04:58:13Z",
      "updated_at": "2025-06-21T04:58:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2159867263",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2159867263"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32677"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 94,
      "side": "RIGHT"
    }
  ]
}
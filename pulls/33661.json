{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661",
    "id": 2929620815,
    "node_id": "PR_kwDOABII586unndP",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33661",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33661.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33661.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0f6b58ba9a2989feac6292e74e2d721e35492051",
    "number": 33661,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "test: Add test on skip heights in CBlockIndex",
    "user": {
      "login": "optout21",
      "id": 13562139,
      "node_id": "MDQ6VXNlcjEzNTYyMTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/optout21",
      "html_url": "https://github.com/optout21",
      "followers_url": "https://api.github.com/users/optout21/followers",
      "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
      "organizations_url": "https://api.github.com/users/optout21/orgs",
      "repos_url": "https://api.github.com/users/optout21/repos",
      "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/optout21/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "The skip height values, used by `CBlockIndex::BuildSkip()` and `GetSkipHeight()` are not tested directly and not well documented. Indirect tests, through `GetAncestor()` exist in `skiplist_tests.cpp`. (This was noticed while reviewing #33515, recently merged.)\r\n\r\nThe motivation is to document the skip value computation through a test.\r\n\r\nThe first commit adds a test for the number of steps needed for an ancestor search, the number should be much lower than the linear distance.\r\n\r\nThe next commits add low-level tests to the `GetSkipHeight()` method. The previously internal method is exposed first.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2025-10-20T12:08:37Z",
    "updated_at": "2026-02-15T07:54:20Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "85cd8b05d1aef92b4ccd6d825a4335b1506d3f1a",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "optout21:skip-height-test2",
      "ref": "skip-height-test2",
      "sha": "0f6b58ba9a2989feac6292e74e2d721e35492051",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1072154294,
        "node_id": "R_kgDOP-fGtg",
        "name": "bitcoin",
        "full_name": "optout21/bitcoin",
        "owner": {
          "login": "optout21",
          "id": 13562139,
          "node_id": "MDQ6VXNlcjEzNTYyMTM5",
          "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/optout21",
          "html_url": "https://github.com/optout21",
          "followers_url": "https://api.github.com/users/optout21/followers",
          "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
          "organizations_url": "https://api.github.com/users/optout21/orgs",
          "repos_url": "https://api.github.com/users/optout21/repos",
          "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/optout21/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/optout21/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/optout21/bitcoin",
        "archive_url": "https://api.github.com/repos/optout21/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/optout21/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/optout21/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/optout21/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/optout21/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/optout21/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/optout21/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/optout21/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/optout21/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/optout21/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/optout21/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/optout21/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/optout21/bitcoin/events",
        "forks_url": "https://api.github.com/repos/optout21/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/optout21/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/optout21/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/optout21/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/optout21/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/optout21/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/optout21/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/optout21/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/optout21/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/optout21/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/optout21/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/optout21/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/optout21/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/optout21/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/optout21/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/optout21/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:optout21/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/optout21/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/optout21/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/optout21/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/optout21/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/optout21/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/optout21/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/optout21/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/optout21/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/optout21/bitcoin/hooks",
        "svn_url": "https://github.com/optout21/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 259629,
        "default_branch": "master",
        "open_issues_count": 1,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": true,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-15T07:49:01Z",
        "created_at": "2025-10-08T10:33:29Z",
        "updated_at": "2026-01-26T12:16:14Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "b65ff0e5a1fd4ea2ae75e204729b8008c4ebb9ab",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38905,
        "stargazers_count": 88124,
        "watchers_count": 88124,
        "size": 303672,
        "default_branch": "master",
        "open_issues_count": 736,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-02-13T14:32:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-02-15T07:39:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 144,
    "deletions": 1,
    "changed_files": 3,
    "commits": 3,
    "review_comments": 151,
    "comments": 36
  },
  "events": [
    {
      "event": "labeled",
      "id": 20378762485,
      "node_id": "LE_lADOABII587SiRz0zwAAAAS-qzz1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20378762485",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-20T12:08:41Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 3421799444,
      "node_id": "IC_kwDOABII587L9IQU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3421799444",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-20T12:08:43Z",
      "updated_at": "2026-02-15T07:49:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33661.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Approach ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3646732825) |\n| Stale ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3901919314) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3421799444",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20378870736,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAS-rOPQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20378870736",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/6a22013f5aae2312a4a67b78773108a72146bdc7",
      "created_at": "2025-10-20T12:15:02Z"
    },
    {
      "event": "commented",
      "id": 3423668761,
      "node_id": "IC_kwDOABII587MEQoZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3423668761",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-20T20:48:08Z",
      "updated_at": "2025-10-20T20:48:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, thanks for helping with the coverage and documentation.\r\nFor reference https://maflcko.github.io/b-c-cov/test_bitcoin.coverage/src/chain.cpp.gcov.html is pretty well covered otherwise, but these tests can help with the specifics.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3423668761",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3425525600,
      "node_id": "IC_kwDOABII587MLV9g",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3425525600",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-21T09:04:10Z",
      "updated_at": "2025-10-21T09:04:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "> For reference https://maflcko.github.io/b-c-cov/test_bitcoin.coverage/src/chain.cpp.gcov.html is pretty well covered otherwise, but these tests can help with the specifics.\r\n\r\nThanks for the link! Indirectly it is tested extensively, as the skip mechanism is used while searching in the chain. However, there are no tests focusing on this specifically, and the why and how on the exact skip generation algorithm is not documented.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3425525600",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "ready_for_review",
      "id": 20620945396,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAATNGqf0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20620945396",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-10-30T22:27:53Z"
    },
    {
      "event": "reviewed",
      "id": 3407000419,
      "node_id": "PRR_kwDOABII587LErNj",
      "url": null,
      "actor": null,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-03T12:33:45Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, during review I also understood this behavior better :)\r\nI have a few suggestions for simplification and am throwing you into the deep end by asking for a property based (fuzz) test as well to check certain invariants. Not a must-have, but seems simple enough. I also suggest simplifying the distribution test to just check for the median instead.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3407000419",
      "submitted_at": "2025-11-03T12:33:05Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20676996208,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAATQcexw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20676996208",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "created_at": "2025-11-03T14:56:04Z"
    },
    {
      "event": "commented",
      "id": 3480999335,
      "node_id": "IC_kwDOABII587Pe9Wn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3480999335",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T15:02:19Z",
      "updated_at": "2025-11-03T15:02:19Z",
      "author_association": "CONTRIBUTOR",
      "body": "Review comments addressed, mostly minor:\r\n\r\n- Reduce the number of iterations to 10000 (from 30000), for faster test execution.\r\n- Add comments on choice of test inputs.\r\n- Use BOOST_REQUIRE_EQUAL or BOOST_CHECK_GT where possible.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3480999335",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3481005723,
      "node_id": "IC_kwDOABII587Pe-6b",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3481005723",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T15:03:47Z",
      "updated_at": "2025-11-03T15:03:47Z",
      "author_association": "CONTRIBUTOR",
      "body": "@sipa, as this is triggered by #33515 of yours, I would kindly ask for a review.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3481005723",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 20677187785,
      "node_id": "MEE_lADOABII587SiRz0zwAAAATQdNjJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20677187785",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T15:03:48Z"
    },
    {
      "event": "subscribed",
      "id": 20677187811,
      "node_id": "SE_lADOABII587SiRz0zwAAAATQdNjj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20677187811",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T15:03:48Z"
    },
    {
      "event": "review_requested",
      "id": 20677932786,
      "node_id": "RRE_lADOABII587SiRz0zwAAAATQgDby",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20677932786",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-03T15:32:31Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20696757049,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAATRn3M5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20696757049",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "fcf9c443d83c30bb2a073b4c1fd07f2f0ec4c8ce",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/fcf9c443d83c30bb2a073b4c1fd07f2f0ec4c8ce",
      "created_at": "2025-11-04T09:35:00Z"
    },
    {
      "event": "commented",
      "id": 3484908644,
      "node_id": "IC_kwDOABII587Pt3xk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3484908644",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-04T09:38:26Z",
      "updated_at": "2025-11-04T09:49:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "Changes applied:\r\n- Fix lint issue\r\n- Added check on the median as well\r\n- some minor formatting\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3484908644",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20701441354,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAATR5u1K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20701441354",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "created_at": "2025-11-04T12:23:57Z"
    },
    {
      "event": "commented",
      "id": 3485734385,
      "node_id": "IC_kwDOABII587PxBXx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3485734385",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-04T12:26:28Z",
      "updated_at": "2025-11-04T12:26:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "CI failed, limits of the 3rd for cycle were off; fixed\r\n\r\n```diff\r\n     int count_diff_smaller_16 = 0;\r\n     int max_diff = 0;\r\n     int total_diff = 0;\r\n-    for(int i{1}; i < n; ++i) {\r\n+    for(size_t i{0}; i < skip_diffs.size(); ++i) {\r\n         auto diff = skip_diffs[i];\r\n         if (diff < 16) {\r\n             ++count_diff_smaller_16;\r\n```",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3485734385",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "reviewed",
      "id": 3416668206,
      "node_id": "PRR_kwDOABII587Lpjgu",
      "url": null,
      "actor": null,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-04T14:06:51Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3416668206",
      "submitted_at": "2025-11-04T14:06:51Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "reviewed",
      "id": 3416721752,
      "node_id": "PRR_kwDOABII587LpwlY",
      "url": null,
      "actor": null,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-04T14:15:58Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3416721752",
      "submitted_at": "2025-11-04T14:15:58Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "reviewed",
      "id": 3416731921,
      "node_id": "PRR_kwDOABII587LpzER",
      "url": null,
      "actor": null,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-04T14:17:49Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3416731921",
      "submitted_at": "2025-11-04T14:17:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20760799205,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAATVcKfl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20760799205",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "created_at": "2025-11-06T13:58:50Z"
    },
    {
      "event": "commented",
      "id": 3497405231,
      "node_id": "IC_kwDOABII587Qdisv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3497405231",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-06T14:01:26Z",
      "updated_at": "2025-11-06T14:01:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "Pushed minor fixes after comments:\r\n- simplify test assertions\r\n- simplify computing of total/avg and max (no for loop)\r\n- formatting\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3497405231",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "reviewed",
      "id": 3428711246,
      "node_id": "PRR_kwDOABII587MXftO",
      "url": null,
      "actor": null,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-11-06T15:14:43Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK ea998e18f6d64f485d4e2d85a1028474fb35120a\n\nThanks for taking my suggestion, the code is very clean and easy to understand now.\nI left some nits I still saw, but they're not blocking.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3428711246",
      "submitted_at": "2025-11-06T15:14:43Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20943516605,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAATgVLO9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20943516605",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "02df44465218a49cc488fd50bf05ab2fd203c69c",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/02df44465218a49cc488fd50bf05ab2fd203c69c",
      "created_at": "2025-11-14T13:23:44Z"
    },
    {
      "event": "commented",
      "id": 3532765861,
      "node_id": "IC_kwDOABII587Skbql",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3532765861",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-14T13:24:50Z",
      "updated_at": "2025-11-15T16:19:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "Minor nits applied\r\n\r\n<details>\r\n<summary>git diff ea998e18f6d64f485d4e2d85a1028474fb35120a e2e25f4947e65869b014483be70b764a62bd0df7\r\n</summary>\r\n\r\n```diff\r\n@@ -114,7 +114,7 @@ BOOST_AUTO_TEST_CASE(skip_height_properties_test)\r\n     for(int i{1}; i < n; ++i) {\r\n         auto new_index = std::make_unique<CBlockIndex>();\r\n         new_index->pprev = block_index.back().get();\r\n-        BOOST_CHECK(new_index->pprev);\r\n+        BOOST_REQUIRE(new_index->pprev);\r\n         new_index->nHeight = new_index->pprev->nHeight + 1;\r\n         new_index->BuildSkip();\r\n         block_index.push_back(std::move(new_index));\r\n@@ -131,16 +131,12 @@ BOOST_AUTO_TEST_CASE(skip_height_properties_test)\r\n     }\r\n \r\n     // Analyze the diffs\r\n-    // Compute the average\r\n-    const auto avg = double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / double(skip_diffs.size());\r\n-    // Compute the median\r\n+    // Compute the average, median, maximum\r\n+    const auto avg{double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / double(skip_diffs.size())};\r\n     std::ranges::sort(skip_diffs);\r\n     const auto median{skip_diffs[n / 2]};\r\n-    // Take the maximum\r\n     const auto max{skip_diffs[skip_diffs.size() - 1]};\r\n \r\n-    // Assert some parameters of the distribution\r\n-\r\n     // The median skip diff is lower than the average (non-uniform distribution)\r\n     BOOST_CHECK_LT(median, avg);\r\n     // There are some large skip diffs (more than half of n):\r\n```\r\n</details>\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3532765861",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "review_requested",
      "id": 20943542259,
      "node_id": "RRE_lADOABII587SiRz0zwAAAATgVRfz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20943542259",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-11-14T13:24:57Z",
      "requested_reviewer": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 20962497823,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAThdlUf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/20962497823",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/e2e25f4947e65869b014483be70b764a62bd0df7",
      "created_at": "2025-11-15T16:17:28Z"
    },
    {
      "event": "labeled",
      "id": 21430921285,
      "node_id": "LE_lADOABII587SiRz0zwAAAAT9YehF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21430921285",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-08T16:20:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3557237798,
      "node_id": "PRR_kwDOABII587UByQm",
      "url": null,
      "actor": null,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-09T12:46:17Z",
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3557237798",
      "submitted_at": "2025-12-09T12:46:16Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21496603672,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUBTCQY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21496603672",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "created_at": "2025-12-11T07:02:43Z"
    },
    {
      "event": "commented",
      "id": 3640543665,
      "node_id": "IC_kwDOABII587Y_kmx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3640543665",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T07:06:20Z",
      "updated_at": "2025-12-11T07:06:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "Very minor touch: moving of a curly nit-fix, rebase (noop); mostly to get CI to run again (had some apparently temporary issue).\r\n\r\n(e2e25f4947e65869b014483be70b764a62bd0df7 -> 1a0423cf25bb60f98a29e06c39b7db2998860cd9)\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3640543665",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "unlabeled",
      "id": 21498054212,
      "node_id": "UNLE_lADOABII587SiRz0zwAAAAUBYkZE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21498054212",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T08:20:59Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3643280306,
      "node_id": "IC_kwDOABII587ZKAuy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3643280306",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T18:39:32Z",
      "updated_at": "2025-12-11T18:39:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "reACK 1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3643280306",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3643378098,
      "node_id": "IC_kwDOABII587ZKYmy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3643378098",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T19:06:09Z",
      "updated_at": "2025-12-11T19:06:09Z",
      "author_association": "MEMBER",
      "body": "Concept ACK, but disagree with the approach of the first commit.\r\n\r\nI don't think it tests anything useful:\r\n* If it wanted to test the exact behavior of the skip-height pointer building, it could test that directly. No need for averages or medians here; it could test that block 171 points to block 161 and no other, for example.\r\n* If it wanted to test something related to the performance of the constructed index, without hardcoding the exact behavior, it would need to do something like pick random pairs of blocks in the chain, and see how many iterations `CBlockIndex::GetAncestor` (or a test-only reimplementation thereof that keeps track of that count) takes to get from one to the other. While this is related to properties of the differences, the structure really matters for this, and just distribution/median/average aren't sufficient to guarantee this number is reasonable.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3643378098",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "review_request_removed",
      "id": 21511795859,
      "node_id": "RRRE_lADOABII587SiRz0zwAAAAUCM_ST",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21511795859",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T19:08:05Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3643415546,
      "node_id": "IC_kwDOABII587ZKhv6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3643415546",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T19:17:23Z",
      "updated_at": "2025-12-11T19:17:23Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I don't think it tests anything useful:\r\n> \r\n>     * If it wanted to test the exact behavior of the skip-height pointer building, it could test that directly. No need for averages or medians here; it could test that block 171 points to block 161 and no other, for example.\r\n> \r\n>     * If it wanted to test something related to the performance of the constructed index, without hardcoding the exact behavior, it would need to do something like pick random pairs of blocks in the chain, and see how many iterations `CBlockIndex::GetAncestor` (or a test-only reimplementation thereof that keeps track of that count) takes to get from one to the other. While this is related to properties of the differences, the structure really matters for this, and just distribution/median/average aren't sufficient to guarantee this number is reasonable.\r\n\r\nI'm more interested in the emergent behavior of the chain of skips, not in the exact values for some concrete values. Therefore I don't think a unit test checking the result directly for some values has much added value.\r\nBut testing the number of steps to get between two points on the chain is a good idea, that's the important property of the skips. Thanks for the suggestion, I will reconsider the test.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3643415546",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3643423211,
      "node_id": "IC_kwDOABII587ZKjnr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3643423211",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-11T19:19:23Z",
      "updated_at": "2025-12-11T19:23:38Z",
      "author_association": "MEMBER",
      "body": "My point is that these two properties, regardless of how they are accomplished, are the interesting ones to test.\r\n* Your test achieves the first, but only approximately, and is much more complicated than needed for that purpose.\r\n* Your test does not achieve the second at all, despite having complexity that seems intended to test for it.\r\n\r\nPick one of the two, and do it well.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3643423211",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "convert_to_draft",
      "id": 21525613154,
      "node_id": "CTDE_lADOABII587SiRz0zwAAAAUDBspi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21525613154",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:06:49Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21526238317,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUDEFRt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526238317",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0af1bfd4d75d884c41140b84b66f7d7c33d56a46",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/0af1bfd4d75d884c41140b84b66f7d7c33d56a46",
      "created_at": "2025-12-12T11:43:22Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21526264113,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUDELkx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526264113",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "633d9333ce7c4774cd21bacafeb317553f126226",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/633d9333ce7c4774cd21bacafeb317553f126226",
      "created_at": "2025-12-12T11:45:01Z"
    },
    {
      "event": "labeled",
      "id": 21526276519,
      "node_id": "LE_lADOABII587SiRz0zwAAAAUDEOmn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526276519",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:45:49Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21526281869,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUDEP6N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526281869",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ab9b8f5200220086c1641ea73e880a8771ce1bee",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/ab9b8f5200220086c1641ea73e880a8771ce1bee",
      "created_at": "2025-12-12T11:46:10Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21526340859,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUDEeT7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526340859",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "created_at": "2025-12-12T11:49:54Z"
    },
    {
      "event": "ready_for_review",
      "id": 21526355715,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAAUDEh8D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526355715",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:50:49Z"
    },
    {
      "event": "commented",
      "id": 3646190934,
      "node_id": "IC_kwDOABII587ZVHVW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3646190934",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:57:50Z",
      "updated_at": "2025-12-12T11:57:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "I redid the test, following @sipa's remark.\r\n\r\n- The test on skip height properties -- median, avg -- is dropped\r\n- A new test is added, that tests the skip heights _indirectly_, by doing a bunch of ancestor searches, and counting the number of steps needed, and doing some asserts on the step count. In a 200k long chain a series 1000 runs are performed. In each run a start and a target heights are picked randomly: the start is in the upper half of the chain, and the target is below it, by at least 500. Ancestor search is performed, by duplicated the `GetAncestor` algorithm. (Deterministic randomness is used.)\r\n- The simple one-input-assert-the-output `GetSkipHeight` unit test is kept unmodified. This test has limited test harness value, it serves more as a documentation-by-test for this ill-documented method. I'm not very keen on this unit test, I can remove it if reviewers don't see it useful.\r\n\r\n  ",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3646190934",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 21526469840,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAUDE9zQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526469840",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:57:51Z"
    },
    {
      "event": "subscribed",
      "id": 21526469861,
      "node_id": "SE_lADOABII587SiRz0zwAAAAUDE9zl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21526469861",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T11:57:51Z"
    },
    {
      "event": "commented",
      "id": 3646475941,
      "node_id": "IC_kwDOABII587ZWM6l",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3646475941",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T13:24:30Z",
      "updated_at": "2025-12-12T13:24:30Z",
      "author_association": "MEMBER",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/20165856545/job/57889037572#step:8:1220:\r\n```bash\r\n /home/runner/work/bitcoin/bitcoin/src/test/chain_tests.cpp:87:30: error: use of undeclared identifier 'GetSkipHeight'\r\n   87 |             int heightSkip = GetSkipHeight(heightWalk);\r\n      |                              ^\r\n/home/runner/work/bitcoin/bitcoin/src/test/chain_tests.cpp:88:34: error: use of undeclared identifier 'GetSkipHeight'\r\n   88 |             int heightSkipPrev = GetSkipHeight(heightWalk - 1);\r\n      |                                  ^\r\n2 errors generated.\r\n```",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3646475941",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3646732825,
      "node_id": "IC_kwDOABII587ZXLoZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3646732825",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T14:37:51Z",
      "updated_at": "2025-12-12T14:37:51Z",
      "author_association": "MEMBER",
      "body": "@optout21 Cool, approach ACK. You'll need to make sure both commits compile, though.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3646732825",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 21529415192,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAUDQM4Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21529415192",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T14:37:52Z"
    },
    {
      "event": "subscribed",
      "id": 21529415221,
      "node_id": "SE_lADOABII587SiRz0zwAAAAUDQM41",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21529415221",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-12T14:37:52Z"
    },
    {
      "event": "reviewed",
      "id": 3572005492,
      "node_id": "PRR_kwDOABII587U6Hp0",
      "url": null,
      "actor": null,
      "commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-12-12T17:43:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "I might have gone a bit overboard, but I have tried explaining every change that I suggested in context.\n\nFor convenience, here's the full local diff I did during review (this is the latest state, some of the suggestions may reflect a previous one):\n```C++\nBOOST_AUTO_TEST_CASE(get_skip_height_test)\n{\n    // Even heights: clear the lowest set bit.\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n                                    0b00010000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n                                    0b00100000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n                                    0b01000000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n                                    0b00010000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n                                    0b00010000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n                                    0b10101000);\n    // Odd heights: clear the 2nd and 3rd set bits.\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n                                    0b10000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n                                    0b10000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n                                    0b10000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n                                    0b10000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n                                    0b10000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n                                    0b10100001);\n    // Some longer random values (even and odd)\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n                                    0b0001011101100000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n                                    0b0001011101000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n                                    0b0110101101010000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n                                    0b0110101101000001);\n    // All values 0-10\n    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n}\n\nBOOST_AUTO_TEST_CASE(skip_height_analysis)\n{\n    // This test case indirectly tests the `GetSkipHeight` function,\n    // and asserts that its properties are suitable for performant\n    // ancestor search.\n    // It does so by imitating the `GetAncestor` function to\n    // look for an ancestor, and ensuring that an arbitrary\n    // ancestor is found in no more steps than linear traversal.\n\n    constexpr int chain_size{200'000};\n    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n    block_index.reserve(chain_size);\n    for (int i{0}; i < chain_size; ++i) {\n        auto index{std::make_unique<CBlockIndex>()};\n        index->pprev = i ? block_index.back().get() : nullptr;\n        index->nHeight = i;\n        index->BuildSkip();\n        block_index.push_back(std::move(index));\n    }\n\n    bool saw_skip{false}, saw_prev{false};\n\n    FastRandomContext rng(/*fDeterministic=*/false);\n    for (int run{0}; run < 1'000; ++run) {\n        const int start_height{(chain_size - 1) - rng.randrange(chain_size / 2)};   // pick a height in the second half of the chain\n        constexpr int min_distance{100};\n        const int delta{min_distance + rng.randrange(start_height - min_distance)}; // pick a target height, earlier by at least min_distance\n        const int target_height{start_height - delta};\n\n        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n        BOOST_REQUIRE(delta > 0);\n\n        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n        const auto* pindex_walk{block_index[start_height].get()};\n        int iteration_count{0};\n        for (int height_walk{start_height}; height_walk > target_height; ++iteration_count) {\n            BOOST_REQUIRE(pindex_walk);\n            const auto* const prev{Assert(pindex_walk->pprev)};\n            const auto* const skip{Assert(pindex_walk->pskip)};\n            BOOST_REQUIRE(prev->pskip);\n\n            const bool prev_skip_better{prev->pskip->nHeight >= target_height && prev->pskip->nHeight < skip->nHeight - 2};\n            if (skip->nHeight == target_height || (skip->nHeight > target_height && !prev_skip_better)) {\n                saw_skip = true;\n                pindex_walk = skip;\n                BOOST_REQUIRE(skip->nHeight < height_walk);\n                height_walk = skip->nHeight;\n            } else {\n                saw_prev = true;\n                pindex_walk = prev;\n                --height_walk;\n            }\n            BOOST_REQUIRE(height_walk >= target_height && height_walk == pindex_walk->nHeight);\n        }\n\n        // End-of-walk invariants.\n        BOOST_CHECK_EQUAL(pindex_walk->nHeight, target_height);\n        BOOST_CHECK_LE(iteration_count, 110); // See GetSkipHeight\n\n        // Cross-check with the real implementation.\n        const auto* ancestor{block_index[start_height]->GetAncestor(target_height)};\n        BOOST_CHECK_EQUAL(ancestor, block_index[target_height].get());\n    }\n\n    BOOST_CHECK(saw_skip && saw_prev);\n}\n```",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3572005492",
      "submitted_at": "2025-12-12T17:43:58Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21567069641,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUFf13J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21567069641",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/930125cadb1555368127a0d9a1f77309d317276e",
      "created_at": "2025-12-15T13:45:33Z"
    },
    {
      "event": "commented",
      "id": 3655744406,
      "node_id": "IC_kwDOABII587Z5juW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3655744406",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T13:48:08Z",
      "updated_at": "2025-12-15T13:48:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "Fixed build error in 1st commit (the `extern`, etc, was added to the 2nd commit only, was missing from 1st).",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3655744406",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3655748384,
      "node_id": "IC_kwDOABII587Z5ksg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3655748384",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T13:48:53Z",
      "updated_at": "2025-12-15T18:36:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "> 2 errors generated.\r\n> \r\n\r\nFixed in 464ce57745894d4038c970c5baac3c9da5933c19",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3655748384",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21571948174,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUFyc6O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21571948174",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b101a5a14beb11178f5a22cf758b0ace9efcc53f",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/b101a5a14beb11178f5a22cf758b0ace9efcc53f",
      "created_at": "2025-12-15T16:59:28Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21571965193,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUFyhEJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21571965193",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "499d73ffb6ab27431a8492cae0aab2c5e44ae70c",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/499d73ffb6ab27431a8492cae0aab2c5e44ae70c",
      "created_at": "2025-12-15T17:00:17Z"
    },
    {
      "event": "commented",
      "id": 3656697784,
      "node_id": "IC_kwDOABII587Z9Me4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3656697784",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T17:01:06Z",
      "updated_at": "2025-12-15T18:35:18Z",
      "author_association": "CONTRIBUTOR",
      "body": "Applied review comment changes to `chain_tests.cpp`.  -> 2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3656697784",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21573935172,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUF6CBE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21573935172",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "created_at": "2025-12-15T18:34:26Z"
    },
    {
      "event": "commented",
      "id": 3657054183,
      "node_id": "IC_kwDOABII587Z-jfn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3657054183",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T18:36:16Z",
      "updated_at": "2025-12-15T18:36:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I might have gone a bit overboard, but I have tried explaining every change that I suggested in context.\r\n\r\nThanks for the details comments; addressed case-by-case.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3657054183",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3657065392,
      "node_id": "IC_kwDOABII587Z-mOw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3657065392",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T18:39:22Z",
      "updated_at": "2025-12-15T19:36:06Z",
      "author_association": "MEMBER",
      "body": "There is an annoying conflict in design goals here.\r\n\r\nOn the one hand, it's copying code to mimick the traversal algorithm. When copying code, you should not assume that the two remain in sync, and reviewers might rightfully be confused about whether that might be a problem. From this perspective, it'd be better if instead, `CChain::GetAncestor` itself was modified to count its number of steps performed, and use that in the test rather than a copy/reimplementation.\r\n\r\nOn the other hand, the goal *isn't* to validate the traversal algorithm itself, but to validate a property of the skiplist it uses. The two are linked, but are not identical. In fact, there is no real reason why the two need to be identical in behavior. The added test here could use a simpler traversal algorithm (e.g. just always pick following `pskip` whenever that doesn't jump past the target, and `pprev` otherwise) - the rest can be seen as a local optimization in the traversal code, which isn't essential for verifying the skiplist itself.\r\n\r\nSo I think it's worth considering one of those two approaches (annotating the original, or using a simplified copy), but I'm also ok with the current approach - perhaps if some comments are added that explain it's copied, but doesn't require keeping the two in sync.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3657065392",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "unlabeled",
      "id": 21575421209,
      "node_id": "UNLE_lADOABII587SiRz0zwAAAAUF_s0Z",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21575421209",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-15T19:55:45Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "convert_to_draft",
      "id": 21585788767,
      "node_id": "CTDE_lADOABII587SiRz0zwAAAAUGnP9f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21585788767",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T07:49:25Z"
    },
    {
      "event": "commented",
      "id": 3659263708,
      "node_id": "IC_kwDOABII587aG-7c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3659263708",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T07:55:53Z",
      "updated_at": "2025-12-16T07:55:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "> So I think it's worth considering one of those two approaches\r\n\r\nI agree, point taken. I have considered adding the counting to the product code, but it's not a good idea to modify/extend the production code for testing purpose only, even just slightly. You are right (both of you) that duplicated likely will drift away in the futures, so there is no point in keeping it verbatim copy. I was just thinking that it's easier to find the original code if it's a verbatim copy, but that's a minor consideration.\r\nSo I give up on the verbatim copy, and I can do @l0rinc 's suggestions (code style). ",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659263708",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 21585892011,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAUGnpKr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21585892011",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T07:55:55Z"
    },
    {
      "event": "subscribed",
      "id": 21585892054,
      "node_id": "SE_lADOABII587SiRz0zwAAAAUGnpLW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21585892054",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T07:55:55Z"
    },
    {
      "event": "commented",
      "id": 3659695776,
      "node_id": "IC_kwDOABII587aIoag",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3659695776",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T09:52:14Z",
      "updated_at": "2025-12-16T09:52:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "Regarding model/approximation (https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620420093):\r\n\r\n- If there was only the 1-bit clearing (applied for even numbers), the expected average for the skip is $log(y) - 1$. For the number of iterations, the approximation is be $(y-x)/log(y)$.\r\n- The two-bit clearing is a more complex, but it approximates to $(log(y) - 1)(log(y) - 1)/2$. Combining the two (for 50% even numbers 1-bit, for 50% odd numbers 2-bit) yields $(log(y) - 1)(log(y) + 1)/2$. For iteration count estimate: $2*(y-x)/(log(y) - 1)(log(y) + 1)$ (having the order of $(y-x)/log^2(y)$ ).\r\n- However, we are interested of the sum of skips in a particular traversal, not random. There is the effect that as bits are cleared, they tend to progress towards numbers with lesser low-order bits set, which mean higher skips. Modeling this is beyond me (and not warranted by this simple test)\r\n\r\n- I looked empirically at the number of iterations vs. the log of the distance ($y-x$). Apparently, the function $8*log(y-x)-40$ gives a good-enough fit for the upper bound (visually derived; log is 2-based). See chart:\r\n\r\n<img width=\"1106\" height=\"800\" alt=\"pr33661_chart1\" src=\"https://github.com/user-attachments/assets/9654699b-9159-49df-a25b-33f6287feabe\" />\r\n\r\nI will use this formula as an upper bound in the test (together with the fixed overall-max of `115`, also empirically measured).",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659695776",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21589255833,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAUG0eaZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589255833",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "5f3513b0e06a08a0695a30695c40dcbdfa6c1c7c",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/5f3513b0e06a08a0695a30695c40dcbdfa6c1c7c",
      "created_at": "2025-12-16T10:35:16Z"
    },
    {
      "event": "commented",
      "id": 3659878069,
      "node_id": "IC_kwDOABII587aJU61",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3659878069",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:39:05Z",
      "updated_at": "2025-12-16T10:39:05Z",
      "author_association": "CONTRIBUTOR",
      "body": "Reworked based on the comments (@l0rinc @sipa, thx):\r\n\r\n- I switched to chain of len 1,000,000, for better fit with actual main chain.\r\n- The start I chose to be in the upper 90% of the chain (that is, over 100,000).\r\n- The target is below start, with the only constraint that the distance is at least 100 (reduced from 1,000).\r\n- The absolute value bound check is kept, 115 (higher than the previous 110, as chain length was increased).\r\n- The liner ratio to distance check (5%) was removed, it was too rough, and failed for low distances.\r\n- Added boundary check with the $8*log(yx) - 40$ formula.\r\n- The copied traversal code was reworked for consistent style, and some added checks.\r\n\r\nI have kept commits separately, but I plan to squash the commits before merge (the first 3 commits touching the same test method)\r\n\r\nReady for new review.\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659878069",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 21589334238,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAUG0xje",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589334238",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:39:06Z"
    },
    {
      "event": "subscribed",
      "id": 21589334271,
      "node_id": "SE_lADOABII587SiRz0zwAAAAUG0xj_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589334271",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:39:06Z"
    },
    {
      "event": "mentioned",
      "id": 21589334299,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAUG0xkb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589334299",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:39:06Z"
    },
    {
      "event": "subscribed",
      "id": 21589334332,
      "node_id": "SE_lADOABII587SiRz0zwAAAAUG0xk8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589334332",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:39:06Z"
    },
    {
      "event": "commented",
      "id": 3659889493,
      "node_id": "IC_kwDOABII587aJXtV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3659889493",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:42:07Z",
      "updated_at": "2025-12-16T10:42:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "An observation regarding the original code in `CBlockIndex::GetAncestor`:\r\n\r\nThese two lines:\r\n\r\n```C++\r\n        int heightSkip = GetSkipHeight(heightWalk);\r\n        int heightSkipPrev = GetSkipHeight(heightWalk - 1);\r\n```\r\n\r\ncould be changed to\r\n\r\n```C++\r\n            const int skip_height{walk_p->pskip->nHeight};\r\n            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\r\n```\r\n\r\nresulting in a slight performance optimization (less invocations to `GetSkipHeight`). I may explore in the future the option to change if (possible, worth it).",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659889493",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "ready_for_review",
      "id": 21589397885,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAAUG1BF9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21589397885",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-12-16T10:42:12Z"
    },
    {
      "event": "reviewed",
      "id": 3739829097,
      "node_id": "PRR_kwDOABII587e6UNp",
      "url": null,
      "actor": null,
      "commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-02T14:38:41Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3739829097",
      "submitted_at": "2026-02-02T14:38:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "reviewed",
      "id": 3740859182,
      "node_id": "PRR_kwDOABII587e-Psu",
      "url": null,
      "actor": null,
      "commit_id": "5f3513b0e06a08a0695a30695c40dcbdfa6c1c7c",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-02T17:27:52Z",
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3740859182",
      "submitted_at": "2026-02-02T17:27:52Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22493849503,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU8vOef",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22493849503",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "created_at": "2026-02-03T11:05:27Z"
    },
    {
      "event": "commented",
      "id": 3840661179,
      "node_id": "IC_kwDOABII587k69a7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3840661179",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-03T11:08:00Z",
      "updated_at": "2026-02-04T08:41:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "Changes applied (in response to recent review comments):\r\n\r\n- Adjust test boundary parameters, to ensure the test works with much higher iteration counts as well (tested with 10M, the test uses 1000).\r\n- The `GetSkipHeight()` method is exposed in `chain.h` header, so the test can use it directly (not through `extern`, that's prone to drifting). This is the only change to non-test code, done in separate first commit.\r\n\r\nChanges not affecting content:\r\n- Merged the first 3 commits; they all relate to the same test.\r\n- Added reviewers as co-authors.\r\n- Rebased to current master (no strict reason, no change)\r\n\r\nPlease consider (re)review.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3840661179",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "reviewed",
      "id": 3745334714,
      "node_id": "PRR_kwDOABII587fPUW6",
      "url": null,
      "actor": null,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-03T14:33:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think we can get rid of a few unique pointers to speed up and simplify the test.\n\nThe PR description needs to be updated now since the added test doesnt test a distribution anymore, the low-level test is commit 3, and the non-test change (making GetSkipHeight linkable) is commit 1.\nThe last commit still claims: `The method is changed to be not static and inline, so that the test can link with it.` which is done in a different commit now.\n\nAnd `are not tested and not well documented` is bit overstated since there is existing skiplist coverage (src/test/skiplist_tests.cpp) that exercises BuildSkip() + GetAncestor(). I think we should move the new changes there.\n\nLastly, a few of my comments were resolved but not addressed, which is a bit frustrating, could you please recheck them and either explain why my assessment was incorrect or apply it to the change?",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3745334714",
      "submitted_at": "2026-02-03T14:33:25Z",
      "state": "CHANGES_REQUESTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "commented",
      "id": 3845937654,
      "node_id": "IC_kwDOABII587lPFn2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3845937654",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T08:07:59Z",
      "updated_at": "2026-02-04T08:07:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I think we can get rid of a few unique pointers to speed up and simplify the test.\r\n> [...]\r\n> And `are not tested and not well documented` is bit overstated since there is existing skiplist coverage (src/test/skiplist_tests.cpp) that exercises BuildSkip() + GetAncestor(). I think we should move the new changes there.\r\n> [...]\r\n> Lastly, a few of my comments were resolved but not addressed, which is a bit frustrating, could you please recheck them and either explain why my assessment was incorrect or apply it to the change?\r\n\r\nThx. I will address the separate review comments.\r\nThe allocation remark is very useful.\r\nThx for mentioning `skiplist_tests.cpp`, it was off my radar (I initially searched on `GetSkipHeight` in tests).\r\nI have re-checked Resolved comments (~42 of them), and indeed, I found 4 where the closing reason was not very clear. Sorry for that. I unresolved them and I will address or explain each of them.\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3845937654",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "convert_to_draft",
      "id": 22521277503,
      "node_id": "CTDE_lADOABII587SiRz0zwAAAAU-X2w_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22521277503",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T08:19:36Z"
    },
    {
      "event": "commented",
      "id": 3846518507,
      "node_id": "IC_kwDOABII587lRTbr",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3846518507",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T10:12:08Z",
      "updated_at": "2026-02-04T10:12:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "WIP status: suggestions addressed, TODO:\r\n- fixup commits\r\n- review/update commit messages and PR description\r\n- move tests from `chain_tests.cpp` to `skiplist_tests.cpp`",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3846518507",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "reviewed",
      "id": 3750457038,
      "node_id": "PRR_kwDOABII587fi27O",
      "url": null,
      "actor": null,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-04T11:19:02Z",
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3750457038",
      "submitted_at": "2026-02-04T11:19:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22528025692,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU-xmRc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528025692",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7310c887bb063a20bec71a21cd1cf73790cfc984",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/7310c887bb063a20bec71a21cd1cf73790cfc984",
      "created_at": "2026-02-04T12:59:31Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22528363357,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU-y4td",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528363357",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "7a62566fcd3a018e7ea0b6dcd421c0a7bfb7bd05",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/7a62566fcd3a018e7ea0b6dcd421c0a7bfb7bd05",
      "created_at": "2026-02-04T13:10:20Z"
    },
    {
      "event": "labeled",
      "id": 22528377704,
      "node_id": "LE_lADOABII587SiRz0zwAAAAU-y8No",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528377704",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T13:10:56Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22528445863,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU-zM2n",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528445863",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "b5c6d58bc5ec1567bac4a458bc0b099fd644ff02",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/b5c6d58bc5ec1567bac4a458bc0b099fd644ff02",
      "created_at": "2026-02-04T13:13:41Z"
    },
    {
      "event": "commented",
      "id": 3847396499,
      "node_id": "IC_kwDOABII587lUpyT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3847396499",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T13:15:33Z",
      "updated_at": "2026-02-04T13:20:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "Ready for review.\r\nChanges (since 9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e):\r\n\r\n- Move new tests from `chain_tests.cpp` to `skiplist_tests.cpp`\r\n- Simplified stack allocation, get rid of unique_ptr's (eb00ab8212a4a07f6c67e93834216c4d6ec183dd)\r\n- Minor comment fix, a typo, formatting (clang) (779b539930ff1bd8712c998dd2652b3331f28103)\r\n- commit messages and PR description updated\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3847396499",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22528593904,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU-zw_w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528593904",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "created_at": "2026-02-04T13:19:31Z"
    },
    {
      "event": "ready_for_review",
      "id": 22528611127,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAAU-z1M3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22528611127",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T13:20:11Z"
    },
    {
      "event": "unlabeled",
      "id": 22530086688,
      "node_id": "UNLE_lADOABII587SiRz0zwAAAAU-5dcg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22530086688",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T14:16:31Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 3751296127,
      "node_id": "PRR_kwDOABII587fmDx_",
      "url": null,
      "actor": null,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-04T14:19:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "I left a few nits that I would prefer if we still addressed, but the current version is quite clean.\n\nSome changes were lost during the rebase, if you could go over the comments again and make sure they are part of the final state, I'd appreciate it. I tried doing the same, left some notes.\n\nACK 8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3751296127",
      "submitted_at": "2026-02-04T14:19:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "review_requested",
      "id": 22530166691,
      "node_id": "RRE_lADOABII587SiRz0zwAAAAU-5w-j",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22530166691",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T14:19:36Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22538604149,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAU_Z851",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22538604149",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "45a5c5f3d63da22aca7f14b9eb0203ffa827a1a7",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/45a5c5f3d63da22aca7f14b9eb0203ffa827a1a7",
      "created_at": "2026-02-04T19:38:12Z"
    },
    {
      "event": "commented",
      "id": 3849437317,
      "node_id": "IC_kwDOABII587lccCF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3849437317",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T19:52:11Z",
      "updated_at": "2026-02-04T19:52:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "As noticed, one fix commit was accidentally lost (779b539930ff1bd8712c998dd2652b3331f28103).\r\nCorrected, together with a few minor nits.",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3849437317",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "commented",
      "id": 3849479712,
      "node_id": "IC_kwDOABII587lcmYg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3849479712",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-04T20:02:44Z",
      "updated_at": "2026-02-04T20:02:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 45a5c5f3d63da22aca7f14b9eb0203ffa827a1a7\r\n\r\nThanks for the quick turnaround, new tests look good to me.\r\nsuper-nit: to avoid duplication in PR title consider something like: `test: validate skip heights...`",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3849479712",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "reviewed",
      "id": 3773999584,
      "node_id": "PRR_kwDOABII587g8qng",
      "url": null,
      "actor": null,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-02-09T15:33:22Z",
      "author_association": "MEMBER",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#pullrequestreview-3773999584",
      "submitted_at": "2026-02-09T15:33:22Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
    },
    {
      "event": "review_requested",
      "id": 22647614853,
      "node_id": "RRE_lADOABII587SiRz0zwAAAAVF5y2F",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22647614853",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-09T15:33:31Z",
      "requested_reviewer": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22757668291,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAVMdnXD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22757668291",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "527b186bb7908bdd19da7a8277727dd1079f7c95",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/527b186bb7908bdd19da7a8277727dd1079f7c95",
      "created_at": "2026-02-13T07:11:04Z"
    },
    {
      "event": "commented",
      "id": 3895337279,
      "node_id": "IC_kwDOABII587oLiE_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3895337279",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T07:24:00Z",
      "updated_at": "2026-02-13T07:45:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the thorough checking! With adjusted boundary check I'm confident now that this holds for ALL possible subchains (with the given parameters: chain length of `1'000'000` and minimum subchain length of `100`).\r\nIf you prefer, I'm open to reduce the test to a much simpler and relaxed check (e.g. `\"< 200\"`), but I think the current version is more informative.\r\n\r\nChange:\r\n- Boundary check values have been adjusted, to be more resilient for all possible subchains, not just the ones used in the test. The new formula is `8 * std::bit_width<unsigned>(delta) - 29` (a step-like function).\r\n\r\nAdditional info:\r\n\r\n- A more thorough measurement was done. From the charts below it is visible that the formula used was not sufficient, it was not an upper bound in all cases (esp. for longer subchain).\r\n- The chart confirms that the max iteration count has strong correlation with the delta.\r\n- The absolute upper limit of `130` still holds\r\n- The test passed with a test iteration count of `2'000'000'000`, instead of the `1000` used in the test.\r\n- I reproduce some charts, plotting the measured maximum iteration count against the length of the subchain ('delta'). Several percentiles are also plotted for the distribution of itercounts for a given delta: 10th, 50th, 90th. The second chart is log-scale x axis, the other two are closeups. The data is not exhaustive.\r\n- I also tried the test with non-deterministic RNG, ran 5000 times successfully.\r\n- The `bit_width` used is a nice shortcut for `ceil(log(x)/log(2))`, without using floating point arithmetics (thanks for the hint, @l0rinc )\r\n\r\n<details>\r\n<summary>git diff 45a5c5f3d63da22aca7f14b9eb0203ffa827a1a7 527b186bb7908bdd19da7a8277727dd1079f7c95</summary>\r\n\r\n```diff\r\ndiff --git a/src/test/skiplist_tests.cpp b/src/test/skiplist_tests.cpp\r\nindex d7d18cf76e..56a15d5203 100644\r\n--- a/src/test/skiplist_tests.cpp\r\n+++ b/src/test/skiplist_tests.cpp\r\n@@ -6,6 +6,7 @@\r\n #include <test/util/setup_common.h>\r\n \r\n+#include <bit>\r\n #include <cmath>\r\n #include <vector>\r\n@@ -317,8 +318,8 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\r\n         BOOST_CHECK_LE(iteration_count, 130);\r\n         // Dynamic bound, function of distance. Formula derived empirically.\r\n-        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};\r\n-        BOOST_CHECK_LE(double(iteration_count), bound_log_distance);\r\n+        const auto bound_log_distance{8 * std::bit_width<unsigned>(delta) - 29};\r\n+        BOOST_CHECK_LE(iteration_count, bound_log_distance);\r\n \r\n         // Also check that `GetAncestor` gives the same result\r\n```\r\n</details>\r\n\r\n<img width=\"2200\" height=\"1397\" alt=\"charts4\" src=\"https://github.com/user-attachments/assets/518594ce-55a4-4534-ac01-5bc9be97e72b\" />\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3895337279",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 22757974985,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAVMeyPJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22757974985",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T07:24:02Z"
    },
    {
      "event": "subscribed",
      "id": 22757975014,
      "node_id": "SE_lADOABII587SiRz0zwAAAAVMeyPm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22757975014",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T07:24:02Z"
    },
    {
      "event": "labeled",
      "id": 22759399252,
      "node_id": "LE_lADOABII587SiRz0zwAAAAVMkN9U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22759399252",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-13T08:31:00Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "convert_to_draft",
      "id": 22790709179,
      "node_id": "CTDE_lADOABII587SiRz0zwAAAAVObp-7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22790709179",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T13:11:00Z"
    },
    {
      "event": "ready_for_review",
      "id": 22790709861,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAAVObqJl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22790709861",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T13:11:04Z"
    },
    {
      "event": "closed",
      "id": 22790715356,
      "node_id": "CE_lADOABII587SiRz0zwAAAAVObrfc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22790715356",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T13:11:33Z"
    },
    {
      "event": "reopened",
      "id": 22790716205,
      "node_id": "REE_lADOABII587SiRz0zwAAAAVObrst",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22790716205",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T13:11:40Z"
    },
    {
      "event": "commented",
      "id": 3901919314,
      "node_id": "IC_kwDOABII587okpBS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3901919314",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T13:27:47Z",
      "updated_at": "2026-02-14T13:28:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "ACK 527b186bb7908bdd19da7a8277727dd1079f7c95\r\n\r\nSince my last ack the test formula was updated to be more robust.\r\nVery cool plots, shows precisely what's happening.\r\n\r\nRebased and tested locally, the previous CI failure (vcpkg couldn't download the Boost Bind library) was unrelated to the change - close/open dance should fix it.\r\n\r\nnit:  `#include <cmath>` in `src/test/skiplist_tests.cpp` is unused now, if you need to touch again, please consider removing it. Not worth a new push otherwise.\r\n\r\n> The absolute upper limit of 130 still holds\r\n\r\nIt seems I misremembered, sorry for the confusion.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3901919314",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "unlabeled",
      "id": 22791362189,
      "node_id": "UNLE_lADOABII587SiRz0zwAAAAVOeJaN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22791362189",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T14:38:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3902103044,
      "node_id": "IC_kwDOABII587olV4E",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3902103044",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-14T16:03:09Z",
      "updated_at": "2026-02-14T16:03:09Z",
      "author_association": "MEMBER",
      "body": "I wrote an exhaustive search to find all the worst possible cases:\r\n\r\n```c++\r\n#include <stdint.h>\r\n#include <vector>\r\n#include <iostream>\r\n\r\nnamespace {\r\n\r\nint constexpr inline InvertLowestOne(int n) { return n & (n - 1); }\r\nint constexpr static inline GetSkipHeight(int height) {\r\n    if (height < 2) return 0;\r\n    return (height & 1) ? InvertLowestOne(InvertLowestOne(height - 1)) + 1 : InvertLowestOne(height);\r\n}\r\n\r\nvoid Analyse(int target_height, std::vector<std::pair<int, int>>& max_by_delta) noexcept {\r\n    std::vector<int> steps_by_delta(1000000 - target_height);\r\n    steps_by_delta[0] = 0;\r\n    for (int delta = 1; delta <= 999999 - target_height; ++delta) {\r\n        int starting_height = target_height + delta;\r\n        int walk = starting_height;\r\n        int skip = GetSkipHeight(walk);\r\n        int skipprev = GetSkipHeight(walk - 1);\r\n        if (skip == target_height || (skip > target_height && !(skipprev < skip - 2 && skipprev >= target_height))) {\r\n            steps_by_delta[delta] = steps_by_delta[skip - target_height] + 1;\r\n        } else {\r\n            steps_by_delta[delta] = steps_by_delta[delta - 1] + 1;\r\n        }\r\n        if (steps_by_delta[delta] > max_by_delta[delta].first) {\r\n            max_by_delta[delta].first = steps_by_delta[delta];\r\n            max_by_delta[delta].second = target_height;\r\n            std::cout << std::unitbuf << \"delta=\" << delta << \": \" << starting_height << \"->\" << target_height << \": \" << steps_by_delta[delta] << \" steps\\n\";\r\n        }\r\n    }\r\n}\r\n} // namespace\r\n\r\nint main() {\r\n    std::vector<std::pair<int, int>> max_by_delta(1000000);\r\n    for (int target_height = 1; target_height <= 999899; ++target_height) {\r\n        Analyse(target_height, max_by_delta);\r\n    }\r\n    std::cout << \"\\n\";\r\n    int farmax = 0;\r\n    for (int delta = 1; delta <= 999999; ++delta) {\r\n        farmax = std::max(farmax, max_by_delta[delta].first);\r\n        std::cout << \"delta=\" << delta << \": \" << (delta + max_by_delta[delta].second) << \"->\" << max_by_delta[delta].second << \": \" << max_by_delta[delta].first << \" steps (max \" << farmax << \")\\n\";\r\n    }\r\n}\r\n```\r\n\r\nAnd found:\r\n\r\n```\r\ndelta=1: 2->1: 1 steps (max 1)\r\ndelta=2: 4->2: 2 steps (max 2)\r\ndelta=3: 5->2: 3 steps (max 3)\r\ndelta=4: 9->5: 4 steps (max 4)\r\ndelta=6: 8->2: 5 steps (max 5)\r\ndelta=7: 9->2: 6 steps (max 6)\r\ndelta=9: 11->2: 7 steps (max 7)\r\ndelta=14: 16->2: 8 steps (max 8)\r\ndelta=15: 17->2: 9 steps (max 9)\r\ndelta=17: 19->2: 10 steps (max 10)\r\ndelta=25: 35->10: 11 steps (max 11)\r\ndelta=30: 32->2: 12 steps (max 12)\r\ndelta=31: 33->2: 13 steps (max 13)\r\ndelta=33: 35->2: 14 steps (max 14)\r\ndelta=42: 44->2: 15 steps (max 15)\r\ndelta=58: 60->2: 16 steps (max 16)\r\ndelta=63: 65->2: 17 steps (max 17)\r\ndelta=65: 67->2: 18 steps (max 18)\r\ndelta=74: 76->2: 19 steps (max 19)\r\ndelta=90: 92->2: 20 steps (max 20)\r\ndelta=122: 156->34: 21 steps (max 21)\r\ndelta=127: 129->2: 22 steps (max 22)\r\ndelta=129: 131->2: 23 steps (max 23)\r\ndelta=138: 140->2: 24 steps (max 24)\r\ndelta=154: 156->2: 25 steps (max 25)\r\ndelta=250: 252->2: 26 steps (max 26)\r\ndelta=255: 257->2: 27 steps (max 27)\r\ndelta=257: 259->2: 28 steps (max 28)\r\ndelta=266: 268->2: 29 steps (max 29)\r\ndelta=282: 284->2: 30 steps (max 30)\r\ndelta=378: 380->2: 31 steps (max 31)\r\ndelta=506: 540->34: 32 steps (max 32)\r\ndelta=511: 513->2: 33 steps (max 33)\r\ndelta=513: 515->2: 34 steps (max 34)\r\ndelta=522: 524->2: 35 steps (max 35)\r\ndelta=538: 540->2: 36 steps (max 36)\r\ndelta=634: 636->2: 37 steps (max 37)\r\ndelta=1014: 1016->2: 38 steps (max 38)\r\ndelta=1023: 1025->2: 39 steps (max 39)\r\ndelta=1025: 1027->2: 40 steps (max 40)\r\ndelta=1034: 1036->2: 41 steps (max 41)\r\ndelta=1050: 1052->2: 42 steps (max 42)\r\ndelta=1146: 1148->2: 43 steps (max 43)\r\ndelta=1526: 1528->2: 44 steps (max 44)\r\ndelta=2038: 2040->2: 45 steps (max 45)\r\ndelta=2047: 2049->2: 46 steps (max 46)\r\ndelta=2049: 2051->2: 47 steps (max 47)\r\ndelta=2058: 2060->2: 48 steps (max 48)\r\ndelta=2074: 2076->2: 49 steps (max 49)\r\ndelta=2170: 2172->2: 50 steps (max 50)\r\ndelta=2550: 2552->2: 51 steps (max 51)\r\ndelta=3062: 3064->2: 52 steps (max 52)\r\ndelta=4086: 4088->2: 53 steps (max 53)\r\ndelta=4097: 4099->2: 54 steps (max 54)\r\ndelta=4106: 4108->2: 55 steps (max 55)\r\ndelta=4122: 4124->2: 56 steps (max 56)\r\ndelta=4218: 4220->2: 57 steps (max 57)\r\ndelta=4598: 4600->2: 58 steps (max 58)\r\ndelta=5110: 5112->2: 59 steps (max 59)\r\ndelta=6134: 6136->2: 60 steps (max 60)\r\ndelta=8182: 8184->2: 61 steps (max 61)\r\ndelta=8193: 8195->2: 62 steps (max 62)\r\ndelta=8202: 8204->2: 63 steps (max 63)\r\ndelta=8218: 8220->2: 64 steps (max 64)\r\ndelta=8314: 8316->2: 65 steps (max 65)\r\ndelta=8694: 8696->2: 66 steps (max 66)\r\ndelta=9206: 9208->2: 67 steps (max 67)\r\ndelta=10230: 10232->2: 68 steps (max 68)\r\ndelta=12278: 12280->2: 69 steps (max 69)\r\ndelta=16374: 16376->2: 70 steps (max 70)\r\ndelta=16394: 16396->2: 71 steps (max 71)\r\ndelta=16410: 16412->2: 72 steps (max 72)\r\ndelta=16506: 16508->2: 73 steps (max 73)\r\ndelta=16886: 16888->2: 74 steps (max 74)\r\ndelta=17398: 17400->2: 75 steps (max 75)\r\ndelta=18422: 18424->2: 76 steps (max 76)\r\ndelta=20470: 20472->2: 77 steps (max 77)\r\ndelta=24566: 24568->2: 78 steps (max 78)\r\ndelta=32758: 32760->2: 79 steps (max 79)\r\ndelta=32778: 32780->2: 80 steps (max 80)\r\ndelta=32794: 32796->2: 81 steps (max 81)\r\ndelta=32890: 32892->2: 82 steps (max 82)\r\ndelta=33270: 33272->2: 83 steps (max 83)\r\ndelta=33782: 33784->2: 84 steps (max 84)\r\ndelta=34806: 34808->2: 85 steps (max 85)\r\ndelta=36854: 36856->2: 86 steps (max 86)\r\ndelta=40950: 40952->2: 87 steps (max 87)\r\ndelta=49142: 49144->2: 88 steps (max 88)\r\ndelta=65526: 65528->2: 89 steps (max 89)\r\ndelta=65562: 65564->2: 90 steps (max 90)\r\ndelta=65658: 65660->2: 91 steps (max 91)\r\ndelta=66038: 66040->2: 92 steps (max 92)\r\ndelta=66550: 66552->2: 93 steps (max 93)\r\ndelta=67574: 67576->2: 94 steps (max 94)\r\ndelta=69622: 69624->2: 95 steps (max 95)\r\ndelta=73718: 73720->2: 96 steps (max 96)\r\ndelta=81910: 81912->2: 97 steps (max 97)\r\ndelta=98294: 98296->2: 98 steps (max 98)\r\ndelta=131062: 131064->2: 99 steps (max 99)\r\ndelta=131098: 131100->2: 100 steps (max 100)\r\ndelta=131194: 131196->2: 101 steps (max 101)\r\ndelta=131574: 131576->2: 102 steps (max 102)\r\ndelta=132086: 132088->2: 103 steps (max 103)\r\ndelta=133110: 133112->2: 104 steps (max 104)\r\ndelta=135158: 135160->2: 105 steps (max 105)\r\ndelta=139254: 139256->2: 106 steps (max 106)\r\ndelta=147446: 147448->2: 107 steps (max 107)\r\ndelta=163830: 163832->2: 108 steps (max 108)\r\ndelta=196598: 196600->2: 109 steps (max 109)\r\ndelta=262134: 262136->2: 110 steps (max 110)\r\ndelta=262266: 262268->2: 111 steps (max 111)\r\ndelta=262646: 262648->2: 112 steps (max 112)\r\ndelta=263158: 263160->2: 113 steps (max 113)\r\ndelta=264182: 264184->2: 114 steps (max 114)\r\ndelta=266230: 266232->2: 115 steps (max 115)\r\ndelta=270326: 270328->2: 116 steps (max 116)\r\ndelta=278518: 278520->2: 117 steps (max 117)\r\ndelta=294902: 294904->2: 118 steps (max 118)\r\ndelta=327670: 327672->2: 119 steps (max 119)\r\ndelta=393206: 393208->2: 120 steps (max 120)\r\ndelta=524278: 524280->2: 121 steps (max 121)\r\ndelta=524410: 524412->2: 122 steps (max 122)\r\ndelta=524790: 524792->2: 123 steps (max 123)\r\ndelta=525302: 525304->2: 124 steps (max 124)\r\ndelta=526326: 526328->2: 125 steps (max 125)\r\ndelta=528374: 528376->2: 126 steps (max 126)\r\ndelta=532470: 532472->2: 127 steps (max 127)\r\ndelta=540662: 540664->2: 128 steps (max 128)\r\ndelta=557046: 557048->2: 129 steps (max 129)\r\ndelta=589814: 589816->2: 130 steps (max 130)\r\ndelta=655350: 655352->2: 131 steps (max 131)\r\ndelta=786422: 786424->2: 132 steps (max 132)\r\n```\r\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3902103044",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "convert_to_draft",
      "id": 22799186437,
      "node_id": "CTDE_lADOABII587SiRz0zwAAAAVO7_oF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22799186437",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T04:38:17Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVjOTE0NDE3YzYyMTgwOGNkZjFmMWYyZWI0ZmQ5MzNjMGRkZjJhMzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ec914417c621808cdf1f1f2eb4fd933c0ddf2a31",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ec914417c621808cdf1f1f2eb4fd933c0ddf2a31",
      "tree": {
        "sha": "2578538c274203dd2103b7f0a494496af3b5ccca",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2578538c274203dd2103b7f0a494496af3b5ccca"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/47c9297172b0866d2b5d0de6b4fd35b798db3929",
          "sha": "47c9297172b0866d2b5d0de6b4fd35b798db3929",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/47c9297172b0866d2b5d0de6b4fd35b798db3929"
        }
      ],
      "message": "Add indirect test for skip height through ancestor search\n\nAdd a unit test that indirectly tests the `GetSkipHeight()` function,\nby doing checks on the performance of ancestor search that relies on\nskip heights. Random searches are performed on a long subchain,\nand the effective number of steps are counted, and asserted that are\nmuch less than the distance to the ancestor. For boundary value a\nlog(distance)-based formula is used (the formula is of the form\n$A*log(yx) - B$, with empirically established A and B values).\n\nCo-authored-by: Lrinc <pap.lorinc@gmail.com>\nCo-authored-by: sipa <pieter@wuille.net>",
      "committer": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2026-02-15T07:36:21Z"
      },
      "author": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2025-12-12T11:36:28Z"
      },
      "sha": "ec914417c621808cdf1f1f2eb4fd933c0ddf2a31"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5ZDdmZWUzYWU5NDRjOTZhOTVjZWQ5MjUxMjNiMzcwOWZjODRkZjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9d7fee3ae944c96a95ced925123b3709fc84df0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9d7fee3ae944c96a95ced925123b3709fc84df0",
      "tree": {
        "sha": "17e003611f51e5daa3871e5c59d248dd2dcd1267",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/17e003611f51e5daa3871e5c59d248dd2dcd1267"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ec914417c621808cdf1f1f2eb4fd933c0ddf2a31",
          "sha": "ec914417c621808cdf1f1f2eb4fd933c0ddf2a31",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ec914417c621808cdf1f1f2eb4fd933c0ddf2a31"
        }
      ],
      "message": "Expose GetSkipHeight() in chain.h\n\nIn preparation for its test, the `GetSkipHeight()` method is exposed\nin `chain.h`. Thus it can be used directly in the test\n(not through `extern`, that's prone to drifting).\n\nCo-authored-by: sipa <pieter@wuille.net>",
      "committer": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2026-02-15T07:36:26Z"
      },
      "author": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2026-02-03T07:50:02Z"
      },
      "sha": "b9d7fee3ae944c96a95ced925123b3709fc84df0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBmNmI1OGJhOWEyOTg5ZmVhYzYyOTJlNzRlMmQ3MjFlMzU0OTIwNTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0f6b58ba9a2989feac6292e74e2d721e35492051",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0f6b58ba9a2989feac6292e74e2d721e35492051",
      "tree": {
        "sha": "f70beadddcd6081655a2b8af90234130ac3bf987",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f70beadddcd6081655a2b8af90234130ac3bf987"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9d7fee3ae944c96a95ced925123b3709fc84df0",
          "sha": "b9d7fee3ae944c96a95ced925123b3709fc84df0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9d7fee3ae944c96a95ced925123b3709fc84df0"
        }
      ],
      "message": "Add low-level tests for GetSkipHeight()\n\nThis previously internal method in chain.cpp has low and only\nindirect test coverage, and it is not documented well.\nA straightforward, simple, direct unit test is added.\n\nCo-authored-by: Lrinc <pap.lorinc@gmail.com>",
      "committer": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2026-02-15T07:36:26Z"
      },
      "author": {
        "name": "optout",
        "email": "13562139+optout21@users.noreply.github.com",
        "date": "2025-10-18T10:44:56Z"
      },
      "sha": "0f6b58ba9a2989feac6292e74e2d721e35492051"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22801144973,
      "node_id": "HRFPE_lADOABII587SiRz0zwAAAAVPDdyN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22801144973",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "0f6b58ba9a2989feac6292e74e2d721e35492051",
      "commit_url": "https://api.github.com/repos/optout21/bitcoin/commits/0f6b58ba9a2989feac6292e74e2d721e35492051",
      "created_at": "2026-02-15T07:49:03Z"
    },
    {
      "event": "commented",
      "id": 3903642636,
      "node_id": "IC_kwDOABII587orNwM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3903642636",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T07:53:25Z",
      "updated_at": "2026-02-15T07:53:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "I was wrong, I stand corrected. @sipa, elegant way to do the exhaustive search in less than O(N^2).\r\n\r\nAdjusted the parameters: `130` -> `132`, `-29` -> `-28`.\r\nVerified with all new max values found (in the above code).\r\nThe test execution with the given parameters is not affected, but the checks are more correct this way.\r\n\r\nNote: The max iteration count charts show the fractal nature of the structure. Interestingly, plotting the max iteration count against `log2(delta)` shows that a quadratic equation is a better fit than linear (`0.25*log^2 + 1.5*log + 2` vs `8*log - 28`).\r\n\r\n<details>\r\n<summary>git diff 527b186bb7908bdd19da7a8277727dd1079f7c95 0f6b58ba9a2989feac6292e74e2d721e35492051</summary>\r\n\r\n```diff\r\ndiff --git a/src/test/skiplist_tests.cpp b/src/test/skiplist_tests.cpp\r\nindex 56a15d5203..409119a914 100644\r\n--- a/src/test/skiplist_tests.cpp\r\n+++ b/src/test/skiplist_tests.cpp\r\n@@ -316,9 +316,9 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\r\n \r\n         // Asserts on the number of iterations:\r\n         // Absolute value maximum (derived empirically)\r\n-        BOOST_CHECK_LE(iteration_count, 130);\r\n+        BOOST_CHECK_LE(iteration_count, 132);\r\n         // Dynamic bound, function of distance. Formula derived empirically.\r\n-        const auto bound_log_distance{8 * std::bit_width<unsigned>(delta) - 29};\r\n+        const auto bound_log_distance{8 * std::bit_width<unsigned>(delta) - 28};\r\n         BOOST_CHECK_LE(iteration_count, bound_log_distance);\r\n \r\n         // Also check that `GetAncestor` gives the same result\r\n```\r\n</details>\r\n\r\n<details>\r\n<summary>For reference, I repeat here the `log(delta)` - `maxiter` empirical data:</summary>\r\n\r\n```\r\nlog(delta)  maxiter\r\n7\t22\r\n8\t27\r\n9\t33\r\n10\t39\r\n11\t46\r\n12\t53\r\n13\t61\r\n14\t70\r\n15\t79\r\n16\t89\r\n17\t99\r\n18\t110\r\n19\t121\r\n20\t132\r\n```\r\n</details>\r\n",
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3903642636",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33661"
    },
    {
      "event": "mentioned",
      "id": 22801171835,
      "node_id": "MEE_lADOABII587SiRz0zwAAAAVPDkV7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22801171835",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T07:53:26Z"
    },
    {
      "event": "subscribed",
      "id": 22801171842,
      "node_id": "SE_lADOABII587SiRz0zwAAAAVPDkWC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22801171842",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T07:53:27Z"
    },
    {
      "event": "ready_for_review",
      "id": 22801177040,
      "node_id": "RFRE_lADOABII587SiRz0zwAAAAVPDlnQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22801177040",
      "actor": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-02-15T07:54:20Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483243259",
      "pull_request_review_id": 3407000419,
      "id": 2483243259,
      "node_id": "PRRC_kwDOABII586UA0j7",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": " for the static removal, but why remove the `inline` keyword?",
      "created_at": "2025-11-01T08:50:23Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2483243259",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483243259"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483265868",
      "pull_request_review_id": 3407000419,
      "id": 2483265868,
      "node_id": "PRRC_kwDOABII586UA6FM",
      "diff_hunk": "@@ -41,6 +41,57 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "cdffd675d526bc0e1be85cfcd6b89ad1fe46cdfc",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This seems unused",
      "created_at": "2025-11-01T09:00:48Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2483265868",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2483265868"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486172116",
      "pull_request_review_id": 3407000419,
      "id": 2486172116,
      "node_id": "PRRC_kwDOABII586UL_nU",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {\n     if (height < 2)",
      "path": "src/chain.cpp",
      "position": 7,
      "original_position": 6,
      "commit_id": "0f6b58ba9a2989feac6292e74e2d721e35492051",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: can this be `if (height <= 2)` as well? It's likely outside the scope of the change though",
      "created_at": "2025-11-03T11:34:24Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486172116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486172116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 75,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486181169",
      "pull_request_review_id": 3407000419,
      "id": 2486181169,
      "node_id": "PRRC_kwDOABII586UMB0x",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 21,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we could add comments explaining the magic values:\n\\# height <= 2\n\\# powers of 2\n\\# odd/even heights\n\\# absurdly big values or whatever\n\nOtherwise it's not obvious why 4 is 0 and 5 is 1 and there is no 6 but 7 is 1 again...\n\nI need to understand why we chose these numbers, especially since the PR is meant to document the change",
      "created_at": "2025-11-03T11:38:11Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486181169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486181169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486186460",
      "pull_request_review_id": 3407000419,
      "id": 2486186460,
      "node_id": "PRRC_kwDOABII586UMDHc",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I like the binary representation, but maybe we could use `BOOST_CHECK_EQUAL` insead (helps with the reason when they fail) and maybe we could align these to simplify finding the differences in their endings:\n```C++\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n                                    0b0001011101100000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n                                    0b0001011101000001);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n                                    0b0110101101010000);\n    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n                                    0b0110101101000001);\n```\n\nAnd a short comment could help in drawing our attention to the ending",
      "created_at": "2025-11-03T11:40:35Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486186460",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486186460"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486188243",
      "pull_request_review_id": 3407000419,
      "id": 2486188243,
      "node_id": "PRRC_kwDOABII586UMDjT",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "it seems to test more than non-uniformity.\nMy understanding is that you want to show that most jumps are small, right?\nIf so, maybe we don't have to be that specific, can we just check that the median jump is tiny?\n\n```C++\nBOOST_AUTO_TEST_CASE(skip_height_properties_test)\n{\n    constexpr int n{30'000};\n\n    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n    block_index.push_back(std::make_unique<CBlockIndex>());\n    for(int i{0}; i < n; ++i) {\n        auto new_index{std::make_unique<CBlockIndex>()};\n        new_index->pprev = block_index.back().get();\n        new_index->nHeight = new_index->pprev->nHeight + 1;\n        new_index->BuildSkip();\n        block_index.push_back(std::move(new_index));\n    }\n\n    std::vector<int> skip_diffs;\n    skip_diffs.reserve(n);\n    for(int i{1}; i <= n; ++i) {\n        skip_diffs.push_back(i - block_index[i]->pskip->nHeight);\n    }\n\n    std::ranges::sort(skip_diffs);\n    const int median{skip_diffs[n / 2]};\n    \n    BOOST_CHECK_LT(median, 10); // Most jumps are small\n}\n```",
      "created_at": "2025-11-03T11:41:23Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486188243",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486188243"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486192203",
      "pull_request_review_id": 3407000419,
      "id": 2486192203,
      "node_id": "PRRC_kwDOABII586UMEhL",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 60,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I need more context, how did we get to these numbers exactly?\r\nDo we really need to be this precise? Wouldn't it suffice to check that their median is low enough?",
      "created_at": "2025-11-03T11:43:08Z",
      "updated_at": "2025-11-03T12:34:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486192203",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486192203"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486214751",
      "pull_request_review_id": 3407000419,
      "id": 2486214751,
      "node_id": "PRRC_kwDOABII586UMKBf",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {\n+        BOOST_CHECK(block_index[i]->nHeight == i);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 65,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "this sounds like a `BOOST_REQUIRE_EQUAL` instead",
      "created_at": "2025-11-03T11:52:40Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486214751",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486214751"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486224185",
      "pull_request_review_id": 3407000419,
      "id": 2486224185,
      "node_id": "PRRC_kwDOABII586UMMU5",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 47,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "maybe this would also work\n```suggestion\n    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n    block_index.push_back(std::make_unique<CBlockIndex>());\n```",
      "created_at": "2025-11-03T11:55:43Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486224185",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486224185"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486242198",
      "pull_request_review_id": 3407000419,
      "id": 2486242198,
      "node_id": "PRRC_kwDOABII586UMQuW",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "was wondering how slow this is, but seems acceptable:\n```bash\ncmake -B build  -DCMAKE_BUILD_TYPE=Debug && cmake --build build && time ./build/bin/test_bitcoin --run_test=chain_tests/skip_height_properties_test\n...\n./build/bin/test_bitcoin --run_test=chain_tests/skip_height_properties_test  0.32s user 0.02s system 27% cpu 1.269 total \n```",
      "created_at": "2025-11-03T12:02:49Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486242198",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486242198"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486256971",
      "pull_request_review_id": 3407000419,
      "id": 2486256971,
      "node_id": "PRRC_kwDOABII586UMUVL",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 64,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "how come we're iterating one less than before?\n\n```suggestion\n    for(int i = 1; i <= n; ++i) {\n```",
      "created_at": "2025-11-03T12:07:36Z",
      "updated_at": "2025-11-03T12:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486256971",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486256971"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486262621",
      "pull_request_review_id": 3407000419,
      "id": 2486262621,
      "node_id": "PRRC_kwDOABII586UMVtd",
      "diff_hunk": "",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can we add a fuzz test that asserts for all h > 0: `GetSkipHeight(h)` < h and [popcount](https://en.cppreference.com/w/cpp/numeric/popcount.html)(result) < [popcount](https://en.cppreference.com/w/cpp/numeric/popcount.html)(h) (and just skip 0 since that's already unit tested)?",
      "created_at": "2025-11-03T12:09:52Z",
      "updated_at": "2025-11-03T12:35:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486262621",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486262621"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 81,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486416019",
      "pull_request_review_id": 3410937114,
      "id": 2486416019,
      "node_id": "PRRC_kwDOABII586UM7KT",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {\n     if (height < 2)",
      "path": "src/chain.cpp",
      "position": 7,
      "original_position": 6,
      "commit_id": "0f6b58ba9a2989feac6292e74e2d721e35492051",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486172116,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Indeed, the input 2 also gives 0 as result. The intent may have been that got indices 0 and 1 it makes no sense to jump, for the rest follow the computation (but 2 accidentally also gives 0).\r\nIn any case, I don't want to change product behavior to the slightest in this PR.",
      "created_at": "2025-11-03T13:01:33Z",
      "updated_at": "2025-11-03T13:01:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486416019",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486416019"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 75,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486699478",
      "pull_request_review_id": 3411322792,
      "id": 2486699478,
      "node_id": "PRRC_kwDOABII586UOAXW",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 64,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486256971,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It doesn't make sense to check the skip for block index 0, that's why 0 is excluded.",
      "created_at": "2025-11-03T14:34:42Z",
      "updated_at": "2025-11-03T14:34:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486699478",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486699478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486708184",
      "pull_request_review_id": 3411334707,
      "id": 2486708184,
      "node_id": "PRRC_kwDOABII586UOCfY",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2483243259,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If it's inlined, it can't be used as extern from the test :(",
      "created_at": "2025-11-03T14:37:16Z",
      "updated_at": "2025-11-03T14:37:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486708184",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486708184"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486733227",
      "pull_request_review_id": 3411367909,
      "id": 2486733227,
      "node_id": "PRRC_kwDOABII586UOImr",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486188243,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I check the avg, which is computationally easier to obtain. It would make sense to check the median as well, and maybe compare the median with the average. However, I prefer to avoid the O(N log N) complexity of the sorting.",
      "created_at": "2025-11-03T14:44:38Z",
      "updated_at": "2025-11-03T14:44:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486733227",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486733227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486736452",
      "pull_request_review_id": 3411372069,
      "id": 2486736452,
      "node_id": "PRRC_kwDOABII586UOJZE",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486242198,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, nontheless I reduce the count from 30000 to 10000, that's also enough for the test.",
      "created_at": "2025-11-03T14:45:32Z",
      "updated_at": "2025-11-03T14:45:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486736452",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486736452"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486781519",
      "pull_request_review_id": 3411431905,
      "id": 2486781519,
      "node_id": "PRRC_kwDOABII586UOUZP",
      "diff_hunk": "@@ -41,6 +41,57 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 11,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "cdffd675d526bc0e1be85cfcd6b89ad1fe46cdfc",
      "in_reply_to_id": 2483265868,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Removed",
      "created_at": "2025-11-03T14:58:08Z",
      "updated_at": "2025-11-03T14:58:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486781519",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486781519"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 51,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486783350",
      "pull_request_review_id": 3411434435,
      "id": 2486783350,
      "node_id": "PRRC_kwDOABII586UOU12",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 21,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486181169,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I've adjusted the numbers used and added comments",
      "created_at": "2025-11-03T14:58:45Z",
      "updated_at": "2025-11-03T14:58:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486783350",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486783350"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486784728",
      "pull_request_review_id": 3411436566,
      "id": 2486784728,
      "node_id": "PRRC_kwDOABII586UOVLY",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486186460,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed to `BOOST_CHECK_EQUAL`, added comments",
      "created_at": "2025-11-03T14:59:13Z",
      "updated_at": "2025-11-03T14:59:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486784728",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486784728"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486787928",
      "pull_request_review_id": 3411441256,
      "id": 2486787928,
      "node_id": "PRRC_kwDOABII586UOV9Y",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 47,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486224185,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-11-03T15:00:15Z",
      "updated_at": "2025-11-03T15:00:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2486787928",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2486787928"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487011524",
      "pull_request_review_id": 3411731190,
      "id": 2487011524,
      "node_id": "PRRC_kwDOABII586UPMjE",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 64,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486256971,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "yeah, but why is n skipped (see my suggested code)",
      "created_at": "2025-11-03T16:01:23Z",
      "updated_at": "2025-11-03T16:01:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487011524",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487011524"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487015862",
      "pull_request_review_id": 3411737545,
      "id": 2487015862,
      "node_id": "PRRC_kwDOABII586UPNm2",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2483243259,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "how so, what's the failure you're seeing? It was working for me locally ",
      "created_at": "2025-11-03T16:02:35Z",
      "updated_at": "2025-11-03T16:02:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487015862",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487015862"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487024773",
      "pull_request_review_id": 3411750247,
      "id": 2487024773,
      "node_id": "PRRC_kwDOABII586UPPyF",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486188243,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "median is less sensitive to outliers  - and nlogn is fine in tests",
      "created_at": "2025-11-03T16:05:13Z",
      "updated_at": "2025-11-03T16:05:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487024773",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487024773"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487089474",
      "pull_request_review_id": 3411848203,
      "id": 2487089474,
      "node_id": "PRRC_kwDOABII586UPflC",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2483243259,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If `GetSkipHeight` is `inline`, I get the error:\r\n\r\n```\r\n[ 75%] Built target bitcoin-node\r\n/usr/bin/ld: CMakeFiles/test_bitcoin.dir/chain_tests.cpp.o: in function `chain_tests::get_skip_height_test::test_method()':\r\n/home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:50:(.text+0x68b): undefined reference to `GetSkipHeight(int)'\r\n/usr/bin/ld: /home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:51:(.text+0x7cf): undefined reference to `GetSkipHeight(int)'\r\n/usr/bin/ld: /home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:52:(.text+0x90c): undefined reference to `GetSkipHeight(int)'\r\n/usr/bin/ld: /home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:53:(.text+0xa49): undefined reference to `GetSkipHeight(int)'\r\n/usr/bin/ld: /home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:54:(.text+0xb86): undefined reference to `GetSkipHeight(int)'\r\n/usr/bin/ld: CMakeFiles/test_bitcoin.dir/chain_tests.cpp.o:/home/bitcoin/bitcoin-core/build/src/test/./test/chain_tests.cpp:55: more undefined references to `GetSkipHeight(int)' follow\r\ncollect2: error: ld returned 1 exit status\r\ngmake[2]: *** [src/test/CMakeFiles/test_bitcoin.dir/build.make:2463: bin/test_bitcoin] Error 1\r\n```\r\n\r\nInlined method is not included in the obj file as a method.\r\nThe solution would be to expose it through the header file, but I did not want to make that change just for the sake of the test.",
      "created_at": "2025-11-03T16:22:07Z",
      "updated_at": "2025-11-03T16:22:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487089474",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487089474"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487099898",
      "pull_request_review_id": 3411862703,
      "id": 2487099898,
      "node_id": "PRRC_kwDOABII586UPiH6",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 64,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486256971,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Oh, I see. There are in fact n+1 elements. Will change.",
      "created_at": "2025-11-03T16:25:08Z",
      "updated_at": "2025-11-03T16:25:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487099898",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487099898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487919199",
      "pull_request_review_id": 3413018685,
      "id": 2487919199,
      "node_id": "PRRC_kwDOABII586USqJf",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486186460,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Formatting them to be on top of each other as the above example shows allows easier bit comparison, otherwise the binary representation doesn't really help",
      "created_at": "2025-11-03T21:36:05Z",
      "updated_at": "2025-11-03T21:36:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487919199",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487919199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487946786",
      "pull_request_review_id": 3413053949,
      "id": 2487946786,
      "node_id": "PRRC_kwDOABII586USw4i",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 47,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486224185,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I see you've moved it as well, clang complains with:\r\n> Clangd: Moving a temporary object prevents copy elision",
      "created_at": "2025-11-03T21:49:50Z",
      "updated_at": "2025-11-03T21:49:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487946786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487946786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487950675",
      "pull_request_review_id": 3413058460,
      "id": 2487950675,
      "node_id": "PRRC_kwDOABII586USx1T",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486242198,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: consider formatting it as `10'000` for readability",
      "created_at": "2025-11-03T21:50:56Z",
      "updated_at": "2025-11-03T21:50:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487950675",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487950675"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487956680",
      "pull_request_review_id": 3413065209,
      "id": 2487956680,
      "node_id": "PRRC_kwDOABII586USzTI",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2483243259,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "interesting, it does work for me, but inline might indeed be problematic in this case.\r\nRemoving it should be fine, please resolve this comment.",
      "created_at": "2025-11-03T21:53:36Z",
      "updated_at": "2025-11-03T21:53:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2487956680",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2487956680"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489540239",
      "pull_request_review_id": 3415155636,
      "id": 2489540239,
      "node_id": "PRRC_kwDOABII586UY16P",
      "diff_hunk": "@@ -76,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 5,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2483243259,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Indeed. Inline is only a hint, not crucial for modern compliers.",
      "created_at": "2025-11-04T09:39:01Z",
      "updated_at": "2025-11-04T09:39:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489540239",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489540239"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489550775",
      "pull_request_review_id": 3415171019,
      "id": 2489550775,
      "node_id": "PRRC_kwDOABII586UY4e3",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486186460,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I did that for the longer values, for shorter values with only a few ones is not really need.",
      "created_at": "2025-11-04T09:40:46Z",
      "updated_at": "2025-11-04T09:40:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489550775",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489550775"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489552705",
      "pull_request_review_id": 3415173619,
      "id": 2489552705,
      "node_id": "PRRC_kwDOABII586UY49B",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486188243,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added median check as well. Much lower than the avg!",
      "created_at": "2025-11-04T09:41:07Z",
      "updated_at": "2025-11-04T09:41:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489552705",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489552705"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489553665",
      "pull_request_review_id": 3415174789,
      "id": 2489553665,
      "node_id": "PRRC_kwDOABII586UY5MB",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 60,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486192203,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added explanatory comments",
      "created_at": "2025-11-04T09:41:22Z",
      "updated_at": "2025-11-04T09:41:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489553665",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489553665"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489555855",
      "pull_request_review_id": 3415177769,
      "id": 2489555855,
      "node_id": "PRRC_kwDOABII586UY5uP",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 47,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486224185,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Oops, fixed!",
      "created_at": "2025-11-04T09:41:41Z",
      "updated_at": "2025-11-04T09:41:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489555855",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489555855"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 75,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 80,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489557279",
      "pull_request_review_id": 3415179572,
      "id": 2489557279,
      "node_id": "PRRC_kwDOABII586UY6Ef",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 50,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486242198,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2025-11-04T09:41:53Z",
      "updated_at": "2025-11-04T09:41:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489557279",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489557279"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489560183",
      "pull_request_review_id": 3415183031,
      "id": 2489560183,
      "node_id": "PRRC_kwDOABII586UY6x3",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 64,
      "commit_id": "19b87a8e9058f94685dc68e7b9090c2d6ccb960f",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486256971,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "All cycles go from 1 to n-1; 0 is the genesis.",
      "created_at": "2025-11-04T09:42:15Z",
      "updated_at": "2025-11-04T09:42:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489560183",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489560183"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 97,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489569251",
      "pull_request_review_id": 3415194147,
      "id": 2489569251,
      "node_id": "PRRC_kwDOABII586UY8_j",
      "diff_hunk": "",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486262621,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "A fuzz test for this functionality (essentially a one-liner) seems a bit too much.",
      "created_at": "2025-11-04T09:43:33Z",
      "updated_at": "2025-11-04T09:43:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2489569251",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2489569251"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 81,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490663038",
      "pull_request_review_id": 3416668206,
      "id": 2490663038,
      "node_id": "PRRC_kwDOABII586UdIB-",
      "diff_hunk": "@@ -41,6 +43,113 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with variouse even values with at least 2 bits set",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "original_commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "in_reply_to_id": null,
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\r\n    variouse -> various [spelling error in comment making the word invalid]\r\n",
      "created_at": "2025-11-04T14:06:51Z",
      "updated_at": "2025-11-04T14:06:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490663038",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490663038"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490689248",
      "pull_request_review_id": 3416706221,
      "id": 2490689248,
      "node_id": "PRRC_kwDOABII586UdObg",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486186460,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Can we do it for the shorter ones as well? it's easier to compare them and more consistent with the rest",
      "created_at": "2025-11-04T14:13:29Z",
      "updated_at": "2025-11-04T14:13:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490689248",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490689248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490696786",
      "pull_request_review_id": 3416717373,
      "id": 2490696786,
      "node_id": "PRRC_kwDOABII586UdQRS",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486188243,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The test became more complicated than it was before (which was my main critique of it, seems arbitrary).\r\nCould we simplify it? I think we're testing too many things, a single median check should likely suffice in my opinion.",
      "created_at": "2025-11-04T14:15:18Z",
      "updated_at": "2025-11-04T14:15:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490696786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490696786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490699922",
      "pull_request_review_id": 3416721752,
      "id": 2490699922,
      "node_id": "PRRC_kwDOABII586UdRCS",
      "diff_hunk": "@@ -41,6 +43,113 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with variouse even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010), 0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010), 0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010), 0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011), 0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0--10",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "original_commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "what does `--` mean here?",
      "created_at": "2025-11-04T14:15:58Z",
      "updated_at": "2025-11-04T14:15:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490699922",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490699922"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490707151",
      "pull_request_review_id": 3416731921,
      "id": 2490707151,
      "node_id": "PRRC_kwDOABII586UdSzP",
      "diff_hunk": "@@ -41,6 +43,113 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with variouse even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010), 0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010), 0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010), 0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011), 0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0--10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Collect the diff (in height) of each element and its pskip\n+    std::vector<int> skip_diffs;\n+    skip_diffs.reserve(n);\n+    for(int i{1}; i < n; ++i) {\n+        BOOST_REQUIRE_EQUAL(block_index[i]->nHeight, i);\n+        auto skip_height = block_index[i]->pskip->nHeight;\n+        BOOST_CHECK(skip_height <= i && skip_height >= 0);\n+        skip_diffs.push_back(i - skip_height);\n+    }\n+\n+    // Analyze the diffs\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(size_t i{0}; i < skip_diffs.size(); ++i) {\n+        auto diff = skip_diffs[i];\n+        if (diff < 16) {\n+            ++count_diff_smaller_16;\n+        }\n+        max_diff = diff > max_diff ? diff : max_diff;\n+        total_diff += diff;\n+    }\n+    auto avg = double(total_diff) / double(n);\n+    // Compute the median\n+    std::ranges::sort(skip_diffs);\n+    const int median{skip_diffs[n / 2]};\n+\n+    // Assert some parameters of the distribution\n+    // Values picked are rough to show proportions,\n+    // but general enough to be resilient to the exact test\n+    // details and algorithm\n+\n+    // The median skip diff is lower than the average\n+    BOOST_CHECK_LT(median, avg);\n+    // Most skip diffs are small (more than 67% are below 16):",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 110,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "original_commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I don't understand where `16` and the `67%` come from.\nCan we just keep the very last check of the median instead?",
      "created_at": "2025-11-04T14:17:49Z",
      "updated_at": "2025-11-04T14:17:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490707151",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490707151"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 143,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490708490",
      "pull_request_review_id": 3416733793,
      "id": 2490708490,
      "node_id": "PRRC_kwDOABII586UdTIK",
      "diff_hunk": "",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486262621,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "k, please resolve the comment",
      "created_at": "2025-11-04T14:18:11Z",
      "updated_at": "2025-11-04T14:18:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2490708490",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2490708490"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 81,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499080199",
      "pull_request_review_id": 3428340889,
      "id": 2499080199,
      "node_id": "PRRC_kwDOABII586U9PAH",
      "diff_hunk": "@@ -41,6 +43,113 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with variouse even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010), 0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010), 0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010), 0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011), 0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0--10",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "original_commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "in_reply_to_id": 2490699922,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\"0--10\" meant \"from 0 to 10 inclusive\". Changed to \"0-10\" to avoid parsing issues.",
      "created_at": "2025-11-06T14:02:32Z",
      "updated_at": "2025-11-06T14:02:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499080199",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499080199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499081771",
      "pull_request_review_id": 3428343129,
      "id": 2499081771,
      "node_id": "PRRC_kwDOABII586U9PYr",
      "diff_hunk": "@@ -41,6 +43,113 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with variouse even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010), 0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010), 0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000), 0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010), 0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001), 0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011), 0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0--10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Collect the diff (in height) of each element and its pskip\n+    std::vector<int> skip_diffs;\n+    skip_diffs.reserve(n);\n+    for(int i{1}; i < n; ++i) {\n+        BOOST_REQUIRE_EQUAL(block_index[i]->nHeight, i);\n+        auto skip_height = block_index[i]->pskip->nHeight;\n+        BOOST_CHECK(skip_height <= i && skip_height >= 0);\n+        skip_diffs.push_back(i - skip_height);\n+    }\n+\n+    // Analyze the diffs\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(size_t i{0}; i < skip_diffs.size(); ++i) {\n+        auto diff = skip_diffs[i];\n+        if (diff < 16) {\n+            ++count_diff_smaller_16;\n+        }\n+        max_diff = diff > max_diff ? diff : max_diff;\n+        total_diff += diff;\n+    }\n+    auto avg = double(total_diff) / double(n);\n+    // Compute the median\n+    std::ranges::sort(skip_diffs);\n+    const int median{skip_diffs[n / 2]};\n+\n+    // Assert some parameters of the distribution\n+    // Values picked are rough to show proportions,\n+    // but general enough to be resilient to the exact test\n+    // details and algorithm\n+\n+    // The median skip diff is lower than the average\n+    BOOST_CHECK_LT(median, avg);\n+    // Most skip diffs are small (more than 67% are below 16):",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 110,
      "commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "original_commit_id": "6adafaa721ae8426b0ad3c511712f5c2757d01ec",
      "in_reply_to_id": 2490707151,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The checks have been simplified, usage of \"magic numbers\" reduced.",
      "created_at": "2025-11-06T14:03:04Z",
      "updated_at": "2025-11-06T14:03:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499081771",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499081771"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 143,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499361757",
      "pull_request_review_id": 3428711246,
      "id": 2499361757,
      "node_id": "PRRC_kwDOABII586U-Tvd",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Collect the diff (in height) of each element and its pskip\n+    std::vector<int> skip_diffs;\n+    skip_diffs.reserve(n);\n+    for(int i{1}; i < n; ++i) {\n+        BOOST_REQUIRE_EQUAL(block_index[i]->nHeight, i);\n+        auto skip_height = block_index[i]->pskip->nHeight;\n+        BOOST_CHECK(skip_height <= i && skip_height >= 0);\n+        skip_diffs.push_back(i - skip_height);\n+    }\n+\n+    // Analyze the diffs\n+    // Compute the average\n+    const auto avg = double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / double(skip_diffs.size());",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 104,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: below we're using brace init + dividing a `double` by a `size_t` is also double-division (untested):\n```suggestion\n    const auto avg{double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / skip_diffs.size()};\n```",
      "created_at": "2025-11-06T15:09:41Z",
      "updated_at": "2025-11-06T15:14:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499361757",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499361757"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 135,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499366014",
      "pull_request_review_id": 3428711246,
      "id": 2499366014,
      "node_id": "PRRC_kwDOABII586U-Ux-",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Collect the diff (in height) of each element and its pskip\n+    std::vector<int> skip_diffs;\n+    skip_diffs.reserve(n);\n+    for(int i{1}; i < n; ++i) {\n+        BOOST_REQUIRE_EQUAL(block_index[i]->nHeight, i);\n+        auto skip_height = block_index[i]->pskip->nHeight;\n+        BOOST_CHECK(skip_height <= i && skip_height >= 0);\n+        skip_diffs.push_back(i - skip_height);\n+    }\n+\n+    // Analyze the diffs\n+    // Compute the average\n+    const auto avg = double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / double(skip_diffs.size());\n+    // Compute the median\n+    std::ranges::sort(skip_diffs);\n+    const auto median{skip_diffs[n / 2]};\n+    // Take the maximum\n+    const auto max{skip_diffs[skip_diffs.size() - 1]};\n+\n+    // Assert some parameters of the distribution",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 111,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: redundant comment (there a few more)",
      "created_at": "2025-11-06T15:10:41Z",
      "updated_at": "2025-11-06T15:15:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499366014",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499366014"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499367082",
      "pull_request_review_id": 3428711246,
      "id": 2499367082,
      "node_id": "PRRC_kwDOABII586U-VCq",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Collect the diff (in height) of each element and its pskip\n+    std::vector<int> skip_diffs;\n+    skip_diffs.reserve(n);\n+    for(int i{1}; i < n; ++i) {\n+        BOOST_REQUIRE_EQUAL(block_index[i]->nHeight, i);\n+        auto skip_height = block_index[i]->pskip->nHeight;\n+        BOOST_CHECK(skip_height <= i && skip_height >= 0);\n+        skip_diffs.push_back(i - skip_height);\n+    }\n+\n+    // Analyze the diffs\n+    // Compute the average\n+    const auto avg = double(std::accumulate(skip_diffs.begin(), skip_diffs.end(), 0)) / double(skip_diffs.size());\n+    // Compute the median\n+    std::ranges::sort(skip_diffs);\n+    const auto median{skip_diffs[n / 2]};\n+    // Take the maximum",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 108,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: redudnant comment, the code already expresses this clearly",
      "created_at": "2025-11-06T15:10:57Z",
      "updated_at": "2025-11-06T15:14:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499367082",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499367082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 139,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499375298",
      "pull_request_review_id": 3428711246,
      "id": 2499375298,
      "node_id": "PRRC_kwDOABII586U-XDC",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: should likely be a `BOOST_REQUIRE` since this is still the setup phase, not yet the validation stage",
      "created_at": "2025-11-06T15:12:37Z",
      "updated_at": "2025-11-06T15:15:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2499375298",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2499375298"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602500003",
      "pull_request_review_id": 3557237798,
      "id": 2602500003,
      "node_id": "PRRC_kwDOABII586bHv-j",
      "diff_hunk": "@@ -70,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: clang-format this line, while touching. (leaving this nit, because the CI has to be re-run anyway)\n\n```diff\n+int GetSkipHeight(int height)\n+{\n```",
      "created_at": "2025-12-09T12:46:17Z",
      "updated_at": "2025-12-09T12:46:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2602500003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2602500003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2609436783",
      "pull_request_review_id": 3566034128,
      "id": 2609436783,
      "node_id": "PRRC_kwDOABII586biNhv",
      "diff_hunk": "@@ -70,7 +76,7 @@ CBlockIndex* CChain::FindEarliestAtLeast(int64_t nTime, int height) const\n int static inline InvertLowestOne(int n) { return n & (n - 1); }\n \n /** Compute what height to jump back to with the CBlockIndex::pskip pointer. */\n-int static inline GetSkipHeight(int height) {\n+int GetSkipHeight(int height) {",
      "path": "src/chain.cpp",
      "position": 1,
      "original_position": 18,
      "commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "original_commit_id": "e2e25f4947e65869b014483be70b764a62bd0df7",
      "in_reply_to_id": 2602500003,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I kept the change minimal, but since the line is touched, I've adjusted the curly brace placement to be consistent, as suggested.",
      "created_at": "2025-12-11T07:09:33Z",
      "updated_at": "2025-12-11T07:09:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2609436783",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2609436783"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614369333",
      "pull_request_review_id": 3572005492,
      "id": 2614369333,
      "node_id": "PRRC_kwDOABII586b1Bw1",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 119,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Could unify these to `BOOST_REQUIRE` instead of `assert`",
      "created_at": "2025-12-12T14:19:42Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614369333",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614369333"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614370366",
      "pull_request_review_id": 3572005492,
      "id": 2614370366,
      "node_id": "PRRC_kwDOABII586b1CA-",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 121,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "return value isn't needed, could be simplified to:\n\n```suggestion\n                --heightWalk;\n```",
      "created_at": "2025-12-12T14:20:01Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614370366",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614370366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614371127",
      "pull_request_review_id": 3572005492,
      "id": 2614371127,
      "node_id": "PRRC_kwDOABII586b1CM3",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 129,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\n        BOOST_REQUIRE_GT(delta, 0);\n```\n\nAnd if we keep this, it could go closer to the `delta` declaration",
      "created_at": "2025-12-12T14:20:17Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614371127",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614371127"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614382057",
      "pull_request_review_id": 3572005492,
      "id": 2614382057,
      "node_id": "PRRC_kwDOABII586b1E3p",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 96,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "To make sure we don't have signed/unsigned problems here (since we're subtracting from this later), we might as well make it explicitly `int`:\n\n```suggestion\n        int start_height{chain_size / 2 + ctx.randrange(chain_size / 2)};\n```\n\nActually we could reduce duplication if we subtract from the end instead:\n```suggestion\n        const int start_height{(chain_size - 1) - ctx.randrange(chain_size / 2)};       // pick a height in the second half of the chain\n```",
      "created_at": "2025-12-12T14:23:28Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614382057",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614382057"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 129,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614388593",
      "pull_request_review_id": 3572005492,
      "id": 2614388593,
      "node_id": "PRRC_kwDOABII586b1Gdx",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 98,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "can you use brace init consistently to avoid narrowing? And corecheck suggests const reference - though we can likely inline it instead...",
      "created_at": "2025-12-12T14:25:12Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614388593",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614388593"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 131,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614408109",
      "pull_request_review_id": 3572005492,
      "id": 2614408109,
      "node_id": "PRRC_kwDOABII586b1LOt",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "b101a5a14beb11178f5a22cf758b0ace9efcc53f",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think you mean that the second and third **set** bits are zerod, right?\n```C++\n    // Even heights: clear the lowest set bit.\n...\n    // Odd heights: clear the 2nd and 3rd set bits.\n```",
      "created_at": "2025-12-12T14:31:18Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614408109",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614408109"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614428365",
      "pull_request_review_id": 3572005492,
      "id": 2614428365,
      "node_id": "PRRC_kwDOABII586b1QLN",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 97,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This may be useful during development, but it's basically testing the testing logic itself, isn't it? If you keep them, can you add them after the initializations to have separate init and check sections, something like:\n```C++\nconst int start_height{(chain_size - 1) - ctx.randrange(chain_size / 2)};       // pick a height in the second half of the chain\nconst int delta{min_distance + ctx.randrange(start_height - min_distance + 1)}; // pick a target height, earlier by at least min_distance\nconst int target_height{start_height - delta};\n\nBOOST_REQUIRE(start_height > 0 && start_height < chain_size);\nBOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\nBOOST_REQUIRE(delta > 0);\n```",
      "created_at": "2025-12-12T14:37:00Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614428365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614428365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 130,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614446552",
      "pull_request_review_id": 3572005492,
      "id": 2614446552,
      "node_id": "PRRC_kwDOABII586b1UnY",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 105,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "it seems to me we can inline `start_p` here:\n\n```suggestion\n        const auto* pindexWalk{block_index[start_height].get()};\n```",
      "created_at": "2025-12-12T14:42:53Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614446552",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614446552"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 138,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614448211",
      "pull_request_review_id": 3572005492,
      "id": 2614448211,
      "node_id": "PRRC_kwDOABII586b1VBT",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 108,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: we could reduce the scope of the iteration-only variables:\n```C++\nint iteration_count{0};\nfor (int height_walk{start_height}; height_walk > target_height; ++iteration_count) {\n```\n\nnit: `heightWalk` -> `height_walk`",
      "created_at": "2025-12-12T14:43:25Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614448211",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614448211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 139,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 141,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614455685",
      "pull_request_review_id": 3572005492,
      "id": 2614455685,
      "node_id": "PRRC_kwDOABII586b1W2F",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 127,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "why 100 and why 5%? The numbers are already visible in the code, but not sure why - can we have that in the comment instead?\n\nThe 5% doesn't seem to hold for non-deterministic random - seems arbitrary.\nNeither does the `100` - so my suspicion seems to have been accurate that these aren't real properties of the system, just accidental ones of the sample.",
      "created_at": "2025-12-12T14:45:51Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614455685",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614455685"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614473206",
      "pull_request_review_id": 3572005492,
      "id": 2614473206,
      "node_id": "PRRC_kwDOABII586b1bH2",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 110,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Given that we've already called `BuildSkip`, do we need to test this directly or can we do it indirectly as well?\n\n```suggestion\n            const int height_skip{pindexWalk->pskip->nHeight};\n            const int height_skip_prev{pindexWalk->pprev->pskip->nHeight};\n```",
      "created_at": "2025-12-12T14:51:03Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614473206",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614473206"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 142,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 143,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614478946",
      "pull_request_review_id": 3572005492,
      "id": 2614478946,
      "node_id": "PRRC_kwDOABII586b1chi",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+\n+        // Since we are at it, we can also check that `GetAncestor` works\n+        // and gives the same result",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 134,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If you insist on the comment - though it duplicates what the code already does\n```suggestion\n        // Check that `GetAncestor` works and gives the same result\n```",
      "created_at": "2025-12-12T14:52:25Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614478946",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614478946"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 166,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614487478",
      "pull_request_review_id": 3572005492,
      "id": 2614487478,
      "node_id": "PRRC_kwDOABII586b1em2",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 93,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "making it deterministic kinda' defeats the purpose in my opinion (it's a low bar to construct something that accidentally works, a lot more difficult to find the exact properties of a system that work less predictable values)\n\nnit: extra space before `=`",
      "created_at": "2025-12-12T14:54:11Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614487478",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614487478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614517724",
      "pull_request_review_id": 3572005492,
      "id": 2614517724,
      "node_id": "PRRC_kwDOABII586b1l_c",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\n        new_index->nHeight = i;\n```",
      "created_at": "2025-12-12T15:00:09Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614517724",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614517724"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614541661",
      "pull_request_review_id": 3572005492,
      "id": 2614541661,
      "node_id": "PRRC_kwDOABII586b1r1d",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 131,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "can we avoid floating point arithmetic here?\n\n```suggestion\n        BOOST_CHECK_LT(iteration_count * 20, delta);\n```",
      "created_at": "2025-12-12T15:05:09Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614541661",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614541661"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 163,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 164,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614778816",
      "pull_request_review_id": 3572005492,
      "id": 2614778816,
      "node_id": "PRRC_kwDOABII586b2lvA",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 81,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "genesis is only special that it's the head of the linked list, right? We could include that in the loop:\n```C++\n    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n    block_index.reserve(chain_size);\n    for (int i{0}; i < chain_size; ++i) {\n        auto index{std::make_unique<CBlockIndex>()};\n        index->pprev = i ? block_index.back().get() : nullptr;\n        index->nHeight = i;\n        index->BuildSkip();\n        block_index.push_back(std::move(index));\n    }\n```",
      "created_at": "2025-12-12T16:05:14Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614778816",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614778816"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 113,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614900634",
      "pull_request_review_id": 3572005492,
      "id": 2614900634,
      "node_id": "PRRC_kwDOABII586b3Dea",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+\n+        // Since we are at it, we can also check that `GetAncestor` works\n+        // and gives the same result\n+        auto p_ancestor = start_p->GetAncestor(target_height);\n+        BOOST_CHECK_EQUAL(p_ancestor, block_index[target_height].get());\n+    }\n+}",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 138,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we have some checks in the while, some after, but we don't have a check for all runs - we could add whether we saw both skips and prevs, something like:\n```C++\n    bool saw_skip{false}, saw_prev{false};\n...\n    for (int run{0}; run < 1'000; ++run) {\n...\n        for (int height_walk{start_height}; height_walk > target_height; ++iteration_count) {\n...\n            if (skip && ... {\n                saw_skip |= true;\n            } else {\n                saw_prev |= true;\n            }\n...\n    BOOST_CHECK(saw_skip && saw_prev);\n```",
      "created_at": "2025-12-12T16:42:39Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614900634",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614900634"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 171,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614926276",
      "pull_request_review_id": 3572005492,
      "id": 2614926276,
      "node_id": "PRRC_kwDOABII586b3JvE",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 115,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Instead of commenting, can we extract the logic to variables that explain what happens here?\r\nAfter a lot of fiddling with this part, it seems to me this may explain it a bit better:\r\n```C++\r\n// Perform traversal from start to target, skipping, as implemented in `GetAncestor`\r\nconst auto* pindex_walk{block_index[start_height].get()};\r\nint iteration_count{0};\r\nfor (int height_walk{start_height}; height_walk > target_height; ++iteration_count) {\r\n    BOOST_REQUIRE(pindex_walk);\r\n    const auto* const prev{Assert(pindex_walk->pprev)};\r\n    const auto* const skip{Assert(pindex_walk->pskip)};\r\n    BOOST_REQUIRE(prev->pskip);\r\n\r\n    const bool prev_skip_better{prev->pskip->nHeight >= target_height && prev->pskip->nHeight < skip->nHeight - 2};\r\n    if (skip->nHeight == target_height || (skip->nHeight > target_height && !prev_skip_better)) {\r\n        saw_skip = true;\r\n        pindex_walk = skip;\r\n        BOOST_REQUIRE(skip->nHeight < height_walk);\r\n        height_walk = skip->nHeight;\r\n    } else {\r\n        saw_prev = true;\r\n        pindex_walk = prev;\r\n        --height_walk;\r\n    }\r\n    BOOST_REQUIRE(height_walk >= target_height && height_walk == pindex_walk->nHeight);\r\n}\r\n```",
      "created_at": "2025-12-12T16:50:44Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614926276",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614926276"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 144,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614929872",
      "pull_request_review_id": 3572005492,
      "id": 2614929872,
      "node_id": "PRRC_kwDOABII586b3KnQ",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 92,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This will make boundary conditions less likely, running it with `constexpr int min_distance{100};` revealed new failures for the randomized case for me locally.",
      "created_at": "2025-12-12T16:51:56Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614929872",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614929872"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614931797",
      "pull_request_review_id": 3572005492,
      "id": 2614931797,
      "node_id": "PRRC_kwDOABII586b3LFV",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 91,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think we can safely inline this if we call the loop iteration `run`:\n```C++\n    for (int run{0}; run < 1'000; ++run) {\n```",
      "created_at": "2025-12-12T16:52:29Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614931797",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614931797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614983210",
      "pull_request_review_id": 3572005492,
      "id": 2614983210,
      "node_id": "PRRC_kwDOABII586b3Xoq",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we should assert that this will always converge towards genesis (i.e. it's decreasing):\n```C++\n                BOOST_REQUIRE(skip->nHeight < height_walk);\n```",
      "created_at": "2025-12-12T17:08:59Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614983210",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614983210"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614990166",
      "pull_request_review_id": 3572005492,
      "id": 2614990166,
      "node_id": "PRRC_kwDOABII586b3ZVW",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 74,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "\"much lower\" sounds very subjective and I couldn't find an obvious asymptote - can we just assert that it's always lower? Maybe we can use the `110` from `GetSkipHeight` as an upper limit instead",
      "created_at": "2025-12-12T17:11:25Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2614990166",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2614990166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 101,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2615067943",
      "pull_request_review_id": 3572005492,
      "id": 2615067943,
      "node_id": "PRRC_kwDOABII586b3sUn",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 66,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Seems fast enough:\n> ./build/bin/test_bitcoin --run_test=chain_tests/skip_height_analysis  0.53s user 0.02s system 32% cpu 1.714 total ",
      "created_at": "2025-12-12T17:39:27Z",
      "updated_at": "2025-12-12T17:43:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2615067943",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2615067943"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 99,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620370956",
      "pull_request_review_id": 3579522590,
      "id": 2620370956,
      "node_id": "PRRC_kwDOABII586cL7AM",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 119,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614369333,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The traversal code is copied `CBlockIndex::GetAncestor()`, hence the `assert`. Changed to `BOOST_REQUIRE`.",
      "created_at": "2025-12-15T18:09:14Z",
      "updated_at": "2025-12-15T18:09:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620370956",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620370956"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 152,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620372476",
      "pull_request_review_id": 3579524506,
      "id": 2620372476,
      "node_id": "PRRC_kwDOABII586cL7X8",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 121,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614370366,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "As this code is copied, and not so important, I leave it as it is.",
      "created_at": "2025-12-15T18:09:53Z",
      "updated_at": "2025-12-15T18:09:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620372476",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620372476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620379736",
      "pull_request_review_id": 3579533713,
      "id": 2620379736,
      "node_id": "PRRC_kwDOABII586cL9JY",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 129,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614371127,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This check protects the next line, which divides by `delta`. I keep the check just before it is needed. Changed `BOOST_REQUIRE` to `BOOST_REQUIRE_GT`",
      "created_at": "2025-12-15T18:12:19Z",
      "updated_at": "2025-12-15T18:12:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620379736",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620379736"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620380361",
      "pull_request_review_id": 3579534526,
      "id": 2620380361,
      "node_id": "PRRC_kwDOABII586cL9TJ",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 96,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614382057,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed.",
      "created_at": "2025-12-15T18:12:34Z",
      "updated_at": "2025-12-15T18:12:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620380361",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620380361"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 129,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620386541",
      "pull_request_review_id": 3579541479,
      "id": 2620386541,
      "node_id": "PRRC_kwDOABII586cL-zt",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 29,
      "commit_id": "b101a5a14beb11178f5a22cf758b0ace9efcc53f",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614408109,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Yes, that's how it was meant, I added the clarification! ",
      "created_at": "2025-12-15T18:14:35Z",
      "updated_at": "2025-12-15T18:14:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620386541",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620386541"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 62,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620388727",
      "pull_request_review_id": 3579544115,
      "id": 2620388727,
      "node_id": "PRRC_kwDOABII586cL_V3",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 121,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614370366,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "We usually prefer new code be added according to the best practices instead of surrounding code - the history doesn't matter, see:\r\nhttps://github.com/bitcoin/bitcoin/blob/fa4395dffd432b999002dfd24eb6f8d7384fbcbe/doc/developer-notes.md?plain=1#L7-L8",
      "created_at": "2025-12-15T18:15:22Z",
      "updated_at": "2025-12-15T18:15:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620388727",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620388727"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620390358",
      "pull_request_review_id": 3579546256,
      "id": 2620390358,
      "node_id": "PRRC_kwDOABII586cL_vW",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 105,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614446552,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It is saved in a local variable because it is also used at the end of the test method (`auto p_ancestor{start_p->GetAncestor(target_height)};`)",
      "created_at": "2025-12-15T18:16:05Z",
      "updated_at": "2025-12-15T18:16:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620390358",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620390358"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 138,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620391520",
      "pull_request_review_id": 3579547651,
      "id": 2620391520,
      "node_id": "PRRC_kwDOABII586cMABg",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 108,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614448211,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I rather keep it to match the original code.",
      "created_at": "2025-12-15T18:16:34Z",
      "updated_at": "2025-12-15T18:16:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620391520",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620391520"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 139,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 141,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620392793",
      "pull_request_review_id": 3579549290,
      "id": 2620392793,
      "node_id": "PRRC_kwDOABII586cMAVZ",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 110,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614473206,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Same here, I'd rather keep it to match the original code.",
      "created_at": "2025-12-15T18:17:09Z",
      "updated_at": "2025-12-15T18:17:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620392793",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620392793"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 142,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 143,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620393554",
      "pull_request_review_id": 3579550312,
      "id": 2620393554,
      "node_id": "PRRC_kwDOABII586cMAhS",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+\n+        // Since we are at it, we can also check that `GetAncestor` works\n+        // and gives the same result",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 134,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614478946,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed",
      "created_at": "2025-12-15T18:17:30Z",
      "updated_at": "2025-12-15T18:17:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620393554",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620393554"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 166,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 167,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620397797",
      "pull_request_review_id": 3579555425,
      "id": 2620397797,
      "node_id": "PRRC_kwDOABII586cMBjl",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614517724,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Makes sense, but I keep it as it is. This way it shows better, the for each object `nHeight = pprev->nHieght + 1` holds. Plus this is done the same way in the original `chain_test` test.",
      "created_at": "2025-12-15T18:19:14Z",
      "updated_at": "2025-12-15T18:19:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620397797",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620397797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 119,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620400066",
      "pull_request_review_id": 3579558352,
      "id": 2620400066,
      "node_id": "PRRC_kwDOABII586cMCHC",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 131,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614541661,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think this makes the intent a bit less clear, and performance is not crucial in this line.",
      "created_at": "2025-12-15T18:20:05Z",
      "updated_at": "2025-12-15T18:20:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620400066",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620400066"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 163,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 164,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620402830",
      "pull_request_review_id": 3579561791,
      "id": 2620402830,
      "node_id": "PRRC_kwDOABII586cMCyO",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 81,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614778816,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Makes sense, but it make sense to keep the genesis special in this test.",
      "created_at": "2025-12-15T18:21:09Z",
      "updated_at": "2025-12-15T18:21:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620402830",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620402830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 113,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620404818",
      "pull_request_review_id": 3579564439,
      "id": 2620404818,
      "node_id": "PRRC_kwDOABII586cMDRS",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance\n+        BOOST_CHECK_LT(iteration_count, 100);\n+        BOOST_REQUIRE(delta > 0);\n+        auto rel_iter_count = double(iteration_count) / double(delta);\n+        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+\n+        // Since we are at it, we can also check that `GetAncestor` works\n+        // and gives the same result\n+        auto p_ancestor = start_p->GetAncestor(target_height);\n+        BOOST_CHECK_EQUAL(p_ancestor, block_index[target_height].get());\n+    }\n+}",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 138,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614900634,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It's sufficient if all test runs are OK, I don't see what could be checked across all the runs.",
      "created_at": "2025-12-15T18:22:03Z",
      "updated_at": "2025-12-15T18:22:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620404818",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620404818"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 171,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620406067",
      "pull_request_review_id": 3579565931,
      "id": 2620406067,
      "node_id": "PRRC_kwDOABII586cMDkz",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 115,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614926276,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Again, not changed, copied code.",
      "created_at": "2025-12-15T18:22:32Z",
      "updated_at": "2025-12-15T18:22:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620406067",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620406067"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 144,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 148,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620410264",
      "pull_request_review_id": 3579571929,
      "id": 2620410264,
      "node_id": "PRRC_kwDOABII586cMEmY",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 92,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614929872,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The shorter the runs, the more variation there is. The ratio depends on the length (probably a log relationship). Performance-wise the long traversals are interested, that's why I put a min distance limit.",
      "created_at": "2025-12-15T18:24:16Z",
      "updated_at": "2025-12-15T18:24:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620410264",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620410264"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620410770",
      "pull_request_review_id": 3579572560,
      "id": 2620410770,
      "node_id": "PRRC_kwDOABII586cMEuS",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 91,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614931797,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed.",
      "created_at": "2025-12-15T18:24:28Z",
      "updated_at": "2025-12-15T18:24:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620410770",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620410770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620420093",
      "pull_request_review_id": 3579585935,
      "id": 2620420093,
      "node_id": "PRRC_kwDOABII586cMG_9",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 92,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614929872,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "On average, when considering all pairs of heights (x,y), with $0 \\leq x \\leq y \\leq N$, I believe the average number of steps scales roughly as $\\log^2(N)$.",
      "created_at": "2025-12-15T18:27:52Z",
      "updated_at": "2025-12-15T18:27:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620420093",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620420093"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620430049",
      "pull_request_review_id": 3579598056,
      "id": 2620430049,
      "node_id": "PRRC_kwDOABII586cMJbh",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614983210,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "It should hold, but validating the traversal algorithm is not the primary aim, and I prefer to keep the duplicated code as close as possible. For this test it is relevant that the traversal completes in a finite number of steps.",
      "created_at": "2025-12-15T18:31:30Z",
      "updated_at": "2025-12-15T18:31:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2620430049",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2620430049"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622662028",
      "pull_request_review_id": 3582346095,
      "id": 2622662028,
      "node_id": "PRRC_kwDOABII586cUqWM",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 121,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614370366,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed.",
      "created_at": "2025-12-16T10:17:53Z",
      "updated_at": "2025-12-16T10:17:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622662028",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622662028"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 154,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622668585",
      "pull_request_review_id": 3582353366,
      "id": 2622668585,
      "node_id": "PRRC_kwDOABII586cUr8p",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 98,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614388593,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed.",
      "created_at": "2025-12-16T10:19:51Z",
      "updated_at": "2025-12-16T10:19:51Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622668585",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622668585"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 131,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622670394",
      "pull_request_review_id": 3582355462,
      "id": 2622670394,
      "node_id": "PRRC_kwDOABII586cUsY6",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 97,
      "commit_id": "930125cadb1555368127a0d9a1f77309d317276e",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614428365,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done; delta check no longer needed.",
      "created_at": "2025-12-16T10:20:24Z",
      "updated_at": "2025-12-16T10:20:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622670394",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622670394"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 130,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622675646",
      "pull_request_review_id": 3582361597,
      "id": 2622675646,
      "node_id": "PRRC_kwDOABII586cUtq-",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;\n+            } else {\n+                assert(pindexWalk->pprev);\n+                pindexWalk = pindexWalk->pprev;\n+                heightWalk--;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // always less than 100 and less than 5% of the distance",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 127,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614455685,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "These were empirically derived values. I've adjusted them, see https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659695776 .",
      "created_at": "2025-12-16T10:21:59Z",
      "updated_at": "2025-12-16T10:22:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622675646",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622675646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622688519",
      "pull_request_review_id": 3582377723,
      "id": 2622688519,
      "node_id": "PRRC_kwDOABII586cUw0H",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 93,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614487478,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Non-deterministic unit tests are a bad practice, they can result in tests passing locally, but fail occasionally in CI, which is a pain.\r\nDeterministic random is a good way to make an unbiased selection out of a huge number of possibilities (which would be too slow to test). I disagree that deterministic selection defeats the purpose. (Glancing at the chart attached shows that it covers the problem space well.)",
      "created_at": "2025-12-16T10:25:59Z",
      "updated_at": "2025-12-16T10:26:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622688519",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622688519"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622694508",
      "pull_request_review_id": 3582384495,
      "id": 2622694508,
      "node_id": "PRRC_kwDOABII586cUyRs",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 92,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614929872,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Details in https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3659695776",
      "created_at": "2025-12-16T10:27:48Z",
      "updated_at": "2025-12-16T10:27:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622694508",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622694508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622700110",
      "pull_request_review_id": 3582391233,
      "id": 2622700110,
      "node_id": "PRRC_kwDOABII586cUzpO",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 92,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614929872,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> This will make boundary conditions less likely, running it with `constexpr int min_distance{100};` revealed new failures for the randomized case for me locally.\r\n\r\nThe \"5%\" rule was very rough, and broke with short distances, you are right. I added it as the global maximum check does not enforce much for short distances. But now the formula-based boundary is stricter over a wide range of distance values.",
      "created_at": "2025-12-16T10:29:34Z",
      "updated_at": "2025-12-16T10:29:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622700110",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622700110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 125,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622704514",
      "pull_request_review_id": 3582396312,
      "id": 2622704514,
      "node_id": "PRRC_kwDOABII586cU0uC",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    for (auto i{0}; i < runs; ++i) {\n+        // pick a height in the second half of the chain\n+        auto start_height = chain_size / 2 + ctx.randrange(chain_size / 2);\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        auto& start_p = block_index[start_height];\n+        // pick a target height, earlier by at least min_distance\n+        auto delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        auto target_height{start_height - delta};\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const CBlockIndex* pindexWalk = start_p.get();\n+        auto heightWalk = start_height;\n+        auto iteration_count{0};\n+        while (heightWalk > target_height) {\n+            int heightSkip = GetSkipHeight(heightWalk);\n+            int heightSkipPrev = GetSkipHeight(heightWalk - 1);\n+            if (pindexWalk->pskip != nullptr &&\n+                (heightSkip == target_height ||\n+                (heightSkip > target_height && !(heightSkipPrev < heightSkip - 2 &&\n+                                        heightSkipPrev >= target_height)))) {\n+                // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+                pindexWalk = pindexWalk->pskip;\n+                heightWalk = heightSkip;",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 117,
      "commit_id": "2f77d8dd91a87071bc01cfb5b68f01ab176f06f7",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614983210,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Added now.",
      "created_at": "2025-12-16T10:30:56Z",
      "updated_at": "2025-12-16T10:30:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622704514",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622704514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 150,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622707670",
      "pull_request_review_id": 3582400200,
      "id": 2622707670,
      "node_id": "PRRC_kwDOABII586cU1fW",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 74,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614990166,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Now there is a upper-bound formula that quantifies how much lower.",
      "created_at": "2025-12-16T10:31:53Z",
      "updated_at": "2025-12-16T10:31:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622707670",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622707670"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": 101,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622711754",
      "pull_request_review_id": 3582405214,
      "id": 2622711754,
      "node_id": "PRRC_kwDOABII586cU2fK",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 93,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614487478,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "when those tests fail they should uncover an actual bug, so I'd argue that's very useful.\r\nIf they don't, the test wasn't really exercising the algorithm but was testing a special case only, so it was deceptive.",
      "created_at": "2025-12-16T10:33:05Z",
      "updated_at": "2025-12-16T10:33:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622711754",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622711754"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622853250",
      "pull_request_review_id": 3582566986,
      "id": 2622853250,
      "node_id": "PRRC_kwDOABII586cVZCC",
      "diff_hunk": "@@ -41,6 +43,133 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `GetAncestor` function to\n+    // look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+\n+    // Build a chain\n+    const auto chain_size{200'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {\n+        auto new_index{std::make_unique<CBlockIndex>()};\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    const auto runs{1000};\n+    const auto min_distance{500};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 93,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2a1a0f9d89fb1713cbba8739e9212633f5d092b6",
      "in_reply_to_id": 2614487478,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In my opinion (unit) tests executed in a gating CI should be 100% reproducible. We may disagree on this, which is fine :)  There is not much difference between a single run of a randomized test using a fixed seed vs. a variable (e.g. time-based). Multiple runs with the non-fixed seed will cover different input, that's true, but they will be hard to reproduce.\r\nImagine a random test that has a chance to fail once in every 1000 runs. It can be annoying if it fails suddenly in someone's PR. Also it's very difficult to reproduce to analyze it (unless the seed is recorded, which is usually not the case). The failure may be due to a test issue, but it may also have caught a long-hidden bug. A robust and reliable test harness is very valuable from software engineering point of view.\r\n",
      "created_at": "2025-12-16T11:14:31Z",
      "updated_at": "2025-12-16T11:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2622853250",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2622853250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2754668449",
      "pull_request_review_id": 3739829097,
      "id": 2754668449,
      "node_id": "PRRC_kwDOABII586kMOeh",
      "diff_hunk": "@@ -108,11 +109,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         // End of copied traversal algorithm\n \n         // Asserts on the number of iterations:\n-        // always less than 100 and less than 5% of the distance\n-        BOOST_CHECK_LT(iteration_count, 100);\n-        BOOST_REQUIRE_GT(delta, 0);\n-        const auto rel_iter_count{double(iteration_count) / double(delta)};\n-        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+        // Absolute value maximum (derived empirically)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "these were introduced in the previous commit, could you merge them or separate the commits differently? Or if you think there's an advantage in introducing something that gets changed immediately, can you please provide the reasoning for it?",
      "created_at": "2026-02-02T14:38:41Z",
      "updated_at": "2026-02-02T14:38:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2754668449",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2754668449"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755426311",
      "pull_request_review_id": 3740859182,
      "id": 2755426311,
      "node_id": "PRRC_kwDOABII586kPHgH",
      "diff_hunk": "@@ -9,6 +9,8 @@\n \n #include <memory>\n \n+extern int GetSkipHeight(int height);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "ca2c9bc63e759a065d6b15fe77d4a9d81feb0012",
      "original_commit_id": "ca2c9bc63e759a065d6b15fe77d4a9d81feb0012",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit \"Add indirect test for skip height through ancestor search\"\n\nI think it's cleaner to put this declaration in `chain.h`, even if it's just a test-only function. As-is, if the function declaration is changed in just one of the two places, it won't be detected until link time.",
      "created_at": "2026-02-02T17:17:59Z",
      "updated_at": "2026-02-02T17:27:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2755426311",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755426311"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755451014",
      "pull_request_review_id": 3740859182,
      "id": 2755451014,
      "node_id": "PRRC_kwDOABII586kPNiG",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In commit \"Adjust test selection parameters and checks, use log(distance)-derived formula\"\n\nThis comment seems outdated.",
      "created_at": "2026-02-02T17:23:10Z",
      "updated_at": "2026-02-02T17:27:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2755451014",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755451014"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755466952",
      "pull_request_review_id": 3740859182,
      "id": 2755466952,
      "node_id": "PRRC_kwDOABII586kPRbI",
      "diff_hunk": "@@ -108,11 +109,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         // End of copied traversal algorithm\n \n         // Asserts on the number of iterations:\n-        // always less than 100 and less than 5% of the distance\n-        BOOST_CHECK_LT(iteration_count, 100);\n-        BOOST_REQUIRE_GT(delta, 0);\n-        const auto rel_iter_count{double(iteration_count) / double(delta)};\n-        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+        // Absolute value maximum (derived empirically)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Both of the tests here seem to fail regularly when I increase the iteration count.",
      "created_at": "2026-02-02T17:27:25Z",
      "updated_at": "2026-02-02T17:27:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2755466952",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2755466952"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757647497",
      "pull_request_review_id": 3743527136,
      "id": 2757647497,
      "node_id": "PRRC_kwDOABII586kXlyJ",
      "diff_hunk": "@@ -108,11 +109,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         // End of copied traversal algorithm\n \n         // Asserts on the number of iterations:\n-        // always less than 100 and less than 5% of the distance\n-        BOOST_CHECK_LT(iteration_count, 100);\n-        BOOST_REQUIRE_GT(delta, 0);\n-        const auto rel_iter_count{double(iteration_count) / double(delta)};\n-        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+        // Absolute value maximum (derived empirically)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2754668449,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "You're correct, the first 3 commits should be merged, they just reflect the evolution over the review, and there's no need for that. I will do that.",
      "created_at": "2026-02-03T07:39:52Z",
      "updated_at": "2026-02-03T07:39:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2757647497",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757647497"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757739311",
      "pull_request_review_id": 3743654918,
      "id": 2757739311,
      "node_id": "PRRC_kwDOABII586kX8Mv",
      "diff_hunk": "@@ -9,6 +9,8 @@\n \n #include <memory>\n \n+extern int GetSkipHeight(int height);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "ca2c9bc63e759a065d6b15fe77d4a9d81feb0012",
      "original_commit_id": "ca2c9bc63e759a065d6b15fe77d4a9d81feb0012",
      "in_reply_to_id": 2755426311,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Correct, that's a cleaner, slightly-more-impact solution. I was shy to touch non-test code. I'll do as suggested.",
      "created_at": "2026-02-03T08:02:01Z",
      "updated_at": "2026-02-03T08:02:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2757739311",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757739311"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 12,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757774158",
      "pull_request_review_id": 3743697320,
      "id": 2757774158,
      "node_id": "PRRC_kwDOABII586kYEtO",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755451014,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "In the check a \"log(distance)-derived\" value is used, so I think the message is correct. It's in lines 115-116:\r\n\r\n```\r\n        const auto bound_log_distance{std::ceil(8*std::log(delta)/std::log(2) - 40)};\r\n        BOOST_CHECK_LE(double(iteration_count), bound_log_distance);\r\n```\r\n\r\nThe `min_distance` is constant, but that is not a boundary check parameter but a test setup parameter.\r\nBTW, I will merge the first 3 commits (on the same test), so commit message will be adjusted as well.",
      "created_at": "2026-02-03T08:07:40Z",
      "updated_at": "2026-02-03T08:07:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2757774158",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757774158"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757874200",
      "pull_request_review_id": 3743824075,
      "id": 2757874200,
      "node_id": "PRRC_kwDOABII586kYdIY",
      "diff_hunk": "@@ -108,11 +109,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         // End of copied traversal algorithm\n \n         // Asserts on the number of iterations:\n-        // always less than 100 and less than 5% of the distance\n-        BOOST_CHECK_LT(iteration_count, 100);\n-        BOOST_REQUIRE_GT(delta, 0);\n-        const auto rel_iter_count{double(iteration_count) / double(delta)};\n-        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+        // Absolute value maximum (derived empirically)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755466952,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Indeed. I adjust the parameter to work with huge number of iterations as well (the formula is empirically derived, as the note says). Thanks for trying out!\r\nBTW, the test is deterministic, so sporadic failing is not an issue (if it passes with a given number of iteration, it does so consistently).",
      "created_at": "2026-02-03T08:33:19Z",
      "updated_at": "2026-02-03T08:33:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2757874200",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2757874200"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2758526145",
      "pull_request_review_id": 3744625185,
      "id": 2758526145,
      "node_id": "PRRC_kwDOABII586ka8TB",
      "diff_hunk": "@@ -108,11 +109,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         // End of copied traversal algorithm\n \n         // Asserts on the number of iterations:\n-        // always less than 100 and less than 5% of the distance\n-        BOOST_CHECK_LT(iteration_count, 100);\n-        BOOST_REQUIRE_GT(delta, 0);\n-        const auto rel_iter_count{double(iteration_count) / double(delta)};\n-        BOOST_CHECK_LT(rel_iter_count, 0.05);\n+        // Absolute value maximum (derived empirically)",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 40,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2754668449,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-02-03T11:06:21Z",
      "updated_at": "2026-02-03T11:06:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2758526145",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2758526145"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759136994",
      "pull_request_review_id": 3745334714,
      "id": 2759136994,
      "node_id": "PRRC_kwDOABII586kdRbi",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 75,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit, LLM is right:\n> Possible typos and grammar issues:\n>\n> precice -> precise [misspelling makes the sentence harder to understand]",
      "created_at": "2026-02-03T13:38:09Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759136994",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759136994"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759143745",
      "pull_request_review_id": 3745334714,
      "id": 2759143745,
      "node_id": "PRRC_kwDOABII586kdTFB",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 79,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "That's a lot of allocations, I thought it would be problematic with our sanitizers, but the CI indicates it wasn't.\r\nRunning it locally from my IDE (with logs enabled) this takes 3.5 minutes to run. Command line indicates it's only 1.5 seconds, so it should likely be fine.\r\nnit:\r\n```suggestion\r\n    constexpr int chain_size{1'000'000};\r\n```",
      "created_at": "2026-02-03T13:39:18Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759143745",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759143745"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759187365",
      "pull_request_review_id": 3745334714,
      "id": 2759187365,
      "node_id": "PRRC_kwDOABII586kddul",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "please reformat new code with `clang-format`",
      "created_at": "2026-02-03T13:49:23Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759187365",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759187365"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759208172",
      "pull_request_review_id": 3745334714,
      "id": 2759208172,
      "node_id": "PRRC_kwDOABII586kdizs",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": 2499375298,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Doesn't this trivially follow from the previous line since we never pushed a null `unique_ptr`?\nIf you think we need a sanity check here, consider:\n```suggestion\n        BOOST_REQUIRE_EQUAL(new_index->pprev, block_index[i - 1].get());\n```",
      "created_at": "2026-02-03T13:54:08Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759208172",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759208172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759293116",
      "pull_request_review_id": 3745334714,
      "id": 2759293116,
      "node_id": "PRRC_kwDOABII586kd3i8",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "not sure we need this unique pointer an individual heap allocations here, wouldn't a contiguous `CBlockIndex` vector work better?\r\n\r\n```C++\r\n    constexpr int chain_size{1'000'000};\r\n    std::vector<CBlockIndex> block_index(chain_size);\r\n    for (auto i{0}; i < chain_size; ++i) {\r\n        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\r\n        block_index[i].nHeight = i;\r\n        block_index[i].BuildSkip();\r\n    }\r\n```\r\n\r\nThis would also speed up the test from 1.5 seconds (from terminal, without logs) to 0.5s.\r\n\r\n-------\r\n\r\n\r\nAlso note that `skiplist_tests.cpp` seems more appropriate for this change (moved it locally and it seems to pass there).",
      "created_at": "2026-02-03T14:12:08Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759293116",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759293116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759351262",
      "pull_request_review_id": 3745334714,
      "id": 2759351262,
      "node_id": "PRRC_kwDOABII586keFve",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755451014,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I think he mean \"second half\" is an understatement for the last 90% of the chain",
      "created_at": "2026-02-03T14:23:46Z",
      "updated_at": "2026-02-03T14:33:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2759351262",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2759351262"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2762735544",
      "pull_request_review_id": 3749592706,
      "id": 2762735544,
      "node_id": "PRRC_kwDOABII586kq_-4",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 38,
      "commit_id": "1a0423cf25bb60f98a29e06c39b7db2998860cd9",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486188243,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Clarification: the checking part of the test was reworked, there is no longer checks on aggregate values (max, average). Only the iteration count is checked in each iteration. Thus this remark became obsolete. Resolving.",
      "created_at": "2026-02-04T08:12:42Z",
      "updated_at": "2026-02-04T08:12:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2762735544",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2762735544"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 71,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2762752062",
      "pull_request_review_id": 3749612002,
      "id": 2762752062,
      "node_id": "PRRC_kwDOABII586krEA-",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101001) == 0b0001011101000001);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011000) == 0b0110101101010000);\n+    BOOST_CHECK(GetSkipHeight(0b0110101101011001) == 0b0110101101000001);\n+    BOOST_CHECK(GetSkipHeight(0) == 0);\n+    BOOST_CHECK(GetSkipHeight(1) == 0);\n+    BOOST_CHECK(GetSkipHeight(2) == 0);\n+    BOOST_CHECK(GetSkipHeight(3) == 1);\n+    BOOST_CHECK(GetSkipHeight(4) == 0);\n+    BOOST_CHECK(GetSkipHeight(5) == 1);\n+    BOOST_CHECK(GetSkipHeight(7) == 1);\n+    BOOST_CHECK(GetSkipHeight(8) == 0);\n+    BOOST_CHECK(GetSkipHeight(15) == 9);\n+    BOOST_CHECK(GetSkipHeight(16) == 0);\n+    BOOST_CHECK(GetSkipHeight(17) == 1);\n+    BOOST_CHECK(GetSkipHeight(256) == 0);\n+    BOOST_CHECK(GetSkipHeight(65536) == 0);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    FastRandomContext ctx;\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+\n+    // Create genesis block\n+    auto genesis = std::make_unique<CBlockIndex>();\n+    genesis->nHeight = 0;\n+    block_index.push_back(std::move(genesis));\n+\n+    // Build a chain\n+    const auto n{30000};\n+    for(int i = 0; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);\n+        new_index->nHeight = new_index->pprev->nHeight + 1;\n+        new_index->BuildSkip();\n+        block_index.push_back(std::move(new_index));\n+    }\n+\n+    // Analyze the diff (in height) of each element and its pskip\n+    int count_diff_smaller_16 = 0;\n+    int max_diff = 0;\n+    int total_diff = 0;\n+    for(int i = 1; i < n; ++i) {\n+        BOOST_CHECK(block_index[i]->nHeight == i);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 65,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486214751,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The check on `nHeight` has been removed, as it was essentially just validating the setup procedure, not the actual logic under test. This comment is thus outdated, resolving.",
      "created_at": "2026-02-04T08:17:02Z",
      "updated_at": "2026-02-04T08:17:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2762752062",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2762752062"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763226919",
      "pull_request_review_id": 3750165237,
      "id": 2763226919,
      "node_id": "PRRC_kwDOABII586ks38n",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 75,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759136994,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done",
      "created_at": "2026-02-04T10:12:20Z",
      "updated_at": "2026-02-04T10:12:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763226919",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763226919"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763229694",
      "pull_request_review_id": 3750168385,
      "id": 2763229694,
      "node_id": "PRRC_kwDOABII586ks4n-",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 79,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759143745,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done; switch to stack-allocation as well as this nit.",
      "created_at": "2026-02-04T10:12:58Z",
      "updated_at": "2026-02-04T10:12:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763229694",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763229694"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 112,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763234057",
      "pull_request_review_id": 3750173329,
      "id": 2763234057,
      "node_id": "PRRC_kwDOABII586ks5sJ",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759293116,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Allocation changed (to on-stack). Move is yet TODO.",
      "created_at": "2026-02-04T10:14:05Z",
      "updated_at": "2026-02-04T10:14:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763234057",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763234057"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763235892",
      "pull_request_review_id": 3750175185,
      "id": 2763235892,
      "node_id": "PRRC_kwDOABII586ks6I0",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755451014,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Comment updated (to \"top part\")",
      "created_at": "2026-02-04T10:14:32Z",
      "updated_at": "2026-02-04T10:14:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763235892",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763235892"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763239144",
      "pull_request_review_id": 3750179000,
      "id": 2763239144,
      "node_id": "PRRC_kwDOABII586ks67o",
      "diff_hunk": "@@ -41,6 +45,110 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_properties_test)\n+{\n+    // The test collects and analyses the distribution of the\n+    // skip difference numbers, and checks some properties:\n+    // non-uniform distribution with most values small but\n+    // with some large values as well.\n+\n+    const auto n{10'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(n);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    // Build a chain\n+    for(int i{1}; i < n; ++i) {\n+        auto new_index = std::make_unique<CBlockIndex>();\n+        new_index->pprev = block_index.back().get();\n+        BOOST_CHECK(new_index->pprev);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "original_commit_id": "ea998e18f6d64f485d4e2d85a1028474fb35120a",
      "in_reply_to_id": 2499375298,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "True; check was removed (with the change to on-stack allocation).",
      "created_at": "2026-02-04T10:15:20Z",
      "updated_at": "2026-02-04T10:15:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763239144",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763239144"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763241803",
      "pull_request_review_id": 3750181764,
      "id": 2763241803,
      "node_id": "PRRC_kwDOABII586ks7lL",
      "diff_hunk": "@@ -41,6 +43,78 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    BOOST_CHECK(GetSkipHeight(0b0001011101101000) == 0b0001011101100000);",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 15,
      "commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "original_commit_id": "6a22013f5aae2312a4a67b78773108a72146bdc7",
      "in_reply_to_id": 2486186460,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, in 2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "created_at": "2026-02-04T10:15:58Z",
      "updated_at": "2026-02-04T10:15:58Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763241803",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763241803"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 48,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763244359",
      "pull_request_review_id": 3750184349,
      "id": 2763244359,
      "node_id": "PRRC_kwDOABII586ks8NH",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759187365,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done (91fce2c893cfe88180feae4d22c102813352548f)",
      "created_at": "2026-02-04T10:16:36Z",
      "updated_at": "2026-02-04T10:16:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763244359",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763244359"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763482132",
      "pull_request_review_id": 3750457038,
      "id": 2763482132,
      "node_id": "PRRC_kwDOABII586kt2QU",
      "diff_hunk": "@@ -46,6 +46,7 @@ BOOST_AUTO_TEST_CASE(get_skip_height_test)\n {\n     // Even values: the rightmost set bit is zeroed\n     // Test with various even values with at least 2 bits set\n+    // clang-format off",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we can do that, but it's obvious that this done is on purpose and we don't have a format linter that we have to satisfy",
      "created_at": "2026-02-04T11:15:32Z",
      "updated_at": "2026-02-04T11:19:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763482132",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763482132"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763494733",
      "pull_request_review_id": 3750457038,
      "id": 2763494733,
      "node_id": "PRRC_kwDOABII586kt5VN",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759293116,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Thanks, though it's usually easier to review if it's pushed atomically (all changes addressed), otherwise we're just getting notifications and there's no way to act on it yet.\r\n\r\nAlso note that most reviewers prefer having a clear commit history that doesn't reflect its evolution inside the same PR - instead of adding new commits on top to modify code that we've just introduced, please do an interactive rebase on the existing commits.",
      "created_at": "2026-02-04T11:18:54Z",
      "updated_at": "2026-02-04T11:19:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763494733",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763494733"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763976921",
      "pull_request_review_id": 3751018065,
      "id": 2763976921,
      "node_id": "PRRC_kwDOABII586kvvDZ",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759293116,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "The move is also done.",
      "created_at": "2026-02-04T13:16:25Z",
      "updated_at": "2026-02-04T13:16:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763976921",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763976921"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763989713",
      "pull_request_review_id": 3751033273,
      "id": 2763989713,
      "node_id": "PRRC_kwDOABII586kvyLR",
      "diff_hunk": "@@ -46,6 +46,7 @@ BOOST_AUTO_TEST_CASE(get_skip_height_test)\n {\n     // Even values: the rightmost set bit is zeroed\n     // Test with various even values with at least 2 bits set\n+    // clang-format off",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 4,
      "commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "original_commit_id": "2b94acee3dd3a70c17218d5599e4c4976afeba7d",
      "in_reply_to_id": 2763482132,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "OK, removed.",
      "created_at": "2026-02-04T13:19:36Z",
      "updated_at": "2026-02-04T13:19:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2763989713",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2763989713"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 49,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764000178",
      "pull_request_review_id": 3751044429,
      "id": 2764000178,
      "node_id": "PRRC_kwDOABII586kv0uy",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    const int chain_size{1'000'000};\n+    std::vector<std::unique_ptr<CBlockIndex>> block_index;\n+    block_index.reserve(chain_size);\n+    // Create genesis block\n+    block_index.push_back(std::make_unique<CBlockIndex>());\n+    for(auto i{1}; i < chain_size; ++i) {",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 84,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759293116,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> instead of adding new commits on top to modify code that we've just introduced, please do an interactive rebase on the existing commits.\r\n\r\nThanks, noted.",
      "created_at": "2026-02-04T13:22:14Z",
      "updated_at": "2026-02-04T13:22:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764000178",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764000178"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764219269",
      "pull_request_review_id": 3751296127,
      "id": 2764219269,
      "node_id": "PRRC_kwDOABII586kwqOF",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\n    // number of iterations can be measured, that gives a more precise\n```",
      "created_at": "2026-02-04T14:12:50Z",
      "updated_at": "2026-02-04T14:19:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764219269",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764219269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 266,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764221143",
      "pull_request_review_id": 3751296127,
      "id": 2764221143,
      "node_id": "PRRC_kwDOABII586kwqrX",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the second half of the chain",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 103,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "seems this was reverted in-between rebases",
      "created_at": "2026-02-04T14:13:14Z",
      "updated_at": "2026-02-04T14:19:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764221143",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764221143"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764236674",
      "pull_request_review_id": 3751296127,
      "id": 2764236674,
      "node_id": "PRRC_kwDOABII586kwueC",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755451014,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Was reverted since",
      "created_at": "2026-02-04T14:16:01Z",
      "updated_at": "2026-02-04T14:19:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764236674",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764236674"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764238603",
      "pull_request_review_id": 3751296127,
      "id": 2764238603,
      "node_id": "PRRC_kwDOABII586kwu8L",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 75,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759136994,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "This was also reverted accidentally",
      "created_at": "2026-02-04T14:16:27Z",
      "updated_at": "2026-02-04T14:19:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764238603",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764238603"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764245710",
      "pull_request_review_id": 3751296127,
      "id": 2764245710,
      "node_id": "PRRC_kwDOABII586kwwrO",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 99,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "to make sure the linter actually validates the name:\n```suggestion\n    FastRandomContext ctx(/*fDeterministic=*/true);\n```",
      "created_at": "2026-02-04T14:17:53Z",
      "updated_at": "2026-02-04T14:19:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764245710",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764245710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 279,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764250879",
      "pull_request_review_id": 3751296127,
      "id": 2764250879,
      "node_id": "PRRC_kwDOABII586kwx7_",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the second half of the chain\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        auto iteration_count{0};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 115,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit: `auto` numeric declarations can be tricky",
      "created_at": "2026-02-04T14:19:02Z",
      "updated_at": "2026-02-04T16:40:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2764250879",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2764250879"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 295,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765694070",
      "pull_request_review_id": 3753001262,
      "id": 2765694070,
      "node_id": "PRRC_kwDOABII586k2SR2",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the second half of the chain\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        auto iteration_count{0};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 115,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": 2764250879,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Changed to `int`.",
      "created_at": "2026-02-04T19:39:52Z",
      "updated_at": "2026-02-04T19:39:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765694070",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765694070"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 295,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765694765",
      "pull_request_review_id": 3753001972,
      "id": 2765694765,
      "node_id": "PRRC_kwDOABII586k2Sct",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 99,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": 2764245710,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2026-02-04T19:40:05Z",
      "updated_at": "2026-02-04T19:40:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765694765",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765694765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 279,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765701034",
      "pull_request_review_id": 3753008520,
      "id": 2765701034,
      "node_id": "PRRC_kwDOABII586k2T-q",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 86,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": 2764219269,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Good catch, corrected. One fix commit got lost accidentally.",
      "created_at": "2026-02-04T19:41:53Z",
      "updated_at": "2026-02-04T19:41:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765701034",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765701034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 266,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765702050",
      "pull_request_review_id": 3753009485,
      "id": 2765702050,
      "node_id": "PRRC_kwDOABII586k2UOi",
      "diff_hunk": "@@ -188,4 +189,142 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6),\n+                                    4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8),\n+                                    0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9),\n+                                    1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10),\n+                                    8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for(auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic =*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the second half of the chain",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 103,
      "commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "original_commit_id": "8dc3e3ede97e3deea277f1d88583cc4be2a2b208",
      "in_reply_to_id": 2764221143,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Re-done, corrected.",
      "created_at": "2026-02-04T19:42:07Z",
      "updated_at": "2026-02-04T19:42:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765702050",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765702050"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765721633",
      "pull_request_review_id": 3753031185,
      "id": 2765721633,
      "node_id": "PRRC_kwDOABII586k2ZAh",
      "diff_hunk": "@@ -71,11 +72,11 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\n         block_index.push_back(std::move(new_index));\n     }\n \n-    const auto min_distance{500};\n+    const auto min_distance{100};\n     FastRandomContext ctx(/*fDeterministic =*/true);\n     for (auto i{0}; i < 1'000; ++i) {\n         // pick a height in the second half of the chain",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 25,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "157caa98da4077c50dd1bd724c9d9167cbce32f5",
      "in_reply_to_id": 2755451014,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Fixed",
      "created_at": "2026-02-04T19:48:07Z",
      "updated_at": "2026-02-04T19:48:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765721633",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765721633"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765723810",
      "pull_request_review_id": 3753033950,
      "id": 2765723810,
      "node_id": "PRRC_kwDOABII586k2Zii",
      "diff_hunk": "@@ -41,6 +42,139 @@ const CBlockIndex* NaiveLastCommonAncestor(const CBlockIndex* a, const CBlockInd\n \n } // namespace\n \n+BOOST_AUTO_TEST_CASE(get_skip_height_test)\n+{\n+    // Even values: the rightmost set bit is zeroed\n+    // Test with various even values with at least 2 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010010),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00100010),\n+                                    0b00100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b01000010),\n+                                    0b01000000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00010100),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b00011000),\n+                                    0b00010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101010),\n+                                    0b10101000);\n+    // Odd values: the 2nd and 3rd set bits are zeroed\n+    // Test with various odd values with at least 4 bits set\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10100011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b11000011),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10010101),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10011001),\n+                                    0b10000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b10101011),\n+                                    0b10100001);\n+    // Some longer random values (even and odd)\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101000),\n+                                    0b0001011101100000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0001011101101001),\n+                                    0b0001011101000001);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011000),\n+                                    0b0110101101010000);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0b0110101101011001),\n+                                    0b0110101101000001);\n+    // All values 0-10\n+    BOOST_CHECK_EQUAL(GetSkipHeight(0), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(1), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(2), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(3), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(4), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(5), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(6), 4);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(7), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(8), 0);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(9), 1);\n+    BOOST_CHECK_EQUAL(GetSkipHeight(10), 8);\n+}\n+\n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precice",
      "path": "src/test/chain_tests.cpp",
      "position": 1,
      "original_position": 75,
      "commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "original_commit_id": "9665afdcbabebcfc3db91e25f42aa1c5dcb7f34e",
      "in_reply_to_id": 2759136994,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Fixed",
      "created_at": "2026-02-04T19:48:43Z",
      "updated_at": "2026-02-04T19:48:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2765723810",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2765723810"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 108,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2783298594",
      "pull_request_review_id": 3773999584,
      "id": 2783298594,
      "node_id": "PRRC_kwDOABII586l5cQi",
      "diff_hunk": "@@ -188,4 +189,77 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precise\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for (auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic=*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the top part of the chain (so there is room to go down)\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        int iteration_count{0};\n+        while (walk_height > target_height) {\n+            BOOST_REQUIRE(walk_p->pskip);\n+            BOOST_REQUIRE(walk_p->pprev);\n+            BOOST_REQUIRE(walk_p->pprev->pskip);\n+            const int skip_height{walk_p->pskip->nHeight};\n+            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\n+            // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+            if (skip_height == target_height ||\n+                (skip_height > target_height &&\n+                 !(prev_skip_height < skip_height - 2 && prev_skip_height >= target_height))) {\n+                BOOST_REQUIRE_LT(skip_height, walk_height);\n+                walk_p = walk_p->pskip;\n+                walk_height = skip_height;\n+            } else {\n+                walk_p = walk_p->pprev;\n+                --walk_height;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // Absolute value maximum (derived empirically)\n+        BOOST_CHECK_LE(iteration_count, 130);\n+        // Dynamic bound, function of distance. Formula derived empirically.\n+        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 76,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "original_commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "in_reply_to_id": null,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "I still hit some exceptions here when I increase the number of iterations here. Of course, the RNG is deterministic, so this won't be hit in CI, but it begs the question what it's actually testing if this is not an upper bound.\n\nI believe I determined before that the worst case actually scales with log^2(N) (where N is the total chain length, not just the delta). Maybe it's worth finding an actual upper bound?",
      "created_at": "2026-02-09T15:33:22Z",
      "updated_at": "2026-02-09T15:33:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2783298594",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2783298594"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787450631",
      "pull_request_review_id": 3778426037,
      "id": 2787450631,
      "node_id": "PRRC_kwDOABII586mJR8H",
      "diff_hunk": "@@ -188,4 +189,77 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precise\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for (auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic=*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the top part of the chain (so there is room to go down)\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        int iteration_count{0};\n+        while (walk_height > target_height) {\n+            BOOST_REQUIRE(walk_p->pskip);\n+            BOOST_REQUIRE(walk_p->pprev);\n+            BOOST_REQUIRE(walk_p->pprev->pskip);\n+            const int skip_height{walk_p->pskip->nHeight};\n+            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\n+            // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+            if (skip_height == target_height ||\n+                (skip_height > target_height &&\n+                 !(prev_skip_height < skip_height - 2 && prev_skip_height >= target_height))) {\n+                BOOST_REQUIRE_LT(skip_height, walk_height);\n+                walk_p = walk_p->pskip;\n+                walk_height = skip_height;\n+            } else {\n+                walk_p = walk_p->pprev;\n+                --walk_height;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // Absolute value maximum (derived empirically)\n+        BOOST_CHECK_LE(iteration_count, 130);\n+        // Dynamic bound, function of distance. Formula derived empirically.\n+        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 76,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "original_commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "in_reply_to_id": 2783298594,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "If I understand this correctly, `GetSkipHeight`'s complexity should come from its bit-width, not distance, so maybe we can just estimate it via [triangular numbers](https://en.wikipedia.org/wiki/Triangular_number):\r\n```math\r\nB = log(N  1) + 1\r\n```\r\n```math\r\nbound(N) = B(B + 1) / 2\r\n```\r\nThis isn't as tight as the previous one, but is very simple and seems to pass.\r\n\r\nThe patch would be something like:\r\n```patch\r\ndiff --git a/src/test/skiplist_tests.cpp b/src/test/skiplist_tests.cpp\r\nindex d7d18cf76e..fd7b409c88 100644\r\n--- a/src/test/skiplist_tests.cpp\r\n+++ b/src/test/skiplist_tests.cpp\r\n@@ -6,7 +6,7 @@\r\n #include <test/util/random.h>\r\n #include <test/util/setup_common.h>\r\n\r\n-#include <cmath>\r\n+#include <bit>\r\n #include <vector>\r\n\r\n #include <boost/test/unit_test.hpp>\r\n@@ -268,6 +268,8 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\r\n\r\n     // Build a chain\r\n     constexpr int chain_size{1'000'000};\r\n+    constexpr int chain_bits{std::bit_width<unsigned>(chain_size - 1)}; // Bit width of the maximum height.\r\n+    constexpr int iteration_bound{chain_bits * (chain_bits + 1) / 2}; // Conservative O(log^2(N)) bound.\r\n     std::vector<CBlockIndex> block_index(chain_size);\r\n     for (auto i{0}; i < chain_size; ++i) {\r\n         block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\r\n@@ -313,12 +315,7 @@ BOOST_AUTO_TEST_CASE(skip_height_analysis)\r\n             ++iteration_count;\r\n         }\r\n\r\n-        // Asserts on the number of iterations:\r\n-        // Absolute value maximum (derived empirically)\r\n-        BOOST_CHECK_LE(iteration_count, 130);\r\n-        // Dynamic bound, function of distance. Formula derived empirically.\r\n-        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};\r\n-        BOOST_CHECK_LE(double(iteration_count), bound_log_distance);\r\n+        BOOST_CHECK_LE(iteration_count, iteration_bound);\r\n\r\n         // Also check that `GetAncestor` gives the same result\r\n         auto p_ancestor{start_p.GetAncestor(target_height)};\r\n```",
      "created_at": "2026-02-10T11:37:45Z",
      "updated_at": "2026-02-10T11:37:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2787450631",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787450631"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787581266",
      "pull_request_review_id": 3778558377,
      "id": 2787581266,
      "node_id": "PRRC_kwDOABII586mJx1S",
      "diff_hunk": "@@ -188,4 +189,77 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precise\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for (auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic=*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the top part of the chain (so there is room to go down)\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        int iteration_count{0};\n+        while (walk_height > target_height) {\n+            BOOST_REQUIRE(walk_p->pskip);\n+            BOOST_REQUIRE(walk_p->pprev);\n+            BOOST_REQUIRE(walk_p->pprev->pskip);\n+            const int skip_height{walk_p->pskip->nHeight};\n+            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\n+            // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+            if (skip_height == target_height ||\n+                (skip_height > target_height &&\n+                 !(prev_skip_height < skip_height - 2 && prev_skip_height >= target_height))) {\n+                BOOST_REQUIRE_LT(skip_height, walk_height);\n+                walk_p = walk_p->pskip;\n+                walk_height = skip_height;\n+            } else {\n+                walk_p = walk_p->pprev;\n+                --walk_height;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // Absolute value maximum (derived empirically)\n+        BOOST_CHECK_LE(iteration_count, 130);\n+        // Dynamic bound, function of distance. Formula derived empirically.\n+        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 76,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "original_commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "in_reply_to_id": 2783298594,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "@sipa, I try to get the actual upper bound by running all combinations of start and end. It takes a while because it is O(n^2) with n=1_000_000.\r\n\r\nGenerally the longer the distance to traverse, the lower the number of iterations are, that's why I think it makes sense to take into account the distance (delta), and not only the chain size.\r\n\r\n@l0rinc , your check is nice and simple, but it effectively replaces the check against `130` with check against `210` (20*21/2), which is much less strict. I'm fine with it, but I'm curious of the search result first.\r\nBTW, the max number found in my exhaustive search is exactly 130 (so far, it is still running, but it has started with the very long subchains). ",
      "created_at": "2026-02-10T12:07:43Z",
      "updated_at": "2026-02-10T12:08:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2787581266",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787581266"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787634527",
      "pull_request_review_id": 3778611849,
      "id": 2787634527,
      "node_id": "PRRC_kwDOABII586mJ-1f",
      "diff_hunk": "@@ -188,4 +189,77 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precise\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for (auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic=*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the top part of the chain (so there is room to go down)\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        int iteration_count{0};\n+        while (walk_height > target_height) {\n+            BOOST_REQUIRE(walk_p->pskip);\n+            BOOST_REQUIRE(walk_p->pprev);\n+            BOOST_REQUIRE(walk_p->pprev->pskip);\n+            const int skip_height{walk_p->pskip->nHeight};\n+            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\n+            // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+            if (skip_height == target_height ||\n+                (skip_height > target_height &&\n+                 !(prev_skip_height < skip_height - 2 && prev_skip_height >= target_height))) {\n+                BOOST_REQUIRE_LT(skip_height, walk_height);\n+                walk_p = walk_p->pskip;\n+                walk_height = skip_height;\n+            } else {\n+                walk_p = walk_p->pprev;\n+                --walk_height;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // Absolute value maximum (derived empirically)\n+        BOOST_CHECK_LE(iteration_count, 130);\n+        // Dynamic bound, function of distance. Formula derived empirically.\n+        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 76,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "original_commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "in_reply_to_id": 2783298594,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "> but it effectively replaces the check against 130 with check against 210 (20*21/2), which is much less strict\r\n\r\nyeah, but is that important?\r\n\r\n> the max number found in my exhaustive search is exactly 130\r\n\r\n~mine was 132~ apparently I misremembered",
      "created_at": "2026-02-10T12:19:34Z",
      "updated_at": "2026-02-14T13:08:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2787634527",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2787634527"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2802710673",
      "pull_request_review_id": 3795501104,
      "id": 2802710673,
      "node_id": "PRRC_kwDOABII586nDfiR",
      "diff_hunk": "@@ -188,4 +189,77 @@ BOOST_AUTO_TEST_CASE(findearliestatleast_edge_test)\n     BOOST_CHECK(ret2->nTimeMax >= 200 && ret2->nHeight == 4);\n }\n \n+BOOST_AUTO_TEST_CASE(skip_height_analysis)\n+{\n+    // This test case indirectly tests the `GetSkipHeight` function,\n+    // and asserts that its properties are suitable for performant\n+    // ancestor search.\n+    // It does so by imitating the `CBlockIndex::GetAncestor()`\n+    // function to look for an ancestor, and ensuring that an arbitrary\n+    // ancestor is found in a number of steps that is much lower\n+    // than simple linear traversal.\n+    // This could be tested by a performance test as well, but here the\n+    // number of iterations can be measured, that gives a more precise\n+    // metric than CPU time.\n+\n+    // Build a chain\n+    constexpr int chain_size{1'000'000};\n+    std::vector<CBlockIndex> block_index(chain_size);\n+    for (auto i{0}; i < chain_size; ++i) {\n+        block_index[i].pprev = i == 0 ? nullptr : &block_index[i - 1];\n+        block_index[i].nHeight = i;\n+        block_index[i].BuildSkip();\n+    }\n+\n+    constexpr auto min_distance{100};\n+    FastRandomContext ctx(/*fDeterministic=*/true);\n+    // Repeat iterations. The test should work with much higher numbers as well,\n+    // kept reasonable to keep execution time low\n+    for (auto i{0}; i < 1'000; ++i) {\n+        // pick a height in the top part of the chain (so there is room to go down)\n+        const int start_height{chain_size - 1 - ctx.randrange(chain_size * 9 / 10)};\n+        // pick a target height, earlier by at least min_distance\n+        const int delta{min_distance + ctx.randrange(start_height - min_distance)};\n+        const int target_height{start_height - delta};\n+        BOOST_REQUIRE(start_height > 0 && start_height < chain_size);\n+        BOOST_REQUIRE(target_height > 0 && target_height < chain_size && target_height < start_height);\n+\n+        // Perform traversal from start to target, skipping, as implemented in `GetAncestor`\n+        const auto& start_p{block_index[start_height]};\n+        const CBlockIndex* walk_p{&start_p};\n+        auto walk_height{start_height};\n+        int iteration_count{0};\n+        while (walk_height > target_height) {\n+            BOOST_REQUIRE(walk_p->pskip);\n+            BOOST_REQUIRE(walk_p->pprev);\n+            BOOST_REQUIRE(walk_p->pprev->pskip);\n+            const int skip_height{walk_p->pskip->nHeight};\n+            const int prev_skip_height{walk_p->pprev->pskip->nHeight};\n+            // Only follow pskip if pprev->pskip isn't better than pskip->pprev.\n+            if (skip_height == target_height ||\n+                (skip_height > target_height &&\n+                 !(prev_skip_height < skip_height - 2 && prev_skip_height >= target_height))) {\n+                BOOST_REQUIRE_LT(skip_height, walk_height);\n+                walk_p = walk_p->pskip;\n+                walk_height = skip_height;\n+            } else {\n+                walk_p = walk_p->pprev;\n+                --walk_height;\n+            }\n+            ++iteration_count;\n+        }\n+\n+        // Asserts on the number of iterations:\n+        // Absolute value maximum (derived empirically)\n+        BOOST_CHECK_LE(iteration_count, 130);\n+        // Dynamic bound, function of distance. Formula derived empirically.\n+        const auto bound_log_distance{std::ceil(8.3 * std::log(delta) / std::log(2) - 35)};",
      "path": "src/test/skiplist_tests.cpp",
      "position": 1,
      "original_position": 76,
      "commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "original_commit_id": "f2418d8706959bff60aaeb7295ea08f6b8daee2d",
      "in_reply_to_id": 2783298594,
      "user": {
        "login": "optout21",
        "id": 13562139,
        "node_id": "MDQ6VXNlcjEzNTYyMTM5",
        "avatar_url": "https://avatars.githubusercontent.com/u/13562139?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/optout21",
        "html_url": "https://github.com/optout21",
        "followers_url": "https://api.github.com/users/optout21/followers",
        "following_url": "https://api.github.com/users/optout21/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/optout21/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/optout21/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/optout21/subscriptions",
        "organizations_url": "https://api.github.com/users/optout21/orgs",
        "repos_url": "https://api.github.com/users/optout21/repos",
        "events_url": "https://api.github.com/users/optout21/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/optout21/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "See https://github.com/bitcoin/bitcoin/pull/33661#issuecomment-3895337279",
      "created_at": "2026-02-13T07:28:42Z",
      "updated_at": "2026-02-13T07:28:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33661#discussion_r2802710673",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2802710673"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33661"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    }
  ]
}
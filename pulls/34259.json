{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259",
    "id": 3164539279,
    "node_id": "PR_kwDOABII5868nwmP",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/34259",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/34259.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/34259.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/da56ef239b12786e3a177afda14352dda4a70bc6",
    "number": 34259,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Find minimal chunks in SFL",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false,
      "name": null,
      "patch_url": null
    },
    "body": "Part of #30289.\r\n\r\nThis was split off from #34023, because it's not really an optimization but a feature. The feature existed pre-SFL, so this brings SFL to parity in terms of functionality with the old code.\r\n\r\nThe idea is that while optimality - as achieved by SFL before this PR - guarantees a linearization whose feerate diagram is optimal, it may be possible to split chunks into smaller equal-feerate parts. This is desirable because even though it doesn't change the diagram, it provides more flexibility for optimization (binpacking is easier when the pieces are smaller).\r\n\r\nThus, this PR introduces the stronger notion of \"minimality\": optimal chunks, which are also split into their smallest possible pieces. To accomplish that, an additional step in the SFL algorithm is added which aims to split chunks into minimal equal-feerate parts where possible, without introducing circular dependencies between them. It works based on the observation that if an (already otherwise optimal) chunk has a way of being split into two equal-feerate parts, and T is a given transaction in the chunk, then we can find the split in two steps:\r\n* One time, pretend T has $\\epsilon$ higher feerate than it really has. If a split exists with T in the top part, this will find it.\r\n* The other time, pretend T has $\\epsilon$ lower feerate than it really has. If a split exists with T in the bottom part, this will find it.\r\n\r\nSo we try both on each found optimal chunk. If neither works, the chunk is minimal. If one works, recurse into the split chunks to split them further.",
    "labels": [],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/74",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/74/labels",
      "id": 12610874,
      "node_id": "MI_kwDOABII584AwG06",
      "number": 74,
      "state": "open",
      "title": "31.0",
      "creator": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "open_issues": 11,
      "closed_issues": 31,
      "created_at": "2025-03-25T18:44:16Z",
      "updated_at": "2026-01-14T09:18:42Z"
    },
    "created_at": "2026-01-12T05:17:26Z",
    "updated_at": "2026-01-14T20:08:25Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "a0be9581a075b4beaafe468e35f92a4086af8586",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "sipa:202601_sfl_minimize",
      "ref": "202601_sfl_minimize",
      "sha": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1458655,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
        "name": "bitcoin",
        "full_name": "sipa/bitcoin",
        "owner": {
          "login": "sipa",
          "id": 548488,
          "node_id": "MDQ6VXNlcjU0ODQ4OA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sipa",
          "html_url": "https://github.com/sipa",
          "followers_url": "https://api.github.com/users/sipa/followers",
          "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
          "organizations_url": "https://api.github.com/users/sipa/orgs",
          "repos_url": "https://api.github.com/users/sipa/repos",
          "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sipa/received_events",
          "type": "User",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/sipa/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sipa/bitcoin",
        "archive_url": "https://api.github.com/repos/sipa/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sipa/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sipa/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sipa/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
        "svn_url": "https://github.com/sipa/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "TypeScript",
        "forks_count": 22,
        "stargazers_count": 91,
        "watchers_count": 91,
        "size": 284522,
        "default_branch": "lows",
        "open_issues_count": 17,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-13T15:31:58Z",
        "created_at": "2011-03-09T10:46:59Z",
        "updated_at": "2025-12-31T21:09:58Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "796f18e559d612b430ff131d3dc38728ad8c57c8",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "name": null,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 38704,
        "stargazers_count": 87651,
        "watchers_count": 87651,
        "size": 301769,
        "default_branch": "master",
        "open_issues_count": 745,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2026-01-14T20:58:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2026-01-14T20:59:06Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 235,
    "deletions": 29,
    "changed_files": 5,
    "commits": 1,
    "review_comments": 12,
    "comments": 8
  },
  "events": [
    {
      "event": "commented",
      "id": 3736925073,
      "node_id": "IC_kwDOABII587evPOR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3736925073",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T05:17:31Z",
      "updated_at": "2026-01-14T17:50:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34259.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3740862748), [marcofleon](https://github.com/bitcoin/bitcoin/pull/34259#pullrequestreview-3662021832) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34257](https://github.com/bitcoin/bitcoin/pull/34257) (txgraph: deterministic optimal transaction order by sipa)\n* [#34138](https://github.com/bitcoin/bitcoin/pull/34138) (Cluster mempool: more accurate cost model for SFL by sipa)\n* [#34023](https://github.com/bitcoin/bitcoin/pull/34023) (Optimized SFL cluster linearization by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3736925073",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21989265544,
      "node_id": "HRFPE_lADOABII587iqirgzwAAAAUeqZCI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21989265544",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9f147194ebca05a44975b6120c93b0416dc4d747",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/9f147194ebca05a44975b6120c93b0416dc4d747",
      "created_at": "2026-01-12T13:12:53Z"
    },
    {
      "event": "commented",
      "id": 3738778401,
      "node_id": "IC_kwDOABII587e2Tsh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3738778401",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T14:17:33Z",
      "updated_at": "2026-01-12T14:17:33Z",
      "author_association": "MEMBER",
      "body": "thank you for splitting this out",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3738778401",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21992060441,
      "node_id": "HRFPE_lADOABII587iqirgzwAAAAUe1DYZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21992060441",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/9697bc36c1387909e8a3384f09cd9121d8788d86",
      "created_at": "2026-01-12T15:06:01Z"
    },
    {
      "event": "commented",
      "id": 3739189347,
      "node_id": "IC_kwDOABII587e34Bj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3739189347",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T15:38:36Z",
      "updated_at": "2026-01-12T15:38:36Z",
      "author_association": "MEMBER",
      "body": "I've made this the \"what to review next\" in #30289, since I plan to rebase #34257 on top of this as well (several tests in it are only possible when we have minimal chunks).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3739189347",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "reviewed",
      "id": 3651212043,
      "node_id": "PRR_kwDOABII587ZoRML",
      "url": null,
      "actor": null,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-12T18:22:30Z",
      "author_association": "MEMBER",
      "body": "ACK 9697bc36c1387909e8a3384f09cd9121d8788d86\r\n\r\n",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#pullrequestreview-3651212043",
      "submitted_at": "2026-01-12T18:22:30Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 21996793770,
      "node_id": "HRFPE_lADOABII587iqirgzwAAAAUfHG-q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/21996793770",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "created_at": "2026-01-12T18:35:16Z"
    },
    {
      "event": "commented",
      "id": 3740201305,
      "node_id": "IC_kwDOABII587e7vFZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3740201305",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T19:41:13Z",
      "updated_at": "2026-01-12T19:41:13Z",
      "author_association": "MEMBER",
      "body": "reACK https://github.com/bitcoin/bitcoin/pull/34259/commits/ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3740201305",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "reviewed",
      "id": 3652983158,
      "node_id": "PRR_kwDOABII587ZvBl2",
      "url": null,
      "actor": null,
      "commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-12T22:32:39Z",
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#pullrequestreview-3652983158",
      "submitted_at": "2026-01-12T22:32:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRhNTZlZjIzOWIxMjc4NmUzYTE3N2FmZGExNDM1MmRkYTRhNzBiYzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/da56ef239b12786e3a177afda14352dda4a70bc6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/da56ef239b12786e3a177afda14352dda4a70bc6",
      "tree": {
        "sha": "85d462168adaed5172370b9abb2ae953bef6f6ad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/85d462168adaed5172370b9abb2ae953bef6f6ad"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/abc6a3a4eb9814a7f17e40f7a4d330cbef86bff0",
          "sha": "abc6a3a4eb9814a7f17e40f7a4d330cbef86bff0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/abc6a3a4eb9814a7f17e40f7a4d330cbef86bff0"
        }
      ],
      "message": "clusterlin: minimize chunks (feature)\n\nAfter the normal optimization process finishes, and finds an optimal\nspanning forest, run a second process (while computation budget remains)\nto split chunks into minimal equal-feerate chunks.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2026-01-12T22:38:30Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2025-10-14T20:15:19Z"
      },
      "sha": "da56ef239b12786e3a177afda14352dda4a70bc6"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 22001401603,
      "node_id": "HRFPE_lADOABII587iqirgzwAAAAUfYr8D",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22001401603",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "commit_url": "https://api.github.com/repos/sipa/bitcoin/commits/da56ef239b12786e3a177afda14352dda4a70bc6",
      "created_at": "2026-01-12T22:38:39Z"
    },
    {
      "event": "commented",
      "id": 3740862748,
      "node_id": "IC_kwDOABII587e-Qkc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3740862748",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-12T22:48:19Z",
      "updated_at": "2026-01-12T22:48:19Z",
      "author_association": "MEMBER",
      "body": "reACK https://github.com/bitcoin/bitcoin/pull/34259/commits/da56ef239b12786e3a177afda14352dda4a70bc6",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3740862748",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "milestoned",
      "id": 22014940313,
      "node_id": "MIE_lADOABII587iqirgzwAAAAUgMVSZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22014940313",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-13T12:04:38Z",
      "milestone": {
        "title": "31.0"
      }
    },
    {
      "event": "reviewed",
      "id": 3662021832,
      "node_id": "PRR_kwDOABII587aRgTI",
      "url": null,
      "actor": null,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-14T17:51:52Z",
      "author_association": "CONTRIBUTOR",
      "body": "crACK da56ef239b12786e3a177afda14352dda4a70bc6\r\n\r\nAlso left the `clusterlin_linearize` and `clusterlin_sfl` fuzz tests running for a while, and no issues.\r\n\r\nFrom what I can see, having the SFL internal state be minimal provides the advantage of making the `optimal` value more precise (it's now both optimal and minimal). It's a stronger condition for testing. Is there something else I'm missing, maybe wrt some future optimization, as to why having minimal SFL chunks is good?",
      "user": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#pullrequestreview-3662021832",
      "submitted_at": "2026-01-14T17:50:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
    },
    {
      "event": "commented",
      "id": 3751097677,
      "node_id": "IC_kwDOABII587flTVN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3751097677",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T18:52:46Z",
      "updated_at": "2026-01-14T19:37:56Z",
      "author_association": "MEMBER",
      "body": "@marcofleon All else being equal, smaller chunks are better simply because they are more flexible.\r\n\r\nA big chunk may not fit in a block, requiring a need to skip it, and use a lower-feerate option. If the big chunk can be split in smaller equal-feerate chunks, more of it may fit.\r\n\r\nEven with a hypothetical backtracking binpacking approach, more smaller chunks just means more possible ways to pack, so likely better.\r\n\r\nI've updated the PR description to explain this a bit.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3751097677",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "mentioned",
      "id": 22050912213,
      "node_id": "MEE_lADOABII587iqirgzwAAAAUiVjfV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22050912213",
      "actor": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T18:52:47Z"
    },
    {
      "event": "subscribed",
      "id": 22050912249,
      "node_id": "SE_lADOABII587iqirgzwAAAAUiVjf5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/22050912249",
      "actor": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T18:52:47Z"
    },
    {
      "event": "commented",
      "id": 3751402801,
      "node_id": "IC_kwDOABII587fmd0x",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3751402801",
      "actor": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T19:55:02Z",
      "updated_at": "2026-01-14T20:02:27Z",
      "author_association": "CONTRIBUTOR",
      "body": "Right, makes sense. I realized where I got confused. I thought `ChunkLinearizationInfo()` was already playing the part of \"split up equal fee rate chunks\", but of course the linearization order can change from having smaller SFL chunks. This would result in potentially more chunks being read in `ChunkLinearizationInfo()`. \r\n\r\nYour explanation and PR description make more sense to me now, thanks.",
      "user": {
        "login": "marcofleon",
        "id": 95179662,
        "node_id": "U_kgDOBaxTjg",
        "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marcofleon",
        "html_url": "https://github.com/marcofleon",
        "followers_url": "https://api.github.com/users/marcofleon/followers",
        "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
        "organizations_url": "https://api.github.com/users/marcofleon/orgs",
        "repos_url": "https://api.github.com/users/marcofleon/repos",
        "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/marcofleon/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3751402801",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "commented",
      "id": 3751487252,
      "node_id": "IC_kwDOABII587fmycU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3751487252",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2026-01-14T20:03:04Z",
      "updated_at": "2026-01-14T20:03:04Z",
      "author_association": "MEMBER",
      "body": "Exactly. It is actually possible that *accidentally* the linearization order that comes out of SFL, when fed into `ChunkLinearization(Info)`, results in splitting of chunks into equal-feerate parts, but this is not guaranteed. The `PostLinearize()` call after `Linearize()` also has a chance of improving the linearization in such a way that chunking splits things up further (and in practice, I suspect this will often be enough). However, even that is not guaranteed to always give the minimal resulting chunks. Building the splitting into SFL itself however can guarantee it.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#issuecomment-3751487252",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/34259"
    },
    {
      "event": "reviewed",
      "id": 3662564015,
      "node_id": "PRR_kwDOABII587aTkqv",
      "url": null,
      "actor": null,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2026-01-14T20:08:25Z",
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#pullrequestreview-3662564015",
      "submitted_at": "2026-01-14T20:08:25Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2682649761",
      "pull_request_review_id": 3651212043,
      "id": 2682649761,
      "node_id": "PRRC_kwDOABII586f5fyh",
      "diff_hunk": "@@ -1361,11 +1543,19 @@ std::tuple<std::vector<DepGraphIndex>, bool, uint64_t> Linearize(const DepGraph<\n     }\n     // Make improvement steps to it until we hit the max_iterations limit, or an optimal result\n     // is found.\n-    bool optimal = false;\n     if (forest.GetCost() < max_iterations) {\n         forest.StartOptimizing();\n         do {\n-            if (!forest.OptimizeStep()) {\n+            if (!forest.OptimizeStep()) break;",
      "path": "src/cluster_linearize.h",
      "position": 292,
      "original_position": 282,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "original_commit_id": "9f147194ebca05a44975b6120c93b0416dc4d747",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "`Linearize()` description of the return tuples \"optimal\" value should pedantically say the result is minimal as well",
      "created_at": "2026-01-12T15:00:19Z",
      "updated_at": "2026-01-12T18:22:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2682649761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2682649761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1550,
      "original_line": 1550,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683079998",
      "pull_request_review_id": 3651212043,
      "id": 2683079998,
      "node_id": "PRRC_kwDOABII586f7I0-",
      "diff_hunk": "@@ -1068,6 +1121,119 @@ class SpanningForestState\n         return false;\n     }\n \n+    /** Initialize data structure for minimizing the chunks. Step() cannot be called anymore\n+     *  afterwards. */\n+    void StartMinimizing() noexcept\n+    {\n+        m_nonminimal_chunks.clear();\n+        m_nonminimal_chunks.reserve(m_transaction_idxs.Count());\n+        // Gather all chunks, and for each, add it with a random pivot in it, and a random initial\n+        // direction, to m_nonminimal_chunks.\n+        for (auto tx : m_transaction_idxs) {\n+            auto& tx_data = m_tx_data[tx];\n+            if (tx_data.chunk_rep == tx) {\n+                TxIdx pivot_idx = PickRandomTx(tx_data.chunk_setinfo.transactions);\n+                m_nonminimal_chunks.emplace_back(tx, pivot_idx, m_rng.randbits<1>());\n+                // Randomize the initial order of nonminimal chunks in the queue.\n+                TxIdx j = m_rng.randrange<TxIdx>(m_nonminimal_chunks.size());\n+                if (j != m_nonminimal_chunks.size() - 1) {\n+                    std::swap(m_nonminimal_chunks.back(), m_nonminimal_chunks[j]);\n+                }\n+            }\n+        }\n+    }\n+\n+    /** Try to reduce a chunk's size. Returns false if all chunks are minimal, true otherwise. */\n+    bool MinimizeStep() noexcept\n+    {\n+        // If the queue of potentially-non-minimal chunks is empty, we are done.\n+        if (m_nonminimal_chunks.empty()) return false;\n+        // Pop an entry from the potentially-non-minimal chunk queue.\n+        auto [chunk_rep, pivot_idx, flags] = m_nonminimal_chunks.front();\n+        m_nonminimal_chunks.pop_front();\n+        auto& chunk_data = m_tx_data[chunk_rep];\n+        Assume(chunk_data.chunk_rep == chunk_rep);\n+        /** Whether to move the pivot down rather than up. */\n+        bool move_pivot_down = flags & 1;\n+        /** Whether this is already the second stage. */\n+        bool second_stage = flags & 2;\n+\n+        // Find a random dependency whose top and bottom set feerates are equal, and which has\n+        // pivot as bottom (if move_pivot_down) or as top (if !move_pivot_down).",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 165,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "micro-nit\r\n```Suggestion\r\n        // pivot in bottom set (if move_pivot_down) or in top set (if !move_pivot_down).\r\n```",
      "created_at": "2026-01-12T16:47:28Z",
      "updated_at": "2026-01-12T18:22:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683079998",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683079998"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683136293",
      "pull_request_review_id": 3651212043,
      "id": 2683136293,
      "node_id": "PRRC_kwDOABII586f7Wkl",
      "diff_hunk": "@@ -1068,6 +1121,119 @@ class SpanningForestState\n         return false;\n     }\n \n+    /** Initialize data structure for minimizing the chunks. Step() cannot be called anymore",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 127,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "```suggestion\r\n    /** Initialize data structure for minimizing the chunks. OptimizeStep() cannot be called anymore\r\n```",
      "created_at": "2026-01-12T17:03:33Z",
      "updated_at": "2026-01-12T18:22:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683136293",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683136293"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683139952",
      "pull_request_review_id": 3651212043,
      "id": 2683139952,
      "node_id": "PRRC_kwDOABII586f7Xdw",
      "diff_hunk": "@@ -1068,6 +1121,119 @@ class SpanningForestState\n         return false;\n     }\n \n+    /** Initialize data structure for minimizing the chunks. Step() cannot be called anymore",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 127,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": 2683136293,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "we should also say this shouldn't be called unless we are known-optimal, since I think that' assumed in the minimize step code",
      "created_at": "2026-01-12T17:04:39Z",
      "updated_at": "2026-01-12T18:22:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683139952",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683139952"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683255355",
      "pull_request_review_id": 3651212043,
      "id": 2683255355,
      "node_id": "PRRC_kwDOABII586f7zo7",
      "diff_hunk": "@@ -1328,6 +1498,18 @@ class SpanningForestState\n             auto tx_idx = m_suboptimal_chunks[i];\n             assert(m_transaction_idxs[tx_idx]);\n         }\n+\n+        //\n+        // Verify m_nonminimal_chunks.\n+        //\n+        SetType nonminimal_reps;",
      "path": "src/cluster_linearize.h",
      "position": 262,
      "original_position": 262,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "nit\r\n```suggestion\r\n        assert(m_nonminimal_chunks.size() <= depgraph.TxCount());\r\n        SetType nonminimal_reps;\r\n```",
      "created_at": "2026-01-12T17:40:08Z",
      "updated_at": "2026-01-12T18:22:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683255355",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683255355"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1505,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683442144",
      "pull_request_review_id": 3652165934,
      "id": 2683442144,
      "node_id": "PRRC_kwDOABII586f8hPg",
      "diff_hunk": "@@ -1328,6 +1498,18 @@ class SpanningForestState\n             auto tx_idx = m_suboptimal_chunks[i];\n             assert(m_transaction_idxs[tx_idx]);\n         }\n+\n+        //\n+        // Verify m_nonminimal_chunks.\n+        //\n+        SetType nonminimal_reps;",
      "path": "src/cluster_linearize.h",
      "position": 262,
      "original_position": 262,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": 2683255355,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, but with an even stronger condition: `assert(m_nonminimal_chunks.IsSubsetOf(m_transaction_txns));`.",
      "created_at": "2026-01-12T18:35:56Z",
      "updated_at": "2026-01-12T18:35:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683442144",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683442144"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1505,
      "original_line": 1505,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683442596",
      "pull_request_review_id": 3652166623,
      "id": 2683442596,
      "node_id": "PRRC_kwDOABII586f8hWk",
      "diff_hunk": "@@ -1068,6 +1121,119 @@ class SpanningForestState\n         return false;\n     }\n \n+    /** Initialize data structure for minimizing the chunks. Step() cannot be called anymore",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 127,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": 2683136293,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done, done.",
      "created_at": "2026-01-12T18:36:04Z",
      "updated_at": "2026-01-12T18:36:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683442596",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683442596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1124,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683443021",
      "pull_request_review_id": 3652167426,
      "id": 2683443021,
      "node_id": "PRRC_kwDOABII586f8hdN",
      "diff_hunk": "@@ -1068,6 +1121,119 @@ class SpanningForestState\n         return false;\n     }\n \n+    /** Initialize data structure for minimizing the chunks. Step() cannot be called anymore\n+     *  afterwards. */\n+    void StartMinimizing() noexcept\n+    {\n+        m_nonminimal_chunks.clear();\n+        m_nonminimal_chunks.reserve(m_transaction_idxs.Count());\n+        // Gather all chunks, and for each, add it with a random pivot in it, and a random initial\n+        // direction, to m_nonminimal_chunks.\n+        for (auto tx : m_transaction_idxs) {\n+            auto& tx_data = m_tx_data[tx];\n+            if (tx_data.chunk_rep == tx) {\n+                TxIdx pivot_idx = PickRandomTx(tx_data.chunk_setinfo.transactions);\n+                m_nonminimal_chunks.emplace_back(tx, pivot_idx, m_rng.randbits<1>());\n+                // Randomize the initial order of nonminimal chunks in the queue.\n+                TxIdx j = m_rng.randrange<TxIdx>(m_nonminimal_chunks.size());\n+                if (j != m_nonminimal_chunks.size() - 1) {\n+                    std::swap(m_nonminimal_chunks.back(), m_nonminimal_chunks[j]);\n+                }\n+            }\n+        }\n+    }\n+\n+    /** Try to reduce a chunk's size. Returns false if all chunks are minimal, true otherwise. */\n+    bool MinimizeStep() noexcept\n+    {\n+        // If the queue of potentially-non-minimal chunks is empty, we are done.\n+        if (m_nonminimal_chunks.empty()) return false;\n+        // Pop an entry from the potentially-non-minimal chunk queue.\n+        auto [chunk_rep, pivot_idx, flags] = m_nonminimal_chunks.front();\n+        m_nonminimal_chunks.pop_front();\n+        auto& chunk_data = m_tx_data[chunk_rep];\n+        Assume(chunk_data.chunk_rep == chunk_rep);\n+        /** Whether to move the pivot down rather than up. */\n+        bool move_pivot_down = flags & 1;\n+        /** Whether this is already the second stage. */\n+        bool second_stage = flags & 2;\n+\n+        // Find a random dependency whose top and bottom set feerates are equal, and which has\n+        // pivot as bottom (if move_pivot_down) or as top (if !move_pivot_down).",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 165,
      "commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "original_commit_id": "9697bc36c1387909e8a3384f09cd9121d8788d86",
      "in_reply_to_id": 2683079998,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2026-01-12T18:36:11Z",
      "updated_at": "2026-01-12T18:36:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683443021",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683443021"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683443490",
      "pull_request_review_id": 3652168056,
      "id": 2683443490,
      "node_id": "PRRC_kwDOABII586f8hki",
      "diff_hunk": "@@ -1361,11 +1543,19 @@ std::tuple<std::vector<DepGraphIndex>, bool, uint64_t> Linearize(const DepGraph<\n     }\n     // Make improvement steps to it until we hit the max_iterations limit, or an optimal result\n     // is found.\n-    bool optimal = false;\n     if (forest.GetCost() < max_iterations) {\n         forest.StartOptimizing();\n         do {\n-            if (!forest.OptimizeStep()) {\n+            if (!forest.OptimizeStep()) break;",
      "path": "src/cluster_linearize.h",
      "position": 292,
      "original_position": 282,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "original_commit_id": "9f147194ebca05a44975b6120c93b0416dc4d747",
      "in_reply_to_id": 2682649761,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2026-01-12T18:36:18Z",
      "updated_at": "2026-01-12T18:36:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2683443490",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2683443490"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1550,
      "original_line": 1550,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2684117847",
      "pull_request_review_id": 3652983158,
      "id": 2684117847,
      "node_id": "PRRC_kwDOABII586f_GNX",
      "diff_hunk": "@@ -644,10 +676,30 @@ class SpanningForestState\n     std::vector<DepData> m_dep_data;\n     /** A FIFO of chunk representatives of chunks that may be improved still. */\n     VecDeque<TxIdx> m_suboptimal_chunks;\n+    /** A FIFO of chunk representatives with a pivot transaction in them, and a flag to indicate\n+     *  their status:\n+     *  - bit 1: currently attempting to move the pivot down, rather than up.\n+     *  - bit 2: this is the second stage, so we have already tried moving the pivot in the other\n+     *           direction.\n+     */\n+    VecDeque<std::tuple<TxIdx, TxIdx, unsigned>> m_nonminimal_chunks;\n \n     /** The number of updated transactions in activations/deactivations. */\n     uint64_t m_cost{0};\n \n+    /** Pick a random transaction within a set (which must be non-empty). */\n+    TxIdx PickRandomTx(const SetType& tx_idxs) noexcept\n+    {\n+        Assume(tx_idxs.Any());\n+        unsigned pos = m_rng.randrange<unsigned>(tx_idxs.Count());\n+        for (auto tx_idx : tx_idxs) {\n+            if (pos == 0) return tx_idx;\n+            --pos;\n+        }\n+        Assume(false);\n+        return TxIdx(-1);\n+   }",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 97,
      "commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "original_commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "game breaking\r\n```suggestion\r\n    }\r\n```",
      "created_at": "2026-01-12T22:27:45Z",
      "updated_at": "2026-01-12T22:32:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2684117847",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2684117847"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 701,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2684139741",
      "pull_request_review_id": 3653008625,
      "id": 2684139741,
      "node_id": "PRRC_kwDOABII586f_Ljd",
      "diff_hunk": "@@ -644,10 +676,30 @@ class SpanningForestState\n     std::vector<DepData> m_dep_data;\n     /** A FIFO of chunk representatives of chunks that may be improved still. */\n     VecDeque<TxIdx> m_suboptimal_chunks;\n+    /** A FIFO of chunk representatives with a pivot transaction in them, and a flag to indicate\n+     *  their status:\n+     *  - bit 1: currently attempting to move the pivot down, rather than up.\n+     *  - bit 2: this is the second stage, so we have already tried moving the pivot in the other\n+     *           direction.\n+     */\n+    VecDeque<std::tuple<TxIdx, TxIdx, unsigned>> m_nonminimal_chunks;\n \n     /** The number of updated transactions in activations/deactivations. */\n     uint64_t m_cost{0};\n \n+    /** Pick a random transaction within a set (which must be non-empty). */\n+    TxIdx PickRandomTx(const SetType& tx_idxs) noexcept\n+    {\n+        Assume(tx_idxs.Any());\n+        unsigned pos = m_rng.randrange<unsigned>(tx_idxs.Count());\n+        for (auto tx_idx : tx_idxs) {\n+            if (pos == 0) return tx_idx;\n+            --pos;\n+        }\n+        Assume(false);\n+        return TxIdx(-1);\n+   }",
      "path": "src/cluster_linearize.h",
      "position": 1,
      "original_position": 97,
      "commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "original_commit_id": "ae716cd6ff011cec3702eeedd376ab2a2b6de275",
      "in_reply_to_id": 2684117847,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "Fixed.",
      "created_at": "2026-01-12T22:38:43Z",
      "updated_at": "2026-01-12T22:38:43Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2684139741",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2684139741"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 701,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2691878381",
      "pull_request_review_id": 3662564015,
      "id": 2691878381,
      "node_id": "PRRC_kwDOABII586gcs3t",
      "diff_hunk": "@@ -2063,8 +2063,7 @@ std::pair<uint64_t, bool> GenericClusterImpl::Relinearize(TxGraphImpl& graph, in\n     uint64_t rng_seed = graph.m_rng.rand64();\n     auto [linearization, optimal, cost] = Linearize(m_depgraph, max_iters, rng_seed, m_linearization, /*is_topological=*/IsTopological());\n     // Postlinearize to undo some of the non-determinism caused by randomizing the linearization.",
      "path": "src/txgraph.cpp",
      "position": 3,
      "original_position": 3,
      "commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "original_commit_id": "da56ef239b12786e3a177afda14352dda4a70bc6",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "name": null,
        "patch_url": null
      },
      "body": "random Q: what's specific non-determinism is being removed by PostLin?",
      "created_at": "2026-01-14T20:08:25Z",
      "updated_at": "2026-01-14T20:08:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/34259#discussion_r2691878381",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2691878381"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/34259"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2065,
      "original_line": 2065,
      "side": "RIGHT"
    }
  ]
}
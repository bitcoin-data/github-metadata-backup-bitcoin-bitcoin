{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145",
    "id": 1250625611,
    "node_id": "PR_kwDOABII585KiwhL",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27145",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27145.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27145.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
    "number": 27145,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "wallet: when a block is disconnected, update transactions that are no longer conflicted",
    "user": {
      "login": "ishaanam",
      "id": 75942586,
      "node_id": "MDQ6VXNlcjc1OTQyNTg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ishaanam",
      "html_url": "https://github.com/ishaanam",
      "followers_url": "https://api.github.com/users/ishaanam/followers",
      "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
      "organizations_url": "https://api.github.com/users/ishaanam/orgs",
      "repos_url": "https://api.github.com/users/ishaanam/repos",
      "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ishaanam/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This implements a fix for #7315. Previously when a block was disconnected any transactions that were conflicting with transactions mined in that block were not updated to be marked as inactive. The fix implemented here is described on the [Bitcoin DevWiki](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Transaction-Conflict-Tracking#idea-refresh-conflicted). A test which tested the previous behavior has also been updated.\r\n\r\nSecond attempt at #17543",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/60",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/60/labels",
      "id": 9286970,
      "node_id": "MI_kwDOABII584AjbU6",
      "number": 60,
      "state": "open",
      "title": "26.0",
      "description": "",
      "creator": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "open_issues": 5,
      "closed_issues": 112,
      "created_at": "2023-04-15T11:36:05Z",
      "updated_at": "2023-11-28T16:15:56Z"
    },
    "created_at": "2023-02-22T19:00:38Z",
    "updated_at": "2023-11-30T03:16:38Z",
    "closed_at": "2023-05-27T17:07:20Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged_at": "2023-05-27T17:07:20Z",
    "merge_commit_sha": "7d33ae755de2bff806fe600bdaebedbd7fa67aba",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "ishaanam:mark_not_conflicted_inactive",
      "ref": "mark_not_conflicted_inactive",
      "sha": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 462046293,
        "node_id": "R_kgDOG4pEVQ",
        "name": "bitcoin",
        "full_name": "ishaanam/bitcoin",
        "owner": {
          "login": "ishaanam",
          "id": 75942586,
          "node_id": "MDQ6VXNlcjc1OTQyNTg2",
          "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ishaanam",
          "html_url": "https://github.com/ishaanam",
          "followers_url": "https://api.github.com/users/ishaanam/followers",
          "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
          "organizations_url": "https://api.github.com/users/ishaanam/orgs",
          "repos_url": "https://api.github.com/users/ishaanam/repos",
          "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ishaanam/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/ishaanam/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ishaanam/bitcoin",
        "archive_url": "https://api.github.com/repos/ishaanam/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ishaanam/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ishaanam/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ishaanam/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ishaanam/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ishaanam/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ishaanam/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ishaanam/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ishaanam/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ishaanam/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ishaanam/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ishaanam/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ishaanam/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ishaanam/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ishaanam/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ishaanam/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ishaanam/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ishaanam/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ishaanam/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ishaanam/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ishaanam/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ishaanam/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ishaanam/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ishaanam/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ishaanam/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ishaanam/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ishaanam/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ishaanam/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ishaanam/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ishaanam/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ishaanam/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ishaanam/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ishaanam/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ishaanam/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ishaanam/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ishaanam/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ishaanam/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ishaanam/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ishaanam/bitcoin/hooks",
        "svn_url": "https://github.com/ishaanam/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 237066,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-11-30T03:18:20Z",
        "created_at": "2022-02-21T22:03:42Z",
        "updated_at": "2022-08-26T19:13:19Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "29c36f070618ea5148cd4b2da3732ee4d37af66b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36043,
        "stargazers_count": 72368,
        "watchers_count": 72368,
        "size": 245627,
        "default_branch": "master",
        "open_issues_count": 656,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2023-11-30T02:04:58Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2023-11-30T01:54:40Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 212,
    "deletions": 57,
    "changed_files": 5,
    "commits": 3,
    "review_comments": 48,
    "comments": 12
  },
  "events": [
    {
      "event": "commented",
      "id": 1440638145,
      "node_id": "IC_kwDOABII585V3mTB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1440638145",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-22T19:00:41Z",
      "updated_at": "2023-05-27T15:33:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rajarshimaitra](https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1436418879), [achow101](https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1563232666), [glozow](https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1446696893), [furszy](https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1447436505) |\n| Concept ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1450530407) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27307](https://github.com/bitcoin/bitcoin/pull/27307) (wallet: track mempool conflicts with wallet transactions by ishaanam)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1440638145",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "labeled",
      "id": 8584452076,
      "node_id": "LE_lADOABII585fG9UqzwAAAAH_rFfs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8584452076",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-22T19:00:43Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-02-23T07:23:01Z",
      "updated_at": "2023-02-23T07:23:01Z",
      "source": {
        "issue": {
          "id": 1263730107,
          "node_id": "PR_kwDOABII5845REBZ",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/25297/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/25297",
          "number": 25297,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: group independent db writes on single batched db transaction",
          "body": "The block connection process, same as many other wallet processes, contains plenty individual db writes.\r\n\r\nThis PR batches all the db transaction that occurs along each wallet workflow. Dumping all the information to disk at once atomically at the end of the process.\r\n\r\nThen, for BDB, fixed places where we are flushing to db directly on individual writes. e.g we do it in the in the chain sync/scan process, when an output that belongs to the wallet is found if the address is not inside the address book.â€¨\r\n\r\nPlus, in several places across the wallet flows, we create new `WalletBatch` objects. Which, internally, mean: Increasing the db references number, try to open the db and, for SQLite, setup and bind the statements.\r\nThis PR avoids all this overhead by sharing the same db handler instance through each entire workflow.",
          "user": {
            "login": "furszy",
            "id": 5377650,
            "node_id": "MDQ6VXNlcjUzNzc2NTA=",
            "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/furszy",
            "html_url": "https://github.com/furszy",
            "followers_url": "https://api.github.com/users/furszy/followers",
            "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
            "organizations_url": "https://api.github.com/users/furszy/orgs",
            "repos_url": "https://api.github.com/users/furszy/repos",
            "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/furszy/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            },
            {
              "id": 955867938,
              "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
              "name": "Needs rebase",
              "description": "",
              "color": "cccccc",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 10,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/25297",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/25297",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/25297.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/25297.patch"
          },
          "closed_at": "2023-11-18T18:12:38Z",
          "created_at": "2022-06-07T18:55:49Z",
          "updated_at": "2023-11-18T18:12:39Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "commented",
      "id": 1450530407,
      "node_id": "IC_kwDOABII585WdVZn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1450530407",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-01T17:19:12Z",
      "updated_at": "2023-03-01T17:19:12Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK on refreshing state of conflicted transactions in the wallet when a block is disconnected. I think there is a potential problem with the implementation though because it isn't recursively marking conflicted transactions as unconfirmed, only marking the top level transactions without recursing.\r\n\r\nI think a good approach could be to steal from the previous implementation of this idea in commits b8b4592d985fa36dd0dddfd0e2bc6daf8df6e79c and 3c8bd6814ca88715d3d56994b10dc2c5f3e38e2d from #17543, which did recurse. That approach was also nice because it reused the existing MarkConflicted function in order to avoid code duplication. Commit ec5a89a26fa17e68b3e5928730e7d7c3e0370729 from that PR also added some more test coverage which could be used here.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1450530407",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8667263045,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIEm_BF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8667263045",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-05T03:33:03Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8667279569,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIEnDDR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8667279569",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-05T03:54:08Z"
    },
    {
      "event": "commented",
      "id": 1455001809,
      "node_id": "IC_kwDOABII585WuZDR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1455001809",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-05T06:17:10Z",
      "updated_at": "2023-03-05T06:17:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "@ryanofsky \r\n> I think there is a potential problem with the implementation though because it isn't recursively marking conflicted transactions as unconfirmed, only marking the top level transactions without recursing.\r\n\r\nYes, I had forgotten about this, thanks for pointing it out! \r\n> I think a good approach could be to steal from the previous implementation of this idea in commits https://github.com/bitcoin/bitcoin/commit/b8b4592d985fa36dd0dddfd0e2bc6daf8df6e79c and https://github.com/bitcoin/bitcoin/commit/3c8bd6814ca88715d3d56994b10dc2c5f3e38e2d from https://github.com/bitcoin/bitcoin/pull/17543, which did recurse.\r\n\r\nI have used ideas from that PR so that the transaction state updating will recurse.\r\n> Commit https://github.com/bitcoin/bitcoin/commit/ec5a89a26fa17e68b3e5928730e7d7c3e0370729 from that PR also added some more test coverage which could be used here.\r\n\r\nI have cherry-picked that commit to this branch with a few adjustments.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1455001809",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "mentioned",
      "id": 8667401124,
      "node_id": "MEE_lADOABII585fG9UqzwAAAAIEnguk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8667401124",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-05T06:17:10Z"
    },
    {
      "event": "subscribed",
      "id": 8667401128,
      "node_id": "SE_lADOABII585fG9UqzwAAAAIEnguo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8667401128",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-05T06:17:10Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-21T04:09:19Z",
      "updated_at": "2023-03-21T04:09:19Z",
      "source": {
        "issue": {
          "id": 1632858009,
          "node_id": "PR_kwDOABII585MfYTP",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27286",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27286/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27286/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27286/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27286",
          "number": 27286,
          "state": "open",
          "state_reason": null,
          "title": "wallet: Keep track of the wallet's own transaction outputs in memory",
          "body": "Currently, the wallet is not actually aware about its own transaction outputs. Instead, it will iterate all of the transactions stored in `mapWallet`, and then all of the outputs of those transactions, in order to figure out what belongs to it for the purposes of coin selection and balance calculation. For balance calculation, there is caching that results in it only iterating all of the transactions, but not all of the outputs. However when the cache is dirty, everything is iterated. This is especially problematic for wallets that have a lot of transactions, or transactions that have a lot of unrelated outputs (as may occur with coinjoins or batched payments).\r\n\r\nThis PR helps to resolve this issue by making the wallet track all of the outputs that belong to it in a new member `m_txos`. Note that this includes outputs that may have already been spent. Both balance calculation (`GetBalance`) and coin selection (`AvailableCoins`) are updated to iterate `m_txos`. This is generally faster since it ignores all of the unrelated outputs, and it is not slower as in the worst case of wallets containing only single output transactions, it's exactly the same number of outputs iterated.\r\n\r\n`m_txos` is memory only, and it is populated during wallet loading. When each transaction is loaded, all of its outputs are checked to see if it is `IsMine`, and if so, an entry added to `m_txos`. When new transactions are received, the same procedure is done.\r\n\r\nSince imports can change the `IsMine` status of a transaction (although they can only be \"promoted\" from watchonly to spendable), all of the import RPCs will be a bit slower as they re-iterate all transactions and all outputs to update `m_txos`.\r\n\r\nEach output in `m_txos` is stored in a new `WalletTXO` class. This class contains references to the parent `CWalletTx` and the `CTxOut` itself. It also caches the `IsMine` value of the txout. This should be safe as `IsMine` should not change unless there are imports. This allows us to have additional performance improvements in places that use these `WalletTXO`s as they can use the cached `IsMine` rather than repeatedly calling `IsMine` which can be expensive.\r\n\r\nThe existing `WalletBalance` benchmark demonstrates the performance improvement that this PR makes. The existing `WalletAvailableCoins` benchmark doesn't as all of the outputs used in that benchmark belong to the test wallet. I've updated that benchmark to have a bunch of unrelated outputs in each transaction so that the difference is demonstrated.\r\n\r\nThis is part of a larger project to have the wallet actually track and store a set of its UTXOs.\r\n\r\nBuilt on #24914 as it requires loading the txs last in order for `m_txos` to be built correctly.\r\n\r\n***\r\n\r\n## Benchmarks:\r\n\r\nMaster:\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|---------------:|--------:|----------:|:----------\r\n|       92,245,141.50 |               10.84 |    0.1% |  988,823,975.00 |  66,803,340.50 |    0.0% |      2.04 | `WalletAvailableCoins`\r\n|            5,709.90 |          175,134.50 |    0.5% |       80,968.24 |      25,539.15 |    0.1% |      0.01 | `WalletBalanceClean`\r\n|          139,396.17 |            7,173.80 |    0.6% |    1,383,390.50 |     430,276.86 |    0.0% |      0.01 | `WalletBalanceDirty`\r\n|            5,055.80 |          197,792.47 |    0.3% |       80,968.10 |      25,539.02 |    0.1% |      0.01 | `WalletBalanceMine`\r\n|                9.79 |      102,152,396.19 |    0.1% |          161.00 |          37.00 |    0.0% |      0.01 | `WalletBalanceWatch`\r\n|        1,552,736.00 |              644.02 |    1.5% |   20,316,315.80 |     618,545.80 |    0.6% |      0.08 | `WalletCreateTxUseOnlyPresetInputs`\r\n|      114,114,732.00 |                8.76 |    0.5% |1,291,047,717.60 | 320,244,602.00 |    0.0% |      6.30 | `WalletCreateTxUsePresetInputsAndCoinSelection`\r\n|      359,315,754.00 |                2.78 |    0.1% |4,339,447,818.00 | 136,619,757.00 |    0.7% |      1.80 | `WalletLoadingDescriptors`\r\n|       98,230,601.00 |               10.18 |    0.1% |  537,688,964.00 |  97,332,266.00 |    0.3% |      0.49 | `WalletLoadingLegacy`\r\n\r\nPR:\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|---------------:|--------:|----------:|:----------\r\n|       75,319,868.50 |               13.28 |    0.2% |  863,758,229.00 |  30,892,593.00 |    0.2% |      1.66 | `WalletAvailableCoins`\r\n|            2,367.62 |          422,364.95 |    1.0% |       35,785.05 |       9,893.01 |    0.2% |      0.01 | `WalletBalanceClean`\r\n|            2,685.58 |          372,359.55 |    0.2% |       36,501.05 |      10,027.01 |    0.1% |      0.01 | `WalletBalanceDirty`\r\n|            3,462.24 |          288,830.68 |    2.7% |       35,785.06 |       9,893.01 |    0.3% |      0.01 | `WalletBalanceMine`\r\n|               11.65 |       85,838,176.97 |    0.1% |          180.00 |          42.00 |    0.0% |      0.01 | `WalletBalanceWatch`\r\n|        1,563,092.60 |              639.76 |    1.5% |   20,426,154.40 |     649,953.80 |    0.6% |      0.09 | `WalletCreateTxUseOnlyPresetInputs`\r\n|       58,367,804.40 |               17.13 |    0.9% |  587,164,005.00 | 107,905,843.80 |    0.1% |      3.21 | `WalletCreateTxUsePresetInputsAndCoinSelection`\r\n|      365,302,636.00 |                2.74 |    0.2% |4,349,345,147.00 | 138,730,668.00 |    0.8% |      1.83 | `WalletLoadingDescriptors`\r\n|      124,995,585.00 |                8.00 |    1.2% |  801,998,316.00 | 103,210,721.00 |    0.3% |      0.63 | `WalletLoadingLegacy`\r\n",
          "user": {
            "login": "achow101",
            "id": 3782274,
            "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/achow101",
            "html_url": "https://github.com/achow101",
            "followers_url": "https://api.github.com/users/achow101/followers",
            "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
            "organizations_url": "https://api.github.com/users/achow101/orgs",
            "repos_url": "https://api.github.com/users/achow101/repos",
            "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/achow101/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": false,
          "comments": 7,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27286",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27286",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27286.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27286.patch"
          },
          "created_at": "2023-03-20T21:02:45Z",
          "updated_at": "2023-11-29T05:00:38Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "milestoned",
      "id": 8822457181,
      "node_id": "MIE_lADOABII585fG9UqzwAAAAIN3ANd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8822457181",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-03-23T01:23:54Z",
      "milestone": {
        "title": "25.0"
      }
    },
    {
      "event": "reviewed",
      "id": 1374815913,
      "node_id": "PRR_kwDOABII585R8gap",
      "url": null,
      "actor": null,
      "commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK\r\n\r\nThere is a missing dash in \"Co-authored-by:\" in the commit messages",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1374815913",
      "submitted_at": "2023-04-06T13:55:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8957073445,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIV4hgl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8957073445",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-08T04:53:19Z"
    },
    {
      "event": "commented",
      "id": 1500792114,
      "node_id": "IC_kwDOABII585ZdEUy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1500792114",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-08T04:59:49Z",
      "updated_at": "2023-04-08T04:59:49Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the review @glozow, I have addressed your comments and also made a modification to `RecursiveUpdateTxState` which will allow it to be more extensible.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1500792114",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "mentioned",
      "id": 8957084315,
      "node_id": "MEE_lADOABII585fG9UqzwAAAAIV4kKb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8957084315",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-08T04:59:50Z"
    },
    {
      "event": "subscribed",
      "id": 8957084319,
      "node_id": "SE_lADOABII585fG9UqzwAAAAIV4kKf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8957084319",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-08T04:59:50Z"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-08T10:57:50Z",
      "updated_at": "2023-04-08T10:57:50Z",
      "source": {
        "issue": {
          "id": 1636524185,
          "node_id": "PR_kwDOABII585Mrsmg",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27307",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27307/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27307/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27307/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/27307",
          "number": 27307,
          "state": "open",
          "state_reason": null,
          "title": "wallet: track mempool conflicts with wallet transactions",
          "body": "The `TxStateMempoolConflicted` class is added. It is serialized the same as `TxStateInactive` and `TxStateInMempool`. This is done because mempool-related states are relatively short lived, so it doesn't make sense to serialize them differently than they are on master (mempool-conflicted txs are currently marked as `TxStateInactive`). As a result, this PR only changes how these transaction are dealt with in memory.\r\n\r\nIn memory `TxStateConflicted` (which only refers to block conflicts) and `TxStateMempoolConflicted` are treated the same, which results in `IsSpent` returning false for an output being spent by a mempool conflicted transaction where it previously returned true.\r\n\r\nA transaction is marked as `TxStateMempoolConflicted` during `transactionAddedToMempool` where any transactions that conflict with the one just added to the mempool are marked as mempool-conflicted if they are not already block conflicted.\r\n\r\nA transaction is unmarked `TxStateMempoolConflicted` when the conflicting transaction is removed from the mempool for any reason other than it being added to a block (because in this case it will later be marked as block-conflicted anyways).\r\n\r\nThis PR also adds a `mempoolconflicts` field to the `gettransaction` wallet RPC result.\r\n\r\nBuilds on #27145\r\nSecond attempt at #18600",
          "user": {
            "login": "ishaanam",
            "id": 75942586,
            "node_id": "MDQ6VXNlcjc1OTQyNTg2",
            "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ishaanam",
            "html_url": "https://github.com/ishaanam",
            "followers_url": "https://api.github.com/users/ishaanam/followers",
            "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
            "organizations_url": "https://api.github.com/users/ishaanam/orgs",
            "repos_url": "https://api.github.com/users/ishaanam/repos",
            "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ishaanam/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": false,
          "comments": 3,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27307",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/27307",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/27307.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/27307.patch"
          },
          "created_at": "2023-03-22T21:30:01Z",
          "updated_at": "2023-11-28T23:09:40Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-11T09:55:08Z",
      "updated_at": "2023-04-11T09:55:08Z",
      "source": {
        "issue": {
          "id": 526226860,
          "node_id": "MDExOlB1bGxSZXF1ZXN0MzQzNzMyNDgx",
          "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17543",
          "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
          "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17543/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17543/comments",
          "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17543/events",
          "html_url": "https://github.com/bitcoin/bitcoin/pull/17543",
          "number": 17543,
          "state": "closed",
          "state_reason": null,
          "title": "wallet: undo conflicts properly in case of blocks disconnection",
          "body": "At the moment, in case of block disconnection, if any conflicting transaction was inside, we don't undo conflicts on wallet transactions, i.e they stay in state `CONFLICTED` instead of being marked again as `UNCONFIRMED`. This shortcoming causes inaccurate balance computation and blocks the user from re-submitting the tx back to the mempool. \r\n\r\nCurrently, if conflicted transaction was later confirmed, the status is updated accordingly and nothing changes. This PR undoes conflict(s) and also cleans up some of `MarkConflicted` which is renamed `UpdatedConflicts` to cover both instances of unconfirmed to conflicted and conflicted to unconfirmed cases. \r\n\r\nLambda is used, but I'm open to other approaches.\r\n\r\n",
          "user": {
            "login": "ariard",
            "id": 23310655,
            "node_id": "MDQ6VXNlcjIzMzEwNjU1",
            "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ariard",
            "html_url": "https://github.com/ariard",
            "followers_url": "https://api.github.com/users/ariard/followers",
            "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
            "organizations_url": "https://api.github.com/users/ariard/orgs",
            "repos_url": "https://api.github.com/users/ariard/repos",
            "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/ariard/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [
            {
              "id": 149424,
              "node_id": "MDU6TGFiZWwxNDk0MjQ=",
              "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
              "name": "Wallet",
              "color": "08a781",
              "default": false
            }
          ],
          "assignees": [],
          "author_association": "MEMBER",
          "locked": true,
          "active_lock_reason": "resolved",
          "comments": 4,
          "pull_request": {
            "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17543",
            "html_url": "https://github.com/bitcoin/bitcoin/pull/17543",
            "diff_url": "https://github.com/bitcoin/bitcoin/pull/17543.diff",
            "patch_url": "https://github.com/bitcoin/bitcoin/pull/17543.patch"
          },
          "closed_at": "2020-04-28T06:57:44Z",
          "created_at": "2019-11-20T21:30:54Z",
          "updated_at": "2023-04-11T09:55:09Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1379642409,
      "node_id": "PRR_kwDOABII585SO6wp",
      "url": null,
      "actor": null,
      "commit_id": "9895be8d792b9cf5c6ed9779e631b4d81d7d894a",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1379642409",
      "submitted_at": "2023-04-11T16:11:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8977054892,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIXEvys",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8977054892",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-11T18:36:32Z"
    },
    {
      "event": "reviewed",
      "id": 1379867013,
      "node_id": "PRR_kwDOABII585SPxmF",
      "url": null,
      "actor": null,
      "commit_id": "1a5d9981b9859d89e42a2f7c808a438dc7992496",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1379867013",
      "submitted_at": "2023-04-11T19:06:17Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 8978009735,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIXIY6H",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/8978009735",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-11T20:42:31Z"
    },
    {
      "event": "reviewed",
      "id": 1380282608,
      "node_id": "PRR_kwDOABII585SRXDw",
      "url": null,
      "actor": null,
      "commit_id": "a90f3b685a7b376e73e17ccfa4ee3d45cb9e9b72",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Haven't finished checking the latest changes but, if you like it, https://github.com/furszy/bitcoin-core/commit/8bb14c1eaf09b0bca9efa78e1a7a7a00c61c0a29 is all yours. During the review, the functional test wasn't clear enough for me so I spent a bit of time making it more friendly.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1380282608",
      "submitted_at": "2023-04-12T21:13:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "demilestoned",
      "id": 9000372730,
      "node_id": "DEME_lADOABII585fG9UqzwAAAAIYdsn6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9000372730",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-13T19:12:45Z",
      "milestone": {
        "title": "25.0"
      }
    },
    {
      "event": "reviewed",
      "id": 1384097968,
      "node_id": "PRR_kwDOABII585Sf6iw",
      "url": null,
      "actor": null,
      "commit_id": "a90f3b685a7b376e73e17ccfa4ee3d45cb9e9b72",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1384097968",
      "submitted_at": "2023-04-13T19:49:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9003816665,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIYq1bZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9003816665",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:11:07Z"
    },
    {
      "event": "commented",
      "id": 1507990460,
      "node_id": "IC_kwDOABII585Z4hu8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1507990460",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:25:57Z",
      "updated_at": "2023-04-14T21:08:54Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the review @achow101 and @furszy!\r\n> Haven't finished checking the latest changes but, if you like it, https://github.com/furszy/bitcoin-core/commit/8bb14c1eaf09b0bca9efa78e1a7a7a00c61c0a29 is all yours. During the review, the functional test wasn't clear enough for me so I spent a bit of time making it more friendly.\r\n\r\nThanks, I'll use these improvements here once I review them.\r\nEdit: I've added the suggested changes to the functional tests.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1507990460",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "mentioned",
      "id": 9003937994,
      "node_id": "MEE_lADOABII585fG9UqzwAAAAIYrTDK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9003937994",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:25:57Z"
    },
    {
      "event": "subscribed",
      "id": 9003938024,
      "node_id": "SE_lADOABII585fG9UqzwAAAAIYrTDo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9003938024",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:25:57Z"
    },
    {
      "event": "mentioned",
      "id": 9003938048,
      "node_id": "MEE_lADOABII585fG9UqzwAAAAIYrTEA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9003938048",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:25:57Z"
    },
    {
      "event": "subscribed",
      "id": 9003938063,
      "node_id": "SE_lADOABII585fG9UqzwAAAAIYrTEP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9003938063",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T06:25:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9011798887,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIZJSNn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9011798887",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-14T21:08:05Z"
    },
    {
      "event": "reviewed",
      "id": 1388756669,
      "node_id": "PRR_kwDOABII585Sxr69",
      "url": null,
      "actor": null,
      "commit_id": "fc480233988b03538f176ae16ef4202d65f3697c",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1388756669",
      "submitted_at": "2023-04-17T19:17:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "milestoned",
      "id": 9032704821,
      "node_id": "MIE_lADOABII585fG9UqzwAAAAIaZCM1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9032704821",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-18T08:06:38Z",
      "milestone": {
        "title": "26.0"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9040402431,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIa2Zf_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9040402431",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-18T21:40:08Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9040444341,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIa2ju1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9040444341",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-18T21:47:31Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9040591027,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIa3Hiz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9040591027",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-18T22:14:03Z"
    },
    {
      "event": "reviewed",
      "id": 1396709607,
      "node_id": "PRR_kwDOABII585TQBjn",
      "url": null,
      "actor": null,
      "commit_id": "26aff02b3f950f45cab609fa8d0cef4dfb18eade",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1396709607",
      "submitted_at": "2023-04-22T11:41:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA5NjQ4N2M0ZGNmYWRlYmU1Y2E5NTk5MjdmNTQyNmNhZTFjMzA0ZDU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/096487c4dcfadebe5ca959927f5426cae1c304d5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/096487c4dcfadebe5ca959927f5426cae1c304d5",
      "tree": {
        "sha": "1b2a7118a8c0bcb6978f1298c501a3d9022f7248",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1b2a7118a8c0bcb6978f1298c501a3d9022f7248"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/49d07ea9a1a251b44e849ebbaf91857cff0bd22a",
          "sha": "49d07ea9a1a251b44e849ebbaf91857cff0bd22a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/49d07ea9a1a251b44e849ebbaf91857cff0bd22a"
        }
      ],
      "message": "wallet: introduce generic recursive tx state updating function\n\nThis commit also changed `MarkConflicted` and `AbandonTransaction`\nto use this new function\n\nCo-authored-by: ariard <antoine.riard@gmail.com>",
      "committer": {
        "name": "ishaanam",
        "email": "ishaana.misra@gmail.com",
        "date": "2023-04-22T13:19:24Z"
      },
      "author": {
        "name": "ishaanam",
        "email": "ishaana.misra@gmail.com",
        "date": "2023-04-18T18:42:18Z"
      },
      "sha": "096487c4dcfadebe5ca959927f5426cae1c304d5"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9073215822,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAIczklO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9073215822",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-22T15:06:46Z"
    },
    {
      "event": "commented",
      "id": 1518682303,
      "node_id": "IC_kwDOABII585ahUC_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1518682303",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-04-22T15:08:34Z",
      "updated_at": "2023-04-22T15:08:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "Rebased to fix failing CI.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1518682303",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "reviewed",
      "id": 1413069965,
      "node_id": "PRR_kwDOABII585UObyN",
      "url": null,
      "actor": null,
      "commit_id": "6f1d394896fcc7e2687b766418f9cd4e55b613b5",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 6f1d3948",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1413069965",
      "submitted_at": "2023-05-04T13:25:49Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRjZWQyMDMxNjJkNDVlNTQyZjE4N2Y4ZDBkMDdkYWI4NWM1MmNmMjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dced203162d45e542f187f8d0d07dab85c52cf28",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dced203162d45e542f187f8d0d07dab85c52cf28",
      "tree": {
        "sha": "51bb5bb8ba2da0e4ad8639eaf8beb127e738c22c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/51bb5bb8ba2da0e4ad8639eaf8beb127e738c22c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/096487c4dcfadebe5ca959927f5426cae1c304d5",
          "sha": "096487c4dcfadebe5ca959927f5426cae1c304d5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/096487c4dcfadebe5ca959927f5426cae1c304d5"
        }
      ],
      "message": "wallet, tests: mark unconflicted txs as inactive\n\nIn `blockDisconnected`, for each transaction in the block, look\nfor any wallet transactions spending the same inputs. If any of\nthese transactions were marked conflicted, they are now marked as\ninactive.\n\nCo-authored-by: ariard <antoine.riard@gmail.com>",
      "committer": {
        "name": "ishaanam",
        "email": "ishaana.misra@gmail.com",
        "date": "2023-05-14T14:45:21Z"
      },
      "author": {
        "name": "ishaanam",
        "email": "ishaana.misra@gmail.com",
        "date": "2023-03-05T00:35:41Z"
      },
      "sha": "dced203162d45e542f187f8d0d07dab85c52cf28"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg5ZGY3OTg3YzJmMWVlYTQyNDU0YzJiMGVmYzMxYTkyNGZiZmQzYTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "tree": {
        "sha": "a6cc4a63114aa76d87223eeeee9773035882d30c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a6cc4a63114aa76d87223eeeee9773035882d30c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dced203162d45e542f187f8d0d07dab85c52cf28",
          "sha": "dced203162d45e542f187f8d0d07dab85c52cf28",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/dced203162d45e542f187f8d0d07dab85c52cf28"
        }
      ],
      "message": "Add wallets_conflicts\n\nTest the case of a tx being conflicted by multiple\ntxs with different depths. The conflicted tx is also spent by\na child tx for which confirmation status is tied to the parent's.\nAfter a reorg of conflicting txs, the conflicted status should be\nundone properly.\n\nCo-authored-by: furszy <mfurszy@protonmail.com>",
      "committer": {
        "name": "ishaanam",
        "email": "ishaana.misra@gmail.com",
        "date": "2023-05-14T14:45:27Z"
      },
      "author": {
        "name": "Antoine Riard",
        "email": "ariard@student.42.fr",
        "date": "2019-10-14T05:00:51Z"
      },
      "sha": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9240280408,
      "node_id": "HRFPE_lADOABII585fG9UqzwAAAAImw31Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9240280408",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-14T14:45:45Z"
    },
    {
      "event": "commented",
      "id": 1546917869,
      "node_id": "IC_kwDOABII585cNBft",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1546917869",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-14T14:52:56Z",
      "updated_at": "2023-05-14T14:52:56Z",
      "author_association": "CONTRIBUTOR",
      "body": "I've fixed a bug which resulted in the conflicted tx not being marked as inactive if the conflicting tx was not in `mapTxSpends`.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1546917869",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "cross-referenced",
      "id": null,
      "node_id": null,
      "url": null,
      "actor": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-14T15:02:25Z",
      "updated_at": "2023-05-14T15:02:25Z",
      "source": {
        "issue": {
          "id": 1708974948,
          "node_id": "I_kwDOId2vBM5l3ONk",
          "url": "https://api.github.com/repos/Bitshala/BitcoinCore-PR-Review-Club/issues/25",
          "repository_url": "https://api.github.com/repos/Bitshala/BitcoinCore-PR-Review-Club",
          "labels_url": "https://api.github.com/repos/Bitshala/BitcoinCore-PR-Review-Club/issues/25/labels%7B/name%7D",
          "comments_url": "https://api.github.com/repos/Bitshala/BitcoinCore-PR-Review-Club/issues/25/comments",
          "events_url": "https://api.github.com/repos/Bitshala/BitcoinCore-PR-Review-Club/issues/25/events",
          "html_url": "https://github.com/Bitshala/BitcoinCore-PR-Review-Club/issues/25",
          "number": 25,
          "state": "closed",
          "state_reason": "completed",
          "title": "wallet: when a block is disconnected, update transactions that are no longer conflicted #27145 ",
          "body": "# Session Details\r\n- Date: 18-05-2023\r\n- Time: IST 20:00 (UTC 14:30)\r\n- PR: https://github.com/bitcoin/bitcoin/pull/27145\r\n- Context: `[Wallet]`\r\n- Difficulty: Moderate\r\n- Language: `[python][c++]`\r\n\r\n# Notes\r\n\r\nA trasnaction is considered \"conflicted\" when one or more of its inputs are being spent by another transaction. A Conflicted transaction is marked with negative confirmation height in the `gettransaction` rpc call.\r\n\r\n[7315](https://github.com/bitcoin/bitcoin/issues/7315) described the situation when a conflicted transaction was previously in a block, which has later been reorged out. A reorg is a situation where a new longer chain has replaced a specific portion of the existing blockchain. So transactions in the reorged blocks are rejected.\r\n\r\nWhen a conflict with an existing wallet transaction and a transaction in reorged block is identified, previously the conflicted transaction's state wasn't updated. This would cause irregular calculation in balance, as the inputs of the conflicting transaction, which were marked unspendable, becomes spendable again.\r\n\r\n[#27145](https://github.com/bitcoin/bitcoin/pull/27145) updates this behavior, and in case of block reorgs, the conflicted wallet transactions are marked as \"inactive\".\r\n\r\n\r\n# Questions?\r\n\r\n - Did you review the PR? [Concept ACK, approach ACK, tested ACK, or NACK](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#peer-review)? What was your review approach?\r\n\r\n - What is the purpose of `try_updating_state` lambda [here](https://github.com/bitcoin/bitcoin/blob/89df7987c2f1eea42454c2b0efc31a924fbfd3a8/src/wallet/wallet.cpp#L1275-L1285)? Why do we wanna mark transactions recursively?\r\n\r\n - What is the new block disconnection logic achieving [here](https://github.com/bitcoin/bitcoin/blob/89df7987c2f1eea42454c2b0efc31a924fbfd3a8/src/wallet/wallet.cpp#L1455-L1476)?\r\n\r\n - What is `mapTxSpends` and what is it used for?\r\n\r\n - What does it mean by `EXCLUSIVE_LOCKS_REQUIRED(cs_wallet)`?\r\n\r\n - Can you describe in brief the approach taken in `wallet_conflicts.py` functional tests? Are there any other test scenarios with conflicts you can think of?\r\n\r\n - Have you tried running the `wallet_conflicts.py` on master branch? How does it fail?\r\n\r\n# Learning\r\n - Orphaned Blocks.\r\n - Transaction conflicts.\r\n - Functional Testing.\r\n - Wallet behavior. \r\n> Note: Drop your PR and review related questions below",
          "user": {
            "login": "rajarshimaitra",
            "id": 36541669,
            "node_id": "MDQ6VXNlcjM2NTQxNjY5",
            "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rajarshimaitra",
            "html_url": "https://github.com/rajarshimaitra",
            "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
            "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
            "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
            "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
            "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
            "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
            "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
            "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
            "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
            "type": "User",
            "site_admin": false
          },
          "labels": [],
          "assignees": [],
          "author_association": "CONTRIBUTOR",
          "locked": true,
          "comments": 0,
          "closed_at": "2023-05-22T11:09:57Z",
          "created_at": "2023-05-14T15:02:25Z",
          "updated_at": "2023-05-22T11:09:57Z"
        },
        "type": "issue"
      }
    },
    {
      "event": "reviewed",
      "id": 1436418879,
      "node_id": "PRR_kwDOABII585VngM_",
      "url": null,
      "actor": null,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK 89df7987c2f1eea42454c2b0efc31a924fbfd3a8.\r\n\r\nChanges look very clean. We reviewed it in out weekly club and went over the new code addition. \r\n\r\nRan the tests on the master branch and saw it failing `assert_equal(conflicted[\"confirmations\"], 0)`. In the master conflicting transaction's state doesn't update after reorg. ",
      "user": {
        "login": "rajarshimaitra",
        "id": 36541669,
        "node_id": "MDQ6VXNlcjM2NTQxNjY5",
        "avatar_url": "https://avatars.githubusercontent.com/u/36541669?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rajarshimaitra",
        "html_url": "https://github.com/rajarshimaitra",
        "followers_url": "https://api.github.com/users/rajarshimaitra/followers",
        "following_url": "https://api.github.com/users/rajarshimaitra/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rajarshimaitra/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rajarshimaitra/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rajarshimaitra/subscriptions",
        "organizations_url": "https://api.github.com/users/rajarshimaitra/orgs",
        "repos_url": "https://api.github.com/users/rajarshimaitra/repos",
        "events_url": "https://api.github.com/users/rajarshimaitra/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rajarshimaitra/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1436418879",
      "submitted_at": "2023-05-22T11:27:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "review_requested",
      "id": 9301533292,
      "node_id": "RRE_lADOABII585fG9UqzwAAAAIqaiJs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9301533292",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T11:27:50Z",
      "requested_reviewer": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 9307227181,
      "node_id": "RRE_lADOABII585fG9UqzwAAAAIqwQQt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9307227181",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-22T20:40:20Z",
      "requested_reviewer": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "commented",
      "id": 1563232666,
      "node_id": "IC_kwDOABII585dLQma",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563232666",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T17:02:50Z",
      "updated_at": "2023-05-25T17:02:50Z",
      "author_association": "MEMBER",
      "body": "ACK 89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1563232666",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "commented",
      "id": 1563723413,
      "node_id": "IC_kwDOABII585dNIaV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1563723413",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T02:15:37Z",
      "updated_at": "2023-05-26T02:15:37Z",
      "author_association": "MEMBER",
      "body": "> I've fixed a bug which resulted in the conflicted tx not being marked as inactive if the conflicting tx was not in mapTxSpends.\r\n\r\nCould you expand this?\r\n\r\nNot sure if I follow the [latest push](https://github.com/bitcoin/bitcoin/compare/6f1d394896fcc7e2687b766418f9cd4e55b613b5..89df7987c2f1eea42454c2b0efc31a924fbfd3a8), where only the inequality was changed.\r\nIf `mapTxSpends.count(outpoint) == 1`, the outpoint was spent only once, so the wallet shouldn't contain any conflicting tx.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1563723413",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "reviewed",
      "id": 1446696893,
      "node_id": "PRR_kwDOABII585WOte9",
      "url": null,
      "actor": null,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK 89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1446696893",
      "submitted_at": "2023-05-26T17:51:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "unsubscribed",
      "id": 9354181731,
      "node_id": "UE_lADOABII585fG9UqzwAAAAItjXxj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9354181731",
      "actor": {
        "login": "Andrew-SUPPORT",
        "id": 134495188,
        "node_id": "U_kgDOCAQ71A",
        "avatar_url": "https://avatars.githubusercontent.com/u/134495188?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Andrew-SUPPORT",
        "html_url": "https://github.com/Andrew-SUPPORT",
        "followers_url": "https://api.github.com/users/Andrew-SUPPORT/followers",
        "following_url": "https://api.github.com/users/Andrew-SUPPORT/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Andrew-SUPPORT/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Andrew-SUPPORT/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Andrew-SUPPORT/subscriptions",
        "organizations_url": "https://api.github.com/users/Andrew-SUPPORT/orgs",
        "repos_url": "https://api.github.com/users/Andrew-SUPPORT/repos",
        "events_url": "https://api.github.com/users/Andrew-SUPPORT/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Andrew-SUPPORT/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-26T19:58:26Z"
    },
    {
      "event": "commented",
      "id": 1565156770,
      "node_id": "IC_kwDOABII585dSmWi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565156770",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-27T02:08:29Z",
      "updated_at": "2023-05-27T02:08:29Z",
      "author_association": "CONTRIBUTOR",
      "body": ">  If mapTxSpends.count(outpoint) == 1, the outpoint was spent only once, so the wallet shouldn't contain any conflicting tx.\r\n\r\nThis is not necessarily always true, because even though the conflicted wallet transaction must always have its spends added to `mapTxSpends`, this is not the case for all conflicting transactions. \r\n\r\nFor example, let's say that Alice has a utxo. She creates a transaction, tx1, spending this utxo to Bob. `AddToSpends` will get called on Bob's node for this transaction, because Bob is the recipient. Alice then creates a conflicting transaction to tx1, called tx2, which sends the funds back to herself. However, Bob's node does not call `AddToSpends` on tx2, because Bob is not the recipient. If tx2 gets mined, but then that block is disconnected from our node, Bob's `mapTxSpends` will only show a single spend for Alice's utxo in `mapTxSpends`, even though there are technically two.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1565156770",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "commented",
      "id": 1565503469,
      "node_id": "IC_kwDOABII585dT6_t",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565503469",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-27T15:28:46Z",
      "updated_at": "2023-05-27T15:33:44Z",
      "author_association": "MEMBER",
      "body": "Ok nice, great. Thanks for the details.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1565503469",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "reviewed",
      "id": 1447436505,
      "node_id": "PRR_kwDOABII585WRiDZ",
      "url": null,
      "actor": null,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Tested ACK 89df7987\r\n\r\n> For example, let's say that Alice has a utxo. She creates a transaction, tx1, spending this utxo to Bob. AddToSpends will get called on Bob's node for this transaction, because Bob is the recipient. Alice then creates a conflicting transaction to tx1, called tx2, which sends the funds back to herself. However, Bob's node does not call AddToSpends on tx2, because Bob is not the recipient. If tx2 gets mined, but then that block is disconnected from our node, Bob's mapTxSpends will only show a single spend for Alice's utxo in mapTxSpends, even though there are technically two.\r\n\r\nMade a quick unit test and all good. Good finding.\r\nWould be good to have a real functional test in the future.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#pullrequestreview-1447436505",
      "submitted_at": "2023-05-27T15:33:08Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
    },
    {
      "event": "commented",
      "id": 1565558335,
      "node_id": "IC_kwDOABII585dUIY_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1565558335",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-27T16:08:09Z",
      "updated_at": "2023-05-27T16:08:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Would be good to have a real functional test in the future.\r\n\r\n#27307 tests this behavior, which is how I found this bug.",
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#issuecomment-1565558335",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27145"
    },
    {
      "event": "merged",
      "id": 9357907097,
      "node_id": "ME_lADOABII585fG9UqzwAAAAItxlSZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357907097",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7d33ae755de2bff806fe600bdaebedbd7fa67aba",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d33ae755de2bff806fe600bdaebedbd7fa67aba",
      "created_at": "2023-05-27T17:07:20Z"
    },
    {
      "event": "closed",
      "id": 9357907137,
      "node_id": "CE_lADOABII585fG9UqzwAAAAItxlTB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9357907137",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-27T17:07:21Z"
    },
    {
      "event": "referenced",
      "id": 9361856610,
      "node_id": "REFE_lADOABII585fG9UqzwAAAAIuAphi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9361856610",
      "actor": {
        "login": "joostjager",
        "id": 4638168,
        "node_id": "MDQ6VXNlcjQ2MzgxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4638168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joostjager",
        "html_url": "https://github.com/joostjager",
        "followers_url": "https://api.github.com/users/joostjager/followers",
        "following_url": "https://api.github.com/users/joostjager/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/joostjager/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/joostjager/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/joostjager/subscriptions",
        "organizations_url": "https://api.github.com/users/joostjager/orgs",
        "repos_url": "https://api.github.com/users/joostjager/repos",
        "events_url": "https://api.github.com/users/joostjager/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/joostjager/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "7b403b4b5e06b30331df9df000815c13d3b7b010",
      "commit_url": "https://api.github.com/repos/joostjager/bitcoin/commits/7b403b4b5e06b30331df9df000815c13d3b7b010",
      "created_at": "2023-05-28T11:52:44Z"
    },
    {
      "event": "referenced",
      "id": 9371737958,
      "node_id": "REFE_lADOABII585fG9UqzwAAAAIumV9m",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9371737958",
      "actor": {
        "login": "sidhujag",
        "id": 6238042,
        "node_id": "MDQ6VXNlcjYyMzgwNDI=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6238042?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sidhujag",
        "html_url": "https://github.com/sidhujag",
        "followers_url": "https://api.github.com/users/sidhujag/followers",
        "following_url": "https://api.github.com/users/sidhujag/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sidhujag/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sidhujag/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sidhujag/subscriptions",
        "organizations_url": "https://api.github.com/users/sidhujag/orgs",
        "repos_url": "https://api.github.com/users/sidhujag/repos",
        "events_url": "https://api.github.com/users/sidhujag/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sidhujag/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": "5cada6eaeff9a2485079e79e9ac3608d87c1b20c",
      "commit_url": "https://api.github.com/repos/syscoin/syscoin/commits/5cada6eaeff9a2485079e79e9ac3608d87c1b20c",
      "created_at": "2023-05-29T20:52:03Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 11103715852,
      "node_id": "HRDE_lADOABII585fG9UqzwAAAAKV1UIM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/11103715852",
      "actor": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-11-30T03:16:38Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159765529",
      "pull_request_review_id": 1374815913,
      "id": 1159765529,
      "node_id": "PRRC_kwDOABII585FIJ4Z",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 6,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in 77a2e522d845eda270b2c03fd7e0a16bc4c00fbb:\r\n\r\nI think this comment is a little bit hard to follow. Something more descriptive might be\r\n```suggestion\r\n\"\"\"\r\nTest that wallet correctly tracks transactions that have been conflicted by blocks, particularly during reorgs.\r\n\"\"\"\r\n```",
      "created_at": "2023-04-06T12:58:54Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159765529",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159765529"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 6,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159784792",
      "pull_request_review_id": 1374815913,
      "id": 1159784792,
      "node_id": "PRRC_kwDOABII585FIOlY",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))\n+\n+        self.log.info(\"Broadcast conflicted transaction\")\n+        conflicted_txid = self.nodes[0].sendrawtransaction(conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        # Build child conflicted tx\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(conflicted_txid)[\"details\"] if tx_out[\"amount\"] == Decimal(\"19.99998\"))\n+        inputs_child_conflicted = []\n+        inputs_child_conflicted.append({\"txid\": conflicted_txid, \"vout\": nA})\n+        outputs_child_conflicted = {}\n+        outputs_child_conflicted[self.nodes[0].getnewaddress()] = Decimal(\"19.99996\")\n+        child_conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_child_conflicted, outputs_child_conflicted))\n+        child_conflicted_txid = self.nodes[0].sendrawtransaction(child_conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        self.log.info(\"Broadcast conflicting tx to node 1\")\n+        conflicting_txid_A = self.nodes[1].sendrawtransaction(conflicting_tx_A[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+        self.nodes[1].sendrawtransaction(conflicting_tx_B[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+\n+        # Reconnect node0 and node1 and check that conflicted_txid is effectively conflicted\n+        self.log.info(\"Connect nodes 0 and 1, and ensure that the tx is effectively conflicted\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks([self.nodes[0], self.nodes[1]])\n+        conflicted = self.nodes[0].gettransaction(conflicted_txid)\n+        child_conflicted = self.nodes[0].gettransaction(child_conflicted_txid)\n+        conflicting = self.nodes[0].gettransaction(conflicting_txid_A)\n+        # Conflicted tx should have confirmations set to the confirmations of the most conflicting tx\n+        assert_equal(conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+        # Child should inherit conflicted state from parent\n+        assert_equal(child_conflicted[\"confirmations\"], -conflicting[\"confirmations\"])",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 88,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "We should also test who \"wins\" in this conflict contest and what the values are, i.e. conflicting A has 8 confirmations and conflicting B has 4 confirmations.",
      "created_at": "2023-04-06T13:17:13Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159784792",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159784792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159787578",
      "pull_request_review_id": 1374815913,
      "id": 1159787578,
      "node_id": "PRRC_kwDOABII585FIPQ6",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 41,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in 77a2e522d845eda270b2c03fd7e0a16bc4c00fbb, I think this is clearer (same with the other arrays of inputs and outputs)\r\n\r\n```suggestion\r\n        inputs_conflicted_tx = [{\"txid\": txid_conflict_from_1, \"vout\": nA}, {\"txid\": txid_conflict_from_2, \"vout\": nB}]\r\n```",
      "created_at": "2023-04-06T13:19:38Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159787578",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159787578"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 39,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159806134",
      "pull_request_review_id": 1374815913,
      "id": 1159806134,
      "node_id": "PRRC_kwDOABII585FITy2",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 56,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sorry to bikeshed, but I think the naming is a bit hard to follow (\"conflicted\" vs \"conflicting\" don't immediately make sense to me, especially since both sets of transactions get conflicted at some point during the test). Might I suggest names that indicate which input(s) they spend, which node broadcasts them, and what \"generation\" they are? For example\r\n\r\n`tx_AB_0_parent` instead of `conflicted`\r\n`tx_A_1` instead of `conflicting_tx_A`\r\n`tx_B_1` instead of `conflicting_tx_B`\r\n\r\n`C` instead of `nA` for the 19.99998BTC output, because `nA` is already the name of the 10BTC output from one of the funding transactions.\r\n`tx_C_0_child` instead of `child_conflicted`",
      "created_at": "2023-04-06T13:33:00Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159806134",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159806134"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 54,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 56,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159807735",
      "pull_request_review_id": 1374815913,
      "id": 1159807735,
      "node_id": "PRRC_kwDOABII585FIUL3",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))\n+\n+        self.log.info(\"Broadcast conflicted transaction\")\n+        conflicted_txid = self.nodes[0].sendrawtransaction(conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        # Build child conflicted tx\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(conflicted_txid)[\"details\"] if tx_out[\"amount\"] == Decimal(\"19.99998\"))\n+        inputs_child_conflicted = []\n+        inputs_child_conflicted.append({\"txid\": conflicted_txid, \"vout\": nA})\n+        outputs_child_conflicted = {}\n+        outputs_child_conflicted[self.nodes[0].getnewaddress()] = Decimal(\"19.99996\")\n+        child_conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_child_conflicted, outputs_child_conflicted))\n+        child_conflicted_txid = self.nodes[0].sendrawtransaction(child_conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        self.log.info(\"Broadcast conflicting tx to node 1\")\n+        conflicting_txid_A = self.nodes[1].sendrawtransaction(conflicting_tx_A[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+        self.nodes[1].sendrawtransaction(conflicting_tx_B[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+\n+        # Reconnect node0 and node1 and check that conflicted_txid is effectively conflicted\n+        self.log.info(\"Connect nodes 0 and 1, and ensure that the tx is effectively conflicted\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks([self.nodes[0], self.nodes[1]])\n+        conflicted = self.nodes[0].gettransaction(conflicted_txid)\n+        child_conflicted = self.nodes[0].gettransaction(child_conflicted_txid)\n+        conflicting = self.nodes[0].gettransaction(conflicting_txid_A)\n+        # Conflicted tx should have confirmations set to the confirmations of the most conflicting tx\n+        assert_equal(conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+        # Child should inherit conflicted state from parent\n+        assert_equal(child_conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+\n+        # Node2 chain without conflicts\n+        self.generate(self.nodes[2], 15, sync_fun=self.no_op)\n+\n+        # Connect node0 and node2 and wait reorg\n+        self.connect_nodes(0, 2)\n+        self.sync_blocks([self.nodes[0], self.nodes[2]])",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 95,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```suggestion\r\n        self.sync_blocks()\r\n```",
      "created_at": "2023-04-06T13:34:01Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159807735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159807735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 95,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159814534",
      "pull_request_review_id": 1374815913,
      "id": 1159814534,
      "node_id": "PRRC_kwDOABII585FIV2G",
      "diff_hunk": "@@ -1465,8 +1465,32 @@ void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n     // future with a stickier abandoned state or even removing abandontransaction call.\n     m_last_block_processed_height = block.height - 1;\n     m_last_block_processed = *Assert(block.prev_hash);\n+\n+    const int& disconnect_height = block.height;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "49f8af533f2e6370f4ae5220f5c706e30b90d06c",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in commit 49f8af533f2e6370f4ae5220f5c706e30b90d06c\r\n\r\nno need for const reference to integer\r\n",
      "created_at": "2023-04-06T13:39:49Z",
      "updated_at": "2023-04-06T13:55:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1159814534",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1159814534"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1469,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062770",
      "pull_request_review_id": 1376712428,
      "id": 1161062770,
      "node_id": "PRRC_kwDOABII585FNGly",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 6,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": 1159765529,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've updated it to this, this is much more clear.",
      "created_at": "2023-04-08T04:54:34Z",
      "updated_at": "2023-04-08T04:54:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062770",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062770"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 6,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062811",
      "pull_request_review_id": 1376712439,
      "id": 1161062811,
      "node_id": "PRRC_kwDOABII585FNGmb",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))\n+\n+        self.log.info(\"Broadcast conflicted transaction\")\n+        conflicted_txid = self.nodes[0].sendrawtransaction(conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        # Build child conflicted tx\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(conflicted_txid)[\"details\"] if tx_out[\"amount\"] == Decimal(\"19.99998\"))\n+        inputs_child_conflicted = []\n+        inputs_child_conflicted.append({\"txid\": conflicted_txid, \"vout\": nA})\n+        outputs_child_conflicted = {}\n+        outputs_child_conflicted[self.nodes[0].getnewaddress()] = Decimal(\"19.99996\")\n+        child_conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_child_conflicted, outputs_child_conflicted))\n+        child_conflicted_txid = self.nodes[0].sendrawtransaction(child_conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        self.log.info(\"Broadcast conflicting tx to node 1\")\n+        conflicting_txid_A = self.nodes[1].sendrawtransaction(conflicting_tx_A[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+        self.nodes[1].sendrawtransaction(conflicting_tx_B[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+\n+        # Reconnect node0 and node1 and check that conflicted_txid is effectively conflicted\n+        self.log.info(\"Connect nodes 0 and 1, and ensure that the tx is effectively conflicted\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks([self.nodes[0], self.nodes[1]])\n+        conflicted = self.nodes[0].gettransaction(conflicted_txid)\n+        child_conflicted = self.nodes[0].gettransaction(child_conflicted_txid)\n+        conflicting = self.nodes[0].gettransaction(conflicting_txid_A)\n+        # Conflicted tx should have confirmations set to the confirmations of the most conflicting tx\n+        assert_equal(conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+        # Child should inherit conflicted state from parent\n+        assert_equal(child_conflicted[\"confirmations\"], -conflicting[\"confirmations\"])",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 88,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": 1159784792,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've added a check for this.",
      "created_at": "2023-04-08T04:54:48Z",
      "updated_at": "2023-04-08T04:54:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062811",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062811"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 88,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062833",
      "pull_request_review_id": 1376712446,
      "id": 1161062833,
      "node_id": "PRRC_kwDOABII585FNGmx",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 41,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": 1159787578,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-08T04:55:00Z",
      "updated_at": "2023-04-08T04:55:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062833",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062833"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 39,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 41,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062927",
      "pull_request_review_id": 1376712520,
      "id": 1161062927,
      "node_id": "PRRC_kwDOABII585FNGoP",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 56,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": 1159806134,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I agree, the naming here was a bit confusing. It should be fixed now.",
      "created_at": "2023-04-08T04:55:58Z",
      "updated_at": "2023-04-08T04:55:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062927",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062927"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 54,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 56,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062954",
      "pull_request_review_id": 1376712542,
      "id": 1161062954,
      "node_id": "PRRC_kwDOABII585FNGoq",
      "diff_hunk": "@@ -0,0 +1,113 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2023 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+\"\"\"Test conflicts tracking with multilple txn conflicting a conflicted tx.\"\"\"\n+\n+from decimal import Decimal\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+        assert_equal,\n+)\n+\n+class TxConflicts(BitcoinTestFramework):\n+    def add_options(self, parser):\n+        self.add_wallet_options(parser)\n+\n+    def set_test_params(self):\n+        self.num_nodes = 3\n+\n+    def skip_test_if_missing_module(self):\n+        self.skip_if_no_wallet()\n+\n+    def run_test(self):\n+        self.log.info(\"Send tx from which to conflict outputs later\")\n+        txid_conflict_from_1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        txid_conflict_from_2 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), Decimal(\"10\"))\n+        self.generate(self.nodes[0], 1)\n+        self.sync_blocks()\n+\n+        self.log.info(\"Disconnect nodes to broadcast conflicts on their respective chains\")\n+        self.disconnect_nodes(0, 1)\n+        self.disconnect_nodes(2, 1)\n+\n+        self.log.info(\"Create a transaction with conflicted transactions spending outpoints A & B\")\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_1)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        nB = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(txid_conflict_from_2)[\"details\"] if tx_out[\"amount\"] == Decimal(\"10\"))\n+        inputs_conflicted_tx = []\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicted_tx.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+        inputs_conflicting_tx_A = []\n+        inputs_conflicting_tx_A.append({\"txid\": txid_conflict_from_1, \"vout\": nA})\n+        inputs_conflicting_tx_B = []\n+        inputs_conflicting_tx_B.append({\"txid\": txid_conflict_from_2, \"vout\": nB})\n+\n+        outputs_conflicted_tx = {}\n+        outputs_conflicted_tx[self.nodes[0].getnewaddress()] = Decimal(\"19.99998\")\n+        outputs_conflicting_tx_A = {}\n+        outputs_conflicting_tx_A[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+        outputs_conflicting_tx_B = {}\n+        outputs_conflicting_tx_B[self.nodes[0].getnewaddress()] = Decimal(\"9.99998\")\n+\n+        conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicted_tx, outputs_conflicted_tx))\n+        conflicting_tx_A = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_A, outputs_conflicting_tx_A))\n+        conflicting_tx_B = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_conflicting_tx_B, outputs_conflicting_tx_B))\n+\n+        self.log.info(\"Broadcast conflicted transaction\")\n+        conflicted_txid = self.nodes[0].sendrawtransaction(conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        # Build child conflicted tx\n+        nA = next(tx_out[\"vout\"] for tx_out in self.nodes[0].gettransaction(conflicted_txid)[\"details\"] if tx_out[\"amount\"] == Decimal(\"19.99998\"))\n+        inputs_child_conflicted = []\n+        inputs_child_conflicted.append({\"txid\": conflicted_txid, \"vout\": nA})\n+        outputs_child_conflicted = {}\n+        outputs_child_conflicted[self.nodes[0].getnewaddress()] = Decimal(\"19.99996\")\n+        child_conflicted = self.nodes[0].signrawtransactionwithwallet(self.nodes[0].createrawtransaction(inputs_child_conflicted, outputs_child_conflicted))\n+        child_conflicted_txid = self.nodes[0].sendrawtransaction(child_conflicted[\"hex\"])\n+        self.generate(self.nodes[0], 1, sync_fun=self.no_op)\n+\n+        self.log.info(\"Broadcast conflicting tx to node 1\")\n+        conflicting_txid_A = self.nodes[1].sendrawtransaction(conflicting_tx_A[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+        self.nodes[1].sendrawtransaction(conflicting_tx_B[\"hex\"])\n+        self.generate(self.nodes[1], 4, sync_fun=self.no_op)\n+\n+        # Reconnect node0 and node1 and check that conflicted_txid is effectively conflicted\n+        self.log.info(\"Connect nodes 0 and 1, and ensure that the tx is effectively conflicted\")\n+        self.connect_nodes(0, 1)\n+        self.sync_blocks([self.nodes[0], self.nodes[1]])\n+        conflicted = self.nodes[0].gettransaction(conflicted_txid)\n+        child_conflicted = self.nodes[0].gettransaction(child_conflicted_txid)\n+        conflicting = self.nodes[0].gettransaction(conflicting_txid_A)\n+        # Conflicted tx should have confirmations set to the confirmations of the most conflicting tx\n+        assert_equal(conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+        # Child should inherit conflicted state from parent\n+        assert_equal(child_conflicted[\"confirmations\"], -conflicting[\"confirmations\"])\n+\n+        # Node2 chain without conflicts\n+        self.generate(self.nodes[2], 15, sync_fun=self.no_op)\n+\n+        # Connect node0 and node2 and wait reorg\n+        self.connect_nodes(0, 2)\n+        self.sync_blocks([self.nodes[0], self.nodes[2]])",
      "path": "test/functional/wallet_conflicts.py",
      "position": null,
      "original_position": 95,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "77a2e522d845eda270b2c03fd7e0a16bc4c00fbb",
      "in_reply_to_id": 1159807735,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done both here and one other place.",
      "created_at": "2023-04-08T04:56:21Z",
      "updated_at": "2023-04-08T04:56:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062954",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062954"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 95,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062971",
      "pull_request_review_id": 1376712557,
      "id": 1161062971,
      "node_id": "PRRC_kwDOABII585FNGo7",
      "diff_hunk": "@@ -1465,8 +1465,32 @@ void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n     // future with a stickier abandoned state or even removing abandontransaction call.\n     m_last_block_processed_height = block.height - 1;\n     m_last_block_processed = *Assert(block.prev_hash);\n+\n+    const int& disconnect_height = block.height;",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 5,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "49f8af533f2e6370f4ae5220f5c706e30b90d06c",
      "in_reply_to_id": 1159814534,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed",
      "created_at": "2023-04-08T04:56:33Z",
      "updated_at": "2023-04-08T04:56:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1161062971",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1161062971"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1469,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163045689",
      "pull_request_review_id": 1379642409,
      "id": 1163045689,
      "node_id": "PRRC_kwDOABII585FUqs5",
      "diff_hunk": "@@ -1336,13 +1336,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);\n+\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, get_updated_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const GetUpdatedStateFn& get_updated_state) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "c3fe92175b6ac709e4fdfd4766253c75d7ffd184",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In c3fe92175b6ac709e4fdfd4766253c75d7ffd184 \"wallet: introduce generic recursive tx state updating function\"\r\n\r\nThis could also be used by `AbandonTransaction`.",
      "created_at": "2023-04-11T16:09:10Z",
      "updated_at": "2023-04-11T16:11:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163045689",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163045689"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163046096",
      "pull_request_review_id": 1379642409,
      "id": 1163046096,
      "node_id": "PRRC_kwDOABII585FUqzQ",
      "diff_hunk": "@@ -1351,11 +1367,7 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n         auto it = mapWallet.find(now);\n         assert(it != mapWallet.end());\n         CWalletTx& wtx = it->second;\n-        int currentconfirm = GetTxDepthInMainChain(wtx);\n-        if (conflictconfirms < currentconfirm) {\n-            // Block is 'more conflicted' than current confirm; update.\n-            // Mark transaction as conflicted with this block.\n-            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+        if (get_updated_state(wtx)) {\n             wtx.MarkDirty();\n             batch.WriteTx(wtx);\n             // Iterate over all its outputs, and mark transactions in the wallet that spend them conflicted too",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 44,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "c3fe92175b6ac709e4fdfd4766253c75d7ffd184",
      "in_reply_to_id": null,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In c3fe92175b6ac709e4fdfd4766253c75d7ffd184 \"wallet: introduce generic recursive tx state updating function\"\r\n\r\nThe comments should be updated to avoid mentioning specific transaction states.",
      "created_at": "2023-04-11T16:09:32Z",
      "updated_at": "2023-04-11T16:11:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163046096",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163046096"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1373,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163192581",
      "pull_request_review_id": 1379867013,
      "id": 1163192581,
      "node_id": "PRRC_kwDOABII585FVOkF",
      "diff_hunk": "@@ -1336,13 +1313,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);\n+\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, get_updated_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const GetUpdatedStateFn& get_updated_state) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 89,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "06d7eb71575254e2b8c19625f6880433ed1409e4",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "The `GetUpdatedStateFn` function isn't really a getter, what about calling it `TryUpdateState`?.",
      "created_at": "2023-04-11T18:37:09Z",
      "updated_at": "2023-04-11T19:06:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163192581",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163192581"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163192633",
      "pull_request_review_id": 1379867739,
      "id": 1163192633,
      "node_id": "PRRC_kwDOABII585FVOk5",
      "diff_hunk": "@@ -1336,13 +1336,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);\n+\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, get_updated_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const GetUpdatedStateFn& get_updated_state) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 19,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "c3fe92175b6ac709e4fdfd4766253c75d7ffd184",
      "in_reply_to_id": 1163045689,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-11T18:37:13Z",
      "updated_at": "2023-04-11T18:37:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163192633",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163192633"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163193445",
      "pull_request_review_id": 1379868892,
      "id": 1163193445,
      "node_id": "PRRC_kwDOABII585FVOxl",
      "diff_hunk": "@@ -1351,11 +1367,7 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n         auto it = mapWallet.find(now);\n         assert(it != mapWallet.end());\n         CWalletTx& wtx = it->second;\n-        int currentconfirm = GetTxDepthInMainChain(wtx);\n-        if (conflictconfirms < currentconfirm) {\n-            // Block is 'more conflicted' than current confirm; update.\n-            // Mark transaction as conflicted with this block.\n-            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+        if (get_updated_state(wtx)) {\n             wtx.MarkDirty();\n             batch.WriteTx(wtx);\n             // Iterate over all its outputs, and mark transactions in the wallet that spend them conflicted too",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 44,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "c3fe92175b6ac709e4fdfd4766253c75d7ffd184",
      "in_reply_to_id": 1163046096,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Right, I've made them more generic now.",
      "created_at": "2023-04-11T18:38:06Z",
      "updated_at": "2023-04-11T18:38:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163193445",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163193445"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1373,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163196400",
      "pull_request_review_id": 1379867013,
      "id": 1163196400,
      "node_id": "PRRC_kwDOABII585FVPfw",
      "diff_hunk": "@@ -1336,13 +1313,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "06d7eb71575254e2b8c19625f6880433ed1409e4",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No need to re-acquire `cs_wallet` here (`RecursiveUpdateTxState` already locks `cs_wallet`) . Can add the exclusive lock annotation instead, e.g:\r\n\r\n```c++\r\nconst auto& try_update_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\r\n    if (conflictconfirms >= GetTxDepthInMainChain(wtx)) return false;\r\n    \r\n    wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\r\n    return true;\r\n};\r\n```\r\n\r\n(same for the others)",
      "created_at": "2023-04-11T18:41:40Z",
      "updated_at": "2023-04-11T19:08:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163196400",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163196400"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 1316,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163430354",
      "pull_request_review_id": 1380228035,
      "id": 1163430354,
      "node_id": "PRRC_kwDOABII585FWInS",
      "diff_hunk": "@@ -1336,13 +1313,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);\n+\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, get_updated_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const GetUpdatedStateFn& get_updated_state) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 89,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "06d7eb71575254e2b8c19625f6880433ed1409e4",
      "in_reply_to_id": 1163192581,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, I've changed `GetUpdatedStateFn` to `TryUpdatingStateFn`, and `get_updated_state` to `try_updating_state`.",
      "created_at": "2023-04-11T23:47:04Z",
      "updated_at": "2023-04-11T23:47:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163430354",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163430354"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1330,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163430929",
      "pull_request_review_id": 1380228712,
      "id": 1163430929,
      "node_id": "PRRC_kwDOABII585FWIwR",
      "diff_hunk": "@@ -1336,13 +1313,29 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto get_updated_state = [&](CWalletTx& wtx) {\n+        LOCK(cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "06d7eb71575254e2b8c19625f6880433ed1409e4",
      "in_reply_to_id": 1163196400,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I've implemented this, it also fixes the CI error.",
      "created_at": "2023-04-11T23:48:16Z",
      "updated_at": "2023-04-11T23:48:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163430929",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163430929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": 1316,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163469554",
      "pull_request_review_id": 1380282608,
      "id": 1163469554,
      "node_id": "PRRC_kwDOABII585FWSLy",
      "diff_hunk": "@@ -1443,8 +1443,36 @@ void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n     // future with a stickier abandoned state or even removing abandontransaction call.\n     m_last_block_processed_height = block.height - 1;\n     m_last_block_processed = *Assert(block.prev_hash);\n+\n+    int disconnect_height = block.height;\n+\n     for (const CTransactionRef& ptx : Assert(block.data)->vtx) {\n         SyncTransaction(ptx, TxStateInactive{});\n+\n+        for (const CTxIn& tx_in : ptx->vin) {\n+            // No other wallet transactions conflicted with this transaction\n+            if (mapTxSpends.count(tx_in.prevout) <= 1) continue;\n+\n+            std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+            // For all of the spends that conflict with this transaction\n+            for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+                CWalletTx& wtx = mapWallet.find(_it->second)->second;\n+\n+                if (!wtx.isConflicted()) continue;\n+\n+                auto try_updating_state = [&](CWalletTx& wtx) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "fadc353c6765ba0c81e9d4f26f204a1d4452030d",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I would try to not provide the context by reference to the function. The lambda function's `wtx` shadows the function's `wtx`. Could just provide `disconnect_height`.",
      "created_at": "2023-04-12T01:22:21Z",
      "updated_at": "2023-04-12T21:13:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1163469554",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1163469554"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165954948",
      "pull_request_review_id": 1384097968,
      "id": 1165954948,
      "node_id": "PRRC_kwDOABII585Ffw-E",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, try_updating_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const TryUpdatingStateFn& try_updating_state) {\n+    LOCK(cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In f998cdbc:\r\nThis lock isn't needed. All callers have `cs_wallet` acquired. Could add the lock required annotation instead.",
      "created_at": "2023-04-13T19:39:20Z",
      "updated_at": "2023-04-13T19:49:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1165954948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165954948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1331,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165959935",
      "pull_request_review_id": 1384097968,
      "id": 1165959935,
      "node_id": "PRRC_kwDOABII585FfyL_",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+\n         if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.m_state = TxStateInactive{/*abandoned=*/true};\n-            wtx.MarkDirty();\n-            batch.WriteTx(wtx);\n             NotifyTransactionChanged(wtx.GetHash(), CT_UPDATED);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 37,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In f998cdbc:\r\n\r\nWould be good to move this `NotifyTransactionChanged` to `RecursiveUpdateTxState` too. So `MarkConflicted` and the `BlockDisconnected` txes state changes are notified to the upper layers.",
      "created_at": "2023-04-13T19:45:39Z",
      "updated_at": "2023-04-13T19:49:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1165959935",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1165959935"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1287,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166323704",
      "pull_request_review_id": 1384666668,
      "id": 1166323704,
      "node_id": "PRRC_kwDOABII585FhK_4",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+\n         if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.m_state = TxStateInactive{/*abandoned=*/true};\n-            wtx.MarkDirty();\n-            batch.WriteTx(wtx);\n             NotifyTransactionChanged(wtx.GetHash(), CT_UPDATED);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 37,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1165959935,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think that this is a good idea, but would be out of the scope of this PR and would warrant more discussion, since then it would be notifying for tx state updates that it previously did not.",
      "created_at": "2023-04-14T06:14:18Z",
      "updated_at": "2023-04-17T18:23:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1166323704",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166323704"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1287,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166323841",
      "pull_request_review_id": 1384666812,
      "id": 1166323841,
      "node_id": "PRRC_kwDOABII585FhLCB",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, try_updating_state);\n+\n+}\n+\n+void CWallet::RecursiveUpdateTxState(const uint256& tx_hash, const TryUpdatingStateFn& try_updating_state) {\n+    LOCK(cs_wallet);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 88,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1165954948,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-14T06:14:27Z",
      "updated_at": "2023-04-14T06:14:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1166323841",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166323841"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1331,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166333715",
      "pull_request_review_id": 1384680323,
      "id": 1166333715,
      "node_id": "PRRC_kwDOABII585FhNcT",
      "diff_hunk": "@@ -1443,8 +1443,36 @@ void CWallet::blockDisconnected(const interfaces::BlockInfo& block)\n     // future with a stickier abandoned state or even removing abandontransaction call.\n     m_last_block_processed_height = block.height - 1;\n     m_last_block_processed = *Assert(block.prev_hash);\n+\n+    int disconnect_height = block.height;\n+\n     for (const CTransactionRef& ptx : Assert(block.data)->vtx) {\n         SyncTransaction(ptx, TxStateInactive{});\n+\n+        for (const CTxIn& tx_in : ptx->vin) {\n+            // No other wallet transactions conflicted with this transaction\n+            if (mapTxSpends.count(tx_in.prevout) <= 1) continue;\n+\n+            std::pair<TxSpends::const_iterator, TxSpends::const_iterator> range = mapTxSpends.equal_range(tx_in.prevout);\n+\n+            // For all of the spends that conflict with this transaction\n+            for (TxSpends::const_iterator _it = range.first; _it != range.second; ++_it) {\n+                CWalletTx& wtx = mapWallet.find(_it->second)->second;\n+\n+                if (!wtx.isConflicted()) continue;\n+\n+                auto try_updating_state = [&](CWalletTx& wtx) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 22,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "fadc353c6765ba0c81e9d4f26f204a1d4452030d",
      "in_reply_to_id": 1163469554,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "> The lambda function's wtx shadows the function's wtx.\r\n\r\nI have renamed the lambda function's `wtx`.\r\n> Could just provide disconnect_height.\r\n\r\nBy this do you mean providing the `disconnect_height` of the block to `RecursiveUpdateTxState` or providing the wallet tx's `conflicting_block_height` to `try_updating_state` instead of the whole wallet tx by reference?",
      "created_at": "2023-04-14T06:22:46Z",
      "updated_at": "2023-04-14T06:22:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1166333715",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1166333715"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1464,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168973760",
      "pull_request_review_id": 1388499202,
      "id": 1168973760,
      "node_id": "PRRC_kwDOABII585FrR_A",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+\n         if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.m_state = TxStateInactive{/*abandoned=*/true};\n-            wtx.MarkDirty();\n-            batch.WriteTx(wtx);\n             NotifyTransactionChanged(wtx.GetHash(), CT_UPDATED);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 37,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1165959935,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\n> I think that this is a good idea, but would out of the scope of this PR and would warrant more discussion, since then it would be notifying for tx state updates that it previously did not.\r\n\r\nAgree we should avoid changing behavior, but I think the current commit might also be changing behavior by notifying before calling MarkDirty and WriteTx instead of after.\r\n\r\nI think the best thing to do would be to change TryUpdatingStateFn to return an enum instead of a bool like:\r\n\r\n```c++\r\nenum class TxUpdate { UNCHANGED, CHANGED, NOTIFY_CHANGED };\r\nusing TryUpdatingStateFn = std::function<TxUpdate(CWalletTx& wtx)>;\r\n```\r\n\r\nReturning CHANGED/UNCHANGED should make the code clearer anyway because it's less obvious what true and false mean.",
      "created_at": "2023-04-17T16:13:12Z",
      "updated_at": "2023-04-17T16:13:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1168973760",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1168973760"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1287,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169145950",
      "pull_request_review_id": 1388756669,
      "id": 1169145950,
      "node_id": "PRRC_kwDOABII585Fr8Be",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}",
      "path": "src/wallet/wallet.cpp",
      "position": 28,
      "original_position": 29,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\nI think as long as this code is still calling GetTxDepthInMainChain, it would be better to keep the 3 comments that were here instead of deleting them, because they explain why the asserts are valid and why conflicted transactions are ignored",
      "created_at": "2023-04-17T18:47:36Z",
      "updated_at": "2023-04-17T19:17:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1169145950",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169145950"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1292,
      "original_line": 1292,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169161201",
      "pull_request_review_id": 1388756669,
      "id": 1169161201,
      "node_id": "PRRC_kwDOABII585Fr_vx",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\nIt seems like the code in this lambda would be simpler it avoided calling GetTxDepthInMainChain. The following should be equivalent:\r\n\r\n```c++\r\n// If the orig tx was not in block/mempool, none of its spends can be.\r\nassert(!wtx.isConfirmed());\r\nassert(!wtx.InMempool());\r\n// If already conflicted or abandoned, no need to set abandoned.\r\nif (!wtx.isConflicted() && !wtx.isAbandoned()) {\r\n    wtx.m_state = TxStateInactive{/*abandoned=*/true};\r\n    ...\r\n}\r\n```\r\n\r\nFree to ignore this suggestion if you think it would complicate things, though. The cleanup is orthogonal and could be done separately.",
      "created_at": "2023-04-17T18:58:33Z",
      "updated_at": "2023-04-17T19:17:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1169161201",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169161201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169166456",
      "pull_request_review_id": 1388756669,
      "id": 1169166456,
      "node_id": "PRRC_kwDOABII585FsBB4",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons",
      "path": "src/wallet/wallet.cpp",
      "position": 94,
      "original_position": 74,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\nThis also seems like a useful comment. Would keep instead of deleting",
      "created_at": "2023-04-17T19:04:26Z",
      "updated_at": "2023-04-17T19:17:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1169166456",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169166456"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1334,
      "original_line": 1334,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169172208",
      "pull_request_review_id": 1388756669,
      "id": 1169172208,
      "node_id": "PRRC_kwDOABII585FsCbw",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, try_updating_state);",
      "path": "src/wallet/wallet.cpp",
      "position": 89,
      "original_position": 83,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\nThis code pretty opaque, would suggest copying the previous comment here \"Iterate over all its outputs, and mark transactions in the wallet that spend them conflicted too\" or something equivalent.",
      "created_at": "2023-04-17T19:11:13Z",
      "updated_at": "2023-04-17T19:17:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1169172208",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169172208"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1321,
      "original_line": 1321,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169173396",
      "pull_request_review_id": 1388756669,
      "id": 1169173396,
      "node_id": "PRRC_kwDOABII585FsCuU",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};",
      "path": "src/wallet/wallet.cpp",
      "position": 82,
      "original_position": 77,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": null,
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In commit \"wallet: introduce generic recursive tx state updating function\" (f998cdbc689cc65ff0aca98ce63758c59786c1db)\r\n\r\nWould suggest keeping the previous comment here instead of deleting it. It's not obvious what the check means or what's happening in the block:\r\n\r\n```c++\r\n// Block is 'more conflicted' than current confirm; update.\r\n// Mark transaction as conflicted with this block.\r\n```",
      "created_at": "2023-04-17T19:12:34Z",
      "updated_at": "2023-04-17T19:17:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1169173396",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1169173396"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1314,
      "original_line": 1314,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170596878",
      "pull_request_review_id": 1390975672,
      "id": 1170596878,
      "node_id": "PRRC_kwDOABII585FxeQO",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n+\n         if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n             assert(!wtx.InMempool());\n             wtx.m_state = TxStateInactive{/*abandoned=*/true};\n-            wtx.MarkDirty();\n-            batch.WriteTx(wtx);\n             NotifyTransactionChanged(wtx.GetHash(), CT_UPDATED);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 37,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1165959935,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have implemented this suggestion, I agree that it is much clearer now.",
      "created_at": "2023-04-18T21:42:14Z",
      "updated_at": "2023-04-18T21:42:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170596878",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170596878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1287,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170597818",
      "pull_request_review_id": 1390977262,
      "id": 1170597818,
      "node_id": "PRRC_kwDOABII585Fxee6",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n         assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}",
      "path": "src/wallet/wallet.cpp",
      "position": 28,
      "original_position": 29,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1169145950,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I implemented your next suggestion about simplifying the code in the lambda, so the comments are a bit different now but I did add them back.",
      "created_at": "2023-04-18T21:43:30Z",
      "updated_at": "2023-04-18T21:43:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170597818",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170597818"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1292,
      "original_line": 1292,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170598598",
      "pull_request_review_id": 1390978356,
      "id": 1170598598,
      "node_id": "PRRC_kwDOABII585FxerG",
      "diff_hunk": "@@ -1282,44 +1277,26 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n         int currentconfirm = GetTxDepthInMainChain(wtx);",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 26,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1169161201,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is simpler and it is a small change so I've implemented it in this commit.",
      "created_at": "2023-04-18T21:44:43Z",
      "updated_at": "2023-04-18T21:44:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170598598",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170598598"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599011",
      "pull_request_review_id": 1390978865,
      "id": 1170599011,
      "node_id": "PRRC_kwDOABII585Fxexj",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons",
      "path": "src/wallet/wallet.cpp",
      "position": 94,
      "original_position": 74,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1169166456,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have added it back.",
      "created_at": "2023-04-18T21:45:14Z",
      "updated_at": "2023-04-18T21:45:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170599011",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599011"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1334,
      "original_line": 1334,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599147",
      "pull_request_review_id": 1390979053,
      "id": 1170599147,
      "node_id": "PRRC_kwDOABII585Fxezr",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};\n+            return true;\n+        }\n+        return false;\n+    };\n+\n+    RecursiveUpdateTxState(hashTx, try_updating_state);",
      "path": "src/wallet/wallet.cpp",
      "position": 89,
      "original_position": 83,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1169172208,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-18T21:45:24Z",
      "updated_at": "2023-04-18T21:45:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170599147",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599147"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1321,
      "original_line": 1321,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599313",
      "pull_request_review_id": 1390979304,
      "id": 1170599313,
      "node_id": "PRRC_kwDOABII585Fxe2R",
      "diff_hunk": "@@ -1336,13 +1313,27 @@ void CWallet::MarkConflicted(const uint256& hashBlock, int conflicting_height, c\n     if (conflictconfirms >= 0)\n         return;\n \n-    // Do not flush the wallet here for performance reasons\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\n+        if (conflictconfirms < GetTxDepthInMainChain(wtx)) {\n+            wtx.m_state = TxStateConflicted{hashBlock, conflicting_height};",
      "path": "src/wallet/wallet.cpp",
      "position": 82,
      "original_position": 77,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "f998cdbc689cc65ff0aca98ce63758c59786c1db",
      "in_reply_to_id": 1169173396,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-18T21:45:41Z",
      "updated_at": "2023-04-18T21:45:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1170599313",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1170599313"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1314,
      "original_line": 1314,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174393895",
      "pull_request_review_id": 1396709607,
      "id": 1174393895,
      "node_id": "PRRC_kwDOABII585F_9Qn",
      "diff_hunk": "@@ -1282,44 +1277,25 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n-        int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n-        assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n-        if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n-            assert(!wtx.InMempool());\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "26aff02b3f950f45cab609fa8d0cef4dfb18eade",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: if you have to retouch. Can remove the context ref.\r\n```suggestion\r\n    auto try_updating_state = [](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {\r\n```",
      "created_at": "2023-04-22T11:39:23Z",
      "updated_at": "2023-04-22T11:43:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1174393895",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174393895"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1280,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174426912",
      "pull_request_review_id": 1396749905,
      "id": 1174426912,
      "node_id": "PRRC_kwDOABII585GAFUg",
      "diff_hunk": "@@ -1282,44 +1277,25 @@ bool CWallet::AbandonTransaction(const uint256& hashTx)\n         return false;\n     }\n \n-    todo.insert(hashTx);\n-\n-    while (!todo.empty()) {\n-        uint256 now = *todo.begin();\n-        todo.erase(now);\n-        done.insert(now);\n-        auto it = mapWallet.find(now);\n-        assert(it != mapWallet.end());\n-        CWalletTx& wtx = it->second;\n-        int currentconfirm = GetTxDepthInMainChain(wtx);\n-        // If the orig tx was not in block, none of its spends can be\n-        assert(currentconfirm <= 0);\n-        // if (currentconfirm < 0) {Tx and spends are already conflicted, no need to abandon}\n-        if (currentconfirm == 0 && !wtx.isAbandoned()) {\n-            // If the orig tx was not in block/mempool, none of its spends can be in mempool\n-            assert(!wtx.InMempool());\n+    auto try_updating_state = [&](CWalletTx& wtx) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet) {",
      "path": "src/wallet/wallet.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "26aff02b3f950f45cab609fa8d0cef4dfb18eade",
      "in_reply_to_id": 1174393895,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done",
      "created_at": "2023-04-22T15:08:06Z",
      "updated_at": "2023-04-22T15:08:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1174426912",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1174426912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1280,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185000020",
      "pull_request_review_id": 1413069965,
      "id": 1185000020,
      "node_id": "PRRC_kwDOABII585GoapU",
      "diff_hunk": "@@ -226,20 +226,16 @@ def run_test(self):\n         assert_equal(double_spend[\"walletconflicts\"], [txAB1])\n \n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n+        assert_equal(alice.gettransaction(txAB1)[\"confirmations\"], -1)\n         newbalance = alice.getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))\n         balance = newbalance\n \n-        # There is currently a minor bug around this and so this test doesn't work.  See Issue #7315\n-        # Invalidate the block with the double spend and B's 10 BTC output should no longer be available\n-        # Don't think C's should either\n+        # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available",
      "path": "test/functional/wallet_abandonconflict.py",
      "position": 12,
      "original_position": 12,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "62cdcd02cd3ae5ad766b89abc211a745598bdbaa",
      "in_reply_to_id": null,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Let me see if I'm following this:\r\n\r\n`Tx_AB1` spends B, and `Tx_ABC2` (the child of `Tx_AB1`) spends C. So, when the double spend tx gets disconnected, `Tx_AB1` state changes to `inactive`, marking output B and C as spent again.\r\n\r\nWhich ends up with the txes stuck now right?, and the user need to manually re-submit them.",
      "created_at": "2023-05-04T13:15:40Z",
      "updated_at": "2023-05-04T13:25:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1185000020",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1185000020"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 234,
      "original_line": 234,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1186241747",
      "pull_request_review_id": 1415028425,
      "id": 1186241747,
      "node_id": "PRRC_kwDOABII585GtJzT",
      "diff_hunk": "@@ -226,20 +226,16 @@ def run_test(self):\n         assert_equal(double_spend[\"walletconflicts\"], [txAB1])\n \n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n+        assert_equal(alice.gettransaction(txAB1)[\"confirmations\"], -1)\n         newbalance = alice.getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))\n         balance = newbalance\n \n-        # There is currently a minor bug around this and so this test doesn't work.  See Issue #7315\n-        # Invalidate the block with the double spend and B's 10 BTC output should no longer be available\n-        # Don't think C's should either\n+        # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available",
      "path": "test/functional/wallet_abandonconflict.py",
      "position": 12,
      "original_position": 12,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "62cdcd02cd3ae5ad766b89abc211a745598bdbaa",
      "in_reply_to_id": 1185000020,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Yes, the user would need to manually re-submit them or wait for the wallet to re-submit them automatically.",
      "created_at": "2023-05-05T15:39:27Z",
      "updated_at": "2023-05-05T15:39:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1186241747",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1186241747"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 234,
      "original_line": 234,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192328933",
      "pull_request_review_id": 1424453210,
      "id": 1192328933,
      "node_id": "PRRC_kwDOABII585HEX7l",
      "diff_hunk": "@@ -226,20 +226,16 @@ def run_test(self):\n         assert_equal(double_spend[\"walletconflicts\"], [txAB1])\n \n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n+        assert_equal(alice.gettransaction(txAB1)[\"confirmations\"], -1)\n         newbalance = alice.getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))\n         balance = newbalance\n \n-        # There is currently a minor bug around this and so this test doesn't work.  See Issue #7315\n-        # Invalidate the block with the double spend and B's 10 BTC output should no longer be available\n-        # Don't think C's should either\n+        # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available",
      "path": "test/functional/wallet_abandonconflict.py",
      "position": 12,
      "original_position": 12,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "62cdcd02cd3ae5ad766b89abc211a745598bdbaa",
      "in_reply_to_id": 1185000020,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "good. Not sure if there is any but would be nice to have coverage for the automatic re-submission. Would just need to mock the node time 24hs in the future and see if they get re-submitted.",
      "created_at": "2023-05-12T12:52:36Z",
      "updated_at": "2023-05-12T12:52:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1192328933",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1192328933"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 234,
      "original_line": 234,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193162426",
      "pull_request_review_id": 1425564449,
      "id": 1193162426,
      "node_id": "PRRC_kwDOABII585HHja6",
      "diff_hunk": "@@ -226,20 +226,16 @@ def run_test(self):\n         assert_equal(double_spend[\"walletconflicts\"], [txAB1])\n \n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n+        assert_equal(alice.gettransaction(txAB1)[\"confirmations\"], -1)\n         newbalance = alice.getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))\n         balance = newbalance\n \n-        # There is currently a minor bug around this and so this test doesn't work.  See Issue #7315\n-        # Invalidate the block with the double spend and B's 10 BTC output should no longer be available\n-        # Don't think C's should either\n+        # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available",
      "path": "test/functional/wallet_abandonconflict.py",
      "position": 12,
      "original_position": 12,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "62cdcd02cd3ae5ad766b89abc211a745598bdbaa",
      "in_reply_to_id": 1185000020,
      "user": {
        "login": "ishaanam",
        "id": 75942586,
        "node_id": "MDQ6VXNlcjc1OTQyNTg2",
        "avatar_url": "https://avatars.githubusercontent.com/u/75942586?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ishaanam",
        "html_url": "https://github.com/ishaanam",
        "followers_url": "https://api.github.com/users/ishaanam/followers",
        "following_url": "https://api.github.com/users/ishaanam/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ishaanam/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ishaanam/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ishaanam/subscriptions",
        "organizations_url": "https://api.github.com/users/ishaanam/orgs",
        "repos_url": "https://api.github.com/users/ishaanam/repos",
        "events_url": "https://api.github.com/users/ishaanam/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ishaanam/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There are some tests for that here: https://github.com/bitcoin/bitcoin/blob/master/test/functional/wallet_resendwallettransactions.py. Or did you mean that a test for that should be added for this PR specifically?",
      "created_at": "2023-05-14T14:59:52Z",
      "updated_at": "2023-05-14T14:59:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1193162426",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1193162426"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 234,
      "original_line": 234,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206163032",
      "pull_request_review_id": 1444878460,
      "id": 1206163032,
      "node_id": "PRRC_kwDOABII585H5JZY",
      "diff_hunk": "@@ -226,20 +226,16 @@ def run_test(self):\n         assert_equal(double_spend[\"walletconflicts\"], [txAB1])\n \n         # Verify that B and C's 10 BTC outputs are available for spending again because AB1 is now conflicted\n+        assert_equal(alice.gettransaction(txAB1)[\"confirmations\"], -1)\n         newbalance = alice.getbalance()\n         assert_equal(newbalance, balance + Decimal(\"20\"))\n         balance = newbalance\n \n-        # There is currently a minor bug around this and so this test doesn't work.  See Issue #7315\n-        # Invalidate the block with the double spend and B's 10 BTC output should no longer be available\n-        # Don't think C's should either\n+        # Invalidate the block with the double spend. B & C's 10 BTC outputs should no longer be available",
      "path": "test/functional/wallet_abandonconflict.py",
      "position": 12,
      "original_position": 12,
      "commit_id": "89df7987c2f1eea42454c2b0efc31a924fbfd3a8",
      "original_commit_id": "62cdcd02cd3ae5ad766b89abc211a745598bdbaa",
      "in_reply_to_id": 1185000020,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "yeah, great if that is already covered.\r\n(sorry for the delayed answer)",
      "created_at": "2023-05-26T02:19:43Z",
      "updated_at": "2023-05-26T02:19:44Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27145#discussion_r1206163032",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1206163032"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27145"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 234,
      "original_line": 234,
      "side": "RIGHT"
    }
  ]
}
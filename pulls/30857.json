{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857",
    "id": 2062194875,
    "node_id": "PR_kwDOABII58566pi7",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30857",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30857.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30857.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/0b3ec8c59b2b6d598531cd4e688eb276e597c825",
    "number": 30857,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "cluster mempool: extend DepGraph functionality",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Part of cluster mempool: #30289 \r\n\r\nThis adds:\r\n* `DepGraph::AddDependencies` to add 0 or more dependencies to a single transaction at once (identical to calling `DepGraph::AddDependency` once for each, but more efficient).\r\n* `DepGraph::RemoveTransactions` to remove 0 or more transactions from a depgraph.\r\n* `DepGraph::GetReducedParents` (and `DepGraph::GetReducedChildren`) to get the (reduced) direct parents and children of a transaction in a depgraph.\r\n\r\nAfter which, the `Cluster` type is removed.\r\n\r\nThis is the result of fleshing out the design for the \"intermediate layer\" (\"TxGraph\", no PR yet) between the cluster linearization layer and the mempool layer. My earlier thinking was that TxGraph would store `Cluster` objects (vectors of pairs of `FeeFrac`s and sets of parents), and convert them to `DepGraph` on the fly whenever needed. However, after more consideration, it seems better to have TxGraph store `DepGraph` objects, and manipulate them directly without constantly re-creating them. This requires `DepGraph` to have some additional functionality.\r\n\r\nThe bulk of the complexity here is the addition of `DepGraph::RemoveTransactions`, which leaves the remaining transactions' positions within the `DepGraph` untouched (we want existing identifiers to remain valid), so this implies that graphs can now have \"holes\" (positions that are unused, but followed by positions that are used). To enable that, an extension of the fuzz/test serialization format `DepGraphFormatter` is included to deal with such holes.\r\n",
    "labels": [
      {
        "id": 241832923,
        "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
        "name": "Utils/log/libs",
        "description": "",
        "color": "5319e7",
        "default": false
      }
    ],
    "created_at": "2024-09-10T00:48:24Z",
    "updated_at": "2024-10-08T15:02:50Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "b92d8837e3e7648ccec0ce7968988dd4bc9efdfc",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      }
    ],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "sipa:202409_clusterlin_partialdep",
      "ref": "202409_clusterlin_partialdep",
      "sha": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 1458655,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
        "name": "bitcoin",
        "full_name": "sipa/bitcoin",
        "owner": {
          "login": "sipa",
          "id": 548488,
          "node_id": "MDQ6VXNlcjU0ODQ4OA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sipa",
          "html_url": "https://github.com/sipa",
          "followers_url": "https://api.github.com/users/sipa/followers",
          "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
          "organizations_url": "https://api.github.com/users/sipa/orgs",
          "repos_url": "https://api.github.com/users/sipa/repos",
          "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sipa/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sipa/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sipa/bitcoin",
        "archive_url": "https://api.github.com/repos/sipa/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sipa/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sipa/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sipa/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
        "svn_url": "https://github.com/sipa/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "TypeScript",
        "forks_count": 21,
        "stargazers_count": 88,
        "watchers_count": 88,
        "size": 249113,
        "default_branch": "lows",
        "open_issues_count": 16,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-10-07T22:41:03Z",
        "created_at": "2011-03-09T10:46:59Z",
        "updated_at": "2024-09-29T14:05:00Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "62e4516722115c2d5aeb6c197abc73ca7c078b23",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36232,
        "stargazers_count": 78733,
        "watchers_count": 78733,
        "size": 269468,
        "default_branch": "master",
        "open_issues_count": 683,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-10-08T15:10:07Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-10-08T15:18:00Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 543,
    "deletions": 280,
    "changed_files": 8,
    "commits": 7,
    "review_comments": 80,
    "comments": 16
  },
  "events": [
    {
      "event": "commented",
      "id": 2339398769,
      "node_id": "IC_kwDOABII586LcGRx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339398769",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T00:48:28Z",
      "updated_at": "2024-10-08T15:02:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30857).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2354684021), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2354786373) |\n| Stale ACK | [sdaftuar](https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2387271117) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30605](https://github.com/bitcoin/bitcoin/pull/30605) (Cluster linearization: separate tests from tests-of-tests by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2339398769",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "renamed",
      "id": 14191046506,
      "node_id": "RTE_lADOABII586V6oyBzwAAAANN2i9q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191046506",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T00:49:35Z",
      "rename": {
        "from": "cluster mempool: extend DepGraph (multiple dependencies, removing transactions, parents/children)",
        "to": "cluster mempool: extend DepGraph functionality"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14191287393,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANN3dxh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191287393",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:32:52Z"
    },
    {
      "event": "labeled",
      "id": 14191290614,
      "node_id": "LE_lADOABII586V6oyBzwAAAANN3ej2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191290614",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:33:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2339436509,
      "node_id": "IC_kwDOABII586LcPfd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339436509",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:33:22Z",
      "updated_at": "2024-09-10T01:33:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/29906098019</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2339436509",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14191334981,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANN3pZF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191334981",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:40:44Z"
    },
    {
      "event": "commented",
      "id": 2340618396,
      "node_id": "IC_kwDOABII586LgwCc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340618396",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:39:36Z",
      "updated_at": "2024-09-10T12:39:36Z",
      "author_association": "MEMBER",
      "body": "https://cirrus-ci.com/task/4580438562308096?logs=ci#L1723\r\n```bash\r\nRun clusterlin_ancestor_finder with args ['/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz', '-runs=1', PosixPath('/ci_container_base/ci/scratch/qa-assets/fuzz_corpora/clusterlin_ancestor_finder')]INFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 2205311796\r\nINFO: Loaded 1 modules   (615399 inline 8-bit counters): 615399 [0x55b1778f3be8, 0x55b177989fcf), \r\nINFO: Loaded 1 PC tables (615399 PCs): 615399 [0x55b177989fd0,0x55b1782ede40), \r\nINFO:       57 files found in /ci_container_base/ci/scratch/qa-assets/fuzz_corpora/clusterlin_ancestor_finder\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes\r\nINFO: seed corpus: files: 57 min: 1b max: 516b total: 4662b rss: 111Mb\r\n/ci_container_base/src/test/util/cluster_linearize.h:242:29: runtime error: unsigned integer overflow: 0 - 1 cannot be represented in type 'ClusterIndex' (aka 'unsigned int')\r\n    #0 0x55b17470e4e4 in void (anonymous namespace)::DepGraphFormatter::Unser<SpanReader, bitset_detail::IntBitSet<unsigned int>>(SpanReader&, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&)::'lambda'(unsigned int)::operator()(unsigned int) const ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/util/cluster_linearize.h:242:29\r\n    #1 0x55b1746e5efa in void (anonymous namespace)::DepGraphFormatter::Unser<SpanReader, bitset_detail::IntBitSet<unsigned int>>(SpanReader&, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/util/cluster_linearize.h:268:17\r\n    #2 0x55b1746e5efa in void Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>::Unserialize<SpanReader>(SpanReader&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/serialize.h:481:73\r\n    #3 0x55b1746e5efa in void Unserialize<SpanReader, Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>&>(T&, T0&&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/serialize.h:761:7\r\n    #4 0x55b1746e5efa in SpanReader& SpanReader::operator>><Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>>(Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>&&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/streams.h:114:9\r\n    #5 0x55b1746eb7c4 in clusterlin_ancestor_finder_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/fuzz/cluster_linearize.cpp:454:16\r\n    #6 0x55b174d1203d in std::function<void (std::span<unsigned char const, 18446744073709551615ul>)>::operator()(std::span<unsigned char const, 18446744073709551615ul>) const /usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\r\n    #7 0x55b174d1203d in LLVMFuzzerTestOneInput ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/util/./src/test/fuzz/fuzz.cpp:209:5\r\n    #8 0x55b1743ee834 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcb834) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #9 0x55b1743edf29 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcaf29) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #10 0x55b1743efb46 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bccb46) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #11 0x55b1743f0057 in fuzzer::Fuzzer::Loop(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcd057) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #12 0x55b1743dd54f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bba54f) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #13 0x55b174407bd6 in main (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1be4bd6) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #14 0x7fe0a47af1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 6d64b17fbac799e68da7ebd9985ddf9b5cb375e6)\r\n    #15 0x7fe0a47af28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 6d64b17fbac799e68da7ebd9985ddf9b5cb375e6)\r\n    #16 0x55b1743d2534 in _start (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1baf534) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: unsigned-integer-overflow /ci_container_base/src/test/util/cluster_linearize.h:242:29 \r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0xa,0x7e,0x7e,0x7e,0x3,0x0,0x7e,0x7e,0x7e,0x0,0x8,0x0,0x3f,\r\n\\012~~~\\003\\000~~~\\000\\010\\000?\r\nartifact_prefix='./'; Test unit written to ./crash-8c0d970971a66a2d84b05f68d2956932fb44a077\r\nBase64: Cn5+fgMAfn5+AAgAPw==\r\n```\r\nThe previous releases failure is unrelated.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2340618396",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14198329681,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANOSVFR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198329681",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:47:57Z"
    },
    {
      "event": "commented",
      "id": 2340661923,
      "node_id": "IC_kwDOABII586Lg6qj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340661923",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:46Z",
      "updated_at": "2024-09-10T15:50:09Z",
      "author_association": "MEMBER",
      "body": "@fanquake Thanks! Fixed, I think.\r\n\r\nEDIT: Narrator: it wasn't.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2340661923",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14198399702,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOSmLW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198399702",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:47Z"
    },
    {
      "event": "subscribed",
      "id": 14198399724,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOSmLs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198399724",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14200682889,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANObTmJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14200682889",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T15:07:21Z"
    },
    {
      "event": "commented",
      "id": 2341427105,
      "node_id": "IC_kwDOABII586Lj1eh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2341427105",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T16:27:36Z",
      "updated_at": "2024-09-10T16:28:01Z",
      "author_association": "MEMBER",
      "body": "I'm going to hold off reviewing this until I see the TxGraph PR(dirty draft ok) to better understand its intended usage. :+1: ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2341427105",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "commented",
      "id": 2341522716,
      "node_id": "IC_kwDOABII586LkM0c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2341522716",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:10Z",
      "updated_at": "2024-09-10T17:23:30Z",
      "author_association": "MEMBER",
      "body": "@instagibbs Sure.\r\n\r\nTo give a bit more background, my idea to store things in `Cluster` form and convert to `DepGraph`, was due to a (mistaken) belief that incremental changes to a `DepGraph` would be $\\mathcal{O}(n)$ per-dependency, meaning $\\mathcal{O}(n^2)$ per-transaction, and thus potentially $\\mathcal{O}(n^3)$ for a full $n$ transactions.\r\n\r\n@sdaftuar pointed out the possibility of an $\\mathcal{O}(n)$ per-transaction algorithm, or $\\mathcal{O}(n^2)$ for $n$ transactions, implemented in this PR as `DepGraph::AddDependencies`. As that's equal in complexity to the current bulk `Cluster`->`DepGraph` conversion, there is little reason left to prefer that bulk conversion algorithm, and leaving things in `DepGraph` form means the same module can be used for more purposes (e.g. computing a transaction's ancestry, as it's literally precomputed already inside `DepGraph`).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2341522716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14202521834,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOiUjq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521834",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:11Z"
    },
    {
      "event": "subscribed",
      "id": 14202521844,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOiUj0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521844",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:11Z"
    },
    {
      "event": "mentioned",
      "id": 14202521857,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOiUkB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521857",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:12Z"
    },
    {
      "event": "subscribed",
      "id": 14202521868,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOiUkM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521868",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:12Z"
    },
    {
      "event": "labeled",
      "id": 14205522396,
      "node_id": "LE_lADOABII586V6oyBzwAAAANOtxHc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14205522396",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T20:49:01Z",
      "label": {
        "name": "Utils/log/libs",
        "color": "5319e7"
      }
    },
    {
      "event": "unlabeled",
      "id": 14219425937,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANPiziR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14219425937",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-11T16:41:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 14277971026,
      "node_id": "LE_lADOABII586V6oyBzwAAAANTCIxS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14277971026",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T18:35:56Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14280914033,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANTNXRx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14280914033",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:43:49Z"
    },
    {
      "event": "commented",
      "id": 2353995596,
      "node_id": "IC_kwDOABII586MTx9M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2353995596",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:44:13Z",
      "updated_at": "2024-09-16T20:44:13Z",
      "author_association": "MEMBER",
      "body": "Rebased after merge of #30286.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2353995596",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "unlabeled",
      "id": 14281082726,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANTOAdm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281082726",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:57:30Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14291019637,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANTz6d1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14291019637",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T13:02:30Z"
    },
    {
      "event": "reviewed",
      "id": 2306885844,
      "node_id": "PRR_kwDOABII586JgEjU",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "First run through.\r\n\r\nsuggestion for clusterlin_add_dependencies harness: https://github.com/instagibbs/bitcoin/commit/c5c44da5a0a630a6725ca85e90e4c67b2eb1f8bc\r\n\r\nI think this gets similar or better coverage and is easier for me to understand? (alternatively, take an extra bit and use that as decision bit to batch or individually add, and have the other depgraph do the opposite?)\r\n\r\nedit: ah, I'm hodling it wrong! Deleted question.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2306885844",
      "submitted_at": "2024-09-17T17:13:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2310464388,
      "node_id": "PRR_kwDOABII586JtuOE",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "it's likely the wrong place for the coverage, but I added some coverage for iterative additional and removal of transactions. Take what you think is useful if any:\r\n\r\n```\r\ndiff --git a/src/test/fuzz/cluster_linearize.cpp b/src/test/fuzz/cluster_linearize.cpp\r\nindex be06898a6e..62b5ec2343 100644\r\n--- a/src/test/fuzz/cluster_linearize.cpp\r\n+++ b/src/test/fuzz/cluster_linearize.cpp\r\n@@ -1,19 +1,20 @@\r\n // Copyright (c) The Bitcoin Core developers\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n #include <cluster_linearize.h>\r\n #include <serialize.h>\r\n #include <streams.h>\r\n #include <test/fuzz/fuzz.h>\r\n #include <test/fuzz/FuzzedDataProvider.h>\r\n+#include <test/fuzz/util.h>\r\n #include <test/util/cluster_linearize.h>\r\n #include <util/bitset.h>\r\n #include <util/feefrac.h>\r\n \r\n #include <algorithm>\r\n #include <stdint.h>\r\n #include <vector>\r\n #include <utility>\r\n \r\n using namespace cluster_linearize;\r\n@@ -308,30 +309,89 @@ FUZZ_TARGET(clusterlin_cluster_serialization)\r\n             if (i == j) continue;\r\n             if (provider.ConsumeBool()) cluster[i].second.Set(j);\r\n         }\r\n     }\r\n \r\n     // Construct dependency graph, and verify it matches the cluster (which includes a round-trip\r\n     // check for the serialization).\r\n     DepGraph depgraph(cluster);\r\n     VerifyDepGraphFromCluster(cluster, depgraph);\r\n \r\n+    // Copy to store deleted information\r\n+    DepGraph depgraph_copy(depgraph);\r\n+\r\n     // Remove an arbitrary subset (in order to construct a graph with holes) and verify that it\r\n     // still sanity checks (incl. round-tripping serialization).\r\n     uint64_t del = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);\r\n     TestBitSet setdel;\r\n     for (ClusterIndex i : depgraph.Positions()) {\r\n         if (del & 1) setdel.Set(i);\r\n         del >>= 1;\r\n     }\r\n+    assert(del == 0);\r\n+\r\n     depgraph.RemoveTransactions(setdel);\r\n     SanityCheck(depgraph);\r\n+\r\n+    FastRandomContext rng{ConsumeUInt256(provider)};\r\n+\r\n+    // Arbitary addition or removal order for transactions we're deleting\r\n+    std::vector<ClusterIndex> del_indexes;\r\n+    for (const auto del_index : setdel) {\r\n+        del_indexes.push_back(del_index);\r\n+    }\r\n+\r\n+    // Tracks deletion index vs re-addition index for dependency re-addition\r\n+    std::map<ClusterIndex, ClusterIndex> map_del_add_index;\r\n+\r\n+    // Re-add everything back in; should not fail sanity checks\r\n+    // But this will have transactions \"out of order\" and missing\r\n+    // connections from children to previously deleted ancestors.\r\n+    std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+    for (ClusterIndex del_index : del_indexes) {\r\n+        const auto add_index{depgraph.AddTransaction(depgraph_copy.FeeRate(del_index))};\r\n+        map_del_add_index[del_index] = add_index;\r\n+    }\r\n+\r\n+    std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+    for (ClusterIndex del_index : del_indexes) {\r\n+       depgraph.AddDependencies(depgraph_copy.Ancestors(del_index), map_del_add_index[del_index]);\r\n+    }\r\n+\r\n+    SanityCheck(depgraph);\r\n+\r\n+    // But if we repeat this N times, we should get identical depgraphs\r\n+    for (int i = 0; i < provider.ConsumeIntegralInRange<int>(1, 5); ++i) {\r\n+        depgraph_copy = depgraph;\r\n+        // Batch removal or shuffled iterated removal\r\n+        if (provider.ConsumeBool()) {\r\n+            depgraph.RemoveTransactions(setdel);\r\n+        } else {\r\n+            std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+            for (const auto del_index : del_indexes) {\r\n+                depgraph.RemoveTransactions(TestBitSet::Singleton(del_index));\r\n+            }\r\n+        }\r\n+        SanityCheck(depgraph);\r\n+\r\n+        std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+        map_del_add_index.clear();\r\n+        for (ClusterIndex del_index : setdel) {\r\n+            const auto add_index{depgraph.AddTransaction(depgraph_copy.FeeRate(del_index))};\r\n+            map_del_add_index[del_index] = add_index;\r\n+        }\r\n+        std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+        for (ClusterIndex del_index : setdel) {\r\n+            depgraph.AddDependencies(depgraph_copy.Ancestors(del_index), map_del_add_index[del_index]);\r\n+        }\r\n+        assert(depgraph == depgraph_copy);\r\n+    }\r\n }\r\n \r\n FUZZ_TARGET(clusterlin_depgraph_serialization)\r\n {\r\n     // Verify that any deserialized depgraph is acyclic and roundtrips to an identical depgraph.\r\n \r\n     // Construct a graph by deserializing.\r\n     SpanReader reader(buffer);\r\n     DepGraph<TestBitSet> depgraph;\r\n     try {\r\n```",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2310464388",
      "submitted_at": "2024-09-17T18:46:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2311366400,
      "node_id": "PRR_kwDOABII586JxKcA",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2311366400",
      "submitted_at": "2024-09-17T23:57:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "commented",
      "id": 2357254842,
      "node_id": "IC_kwDOABII586MgNq6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2357254842",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:02Z",
      "updated_at": "2024-09-18T00:32:02Z",
      "author_association": "MEMBER",
      "body": "@glozow It's already used in two places in this PR.\n\nMaybe I should clarify in the PR description that this is just a generic utility feature, not something the next layer up will need per se (AFAIK). But because I was introducing a second place where it's invoked, and it's already used somewhere in the test, I felt it made sense to turn it into a proper DepGraph function, with proper tests.\n\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2357254842",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14299735359,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANUVKU_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14299735359",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:03Z"
    },
    {
      "event": "subscribed",
      "id": 14299735363,
      "node_id": "SE_lADOABII586V6oyBzwAAAANUVKVD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14299735363",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:03Z"
    },
    {
      "event": "commented",
      "id": 2357265641,
      "node_id": "IC_kwDOABII586MgQTp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2357265641",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:44:37Z",
      "updated_at": "2024-09-18T00:44:37Z",
      "author_association": "MEMBER",
      "body": "Sorry, I don't know how I missed the calls within this PR :facepalm: I think I was grepping only on the first commit.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2357265641",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14311464205,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVB50N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14311464205",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T17:44:27Z"
    },
    {
      "event": "reviewed",
      "id": 2313371167,
      "node_id": "PRR_kwDOABII586J4z4f",
      "url": null,
      "actor": null,
      "commit_id": "4476915bc76b48eff9b5e67fd6bd7647cc12793f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I addressed most of the feedback received. Thanks @instagibbs and @glozow!\r\n\r\nIn addition, the `DepGraphFormatter::Unser` logic was changed significantly. The result is simpler to follow I think (doesn't involve adding a transaction once and then undoing the insertion and redoing it once the position is known), and reduces the complexity from $\\mathcal{O}(n^3)$ to $\\mathcal{O}(n^2)$ in the process. For this, the commits were reordered, and their commit messages expanded to explain the rationale.\r\n\r\n@instagibbs I have added your testing of re-adding in `clusterlin_cluster_serialization` as a separate commit with some minor changes (mostly to keep the result efficient).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313371167",
      "submitted_at": "2024-09-18T17:58:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "commented",
      "id": 2359202120,
      "node_id": "IC_kwDOABII586MnpFI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2359202120",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T19:01:42Z",
      "updated_at": "2024-09-18T19:01:42Z",
      "author_association": "MEMBER",
      "body": "looked at `git range-diff master 9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d 4476915bc76b48eff9b5e67fd6bd7647cc12793f`\r\n\r\nLGTM, though I haven't re-validated the serializer, trusting the tests of tests. I want to think more about the fuzz targets to see if there are any other easy pickups in coverage.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2359202120",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "reviewed",
      "id": 2313550404,
      "node_id": "PRR_kwDOABII586J5fpE",
      "url": null,
      "actor": null,
      "commit_id": "4476915bc76b48eff9b5e67fd6bd7647cc12793f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313550404",
      "submitted_at": "2024-09-18T20:23:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14314481748,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVNahU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14314481748",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T22:07:20Z"
    },
    {
      "event": "reviewed",
      "id": 2313906901,
      "node_id": "PRR_kwDOABII586J62rV",
      "url": null,
      "actor": null,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "~~@instagibbs I noticed that your extending of clusterlin_cluster_serialization makes the fuzz test 10x slower (when sanitizers are enabled), and I don't understand why.~~\r\n\r\nEDIT: wiped, re-cmaked, recompiled, and the slowdown is gone.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313906901",
      "submitted_at": "2024-09-18T22:13:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "labeled",
      "id": 14315385018,
      "node_id": "LE_lADOABII586V6oyBzwAAAANVQ3C6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14315385018",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T23:32:06Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14315502264,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVRTq4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14315502264",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T23:55:14Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14315517337,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVRXWZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14315517337",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T23:58:13Z"
    },
    {
      "event": "unlabeled",
      "id": 14317007964,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANVXDRc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14317007964",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-19T02:54:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2315608829,
      "node_id": "PRR_kwDOABII586KBWL9",
      "url": null,
      "actor": null,
      "commit_id": "aab53ddcd8fcbc3c0be0da9383f8e06abe5badda",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "ACK aab53ddcd8fcbc3c0be0da9383f8e06abe5badda\r\n\r\nreviewed via `git range-diff master 4476915bc76b48eff9b5e67fd6bd7647cc12793f aab53ddcd8fcbc3c0be0da9383f8e06abe5badda`\r\n\r\nFuzz coverage seems good now, with additional documentation/asserts where requested. I didn't dive deep into the new un-serializer logic.\r\n\r\nDid you figure out the slowdown? I didn't reproduce locally. ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2315608829",
      "submitted_at": "2024-09-19T13:46:27Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2317959224,
      "node_id": "PRR_kwDOABII586KKUA4",
      "url": null,
      "actor": null,
      "commit_id": "aab53ddcd8fcbc3c0be0da9383f8e06abe5badda",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Read through the code and it makes sense to me, but haven't tested much. It would be nice to have a fuzz coverage report? @dergoegge ",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2317959224",
      "submitted_at": "2024-09-20T21:12:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14346731112,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANXIb5o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14346731112",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-20T23:29:49Z"
    },
    {
      "event": "commented",
      "id": 2364749507,
      "node_id": "IC_kwDOABII586M8zbD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2364749507",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-20T23:30:56Z",
      "updated_at": "2024-09-20T23:30:56Z",
      "author_association": "MEMBER",
      "body": "@instagibbs I deleted by build directory, redid the `cmake` generation, recompiled, and the slowdown was gone. Weird.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2364749507",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14346735017,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANXIc2p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14346735017",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-20T23:30:57Z"
    },
    {
      "event": "subscribed",
      "id": 14346735020,
      "node_id": "SE_lADOABII586V6oyBzwAAAANXIc2s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14346735020",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-20T23:30:57Z"
    },
    {
      "event": "commented",
      "id": 2368093192,
      "node_id": "IC_kwDOABII586NJjwI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2368093192",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T12:37:37Z",
      "updated_at": "2024-09-23T15:57:43Z",
      "author_association": "MEMBER",
      "body": "@glozow @instagibbs It occurs to me that with the change in this PR, the `Cluster` will really only be used in tests anymore, as `DepGraph` objects can and will be built incrementally using `AddTransaction`, `AddDependencies`, and `RemoveTransactions`.\r\n\r\nBecause of that, I think it would be simpler to get rid of `Cluster` entirely, and reformulate the tests to all operate on `DepGraph` directly. ~~I can do this in this PR, or as a follow-up. What do you think?~~\r\n\r\nEDIT: went ahead and did that.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2368093192",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14363061303,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANYGuw3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14363061303",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T12:37:39Z"
    },
    {
      "event": "subscribed",
      "id": 14363061318,
      "node_id": "SE_lADOABII586V6oyBzwAAAANYGuxG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14363061318",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T12:37:39Z"
    },
    {
      "event": "mentioned",
      "id": 14363061331,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANYGuxT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14363061331",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T12:37:40Z"
    },
    {
      "event": "subscribed",
      "id": 14363061340,
      "node_id": "SE_lADOABII586V6oyBzwAAAANYGuxc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14363061340",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T12:37:40Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14366757224,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANYU1Fo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14366757224",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T15:57:11Z"
    },
    {
      "event": "commented",
      "id": 2368720193,
      "node_id": "IC_kwDOABII586NL81B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2368720193",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T15:58:51Z",
      "updated_at": "2024-09-23T15:58:51Z",
      "author_association": "MEMBER",
      "body": "I have replaced the `clusterlin_add_dependency` and `clusterlin_cluster_serialization` tests with a new `clusterlin_depgraph_sim` test that performs an arbitrary sequence of `AddTransaction`, `AddDependencies`, and `RemoveTransactions` calls, and compares the final result with a simulated version. With that, `Cluster` was easy to delete.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2368720193",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "reviewed",
      "id": 2338044262,
      "node_id": "PRR_kwDOABII586LW7lm",
      "url": null,
      "actor": null,
      "commit_id": "7051fcdda6fdc95677a34d5c14321d7580eceed8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "reACK 7051fcdda6fdc95677a34d5c14321d7580eceed8\r\n\r\nvia `git range-diff master aab53ddcd8fcbc3c0be0da9383f8e06abe5badda 7051fcdda6fdc95677a34d5c14321d7580eceed8`\r\n\r\nNew fuzzer harness is a nice generalization of what existed prior.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2338044262",
      "submitted_at": "2024-09-30T16:52:38Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14462608820,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANeCeW0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14462608820",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-30T21:36:46Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14462625966,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANeCiiu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14462625966",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-30T21:38:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14462884168,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANeDhlI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14462884168",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-30T22:00:26Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14462961488,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANeD0dQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14462961488",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-30T22:09:33Z"
    },
    {
      "event": "commented",
      "id": 2384295168,
      "node_id": "IC_kwDOABII586OHXUA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2384295168",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-30T22:33:48Z",
      "updated_at": "2024-09-30T22:33:48Z",
      "author_association": "MEMBER",
      "body": "Sorry for the repeated force pushes; I made a change in the wrong commit, and then made some minor improvements to the new fuzz too.\r\n\r\nAbsent non-nitty review that needs addressing, I don't intend to make change here anymore.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2384295168",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "commented",
      "id": 2384565646,
      "node_id": "IC_kwDOABII586OIZWO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2384565646",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-01T00:48:01Z",
      "updated_at": "2024-10-01T00:48:01Z",
      "author_association": "MEMBER",
      "body": "reACK 2b21aebd9754c503bac12d1dbf566b3aa27451e8\r\n\r\nvia `git range-diff master 7051fcdda6fdc95677a34d5c14321d7580eceed8 2b21aebd9754c503bac12d1dbf566b3aa27451e8`",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2384565646",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "reviewed",
      "id": 2319841829,
      "node_id": "PRR_kwDOABII586KRfol",
      "url": null,
      "actor": null,
      "commit_id": "2b21aebd9754c503bac12d1dbf566b3aa27451e8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Code review ACK, just some nits.",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2319841829",
      "submitted_at": "2024-10-01T18:17:52Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "commented",
      "id": 2387271117,
      "node_id": "IC_kwDOABII586OSt3N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2387271117",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-01T23:42:31Z",
      "updated_at": "2024-10-01T23:42:31Z",
      "author_association": "MEMBER",
      "body": "ACK 2b21aebd9754c503bac12d1dbf566b3aa27451e8\r\n",
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2387271117",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "reviewed",
      "id": 2348460911,
      "node_id": "PRR_kwDOABII586L-qtv",
      "url": null,
      "actor": null,
      "commit_id": "2b21aebd9754c503bac12d1dbf566b3aa27451e8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Concept ACK \r\n",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2348460911",
      "submitted_at": "2024-10-04T16:26:50Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2351684992,
      "node_id": "PRR_kwDOABII586MK92A",
      "url": null,
      "actor": null,
      "commit_id": "2b21aebd9754c503bac12d1dbf566b3aa27451e8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "first pass light code review ACK 2b21aebd9754c503bac12d1dbf566b3aa27451e8\r\n\r\nMostly trying to understand what the code is doing!\r\n\r\n\r\ncomments are just nits",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2351684992",
      "submitted_at": "2024-10-07T15:33:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2352323652,
      "node_id": "PRR_kwDOABII586MNZxE",
      "url": null,
      "actor": null,
      "commit_id": "2b21aebd9754c503bac12d1dbf566b3aa27451e8",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2352323652",
      "submitted_at": "2024-10-07T15:40:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU5MDFjZjcxMDBhNzVjODEzMTIyM2UyM2I2YzkwZTBlOTM2MTFlYWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5901cf7100a75c8131223e23b6c90e0e93611eae",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5901cf7100a75c8131223e23b6c90e0e93611eae",
      "tree": {
        "sha": "a5ff0519580e344e924d060848e41361c0ce321a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a5ff0519580e344e924d060848e41361c0ce321a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/62e4516722115c2d5aeb6c197abc73ca7c078b23",
          "sha": "62e4516722115c2d5aeb6c197abc73ca7c078b23",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/62e4516722115c2d5aeb6c197abc73ca7c078b23"
        }
      ],
      "message": "clusterlin: abstract out DepGraph::GetReduced{Parents,Children}\n\nA fuzz test already relies on these operations, and a future commit will need\nthe same logic too. Therefore, abstract them out into proper member functions,\nwith proper testing.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:46:48Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-06T19:32:48Z"
      },
      "sha": "5901cf7100a75c8131223e23b6c90e0e93611eae"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVhYWI1NWZmYzgxMDIxNDAwODYyOTc4Nzc3NDdiN2ZhMDdiNDE5ZWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eaab55ffc8102140086297877747b7fa07b419eb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/eaab55ffc8102140086297877747b7fa07b419eb",
      "tree": {
        "sha": "5776864bef46f3459ed15bd919071be89b266f85",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5776864bef46f3459ed15bd919071be89b266f85"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5901cf7100a75c8131223e23b6c90e0e93611eae",
          "sha": "5901cf7100a75c8131223e23b6c90e0e93611eae",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5901cf7100a75c8131223e23b6c90e0e93611eae"
        }
      ],
      "message": "clusterlin: rework DepGraphFormatter::Unser\n\nThis commit does not change the serialization format. Its purpose is making a\nfew changes already in order to reduce the diff size of the later commit that\nintroduces support for holes in DepGraph.\n\nThe previous approach was to immediately construct a transaction as soon as its\nfeerate was known in a preliminary position, and then undo that, and place it\nin the correct position once the position information is known (such that a\ndeserialization error in between would not result in an inconsistent state).\n\nThe new approach is to delay the actual transaction creation until all its\ninformation is known, avoiding the need to undo and redo. This requires a\ndifferent means of determining whether dependencies are redundant, but that has\nthe advantage that a later commit can apply all dependencies at once, reducing\nthe complexity of deserialization.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:47:52Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-09T18:51:08Z"
      },
      "sha": "eaab55ffc8102140086297877747b7fa07b419eb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFiZjUwNjQ5ZDEzMDE4YmY0MGM1ODAzNzMwYTAzMDUzNzM3ZWZlZWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/abf50649d13018bf40c5803730a03053737efeee",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/abf50649d13018bf40c5803730a03053737efeee",
      "tree": {
        "sha": "4a2d0c96633145b0b259479362f2b457f32f73fd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4a2d0c96633145b0b259479362f2b457f32f73fd"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eaab55ffc8102140086297877747b7fa07b419eb",
          "sha": "eaab55ffc8102140086297877747b7fa07b419eb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/eaab55ffc8102140086297877747b7fa07b419eb"
        }
      ],
      "message": "clusterlin: simplify DepGraphFormatter::Ser\n\nThis does not change the serialization format.\n\nIt turns out that it is unnecessary to keep track of the order of transactions\nin the so-far reconstructed DepGraph to decide how far from the end to insert\na new transaction.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:47:52Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-08T21:42:25Z"
      },
      "sha": "abf50649d13018bf40c5803730a03053737efeee"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDc1YjVkNDI0MTllZDEyODZmYzk1NTdiYzk3ZWM1YmFjM2Y5YmU4Mzc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75b5d42419ed1286fc9557bc97ec5bac3f9be837",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/75b5d42419ed1286fc9557bc97ec5bac3f9be837",
      "tree": {
        "sha": "1a64393e1d0e7b31f29237b1cbfa44d41e52a50b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1a64393e1d0e7b31f29237b1cbfa44d41e52a50b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/abf50649d13018bf40c5803730a03053737efeee",
          "sha": "abf50649d13018bf40c5803730a03053737efeee",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/abf50649d13018bf40c5803730a03053737efeee"
        }
      ],
      "message": "clusterlin: make DepGraph::AddDependency support multiple dependencies at once\n\nThis changes DepGraph::AddDependency into DepGraph::AddDependencies, which takes\nin a single child, but a set of parent transactions, making them all dependencies\nat once.\n\nThis is important for performance. N transactions can have O(N^2) parents combined,\nso constructing a full DepGraph using just AddDependency (which is O(N) on its own)\ncould take O(N^3) time, while doing the same with AddDependencies (also O(N) on its\nown) only takes O(N^2).\n\nNotably, this matters for DepGraphFormatter::Unser, which goes from O(N^3) to O(N^2).\n\nCo-Authored-By: Greg Sanders <gsanders87@gmail.com>",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:47:52Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-04T19:14:54Z"
      },
      "sha": "75b5d42419ed1286fc9557bc97ec5bac3f9be837"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA2MDZlNjZmZGJiOTE0Zjk4NDQzM2Q4OTUwZjBjMzJiNWZiODcxZjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0606e66fdbb914f984433d8950f0c32b5fb871f3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0606e66fdbb914f984433d8950f0c32b5fb871f3",
      "tree": {
        "sha": "a738719ef0e0b5be7211cd2018abb95e59b9a259",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a738719ef0e0b5be7211cd2018abb95e59b9a259"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75b5d42419ed1286fc9557bc97ec5bac3f9be837",
          "sha": "75b5d42419ed1286fc9557bc97ec5bac3f9be837",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/75b5d42419ed1286fc9557bc97ec5bac3f9be837"
        }
      ],
      "message": "clusterlin: add DepGraph::RemoveTransactions and support for holes in DepGraph\n\nThis commits introduces support in DepGraph for the transaction positions to be\nnon-continuous. Specifically, it adds:\n* DepGraph::RemoveTransactions which removes 0 or more positions from a DepGraph.\n* DepGraph::Positions() to get a set of which positions are in use.\n* DepGraph::PositionRange() to get the highest used position in a DepGraph + 1.\n\nIn addition, it extends the DepGraphFormatter format to support holes in a\ncompatible way (it serializes non-holey DepGraphs identically to the old code,\nand deserializes them the same way)",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:49:35Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-09T19:12:15Z"
      },
      "sha": "0606e66fdbb914f984433d8950f0c32b5fb871f3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFjMjRjNjI1MTA1Y2Q2MjUxOGQyZWVlN2U5NWMzYjFjNzRlYTk5MjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1c24c625105cd62518d2eee7e95c3b1c74ea9923",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1c24c625105cd62518d2eee7e95c3b1c74ea9923",
      "tree": {
        "sha": "818bcb8ee74dc0265726ff487aa4ade65bf4775d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/818bcb8ee74dc0265726ff487aa4ade65bf4775d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0606e66fdbb914f984433d8950f0c32b5fb871f3",
          "sha": "0606e66fdbb914f984433d8950f0c32b5fb871f3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0606e66fdbb914f984433d8950f0c32b5fb871f3"
        }
      ],
      "message": "clusterlin: merge two DepGraph fuzz tests into simulation test\n\nThis combines the clusterlin_add_dependency and clusterlin_cluster_serialization\nfuzz tests into a single clusterlin_depgraph_sim fuzz test. This tests starts\nfrom an empty DepGraph and performs a arbitrary number of AddTransaction,\nAddDependencies, and RemoveTransactions operations on it, and compares the\nresulting state with a naive reimplementation.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:49:36Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-23T14:02:59Z"
      },
      "sha": "1c24c625105cd62518d2eee7e95c3b1c74ea9923"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBiM2VjOGM1OWIyYjZkNTk4NTMxY2Q0ZTY4OGViMjc2ZTU5N2M4MjU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "tree": {
        "sha": "5f60dfc52ecbac44534aa2e84ccc7b370e112660",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5f60dfc52ecbac44534aa2e84ccc7b370e112660"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1c24c625105cd62518d2eee7e95c3b1c74ea9923",
          "sha": "1c24c625105cd62518d2eee7e95c3b1c74ea9923",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1c24c625105cd62518d2eee7e95c3b1c74ea9923"
        }
      ],
      "message": "clusterlin: remove Cluster type",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-10-07T17:49:36Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-23T15:32:58Z"
      },
      "sha": "0b3ec8c59b2b6d598531cd4e688eb276e597c825"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14544652792,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANi7cn4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14544652792",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T17:50:16Z"
    },
    {
      "event": "labeled",
      "id": 14545522519,
      "node_id": "LE_lADOABII586V6oyBzwAAAANi-w9X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14545522519",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T19:05:53Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 14545554236,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANi-4s8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14545554236",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T19:08:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2354684021,
      "node_id": "PRR_kwDOABII586MWaB1",
      "url": null,
      "actor": null,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "reACK 0b3ec8c59b2b6d598531cd4e688eb276e597c825\r\n\r\nvia `git range-diff master 2b21aebd9754c503bac12d1dbf566b3aa27451e8 0b3ec8c59b2b6d598531cd4e688eb276e597c825`",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2354684021",
      "submitted_at": "2024-10-08T14:27:32Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "review_requested",
      "id": 14557951101,
      "node_id": "RRE_lADOABII586V6oyBzwAAAANjuLR9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14557951101",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-08T14:27:36Z",
      "requested_reviewer": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "review_requested",
      "id": 14557951298,
      "node_id": "RRE_lADOABII586V6oyBzwAAAANjuLVC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14557951298",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-08T14:27:37Z",
      "requested_reviewer": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      }
    },
    {
      "event": "reviewed",
      "id": 2354786373,
      "node_id": "PRR_kwDOABII586MWzBF",
      "url": null,
      "actor": null,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "reACK 0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2354786373",
      "submitted_at": "2024-10-08T15:02:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761301820",
      "pull_request_review_id": 2306885844,
      "id": 1761301820,
      "node_id": "PRRC_kwDOABII585o-1U8",
      "diff_hunk": "@@ -184,6 +184,46 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.",
      "path": "src/cluster_linearize.h",
      "position": 246,
      "original_position": 4,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "commit 77e07eba11391868f83db22bf2280e02b5a8cd78  \r\n\r\nadd a motivation for these additions in commit message?",
      "created_at": "2024-09-16T14:43:46Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761301820",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761301820"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 200,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348362",
      "pull_request_review_id": 2306885844,
      "id": 1761348362,
      "node_id": "PRRC_kwDOABII585o_AsK",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));\n+        }\n+        // Similar for children and descendants.\n+        for (auto child : children) {\n+            assert((depgraph.Descendants(child) & children).IsSubsetOf(SetType::Singleton(child)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 264,
      "original_position": 15,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "?\r\n```Suggestion\r\n            assert((depgraph.Descendants(child) & children) == SetType::Singleton(child));\r\n```",
      "created_at": "2024-09-16T15:10:08Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761348362",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348362"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 337,
      "original_line": 337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348880",
      "pull_request_review_id": 2306885844,
      "id": 1761348880,
      "node_id": "PRRC_kwDOABII585o_A0Q",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 260,
      "original_position": 11,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "?\r\n```Suggestion\r\n            assert((depgraph.Ancestors(parent) & parents) == SetType::Singleton(parent));\r\n```",
      "created_at": "2024-09-16T15:10:27Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761348880",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348880"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761389984",
      "pull_request_review_id": 2306885844,
      "id": 1761389984,
      "node_id": "PRRC_kwDOABII585o_K2g",
      "diff_hunk": "@@ -86,57 +86,30 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=cluster.size().\n      */\n-    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : entries(cluster.size())\n+    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : DepGraph(cluster.size())\n     {\n         for (ClusterIndex i = 0; i < cluster.size(); ++i) {\n             // Fill in fee and size.\n             entries[i].feerate = cluster[i].first;\n-            // Fill in direct parents as ancestors.\n-            entries[i].ancestors = cluster[i].second;\n-            // Make sure transactions are ancestors of themselves.\n-            entries[i].ancestors.Set(i);\n-        }\n-\n-        // Propagate ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            // At this point, entries[a].ancestors[b] is true iff b is an ancestor of a and there\n-            // is a path from a to b through the subgraph consisting of {a, b} union\n-            // {0, 1, ..., (i-1)}.\n-            SetType to_merge = entries[i].ancestors;\n-            for (ClusterIndex j = 0; j < entries.size(); ++j) {\n-                if (entries[j].ancestors[i]) {\n-                    entries[j].ancestors |= to_merge;\n-                }\n-            }\n-        }\n-\n-        // Fill in descendant information by transposing the ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            for (auto j : entries[i].ancestors) {\n-                entries[j].descendants.Set(i);\n-            }\n+            // Fill in dependencies.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 34,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit\r\n```Suggestion\r\n            // Fill in dependencies using direct parents.\r\n```",
      "created_at": "2024-09-16T15:35:42Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761389984",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761389984"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 106,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761406415",
      "pull_request_review_id": 2306885844,
      "id": 1761406415,
      "node_id": "PRRC_kwDOABII585o_O3P",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 81,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit\r\n```Suggestion\r\n        // Compute the ancestors of parents that are not already ancestors of child.\r\n```",
      "created_at": "2024-09-16T15:44:07Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761406415",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761406415"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761452737",
      "pull_request_review_id": 2306885844,
      "id": 1761452737,
      "node_id": "PRRC_kwDOABII585o_aLB",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 217,
      "original_position": 79,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "could use this in AddDependency as a one-liner?\r\n```\r\nAddDependencies(SetType::Singleton(parent), child);\r\n```",
      "created_at": "2024-09-16T16:15:53Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761452737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761452737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 177,
      "original_line": 177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761525176",
      "pull_request_review_id": 2306885844,
      "id": 1761525176,
      "node_id": "PRRC_kwDOABII585o_r24",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.\n+            // Emit N to indicate that many insertion choices are skipped.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 25,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "dde3959a24a12cd7ab37e772b55ae3c60a646528",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "dde3959a24a12cd7ab37e772b55ae3c60a646528\r\n\r\nno behavior change? would be good to say in commit message explicitly",
      "created_at": "2024-09-16T17:03:51Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761525176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761525176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761630898",
      "pull_request_review_id": 2306885844,
      "id": 1761630898,
      "node_id": "PRRC_kwDOABII585pAFqy",
      "diff_hunk": "@@ -57,9 +57,20 @@ class DepGraph\n     /** Data for each transaction, in the same order as the Cluster it was constructed from. */\n     std::vector<Entry> entries;\n \n+    /** Which positions are used. */",
      "path": "src/cluster_linearize.h",
      "position": 23,
      "original_position": 4,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in commit message for 7510a65127db610df4be9cdd95eaef0c23b3e2ff\r\n\r\n\"This commits starts introducing support\" are we expecting more support later?",
      "created_at": "2024-09-16T18:12:43Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761630898",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761630898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761650849",
      "pull_request_review_id": 2306885844,
      "id": 1761650849,
      "node_id": "PRRC_kwDOABII585pAKih",
      "diff_hunk": "@@ -18,6 +18,10 @@ using namespace cluster_linearize;\n \n namespace {\n \n+/** Special magic value that indicates to TestDepGraphSerialization that a cluster entry represents\n+ *  a hole. */\n+constexpr std::pair<FeeFrac, TestBitSet> HOLE{FeeFrac{1901858123504646, 3635904}, {}};",
      "path": "src/test/cluster_linearize_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "humor me: why these values? Values outside what the de-serializer is otherwise allowed to make?",
      "created_at": "2024-09-16T18:26:07Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761650849",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761650849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761676550",
      "pull_request_review_id": 2306885844,
      "id": 1761676550,
      "node_id": "PRRC_kwDOABII585pAQ0G",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't see where these are being deleted? The only removal below is removing things that aren't in `Positions()`, which the newly added transactions should be? Likely misreading this.",
      "created_at": "2024-09-16T18:44:13Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761676550",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761676550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763548308",
      "pull_request_review_id": 2306885844,
      "id": 1763548308,
      "node_id": "PRRC_kwDOABII585pHZyU",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 189,
      "original_position": 102,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ergonomically speaking, I expect this to be used to remove a set of \"direct conflicts\" and all descendants of that set, so this wouldn't cause invalid views of the underlying cluster's graph relationships. \r\n\r\nIs this correct?",
      "created_at": "2024-09-17T16:32:22Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763548308",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763548308"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763550167",
      "pull_request_review_id": 2306885844,
      "id": 1763550167,
      "node_id": "PRRC_kwDOABII585pHaPX",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;\n+        // Remove now-unused trailing entries.\n+        while (!entries.empty() && !m_used[entries.size() - 1]) {\n+            entries.pop_back();\n+        }\n+        // Remove the deleted transactions from ancestors/descendants of other transactions.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 115,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "do we want to leave a note that now-unused entries not at the end can be non-empty/dirty? If that's not possible, a comment explaining that would be helpful too.",
      "created_at": "2024-09-17T16:33:44Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763550167",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763550167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763551402",
      "pull_request_review_id": 2306885844,
      "id": 1763551402,
      "node_id": "PRRC_kwDOABII585pHaiq",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 199,
      "original_position": 110,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do we want to `Assume` that `del` is in `m_used`?",
      "created_at": "2024-09-17T16:34:44Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763551402",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763551402"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763665495",
      "pull_request_review_id": 2310464388,
      "id": 1763665495,
      "node_id": "PRRC_kwDOABII585pH2ZX",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {",
      "path": "src/cluster_linearize.h",
      "position": 218,
      "original_position": 80,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "f484f5a8721b06d4f9fda69968d94046c6bc12d7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Was reconstructing graphs incorrectly leading to inconsistent sets. Better to fail here early.\r\n\r\n```Suggestion\r\n    {\r\n         // We can't add relationships to holes\r\n        Assume(parents.IsSubsetOf(m_used));\r\n```\r\na check like this for `AddDependency` would also be good:\r\n\r\n`Assume(SetType::Singleton(parent).IsSubsetOf(m_used));`",
      "created_at": "2024-09-17T18:03:21Z",
      "updated_at": "2024-09-17T18:46:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763665495",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763665495"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764225430",
      "pull_request_review_id": 2311366400,
      "id": 1764225430,
      "node_id": "PRRC_kwDOABII585pJ_GW",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 254,
      "original_position": 211,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is the hope to be able to reconstruct direct parents of a transaction from the txgraph? Even if a direct parent is also an indirect ancestor?",
      "created_at": "2024-09-17T23:57:45Z",
      "updated_at": "2024-09-17T23:57:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764225430",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764225430"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 208,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764229116",
      "pull_request_review_id": 2311371515,
      "id": 1764229116,
      "node_id": "PRRC_kwDOABII585pJ__8",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 254,
      "original_position": 211,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, that's impossible (A->B->C is indistinguishable from (A->B->C,A->C)); the goal is just computing a minimal set of dependencies whose corresponding ancestry matches the DepGraph (and this will necessarily be a subset of the real direct parents).",
      "created_at": "2024-09-18T00:05:24Z",
      "updated_at": "2024-09-18T00:07:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764229116",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764229116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 208,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764240141",
      "pull_request_review_id": 2311387945,
      "id": 1764240141,
      "node_id": "PRRC_kwDOABII585pKCsN",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 254,
      "original_position": 211,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "thought so... how is it intended to be used?",
      "created_at": "2024-09-18T00:28:30Z",
      "updated_at": "2024-09-18T00:28:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764240141",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764240141"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 208,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765436227",
      "pull_request_review_id": 2313318636,
      "id": 1765436227,
      "node_id": "PRRC_kwDOABII585pOmtD",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 189,
      "original_position": 102,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In practice, this will be used to either remove a set of conflicts (together with all their descendants), or to remove a set of mined transactions (together with all their ancestors). In both cases, no transactions will remain which are both ancestors of some deleted transactions and descendants of other deleted transactions.",
      "created_at": "2024-09-18T17:18:27Z",
      "updated_at": "2024-09-18T17:18:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765436227",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765436227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765437954",
      "pull_request_review_id": 2313321433,
      "id": 1765437954,
      "node_id": "PRRC_kwDOABII585pOnIC",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 189,
      "original_position": 102,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ah, right! I hadn't considered the mining side. Maybe leave something to that effect?",
      "created_at": "2024-09-18T17:19:55Z",
      "updated_at": "2024-09-18T17:19:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765437954",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765437954"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765469878",
      "pull_request_review_id": 2313371167,
      "id": 1765469878,
      "node_id": "PRRC_kwDOABII585pOu62",
      "diff_hunk": "@@ -57,9 +57,20 @@ class DepGraph\n     /** Data for each transaction, in the same order as the Cluster it was constructed from. */\n     std::vector<Entry> entries;\n \n+    /** Which positions are used. */",
      "path": "src/cluster_linearize.h",
      "position": 23,
      "original_position": 4,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761630898,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed. I initially intended to introduce this in multiple commits, but then didn't go back to editing the commit message after everything ended up in one commit.",
      "created_at": "2024-09-18T17:46:16Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765469878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765469878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 52,
      "original_line": 52,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765470244",
      "pull_request_review_id": 2313371167,
      "id": 1765470244,
      "node_id": "PRRC_kwDOABII585pOvAk",
      "diff_hunk": "@@ -86,57 +86,30 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=cluster.size().\n      */\n-    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : entries(cluster.size())\n+    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : DepGraph(cluster.size())\n     {\n         for (ClusterIndex i = 0; i < cluster.size(); ++i) {\n             // Fill in fee and size.\n             entries[i].feerate = cluster[i].first;\n-            // Fill in direct parents as ancestors.\n-            entries[i].ancestors = cluster[i].second;\n-            // Make sure transactions are ancestors of themselves.\n-            entries[i].ancestors.Set(i);\n-        }\n-\n-        // Propagate ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            // At this point, entries[a].ancestors[b] is true iff b is an ancestor of a and there\n-            // is a path from a to b through the subgraph consisting of {a, b} union\n-            // {0, 1, ..., (i-1)}.\n-            SetType to_merge = entries[i].ancestors;\n-            for (ClusterIndex j = 0; j < entries.size(); ++j) {\n-                if (entries[j].ancestors[i]) {\n-                    entries[j].ancestors |= to_merge;\n-                }\n-            }\n-        }\n-\n-        // Fill in descendant information by transposing the ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            for (auto j : entries[i].ancestors) {\n-                entries[j].descendants.Set(i);\n-            }\n+            // Fill in dependencies.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 34,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761389984,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. Made it \"Fill in dependencies by remapping direct parents.\".",
      "created_at": "2024-09-18T17:46:36Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765470244",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765470244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 106,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471150",
      "pull_request_review_id": 2313371167,
      "id": 1765471150,
      "node_id": "PRRC_kwDOABII585pOvOu",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 189,
      "original_position": 102,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I feel like that's better left to the layer above; as far as DepGraph is concerned, it's pefectly well-defined to do this, even though we don't care.",
      "created_at": "2024-09-18T17:47:23Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765471150",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 151,
      "original_line": 151,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471968",
      "pull_request_review_id": 2313371167,
      "id": 1765471968,
      "node_id": "PRRC_kwDOABII585pOvbg",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 199,
      "original_position": 110,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There is no need for that I think. The code doesn't get simpler by enforcing that.",
      "created_at": "2024-09-18T17:48:05Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765471968",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471968"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765472587",
      "pull_request_review_id": 2313371167,
      "id": 1765472587,
      "node_id": "PRRC_kwDOABII585pOvlL",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 217,
      "original_position": 79,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761452737,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I went a lot further and dropped `AddDependency` entirely.",
      "created_at": "2024-09-18T17:48:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765472587",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765472587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 177,
      "original_line": 177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765473716",
      "pull_request_review_id": 2313371167,
      "id": 1765473716,
      "node_id": "PRRC_kwDOABII585pOv20",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {",
      "path": "src/cluster_linearize.h",
      "position": 218,
      "original_position": 80,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "f484f5a8721b06d4f9fda69968d94046c6bc12d7",
      "in_reply_to_id": 1763665495,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:49:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765473716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765473716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 178,
      "original_line": 178,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474071",
      "pull_request_review_id": 2313371167,
      "id": 1765474071,
      "node_id": "PRRC_kwDOABII585pOv8X",
      "diff_hunk": "@@ -184,6 +184,46 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.",
      "path": "src/cluster_linearize.h",
      "position": 246,
      "original_position": 4,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761301820,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. I've expanded the commit message of all commits.",
      "created_at": "2024-09-18T17:49:50Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765474071",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 200,
      "original_line": 200,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474366",
      "pull_request_review_id": 2313371167,
      "id": 1765474366,
      "node_id": "PRRC_kwDOABII585pOwA-",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 254,
      "original_position": 211,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have expanded the commit message.",
      "created_at": "2024-09-18T17:50:06Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765474366",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 208,
      "original_line": 208,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475761",
      "pull_request_review_id": 2313371167,
      "id": 1765475761,
      "node_id": "PRRC_kwDOABII585pOwWx",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 260,
      "original_position": 11,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761348880,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sadly that won't work when there are cyclic dependencies. Of course, this test could be moved down to the \"if acyclic\" branch, but there is a stronger test there already.",
      "created_at": "2024-09-18T17:51:22Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765475761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475972",
      "pull_request_review_id": 2313371167,
      "id": 1765475972,
      "node_id": "PRRC_kwDOABII585pOwaE",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));\n+        }\n+        // Similar for children and descendants.\n+        for (auto child : children) {\n+            assert((depgraph.Descendants(child) & children).IsSubsetOf(SetType::Singleton(child)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 264,
      "original_position": 15,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761348362,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same reason; won't work for cyclic graphs.",
      "created_at": "2024-09-18T17:51:33Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765475972",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475972"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 337,
      "original_line": 337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765476808",
      "pull_request_review_id": 2313371167,
      "id": 1765476808,
      "node_id": "PRRC_kwDOABII585pOwnI",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;\n+        // Remove now-unused trailing entries.\n+        while (!entries.empty() && !m_used[entries.size() - 1]) {\n+            entries.pop_back();\n+        }\n+        // Remove the deleted transactions from ancestors/descendants of other transactions.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 115,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763550167,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comment.",
      "created_at": "2024-09-18T17:52:12Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765476808",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765476808"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765478370",
      "pull_request_review_id": 2313371167,
      "id": 1765478370,
      "node_id": "PRRC_kwDOABII585pOw_i",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761676550,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is adding transactions to `depgraph_tree` corresponding to the holes in `depgraph_gen`, which are then deleted below. The point is making sure that the non-holes have the same positions in both. I have added a comment to explain.",
      "created_at": "2024-09-18T17:53:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765478370",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765478370"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479411",
      "pull_request_review_id": 2313371167,
      "id": 1765479411,
      "node_id": "PRRC_kwDOABII585pOxPz",
      "diff_hunk": "@@ -18,6 +18,10 @@ using namespace cluster_linearize;\n \n namespace {\n \n+/** Special magic value that indicates to TestDepGraphSerialization that a cluster entry represents\n+ *  a hole. */\n+constexpr std::pair<FeeFrac, TestBitSet> HOLE{FeeFrac{1901858123504646, 3635904}, {}};",
      "path": "src/test/cluster_linearize_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761650849,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "They were randomly generated, but are legal for the serializer (`SanityCheck()` would fail otherwise). I've simplified them to something more obviously nonsensical (transaction larger than 4M).",
      "created_at": "2024-09-18T17:54:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479411",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479597",
      "pull_request_review_id": 2313371167,
      "id": 1765479597,
      "node_id": "PRRC_kwDOABII585pOxSt",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.\n+            // Emit N to indicate that many insertion choices are skipped.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 25,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "dde3959a24a12cd7ab37e772b55ae3c60a646528",
      "in_reply_to_id": 1761525176,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:54:43Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479597",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479597"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479695",
      "pull_request_review_id": 2313371167,
      "id": 1765479695,
      "node_id": "PRRC_kwDOABII585pOxUP",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 81,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761406415,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:54:49Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479695",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479695"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765524349",
      "pull_request_review_id": 2313465902,
      "id": 1765524349,
      "node_id": "PRRC_kwDOABII585pO8N9",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 217,
      "original_position": 79,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761452737,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "even better",
      "created_at": "2024-09-18T18:30:41Z",
      "updated_at": "2024-09-18T18:30:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765524349",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765524349"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 177,
      "original_line": 177,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765529514",
      "pull_request_review_id": 2313477686,
      "id": 1765529514,
      "node_id": "PRRC_kwDOABII585pO9eq",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 199,
      "original_position": 110,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If we're allowing it, let's make sure there's overage for it in the fuzzer",
      "created_at": "2024-09-18T18:34:11Z",
      "updated_at": "2024-09-18T18:34:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765529514",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765529514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765537433",
      "pull_request_review_id": 2313493335,
      "id": 1765537433,
      "node_id": "PRRC_kwDOABII585pO_aZ",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761676550,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ok, seems clear to me now, not sure why I was so confused. ",
      "created_at": "2024-09-18T18:40:08Z",
      "updated_at": "2024-09-18T18:40:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765537433",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765537433"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765572322",
      "pull_request_review_id": 2313550404,
      "id": 1765572322,
      "node_id": "PRRC_kwDOABII585pPH7i",
      "diff_hunk": "@@ -240,32 +241,68 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependency)\n+FUZZ_TARGET(clusterlin_add_dependencies)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using AddDependency\n-    // have the same effect.\n+    // Verify that computing a DepGraph from a cluster, or building it step by step using\n+    // AddDependencies has the same effect.\n \n-    // Construct a cluster of a certain length, with no dependencies.\n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, 32);\n+    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n+    InsecureRandomContext rng(rng_seed);\n+\n+    // Construct a cluster of a certain length, with no dependencies.\n+    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n     Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n     // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph(cluster);\n-    SanityCheck(depgraph);\n-    // Read (parent, child) pairs, and add them to the cluster and depgraph.\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size() * TestBitSet::Size()) {\n-        auto parent = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 2);\n-        child += (child >= parent);\n-        cluster[child].second.Set(parent);\n-        depgraph.AddDependency(parent, child);\n-        assert(depgraph.Ancestors(child)[parent]);\n-        assert(depgraph.Descendants(parent)[child]);\n+    DepGraph depgraph_batch(cluster);\n+    SanityCheck(depgraph_batch);\n+    // Read (parent, child) and (parents, child) pairs, and add them to the cluster and depgraph.\n+    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n+        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this gives additional coverage since no deps added in a `AddDependencies` call is allowed\r\n```Suggestion\r\n        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\r\n```",
      "created_at": "2024-09-18T19:11:52Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765572322",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765572322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765576120",
      "pull_request_review_id": 2313550404,
      "id": 1765576120,
      "node_id": "PRRC_kwDOABII585pPI24",
      "diff_hunk": "@@ -164,21 +137,29 @@ class DepGraph\n         return new_idx;\n     }\n \n-    /** Modify this transaction graph, adding a dependency between a specified parent and child.\n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 75,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "AddDependency doesn't exist anymore",
      "created_at": "2024-09-18T19:15:36Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765576120",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765576120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765598717",
      "pull_request_review_id": 2313550404,
      "id": 1765598717,
      "node_id": "PRRC_kwDOABII585pPOX9",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)",
      "path": "src/cluster_linearize.h",
      "position": 110,
      "original_position": 35,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could use some documentation on how to use `mapping` and `pos_range`, with holes it's not immediately obvious.",
      "created_at": "2024-09-18T19:37:12Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765598717",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765598717"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 89,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765657306",
      "pull_request_review_id": 2313550404,
      "id": 1765657306,
      "node_id": "PRRC_kwDOABII585pPcra",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());",
      "path": "src/cluster_linearize.h",
      "position": 112,
      "original_position": 37,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "is this not still true?",
      "created_at": "2024-09-18T20:09:03Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765657306",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765657306"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 127,
      "original_line": 127,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765664723",
      "pull_request_review_id": 2313550404,
      "id": 1765664723,
      "node_id": "PRRC_kwDOABII585pPefT",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());\n-        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+        for (ClusterIndex i : depgraph.Positions()) {\n+            auto new_idx = mapping[i];\n+            Assume(new_idx < pos_range);\n+            // Add transaction.\n+            entries[new_idx].ancestors = SetType::Singleton(new_idx);\n+            entries[new_idx].descendants = SetType::Singleton(new_idx);\n+            m_used.Set(new_idx);\n             // Fill in fee and size.\n-            entries[mapping[i]].feerate = depgraph.entries[i].feerate;\n+            entries[new_idx].feerate = depgraph.entries[i].feerate;\n+        }\n+        for (ClusterIndex i : depgraph.Positions()) {\n             // Fill in dependencies by mapping direct parents.\n             SetType parents;\n             for (auto j : depgraph.GetReducedParents(i)) parents.Set(mapping[j]);\n             AddDependencies(parents, mapping[i]);\n         }\n+        // Verify that the provided pos_range was correct (no unused positions at the end).\n+        Assume(pos_range == 0 || m_used[pos_range - 1]);",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 57,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if not erroneous, I think a bit easier to read\r\n```Suggestion\r\n        Assume((m_used.None() && pos_range == 0) || m_used.Last() == pos_range - 1);\r\n```",
      "created_at": "2024-09-18T20:14:50Z",
      "updated_at": "2024-09-18T20:24:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765664723",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765664723"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765667807",
      "pull_request_review_id": 2313550404,
      "id": 1765667807,
      "node_id": "PRRC_kwDOABII585pPfPf",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);",
      "path": "src/test/util/cluster_linearize.h",
      "position": 203,
      "original_position": 146,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Haven't looked close enough to the new format, but pushing another element to `reordering` after hitting `SetType::Size` already seems to make the DepGraph construction later odd? Couldn't this make the mapping argument too large?",
      "created_at": "2024-09-18T20:17:47Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765667807",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765667807"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788553",
      "pull_request_review_id": 2313906901,
      "id": 1765788553,
      "node_id": "PRRC_kwDOABII585pP8uJ",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)",
      "path": "src/cluster_linearize.h",
      "position": 110,
      "original_position": 35,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765598717,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have added some documentation and `Assume`s.",
      "created_at": "2024-09-18T22:08:04Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765788553",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788553"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 89,
      "original_line": 89,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788969",
      "pull_request_review_id": 2313906901,
      "id": 1765788969,
      "node_id": "PRRC_kwDOABII585pP80p",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());",
      "path": "src/cluster_linearize.h",
      "position": 112,
      "original_position": 37,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765657306,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No; `mapping.size()` should be equal to `depgraph.PositionRange()` though, which I've clarified and added an `Assume` for.",
      "created_at": "2024-09-18T22:08:33Z",
      "updated_at": "2024-09-18T22:33:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765788969",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 127,
      "original_line": 127,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765789292",
      "pull_request_review_id": 2313906901,
      "id": 1765789292,
      "node_id": "PRRC_kwDOABII585pP85s",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 199,
      "original_position": 110,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good idea, done (in `clusterlin_cluster_serialization`).",
      "created_at": "2024-09-18T22:09:01Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765789292",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765789292"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765790977",
      "pull_request_review_id": 2313906901,
      "id": 1765790977,
      "node_id": "PRRC_kwDOABII585pP9UB",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);",
      "path": "src/test/util/cluster_linearize.h",
      "position": 203,
      "original_position": 146,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765667807,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`reordering` has a size equal to the number of transactions (excluding holes) in the reconstructed `DepGraph`, and can indeed not exceed `SetType::Size()` (this is also asserted above). However, `total_size` does include holes, and can reach `SetType::Size()` (that's exactly what this branch is for, and it does not increment `total_size` anymore).",
      "created_at": "2024-09-18T22:11:17Z",
      "updated_at": "2024-09-18T22:41:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765790977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765790977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791238",
      "pull_request_review_id": 2313906901,
      "id": 1765791238,
      "node_id": "PRRC_kwDOABII585pP9YG",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());\n-        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+        for (ClusterIndex i : depgraph.Positions()) {\n+            auto new_idx = mapping[i];\n+            Assume(new_idx < pos_range);\n+            // Add transaction.\n+            entries[new_idx].ancestors = SetType::Singleton(new_idx);\n+            entries[new_idx].descendants = SetType::Singleton(new_idx);\n+            m_used.Set(new_idx);\n             // Fill in fee and size.\n-            entries[mapping[i]].feerate = depgraph.entries[i].feerate;\n+            entries[new_idx].feerate = depgraph.entries[i].feerate;\n+        }\n+        for (ClusterIndex i : depgraph.Positions()) {\n             // Fill in dependencies by mapping direct parents.\n             SetType parents;\n             for (auto j : depgraph.GetReducedParents(i)) parents.Set(mapping[j]);\n             AddDependencies(parents, mapping[i]);\n         }\n+        // Verify that the provided pos_range was correct (no unused positions at the end).\n+        Assume(pos_range == 0 || m_used[pos_range - 1]);",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 57,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765664723,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I made it even more explicit with `Assume(m_used.None() ? (pos_range == 0) : (pos_range == m_used.Last() + 1));`.",
      "created_at": "2024-09-18T22:11:38Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791238",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791238"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791639",
      "pull_request_review_id": 2313906901,
      "id": 1765791639,
      "node_id": "PRRC_kwDOABII585pP9eX",
      "diff_hunk": "@@ -164,21 +137,29 @@ class DepGraph\n         return new_idx;\n     }\n \n-    /** Modify this transaction graph, adding a dependency between a specified parent and child.\n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 75,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": 1765576120,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Gone.",
      "created_at": "2024-09-18T22:12:17Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791761",
      "pull_request_review_id": 2313906901,
      "id": 1765791761,
      "node_id": "PRRC_kwDOABII585pP9gR",
      "diff_hunk": "@@ -240,32 +241,68 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependency)\n+FUZZ_TARGET(clusterlin_add_dependencies)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using AddDependency\n-    // have the same effect.\n+    // Verify that computing a DepGraph from a cluster, or building it step by step using\n+    // AddDependencies has the same effect.\n \n-    // Construct a cluster of a certain length, with no dependencies.\n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, 32);\n+    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n+    InsecureRandomContext rng(rng_seed);\n+\n+    // Construct a cluster of a certain length, with no dependencies.\n+    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n     Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n     // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph(cluster);\n-    SanityCheck(depgraph);\n-    // Read (parent, child) pairs, and add them to the cluster and depgraph.\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size() * TestBitSet::Size()) {\n-        auto parent = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 2);\n-        child += (child >= parent);\n-        cluster[child].second.Set(parent);\n-        depgraph.AddDependency(parent, child);\n-        assert(depgraph.Ancestors(child)[parent]);\n-        assert(depgraph.Descendants(parent)[child]);\n+    DepGraph depgraph_batch(cluster);\n+    SanityCheck(depgraph_batch);\n+    // Read (parent, child) and (parents, child) pairs, and add them to the cluster and depgraph.\n+    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n+        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": 1765572322,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, done.",
      "created_at": "2024-09-18T22:12:27Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1766854879",
      "pull_request_review_id": 2315580018,
      "id": 1766854879,
      "node_id": "PRRC_kwDOABII585pUBDf",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);",
      "path": "src/test/util/cluster_linearize.h",
      "position": 203,
      "original_position": 146,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765667807,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ah, missed the line where it was being set to `diff`.  ",
      "created_at": "2024-09-19T13:36:46Z",
      "updated_at": "2024-09-19T13:36:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1766854879",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1766854879"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1768420948",
      "pull_request_review_id": 2317959224,
      "id": 1768420948,
      "node_id": "PRRC_kwDOABII585pZ_ZU",
      "diff_hunk": "@@ -264,9 +264,23 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 9,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "40224019cd6e8259118412529c554d8b4a260130",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit in 40224019cd6e8259118412529c554d8b4a260130\r\n```suggestion\r\n        // Parents of a transaction do not have ancestors inside those parents (except itself).\r\n```",
      "created_at": "2024-09-20T11:12:40Z",
      "updated_at": "2024-09-20T21:12:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1768420948",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1768420948"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769251003",
      "pull_request_review_id": 2317959224,
      "id": 1769251003,
      "node_id": "PRRC_kwDOABII585pdKC7",
      "diff_hunk": "@@ -151,39 +162,120 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 137,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "aab53ddcd8fcbc3c0be0da9383f8e06abe5badda",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ok, so iiuc, if you add + remove + add + remove the same number of transactions, the depgraph isn't going to get larger and larger; the new transactions can take the place of the holes.\r\n\r\nEdit: and can see that it is tested in clusterlin_cluster_serialization",
      "created_at": "2024-09-20T20:58:21Z",
      "updated_at": "2024-09-20T21:12:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1769251003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769251003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": 128,
      "original_start_line": 165,
      "start_side": "RIGHT",
      "line": 129,
      "original_line": 129,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769352568",
      "pull_request_review_id": 2319506320,
      "id": 1769352568,
      "node_id": "PRRC_kwDOABII585pdi14",
      "diff_hunk": "@@ -264,9 +264,23 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 9,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "40224019cd6e8259118412529c554d8b4a260130",
      "in_reply_to_id": 1768420948,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed.",
      "created_at": "2024-09-20T23:29:51Z",
      "updated_at": "2024-09-20T23:29:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1769352568",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769352568"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 272,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769352792",
      "pull_request_review_id": 2319506527,
      "id": 1769352792,
      "node_id": "PRRC_kwDOABII585pdi5Y",
      "diff_hunk": "@@ -151,39 +162,120 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 137,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "aab53ddcd8fcbc3c0be0da9383f8e06abe5badda",
      "in_reply_to_id": 1769251003,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, and `DepGraph` itself is responsible for allocating available positions.",
      "created_at": "2024-09-20T23:30:21Z",
      "updated_at": "2024-09-20T23:30:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1769352792",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769352792"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": 128,
      "original_start_line": 165,
      "start_side": "RIGHT",
      "line": 129,
      "original_line": 129,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769600192",
      "pull_request_review_id": 2319841829,
      "id": 1769600192,
      "node_id": "PRRC_kwDOABII585pefTA",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 24,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "4f5916f95607fe893512bfa91f2aa1affa4f4aeb",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: Should say \"is **to** be inserted\"?",
      "created_at": "2024-09-21T15:27:11Z",
      "updated_at": "2024-10-01T18:17:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1769600192",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1769600192"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781424806",
      "pull_request_review_id": 2338044262,
      "id": 1781424806,
      "node_id": "PRRC_kwDOABII585qLmKm",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n ",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": 64,
      "original_position": 3,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`clusterlin: merge several DepGraph fuzz tests into simulation test`\r\n\r\nSeems to only merge 2 fwiw, might just enumerate them?",
      "created_at": "2024-09-30T16:22:11Z",
      "updated_at": "2024-09-30T16:52:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781424806",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781424806"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 243,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781428797",
      "pull_request_review_id": 2338044262,
      "id": 1781428797,
      "node_id": "PRRC_kwDOABII585qLnI9",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};\n+\n+    /** Read a valid index of a transaction from the provider. */\n+    auto idx_fn = [&]() {\n+        auto offset = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (offset == 0) return i;\n+            --offset;\n         }\n-        assert(parents_mask_shifted == 0);\n-        depgraph_batch.AddDependencies(deps, child);\n-        for (auto i : deps) {\n-            deps_list.emplace_back(i, child);\n-            assert(depgraph_batch.Ancestors(child)[i]);\n-            assert(depgraph_batch.Descendants(i)[child]);\n+        assert(false);\n+        return ClusterIndex(-1);\n+    };\n+\n+    /** Read a valid subset of the transactions from the provider. */\n+    auto subset_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n+        auto mask_shifted = mask;\n+        TestBitSet subset;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (mask_shifted & 1) {\n+                subset.Set(i);\n+            }\n+            mask_shifted >>= 1;\n         }\n-    }\n-    // Sanity check the result.\n-    SanityCheck(depgraph_batch);\n-    // Verify that the resulting DepGraph matches one recomputed from the cluster.\n-    assert(DepGraph(cluster) == depgraph_batch);\n-\n-    DepGraph<TestBitSet> depgraph_individual;\n-    // Add all transactions to depgraph_individual.\n-    for (const auto& [feerate, parents] : cluster) {\n-        depgraph_individual.AddTransaction(feerate);\n-    }\n-    SanityCheck(depgraph_individual);\n-    // Add all individual dependencies to depgraph_individual in randomized order.\n-    std::shuffle(deps_list.begin(), deps_list.end(), rng);\n-    for (auto [parent, child] : deps_list) {\n-        depgraph_individual.AddDependencies(TestBitSet::Singleton(parent), child);\n-        assert(depgraph_individual.Ancestors(child)[parent]);\n-        assert(depgraph_individual.Descendants(parent)[child]);\n-    }\n-    // Sanity check and compare again the batched version.\n-    SanityCheck(depgraph_individual);\n-    assert(depgraph_individual == depgraph_batch);\n-}\n+        assert(mask_shifted == 0);\n+        return subset;\n+    };\n \n-FUZZ_TARGET(clusterlin_cluster_serialization)\n-{\n-    // Verify that any graph of transactions has its ancestry correctly computed by DepGraph, and\n-    // if it is a DAG, that it can be serialized as a DepGraph in a way that roundtrips. This\n-    // guarantees that any acyclic cluster has a corresponding DepGraph serialization.\n+    /** Read any set of transactions from the provider. */",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 106,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "```Suggestion\r\n    /** Read any set of transactions from the provider including empty slots. */\r\n```",
      "created_at": "2024-09-30T16:25:24Z",
      "updated_at": "2024-09-30T16:52:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781428797",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781428797"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 286,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781436150",
      "pull_request_review_id": 2338044262,
      "id": 1781436150,
      "node_id": "PRRC_kwDOABII585qLo72",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "mu-nit: `s/num_tx/sim_num_tx/`",
      "created_at": "2024-09-30T16:31:20Z",
      "updated_at": "2024-09-30T16:52:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781436150",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781436150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781444249",
      "pull_request_review_id": 2338044262,
      "id": 1781444249,
      "node_id": "PRRC_kwDOABII585qLq6Z",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};\n+\n+    /** Read a valid index of a transaction from the provider. */\n+    auto idx_fn = [&]() {\n+        auto offset = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (offset == 0) return i;\n+            --offset;\n         }\n-        assert(parents_mask_shifted == 0);\n-        depgraph_batch.AddDependencies(deps, child);\n-        for (auto i : deps) {\n-            deps_list.emplace_back(i, child);\n-            assert(depgraph_batch.Ancestors(child)[i]);\n-            assert(depgraph_batch.Descendants(i)[child]);\n+        assert(false);\n+        return ClusterIndex(-1);\n+    };\n+\n+    /** Read a valid subset of the transactions from the provider. */\n+    auto subset_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n+        auto mask_shifted = mask;\n+        TestBitSet subset;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (mask_shifted & 1) {\n+                subset.Set(i);\n+            }\n+            mask_shifted >>= 1;\n         }\n-    }\n-    // Sanity check the result.\n-    SanityCheck(depgraph_batch);\n-    // Verify that the resulting DepGraph matches one recomputed from the cluster.\n-    assert(DepGraph(cluster) == depgraph_batch);\n-\n-    DepGraph<TestBitSet> depgraph_individual;\n-    // Add all transactions to depgraph_individual.\n-    for (const auto& [feerate, parents] : cluster) {\n-        depgraph_individual.AddTransaction(feerate);\n-    }\n-    SanityCheck(depgraph_individual);\n-    // Add all individual dependencies to depgraph_individual in randomized order.\n-    std::shuffle(deps_list.begin(), deps_list.end(), rng);\n-    for (auto [parent, child] : deps_list) {\n-        depgraph_individual.AddDependencies(TestBitSet::Singleton(parent), child);\n-        assert(depgraph_individual.Ancestors(child)[parent]);\n-        assert(depgraph_individual.Descendants(parent)[child]);\n-    }\n-    // Sanity check and compare again the batched version.\n-    SanityCheck(depgraph_individual);\n-    assert(depgraph_individual == depgraph_batch);\n-}\n+        assert(mask_shifted == 0);\n+        return subset;\n+    };\n \n-FUZZ_TARGET(clusterlin_cluster_serialization)\n-{\n-    // Verify that any graph of transactions has its ancestry correctly computed by DepGraph, and\n-    // if it is a DAG, that it can be serialized as a DepGraph in a way that roundtrips. This\n-    // guarantees that any acyclic cluster has a corresponding DepGraph serialization.\n+    /** Read any set of transactions from the provider. */\n+    auto set_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << sim.size()) - 1);\n+        TestBitSet set;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if ((mask >> i) & 1) {\n+                set.Set(i);\n+            }\n+        }\n+        return set;\n+    };\n \n-    FuzzedDataProvider provider(buffer.data(), buffer.size());\n+    /** Propagate ancestor information in sim. */\n+    auto anc_update_fn = [&]() {\n+        while (true) {\n+            bool updates{false};\n+            for (ClusterIndex chl = 0; chl < sim.size(); ++chl) {\n+                if (!sim[chl].has_value()) continue;\n+                for (auto par : sim[chl]->second) {\n+                    if (!sim[chl]->second.IsSupersetOf(sim[par]->second)) {\n+                        sim[chl]->second |= sim[par]->second;\n+                        updates = true;\n+                    }\n+                }\n+            }\n+            if (!updates) break;\n+        }\n+    };\n \n-    // Construct a cluster in a naive way (using a FuzzedDataProvider-based serialization).\n-    Cluster<TestBitSet> cluster;\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(1, 32);\n-    cluster.resize(num_tx);\n-    for (ClusterIndex i = 0; i < num_tx; ++i) {\n-        cluster[i].first.size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n-        cluster[i].first.fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n-        for (ClusterIndex j = 0; j < num_tx; ++j) {\n-            if (i == j) continue;\n-            if (provider.ConsumeBool()) cluster[i].second.Set(j);\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, 1000) {\n+        uint8_t command = provider.ConsumeIntegral<uint8_t>();\n+        if (num_tx == 0 || ((command % 3) <= 0 && num_tx < TestBitSet::Size())) {\n+            // AddTransaction.\n+            auto fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n+            auto size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n+            FeeFrac feerate{fee, size};\n+            // Apply to DepGraph.\n+            auto idx = real.AddTransaction(feerate);\n+            // Verify that the returned index is correct.\n+            assert(!sim[idx].has_value());\n+            for (ClusterIndex i = 0; i < TestBitSet::Size(); ++i) {\n+                if (!sim[i].has_value()) {\n+                    assert(idx == i);\n+                    break;\n+                }\n+            }\n+            // Update sim.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": 208,
      "original_position": 163,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In case somehow the sim had no non-empty slots above and misses the `idx == i` assert\r\n```Suggestion\r\n            // Update sim.\r\n            assert(!sim[i].has_value());\r\n```",
      "created_at": "2024-09-30T16:38:00Z",
      "updated_at": "2024-09-30T16:52:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781444249",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781444249"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 347,
      "original_line": 347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781748330",
      "pull_request_review_id": 2338584795,
      "id": 1781748330,
      "node_id": "PRRC_kwDOABII585qM1Jq",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};\n+\n+    /** Read a valid index of a transaction from the provider. */\n+    auto idx_fn = [&]() {\n+        auto offset = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (offset == 0) return i;\n+            --offset;\n         }\n-        assert(parents_mask_shifted == 0);\n-        depgraph_batch.AddDependencies(deps, child);\n-        for (auto i : deps) {\n-            deps_list.emplace_back(i, child);\n-            assert(depgraph_batch.Ancestors(child)[i]);\n-            assert(depgraph_batch.Descendants(i)[child]);\n+        assert(false);\n+        return ClusterIndex(-1);\n+    };\n+\n+    /** Read a valid subset of the transactions from the provider. */\n+    auto subset_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n+        auto mask_shifted = mask;\n+        TestBitSet subset;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (mask_shifted & 1) {\n+                subset.Set(i);\n+            }\n+            mask_shifted >>= 1;\n         }\n-    }\n-    // Sanity check the result.\n-    SanityCheck(depgraph_batch);\n-    // Verify that the resulting DepGraph matches one recomputed from the cluster.\n-    assert(DepGraph(cluster) == depgraph_batch);\n-\n-    DepGraph<TestBitSet> depgraph_individual;\n-    // Add all transactions to depgraph_individual.\n-    for (const auto& [feerate, parents] : cluster) {\n-        depgraph_individual.AddTransaction(feerate);\n-    }\n-    SanityCheck(depgraph_individual);\n-    // Add all individual dependencies to depgraph_individual in randomized order.\n-    std::shuffle(deps_list.begin(), deps_list.end(), rng);\n-    for (auto [parent, child] : deps_list) {\n-        depgraph_individual.AddDependencies(TestBitSet::Singleton(parent), child);\n-        assert(depgraph_individual.Ancestors(child)[parent]);\n-        assert(depgraph_individual.Descendants(parent)[child]);\n-    }\n-    // Sanity check and compare again the batched version.\n-    SanityCheck(depgraph_individual);\n-    assert(depgraph_individual == depgraph_batch);\n-}\n+        assert(mask_shifted == 0);\n+        return subset;\n+    };\n \n-FUZZ_TARGET(clusterlin_cluster_serialization)\n-{\n-    // Verify that any graph of transactions has its ancestry correctly computed by DepGraph, and\n-    // if it is a DAG, that it can be serialized as a DepGraph in a way that roundtrips. This\n-    // guarantees that any acyclic cluster has a corresponding DepGraph serialization.\n+    /** Read any set of transactions from the provider. */\n+    auto set_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << sim.size()) - 1);\n+        TestBitSet set;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if ((mask >> i) & 1) {\n+                set.Set(i);\n+            }\n+        }\n+        return set;\n+    };\n \n-    FuzzedDataProvider provider(buffer.data(), buffer.size());\n+    /** Propagate ancestor information in sim. */\n+    auto anc_update_fn = [&]() {\n+        while (true) {\n+            bool updates{false};\n+            for (ClusterIndex chl = 0; chl < sim.size(); ++chl) {\n+                if (!sim[chl].has_value()) continue;\n+                for (auto par : sim[chl]->second) {\n+                    if (!sim[chl]->second.IsSupersetOf(sim[par]->second)) {\n+                        sim[chl]->second |= sim[par]->second;\n+                        updates = true;\n+                    }\n+                }\n+            }\n+            if (!updates) break;\n+        }\n+    };\n \n-    // Construct a cluster in a naive way (using a FuzzedDataProvider-based serialization).\n-    Cluster<TestBitSet> cluster;\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(1, 32);\n-    cluster.resize(num_tx);\n-    for (ClusterIndex i = 0; i < num_tx; ++i) {\n-        cluster[i].first.size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n-        cluster[i].first.fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n-        for (ClusterIndex j = 0; j < num_tx; ++j) {\n-            if (i == j) continue;\n-            if (provider.ConsumeBool()) cluster[i].second.Set(j);\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, 1000) {\n+        uint8_t command = provider.ConsumeIntegral<uint8_t>();\n+        if (num_tx == 0 || ((command % 3) <= 0 && num_tx < TestBitSet::Size())) {\n+            // AddTransaction.\n+            auto fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n+            auto size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n+            FeeFrac feerate{fee, size};\n+            // Apply to DepGraph.\n+            auto idx = real.AddTransaction(feerate);\n+            // Verify that the returned index is correct.\n+            assert(!sim[idx].has_value());\n+            for (ClusterIndex i = 0; i < TestBitSet::Size(); ++i) {\n+                if (!sim[i].has_value()) {\n+                    assert(idx == i);\n+                    break;\n+                }\n+            }\n+            // Update sim.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": 208,
      "original_position": 163,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": 1781444249,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`i` is not in scope here anymore.",
      "created_at": "2024-09-30T21:21:54Z",
      "updated_at": "2024-09-30T21:21:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781748330",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781748330"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 347,
      "original_line": 347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781761151",
      "pull_request_review_id": 2338604430,
      "id": 1781761151,
      "node_id": "PRRC_kwDOABII585qM4R_",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n ",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": 64,
      "original_position": 3,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": 1781424806,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to:\r\n\r\n> clusterlin: merge two DepGraph fuzz tests into simulation test\r\n>    \r\n> This combines the clusterlin_add_dependency and clusterlin_cluster_serialization fuzz tests into a single clusterlin_depgraph_sim fuzz test. This tests starts from an empty DepGraph and performs a arbitrary number of AddTransaction, AddDependencies, and RemoveTransactions operations on it, and compares the resulting state with a naive reimplementation.\r\n",
      "created_at": "2024-09-30T21:37:36Z",
      "updated_at": "2024-09-30T21:37:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781761151",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781761151"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 243,
      "original_line": 243,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781762376",
      "pull_request_review_id": 2338606205,
      "id": 1781762376,
      "node_id": "PRRC_kwDOABII585qM4lI",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};\n+\n+    /** Read a valid index of a transaction from the provider. */\n+    auto idx_fn = [&]() {\n+        auto offset = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (offset == 0) return i;\n+            --offset;\n         }\n-        assert(parents_mask_shifted == 0);\n-        depgraph_batch.AddDependencies(deps, child);\n-        for (auto i : deps) {\n-            deps_list.emplace_back(i, child);\n-            assert(depgraph_batch.Ancestors(child)[i]);\n-            assert(depgraph_batch.Descendants(i)[child]);\n+        assert(false);\n+        return ClusterIndex(-1);\n+    };\n+\n+    /** Read a valid subset of the transactions from the provider. */\n+    auto subset_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n+        auto mask_shifted = mask;\n+        TestBitSet subset;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (mask_shifted & 1) {\n+                subset.Set(i);\n+            }\n+            mask_shifted >>= 1;\n         }\n-    }\n-    // Sanity check the result.\n-    SanityCheck(depgraph_batch);\n-    // Verify that the resulting DepGraph matches one recomputed from the cluster.\n-    assert(DepGraph(cluster) == depgraph_batch);\n-\n-    DepGraph<TestBitSet> depgraph_individual;\n-    // Add all transactions to depgraph_individual.\n-    for (const auto& [feerate, parents] : cluster) {\n-        depgraph_individual.AddTransaction(feerate);\n-    }\n-    SanityCheck(depgraph_individual);\n-    // Add all individual dependencies to depgraph_individual in randomized order.\n-    std::shuffle(deps_list.begin(), deps_list.end(), rng);\n-    for (auto [parent, child] : deps_list) {\n-        depgraph_individual.AddDependencies(TestBitSet::Singleton(parent), child);\n-        assert(depgraph_individual.Ancestors(child)[parent]);\n-        assert(depgraph_individual.Descendants(parent)[child]);\n-    }\n-    // Sanity check and compare again the batched version.\n-    SanityCheck(depgraph_individual);\n-    assert(depgraph_individual == depgraph_batch);\n-}\n+        assert(mask_shifted == 0);\n+        return subset;\n+    };\n \n-FUZZ_TARGET(clusterlin_cluster_serialization)\n-{\n-    // Verify that any graph of transactions has its ancestry correctly computed by DepGraph, and\n-    // if it is a DAG, that it can be serialized as a DepGraph in a way that roundtrips. This\n-    // guarantees that any acyclic cluster has a corresponding DepGraph serialization.\n+    /** Read any set of transactions from the provider. */",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 106,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": 1781428797,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Changed to:\r\n\r\n> /** Read any set of transactions from the provider (including unused positions). */",
      "created_at": "2024-09-30T21:39:14Z",
      "updated_at": "2024-09-30T21:39:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781762376",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781762376"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 286,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781763047",
      "pull_request_review_id": 2338607268,
      "id": 1781763047,
      "node_id": "PRRC_kwDOABII585qM4vn",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 42,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": 1781436150,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. I have also added an actual counting of the number of transactions in `real` at the end, and an `assert` to compare it with `num_tx_sim`.",
      "created_at": "2024-09-30T21:40:09Z",
      "updated_at": "2024-09-30T21:40:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781763047",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781763047"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 256,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781987204",
      "pull_request_review_id": 2338928871,
      "id": 1781987204,
      "node_id": "PRRC_kwDOABII585qNveE",
      "diff_hunk": "@@ -241,103 +241,149 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependencies)\n+FUZZ_TARGET(clusterlin_depgraph_sim)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using\n-    // AddDependencies has the same effect.\n+    // Simulation test to verify the full behavior of DepGraph.\n \n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n-    InsecureRandomContext rng(rng_seed);\n-\n-    // Construct a cluster of a certain length, with no dependencies.\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n-    Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n-    // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph_batch(cluster);\n-    SanityCheck(depgraph_batch);\n-    // Read (parents, child) pairs, and add the dependencies to the cluster and depgraph.\n-    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n-        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-\n-        auto parents_mask_shifted = parents_mask;\n-        TestBitSet deps;\n-        for (ClusterIndex i = 0; i < num_tx; ++i) {\n-            if (parents_mask_shifted & 1) {\n-                deps.Set(i);\n-                cluster[child].second.Set(i);\n-            }\n-            parents_mask_shifted >>= 1;\n+\n+    /** Real DepGraph being tested. */\n+    DepGraph<TestBitSet> real;\n+    /** Simulated DepGraph (sim[i] is std::nullopt if position i does not exist; otherwise,\n+     *  sim[i]->first is its individual feerate, and sim[i]->second is its set of ancestors. */\n+    std::array<std::optional<std::pair<FeeFrac, TestBitSet>>, TestBitSet::Size()> sim;\n+    /** The number of non-nullopt position in sim. */\n+    ClusterIndex num_tx{0};\n+\n+    /** Read a valid index of a transaction from the provider. */\n+    auto idx_fn = [&]() {\n+        auto offset = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (offset == 0) return i;\n+            --offset;\n         }\n-        assert(parents_mask_shifted == 0);\n-        depgraph_batch.AddDependencies(deps, child);\n-        for (auto i : deps) {\n-            deps_list.emplace_back(i, child);\n-            assert(depgraph_batch.Ancestors(child)[i]);\n-            assert(depgraph_batch.Descendants(i)[child]);\n+        assert(false);\n+        return ClusterIndex(-1);\n+    };\n+\n+    /** Read a valid subset of the transactions from the provider. */\n+    auto subset_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\n+        auto mask_shifted = mask;\n+        TestBitSet subset;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if (!sim[i].has_value()) continue;\n+            if (mask_shifted & 1) {\n+                subset.Set(i);\n+            }\n+            mask_shifted >>= 1;\n         }\n-    }\n-    // Sanity check the result.\n-    SanityCheck(depgraph_batch);\n-    // Verify that the resulting DepGraph matches one recomputed from the cluster.\n-    assert(DepGraph(cluster) == depgraph_batch);\n-\n-    DepGraph<TestBitSet> depgraph_individual;\n-    // Add all transactions to depgraph_individual.\n-    for (const auto& [feerate, parents] : cluster) {\n-        depgraph_individual.AddTransaction(feerate);\n-    }\n-    SanityCheck(depgraph_individual);\n-    // Add all individual dependencies to depgraph_individual in randomized order.\n-    std::shuffle(deps_list.begin(), deps_list.end(), rng);\n-    for (auto [parent, child] : deps_list) {\n-        depgraph_individual.AddDependencies(TestBitSet::Singleton(parent), child);\n-        assert(depgraph_individual.Ancestors(child)[parent]);\n-        assert(depgraph_individual.Descendants(parent)[child]);\n-    }\n-    // Sanity check and compare again the batched version.\n-    SanityCheck(depgraph_individual);\n-    assert(depgraph_individual == depgraph_batch);\n-}\n+        assert(mask_shifted == 0);\n+        return subset;\n+    };\n \n-FUZZ_TARGET(clusterlin_cluster_serialization)\n-{\n-    // Verify that any graph of transactions has its ancestry correctly computed by DepGraph, and\n-    // if it is a DAG, that it can be serialized as a DepGraph in a way that roundtrips. This\n-    // guarantees that any acyclic cluster has a corresponding DepGraph serialization.\n+    /** Read any set of transactions from the provider. */\n+    auto set_fn = [&]() {\n+        const auto mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << sim.size()) - 1);\n+        TestBitSet set;\n+        for (ClusterIndex i = 0; i < sim.size(); ++i) {\n+            if ((mask >> i) & 1) {\n+                set.Set(i);\n+            }\n+        }\n+        return set;\n+    };\n \n-    FuzzedDataProvider provider(buffer.data(), buffer.size());\n+    /** Propagate ancestor information in sim. */\n+    auto anc_update_fn = [&]() {\n+        while (true) {\n+            bool updates{false};\n+            for (ClusterIndex chl = 0; chl < sim.size(); ++chl) {\n+                if (!sim[chl].has_value()) continue;\n+                for (auto par : sim[chl]->second) {\n+                    if (!sim[chl]->second.IsSupersetOf(sim[par]->second)) {\n+                        sim[chl]->second |= sim[par]->second;\n+                        updates = true;\n+                    }\n+                }\n+            }\n+            if (!updates) break;\n+        }\n+    };\n \n-    // Construct a cluster in a naive way (using a FuzzedDataProvider-based serialization).\n-    Cluster<TestBitSet> cluster;\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(1, 32);\n-    cluster.resize(num_tx);\n-    for (ClusterIndex i = 0; i < num_tx; ++i) {\n-        cluster[i].first.size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n-        cluster[i].first.fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n-        for (ClusterIndex j = 0; j < num_tx; ++j) {\n-            if (i == j) continue;\n-            if (provider.ConsumeBool()) cluster[i].second.Set(j);\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, 1000) {\n+        uint8_t command = provider.ConsumeIntegral<uint8_t>();\n+        if (num_tx == 0 || ((command % 3) <= 0 && num_tx < TestBitSet::Size())) {\n+            // AddTransaction.\n+            auto fee = provider.ConsumeIntegralInRange<int64_t>(-0x8000000000000, 0x7ffffffffffff);\n+            auto size = provider.ConsumeIntegralInRange<int32_t>(1, 0x3fffff);\n+            FeeFrac feerate{fee, size};\n+            // Apply to DepGraph.\n+            auto idx = real.AddTransaction(feerate);\n+            // Verify that the returned index is correct.\n+            assert(!sim[idx].has_value());\n+            for (ClusterIndex i = 0; i < TestBitSet::Size(); ++i) {\n+                if (!sim[i].has_value()) {\n+                    assert(idx == i);\n+                    break;\n+                }\n+            }\n+            // Update sim.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": 208,
      "original_position": 163,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "de688caf2959b7842d0fccd8ed53c3102effc9b7",
      "in_reply_to_id": 1781444249,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "d'oh",
      "created_at": "2024-10-01T00:47:01Z",
      "updated_at": "2024-10-01T00:47:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1781987204",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1781987204"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 347,
      "original_line": 347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783088965",
      "pull_request_review_id": 2319841829,
      "id": 1783088965,
      "node_id": "PRRC_kwDOABII585qR8dF",
      "diff_hunk": "@@ -649,7 +729,8 @@ class SearchCandidateFinder\n             m_original_to_sorted[m_sorted_to_original[i]] = i;",
      "path": "src/cluster_linearize.h",
      "position": 339,
      "original_position": 204,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Just to verify my understanding: I was wondering why this loop was just up to `depgraph.TxCount()` and not `depgraph.PositionRange()`.  I think this is ok because when we instantiate a new DepGraph using a reordering, we only look at the mapping positions for entries that are in `m_used`, so it doesn't matter how the unused entries are mapped at all.  Is that correct?",
      "created_at": "2024-10-01T15:32:59Z",
      "updated_at": "2024-10-01T18:17:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1783088965",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783088965"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 687,
      "original_line": 687,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783263904",
      "pull_request_review_id": 2319841829,
      "id": 1783263904,
      "node_id": "PRRC_kwDOABII585qSnKg",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);\n+                        break;\n+                    }\n+                    --diff;\n+                }\n             }\n-            reordering.push_back(total_size++ - diff);\n             // Stop if a read error was encountered during deserialization.\n             if (read_error) break;\n         }\n \n         // Construct the original cluster order depgraph.\n-        depgraph = DepGraph(topo_depgraph, reordering);\n+        depgraph = DepGraph(topo_depgraph, reordering, total_size);\n     }\n };\n \n /** Perform a sanity/consistency check on a DepGraph. */\n template<typename SetType>\n void SanityCheck(const DepGraph<SetType>& depgraph)\n {\n+    // Verify Positions and PositionRange consistency.\n+    ClusterIndex num_positions{0};\n+    ClusterIndex position_range{0};\n+    for (ClusterIndex i : depgraph.Positions()) {\n+        ++num_positions;\n+        position_range = std::max(position_range, i + 1);",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 172,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": null,
      "user": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: `position_range` will always just be updated to `i+1` at each loop iteration, so we could simplify this if we wanted to.",
      "created_at": "2024-10-01T17:51:48Z",
      "updated_at": "2024-10-01T18:17:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1783263904",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783263904"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 305,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783323170",
      "pull_request_review_id": 2341119356,
      "id": 1783323170,
      "node_id": "PRRC_kwDOABII585qS1oi",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 24,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "4f5916f95607fe893512bfa91f2aa1affa4f4aeb",
      "in_reply_to_id": 1769600192,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed. Will address if I retouch.",
      "created_at": "2024-10-01T18:34:16Z",
      "updated_at": "2024-10-01T18:34:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1783323170",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783323170"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783331508",
      "pull_request_review_id": 2341133085,
      "id": 1783331508,
      "node_id": "PRRC_kwDOABII585qS3q0",
      "diff_hunk": "@@ -649,7 +729,8 @@ class SearchCandidateFinder\n             m_original_to_sorted[m_sorted_to_original[i]] = i;",
      "path": "src/cluster_linearize.h",
      "position": 339,
      "original_position": 204,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1783088965,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed. I think this may actually have been an oversight, but but it is correct: only the first `depgraph.TxCount()` positions within `m_sorted_to_original` are actually ever accessed (because the holes are all moved to the end), and similarly, only the used positions within `m_original_to_sorted` matter.\r\n\r\nThis made me realize that this code can be improved slightly. Will do if I retouch:\r\n\r\n```diff\r\n--- a/src/cluster_linearize.h\r\n+++ b/src/cluster_linearize.h\r\n@@ -668,27 +668,22 @@ public:\r\n      */\r\n     SearchCandidateFinder(const DepGraph<SetType>& depgraph, uint64_t rng_seed) noexcept :\r\n         m_rng(rng_seed),\r\n-        m_sorted_to_original(depgraph.PositionRange()),\r\n+        m_sorted_to_original(depgraph.TxCount()),\r\n         m_original_to_sorted(depgraph.PositionRange())\r\n     {\r\n         // Determine reordering mapping, by sorting by decreasing feerate. All unused positions\r\n         // are placed at the end.\r\n-        ClusterIndex good_pos{0}, bad_pos{depgraph.PositionRange()};\r\n-        for (ClusterIndex i = 0; i < depgraph.PositionRange(); ++i) {\r\n-            if (depgraph.Positions()[i]) {\r\n-                m_sorted_to_original[good_pos++] = i;\r\n-            } else {\r\n-                m_sorted_to_original[--bad_pos] = i;\r\n-            }\r\n+        ClusterIndex good_pos{0};\r\n+        for (auto i : depgraph.Positions()) {\r\n+            m_sorted_to_original[good_pos++] = i;\r\n         }\r\n-        Assume(good_pos == bad_pos);\r\n         std::sort(m_sorted_to_original.begin(), m_sorted_to_original.begin() + good_pos, [&](auto a, auto b) {\r\n             auto feerate_cmp = depgraph.FeeRate(a) <=> depgraph.FeeRate(b);\r\n             if (feerate_cmp == 0) return a < b;\r\n             return feerate_cmp > 0;\r\n         });\r\n         // Compute reverse mapping.\r\n-        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\r\n+        for (ClusterIndex i = 0; i < good_pos; ++i) {\r\n             m_original_to_sorted[m_sorted_to_original[i]] = i;\r\n         }\r\n         // Compute reordered dependency graph.\r\n```",
      "created_at": "2024-10-01T18:42:05Z",
      "updated_at": "2024-10-01T18:43:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1783331508",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783331508"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 687,
      "original_line": 687,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783333542",
      "pull_request_review_id": 2341136380,
      "id": 1783333542,
      "node_id": "PRRC_kwDOABII585qS4Km",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);\n+                        break;\n+                    }\n+                    --diff;\n+                }\n             }\n-            reordering.push_back(total_size++ - diff);\n             // Stop if a read error was encountered during deserialization.\n             if (read_error) break;\n         }\n \n         // Construct the original cluster order depgraph.\n-        depgraph = DepGraph(topo_depgraph, reordering);\n+        depgraph = DepGraph(topo_depgraph, reordering, total_size);\n     }\n };\n \n /** Perform a sanity/consistency check on a DepGraph. */\n template<typename SetType>\n void SanityCheck(const DepGraph<SetType>& depgraph)\n {\n+    // Verify Positions and PositionRange consistency.\n+    ClusterIndex num_positions{0};\n+    ClusterIndex position_range{0};\n+    for (ClusterIndex i : depgraph.Positions()) {\n+        ++num_positions;\n+        position_range = std::max(position_range, i + 1);",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 172,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1783263904,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, will do if I retouch.",
      "created_at": "2024-10-01T18:44:06Z",
      "updated_at": "2024-10-01T18:44:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1783333542",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1783333542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 305,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790049084",
      "pull_request_review_id": 2351684992,
      "id": 1790049084,
      "node_id": "PRRC_kwDOABII585qsfs8",
      "diff_hunk": "@@ -284,6 +298,31 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         reader >> Using<DepGraphFormatter>(decoded_depgraph);\n         assert(depgraph == decoded_depgraph);\n         assert(reader.empty());\n+\n+        // In acyclic graphs, the union of parents with parents of parents etc. yields the\n+        // full ancestor set (and similar for children and descendants).\n+        std::vector<SetType> parents, children;\n+        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+            parents.push_back(depgraph.GetReducedParents(i));\n+            children.push_back(depgraph.GetReducedChildren(i));\n+        }\n+        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+            SetType par_union = SetType::Singleton(i);\n+            while (true) {\n+                SetType old = par_union;\n+                for (auto j : par_union) par_union |= parents[j];\n+                if (old == par_union) break;\n+            }\n+            assert(par_union == depgraph.Ancestors(i));\n+\n+            SetType chl_union = SetType::Singleton(i);\n+            while (true) {\n+                SetType old = chl_union;\n+                for (auto j : chl_union) chl_union |= children[j];\n+                if (old == chl_union) break;\n+            }\n+            assert(chl_union == depgraph.Descendants(i));\n+        }",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 53,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "57244eb52d13117e64575f6e07da10f5ea4d5bf5",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: This loop can be modified to be more readable by using using descriptive variable names and some helpful comment on what the inner loops are doing.\r\n```suggestion\r\n        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\r\n            // Initialize the set of ancestors with just the current transaction itself.\r\n            SetType ancestor_union = SetType::Singleton(i);\r\n            // Iteratively add parents and parents of parents to the ancestor set until there is no more ancestor to add.\r\n            while (true) {\r\n                SetType old_ancestor_union = ancestor_union;\r\n                for (auto ancestor: ancestor_union) {\r\n                    ancestor_union |= parents[ancestor];\r\n                }\r\n                // exit when new ancestor was not added\r\n                if (old_ancestor_union == ancestor_union) break;\r\n            }\r\n            assert(ancestor_union == depgraph.Ancestors(i));\r\n\r\n            // Initialize the set of descendants with just the current transaction itself.\r\n            SetType descendant_union = SetType::Singleton(i);\r\n            // Iteratively add children and children of children to the descendant set until there is no more to add.\r\n            while (true) {\r\n                SetType old_descendant_union = descendant_union;\r\n                for (auto descendant: descendant_union) {\r\n                    descendant_union |= children[descendant];\r\n                }\r\n                // exit when no new descendant was added\r\n                if (old_descendant_union == descendant_union) break;\r\n            }\r\n            assert(descendant_union == depgraph.Descendants(i));\r\n        }\r\n```",
      "created_at": "2024-10-07T11:32:07Z",
      "updated_at": "2024-10-07T15:33:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790049084",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790049084"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 309,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790355464",
      "pull_request_review_id": 2351684992,
      "id": 1790355464,
      "node_id": "PRRC_kwDOABII585qtqgI",
      "diff_hunk": "@@ -97,24 +109,50 @@ class DepGraph\n     }\n \n     /** Construct a DepGraph object given another DepGraph and a mapping from old to new.\n+     *\n+     * @param depgraph   The original DepGraph that is being remapped.\n+     *\n+     * @param mapping    A vector, such that mapping[i] gives the position in the new DepGraph",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 37,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit maybe  calling `mapping` a container will be better.\r\n```suggestion\r\n      *@param mapping A container, such that mapping[i] gives the position in the new DepGraph\r\n```",
      "created_at": "2024-10-07T14:37:46Z",
      "updated_at": "2024-10-07T15:33:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790355464",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790355464"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790464732",
      "pull_request_review_id": 2352323652,
      "id": 1790464732,
      "node_id": "PRRC_kwDOABII585quFLc",
      "diff_hunk": "@@ -184,6 +184,48 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This returns the minimal subset of the parents of i whose ancestors together equal all of\n+     * i's ancestors (unless i is part of a cycle of dependencies). Note that DepGraph does not\n+     * store the actual set of parents.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 8,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "57244eb52d13117e64575f6e07da10f5ea4d5bf5",
      "in_reply_to_id": null,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit: can go further with the explanation in the comments with something like\r\n\r\n```suggestion\r\n     * i's ancestors (unless i is part of a cycle of dependencies). Note that DepGraph does not\r\n     * store set of parents; it has to be reduced from ancestor set.\r\n```\r\n\r\nfor both the parent and child reducing methods.",
      "created_at": "2024-10-07T15:40:22Z",
      "updated_at": "2024-10-07T15:41:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790464732",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790464732"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 190,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 191,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790645774",
      "pull_request_review_id": 2352591145,
      "id": 1790645774,
      "node_id": "PRRC_kwDOABII585quxYO",
      "diff_hunk": "@@ -649,7 +729,8 @@ class SearchCandidateFinder\n             m_original_to_sorted[m_sorted_to_original[i]] = i;",
      "path": "src/cluster_linearize.h",
      "position": 339,
      "original_position": 204,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1783088965,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have incorporated this change.",
      "created_at": "2024-10-07T17:51:02Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790645774",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790645774"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 687,
      "original_line": 687,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790647190",
      "pull_request_review_id": 2352591145,
      "id": 1790647190,
      "node_id": "PRRC_kwDOABII585quxuW",
      "diff_hunk": "@@ -184,6 +184,48 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This returns the minimal subset of the parents of i whose ancestors together equal all of\n+     * i's ancestors (unless i is part of a cycle of dependencies). Note that DepGraph does not\n+     * store the actual set of parents.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 8,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "57244eb52d13117e64575f6e07da10f5ea4d5bf5",
      "in_reply_to_id": 1790464732,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have phrased it as \"this information has to be inferred from the ancestor sets\" (and similar for `GetReducedChildren`).",
      "created_at": "2024-10-07T17:52:09Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790647190",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790647190"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 190,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 191,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790648128",
      "pull_request_review_id": 2352591145,
      "id": 1790648128,
      "node_id": "PRRC_kwDOABII585qux9A",
      "diff_hunk": "@@ -97,24 +109,50 @@ class DepGraph\n     }\n \n     /** Construct a DepGraph object given another DepGraph and a mapping from old to new.\n+     *\n+     * @param depgraph   The original DepGraph that is being remapped.\n+     *\n+     * @param mapping    A vector, such that mapping[i] gives the position in the new DepGraph",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 37,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1790355464,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I wouldn't call a Span a container; I have changed it to just saying \"A Span such that ...\".",
      "created_at": "2024-10-07T17:52:55Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790648128",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790648128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790648786",
      "pull_request_review_id": 2352591145,
      "id": 1790648786,
      "node_id": "PRRC_kwDOABII585quyHS",
      "diff_hunk": "@@ -284,6 +298,31 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         reader >> Using<DepGraphFormatter>(decoded_depgraph);\n         assert(depgraph == decoded_depgraph);\n         assert(reader.empty());\n+\n+        // In acyclic graphs, the union of parents with parents of parents etc. yields the\n+        // full ancestor set (and similar for children and descendants).\n+        std::vector<SetType> parents, children;\n+        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+            parents.push_back(depgraph.GetReducedParents(i));\n+            children.push_back(depgraph.GetReducedChildren(i));\n+        }\n+        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+            SetType par_union = SetType::Singleton(i);\n+            while (true) {\n+                SetType old = par_union;\n+                for (auto j : par_union) par_union |= parents[j];\n+                if (old == par_union) break;\n+            }\n+            assert(par_union == depgraph.Ancestors(i));\n+\n+            SetType chl_union = SetType::Singleton(i);\n+            while (true) {\n+                SetType old = chl_union;\n+                for (auto j : chl_union) chl_union |= children[j];\n+                if (old == chl_union) break;\n+            }\n+            assert(chl_union == depgraph.Descendants(i));\n+        }",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 53,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "57244eb52d13117e64575f6e07da10f5ea4d5bf5",
      "in_reply_to_id": 1790049084,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done, with a few changes.",
      "created_at": "2024-10-07T17:53:26Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790648786",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790648786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 309,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 325,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790649002",
      "pull_request_review_id": 2352591145,
      "id": 1790649002,
      "node_id": "PRRC_kwDOABII585quyKq",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);\n+                        break;\n+                    }\n+                    --diff;\n+                }\n             }\n-            reordering.push_back(total_size++ - diff);\n             // Stop if a read error was encountered during deserialization.\n             if (read_error) break;\n         }\n \n         // Construct the original cluster order depgraph.\n-        depgraph = DepGraph(topo_depgraph, reordering);\n+        depgraph = DepGraph(topo_depgraph, reordering, total_size);\n     }\n };\n \n /** Perform a sanity/consistency check on a DepGraph. */\n template<typename SetType>\n void SanityCheck(const DepGraph<SetType>& depgraph)\n {\n+    // Verify Positions and PositionRange consistency.\n+    ClusterIndex num_positions{0};\n+    ClusterIndex position_range{0};\n+    for (ClusterIndex i : depgraph.Positions()) {\n+        ++num_positions;\n+        position_range = std::max(position_range, i + 1);",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 172,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1783263904,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-10-07T17:53:36Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790649002",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790649002"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 305,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790649176",
      "pull_request_review_id": 2352591145,
      "id": 1790649176,
      "node_id": "PRRC_kwDOABII585quyNY",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 24,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "4f5916f95607fe893512bfa91f2aa1affa4f4aeb",
      "in_reply_to_id": 1769600192,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-10-07T17:53:43Z",
      "updated_at": "2024-10-07T17:53:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790649176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790649176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790656735",
      "pull_request_review_id": 2352607804,
      "id": 1790656735,
      "node_id": "PRRC_kwDOABII585qu0Df",
      "diff_hunk": "@@ -97,24 +109,50 @@ class DepGraph\n     }\n \n     /** Construct a DepGraph object given another DepGraph and a mapping from old to new.\n+     *\n+     * @param depgraph   The original DepGraph that is being remapped.\n+     *\n+     * @param mapping    A vector, such that mapping[i] gives the position in the new DepGraph",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 37,
      "commit_id": "0b3ec8c59b2b6d598531cd4e688eb276e597c825",
      "original_commit_id": "8f44c6a1f8b69cd9f9381eff41e88aef5d8963f7",
      "in_reply_to_id": 1790355464,
      "user": {
        "login": "ismaelsadeeq",
        "id": 48946461,
        "node_id": "MDQ6VXNlcjQ4OTQ2NDYx",
        "avatar_url": "https://avatars.githubusercontent.com/u/48946461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ismaelsadeeq",
        "html_url": "https://github.com/ismaelsadeeq",
        "followers_url": "https://api.github.com/users/ismaelsadeeq/followers",
        "following_url": "https://api.github.com/users/ismaelsadeeq/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ismaelsadeeq/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ismaelsadeeq/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ismaelsadeeq/subscriptions",
        "organizations_url": "https://api.github.com/users/ismaelsadeeq/orgs",
        "repos_url": "https://api.github.com/users/ismaelsadeeq/repos",
        "events_url": "https://api.github.com/users/ismaelsadeeq/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ismaelsadeeq/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "much better ðŸ‘ðŸ¾ ",
      "created_at": "2024-10-07T17:59:47Z",
      "updated_at": "2024-10-07T17:59:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1790656735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1790656735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 115,
      "side": "RIGHT"
    }
  ]
}
{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857",
    "id": 2062194875,
    "node_id": "PR_kwDOABII58566pi7",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30857",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30857.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30857.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
    "number": 30857,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "cluster mempool: extend DepGraph functionality",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Part of cluster mempool: #30289 \r\n\r\nThis adds:\r\n* `DepGraph::AddDependencies` to add 0 or more dependencies to a single transaction at once (identical to calling `DepGraph::AddDependency` once for each, but more efficient).\r\n* `DepGraph::RemoveTransactions` to remove 0 or more transactions from a depgraph.\r\n* `DepGraph::GetReducedParents` (and `DepGraph::GetReducedChildren`) to get the (reduced) direct parents and children of a transaction in a depgraph.\r\n\r\nThis is the result of fleshing out the design for the \"intermediate layer\" (\"TxGraph\", no PR yet) between the cluster linearization layer and the mempool layer. My earlier thinking was that TxGraph would store `Cluster` objects (vectors of pairs of `FeeFrac`s and sets of parents), and convert them to `DepGraph` on the fly whenever needed. However, after more consideration, it seems better to have TxGraph store `DepGraph` objects, and manipulate them directly without constantly re-creating them. This requires `DepGraph` to have some additional functionality.\r\n\r\nThe bulk of the complexity here is the addition of `DepGraph::RemoveTransactions`, which leaves the remaining transactions' positions within the `DepGraph` untouched (we want existing identifiers to remain valid), so this implies that graphs can now have \"holes\" (positions that are unused, but followed by positions that are used). To enable that, an extension of the fuzz/test serialization format `DepGraphFormatter` is included to deal with such holes.\r\n",
    "labels": [
      {
        "id": 241832923,
        "node_id": "MDU6TGFiZWwyNDE4MzI5MjM=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Utils/log/libs",
        "name": "Utils/log/libs",
        "description": "",
        "color": "5319e7",
        "default": false
      }
    ],
    "created_at": "2024-09-10T00:48:24Z",
    "updated_at": "2024-09-18T22:13:53Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "de39fca191e1ff02b566218117f13575d1555512",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "sipa:202409_clusterlin_partialdep",
      "ref": "202409_clusterlin_partialdep",
      "sha": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "repo": {
        "id": 1458655,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDU4NjU1",
        "name": "bitcoin",
        "full_name": "sipa/bitcoin",
        "owner": {
          "login": "sipa",
          "id": 548488,
          "node_id": "MDQ6VXNlcjU0ODQ4OA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/sipa",
          "html_url": "https://github.com/sipa",
          "followers_url": "https://api.github.com/users/sipa/followers",
          "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
          "organizations_url": "https://api.github.com/users/sipa/orgs",
          "repos_url": "https://api.github.com/users/sipa/repos",
          "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/sipa/received_events",
          "type": "User",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/sipa/bitcoin",
        "description": "Bitcoin integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/sipa/bitcoin",
        "archive_url": "https://api.github.com/repos/sipa/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/sipa/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/sipa/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/sipa/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/sipa/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/sipa/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/sipa/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/sipa/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/sipa/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/sipa/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/sipa/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/sipa/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/sipa/bitcoin/events",
        "forks_url": "https://api.github.com/repos/sipa/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/sipa/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/sipa/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/sipa/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/sipa/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/sipa/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/sipa/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/sipa/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/sipa/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/sipa/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/sipa/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/sipa/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/sipa/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/sipa/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/sipa/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/sipa/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:sipa/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/sipa/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/sipa/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/sipa/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/sipa/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/sipa/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/sipa/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/sipa/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/sipa/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/sipa/bitcoin/hooks",
        "svn_url": "https://github.com/sipa/bitcoin",
        "homepage": "http://www.bitcoin.org",
        "language": "TypeScript",
        "forks_count": 21,
        "stargazers_count": 87,
        "watchers_count": 87,
        "size": 248419,
        "default_branch": "lows",
        "open_issues_count": 16,
        "is_template": false,
        "topics": [],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-18T22:07:19Z",
        "created_at": "2011-03-09T10:46:59Z",
        "updated_at": "2024-08-21T16:21:35Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ab0b5706b254ed914f94b41940a946d84ac8dd6d",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36168,
        "stargazers_count": 78445,
        "watchers_count": 78445,
        "size": 268804,
        "default_branch": "master",
        "open_issues_count": 650,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2024-09-18T17:44:05Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2024-09-18T22:14:10Z",
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 528,
    "deletions": 183,
    "changed_files": 8,
    "commits": 6,
    "review_comments": 50,
    "comments": 10
  },
  "events": [
    {
      "event": "commented",
      "id": 2339398769,
      "node_id": "IC_kwDOABII586LcGRx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339398769",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T00:48:28Z",
      "updated_at": "2024-09-17T17:49:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30857).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30605](https://github.com/bitcoin/bitcoin/pull/30605) (Cluster linearization: separate tests from tests-of-tests by sipa)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2339398769",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "renamed",
      "id": 14191046506,
      "node_id": "RTE_lADOABII586V6oyBzwAAAANN2i9q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191046506",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T00:49:35Z",
      "rename": {
        "from": "cluster mempool: extend DepGraph (multiple dependencies, removing transactions, parents/children)",
        "to": "cluster mempool: extend DepGraph functionality"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14191287393,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANN3dxh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191287393",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:32:52Z"
    },
    {
      "event": "labeled",
      "id": 14191290614,
      "node_id": "LE_lADOABII586V6oyBzwAAAANN3ej2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191290614",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:33:21Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2339436509,
      "node_id": "IC_kwDOABII586LcPfd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339436509",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:33:22Z",
      "updated_at": "2024-09-10T01:33:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/29906098019</sub>\n\n<details><summary>Hints</summary>\n\nMake sure to run all tests locally, according to the documentation.\n\nThe failure may happen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2339436509",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14191334981,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANN3pZF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14191334981",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T01:40:44Z"
    },
    {
      "event": "commented",
      "id": 2340618396,
      "node_id": "IC_kwDOABII586LgwCc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340618396",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:39:36Z",
      "updated_at": "2024-09-10T12:39:36Z",
      "author_association": "MEMBER",
      "body": "https://cirrus-ci.com/task/4580438562308096?logs=ci#L1723\r\n```bash\r\nRun clusterlin_ancestor_finder with args ['/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz', '-runs=1', PosixPath('/ci_container_base/ci/scratch/qa-assets/fuzz_corpora/clusterlin_ancestor_finder')]INFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 2205311796\r\nINFO: Loaded 1 modules   (615399 inline 8-bit counters): 615399 [0x55b1778f3be8, 0x55b177989fcf), \r\nINFO: Loaded 1 PC tables (615399 PCs): 615399 [0x55b177989fd0,0x55b1782ede40), \r\nINFO:       57 files found in /ci_container_base/ci/scratch/qa-assets/fuzz_corpora/clusterlin_ancestor_finder\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes\r\nINFO: seed corpus: files: 57 min: 1b max: 516b total: 4662b rss: 111Mb\r\n/ci_container_base/src/test/util/cluster_linearize.h:242:29: runtime error: unsigned integer overflow: 0 - 1 cannot be represented in type 'ClusterIndex' (aka 'unsigned int')\r\n    #0 0x55b17470e4e4 in void (anonymous namespace)::DepGraphFormatter::Unser<SpanReader, bitset_detail::IntBitSet<unsigned int>>(SpanReader&, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&)::'lambda'(unsigned int)::operator()(unsigned int) const ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/util/cluster_linearize.h:242:29\r\n    #1 0x55b1746e5efa in void (anonymous namespace)::DepGraphFormatter::Unser<SpanReader, bitset_detail::IntBitSet<unsigned int>>(SpanReader&, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/util/cluster_linearize.h:268:17\r\n    #2 0x55b1746e5efa in void Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>::Unserialize<SpanReader>(SpanReader&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/serialize.h:481:73\r\n    #3 0x55b1746e5efa in void Unserialize<SpanReader, Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>&>(T&, T0&&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/serialize.h:761:7\r\n    #4 0x55b1746e5efa in SpanReader& SpanReader::operator>><Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>>(Wrapper<(anonymous namespace)::DepGraphFormatter, cluster_linearize::DepGraph<bitset_detail::IntBitSet<unsigned int>>&>&&) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/streams.h:114:9\r\n    #5 0x55b1746eb7c4 in clusterlin_ancestor_finder_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>) ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/./src/test/fuzz/cluster_linearize.cpp:454:16\r\n    #6 0x55b174d1203d in std::function<void (std::span<unsigned char const, 18446744073709551615ul>)>::operator()(std::span<unsigned char const, 18446744073709551615ul>) const /usr/bin/../lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\r\n    #7 0x55b174d1203d in LLVMFuzzerTestOneInput ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/util/./src/test/fuzz/fuzz.cpp:209:5\r\n    #8 0x55b1743ee834 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcb834) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #9 0x55b1743edf29 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcaf29) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #10 0x55b1743efb46 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bccb46) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #11 0x55b1743f0057 in fuzzer::Fuzzer::Loop(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bcd057) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #12 0x55b1743dd54f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1bba54f) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #13 0x55b174407bd6 in main (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1be4bd6) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n    #14 0x7fe0a47af1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 6d64b17fbac799e68da7ebd9985ddf9b5cb375e6)\r\n    #15 0x7fe0a47af28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 6d64b17fbac799e68da7ebd9985ddf9b5cb375e6)\r\n    #16 0x55b1743d2534 in _start (/ci_container_base/ci/scratch/build-x86_64-pc-linux-gnu/src/test/fuzz/fuzz+0x1baf534) (BuildId: c3b4f6b7a5dfbb78ebde90aae8831e87214c3cf3)\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: unsigned-integer-overflow /ci_container_base/src/test/util/cluster_linearize.h:242:29 \r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0xa,0x7e,0x7e,0x7e,0x3,0x0,0x7e,0x7e,0x7e,0x0,0x8,0x0,0x3f,\r\n\\012~~~\\003\\000~~~\\000\\010\\000?\r\nartifact_prefix='./'; Test unit written to ./crash-8c0d970971a66a2d84b05f68d2956932fb44a077\r\nBase64: Cn5+fgMAfn5+AAgAPw==\r\n```\r\nThe previous releases failure is unrelated.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2340618396",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14198329681,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANOSVFR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198329681",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:47:57Z"
    },
    {
      "event": "commented",
      "id": 2340661923,
      "node_id": "IC_kwDOABII586Lg6qj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340661923",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:46Z",
      "updated_at": "2024-09-10T15:50:09Z",
      "author_association": "MEMBER",
      "body": "@fanquake Thanks! Fixed, I think.\r\n\r\nEDIT: Narrator: it wasn't.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2340661923",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14198399702,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOSmLW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198399702",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:47Z"
    },
    {
      "event": "subscribed",
      "id": 14198399724,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOSmLs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14198399724",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T12:52:47Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14200682889,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANObTmJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14200682889",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T15:07:21Z"
    },
    {
      "event": "commented",
      "id": 2341427105,
      "node_id": "IC_kwDOABII586Lj1eh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2341427105",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T16:27:36Z",
      "updated_at": "2024-09-10T16:28:01Z",
      "author_association": "MEMBER",
      "body": "I'm going to hold off reviewing this until I see the TxGraph PR(dirty draft ok) to better understand its intended usage. :+1: ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2341427105",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "commented",
      "id": 2341522716,
      "node_id": "IC_kwDOABII586LkM0c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2341522716",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:10Z",
      "updated_at": "2024-09-10T17:23:30Z",
      "author_association": "MEMBER",
      "body": "@instagibbs Sure.\r\n\r\nTo give a bit more background, my idea to store things in `Cluster` form and convert to `DepGraph`, was due to a (mistaken) belief that incremental changes to a `DepGraph` would be $\\mathcal{O}(n)$ per-dependency, meaning $\\mathcal{O}(n^2)$ per-transaction, and thus potentially $\\mathcal{O}(n^3)$ for a full $n$ transactions.\r\n\r\n@sdaftuar pointed out the possibility of an $\\mathcal{O}(n)$ per-transaction algorithm, or $\\mathcal{O}(n^2)$ for $n$ transactions, implemented in this PR as `DepGraph::AddDependencies`. As that's equal in complexity to the current bulk `Cluster`->`DepGraph` conversion, there is little reason left to prefer that bulk conversion algorithm, and leaving things in `DepGraph` form means the same module can be used for more purposes (e.g. computing a transaction's ancestry, as it's literally precomputed already inside `DepGraph`).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2341522716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14202521834,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOiUjq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521834",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:11Z"
    },
    {
      "event": "subscribed",
      "id": 14202521844,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOiUj0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521844",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:11Z"
    },
    {
      "event": "mentioned",
      "id": 14202521857,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANOiUkB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521857",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:12Z"
    },
    {
      "event": "subscribed",
      "id": 14202521868,
      "node_id": "SE_lADOABII586V6oyBzwAAAANOiUkM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14202521868",
      "actor": {
        "login": "sdaftuar",
        "id": 7463573,
        "node_id": "MDQ6VXNlcjc0NjM1NzM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sdaftuar",
        "html_url": "https://github.com/sdaftuar",
        "followers_url": "https://api.github.com/users/sdaftuar/followers",
        "following_url": "https://api.github.com/users/sdaftuar/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sdaftuar/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sdaftuar/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
        "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
        "repos_url": "https://api.github.com/users/sdaftuar/repos",
        "events_url": "https://api.github.com/users/sdaftuar/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T17:14:12Z"
    },
    {
      "event": "labeled",
      "id": 14205522396,
      "node_id": "LE_lADOABII586V6oyBzwAAAANOtxHc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14205522396",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T20:49:01Z",
      "label": {
        "name": "Utils/log/libs",
        "color": "5319e7"
      }
    },
    {
      "event": "unlabeled",
      "id": 14219425937,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANPiziR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14219425937",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-11T16:41:25Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 14277971026,
      "node_id": "LE_lADOABII586V6oyBzwAAAANTCIxS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14277971026",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T18:35:56Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14280914033,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANTNXRx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14280914033",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:43:49Z"
    },
    {
      "event": "commented",
      "id": 2353995596,
      "node_id": "IC_kwDOABII586MTx9M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2353995596",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:44:13Z",
      "updated_at": "2024-09-16T20:44:13Z",
      "author_association": "MEMBER",
      "body": "Rebased after merge of #30286.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2353995596",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "unlabeled",
      "id": 14281082726,
      "node_id": "UNLE_lADOABII586V6oyBzwAAAANTOAdm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14281082726",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-16T20:57:30Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14291019637,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANTz6d1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14291019637",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T13:02:30Z"
    },
    {
      "event": "reviewed",
      "id": 2306885844,
      "node_id": "PRR_kwDOABII586JgEjU",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "First run through.\r\n\r\nsuggestion for clusterlin_add_dependencies harness: https://github.com/instagibbs/bitcoin/commit/c5c44da5a0a630a6725ca85e90e4c67b2eb1f8bc\r\n\r\nI think this gets similar or better coverage and is easier for me to understand? (alternatively, take an extra bit and use that as decision bit to batch or individually add, and have the other depgraph do the opposite?)\r\n\r\nedit: ah, I'm hodling it wrong! Deleted question.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2306885844",
      "submitted_at": "2024-09-17T17:13:20Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2310464388,
      "node_id": "PRR_kwDOABII586JtuOE",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "it's likely the wrong place for the coverage, but I added some coverage for iterative additional and removal of transactions. Take what you think is useful if any:\r\n\r\n```\r\ndiff --git a/src/test/fuzz/cluster_linearize.cpp b/src/test/fuzz/cluster_linearize.cpp\r\nindex be06898a6e..62b5ec2343 100644\r\n--- a/src/test/fuzz/cluster_linearize.cpp\r\n+++ b/src/test/fuzz/cluster_linearize.cpp\r\n@@ -1,19 +1,20 @@\r\n // Copyright (c) The Bitcoin Core developers\r\n // Distributed under the MIT software license, see the accompanying\r\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n \r\n #include <cluster_linearize.h>\r\n #include <serialize.h>\r\n #include <streams.h>\r\n #include <test/fuzz/fuzz.h>\r\n #include <test/fuzz/FuzzedDataProvider.h>\r\n+#include <test/fuzz/util.h>\r\n #include <test/util/cluster_linearize.h>\r\n #include <util/bitset.h>\r\n #include <util/feefrac.h>\r\n \r\n #include <algorithm>\r\n #include <stdint.h>\r\n #include <vector>\r\n #include <utility>\r\n \r\n using namespace cluster_linearize;\r\n@@ -308,30 +309,89 @@ FUZZ_TARGET(clusterlin_cluster_serialization)\r\n             if (i == j) continue;\r\n             if (provider.ConsumeBool()) cluster[i].second.Set(j);\r\n         }\r\n     }\r\n \r\n     // Construct dependency graph, and verify it matches the cluster (which includes a round-trip\r\n     // check for the serialization).\r\n     DepGraph depgraph(cluster);\r\n     VerifyDepGraphFromCluster(cluster, depgraph);\r\n \r\n+    // Copy to store deleted information\r\n+    DepGraph depgraph_copy(depgraph);\r\n+\r\n     // Remove an arbitrary subset (in order to construct a graph with holes) and verify that it\r\n     // still sanity checks (incl. round-tripping serialization).\r\n     uint64_t del = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);\r\n     TestBitSet setdel;\r\n     for (ClusterIndex i : depgraph.Positions()) {\r\n         if (del & 1) setdel.Set(i);\r\n         del >>= 1;\r\n     }\r\n+    assert(del == 0);\r\n+\r\n     depgraph.RemoveTransactions(setdel);\r\n     SanityCheck(depgraph);\r\n+\r\n+    FastRandomContext rng{ConsumeUInt256(provider)};\r\n+\r\n+    // Arbitary addition or removal order for transactions we're deleting\r\n+    std::vector<ClusterIndex> del_indexes;\r\n+    for (const auto del_index : setdel) {\r\n+        del_indexes.push_back(del_index);\r\n+    }\r\n+\r\n+    // Tracks deletion index vs re-addition index for dependency re-addition\r\n+    std::map<ClusterIndex, ClusterIndex> map_del_add_index;\r\n+\r\n+    // Re-add everything back in; should not fail sanity checks\r\n+    // But this will have transactions \"out of order\" and missing\r\n+    // connections from children to previously deleted ancestors.\r\n+    std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+    for (ClusterIndex del_index : del_indexes) {\r\n+        const auto add_index{depgraph.AddTransaction(depgraph_copy.FeeRate(del_index))};\r\n+        map_del_add_index[del_index] = add_index;\r\n+    }\r\n+\r\n+    std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+    for (ClusterIndex del_index : del_indexes) {\r\n+       depgraph.AddDependencies(depgraph_copy.Ancestors(del_index), map_del_add_index[del_index]);\r\n+    }\r\n+\r\n+    SanityCheck(depgraph);\r\n+\r\n+    // But if we repeat this N times, we should get identical depgraphs\r\n+    for (int i = 0; i < provider.ConsumeIntegralInRange<int>(1, 5); ++i) {\r\n+        depgraph_copy = depgraph;\r\n+        // Batch removal or shuffled iterated removal\r\n+        if (provider.ConsumeBool()) {\r\n+            depgraph.RemoveTransactions(setdel);\r\n+        } else {\r\n+            std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+            for (const auto del_index : del_indexes) {\r\n+                depgraph.RemoveTransactions(TestBitSet::Singleton(del_index));\r\n+            }\r\n+        }\r\n+        SanityCheck(depgraph);\r\n+\r\n+        std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+        map_del_add_index.clear();\r\n+        for (ClusterIndex del_index : setdel) {\r\n+            const auto add_index{depgraph.AddTransaction(depgraph_copy.FeeRate(del_index))};\r\n+            map_del_add_index[del_index] = add_index;\r\n+        }\r\n+        std::shuffle(del_indexes.begin(), del_indexes.end(), rng);\r\n+        for (ClusterIndex del_index : setdel) {\r\n+            depgraph.AddDependencies(depgraph_copy.Ancestors(del_index), map_del_add_index[del_index]);\r\n+        }\r\n+        assert(depgraph == depgraph_copy);\r\n+    }\r\n }\r\n \r\n FUZZ_TARGET(clusterlin_depgraph_serialization)\r\n {\r\n     // Verify that any deserialized depgraph is acyclic and roundtrips to an identical depgraph.\r\n \r\n     // Construct a graph by deserializing.\r\n     SpanReader reader(buffer);\r\n     DepGraph<TestBitSet> depgraph;\r\n     try {\r\n```",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2310464388",
      "submitted_at": "2024-09-17T18:46:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "reviewed",
      "id": 2311366400,
      "node_id": "PRR_kwDOABII586JxKcA",
      "url": null,
      "actor": null,
      "commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2311366400",
      "submitted_at": "2024-09-17T23:57:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "commented",
      "id": 2357254842,
      "node_id": "IC_kwDOABII586MgNq6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2357254842",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:02Z",
      "updated_at": "2024-09-18T00:32:02Z",
      "author_association": "MEMBER",
      "body": "@glozow It's already used in two places in this PR.\n\nMaybe I should clarify in the PR description that this is just a generic utility feature, not something the next layer up will need per se (AFAIK). But because I was introducing a second place where it's invoked, and it's already used somewhere in the test, I felt it made sense to turn it into a proper DepGraph function, with proper tests.\n\n",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2357254842",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "mentioned",
      "id": 14299735359,
      "node_id": "MEE_lADOABII586V6oyBzwAAAANUVKU_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14299735359",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:03Z"
    },
    {
      "event": "subscribed",
      "id": 14299735363,
      "node_id": "SE_lADOABII586V6oyBzwAAAANUVKVD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14299735363",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:32:03Z"
    },
    {
      "event": "commented",
      "id": 2357265641,
      "node_id": "IC_kwDOABII586MgQTp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2357265641",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T00:44:37Z",
      "updated_at": "2024-09-18T00:44:37Z",
      "author_association": "MEMBER",
      "body": "Sorry, I don't know how I missed the calls within this PR :facepalm: I think I was grepping only on the first commit.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2357265641",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14311464205,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVB50N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14311464205",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T17:44:27Z"
    },
    {
      "event": "reviewed",
      "id": 2313371167,
      "node_id": "PRR_kwDOABII586J4z4f",
      "url": null,
      "actor": null,
      "commit_id": "4476915bc76b48eff9b5e67fd6bd7647cc12793f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "I addressed most of the feedback received. Thanks @instagibbs and @glozow!\r\n\r\nIn addition, the `DepGraphFormatter::Unser` logic was changed significantly. The result is simpler to follow I think (doesn't involve adding a transaction once and then undoing the insertion and redoing it once the position is known), and reduces the complexity from $\\mathcal{O}(n^3)$ to $\\mathcal{O}(n^2)$ in the process. For this, the commits were reordered, and their commit messages expanded to explain the rationale.\r\n\r\n@instagibbs I have added your testing of re-adding in `clusterlin_cluster_serialization` as a separate commit with some minor changes (mostly to keep the result efficient).",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313371167",
      "submitted_at": "2024-09-18T17:58:34Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "commented",
      "id": 2359202120,
      "node_id": "IC_kwDOABII586MnpFI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2359202120",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T19:01:42Z",
      "updated_at": "2024-09-18T19:01:42Z",
      "author_association": "MEMBER",
      "body": "looked at `git range-diff master 9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d 4476915bc76b48eff9b5e67fd6bd7647cc12793f`\r\n\r\nLGTM, though I haven't re-validated the serializer, trusting the tests of tests. I want to think more about the fuzz targets to see if there are any other easy pickups in coverage.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#issuecomment-2359202120",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30857"
    },
    {
      "event": "reviewed",
      "id": 2313550404,
      "node_id": "PRR_kwDOABII586J5fpE",
      "url": null,
      "actor": null,
      "commit_id": "4476915bc76b48eff9b5e67fd6bd7647cc12793f",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313550404",
      "submitted_at": "2024-09-18T20:23:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQwMjI0MDE5Y2Q2ZTgyNTkxMTg0MTI1MjljNTU0ZDhiNGEyNjAxMzA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/40224019cd6e8259118412529c554d8b4a260130",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/40224019cd6e8259118412529c554d8b4a260130",
      "tree": {
        "sha": "1d002e5f2f47fcc398d11aa6273f4a2064851003",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1d002e5f2f47fcc398d11aa6273f4a2064851003"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ab0b5706b254ed914f94b41940a946d84ac8dd6d",
          "sha": "ab0b5706b254ed914f94b41940a946d84ac8dd6d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ab0b5706b254ed914f94b41940a946d84ac8dd6d"
        }
      ],
      "message": "clusterlin: Abstract out DepGraph::GetReduced{Parents,Children}\n\nA fuzz test already relies on these operations, and a future commit will need\nthe same logic too. Therefore, abstract them out into proper member functions,\nwith proper testing.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T20:30:55Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-06T19:32:48Z"
      },
      "sha": "40224019cd6e8259118412529c554d8b4a260130"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJjN2QzZjI2ODk0ZTdjNmJlYjFkYTUyZGIzODNiNmNiYjI4YzBmOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c7d3f26894e7c6beb1da52db383b6cbb28c0f95",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2c7d3f26894e7c6beb1da52db383b6cbb28c0f95",
      "tree": {
        "sha": "34b49c2d94085d06c2e6b20a5c4e0f326ca42ef6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/34b49c2d94085d06c2e6b20a5c4e0f326ca42ef6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/40224019cd6e8259118412529c554d8b4a260130",
          "sha": "40224019cd6e8259118412529c554d8b4a260130",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/40224019cd6e8259118412529c554d8b4a260130"
        }
      ],
      "message": "clusterlin: rework DepGraphFormatter::Unser\n\nThis commit does not change the serialization format. Its purpose is making a\nfew changes already in order to reduce the diff size of the later commit that\nintroduces support for holes in DepGraph.\n\nThe previous approach was to immediately construct a transaction as soon as its\nfeerate was known in a preliminary position, and then undo that, and place it\nin the correct position once the position information is known (such that a\ndeserialization error in between would not result in an inconsistent state).\n\nThe new approach is to delay the actual transaction creation until all its\ninformation is known, avoiding the need to undo and redo. This requires a\ndifferent means of determining whether dependencies are redundant, but that has\nthe advantage that a later commit can apply all dependencies at once, reducing\nthe complexity of deserialization.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T20:30:55Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-09T18:51:08Z"
      },
      "sha": "2c7d3f26894e7c6beb1da52db383b6cbb28c0f95"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY2N2FjZWM3M2IzOGQ2ZWExODM5ZGVkNzg4ODA5ZTMzZWU4MTdkZDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/667acec73b38d6ea1839ded788809e33ee817dd9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/667acec73b38d6ea1839ded788809e33ee817dd9",
      "tree": {
        "sha": "2b76d9defdaaa34e1fbc58694eb1b81a903fafdd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2b76d9defdaaa34e1fbc58694eb1b81a903fafdd"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c7d3f26894e7c6beb1da52db383b6cbb28c0f95",
          "sha": "2c7d3f26894e7c6beb1da52db383b6cbb28c0f95",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c7d3f26894e7c6beb1da52db383b6cbb28c0f95"
        }
      ],
      "message": "clusterlin: simplify DepGraphFormatter::Ser\n\nThis does not change the serialization format.\n\nIt turns out that it is unnecessary to keep track of the order of transactions\nin the so-far reconstructed DepGraph to decide how far from the end to insert\na new transaction.",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T20:30:56Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-08T21:42:25Z"
      },
      "sha": "667acec73b38d6ea1839ded788809e33ee817dd9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVhOGYwMTI5N2U4ZmE5NzZlYjMwNGQzZDk1M2VmZjQ2NWM4NjQwNzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea8f01297e8fa976eb304d3d953eff465c864071",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ea8f01297e8fa976eb304d3d953eff465c864071",
      "tree": {
        "sha": "add4ee94b9a28f6a6dfcd5f1983fd71ec8e9b191",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/add4ee94b9a28f6a6dfcd5f1983fd71ec8e9b191"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/667acec73b38d6ea1839ded788809e33ee817dd9",
          "sha": "667acec73b38d6ea1839ded788809e33ee817dd9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/667acec73b38d6ea1839ded788809e33ee817dd9"
        }
      ],
      "message": "clusterlin: Make DepGraph::AddDependency support multiple dependencies at once\n\nThis changes DepGraph::AddDependency into DepGraph::AddDependencies, which takes\nin a single child, but a set of parent transactions, making them all dependencies\nat once.\n\nThis is important for performance. N transactions can have O(N^2) parents combined,\nso constructing a full DepGraph using just AddDependency (which is O(N) on its own)\ncould take O(N^3) time, while doing the same with AddDependencies (also O(N) on its\nown) only takes O(N^2).\n\nNotably, this matters for DepGraphFormatter::Unser, which goes from O(N^3) to O(N^2).\n\nCo-Authored-By: Greg Sanders <gsanders87@gmail.com>",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T20:42:03Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-04T19:14:54Z"
      },
      "sha": "ea8f01297e8fa976eb304d3d953eff465c864071"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQyNDIzZWU0YTU5Mzg3MjNkYjQwMzc1M2JmY2ZkNWE0ZDg4N2UzZWQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2423ee4a5938723db403753bfcfd5a4d887e3ed",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d2423ee4a5938723db403753bfcfd5a4d887e3ed",
      "tree": {
        "sha": "75f93a2900582a5cfbf82e4d3f94546f40a88d89",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/75f93a2900582a5cfbf82e4d3f94546f40a88d89"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ea8f01297e8fa976eb304d3d953eff465c864071",
          "sha": "ea8f01297e8fa976eb304d3d953eff465c864071",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ea8f01297e8fa976eb304d3d953eff465c864071"
        }
      ],
      "message": "clusterlin: add DepGraph::RemoveTransactions and support for holes in DepGraph\n\nThis commits introduces support in DepGraph for the transaction positions to be\nnon-continuous. Specifically, it adds:\n* DepGraph::RemoveTransactions which removes 0 or more positions from a DepGraph.\n* DepGraph::Positions() to get a set of which positions are in use.\n* DepGraph::PositionRange() to get the highest used position in a DepGraph + 1.\n\nIn addition, it extends the DepGraphFormatter format to support holes in a\ncompatible way (it serializes non-holey DepGraphs identically to the old code,\nand deserializes them the same way)",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T21:41:32Z"
      },
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-09T19:12:15Z"
      },
      "sha": "d2423ee4a5938723db403753bfcfd5a4d887e3ed"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ1OGNiMWE1MmJhOTA5ZGJjNWFhZWNhZjNkNTM4NDIxYjNiOWNlN2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "tree": {
        "sha": "e55100b5d767d9ecf92470a113e8dac0bac226b6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e55100b5d767d9ecf92470a113e8dac0bac226b6"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2423ee4a5938723db403753bfcfd5a4d887e3ed",
          "sha": "d2423ee4a5938723db403753bfcfd5a4d887e3ed",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d2423ee4a5938723db403753bfcfd5a4d887e3ed"
        }
      ],
      "message": "clusterlin: test interleaved adding/removing\n\nCo-Authored-By: Pieter Wuille <pieter@wuille.net>",
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter@wuille.net",
        "date": "2024-09-18T22:06:37Z"
      },
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2024-09-18T17:43:35Z"
      },
      "sha": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 14314481748,
      "node_id": "HRFPE_lADOABII586V6oyBzwAAAANVNahU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14314481748",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-18T22:07:20Z"
    },
    {
      "event": "reviewed",
      "id": 2313906901,
      "node_id": "PRR_kwDOABII586J62rV",
      "url": null,
      "actor": null,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "@instagibbs I noticed that your extending of `clusterlin_cluster_serialization` makes the fuzz test ~10x slower (when sanitizers are enabled), and I don't understand why. ",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#pullrequestreview-2313906901",
      "submitted_at": "2024-09-18T22:13:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761301820",
      "pull_request_review_id": 2306885844,
      "id": 1761301820,
      "node_id": "PRRC_kwDOABII585o-1U8",
      "diff_hunk": "@@ -184,6 +184,46 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.",
      "path": "src/cluster_linearize.h",
      "position": 220,
      "original_position": 4,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "commit 77e07eba11391868f83db22bf2280e02b5a8cd78  \r\n\r\nadd a motivation for these additions in commit message?",
      "created_at": "2024-09-16T14:43:46Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761301820",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761301820"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348362",
      "pull_request_review_id": 2306885844,
      "id": 1761348362,
      "node_id": "PRRC_kwDOABII585o_AsK",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));\n+        }\n+        // Similar for children and descendants.\n+        for (auto child : children) {\n+            assert((depgraph.Descendants(child) & children).IsSubsetOf(SetType::Singleton(child)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 264,
      "original_position": 15,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "?\r\n```Suggestion\r\n            assert((depgraph.Descendants(child) & children) == SetType::Singleton(child));\r\n```",
      "created_at": "2024-09-16T15:10:08Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761348362",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348362"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 337,
      "original_line": 337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348880",
      "pull_request_review_id": 2306885844,
      "id": 1761348880,
      "node_id": "PRRC_kwDOABII585o_A0Q",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 260,
      "original_position": 11,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "?\r\n```Suggestion\r\n            assert((depgraph.Ancestors(parent) & parents) == SetType::Singleton(parent));\r\n```",
      "created_at": "2024-09-16T15:10:27Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761348880",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761348880"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761389984",
      "pull_request_review_id": 2306885844,
      "id": 1761389984,
      "node_id": "PRRC_kwDOABII585o_K2g",
      "diff_hunk": "@@ -86,57 +86,30 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=cluster.size().\n      */\n-    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : entries(cluster.size())\n+    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : DepGraph(cluster.size())\n     {\n         for (ClusterIndex i = 0; i < cluster.size(); ++i) {\n             // Fill in fee and size.\n             entries[i].feerate = cluster[i].first;\n-            // Fill in direct parents as ancestors.\n-            entries[i].ancestors = cluster[i].second;\n-            // Make sure transactions are ancestors of themselves.\n-            entries[i].ancestors.Set(i);\n-        }\n-\n-        // Propagate ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            // At this point, entries[a].ancestors[b] is true iff b is an ancestor of a and there\n-            // is a path from a to b through the subgraph consisting of {a, b} union\n-            // {0, 1, ..., (i-1)}.\n-            SetType to_merge = entries[i].ancestors;\n-            for (ClusterIndex j = 0; j < entries.size(); ++j) {\n-                if (entries[j].ancestors[i]) {\n-                    entries[j].ancestors |= to_merge;\n-                }\n-            }\n-        }\n-\n-        // Fill in descendant information by transposing the ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            for (auto j : entries[i].ancestors) {\n-                entries[j].descendants.Set(i);\n-            }\n+            // Fill in dependencies.",
      "path": "src/cluster_linearize.h",
      "position": 63,
      "original_position": 34,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit\r\n```Suggestion\r\n            // Fill in dependencies using direct parents.\r\n```",
      "created_at": "2024-09-16T15:35:42Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761389984",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761389984"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 106,
      "original_line": 106,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761406415",
      "pull_request_review_id": 2306885844,
      "id": 1761406415,
      "node_id": "PRRC_kwDOABII585o_O3P",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 81,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "nit\r\n```Suggestion\r\n        // Compute the ancestors of parents that are not already ancestors of child.\r\n```",
      "created_at": "2024-09-16T15:44:07Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761406415",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761406415"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761452737",
      "pull_request_review_id": 2306885844,
      "id": 1761452737,
      "node_id": "PRRC_kwDOABII585o_aLB",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 194,
      "original_position": 79,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "could use this in AddDependency as a one-liner?\r\n```\r\nAddDependencies(SetType::Singleton(parent), child);\r\n```",
      "created_at": "2024-09-16T16:15:53Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761452737",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761452737"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 214,
      "original_line": 214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761525176",
      "pull_request_review_id": 2306885844,
      "id": 1761525176,
      "node_id": "PRRC_kwDOABII585o_r24",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.\n+            // Emit N to indicate that many insertion choices are skipped.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 25,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "dde3959a24a12cd7ab37e772b55ae3c60a646528",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "dde3959a24a12cd7ab37e772b55ae3c60a646528\r\n\r\nno behavior change? would be good to say in commit message explicitly",
      "created_at": "2024-09-16T17:03:51Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761525176",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761525176"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761630898",
      "pull_request_review_id": 2306885844,
      "id": 1761630898,
      "node_id": "PRRC_kwDOABII585pAFqy",
      "diff_hunk": "@@ -57,9 +57,20 @@ class DepGraph\n     /** Data for each transaction, in the same order as the Cluster it was constructed from. */\n     std::vector<Entry> entries;\n \n+    /** Which positions are used. */",
      "path": "src/cluster_linearize.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "in commit message for 7510a65127db610df4be9cdd95eaef0c23b3e2ff\r\n\r\n\"This commits starts introducing support\" are we expecting more support later?",
      "created_at": "2024-09-16T18:12:43Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761630898",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761630898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 60,
      "original_line": 60,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761650849",
      "pull_request_review_id": 2306885844,
      "id": 1761650849,
      "node_id": "PRRC_kwDOABII585pAKih",
      "diff_hunk": "@@ -18,6 +18,10 @@ using namespace cluster_linearize;\n \n namespace {\n \n+/** Special magic value that indicates to TestDepGraphSerialization that a cluster entry represents\n+ *  a hole. */\n+constexpr std::pair<FeeFrac, TestBitSet> HOLE{FeeFrac{1901858123504646, 3635904}, {}};",
      "path": "src/test/cluster_linearize_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "humor me: why these values? Values outside what the de-serializer is otherwise allowed to make?",
      "created_at": "2024-09-16T18:26:07Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761650849",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761650849"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761676550",
      "pull_request_review_id": 2306885844,
      "id": 1761676550,
      "node_id": "PRRC_kwDOABII585pAQ0G",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I don't see where these are being deleted? The only removal below is removing things that aren't in `Positions()`, which the newly added transactions should be? Likely misreading this.",
      "created_at": "2024-09-16T18:44:13Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1761676550",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1761676550"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763548308",
      "pull_request_review_id": 2306885844,
      "id": 1763548308,
      "node_id": "PRRC_kwDOABII585pHZyU",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 102,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Ergonomically speaking, I expect this to be used to remove a set of \"direct conflicts\" and all descendants of that set, so this wouldn't cause invalid views of the underlying cluster's graph relationships. \r\n\r\nIs this correct?",
      "created_at": "2024-09-17T16:32:22Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763548308",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763548308"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763550167",
      "pull_request_review_id": 2306885844,
      "id": 1763550167,
      "node_id": "PRRC_kwDOABII585pHaPX",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;\n+        // Remove now-unused trailing entries.\n+        while (!entries.empty() && !m_used[entries.size() - 1]) {\n+            entries.pop_back();\n+        }\n+        // Remove the deleted transactions from ancestors/descendants of other transactions.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 115,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "do we want to leave a note that now-unused entries not at the end can be non-empty/dirty? If that's not possible, a comment explaining that would be helpful too.",
      "created_at": "2024-09-17T16:33:44Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763550167",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763550167"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763551402",
      "pull_request_review_id": 2306885844,
      "id": 1763551402,
      "node_id": "PRRC_kwDOABII585pHaiq",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 176,
      "original_position": 110,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Do we want to `Assume` that `del` is in `m_used`?",
      "created_at": "2024-09-17T16:34:44Z",
      "updated_at": "2024-09-17T17:13:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763551402",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763551402"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 196,
      "original_line": 196,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763665495",
      "pull_request_review_id": 2310464388,
      "id": 1763665495,
      "node_id": "PRRC_kwDOABII585pH2ZX",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {",
      "path": "src/cluster_linearize.h",
      "position": 195,
      "original_position": 80,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "f484f5a8721b06d4f9fda69968d94046c6bc12d7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Was reconstructing graphs incorrectly leading to inconsistent sets. Better to fail here early.\r\n\r\n```Suggestion\r\n    {\r\n         // We can't add relationships to holes\r\n        Assume(parents.IsSubsetOf(m_used));\r\n```\r\na check like this for `AddDependency` would also be good:\r\n\r\n`Assume(SetType::Singleton(parent).IsSubsetOf(m_used));`",
      "created_at": "2024-09-17T18:03:21Z",
      "updated_at": "2024-09-17T18:46:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1763665495",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1763665495"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 215,
      "original_line": 215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764225430",
      "pull_request_review_id": 2311366400,
      "id": 1764225430,
      "node_id": "PRRC_kwDOABII585pJ_GW",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 228,
      "original_position": 211,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": null,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Is the hope to be able to reconstruct direct parents of a transaction from the txgraph? Even if a direct parent is also an indirect ancestor?",
      "created_at": "2024-09-17T23:57:45Z",
      "updated_at": "2024-09-17T23:57:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764225430",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764225430"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764229116",
      "pull_request_review_id": 2311371515,
      "id": 1764229116,
      "node_id": "PRRC_kwDOABII585pJ__8",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 228,
      "original_position": 211,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No, that's impossible (A->B->C is indistinguishable from (A->B->C,A->C)); the goal is just computing a minimal set of dependencies whose corresponding ancestry matches the DepGraph (and this will necessarily be a subset of the real direct parents).",
      "created_at": "2024-09-18T00:05:24Z",
      "updated_at": "2024-09-18T00:07:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764229116",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764229116"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764240141",
      "pull_request_review_id": 2311387945,
      "id": 1764240141,
      "node_id": "PRRC_kwDOABII585pKCsN",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 228,
      "original_position": 211,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "thought so... how is it intended to be used?",
      "created_at": "2024-09-18T00:28:30Z",
      "updated_at": "2024-09-18T00:28:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1764240141",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1764240141"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765436227",
      "pull_request_review_id": 2313318636,
      "id": 1765436227,
      "node_id": "PRRC_kwDOABII585pOmtD",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 102,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "In practice, this will be used to either remove a set of conflicts (together with all their descendants), or to remove a set of mined transactions (together with all their ancestors). In both cases, no transactions will remain which are both ancestors of some deleted transactions and descendants of other deleted transactions.",
      "created_at": "2024-09-18T17:18:27Z",
      "updated_at": "2024-09-18T17:18:27Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765436227",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765436227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765437954",
      "pull_request_review_id": 2313321433,
      "id": 1765437954,
      "node_id": "PRRC_kwDOABII585pOnIC",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 102,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ah, right! I hadn't considered the mining side. Maybe leave something to that effect?",
      "created_at": "2024-09-18T17:19:55Z",
      "updated_at": "2024-09-18T17:19:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765437954",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765437954"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765469878",
      "pull_request_review_id": 2313371167,
      "id": 1765469878,
      "node_id": "PRRC_kwDOABII585pOu62",
      "diff_hunk": "@@ -57,9 +57,20 @@ class DepGraph\n     /** Data for each transaction, in the same order as the Cluster it was constructed from. */\n     std::vector<Entry> entries;\n \n+    /** Which positions are used. */",
      "path": "src/cluster_linearize.h",
      "position": 4,
      "original_position": 4,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761630898,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Fixed. I initially intended to introduce this in multiple commits, but then didn't go back to editing the commit message after everything ended up in one commit.",
      "created_at": "2024-09-18T17:46:16Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765469878",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765469878"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 60,
      "original_line": 60,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765470244",
      "pull_request_review_id": 2313371167,
      "id": 1765470244,
      "node_id": "PRRC_kwDOABII585pOvAk",
      "diff_hunk": "@@ -86,57 +86,30 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=cluster.size().\n      */\n-    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : entries(cluster.size())\n+    explicit DepGraph(const Cluster<SetType>& cluster) noexcept : DepGraph(cluster.size())\n     {\n         for (ClusterIndex i = 0; i < cluster.size(); ++i) {\n             // Fill in fee and size.\n             entries[i].feerate = cluster[i].first;\n-            // Fill in direct parents as ancestors.\n-            entries[i].ancestors = cluster[i].second;\n-            // Make sure transactions are ancestors of themselves.\n-            entries[i].ancestors.Set(i);\n-        }\n-\n-        // Propagate ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            // At this point, entries[a].ancestors[b] is true iff b is an ancestor of a and there\n-            // is a path from a to b through the subgraph consisting of {a, b} union\n-            // {0, 1, ..., (i-1)}.\n-            SetType to_merge = entries[i].ancestors;\n-            for (ClusterIndex j = 0; j < entries.size(); ++j) {\n-                if (entries[j].ancestors[i]) {\n-                    entries[j].ancestors |= to_merge;\n-                }\n-            }\n-        }\n-\n-        // Fill in descendant information by transposing the ancestor information.\n-        for (ClusterIndex i = 0; i < entries.size(); ++i) {\n-            for (auto j : entries[i].ancestors) {\n-                entries[j].descendants.Set(i);\n-            }\n+            // Fill in dependencies.",
      "path": "src/cluster_linearize.h",
      "position": 63,
      "original_position": 34,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761389984,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. Made it \"Fill in dependencies by remapping direct parents.\".",
      "created_at": "2024-09-18T17:46:36Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765470244",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765470244"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 106,
      "original_line": 106,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471150",
      "pull_request_review_id": 2313371167,
      "id": 1765471150,
      "node_id": "PRRC_kwDOABII585pOvOu",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct",
      "path": "src/cluster_linearize.h",
      "position": 163,
      "original_position": 102,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763548308,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I feel like that's better left to the layer above; as far as DepGraph is concerned, it's pefectly well-defined to do this, even though we don't care.",
      "created_at": "2024-09-18T17:47:23Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765471150",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 188,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471968",
      "pull_request_review_id": 2313371167,
      "id": 1765471968,
      "node_id": "PRRC_kwDOABII585pOvbg",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 176,
      "original_position": 110,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "There is no need for that I think. The code doesn't get simpler by enforcing that.",
      "created_at": "2024-09-18T17:48:05Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765471968",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765471968"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 196,
      "original_line": 196,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765472587",
      "pull_request_review_id": 2313371167,
      "id": 1765472587,
      "node_id": "PRRC_kwDOABII585pOvlL",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 194,
      "original_position": 79,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761452737,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I went a lot further and dropped `AddDependency` entirely.",
      "created_at": "2024-09-18T17:48:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765472587",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765472587"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 214,
      "original_line": 214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765473716",
      "pull_request_review_id": 2313371167,
      "id": 1765473716,
      "node_id": "PRRC_kwDOABII585pOv20",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {",
      "path": "src/cluster_linearize.h",
      "position": 195,
      "original_position": 80,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "f484f5a8721b06d4f9fda69968d94046c6bc12d7",
      "in_reply_to_id": 1763665495,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:49:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765473716",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765473716"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 215,
      "original_line": 215,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474071",
      "pull_request_review_id": 2313371167,
      "id": 1765474071,
      "node_id": "PRRC_kwDOABII585pOv8X",
      "diff_hunk": "@@ -184,6 +184,46 @@ class DepGraph\n         }\n     }\n \n+    /** Compute the (reduced) set of parents of node i in this graph.",
      "path": "src/cluster_linearize.h",
      "position": 220,
      "original_position": 4,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761301820,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done. I've expanded the commit message of all commits.",
      "created_at": "2024-09-18T17:49:50Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765474071",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 237,
      "original_line": 237,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474366",
      "pull_request_review_id": 2313371167,
      "id": 1765474366,
      "node_id": "PRRC_kwDOABII585pOwA-",
      "diff_hunk": "@@ -184,6 +212,74 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.\n+        SetType par_anc;\n+        for (auto par : parents - Ancestors(child)) {\n+            par_anc |= Ancestors(par);\n+        }\n+        par_anc -= Ancestors(child);\n+        // Bail out if there are no such ancestors.\n+        if (par_anc.None()) return;\n+        // To each such ancestor, add as descendants the descendants of the child.\n+        const auto& chl_des = entries[child].descendants;\n+        for (auto anc_of_par : par_anc) {\n+            entries[anc_of_par].descendants |= chl_des;\n+        }\n+        // To each descendant of the child, add those ancestors.\n+        for (auto dec_of_chl : Descendants(child)) {\n+            entries[dec_of_chl].ancestors |= par_anc;\n+        }\n+    }\n+\n+    /** Compute the (reduced) set of parents of node i in this graph.\n+     *\n+     * This is the set of dependencies of i, excluding i itself, and excluding any parents of other\n+     * dependencies.\n+     *\n+     * Complexity: O(N) where N=Ancestors(i).Count() (which is bounded by TxCount()).\n+     */\n+    SetType GetReducedParents(ClusterIndex i) const noexcept",
      "path": "src/cluster_linearize.h",
      "position": 228,
      "original_position": 211,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1764225430,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have expanded the commit message.",
      "created_at": "2024-09-18T17:50:06Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765474366",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765474366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 245,
      "original_line": 245,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475761",
      "pull_request_review_id": 2313371167,
      "id": 1765475761,
      "node_id": "PRRC_kwDOABII585pOwWx",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 260,
      "original_position": 11,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761348880,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Sadly that won't work when there are cyclic dependencies. Of course, this test could be moved down to the \"if acyclic\" branch, but there is a stronger test there already.",
      "created_at": "2024-09-18T17:51:22Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765475761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 333,
      "original_line": 333,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475972",
      "pull_request_review_id": 2313371167,
      "id": 1765475972,
      "node_id": "PRRC_kwDOABII585pOwaE",
      "diff_hunk": "@@ -264,9 +264,22 @@ void SanityCheck(const DepGraph<SetType>& depgraph)\n         for (ClusterIndex j = 0; j < depgraph.TxCount(); ++j) {\n             assert(depgraph.Ancestors(i)[j] == depgraph.Descendants(j)[i]);\n         }\n+        // No transaction is a parent or child of itself.\n+        auto parents = depgraph.GetReducedParents(i);\n+        auto children = depgraph.GetReducedChildren(i);\n+        assert(!parents[i]);\n+        assert(!children[i]);\n+        // Parents of a transactions do not have ancestors inside those parents (except itself).\n+        for (auto parent : parents) {\n+            assert((depgraph.Ancestors(parent) & parents).IsSubsetOf(SetType::Singleton(parent)));\n+        }\n+        // Similar for children and descendants.\n+        for (auto child : children) {\n+            assert((depgraph.Descendants(child) & children).IsSubsetOf(SetType::Singleton(child)));",
      "path": "src/test/util/cluster_linearize.h",
      "position": 264,
      "original_position": 15,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "77e07eba11391868f83db22bf2280e02b5a8cd78",
      "in_reply_to_id": 1761348362,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Same reason; won't work for cyclic graphs.",
      "created_at": "2024-09-18T17:51:33Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765475972",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765475972"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 337,
      "original_line": 337,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765476808",
      "pull_request_review_id": 2313371167,
      "id": 1765476808,
      "node_id": "PRRC_kwDOABII585pOwnI",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;\n+        // Remove now-unused trailing entries.\n+        while (!entries.empty() && !m_used[entries.size() - 1]) {\n+            entries.pop_back();\n+        }\n+        // Remove the deleted transactions from ancestors/descendants of other transactions.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 115,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763550167,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Added a comment.",
      "created_at": "2024-09-18T17:52:12Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765476808",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765476808"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 188,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765478370",
      "pull_request_review_id": 2313371167,
      "id": 1765478370,
      "node_id": "PRRC_kwDOABII585pOw_i",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761676550,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "This is adding transactions to `depgraph_tree` corresponding to the holes in `depgraph_gen`, which are then deleted below. The point is making sure that the non-holes have the same positions in both. I have added a comment to explain.",
      "created_at": "2024-09-18T17:53:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765478370",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765478370"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479411",
      "pull_request_review_id": 2313371167,
      "id": 1765479411,
      "node_id": "PRRC_kwDOABII585pOxPz",
      "diff_hunk": "@@ -18,6 +18,10 @@ using namespace cluster_linearize;\n \n namespace {\n \n+/** Special magic value that indicates to TestDepGraphSerialization that a cluster entry represents\n+ *  a hole. */\n+constexpr std::pair<FeeFrac, TestBitSet> HOLE{FeeFrac{1901858123504646, 3635904}, {}};",
      "path": "src/test/cluster_linearize_tests.cpp",
      "position": null,
      "original_position": 6,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761650849,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "They were randomly generated, but are legal for the serializer (`SanityCheck()` would fail otherwise). I've simplified them to something more obviously nonsensical (transaction larger than 4M).",
      "created_at": "2024-09-18T17:54:34Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479411",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 23,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479597",
      "pull_request_review_id": 2313371167,
      "id": 1765479597,
      "node_id": "PRRC_kwDOABII585pOxSt",
      "diff_hunk": "@@ -166,14 +165,11 @@ struct DepGraphFormatter\n                 }\n             }\n             // Write position information.\n-            ClusterIndex insert_distance = 0;\n-            while (insert_distance < rebuilt_order.size()) {\n-                // Loop to find how far from the end in rebuilt_order to insert.\n-                if (idx > *(rebuilt_order.end() - 1 - insert_distance)) break;\n-                ++insert_distance;\n-            }\n-            rebuilt_order.insert(rebuilt_order.end() - insert_distance, idx);\n-            s << VARINT(diff + insert_distance);\n+            // The new transaction is be inserted N positions back from the end of the cluster.\n+            // Emit N to indicate that many insertion choices are skipped.",
      "path": "src/test/util/cluster_linearize.h",
      "position": null,
      "original_position": 25,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "dde3959a24a12cd7ab37e772b55ae3c60a646528",
      "in_reply_to_id": 1761525176,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:54:43Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479597",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479597"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479695",
      "pull_request_review_id": 2313371167,
      "id": 1765479695,
      "node_id": "PRRC_kwDOABII585pOxUP",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept\n+    {\n+        // Compute the ancestors of parents that are not yet ancestors of child.",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 81,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761406415,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Done.",
      "created_at": "2024-09-18T17:54:49Z",
      "updated_at": "2024-09-18T17:58:34Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765479695",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765479695"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": 168,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 224,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765524349",
      "pull_request_review_id": 2313465902,
      "id": 1765524349,
      "node_id": "PRRC_kwDOABII585pO8N9",
      "diff_hunk": "@@ -184,6 +157,34 @@ class DepGraph\n         }\n     }\n \n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,\n+     * but is more efficient.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void AddDependencies(const SetType& parents, ClusterIndex child) noexcept",
      "path": "src/cluster_linearize.h",
      "position": 194,
      "original_position": 79,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "44afa83b8f8b6b6b9e96d74f6e8176bb04060910",
      "in_reply_to_id": 1761452737,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "even better",
      "created_at": "2024-09-18T18:30:41Z",
      "updated_at": "2024-09-18T18:30:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765524349",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765524349"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 214,
      "original_line": 214,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765529514",
      "pull_request_review_id": 2313477686,
      "id": 1765529514,
      "node_id": "PRRC_kwDOABII585pO9eq",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 176,
      "original_position": 110,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "If we're allowing it, let's make sure there's overage for it in the fuzzer",
      "created_at": "2024-09-18T18:34:11Z",
      "updated_at": "2024-09-18T18:34:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765529514",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765529514"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 196,
      "original_line": 196,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765537433",
      "pull_request_review_id": 2313493335,
      "id": 1765537433,
      "node_id": "PRRC_kwDOABII585pO_aZ",
      "diff_hunk": "@@ -848,9 +859,16 @@ FUZZ_TARGET(clusterlin_postlinearize_tree)\n     // Now construct a new graph, copying the nodes, but leaving only the first parent (even\n     // direction) or the first child (odd direction).\n     DepGraph<TestBitSet> depgraph_tree;\n-    for (ClusterIndex i = 0; i < depgraph_gen.TxCount(); ++i) {\n-        depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+    for (ClusterIndex i = 0; i < depgraph_gen.PositionRange(); ++i) {\n+        if (depgraph_gen.Positions()[i]) {\n+            depgraph_tree.AddTransaction(depgraph_gen.FeeRate(i));\n+        } else {\n+            // For holes, add a dummy transaction which is deleted below.",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 138,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "7510a65127db610df4be9cdd95eaef0c23b3e2ff",
      "in_reply_to_id": 1761676550,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "ok, seems clear to me now, not sure why I was so confused. ",
      "created_at": "2024-09-18T18:40:08Z",
      "updated_at": "2024-09-18T18:40:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765537433",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765537433"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 930,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765572322",
      "pull_request_review_id": 2313550404,
      "id": 1765572322,
      "node_id": "PRRC_kwDOABII585pPH7i",
      "diff_hunk": "@@ -240,32 +241,68 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependency)\n+FUZZ_TARGET(clusterlin_add_dependencies)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using AddDependency\n-    // have the same effect.\n+    // Verify that computing a DepGraph from a cluster, or building it step by step using\n+    // AddDependencies has the same effect.\n \n-    // Construct a cluster of a certain length, with no dependencies.\n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, 32);\n+    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n+    InsecureRandomContext rng(rng_seed);\n+\n+    // Construct a cluster of a certain length, with no dependencies.\n+    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n     Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n     // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph(cluster);\n-    SanityCheck(depgraph);\n-    // Read (parent, child) pairs, and add them to the cluster and depgraph.\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size() * TestBitSet::Size()) {\n-        auto parent = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 2);\n-        child += (child >= parent);\n-        cluster[child].second.Set(parent);\n-        depgraph.AddDependency(parent, child);\n-        assert(depgraph.Ancestors(child)[parent]);\n-        assert(depgraph.Descendants(parent)[child]);\n+    DepGraph depgraph_batch(cluster);\n+    SanityCheck(depgraph_batch);\n+    // Read (parent, child) and (parents, child) pairs, and add them to the cluster and depgraph.\n+    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n+        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I think this gives additional coverage since no deps added in a `AddDependencies` call is allowed\r\n```Suggestion\r\n        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(0, (uint64_t{1} << num_tx) - 1);\r\n```",
      "created_at": "2024-09-18T19:11:52Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765572322",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765572322"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 262,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765576120",
      "pull_request_review_id": 2313550404,
      "id": 1765576120,
      "node_id": "PRRC_kwDOABII585pPI24",
      "diff_hunk": "@@ -164,21 +137,29 @@ class DepGraph\n         return new_idx;\n     }\n \n-    /** Modify this transaction graph, adding a dependency between a specified parent and child.\n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 75,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "AddDependency doesn't exist anymore",
      "created_at": "2024-09-18T19:15:36Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765576120",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765576120"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765598717",
      "pull_request_review_id": 2313550404,
      "id": 1765598717,
      "node_id": "PRRC_kwDOABII585pPOX9",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)",
      "path": "src/cluster_linearize.h",
      "position": 84,
      "original_position": 35,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Could use some documentation on how to use `mapping` and `pos_range`, with holes it's not immediately obvious.",
      "created_at": "2024-09-18T19:37:12Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765598717",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765598717"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 126,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765657306",
      "pull_request_review_id": 2313550404,
      "id": 1765657306,
      "node_id": "PRRC_kwDOABII585pPcra",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());",
      "path": "src/cluster_linearize.h",
      "position": 86,
      "original_position": 37,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "is this not still true?",
      "created_at": "2024-09-18T20:09:03Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765657306",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765657306"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 127,
      "original_line": 127,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765664723",
      "pull_request_review_id": 2313550404,
      "id": 1765664723,
      "node_id": "PRRC_kwDOABII585pPefT",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());\n-        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+        for (ClusterIndex i : depgraph.Positions()) {\n+            auto new_idx = mapping[i];\n+            Assume(new_idx < pos_range);\n+            // Add transaction.\n+            entries[new_idx].ancestors = SetType::Singleton(new_idx);\n+            entries[new_idx].descendants = SetType::Singleton(new_idx);\n+            m_used.Set(new_idx);\n             // Fill in fee and size.\n-            entries[mapping[i]].feerate = depgraph.entries[i].feerate;\n+            entries[new_idx].feerate = depgraph.entries[i].feerate;\n+        }\n+        for (ClusterIndex i : depgraph.Positions()) {\n             // Fill in dependencies by mapping direct parents.\n             SetType parents;\n             for (auto j : depgraph.GetReducedParents(i)) parents.Set(mapping[j]);\n             AddDependencies(parents, mapping[i]);\n         }\n+        // Verify that the provided pos_range was correct (no unused positions at the end).\n+        Assume(pos_range == 0 || m_used[pos_range - 1]);",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 57,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "if not erroneous, I think a bit easier to read\r\n```Suggestion\r\n        Assume((m_used.None() && pos_range == 0) || m_used.Last() == pos_range - 1);\r\n```",
      "created_at": "2024-09-18T20:14:50Z",
      "updated_at": "2024-09-18T20:24:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765664723",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765664723"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765667807",
      "pull_request_review_id": 2313550404,
      "id": 1765667807,
      "node_id": "PRRC_kwDOABII585pPfPf",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);",
      "path": "src/test/util/cluster_linearize.h",
      "position": 203,
      "original_position": 146,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Haven't looked close enough to the new format, but pushing another element to `reordering` after hitting `SetType::Size` already seems to make the DepGraph construction later odd? Couldn't this make the mapping argument too large?",
      "created_at": "2024-09-18T20:17:47Z",
      "updated_at": "2024-09-18T20:23:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765667807",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765667807"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788553",
      "pull_request_review_id": 2313906901,
      "id": 1765788553,
      "node_id": "PRRC_kwDOABII585pP8uJ",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)",
      "path": "src/cluster_linearize.h",
      "position": 84,
      "original_position": 35,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765598717,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I have added some documentation and `Assume`s.",
      "created_at": "2024-09-18T22:08:04Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765788553",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788553"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 126,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788969",
      "pull_request_review_id": 2313906901,
      "id": 1765788969,
      "node_id": "PRRC_kwDOABII585pP80p",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());",
      "path": "src/cluster_linearize.h",
      "position": 86,
      "original_position": 37,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765657306,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "No; `mapping.size()` should be equal to `depgraph.PositionRange()` though, which I've clarified and added an `Assume` for.",
      "created_at": "2024-09-18T22:08:33Z",
      "updated_at": "2024-09-18T22:33:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765788969",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765788969"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 127,
      "original_line": 127,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765789292",
      "pull_request_review_id": 2313906901,
      "id": 1765789292,
      "node_id": "PRRC_kwDOABII585pP85s",
      "diff_hunk": "@@ -124,19 +149,49 @@ class DepGraph\n     /** Get the descendants of a given transaction i. Complexity: O(1). */\n     const SetType& Descendants(ClusterIndex i) const noexcept { return entries[i].descendants; }\n \n-    /** Add a new unconnected transaction to this transaction graph (at the end), and return its\n-     *  ClusterIndex.\n+    /** Add a new unconnected transaction to this transaction graph (in the first available\n+     *  position), and return its ClusterIndex.\n      *\n      * Complexity: O(1) (amortized, due to resizing of backing vector).\n      */\n     ClusterIndex AddTransaction(const FeeFrac& feefrac) noexcept\n     {\n-        Assume(TxCount() < SetType::Size());\n-        ClusterIndex new_idx = TxCount();\n-        entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        static constexpr auto ALL_POSITIONS = SetType::Fill(SetType::Size());\n+        auto available = ALL_POSITIONS - m_used;\n+        Assume(available.Any());\n+        ClusterIndex new_idx = available.First();\n+        if (new_idx == entries.size()) {\n+            entries.emplace_back(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        } else {\n+            entries[new_idx] = Entry(feefrac, SetType::Singleton(new_idx), SetType::Singleton(new_idx));\n+        }\n+        m_used.Set(new_idx);\n         return new_idx;\n     }\n \n+    /** Remove the specified positions from this DepGraph.\n+     *\n+     * The specified positions will no longer be part of Positions(), and dependencies with them are\n+     * removed. Note that due to DepGraph only tracking ancestors/descendants (and not direct\n+     * dependencies), if a parent is removed while a grandparent remains, the grandparent will\n+     * remain an ancestor.\n+     *\n+     * Complexity: O(N) where N=TxCount().\n+     */\n+    void RemoveTransactions(const SetType& del) noexcept\n+    {\n+        m_used -= del;",
      "path": "src/cluster_linearize.h",
      "position": 176,
      "original_position": 110,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "9f67d6dcdcf7e9c75a93ad78f8902537599f4f6d",
      "in_reply_to_id": 1763551402,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Good idea, done (in `clusterlin_cluster_serialization`).",
      "created_at": "2024-09-18T22:09:01Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765789292",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765789292"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 196,
      "original_line": 196,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765790977",
      "pull_request_review_id": 2313906901,
      "id": 1765790977,
      "node_id": "PRRC_kwDOABII585pP9UB",
      "diff_hunk": "@@ -235,27 +253,63 @@ struct DepGraphFormatter\n             assert(reordering.size() < SetType::Size());\n             auto topo_idx = topo_depgraph.AddTransaction(new_feerate);\n             topo_depgraph.AddDependencies(new_ancestors, topo_idx);\n-            diff %= total_size + 1;\n-            // Insert the new transaction at distance diff back from the end.\n-            for (auto& pos : reordering) {\n-                pos += (pos >= total_size - diff);\n+            if (total_size < SetType::Size()) {\n+                // Normal case.\n+                diff %= SetType::Size();\n+                if (diff <= total_size) {\n+                    // Insert the new transaction at distance diff back from the end.\n+                    for (auto& pos : reordering) {\n+                        pos += (pos >= total_size - diff);\n+                    }\n+                    reordering.push_back(total_size++ - diff);\n+                } else {\n+                    // Append diff - total_size holes at the end, plus the new transaction.\n+                    total_size = diff;\n+                    reordering.push_back(total_size++);\n+                }\n+            } else {\n+                // In case total_size == SetType::Size, it is not possible to insert the new\n+                // transaction without exceeding SetType's size. Instead, interpret diff as an\n+                // index into the holes, and overwrite a position there. This branch is never used\n+                // when deserializing the output of the serializer, but gives meaning to otherwise\n+                // invalid input.\n+                diff %= (SetType::Size() - reordering.size());\n+                SetType holes = SetType::Fill(SetType::Size());\n+                for (auto pos : reordering) holes.Reset(pos);\n+                for (auto pos : holes) {\n+                    if (diff == 0) {\n+                        reordering.push_back(pos);",
      "path": "src/test/util/cluster_linearize.h",
      "position": 203,
      "original_position": 146,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765667807,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "`reordering` has a size equal to the number of transactions (excluding holes) in the reconstructed `DepGraph`, and can indeed not exceed `SetType::Size()` (this is also asserted above). However, `total_size` does include holes, and can reach `SetType::Size()` (that's exactly what this branch is for, and it does not increment `total_size` anymore).",
      "created_at": "2024-09-18T22:11:17Z",
      "updated_at": "2024-09-18T22:41:11Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765790977",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765790977"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791238",
      "pull_request_review_id": 2313906901,
      "id": 1765791238,
      "node_id": "PRRC_kwDOABII585pP9YG",
      "diff_hunk": "@@ -100,21 +112,34 @@ class DepGraph\n      *\n      * Complexity: O(N^2) where N=depgraph.TxCount().\n      */\n-    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping) noexcept : DepGraph(depgraph.TxCount())\n+    DepGraph(const DepGraph<SetType>& depgraph, Span<const ClusterIndex> mapping, ClusterIndex pos_range) noexcept : entries(pos_range)\n     {\n-        Assert(mapping.size() == depgraph.TxCount());\n-        for (ClusterIndex i = 0; i < depgraph.TxCount(); ++i) {\n+        for (ClusterIndex i : depgraph.Positions()) {\n+            auto new_idx = mapping[i];\n+            Assume(new_idx < pos_range);\n+            // Add transaction.\n+            entries[new_idx].ancestors = SetType::Singleton(new_idx);\n+            entries[new_idx].descendants = SetType::Singleton(new_idx);\n+            m_used.Set(new_idx);\n             // Fill in fee and size.\n-            entries[mapping[i]].feerate = depgraph.entries[i].feerate;\n+            entries[new_idx].feerate = depgraph.entries[i].feerate;\n+        }\n+        for (ClusterIndex i : depgraph.Positions()) {\n             // Fill in dependencies by mapping direct parents.\n             SetType parents;\n             for (auto j : depgraph.GetReducedParents(i)) parents.Set(mapping[j]);\n             AddDependencies(parents, mapping[i]);\n         }\n+        // Verify that the provided pos_range was correct (no unused positions at the end).\n+        Assume(pos_range == 0 || m_used[pos_range - 1]);",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 57,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "a9d5f0619ea076ebd1c808cd6ba926a1dc2a9259",
      "in_reply_to_id": 1765664723,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "I made it even more explicit with `Assume(m_used.None() ? (pos_range == 0) : (pos_range == m_used.Last() + 1));`.",
      "created_at": "2024-09-18T22:11:38Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791238",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791238"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791639",
      "pull_request_review_id": 2313906901,
      "id": 1765791639,
      "node_id": "PRRC_kwDOABII585pP9eX",
      "diff_hunk": "@@ -164,21 +137,29 @@ class DepGraph\n         return new_idx;\n     }\n \n-    /** Modify this transaction graph, adding a dependency between a specified parent and child.\n+    /** Modify this transaction graph, adding multiple parents to a specified child.\n+     *\n+     * The behavior is identical to repeatedly calling AddDependency for each element of parents,",
      "path": "src/cluster_linearize.h",
      "position": null,
      "original_position": 75,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": 1765576120,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Gone.",
      "created_at": "2024-09-18T22:12:17Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 142,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791761",
      "pull_request_review_id": 2313906901,
      "id": 1765791761,
      "node_id": "PRRC_kwDOABII585pP9gR",
      "diff_hunk": "@@ -240,32 +241,68 @@ std::vector<ClusterIndex> ReadLinearization(const DepGraph<BS>& depgraph, SpanRe\n \n } // namespace\n \n-FUZZ_TARGET(clusterlin_add_dependency)\n+FUZZ_TARGET(clusterlin_add_dependencies)\n {\n-    // Verify that computing a DepGraph from a cluster, or building it step by step using AddDependency\n-    // have the same effect.\n+    // Verify that computing a DepGraph from a cluster, or building it step by step using\n+    // AddDependencies has the same effect.\n \n-    // Construct a cluster of a certain length, with no dependencies.\n     FuzzedDataProvider provider(buffer.data(), buffer.size());\n-    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, 32);\n+    auto rng_seed = provider.ConsumeIntegral<uint64_t>();\n+    InsecureRandomContext rng(rng_seed);\n+\n+    // Construct a cluster of a certain length, with no dependencies.\n+    auto num_tx = provider.ConsumeIntegralInRange<ClusterIndex>(2, TestBitSet::Size());\n     Cluster<TestBitSet> cluster(num_tx, std::pair{FeeFrac{0, 1}, TestBitSet{}});\n     // Construct the corresponding DepGraph object (also no dependencies).\n-    DepGraph depgraph(cluster);\n-    SanityCheck(depgraph);\n-    // Read (parent, child) pairs, and add them to the cluster and depgraph.\n-    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size() * TestBitSet::Size()) {\n-        auto parent = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 1);\n-        auto child = provider.ConsumeIntegralInRange<ClusterIndex>(0, num_tx - 2);\n-        child += (child >= parent);\n-        cluster[child].second.Set(parent);\n-        depgraph.AddDependency(parent, child);\n-        assert(depgraph.Ancestors(child)[parent]);\n-        assert(depgraph.Descendants(parent)[child]);\n+    DepGraph depgraph_batch(cluster);\n+    SanityCheck(depgraph_batch);\n+    // Read (parent, child) and (parents, child) pairs, and add them to the cluster and depgraph.\n+    std::vector<std::pair<ClusterIndex, ClusterIndex>> deps_list;\n+    LIMITED_WHILE(provider.remaining_bytes() > 0, TestBitSet::Size()) {\n+        const auto parents_mask = provider.ConsumeIntegralInRange<uint64_t>(1, (uint64_t{1} << num_tx) - 1);",
      "path": "src/test/fuzz/cluster_linearize.cpp",
      "position": null,
      "original_position": 55,
      "commit_id": "458cb1a52ba909dbc5aaecaf3d538421b3b9ce7b",
      "original_commit_id": "0e9af35e4980ccca0cf0b30f4beaf05cc25c5a7f",
      "in_reply_to_id": 1765572322,
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false
      },
      "body": "Indeed, done.",
      "created_at": "2024-09-18T22:12:27Z",
      "updated_at": "2024-09-18T22:13:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30857#discussion_r1765791761",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1765791761"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30857"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 262,
      "side": "RIGHT"
    }
  ]
}